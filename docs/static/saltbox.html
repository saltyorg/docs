<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Branch Diff Report - saltyorg/Saltbox</title>
    <style>
        :root {
            --bg-primary: #0d1117;
            --bg-secondary: #161b22;
            --bg-tertiary: #21262d;
            --text-primary: #c9d1d9;
            --text-secondary: #8b949e;
            --border-color: #30363d;
            --accent-green: #238636;
            --accent-red: #da3633;
            --diff-add-bg: rgba(46, 160, 67, 0.15);
            --diff-del-bg: rgba(248, 81, 73, 0.15);
            --diff-add-text: #7ee787;
            --diff-del-text: #ffa198;
            --diff-hunk-bg: rgba(56, 139, 253, 0.15);
            --diff-hunk-text: #79c0ff;
        }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Noto Sans', Helvetica, Arial, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.5;
            padding: 2rem;
        }
        .container { max-width: 1400px; margin: 0 auto; }
        header {
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 1.5rem;
            margin-bottom: 2rem;
        }
        h1 { font-size: 1.75rem; font-weight: 600; margin-bottom: 0.5rem; }
        .meta { color: var(--text-secondary); font-size: 0.875rem; }
        .meta code { background: var(--bg-tertiary); padding: 0.1rem 0.4rem; border-radius: 3px; }
        .summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }
        .stat-card {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            padding: 1rem;
        }
        .stat-card h3 {
            font-size: 0.75rem;
            text-transform: uppercase;
            color: var(--text-secondary);
            margin-bottom: 0.25rem;
        }
        .stat-card .value { font-size: 1.5rem; font-weight: 600; }
        .stat-card.added .value { color: var(--diff-add-text); }
        .stat-card.removed .value { color: var(--diff-del-text); }
        .stat-card.modified .value { color: var(--diff-hunk-text); }
        .toc {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            padding: 1rem;
            margin-bottom: 2rem;
        }
        .toc h2 { font-size: 1rem; margin-bottom: 0.75rem; }
        .toc-list {
            list-style: none;
            max-height: 300px;
            overflow-y: auto;
            font-size: 0.875rem;
        }
        .toc-list li { padding: 0.25rem 0; }
        .toc-list a { color: var(--diff-hunk-text); text-decoration: none; }
        .toc-list a:hover { text-decoration: underline; }
        .badge {
            font-size: 0.7rem;
            padding: 0.1rem 0.4rem;
            border-radius: 3px;
            margin-left: 0.5rem;
        }
        .badge.added { background: var(--accent-green); color: white; }
        .badge.removed { background: var(--accent-red); color: white; }
        .badge.modified { background: var(--bg-tertiary); color: var(--text-secondary); }
        .file-section {
            margin-bottom: 1.5rem;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            overflow: hidden;
        }
        .file-header {
            background: var(--bg-secondary);
            padding: 0.75rem 1rem;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .file-header h3 {
            font-size: 0.875rem;
            font-weight: 600;
            font-family: ui-monospace, SFMono-Regular, 'SF Mono', Menlo, Consolas, monospace;
        }
        .diff-content {
            overflow-x: auto;
            font-family: ui-monospace, SFMono-Regular, 'SF Mono', Menlo, Consolas, monospace;
            font-size: 0.8rem;
            line-height: 1.4;
        }
        .diff-content pre { margin: 0; padding: 1rem; white-space: pre; }
        .diff-line { display: block; padding: 0 0.5rem; }
        .diff-line.add { background: var(--diff-add-bg); color: var(--diff-add-text); }
        .diff-line.del { background: var(--diff-del-bg); color: var(--diff-del-text); }
        .diff-line.hunk { background: var(--diff-hunk-bg); color: var(--diff-hunk-text); }
        .diff-line.context { color: var(--text-secondary); }
        .collapse-btn {
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            color: var(--text-secondary);
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.75rem;
            margin-left: auto;
        }
        .collapse-btn:hover { background: var(--border-color); }
        .collapsed .diff-content { display: none; }
        footer {
            margin-top: 3rem;
            padding-top: 1.5rem;
            border-top: 1px solid var(--border-color);
            text-align: center;
            color: var(--text-secondary);
            font-size: 0.875rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Branch Comparison Report</h1>
            <p class="meta">
                <strong>Repository:</strong> saltyorg/Saltbox<br>
                <strong>Comparing:</strong> <code>master</code> ? <code>role-refactor</code><br>
                <strong>Generated:</strong> 2025-12-16 15:20:16
            </p>
        </header>
        
        <div class="summary">
            <div class="stat-card added">
                <h3>Files Added</h3>
                <div class="value">20</div>
            </div>
            <div class="stat-card removed">
                <h3>Files Removed</h3>
                <div class="value">37</div>
            </div>
            <div class="stat-card modified">
                <h3>Files Modified</h3>
                <div class="value">330</div>
            </div>
            <div class="stat-card">
                <h3>Total Changes</h3>
                <div class="value">387</div>
            </div>
        </div>
        
        <div class="toc">
            <h2>Changed Files</h2>
            <ul class="toc-list">
                <li><a href="#file-0">library/cloudflare_dns_records.py</a><span class="badge added">added</span></li>
                <li><a href="#file-1">library/cloudflare_ssl.py</a><span class="badge added">added</span></li>
                <li><a href="#file-2">library/ip_timezone_lookup.py</a><span class="badge added">added</span></li>
                <li><a href="#file-3">library/tld_parse.py</a><span class="badge added">added</span></li>
                <li><a href="#file-4">lookup_plugins/docker_var.py</a><span class="badge added">added</span></li>
                <li><a href="#file-5">lookup_plugins/role_var.py</a><span class="badge added">added</span></li>
                <li><a href="#file-6">resources/tasks/instances/nzbget.yml</a><span class="badge added">added</span></li>
                <li><a href="#file-7">resources/tasks/instances/sabnzbd.yml</a><span class="badge added">added</span></li>
                <li><a href="#file-8">resources/tasks/variables/import_inventory_vars.yml</a><span class="badge added">added</span></li>
                <li><a href="#file-9">resources/tasks/variables/import_role_vars.yml</a><span class="badge added">added</span></li>
                <li><a href="#file-10">roles/cloudplow_disable/tasks/main.yml</a><span class="badge added">added</span></li>
                <li><a href="#file-11">roles/motd/tasks/subtasks/emby_info.yml</a><span class="badge added">added</span></li>
                <li><a href="#file-12">roles/motd/tasks/subtasks/jellyfin_info.yml</a><span class="badge added">added</span></li>
                <li><a href="#file-13">roles/motd/tasks/subtasks/qbittorrent_info.yml</a><span class="badge added">added</span></li>
                <li><a href="#file-14">roles/postgres_host/defaults/main.yml</a><span class="badge added">added</span></li>
                <li><a href="#file-15">roles/postgres_host/tasks/main.yml</a><span class="badge added">added</span></li>
                <li><a href="#file-16">roles/postgres_host/tasks/setup_version.yml</a><span class="badge added">added</span></li>
                <li><a href="#file-17">roles/pre_tasks/defaults/main.yml</a><span class="badge added">added</span></li>
                <li><a href="#file-18">roles/traefik_template/templates/docker-compose.yml.j2</a><span class="badge added">added</span></li>
                <li><a href="#file-19">scripts/saltbox-defaults-linter.py</a><span class="badge added">added</span></li>
                <li><a href="#file-20">resources/roles/dns/files/fetch_cloudflare_records.py</a><span class="badge removed">removed</span></li>
                <li><a href="#file-21">resources/roles/dns/files/requirements.txt</a><span class="badge removed">removed</span></li>
                <li><a href="#file-22">resources/roles/dns/tasks/cloudflare/subtasks/checksum.yml</a><span class="badge removed">removed</span></li>
                <li><a href="#file-23">resources/roles/dns/tasks/cloudflare/subtasks/python.yml</a><span class="badge removed">removed</span></li>
                <li><a href="#file-24">resources/roles/dns/tasks/cloudflare/subtasks/setup.yml</a><span class="badge removed">removed</span></li>
                <li><a href="#file-25">resources/tasks/instances/readarr.yml</a><span class="badge removed">removed</span></li>
                <li><a href="#file-26">roles/autobrr/templates/config.toml.j2</a><span class="badge removed">removed</span></li>
                <li><a href="#file-27">roles/cloudplow/tasks/subtasks/disable.yml</a><span class="badge removed">removed</span></li>
                <li><a href="#file-28">roles/diag/files/cloudflare_ssl.py</a><span class="badge removed">removed</span></li>
                <li><a href="#file-29">roles/jaeger/defaults/main.yml</a><span class="badge removed">removed</span></li>
                <li><a href="#file-30">roles/jaeger/tasks/main.yml</a><span class="badge removed">removed</span></li>
                <li><a href="#file-31">roles/readarr/defaults/main.yml</a><span class="badge removed">removed</span></li>
                <li><a href="#file-32">roles/readarr/tasks/main.yml</a><span class="badge removed">removed</span></li>
                <li><a href="#file-33">roles/readarr/tasks/main2.yml</a><span class="badge removed">removed</span></li>
                <li><a href="#file-34">roles/readarr/tasks/subtasks/auth.yml</a><span class="badge removed">removed</span></li>
                <li><a href="#file-35">roles/scripts/files/plex_autoscan_url.sh</a><span class="badge removed">removed</span></li>
                <li><a href="#file-36">roles/scripts/files/plexsql.sh</a><span class="badge removed">removed</span></li>
                <li><a href="#file-37">roles/scripts/files/restart_containers.sh</a><span class="badge removed">removed</span></li>
                <li><a href="#file-38">roles/settings/files/settings-updater.py</a><span class="badge removed">removed</span></li>
                <li><a href="#file-39">roles/settings/tasks/main.yml</a><span class="badge removed">removed</span></li>
                <li><a href="#file-40">roles/settings/tasks/main2.yml</a><span class="badge removed">removed</span></li>
                <li><a href="#file-41">roles/settings/tasks/subtasks/copy.yml</a><span class="badge removed">removed</span></li>
                <li><a href="#file-42">roles/settings/tasks/subtasks/finish.yml</a><span class="badge removed">removed</span></li>
                <li><a href="#file-43">roles/settings/tasks/subtasks/migrator.yml</a><span class="badge removed">removed</span></li>
                <li><a href="#file-44">roles/settings/tasks/subtasks/migrator/accounts_yml/migration_01.yml</a><span class="badge removed">removed</span></li>
                <li><a href="#file-45">roles/settings/tasks/subtasks/migrator/adv_settings_yml/migration_01.yml</a><span class="badge removed">removed</span></li>
                <li><a href="#file-46">roles/settings/tasks/subtasks/migrator/all/migration_01.yml</a><span class="badge removed">removed</span></li>
                <li><a href="#file-47">roles/settings/tasks/subtasks/migrator/backup_config_yml/migration_01.yml</a><span class="badge removed">removed</span></li>
                <li><a href="#file-48">roles/settings/tasks/subtasks/migrator/providers_yml/migration_01.yml</a><span class="badge removed">removed</span></li>
                <li><a href="#file-49">roles/settings/tasks/subtasks/migrator/settings_yml/migration_01.yml</a><span class="badge removed">removed</span></li>
                <li><a href="#file-50">roles/settings/tasks/subtasks/start.yml</a><span class="badge removed">removed</span></li>
                <li><a href="#file-51">roles/settings/tasks/subtasks/updater.yml</a><span class="badge removed">removed</span></li>
                <li><a href="#file-52">roles/sub_zero/defaults/main.yml</a><span class="badge removed">removed</span></li>
                <li><a href="#file-53">roles/sub_zero/tasks/main.yml</a><span class="badge removed">removed</span></li>
                <li><a href="#file-54">roles/webtools/defaults/main.yml</a><span class="badge removed">removed</span></li>
                <li><a href="#file-55">roles/webtools/tasks/main.yml</a><span class="badge removed">removed</span></li>
                <li><a href="#file-56">scripts/salty-linter.py</a><span class="badge removed">removed</span></li>
                <li><a href="#file-57">.ansible-lint</a><span class="badge modified">modified</span></li>
                <li><a href="#file-58">.github/workflows/retry.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-59">.github/workflows/saltbox-os.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-60">.github/workflows/saltbox.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-61">.gitignore</a><span class="badge modified">modified</span></li>
                <li><a href="#file-62">README.md</a><span class="badge modified">modified</span></li>
                <li><a href="#file-63">ansible.cfg</a><span class="badge modified">modified</span></li>
                <li><a href="#file-64">filter_plugins/rclone_filters.py</a><span class="badge modified">modified</span></li>
                <li><a href="#file-65">inventories/group_vars/all.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-66">library/find_open_port.py</a><span class="badge modified">modified</span></li>
                <li><a href="#file-67">library/migrate_folder.py</a><span class="badge modified">modified</span></li>
                <li><a href="#file-68">library/qbittorrent_passwd.py</a><span class="badge modified">modified</span></li>
                <li><a href="#file-69">library/saltbox_facts.py</a><span class="badge modified">modified</span></li>
                <li><a href="#file-70">requirements/requirements-saltbox.txt</a><span class="badge modified">modified</span></li>
                <li><a href="#file-71">resources/roles/dns/defaults/main.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-72">resources/roles/dns/tasks/cloudflare/main.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-73">resources/roles/dns/tasks/cloudflare/subtasks/add_dns_record.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-74">resources/roles/dns/tasks/cloudflare/subtasks/add_dns_record/ipv4_enabled.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-75">resources/roles/dns/tasks/cloudflare/subtasks/add_dns_record/ipv6_enabled.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-76">resources/roles/dns/tasks/cloudflare/subtasks/remove_dns_record.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-77">resources/tasks/directories/create_directories.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-78">resources/tasks/dns/tasker2.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-79">resources/tasks/docker/create_docker_container.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-80">resources/tasks/docker/network_container_health_status.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-81">resources/tasks/docker/remove_docker_container.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-82">resources/tasks/docker/restart_docker_container.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-83">resources/tasks/docker/set_docker_devices_variable.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-84">resources/tasks/docker/start_docker_container.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-85">resources/tasks/docker/start_saltbox_docker_containers.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-86">resources/tasks/docker/stop_docker_container.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-87">resources/tasks/docker/stop_saltbox_docker_containers.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-88">resources/tasks/git/clone_git_repo.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-89">resources/tasks/instances/get_info.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-90">resources/tasks/instances/lidarr.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-91">resources/tasks/instances/overseerr.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-92">resources/tasks/instances/plex.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-93">resources/tasks/instances/radarr.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-94">resources/tasks/instances/sonarr.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-95">resources/tasks/systemd/delete_service.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-96">resources/tasks/systemd/disable_service.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-97">resources/tasks/systemd/stop_service.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-98">resources/tasks/systemd/update_service_credentials.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-99">roles/arr_db/defaults/main.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-100">roles/arr_db/tasks/arr.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-101">roles/arr_db/tasks/main.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-102">roles/arr_db/tasks/tautulli.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-103">roles/asshama/tasks/subtasks/loop.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-104">roles/authelia/defaults/main.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-105">roles/authelia/tasks/main.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-106">roles/authelia/tasks/subtasks/auth_backend.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-107">roles/authelia/tasks/subtasks/file_backend.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-108">roles/authelia/tasks/subtasks/ldap_backend.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-109">roles/authelia/tasks/subtasks/settings.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-110">roles/authelia/templates/configuration.yml.j2</a><span class="badge modified">modified</span></li>
                <li><a href="#file-111">roles/authentik/defaults/main.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-112">roles/authentik/tasks/main.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-113">roles/authentik/tasks/subtasks/setup.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-114">roles/authentik_worker/defaults/main.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-115">roles/autobrr/defaults/main.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-116">roles/autobrr/tasks/main.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-117">roles/autoheal/defaults/main.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-118">roles/autoscan/defaults/main.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-119">roles/autoscan/tasks/main2.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-120">roles/autoscan/tasks/subtasks/settings.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-121">roles/autoscan/templates/config.yml.j2</a><span class="badge modified">modified</span></li>
                <li><a href="#file-122">roles/backup/defaults/main.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-123">roles/backup/tasks/main.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-124">roles/backup/tasks/restore_service.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-125">roles/backup/tasks/sanity_check.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-126">roles/backup/tasks/snapshot.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-127">roles/backup2/tasks/main.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-128">roles/backup2/tasks/restore_service.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-129">roles/backup2/tasks/sanity_check.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-130">roles/backup2/tasks/snapshot.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-131">roles/backup2/tasks/upload.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-132">roles/bazarr/defaults/main.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-133">roles/bazarr/tasks/main2.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-134">roles/btop/tasks/main.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-135">roles/btrfsmaintenance/tasks/main.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-136">roles/cadvisor/defaults/main.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-137">roles/cadvisor/tasks/main.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-138">roles/cloudflare/tasks/main.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-139">roles/cloudflare/tasks/subtasks/configuration_rules.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-140">roles/cloudflare/tasks/subtasks/configuration_rules/add_configuration_rule.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-141">roles/cloudflare/tasks/subtasks/purge_cache.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-142">roles/cloudflare/tasks/subtasks/subdomains.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-143">roles/cloudflare/tasks/subtasks/subdomains/add_subdomain.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-144">roles/cloudflare/tasks/subtasks/subdomains/remove_subdomain.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-145">roles/cloudflare/tasks/subtasks/variables.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-146">roles/cloudflare/tasks/subtasks/zone.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-147">roles/cloudplow/defaults/main.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-148">roles/cloudplow/tasks/main.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-149">roles/cloudplow/tasks/subtasks/settings.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-150">roles/cloudplow/templates/config.json.j2</a><span class="badge modified">modified</span></li>
                <li><a href="#file-151">roles/common/tasks/main.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-152">roles/crowdsec/tasks/main.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-153">roles/crowdsec/templates/acquis.yaml.j2</a><span class="badge modified">modified</span></li>
                <li><a href="#file-154">roles/custom/tasks/main.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-155">roles/ddclient/tasks/main.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-156">roles/ddns/defaults/main.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-157">roles/ddns/tasks/main.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-158">roles/deluge/defaults/main.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-159">roles/deluge/tasks/main2.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-160">roles/deluge/tasks/subtasks/post-install/main.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-161">roles/deluge/tasks/subtasks/post-install/settings/main.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-162">roles/deluge/tasks/subtasks/pre-install/main.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-163">roles/diag/defaults/main.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-164">roles/diag/tasks/main.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-165">roles/diun/defaults/main.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-166">roles/diun/tasks/main.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-167">roles/docker/defaults/main.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-168">roles/docker/tasks/main.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-169">roles/docker/tasks/subtasks/binary/binary.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-170">roles/docker/tasks/subtasks/binary/binary2.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-171">roles/docker/tasks/subtasks/btrfs/pseudo_file_system.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-172">roles/docker/tasks/subtasks/controller.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-173">roles/docker/tasks/subtasks/dns.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-174">roles/docker/templates/docker-controller-helper.service.j2</a><span class="badge modified">modified</span></li>
                <li><a href="#file-175">roles/docker/templates/docker-controller.service.j2</a><span class="badge modified">modified</span></li>
                <li><a href="#file-176">roles/docker/templates/docker-update-hosts.service.j2</a><span class="badge modified">modified</span></li>
                <li><a href="#file-177">roles/docker_socket_proxy/defaults/main.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-178">roles/docker_socket_proxy/tasks/main.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-179">roles/dozzle/defaults/main.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-180">roles/dozzle/tasks/main.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-181">roles/emby/defaults/main.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-182">roles/emby/tasks/main2.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-183">roles/emby/tasks/subtasks/post-install.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-184">roles/emby/tasks/subtasks/settings.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-185">roles/error_pages/defaults/main.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-186">roles/error_pages/tasks/main.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-187">roles/glances/tasks/main.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-188">roles/gluetun/defaults/main.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-189">roles/gluetun/tasks/main.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-190">roles/gluetun/tasks/main2.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-191">roles/grafana/defaults/main.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-192">roles/grafana/tasks/main.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-193">roles/hetzner/tasks/main.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-194">roles/hetzner/tasks/subtasks/hetzner.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-195">roles/hetzner_nfs/tasks/hetzner_nfs_mount.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-196">roles/hetzner_nfs/tasks/hetzner_nfs_server.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-197">roles/hetzner_nfs/tasks/hetzner_nfs_server_uninstall.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-198">roles/hetzner_nfs/tasks/hetzner_nfs_unmount.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-199">roles/hetzner_nfs/tasks/services_stop.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-200">roles/hetzner_nfs/templates/client/init_vlan.sh.j2</a><span class="badge modified">modified</span></li>
                <li><a href="#file-201">roles/hetzner_nfs/templates/client/nfs_vlan.service.j2</a><span class="badge modified">modified</span></li>
                <li><a href="#file-202">roles/hetzner_nfs/templates/server/init_vlan.sh.j2</a><span class="badge modified">modified</span></li>
                <li><a href="#file-203">roles/hetzner_nfs/templates/server/nfs_vlan.service.j2</a><span class="badge modified">modified</span></li>
                <li><a href="#file-204">roles/hetzner_vlan/tasks/main.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-205">roles/jackett/defaults/main.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-206">roles/jackett/tasks/main.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-207">roles/jellyfin/defaults/main.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-208">roles/jellyfin/tasks/main2.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-209">roles/jellyfin/tasks/subtasks/postinstall.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-210">roles/jellyfin/tasks/subtasks/preinstall.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-211">roles/jellyfin/tasks/subtasks/settings.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-212">roles/kernel/tasks/main.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-213">roles/kernel/tasks/subtasks/02_cron.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-214">roles/kernel/tasks/subtasks/03_update_focal.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-215">roles/kernel/tasks/subtasks/04_update_jammy.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-216">roles/kernel/tasks/subtasks/05_update_noble.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-217">roles/lidarr/defaults/main.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-218">roles/lidarr/tasks/main2.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-219">roles/lidarr/tasks/subtasks/auth.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-220">roles/lldap/defaults/main.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-221">roles/lldap/tasks/main.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-222">roles/lldap/templates/lldap_config.toml.j2</a><span class="badge modified">modified</span></li>
                <li><a href="#file-223">roles/mainline/tasks/main.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-224">roles/mariadb/defaults/main.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-225">roles/mariadb/tasks/post-migration.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-226">roles/mariadb/tasks/pre-migration.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-227">roles/mongodb/defaults/main.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-228">roles/motd/defaults/main.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-229">roles/motd/tasks/cli_motd.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-230">roles/motd/tasks/main.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-231">roles/motd/tasks/python_motd.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-232">roles/motd/templates/motd.yml.j2</a><span class="badge modified">modified</span></li>
                <li><a href="#file-233">roles/mount_templates/tasks/main.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-234">roles/netdata/defaults/main.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-235">roles/netdata/tasks/main.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-236">roles/netdata/tasks/subtasks/settings.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-237">roles/nginx/defaults/main.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-238">roles/nginx/tasks/main2.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-239">roles/node_exporter/defaults/main.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-240">roles/notify/tasks/main.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-241">roles/nvidia/defaults/main.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-242">roles/nvidia/tasks/main.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-243">roles/nvidia/tasks/subtasks/driver.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-244">roles/nvidia/tasks/subtasks/nvtop.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-245">roles/nzbget/defaults/main.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-246">roles/nzbget/tasks/main.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-247">roles/nzbget/tasks/subtasks/post-install/main.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-248">roles/nzbget/tasks/subtasks/post-install/scripts/main.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-249">roles/nzbget/tasks/subtasks/post-install/settings/main.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-250">roles/nzbhydra2/defaults/main.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-251">roles/nzbhydra2/tasks/main.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-252">roles/nzbhydra2/tasks/subtasks/post-install/main.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-253">roles/nzbhydra2/tasks/subtasks/post-install/sabnzbd.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-254">roles/nzbhydra2/tasks/subtasks/post-install/settings.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-255">roles/nzbthrottle/defaults/main.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-256">roles/nzbthrottle/tasks/subtasks/pre-install.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-257">roles/nzbthrottle/templates/config.json.j2</a><span class="badge modified">modified</span></li>
                <li><a href="#file-258">roles/organizr/defaults/main.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-259">roles/organizr/tasks/main.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-260">roles/overseerr/defaults/main.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-261">roles/overseerr/tasks/main2.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-262">roles/permissions/tasks/main.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-263">roles/petio/defaults/main.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-264">roles/petio/tasks/main.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-265">roles/plex/defaults/main.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-266">roles/plex/tasks/main.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-267">roles/plex/tasks/main2.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-268">roles/plex/tasks/subtasks/preferences/claim_server.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-269">roles/plex/tasks/subtasks/preferences/preferences.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-270">roles/plex_auth_token/defaults/main.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-271">roles/plex_auth_token/tasks/main.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-272">roles/plex_db/defaults/main.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-273">roles/plex_db/tasks/main.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-274">roles/plex_db/tasks/main2.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-275">roles/plex_extra_tasks/defaults/main.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-276">roles/plex_extra_tasks/tasks/main.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-277">roles/plex_extra_tasks/tasks/main2.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-278">roles/plex_fix_futures/tasks/main2.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-279">roles/portainer/defaults/main.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-280">roles/portainer/tasks/main.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-281">roles/portainer/tasks/subtasks/setup.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-282">roles/postgres/defaults/main.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-283">roles/postgres/tasks/main2.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-284">roles/pre_tasks/tasks/main.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-285">roles/pre_tasks/tasks/subtasks/git.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-286">roles/pre_tasks/tasks/subtasks/variables.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-287">roles/prometheus/defaults/main.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-288">roles/prometheus/tasks/main.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-289">roles/prometheus/templates/prometheus.yml.j2</a><span class="badge modified">modified</span></li>
                <li><a href="#file-290">roles/prowlarr/defaults/main.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-291">roles/prowlarr/tasks/main.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-292">roles/prowlarr/tasks/subtasks/auth.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-293">roles/python/tasks/main.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-294">roles/qbittorrent/defaults/main.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-295">roles/qbittorrent/tasks/main2.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-296">roles/qbittorrent/tasks/subtasks/post-install/main.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-297">roles/qbittorrent/tasks/subtasks/post-install/settings/main.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-298">roles/qbittorrent/tasks/subtasks/pre-install/main.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-299">roles/qbittorrent/templates/qbittorrent.service.j2</a><span class="badge modified">modified</span></li>
                <li><a href="#file-300">roles/qbittorrent/templates/qbittorrent.yml.j2</a><span class="badge modified">modified</span></li>
                <li><a href="#file-301">roles/radarr/defaults/main.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-302">roles/radarr/tasks/main2.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-303">roles/radarr/tasks/subtasks/auth.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-304">roles/rclone/tasks/main.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-305">roles/rclone/tasks/subtasks/01_build_url.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-306">roles/rclone/tasks/subtasks/02_install_binary.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-307">roles/redis/defaults/main.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-308">roles/redis/tasks/main2.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-309">roles/remote/tasks/cleanup.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-310">roles/remote/tasks/main.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-311">roles/remote/tasks/nfs.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-312">roles/remote/tasks/remote.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-313">roles/remote/templates/dropbox.j2</a><span class="badge modified">modified</span></li>
                <li><a href="#file-314">roles/remote/templates/google.j2</a><span class="badge modified">modified</span></li>
                <li><a href="#file-315">roles/remote/templates/sftp.j2</a><span class="badge modified">modified</span></li>
                <li><a href="#file-316">roles/restore/tasks/main.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-317">roles/restore/tasks/permissions.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-318">roles/restore/tasks/restore_remote.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-319">roles/restore/tasks/restore_tar.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-320">roles/rutorrent/defaults/main.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-321">roles/rutorrent/tasks/main.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-322">roles/rutorrent/tasks/subtasks/post-install/main.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-323">roles/rutorrent/tasks/subtasks/post-install/settings/main.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-324">roles/rutorrent/tasks/subtasks/post-install/settings/new_installs.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-325">roles/rutorrent/tasks/subtasks/pre-install/existing_installs.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-326">roles/rutorrent/tasks/subtasks/pre-install/main.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-327">roles/rutorrent/templates/diskspace_conf.php.j2</a><span class="badge modified">modified</span></li>
                <li><a href="#file-328">roles/sabnzbd/defaults/main.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-329">roles/sabnzbd/tasks/main.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-330">roles/sabnzbd/tasks/subtasks/post-install/main.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-331">roles/sabnzbd/tasks/subtasks/post-install/settings.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-332">roles/sabnzbd/tasks/subtasks/post-install/web.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-333">roles/saltbox_mod/tasks/main.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-334">roles/sandbox/tasks/main.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-335">roles/sanity_check/tasks/main.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-336">roles/sanity_check/tasks/subtasks/01_system.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-337">roles/sanity_check/tasks/subtasks/03_python_version.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-338">roles/sanity_check/tasks/subtasks/05_backup.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-339">roles/scripts/tasks/main.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-340">roles/scripts/templates/download_torrents_from_rclone_remote.sh.j2</a><span class="badge modified">modified</span></li>
                <li><a href="#file-341">roles/scripts/templates/sync_torrents_to_rclone_remote.sh.j2</a><span class="badge modified">modified</span></li>
                <li><a href="#file-342">roles/scrutiny/defaults/main.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-343">roles/scrutiny/tasks/main.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-344">roles/shell/defaults/main.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-345">roles/shell/tasks/subtasks/misc.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-346">roles/shell/tasks/subtasks/shell/zsh.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-347">roles/shell/tasks/subtasks/z.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-348">roles/sonarr/defaults/main.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-349">roles/sonarr/tasks/main2.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-350">roles/sonarr/tasks/subtasks/auth.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-351">roles/system/tasks/main.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-352">roles/system/tasks/subtasks/apt.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-353">roles/system/tasks/subtasks/cpufrequency.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-354">roles/system/tasks/subtasks/locale.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-355">roles/system/tasks/subtasks/logrotate.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-356">roles/system/tasks/subtasks/mounts.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-357">roles/system/tasks/subtasks/network.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-358">roles/system/tasks/subtasks/timezone.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-359">roles/tautulli/defaults/main.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-360">roles/tautulli/tasks/main2.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-361">roles/traefik/defaults/main.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-362">roles/traefik/tasks/main.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-363">roles/traefik/tasks/subtasks/config.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-364">roles/traefik/tasks/subtasks/crowdsec.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-365">roles/traefik/tasks/subtasks/zerossl.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-366">roles/traefik_template/defaults/main.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-367">roles/traefik_template/tasks/main.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-368">roles/transfer/defaults/main.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-369">roles/transfer/tasks/main.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-370">roles/unionfs/defaults/main.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-371">roles/unionfs/tasks/main.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-372">roles/unionfs/tasks/subtasks/docker/containers_start.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-373">roles/unionfs/tasks/subtasks/docker/containers_stop.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-374">roles/unionfs/tasks/subtasks/mergerfs.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-375">roles/unionfs/tasks/subtasks/mount_path.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-376">roles/unpackerr/defaults/main.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-377">roles/unpackerr/tasks/main.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-378">roles/unpackerr/tasks/subtasks/settings.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-379">roles/unpackerr/templates/unpackerr.conf.j2</a><span class="badge modified">modified</span></li>
                <li><a href="#file-380">roles/user/tasks/main.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-381">roles/user/tasks/subtasks/user_account.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-382">roles/whisparr/defaults/main.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-383">roles/whisparr/tasks/main2.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-384">roles/whisparr/tasks/subtasks/auth.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-385">roles/yyq/tasks/main.yml</a><span class="badge modified">modified</span></li>
                <li><a href="#file-386">saltbox.yml</a><span class="badge modified">modified</span></li>
            </ul>
            <div style="margin-top: 0.75rem;">
                <button onclick="document.querySelectorAll('.file-section').forEach(s => s.classList.remove('collapsed'))" style="background: var(--bg-tertiary); border: 1px solid var(--border-color); color: var(--text-secondary); padding: 0.25rem 0.5rem; border-radius: 4px; cursor: pointer; font-size: 0.75rem; margin-right: 0.5rem;">Expand All</button>
                <button onclick="document.querySelectorAll('.file-section').forEach(s => s.classList.add('collapsed'))" style="background: var(--bg-tertiary); border: 1px solid var(--border-color); color: var(--text-secondary); padding: 0.25rem 0.5rem; border-radius: 4px; cursor: pointer; font-size: 0.75rem;">Collapse All</button>
            </div>
        </div>
        
        <main>
            <section class="file-section collapsed" id="file-0">
                <div class="file-header">
                    <span class="badge added">added</span>
                    <h3>library/cloudflare_dns_records.py</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line add">+ #!/usr/bin/python</span><span class="diff-line add">+ &quot;&quot;&quot;</span><span class="diff-line add">+ Ansible module for fetching Cloudflare DNS records.</span><span class="diff-line add">+ </span><span class="diff-line add">+ This module provides functionality to fetch DNS records from Cloudflare</span><span class="diff-line add">+ for a specific zone and record name.</span><span class="diff-line add">+ </span><span class="diff-line add">+ Example Usage:</span><span class="diff-line add">+     # Fetch DNS records for a domain</span><span class="diff-line add">+     - name: Fetch Cloudflare DNS records</span><span class="diff-line add">+       cloudflare_dns_records:</span><span class="diff-line add">+         auth_email: &quot;user@example.com&quot;</span><span class="diff-line add">+         auth_key: &quot;api_key_here&quot;</span><span class="diff-line add">+         zone_name: &quot;example.com&quot;</span><span class="diff-line add">+         record: &quot;subdomain.example.com&quot;</span><span class="diff-line add">+       register: dns_records</span><span class="diff-line add">+ </span><span class="diff-line add">+     # Fetch DNS records using API token (recommended)</span><span class="diff-line add">+     - name: Fetch Cloudflare DNS records with token</span><span class="diff-line add">+       cloudflare_dns_records:</span><span class="diff-line add">+         auth_token: &quot;token_here&quot;</span><span class="diff-line add">+         zone_name: &quot;example.com&quot;</span><span class="diff-line add">+         record: &quot;subdomain.example.com&quot;</span><span class="diff-line add">+       register: dns_records</span><span class="diff-line add">+ </span><span class="diff-line add">+ Return Values:</span><span class="diff-line add">+     records:</span><span class="diff-line add">+         description: List of DNS records matching the query</span><span class="diff-line add">+         type: list</span><span class="diff-line add">+         returned: success</span><span class="diff-line add">+     zone_id:</span><span class="diff-line add">+         description: The Cloudflare zone ID for the specified zone</span><span class="diff-line add">+         type: str</span><span class="diff-line add">+         returned: success</span><span class="diff-line add">+     changed:</span><span class="diff-line add">+         description: Whether any changes were made (always False for this read-only module)</span><span class="diff-line add">+         type: bool</span><span class="diff-line add">+         returned: always</span><span class="diff-line add">+ &quot;&quot;&quot;</span><span class="diff-line add">+ </span><span class="diff-line add">+ from __future__ import annotations</span><span class="diff-line add">+ </span><span class="diff-line add">+ from typing import TYPE_CHECKING</span><span class="diff-line add">+ </span><span class="diff-line add">+ from ansible.module_utils.basic import AnsibleModule</span><span class="diff-line add">+ </span><span class="diff-line add">+ if TYPE_CHECKING:</span><span class="diff-line add">+     from cloudflare import Cloudflare</span><span class="diff-line add">+ </span><span class="diff-line add">+ DOCUMENTATION = &quot;&quot;&quot;</span><span class="diff-line add">+ ---</span><span class="diff-line add">+ module: cloudflare_dns_records</span><span class="diff-line add">+ short_description: Fetch DNS records from Cloudflare</span><span class="diff-line add">+ description:</span><span class="diff-line add">+     - &quot;This module fetches DNS records from Cloudflare for a specific zone and record name.&quot;</span><span class="diff-line add">+     - &quot;It supports both API key and API token authentication methods.&quot;</span><span class="diff-line add">+ options:</span><span class="diff-line add">+     auth_email:</span><span class="diff-line add">+         description:</span><span class="diff-line add">+             - Email associated with Cloudflare account</span><span class="diff-line add">+             - Required when using auth_key authentication</span><span class="diff-line add">+         required: false</span><span class="diff-line add">+         type: str</span><span class="diff-line add">+     auth_key:</span><span class="diff-line add">+         description:</span><span class="diff-line add">+             - API key for Cloudflare</span><span class="diff-line add">+             - Required when using auth_key authentication</span><span class="diff-line add">+         required: false</span><span class="diff-line add">+         type: str</span><span class="diff-line add">+     auth_token:</span><span class="diff-line add">+         description:</span><span class="diff-line add">+             - API token for Cloudflare (recommended over auth_key)</span><span class="diff-line add">+             - Can be used instead of auth_email and auth_key</span><span class="diff-line add">+         required: false</span><span class="diff-line add">+         type: str</span><span class="diff-line add">+     zone_name:</span><span class="diff-line add">+         description:</span><span class="diff-line add">+             - Name of the Cloudflare zone (e.g., example.com)</span><span class="diff-line add">+         required: true</span><span class="diff-line add">+         type: str</span><span class="diff-line add">+     record:</span><span class="diff-line add">+         description:</span><span class="diff-line add">+             - DNS record name to fetch (e.g., subdomain.example.com)</span><span class="diff-line add">+         required: true</span><span class="diff-line add">+         type: str</span><span class="diff-line add">+ &quot;&quot;&quot;</span><span class="diff-line add">+ </span><span class="diff-line add">+ EXAMPLES = &quot;&quot;&quot;</span><span class="diff-line add">+ # Fetch DNS records using API key</span><span class="diff-line add">+ - name: Fetch Cloudflare DNS records with API key</span><span class="diff-line add">+   cloudflare_dns_records:</span><span class="diff-line add">+     auth_email: &quot;user@example.com&quot;</span><span class="diff-line add">+     auth_key: &quot;{{ cloudflare_api_key }}&quot;</span><span class="diff-line add">+     zone_name: &quot;example.com&quot;</span><span class="diff-line add">+     record: &quot;app.example.com&quot;</span><span class="diff-line add">+   register: dns_records</span><span class="diff-line add">+ </span><span class="diff-line add">+ # Fetch DNS records using API token (recommended)</span><span class="diff-line add">+ - name: Fetch Cloudflare DNS records with token</span><span class="diff-line add">+   cloudflare_dns_records:</span><span class="diff-line add">+     auth_token: &quot;{{ cloudflare_api_token }}&quot;</span><span class="diff-line add">+     zone_name: &quot;example.com&quot;</span><span class="diff-line add">+     record: &quot;app.example.com&quot;</span><span class="diff-line add">+   register: dns_records</span><span class="diff-line add">+ </span><span class="diff-line add">+ # Access the records</span><span class="diff-line add">+ - name: Display records</span><span class="diff-line add">+   debug:</span><span class="diff-line add">+     var: dns_records.records</span><span class="diff-line add">+ &quot;&quot;&quot;</span><span class="diff-line add">+ </span><span class="diff-line add">+ </span><span class="diff-line add">+ def get_zone_id(client: Cloudflare, zone_name: str, module: AnsibleModule) -&gt; str:</span><span class="diff-line add">+     &quot;&quot;&quot;</span><span class="diff-line add">+     Fetch the zone ID for a given zone name from Cloudflare.</span><span class="diff-line add">+ </span><span class="diff-line add">+     Args:</span><span class="diff-line add">+         client: Cloudflare client instance</span><span class="diff-line add">+         zone_name (str): Name of the zone to look up</span><span class="diff-line add">+         module: AnsibleModule instance for error reporting</span><span class="diff-line add">+ </span><span class="diff-line add">+     Returns:</span><span class="diff-line add">+         str: The zone ID</span><span class="diff-line add">+ </span><span class="diff-line add">+     Raises:</span><span class="diff-line add">+         Calls module.fail_json on error</span><span class="diff-line add">+     &quot;&quot;&quot;</span><span class="diff-line add">+     try:</span><span class="diff-line add">+         zone = client.zones.list(name=zone_name)</span><span class="diff-line add">+         if len(zone.result) == 0:</span><span class="diff-line add">+             module.fail_json(msg=f&quot;Specified zone &#x27;{zone_name}&#x27; was not found&quot;)</span><span class="diff-line add">+         return zone.result[0].id</span><span class="diff-line add">+     except Exception as e:</span><span class="diff-line add">+         module.fail_json(msg=f&quot;Error fetching zone ID: {str(e)}&quot;)</span><span class="diff-line add">+ </span><span class="diff-line add">+ </span><span class="diff-line add">+ def fetch_dns_records(client: Cloudflare, zone_id: str, record_name: str, module: AnsibleModule) -&gt; list[dict[str, object]]:</span><span class="diff-line add">+     &quot;&quot;&quot;</span><span class="diff-line add">+     Fetch DNS records from Cloudflare.</span><span class="diff-line add">+ </span><span class="diff-line add">+     Args:</span><span class="diff-line add">+         client: Cloudflare client instance</span><span class="diff-line add">+         zone_id (str): The Cloudflare zone ID</span><span class="diff-line add">+         record_name (str): The DNS record name to fetch</span><span class="diff-line add">+         module: AnsibleModule instance for error reporting</span><span class="diff-line add">+ </span><span class="diff-line add">+     Returns:</span><span class="diff-line add">+         list: List of DNS records</span><span class="diff-line add">+ </span><span class="diff-line add">+     Raises:</span><span class="diff-line add">+         Calls module.fail_json on error</span><span class="diff-line add">+     &quot;&quot;&quot;</span><span class="diff-line add">+     try:</span><span class="diff-line add">+         records_response = client.dns.records.list(zone_id=zone_id, name={&quot;exact&quot;: record_name})</span><span class="diff-line add">+         if records_response is None:</span><span class="diff-line add">+             module.fail_json(msg=&quot;No response from Cloudflare API&quot;)</span><span class="diff-line add">+ </span><span class="diff-line add">+         records = records_response.to_dict()</span><span class="diff-line add">+         results = records.get(&quot;result&quot;, [])</span><span class="diff-line add">+         if not isinstance(results, list):</span><span class="diff-line add">+             module.fail_json(msg=&quot;Unexpected response format from Cloudflare API&quot;)</span><span class="diff-line add">+         return results</span><span class="diff-line add">+     except Exception as e:</span><span class="diff-line add">+         module.fail_json(msg=f&quot;Error fetching DNS records: {str(e)}&quot;)</span><span class="diff-line add">+ </span><span class="diff-line add">+ </span><span class="diff-line add">+ def run_module() -&gt; None:</span><span class="diff-line add">+     &quot;&quot;&quot;</span><span class="diff-line add">+     Main module execution.</span><span class="diff-line add">+ </span><span class="diff-line add">+     This function handles the module&#x27;s argument parsing, execution flow,</span><span class="diff-line add">+     and return value preparation.</span><span class="diff-line add">+     &quot;&quot;&quot;</span><span class="diff-line add">+     module_args = dict(</span><span class="diff-line add">+         auth_email=dict(type=&#x27;str&#x27;, required=False, no_log=False),</span><span class="diff-line add">+         auth_key=dict(type=&#x27;str&#x27;, required=False, no_log=True),</span><span class="diff-line add">+         auth_token=dict(type=&#x27;str&#x27;, required=False, no_log=True),</span><span class="diff-line add">+         zone_name=dict(type=&#x27;str&#x27;, required=True),</span><span class="diff-line add">+         record=dict(type=&#x27;str&#x27;, required=True),</span><span class="diff-line add">+     )</span><span class="diff-line add">+ </span><span class="diff-line add">+     result: dict[str, bool | str | list[dict[str, object]]] = {</span><span class="diff-line add">+         &#x27;changed&#x27;: False,</span><span class="diff-line add">+         &#x27;records&#x27;: [],</span><span class="diff-line add">+         &#x27;zone_id&#x27;: &#x27;&#x27;,</span><span class="diff-line add">+     }</span><span class="diff-line add">+ </span><span class="diff-line add">+     module = AnsibleModule(</span><span class="diff-line add">+         argument_spec=module_args,</span><span class="diff-line add">+         supports_check_mode=True,</span><span class="diff-line add">+         required_one_of=[</span><span class="diff-line add">+             [&#x27;auth_token&#x27;, &#x27;auth_key&#x27;]</span><span class="diff-line add">+         ],</span><span class="diff-line add">+         required_together=[</span><span class="diff-line add">+             [&#x27;auth_email&#x27;, &#x27;auth_key&#x27;]</span><span class="diff-line add">+         ],</span><span class="diff-line add">+     )</span><span class="diff-line add">+ </span><span class="diff-line add">+     try:</span><span class="diff-line add">+         # Import cloudflare here to provide better error message if not installed</span><span class="diff-line add">+         try:</span><span class="diff-line add">+             from cloudflare import Cloudflare</span><span class="diff-line add">+         except ImportError:</span><span class="diff-line add">+             module.fail_json(msg=&quot;The &#x27;cloudflare&#x27; Python library is required. Install it with: pip install cloudflare&quot;)</span><span class="diff-line add">+ </span><span class="diff-line add">+         auth_email = module.params.get(&#x27;auth_email&#x27;)</span><span class="diff-line add">+         auth_key = module.params.get(&#x27;auth_key&#x27;)</span><span class="diff-line add">+         auth_token = module.params.get(&#x27;auth_token&#x27;)</span><span class="diff-line add">+         zone_name = module.params[&#x27;zone_name&#x27;]</span><span class="diff-line add">+         record = module.params[&#x27;record&#x27;]</span><span class="diff-line add">+ </span><span class="diff-line add">+         # Initialize Cloudflare client</span><span class="diff-line add">+         if auth_token:</span><span class="diff-line add">+             cf = Cloudflare(api_token=auth_token)</span><span class="diff-line add">+         else:</span><span class="diff-line add">+             cf = Cloudflare(api_email=auth_email, api_key=auth_key)</span><span class="diff-line add">+ </span><span class="diff-line add">+         # Fetch zone ID</span><span class="diff-line add">+         zone_id = get_zone_id(cf, zone_name, module)</span><span class="diff-line add">+         result[&#x27;zone_id&#x27;] = zone_id</span><span class="diff-line add">+ </span><span class="diff-line add">+         # Fetch DNS records</span><span class="diff-line add">+         records = fetch_dns_records(cf, zone_id, record, module)</span><span class="diff-line add">+         result[&#x27;records&#x27;] = records</span><span class="diff-line add">+ </span><span class="diff-line add">+         module.exit_json(**result)</span><span class="diff-line add">+ </span><span class="diff-line add">+     except Exception as e:</span><span class="diff-line add">+         module.fail_json(msg=f&quot;Unexpected error: {str(e)}&quot;)</span><span class="diff-line add">+ </span><span class="diff-line add">+ </span><span class="diff-line add">+ def main() -&gt; None:</span><span class="diff-line add">+     &quot;&quot;&quot;</span><span class="diff-line add">+     Module entry point.</span><span class="diff-line add">+     &quot;&quot;&quot;</span><span class="diff-line add">+     run_module()</span><span class="diff-line add">+ </span><span class="diff-line add">+ </span><span class="diff-line add">+ if __name__ == &#x27;__main__&#x27;:</span><span class="diff-line add">+     main()</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-1">
                <div class="file-header">
                    <span class="badge added">added</span>
                    <h3>library/cloudflare_ssl.py</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line add">+ #!/usr/bin/python</span><span class="diff-line add">+ &quot;&quot;&quot;</span><span class="diff-line add">+ Ansible module for retrieving Cloudflare SSL/TLS encryption mode.</span><span class="diff-line add">+ </span><span class="diff-line add">+ This module provides functionality to get the SSL/TLS encryption mode</span><span class="diff-line add">+ for a specific Cloudflare zone. It can automatically parse domain names</span><span class="diff-line add">+ to extract the zone using the tld library.</span><span class="diff-line add">+ </span><span class="diff-line add">+ Example Usage:</span><span class="diff-line add">+     # Get SSL/TLS mode for a zone (automatically parses domain)</span><span class="diff-line add">+     - name: Get Cloudflare SSL mode</span><span class="diff-line add">+       cloudflare_ssl:</span><span class="diff-line add">+         auth_email: &quot;user@example.com&quot;</span><span class="diff-line add">+         auth_key: &quot;api_key_here&quot;</span><span class="diff-line add">+         domain: &quot;subdomain.example.com&quot;</span><span class="diff-line add">+       register: ssl_mode</span><span class="diff-line add">+ </span><span class="diff-line add">+     # Get SSL/TLS mode with explicit zone name</span><span class="diff-line add">+     - name: Get Cloudflare SSL mode with zone</span><span class="diff-line add">+       cloudflare_ssl:</span><span class="diff-line add">+         auth_token: &quot;token_here&quot;</span><span class="diff-line add">+         zone_name: &quot;example.com&quot;</span><span class="diff-line add">+       register: ssl_mode</span><span class="diff-line add">+ </span><span class="diff-line add">+ Return Values:</span><span class="diff-line add">+     ssl_mode:</span><span class="diff-line add">+         description: The SSL/TLS encryption mode for the zone</span><span class="diff-line add">+         type: str</span><span class="diff-line add">+         returned: success</span><span class="diff-line add">+         sample: &#x27;full&#x27;</span><span class="diff-line add">+     zone_id:</span><span class="diff-line add">+         description: The Cloudflare zone ID for the specified zone</span><span class="diff-line add">+         type: str</span><span class="diff-line add">+         returned: success</span><span class="diff-line add">+     zone_name:</span><span class="diff-line add">+         description: The zone name that was queried</span><span class="diff-line add">+         type: str</span><span class="diff-line add">+         returned: success</span><span class="diff-line add">+     changed:</span><span class="diff-line add">+         description: Whether any changes were made (always False for this read-only module)</span><span class="diff-line add">+         type: bool</span><span class="diff-line add">+         returned: always</span><span class="diff-line add">+ &quot;&quot;&quot;</span><span class="diff-line add">+ </span><span class="diff-line add">+ from __future__ import annotations</span><span class="diff-line add">+ </span><span class="diff-line add">+ from typing import TYPE_CHECKING</span><span class="diff-line add">+ </span><span class="diff-line add">+ from ansible.module_utils.basic import AnsibleModule</span><span class="diff-line add">+ </span><span class="diff-line add">+ if TYPE_CHECKING:</span><span class="diff-line add">+     from cloudflare import Cloudflare</span><span class="diff-line add">+ </span><span class="diff-line add">+ DOCUMENTATION = &quot;&quot;&quot;</span><span class="diff-line add">+ ---</span><span class="diff-line add">+ module: cloudflare_ssl</span><span class="diff-line add">+ short_description: Retrieve Cloudflare SSL/TLS encryption mode for a zone</span><span class="diff-line add">+ description:</span><span class="diff-line add">+     - &quot;This module retrieves the SSL/TLS encryption mode for a specific Cloudflare zone.&quot;</span><span class="diff-line add">+     - &quot;It supports both API key and API token authentication methods.&quot;</span><span class="diff-line add">+     - &quot;Can automatically extract the zone from a domain using the tld library.&quot;</span><span class="diff-line add">+ options:</span><span class="diff-line add">+     auth_email:</span><span class="diff-line add">+         description:</span><span class="diff-line add">+             - Email associated with Cloudflare account</span><span class="diff-line add">+             - Required when using auth_key authentication</span><span class="diff-line add">+         required: false</span><span class="diff-line add">+         type: str</span><span class="diff-line add">+     auth_key:</span><span class="diff-line add">+         description:</span><span class="diff-line add">+             - API key for Cloudflare</span><span class="diff-line add">+             - Required when using auth_key authentication</span><span class="diff-line add">+         required: false</span><span class="diff-line add">+         type: str</span><span class="diff-line add">+     auth_token:</span><span class="diff-line add">+         description:</span><span class="diff-line add">+             - API token for Cloudflare (recommended over auth_key)</span><span class="diff-line add">+             - Can be used instead of auth_email and auth_key</span><span class="diff-line add">+         required: false</span><span class="diff-line add">+         type: str</span><span class="diff-line add">+     domain:</span><span class="diff-line add">+         description:</span><span class="diff-line add">+             - Domain name to parse and extract zone from (e.g., subdomain.example.com)</span><span class="diff-line add">+             - Mutually exclusive with zone_name</span><span class="diff-line add">+         required: false</span><span class="diff-line add">+         type: str</span><span class="diff-line add">+     zone_name:</span><span class="diff-line add">+         description:</span><span class="diff-line add">+             - Name of the Cloudflare zone (e.g., example.com)</span><span class="diff-line add">+             - Mutually exclusive with domain</span><span class="diff-line add">+         required: false</span><span class="diff-line add">+         type: str</span><span class="diff-line add">+ &quot;&quot;&quot;</span><span class="diff-line add">+ </span><span class="diff-line add">+ EXAMPLES = &quot;&quot;&quot;</span><span class="diff-line add">+ # Get SSL/TLS mode using domain (automatically extracts zone)</span><span class="diff-line add">+ - name: Get Cloudflare SSL mode with domain</span><span class="diff-line add">+   cloudflare_ssl:</span><span class="diff-line add">+     auth_email: &quot;user@example.com&quot;</span><span class="diff-line add">+     auth_key: &quot;{{ cloudflare_api_key }}&quot;</span><span class="diff-line add">+     domain: &quot;{{ user.domain }}&quot;</span><span class="diff-line add">+   register: ssl_mode</span><span class="diff-line add">+ </span><span class="diff-line add">+ # Get SSL/TLS mode using explicit zone name</span><span class="diff-line add">+ - name: Get Cloudflare SSL mode with zone</span><span class="diff-line add">+   cloudflare_ssl:</span><span class="diff-line add">+     auth_token: &quot;{{ cloudflare_api_token }}&quot;</span><span class="diff-line add">+     zone_name: &quot;example.com&quot;</span><span class="diff-line add">+   register: ssl_mode</span><span class="diff-line add">+ </span><span class="diff-line add">+ # Display the SSL mode</span><span class="diff-line add">+ - name: Display SSL mode</span><span class="diff-line add">+   debug:</span><span class="diff-line add">+     msg: &quot;SSL/TLS mode: {{ ssl_mode.ssl_mode }}&quot;</span><span class="diff-line add">+ &quot;&quot;&quot;</span><span class="diff-line add">+ </span><span class="diff-line add">+ </span><span class="diff-line add">+ def get_zone_id(client: Cloudflare, zone_name: str, module: AnsibleModule) -&gt; str:</span><span class="diff-line add">+     &quot;&quot;&quot;</span><span class="diff-line add">+     Fetch the zone ID for a given zone name from Cloudflare.</span><span class="diff-line add">+ </span><span class="diff-line add">+     Args:</span><span class="diff-line add">+         client: Cloudflare client instance</span><span class="diff-line add">+         zone_name (str): Name of the zone to look up</span><span class="diff-line add">+         module: AnsibleModule instance for error reporting</span><span class="diff-line add">+ </span><span class="diff-line add">+     Returns:</span><span class="diff-line add">+         str: The zone ID</span><span class="diff-line add">+ </span><span class="diff-line add">+     Raises:</span><span class="diff-line add">+         Calls module.fail_json on error</span><span class="diff-line add">+     &quot;&quot;&quot;</span><span class="diff-line add">+     try:</span><span class="diff-line add">+         zone = client.zones.list(name=zone_name)</span><span class="diff-line add">+         if len(zone.result) == 0:</span><span class="diff-line add">+             module.fail_json(msg=f&quot;Specified zone &#x27;{zone_name}&#x27; was not found&quot;)</span><span class="diff-line add">+         return zone.result[0].id</span><span class="diff-line add">+     except Exception as e:</span><span class="diff-line add">+         module.fail_json(msg=f&quot;Error fetching zone ID: {str(e)}&quot;)</span><span class="diff-line add">+         raise # Unreachable - Pylance silencer</span><span class="diff-line add">+ </span><span class="diff-line add">+ </span><span class="diff-line add">+ def get_ssl_tls_mode(client: Cloudflare, zone_id: str, module: AnsibleModule) -&gt; str:</span><span class="diff-line add">+     &quot;&quot;&quot;</span><span class="diff-line add">+     Get the SSL/TLS settings for a zone.</span><span class="diff-line add">+ </span><span class="diff-line add">+     Args:</span><span class="diff-line add">+         client: Cloudflare client instance</span><span class="diff-line add">+         zone_id (str): The Cloudflare zone ID</span><span class="diff-line add">+         module: AnsibleModule instance for error reporting</span><span class="diff-line add">+ </span><span class="diff-line add">+     Returns:</span><span class="diff-line add">+         str: The SSL/TLS mode value</span><span class="diff-line add">+ </span><span class="diff-line add">+     Raises:</span><span class="diff-line add">+         Calls module.fail_json on error</span><span class="diff-line add">+     &quot;&quot;&quot;</span><span class="diff-line add">+     try:</span><span class="diff-line add">+         ssl_response = client.zones.settings.get(setting_id=&#x27;ssl&#x27;, zone_id=zone_id)</span><span class="diff-line add">+         if ssl_response is None:</span><span class="diff-line add">+             module.fail_json(msg=&quot;No response from Cloudflare API&quot;)</span><span class="diff-line add">+ </span><span class="diff-line add">+         ssl_settings = ssl_response.to_dict()</span><span class="diff-line add">+         ssl_mode = ssl_settings.get(&#x27;value&#x27;)</span><span class="diff-line add">+ </span><span class="diff-line add">+         if ssl_mode is None:</span><span class="diff-line add">+             module.fail_json(msg=&quot;SSL/TLS mode value not found in API response&quot;)</span><span class="diff-line add">+ </span><span class="diff-line add">+         return str(ssl_mode)</span><span class="diff-line add">+     except Exception as e:</span><span class="diff-line add">+         module.fail_json(msg=f&quot;Error fetching SSL/TLS settings: {str(e)}&quot;)</span><span class="diff-line add">+         raise # Unreachable - Pylance silencer</span><span class="diff-line add">+ </span><span class="diff-line add">+ </span><span class="diff-line add">+ def run_module() -&gt; None:</span><span class="diff-line add">+     &quot;&quot;&quot;</span><span class="diff-line add">+     Main module execution.</span><span class="diff-line add">+ </span><span class="diff-line add">+     This function handles the module&#x27;s argument parsing, execution flow,</span><span class="diff-line add">+     and return value preparation.</span><span class="diff-line add">+     &quot;&quot;&quot;</span><span class="diff-line add">+     module_args = dict(</span><span class="diff-line add">+         auth_email=dict(type=&#x27;str&#x27;, required=False, no_log=False),</span><span class="diff-line add">+         auth_key=dict(type=&#x27;str&#x27;, required=False, no_log=True),</span><span class="diff-line add">+         auth_token=dict(type=&#x27;str&#x27;, required=False, no_log=True),</span><span class="diff-line add">+         domain=dict(type=&#x27;str&#x27;, required=False),</span><span class="diff-line add">+         zone_name=dict(type=&#x27;str&#x27;, required=False),</span><span class="diff-line add">+     )</span><span class="diff-line add">+ </span><span class="diff-line add">+     result = dict(</span><span class="diff-line add">+         changed=False,</span><span class="diff-line add">+         ssl_mode=&#x27;&#x27;,</span><span class="diff-line add">+         zone_id=&#x27;&#x27;,</span><span class="diff-line add">+         zone_name=&#x27;&#x27;,</span><span class="diff-line add">+     )</span><span class="diff-line add">+ </span><span class="diff-line add">+     module = AnsibleModule(</span><span class="diff-line add">+         argument_spec=module_args,</span><span class="diff-line add">+         supports_check_mode=True,</span><span class="diff-line add">+         required_one_of=[</span><span class="diff-line add">+             [&#x27;auth_token&#x27;, &#x27;auth_key&#x27;],</span><span class="diff-line add">+             [&#x27;domain&#x27;, &#x27;zone_name&#x27;]</span><span class="diff-line add">+         ],</span><span class="diff-line add">+         required_together=[</span><span class="diff-line add">+             [&#x27;auth_email&#x27;, &#x27;auth_key&#x27;]</span><span class="diff-line add">+         ],</span><span class="diff-line add">+         mutually_exclusive=[</span><span class="diff-line add">+             [&#x27;domain&#x27;, &#x27;zone_name&#x27;]</span><span class="diff-line add">+         ],</span><span class="diff-line add">+     )</span><span class="diff-line add">+ </span><span class="diff-line add">+     try:</span><span class="diff-line add">+         # Import cloudflare here to provide better error message if not installed</span><span class="diff-line add">+         try:</span><span class="diff-line add">+             from cloudflare import Cloudflare</span><span class="diff-line add">+         except ImportError:</span><span class="diff-line add">+             module.fail_json(msg=&quot;The &#x27;cloudflare&#x27; Python library is required. Install it with: pip install cloudflare&quot;)</span><span class="diff-line add">+ </span><span class="diff-line add">+         auth_email = module.params.get(&#x27;auth_email&#x27;)</span><span class="diff-line add">+         auth_key = module.params.get(&#x27;auth_key&#x27;)</span><span class="diff-line add">+         auth_token = module.params.get(&#x27;auth_token&#x27;)</span><span class="diff-line add">+         domain = module.params.get(&#x27;domain&#x27;)</span><span class="diff-line add">+         zone_name = module.params.get(&#x27;zone_name&#x27;)</span><span class="diff-line add">+ </span><span class="diff-line add">+         # Parse domain to get zone name if domain is provided</span><span class="diff-line add">+         if domain:</span><span class="diff-line add">+             try:</span><span class="diff-line add">+                 from tld import get_tld</span><span class="diff-line add">+                 res = get_tld(f&quot;http://{domain}&quot;, as_object=True)</span><span class="diff-line add">+                 zone_name = getattr(res, &#x27;fld&#x27;, None)</span><span class="diff-line add">+                 if not zone_name:</span><span class="diff-line add">+                     module.fail_json(msg=f&quot;Failed to extract zone name from domain &#x27;{domain}&#x27;&quot;)</span><span class="diff-line add">+             except ImportError:</span><span class="diff-line add">+                 module.fail_json(msg=&quot;The &#x27;tld&#x27; Python library is required for domain parsing. Install it with: pip install tld&quot;)</span><span class="diff-line add">+             except Exception as e:</span><span class="diff-line add">+                 module.fail_json(msg=f&quot;Failed to parse domain &#x27;{domain}&#x27;: {str(e)}&quot;)</span><span class="diff-line add">+ </span><span class="diff-line add">+         # Ensure zone_name is set</span><span class="diff-line add">+         if not zone_name:</span><span class="diff-line add">+             module.fail_json(msg=&quot;Zone name could not be determined from provided parameters&quot;)</span><span class="diff-line add">+ </span><span class="diff-line add">+         # Initialize Cloudflare client</span><span class="diff-line add">+         if auth_token:</span><span class="diff-line add">+             cf = Cloudflare(api_token=auth_token)</span><span class="diff-line add">+         else:</span><span class="diff-line add">+             cf = Cloudflare(api_email=auth_email, api_key=auth_key)</span><span class="diff-line add">+ </span><span class="diff-line add">+         # Fetch zone ID</span><span class="diff-line add">+         zone_id = get_zone_id(cf, zone_name, module)</span><span class="diff-line add">+         result[&#x27;zone_id&#x27;] = zone_id</span><span class="diff-line add">+         result[&#x27;zone_name&#x27;] = zone_name</span><span class="diff-line add">+ </span><span class="diff-line add">+         # Fetch SSL/TLS mode</span><span class="diff-line add">+         ssl_mode = get_ssl_tls_mode(cf, zone_id, module)</span><span class="diff-line add">+         result[&#x27;ssl_mode&#x27;] = ssl_mode</span><span class="diff-line add">+ </span><span class="diff-line add">+         module.exit_json(**result)</span><span class="diff-line add">+ </span><span class="diff-line add">+     except Exception as e:</span><span class="diff-line add">+         module.fail_json(msg=f&quot;Unexpected error: {str(e)}&quot;)</span><span class="diff-line add">+ </span><span class="diff-line add">+ </span><span class="diff-line add">+ def main() -&gt; None:</span><span class="diff-line add">+     &quot;&quot;&quot;</span><span class="diff-line add">+     Module entry point.</span><span class="diff-line add">+     &quot;&quot;&quot;</span><span class="diff-line add">+     run_module()</span><span class="diff-line add">+ </span><span class="diff-line add">+ </span><span class="diff-line add">+ if __name__ == &#x27;__main__&#x27;:</span><span class="diff-line add">+     main()</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-2">
                <div class="file-header">
                    <span class="badge added">added</span>
                    <h3>library/ip_timezone_lookup.py</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line add">+ #!/usr/bin/python</span><span class="diff-line add">+ # -*- coding: utf-8 -*-</span><span class="diff-line add">+ </span><span class="diff-line add">+ DOCUMENTATION = &#x27;&#x27;&#x27;</span><span class="diff-line add">+ ---</span><span class="diff-line add">+ module: ip_timezone_lookup</span><span class="diff-line add">+ short_description: Fetch timezone based on IP address from multiple sources</span><span class="diff-line add">+ description:</span><span class="diff-line add">+     - Fetches timezone information from multiple IP geolocation services</span><span class="diff-line add">+     - Returns a consensus timezone when multiple sources agree</span><span class="diff-line add">+     - Provides individual results from each source for verification</span><span class="diff-line add">+     - Returns only valid IANA timezone identifiers suitable for timedatectl</span><span class="diff-line add">+ version_added: &quot;2.9&quot;</span><span class="diff-line add">+ author: &quot;Custom Module&quot;</span><span class="diff-line add">+ options:</span><span class="diff-line add">+     ip_address:</span><span class="diff-line add">+         description:</span><span class="diff-line add">+             - IP address to lookup timezone for</span><span class="diff-line add">+         required: true</span><span class="diff-line add">+         type: str</span><span class="diff-line add">+     timeout:</span><span class="diff-line add">+         description:</span><span class="diff-line add">+             - Timeout in seconds for each API request</span><span class="diff-line add">+         required: false</span><span class="diff-line add">+         default: 5</span><span class="diff-line add">+         type: int</span><span class="diff-line add">+     min_consensus:</span><span class="diff-line add">+         description:</span><span class="diff-line add">+             - Minimum number of sources that must agree for consensus</span><span class="diff-line add">+         required: false</span><span class="diff-line add">+         default: 2</span><span class="diff-line add">+         type: int</span><span class="diff-line add">+ &#x27;&#x27;&#x27;</span><span class="diff-line add">+ </span><span class="diff-line add">+ EXAMPLES = &#x27;&#x27;&#x27;</span><span class="diff-line add">+ - name: Get timezone for specific IP</span><span class="diff-line add">+   ip_timezone_lookup:</span><span class="diff-line add">+     ip_address: &quot;8.8.8.8&quot;</span><span class="diff-line add">+   register: tz_result</span><span class="diff-line add">+ </span><span class="diff-line add">+ - name: Set system timezone based on IP location</span><span class="diff-line add">+   command: timedatectl set-timezone {{ tz_result.timezone }}</span><span class="diff-line add">+   when: tz_result.confidence == &#x27;high&#x27;</span><span class="diff-line add">+ </span><span class="diff-line add">+ - name: Display consensus timezone</span><span class="diff-line add">+   debug:</span><span class="diff-line add">+     msg: &quot;Consensus timezone: {{ tz_result.timezone }}&quot;</span><span class="diff-line add">+ </span><span class="diff-line add">+ - name: Display all source results</span><span class="diff-line add">+   debug:</span><span class="diff-line add">+     msg: &quot;{{ tz_result.sources }}&quot;</span><span class="diff-line add">+ &#x27;&#x27;&#x27;</span><span class="diff-line add">+ </span><span class="diff-line add">+ RETURN = &#x27;&#x27;&#x27;</span><span class="diff-line add">+ timezone:</span><span class="diff-line add">+     description: The consensus timezone in IANA format (suitable for timedatectl)</span><span class="diff-line add">+     type: str</span><span class="diff-line add">+     returned: always</span><span class="diff-line add">+     sample: &quot;Europe/Helsinki&quot;</span><span class="diff-line add">+ confidence:</span><span class="diff-line add">+     description: Confidence level of the result (high/medium/low)</span><span class="diff-line add">+     type: str</span><span class="diff-line add">+     returned: always</span><span class="diff-line add">+     sample: &quot;high&quot;</span><span class="diff-line add">+ consensus_count:</span><span class="diff-line add">+     description: Number of sources agreeing on the timezone</span><span class="diff-line add">+     type: int</span><span class="diff-line add">+     returned: always</span><span class="diff-line add">+     sample: 8</span><span class="diff-line add">+ total_sources:</span><span class="diff-line add">+     description: Total number of sources queried</span><span class="diff-line add">+     type: int</span><span class="diff-line add">+     returned: always</span><span class="diff-line add">+     sample: 8</span><span class="diff-line add">+ successful_lookups:</span><span class="diff-line add">+     description: Number of successful API calls returning valid timezones</span><span class="diff-line add">+     type: int</span><span class="diff-line add">+     returned: always</span><span class="diff-line add">+     sample: 8</span><span class="diff-line add">+ sources:</span><span class="diff-line add">+     description: Dictionary containing results from each source</span><span class="diff-line add">+     type: dict</span><span class="diff-line add">+     returned: always</span><span class="diff-line add">+     sample: {</span><span class="diff-line add">+         &quot;ipapi&quot;: {&quot;timezone&quot;: &quot;Europe/Helsinki&quot;, &quot;success&quot;: true},</span><span class="diff-line add">+         &quot;ipinfo&quot;: {&quot;timezone&quot;: &quot;Europe/Helsinki&quot;, &quot;success&quot;: true}</span><span class="diff-line add">+     }</span><span class="diff-line add">+ ip_used:</span><span class="diff-line add">+     description: The IP address that was looked up</span><span class="diff-line add">+     type: str</span><span class="diff-line add">+     returned: always</span><span class="diff-line add">+     sample: &quot;8.8.8.8&quot;</span><span class="diff-line add">+ &#x27;&#x27;&#x27;</span><span class="diff-line add">+ </span><span class="diff-line add">+ from ansible.module_utils.basic import AnsibleModule</span><span class="diff-line add">+ import json</span><span class="diff-line add">+ from collections import Counter</span><span class="diff-line add">+ import asyncio</span><span class="diff-line add">+ import aiohttp</span><span class="diff-line add">+ </span><span class="diff-line add">+ class IPTimezoneLookup:</span><span class="diff-line add">+     def __init__(self, module):</span><span class="diff-line add">+         self.module = module</span><span class="diff-line add">+         self.ip_address = module.params[&#x27;ip_address&#x27;]</span><span class="diff-line add">+         self.timeout = module.params[&#x27;timeout&#x27;]</span><span class="diff-line add">+         self.min_consensus = module.params[&#x27;min_consensus&#x27;]</span><span class="diff-line add">+         self.results = {}</span><span class="diff-line add">+         </span><span class="diff-line add">+     async def make_request(self, session, url, headers=None):</span><span class="diff-line add">+         &quot;&quot;&quot;Make async HTTP request with error handling&quot;&quot;&quot;</span><span class="diff-line add">+         try:</span><span class="diff-line add">+             async with session.get(url, headers=headers, timeout=aiohttp.ClientTimeout(total=self.timeout)) as response:</span><span class="diff-line add">+                 if response.status == 200:</span><span class="diff-line add">+                     return await response.json()</span><span class="diff-line add">+                 return None</span><span class="diff-line add">+         except (aiohttp.ClientError, asyncio.TimeoutError, json.JSONDecodeError) as e:</span><span class="diff-line add">+             return None</span><span class="diff-line add">+     </span><span class="diff-line add">+     async def fetch_ipapi(self, session):</span><span class="diff-line add">+         &quot;&quot;&quot;Fetch from ip-api.com (free, reliable)&quot;&quot;&quot;</span><span class="diff-line add">+         url = f&quot;http://ip-api.com/json/{self.ip_address}&quot;</span><span class="diff-line add">+         data = await self.make_request(session, url)</span><span class="diff-line add">+         if data and data.get(&#x27;status&#x27;) == &#x27;success&#x27;:</span><span class="diff-line add">+             return data.get(&#x27;timezone&#x27;)</span><span class="diff-line add">+         return None</span><span class="diff-line add">+ </span><span class="diff-line add">+     async def fetch_ipinfo(self, session):</span><span class="diff-line add">+         &quot;&quot;&quot;Fetch from ipinfo.io (free tier, reliable)&quot;&quot;&quot;</span><span class="diff-line add">+         url = f&quot;https://ipinfo.io/{self.ip_address}/json&quot;</span><span class="diff-line add">+         data = await self.make_request(session, url)</span><span class="diff-line add">+         if data:</span><span class="diff-line add">+             return data.get(&#x27;timezone&#x27;)</span><span class="diff-line add">+         return None</span><span class="diff-line add">+ </span><span class="diff-line add">+     async def fetch_ipapi_co(self, session):</span><span class="diff-line add">+         &quot;&quot;&quot;Fetch from ipapi.co (reliable)&quot;&quot;&quot;</span><span class="diff-line add">+         url = f&quot;https://ipapi.co/{self.ip_address}/json/&quot;</span><span class="diff-line add">+         data = await self.make_request(session, url)</span><span class="diff-line add">+         if data and not data.get(&#x27;error&#x27;):</span><span class="diff-line add">+             return data.get(&#x27;timezone&#x27;)</span><span class="diff-line add">+         return None</span><span class="diff-line add">+ </span><span class="diff-line add">+     async def fetch_freegeoip(self, session):</span><span class="diff-line add">+         &quot;&quot;&quot;Fetch from freegeoip.app (reliable)&quot;&quot;&quot;</span><span class="diff-line add">+         url = f&quot;https://freegeoip.app/json/{self.ip_address}&quot;</span><span class="diff-line add">+         data = await self.make_request(session, url)</span><span class="diff-line add">+         if data:</span><span class="diff-line add">+             return data.get(&#x27;time_zone&#x27;)</span><span class="diff-line add">+         return None</span><span class="diff-line add">+ </span><span class="diff-line add">+     async def fetch_ipwhois(self, session):</span><span class="diff-line add">+         &quot;&quot;&quot;Fetch from ipwhois.app (reliable)&quot;&quot;&quot;</span><span class="diff-line add">+         url = f&quot;https://ipwhois.app/json/{self.ip_address}&quot;</span><span class="diff-line add">+         data = await self.make_request(session, url)</span><span class="diff-line add">+         if data and data.get(&#x27;success&#x27;) != False:</span><span class="diff-line add">+             return data.get(&#x27;timezone&#x27;)</span><span class="diff-line add">+         return None</span><span class="diff-line add">+ </span><span class="diff-line add">+     async def fetch_geojs(self, session):</span><span class="diff-line add">+         &quot;&quot;&quot;Fetch from geojs.io (reliable)&quot;&quot;&quot;</span><span class="diff-line add">+         url = f&quot;https://get.geojs.io/v1/ip/geo/{self.ip_address}.json&quot;</span><span class="diff-line add">+         data = await self.make_request(session, url)</span><span class="diff-line add">+         if data:</span><span class="diff-line add">+             return data.get(&#x27;timezone&#x27;)</span><span class="diff-line add">+         return None</span><span class="diff-line add">+ </span><span class="diff-line add">+     async def fetch_ipregistry(self, session):</span><span class="diff-line add">+         &quot;&quot;&quot;Fetch from ipregistry.co (reliable with tryout key)&quot;&quot;&quot;</span><span class="diff-line add">+         url = f&quot;https://api.ipregistry.co/{self.ip_address}?key=tryout&quot;</span><span class="diff-line add">+         data = await self.make_request(session, url)</span><span class="diff-line add">+         if data:</span><span class="diff-line add">+             tz_info = data.get(&#x27;time_zone&#x27;)</span><span class="diff-line add">+             if tz_info:</span><span class="diff-line add">+                 return tz_info.get(&#x27;id&#x27;)</span><span class="diff-line add">+         return None</span><span class="diff-line add">+ </span><span class="diff-line add">+     async def fetch_ipapi_is(self, session):</span><span class="diff-line add">+         &quot;&quot;&quot;Fetch from ipapi.is (reliable)&quot;&quot;&quot;</span><span class="diff-line add">+         url = f&quot;https://api.ipapi.is/?q={self.ip_address}&quot;</span><span class="diff-line add">+         data = await self.make_request(session, url)</span><span class="diff-line add">+         if data:</span><span class="diff-line add">+             location = data.get(&#x27;location&#x27;)</span><span class="diff-line add">+             if location:</span><span class="diff-line add">+                 return location.get(&#x27;timezone&#x27;)</span><span class="diff-line add">+         return None</span><span class="diff-line add">+     </span><span class="diff-line add">+     async def _fetch_from_source(self, session, source_name, lookup_func):</span><span class="diff-line add">+         &quot;&quot;&quot;Fetch timezone from a single source with error handling&quot;&quot;&quot;</span><span class="diff-line add">+         try:</span><span class="diff-line add">+             timezone = await lookup_func(session)</span><span class="diff-line add">+             if timezone and &#x27;/&#x27; in timezone:  # Valid IANA timezone</span><span class="diff-line add">+                 return source_name, {</span><span class="diff-line add">+                     &#x27;timezone&#x27;: timezone,</span><span class="diff-line add">+                     &#x27;success&#x27;: True</span><span class="diff-line add">+                 }</span><span class="diff-line add">+             else:</span><span class="diff-line add">+                 return source_name, {</span><span class="diff-line add">+                     &#x27;timezone&#x27;: None,</span><span class="diff-line add">+                     &#x27;success&#x27;: False,</span><span class="diff-line add">+                     &#x27;error&#x27;: &#x27;No valid IANA timezone returned&#x27;</span><span class="diff-line add">+                 }</span><span class="diff-line add">+         except Exception as e:</span><span class="diff-line add">+             return source_name, {</span><span class="diff-line add">+                 &#x27;timezone&#x27;: None,</span><span class="diff-line add">+                 &#x27;success&#x27;: False,</span><span class="diff-line add">+                 &#x27;error&#x27;: str(e)</span><span class="diff-line add">+             }</span><span class="diff-line add">+ </span><span class="diff-line add">+     async def _run_lookups_async(self):</span><span class="diff-line add">+         &quot;&quot;&quot;Run all timezone lookups concurrently&quot;&quot;&quot;</span><span class="diff-line add">+         # Only include sources that returned valid results in testing</span><span class="diff-line add">+         lookup_methods = {</span><span class="diff-line add">+             &#x27;ipapi&#x27;: self.fetch_ipapi,</span><span class="diff-line add">+             &#x27;ipinfo&#x27;: self.fetch_ipinfo,</span><span class="diff-line add">+             &#x27;ipapi_co&#x27;: self.fetch_ipapi_co,</span><span class="diff-line add">+             &#x27;freegeoip&#x27;: self.fetch_freegeoip,</span><span class="diff-line add">+             &#x27;ipwhois&#x27;: self.fetch_ipwhois,</span><span class="diff-line add">+             &#x27;geojs&#x27;: self.fetch_geojs,</span><span class="diff-line add">+             &#x27;ipregistry&#x27;: self.fetch_ipregistry,</span><span class="diff-line add">+             &#x27;ipapi_is&#x27;: self.fetch_ipapi_is,</span><span class="diff-line add">+         }</span><span class="diff-line add">+ </span><span class="diff-line add">+         # Create aiohttp session and run all lookups concurrently</span><span class="diff-line add">+         async with aiohttp.ClientSession() as session:</span><span class="diff-line add">+             tasks = [</span><span class="diff-line add">+                 self._fetch_from_source(session, source_name, lookup_func)</span><span class="diff-line add">+                 for source_name, lookup_func in lookup_methods.items()</span><span class="diff-line add">+             ]</span><span class="diff-line add">+             results = await asyncio.gather(*tasks)</span><span class="diff-line add">+ </span><span class="diff-line add">+             # Store results</span><span class="diff-line add">+             for source_name, result in results:</span><span class="diff-line add">+                 self.results[source_name] = result</span><span class="diff-line add">+ </span><span class="diff-line add">+     def run_lookups(self):</span><span class="diff-line add">+         &quot;&quot;&quot;Run all timezone lookups (synchronous wrapper for async operations)&quot;&quot;&quot;</span><span class="diff-line add">+         asyncio.run(self._run_lookups_async())</span><span class="diff-line add">+     </span><span class="diff-line add">+     def determine_consensus(self):</span><span class="diff-line add">+         &quot;&quot;&quot;Determine the consensus timezone&quot;&quot;&quot;</span><span class="diff-line add">+         # Collect all successful timezones</span><span class="diff-line add">+         timezones = []</span><span class="diff-line add">+         </span><span class="diff-line add">+         for source, result in self.results.items():</span><span class="diff-line add">+             if result[&#x27;success&#x27;] and result[&#x27;timezone&#x27;]:</span><span class="diff-line add">+                 timezones.append(result[&#x27;timezone&#x27;])</span><span class="diff-line add">+         </span><span class="diff-line add">+         if not timezones:</span><span class="diff-line add">+             return None, &#x27;none&#x27;, 0</span><span class="diff-line add">+         </span><span class="diff-line add">+         # Count occurrences</span><span class="diff-line add">+         tz_counter = Counter(timezones)</span><span class="diff-line add">+         most_common = tz_counter.most_common(1)[0]</span><span class="diff-line add">+         consensus_tz = most_common[0]</span><span class="diff-line add">+         consensus_count = most_common[1]</span><span class="diff-line add">+         </span><span class="diff-line add">+         # Determine confidence</span><span class="diff-line add">+         total_valid = len(timezones)</span><span class="diff-line add">+         if consensus_count &gt;= self.min_consensus:</span><span class="diff-line add">+             if consensus_count &gt;= total_valid * 0.7:</span><span class="diff-line add">+                 confidence = &#x27;high&#x27;</span><span class="diff-line add">+             elif consensus_count &gt;= total_valid * 0.5:</span><span class="diff-line add">+                 confidence = &#x27;medium&#x27;</span><span class="diff-line add">+             else:</span><span class="diff-line add">+                 confidence = &#x27;low&#x27;</span><span class="diff-line add">+         else:</span><span class="diff-line add">+             confidence = &#x27;low&#x27;</span><span class="diff-line add">+         </span><span class="diff-line add">+         return consensus_tz, confidence, consensus_count</span><span class="diff-line add">+ </span><span class="diff-line add">+ def main():</span><span class="diff-line add">+     module = AnsibleModule(</span><span class="diff-line add">+         argument_spec=dict(</span><span class="diff-line add">+             ip_address=dict(type=&#x27;str&#x27;, required=True),</span><span class="diff-line add">+             timeout=dict(type=&#x27;int&#x27;, default=5),</span><span class="diff-line add">+             min_consensus=dict(type=&#x27;int&#x27;, default=2)</span><span class="diff-line add">+         ),</span><span class="diff-line add">+         supports_check_mode=True</span><span class="diff-line add">+     )</span><span class="diff-line add">+     </span><span class="diff-line add">+     if module.check_mode:</span><span class="diff-line add">+         module.exit_json(changed=False)</span><span class="diff-line add">+     </span><span class="diff-line add">+     lookup = IPTimezoneLookup(module)</span><span class="diff-line add">+     lookup.run_lookups()</span><span class="diff-line add">+     </span><span class="diff-line add">+     consensus_tz, confidence, consensus_count = lookup.determine_consensus()</span><span class="diff-line add">+     </span><span class="diff-line add">+     successful_lookups = sum(1 for r in lookup.results.values() if r[&#x27;success&#x27;])</span><span class="diff-line add">+     </span><span class="diff-line add">+     result = {</span><span class="diff-line add">+         &#x27;changed&#x27;: False,</span><span class="diff-line add">+         &#x27;timezone&#x27;: consensus_tz,</span><span class="diff-line add">+         &#x27;confidence&#x27;: confidence,</span><span class="diff-line add">+         &#x27;consensus_count&#x27;: consensus_count,</span><span class="diff-line add">+         &#x27;total_sources&#x27;: len(lookup.results),</span><span class="diff-line add">+         &#x27;successful_lookups&#x27;: successful_lookups,</span><span class="diff-line add">+         &#x27;sources&#x27;: lookup.results,</span><span class="diff-line add">+         &#x27;ip_used&#x27;: lookup.ip_address</span><span class="diff-line add">+     }</span><span class="diff-line add">+     </span><span class="diff-line add">+     if consensus_tz:</span><span class="diff-line add">+         module.exit_json(**result)</span><span class="diff-line add">+     else:</span><span class="diff-line add">+         module.fail_json(msg=&quot;Could not determine timezone from any source&quot;, **result)</span><span class="diff-line add">+ </span><span class="diff-line add">+ if __name__ == &#x27;__main__&#x27;:</span><span class="diff-line add">+     main()</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-3">
                <div class="file-header">
                    <span class="badge added">added</span>
                    <h3>library/tld_parse.py</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line add">+ #!/usr/bin/python</span><span class="diff-line add">+ # -*- coding: utf-8 -*-</span><span class="diff-line add">+ </span><span class="diff-line add">+ #########################################################################</span><span class="diff-line add">+ # Title:         Saltbox: Library | TLD Parse                          #</span><span class="diff-line add">+ # Author(s):     salty                                                  #</span><span class="diff-line add">+ # URL:           https://github.com/saltyorg/Saltbox                    #</span><span class="diff-line add">+ # --                                                                    #</span><span class="diff-line add">+ #########################################################################</span><span class="diff-line add">+ #                   GNU General Public License v3.0                     #</span><span class="diff-line add">+ #########################################################################</span><span class="diff-line add">+ </span><span class="diff-line add">+ from __future__ import annotations</span><span class="diff-line add">+ </span><span class="diff-line add">+ from typing import TYPE_CHECKING, Any</span><span class="diff-line add">+ </span><span class="diff-line add">+ from ansible.module_utils.basic import AnsibleModule</span><span class="diff-line add">+ from tld import get_tld</span><span class="diff-line add">+ </span><span class="diff-line add">+ if TYPE_CHECKING:</span><span class="diff-line add">+     from tld.utils import Result</span><span class="diff-line add">+ </span><span class="diff-line add">+ DOCUMENTATION = r&#x27;&#x27;&#x27;</span><span class="diff-line add">+ ---</span><span class="diff-line add">+ module: tld_parse</span><span class="diff-line add">+ short_description: Parse domain names for DNS operations</span><span class="diff-line add">+ description:</span><span class="diff-line add">+     - Parses a domain name into components needed for DNS record management</span><span class="diff-line add">+     - Extracts the full domain and subdomain portions</span><span class="diff-line add">+     - Uses the tld Python library for parsing</span><span class="diff-line add">+ options:</span><span class="diff-line add">+     url:</span><span class="diff-line add">+         description:</span><span class="diff-line add">+             - The domain or URL to parse</span><span class="diff-line add">+         required: true</span><span class="diff-line add">+         type: str</span><span class="diff-line add">+     record:</span><span class="diff-line add">+         description:</span><span class="diff-line add">+             - Optional DNS record to prepend to the domain</span><span class="diff-line add">+         required: false</span><span class="diff-line add">+         type: str</span><span class="diff-line add">+         default: &#x27;&#x27;</span><span class="diff-line add">+ author:</span><span class="diff-line add">+     - Saltbox Team</span><span class="diff-line add">+ &#x27;&#x27;&#x27;</span><span class="diff-line add">+ </span><span class="diff-line add">+ EXAMPLES = r&#x27;&#x27;&#x27;</span><span class="diff-line add">+ - name: Parse domain</span><span class="diff-line add">+   tld_parse:</span><span class="diff-line add">+     url: &quot;{{ user.domain }}&quot;</span><span class="diff-line add">+   register: domain_info</span><span class="diff-line add">+ </span><span class="diff-line add">+ - name: Parse domain with record</span><span class="diff-line add">+   tld_parse:</span><span class="diff-line add">+     url: &quot;{{ user.domain }}&quot;</span><span class="diff-line add">+     record: &quot;subdomain&quot;</span><span class="diff-line add">+   register: domain_info</span><span class="diff-line add">+ </span><span class="diff-line add">+ - name: Use parsed values</span><span class="diff-line add">+   debug:</span><span class="diff-line add">+     msg: &quot;Domain: {{ domain_info.domain }}, Record: {{ domain_info.record }}&quot;</span><span class="diff-line add">+ &#x27;&#x27;&#x27;</span><span class="diff-line add">+ </span><span class="diff-line add">+ RETURN = r&#x27;&#x27;&#x27;</span><span class="diff-line add">+ fld:</span><span class="diff-line add">+     description: Full domain name (e.g., example.com)</span><span class="diff-line add">+     type: str</span><span class="diff-line add">+     returned: always</span><span class="diff-line add">+     sample: &#x27;example.com&#x27;</span><span class="diff-line add">+ subdomain:</span><span class="diff-line add">+     description: Subdomain portion (empty string if none)</span><span class="diff-line add">+     type: str</span><span class="diff-line add">+     returned: always</span><span class="diff-line add">+     sample: &#x27;www&#x27;</span><span class="diff-line add">+ record:</span><span class="diff-line add">+     description: DNS record format (subdomain or &#x27;@&#x27; for root domain)</span><span class="diff-line add">+     type: str</span><span class="diff-line add">+     returned: always</span><span class="diff-line add">+     sample: &#x27;www&#x27;</span><span class="diff-line add">+ tld:</span><span class="diff-line add">+     description: Top-level domain (e.g., com, org, co.uk)</span><span class="diff-line add">+     type: str</span><span class="diff-line add">+     returned: always</span><span class="diff-line add">+     sample: &#x27;com&#x27;</span><span class="diff-line add">+ domain:</span><span class="diff-line add">+     description: Domain name without TLD (e.g., example)</span><span class="diff-line add">+     type: str</span><span class="diff-line add">+     returned: always</span><span class="diff-line add">+     sample: &#x27;example&#x27;</span><span class="diff-line add">+ &#x27;&#x27;&#x27;</span><span class="diff-line add">+ </span><span class="diff-line add">+ </span><span class="diff-line add">+ def main() -&gt; None:</span><span class="diff-line add">+     module: Any = AnsibleModule(</span><span class="diff-line add">+         argument_spec=dict(</span><span class="diff-line add">+             url=dict(type=&#x27;str&#x27;, required=True),</span><span class="diff-line add">+             record=dict(type=&#x27;str&#x27;, default=&#x27;&#x27;)</span><span class="diff-line add">+         ),</span><span class="diff-line add">+         supports_check_mode=True</span><span class="diff-line add">+     )</span><span class="diff-line add">+ </span><span class="diff-line add">+     url: str = module.params[&#x27;url&#x27;]</span><span class="diff-line add">+     record: str = module.params[&#x27;record&#x27;]</span><span class="diff-line add">+ </span><span class="diff-line add">+     try:</span><span class="diff-line add">+         # Build the full URL</span><span class="diff-line add">+         full_url: str</span><span class="diff-line add">+         if record:</span><span class="diff-line add">+             full_url = f&quot;http://{record}.{url}&quot;</span><span class="diff-line add">+         else:</span><span class="diff-line add">+             # Only add http:// if URL doesn&#x27;t already have a scheme</span><span class="diff-line add">+             if not url.startswith((&#x27;http://&#x27;, &#x27;https://&#x27;)):</span><span class="diff-line add">+                 full_url = f&quot;http://{url}&quot;</span><span class="diff-line add">+             else:</span><span class="diff-line add">+                 full_url = url</span><span class="diff-line add">+ </span><span class="diff-line add">+         # Parse using tld library</span><span class="diff-line add">+         res: Result = get_tld(full_url, as_object=True)  # type: ignore[assignment]</span><span class="diff-line add">+ </span><span class="diff-line add">+         # Extract components - use same naming as tld library</span><span class="diff-line add">+         fld: str = res.fld</span><span class="diff-line add">+         subdomain: str = res.subdomain if res.subdomain else &#x27;&#x27;</span><span class="diff-line add">+         tld: str = res.tld</span><span class="diff-line add">+         domain: str = res.domain</span><span class="diff-line add">+ </span><span class="diff-line add">+         # Format record for DNS operations</span><span class="diff-line add">+         dns_record: str = subdomain if subdomain else &#x27;@&#x27;</span><span class="diff-line add">+ </span><span class="diff-line add">+         module.exit_json(</span><span class="diff-line add">+             changed=False,</span><span class="diff-line add">+             fld=fld,</span><span class="diff-line add">+             subdomain=subdomain,</span><span class="diff-line add">+             record=dns_record,</span><span class="diff-line add">+             tld=tld,</span><span class="diff-line add">+             domain=domain</span><span class="diff-line add">+         )</span><span class="diff-line add">+ </span><span class="diff-line add">+     except Exception as e:</span><span class="diff-line add">+         module.fail_json(msg=f&quot;Failed to parse domain: {e!s}&quot;)</span><span class="diff-line add">+ </span><span class="diff-line add">+ </span><span class="diff-line add">+ if __name__ == &#x27;__main__&#x27;:</span><span class="diff-line add">+     main()</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-4">
                <div class="file-header">
                    <span class="badge added">added</span>
                    <h3>lookup_plugins/docker_var.py</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line add">+ from ansible.plugins.lookup import LookupBase</span><span class="diff-line add">+ from ansible.errors import AnsibleLookupError</span><span class="diff-line add">+ from ansible.utils.display import Display</span><span class="diff-line add">+ from typing import Any, List, Optional, Dict</span><span class="diff-line add">+ import json</span><span class="diff-line add">+ </span><span class="diff-line add">+ display = Display()</span><span class="diff-line add">+ </span><span class="diff-line add">+ DOCUMENTATION = &quot;&quot;&quot;</span><span class="diff-line add">+     name: docker_var</span><span class="diff-line add">+     author: salty</span><span class="diff-line add">+     version_added: &quot;N/A&quot;</span><span class="diff-line add">+     short_description: Look up a role variable with automatic fallback and JSON conversion</span><span class="diff-line add">+     description:</span><span class="diff-line add">+       - This lookup replicates lookup(&#x27;vars&#x27;, _instance_name + suffix, default=lookup(&#x27;vars&#x27;, _var_prefix + &#x27;_role&#x27; + suffix))</span><span class="diff-line add">+       - For instance names or var prefixes with dashes, checks both original and underscore-converted versions</span><span class="diff-line add">+       - Automatically converts lists of JSON strings to dictionaries when detected</span><span class="diff-line add">+     options:</span><span class="diff-line add">+       _terms:</span><span class="diff-line add">+         description: The suffix to append (e.g. &#x27;_docker_network_mode&#x27;)</span><span class="diff-line add">+         required: true</span><span class="diff-line add">+       default:</span><span class="diff-line add">+         description: The default value to return if neither variable is found</span><span class="diff-line add">+         type: raw</span><span class="diff-line add">+         required: false</span><span class="diff-line add">+       convert_json:</span><span class="diff-line add">+         description: Whether to automatically convert JSON string lists to dictionaries (default true)</span><span class="diff-line add">+         type: bool</span><span class="diff-line add">+         required: false</span><span class="diff-line add">+         default: true</span><span class="diff-line add">+ &quot;&quot;&quot;</span><span class="diff-line add">+ </span><span class="diff-line add">+ class LookupModule(LookupBase):</span><span class="diff-line add">+ </span><span class="diff-line add">+     def _is_json_string_list(self, value: Any) -&gt; bool:</span><span class="diff-line add">+         &quot;&quot;&quot;Check if value is a list of JSON strings&quot;&quot;&quot;</span><span class="diff-line add">+         if not isinstance(value, list):</span><span class="diff-line add">+             return False</span><span class="diff-line add">+         </span><span class="diff-line add">+         # Check if all items are strings that look like JSON objects</span><span class="diff-line add">+         for item in value:</span><span class="diff-line add">+             if not isinstance(item, str):</span><span class="diff-line add">+                 return False</span><span class="diff-line add">+             stripped = item.strip()</span><span class="diff-line add">+             if not (stripped.startswith(&#x27;{&#x27;) and stripped.endswith(&#x27;}&#x27;)):</span><span class="diff-line add">+                 return False</span><span class="diff-line add">+         </span><span class="diff-line add">+         return len(value) &gt; 0</span><span class="diff-line add">+ </span><span class="diff-line add">+     def _convert_json_list_to_dict(self, json_list: List[str]) -&gt; Optional[Dict[str, Any]]:</span><span class="diff-line add">+         &quot;&quot;&quot;Convert a list of JSON strings to a combined dictionary&quot;&quot;&quot;</span><span class="diff-line add">+         combined_dict: Dict[str, Any] = {}</span><span class="diff-line add">+ </span><span class="diff-line add">+         for json_str in json_list:</span><span class="diff-line add">+             try:</span><span class="diff-line add">+                 # Parse the JSON string directly</span><span class="diff-line add">+                 parsed = json.loads(json_str)</span><span class="diff-line add">+                 if isinstance(parsed, dict):</span><span class="diff-line add">+                     combined_dict.update(parsed)</span><span class="diff-line add">+                 else:</span><span class="diff-line add">+                     display.warning(f&quot;[docker_var] JSON string parsed to non-dict: {parsed}&quot;)</span><span class="diff-line add">+                     return None</span><span class="diff-line add">+             except json.JSONDecodeError as je:</span><span class="diff-line add">+                 display.warning(f&quot;[docker_var] Invalid JSON in: {json_str[:100]}... Error: {je}&quot;)</span><span class="diff-line add">+                 return None</span><span class="diff-line add">+             except (TypeError, AttributeError) as e:</span><span class="diff-line add">+                 display.warning(f&quot;[docker_var] Failed to process JSON string: {e}&quot;)</span><span class="diff-line add">+                 return None</span><span class="diff-line add">+ </span><span class="diff-line add">+         display.vvv(f&quot;[docker_var] Converted JSON list to dict with {len(combined_dict)} keys using manual parsing&quot;)</span><span class="diff-line add">+         return combined_dict</span><span class="diff-line add">+ </span><span class="diff-line add">+     def run(self, terms: List[str], variables: Optional[Dict[str, Any]] = None, **kwargs: Any) -&gt; List[Any]:</span><span class="diff-line add">+         if variables is None:</span><span class="diff-line add">+             variables = {}</span><span class="diff-line add">+         </span><span class="diff-line add">+         suffix: str = terms[0] if terms else &#x27;&#x27;</span><span class="diff-line add">+         self.set_options(var_options=variables, direct=kwargs)</span><span class="diff-line add">+         default: Any = self.get_option(&#x27;default&#x27;)</span><span class="diff-line add">+         convert_json: Optional[bool] = self.get_option(&#x27;convert_json&#x27;)</span><span class="diff-line add">+         if convert_json is None:</span><span class="diff-line add">+             convert_json = True</span><span class="diff-line add">+ </span><span class="diff-line add">+         self._templar.available_variables = variables</span><span class="diff-line add">+ </span><span class="diff-line add">+         if &#x27;_var_prefix&#x27; not in variables:</span><span class="diff-line add">+             raise KeyError(&quot;[docker_var] Required variable &#x27;_var_prefix&#x27; not found&quot;)</span><span class="diff-line add">+         if &#x27;_instance_name&#x27; not in variables:</span><span class="diff-line add">+             raise KeyError(&quot;[docker_var] Required variable &#x27;_instance_name&#x27; not found&quot;)</span><span class="diff-line add">+ </span><span class="diff-line add">+         var_prefix: str = self._templar.template(variables[&#x27;_var_prefix&#x27;], fail_on_undefined=True)</span><span class="diff-line add">+         instance_name: str = self._templar.template(variables[&#x27;_instance_name&#x27;], fail_on_undefined=True)</span><span class="diff-line add">+         </span><span class="diff-line add">+         # Create lists of prefixes to try (including dash/underscore variants)</span><span class="diff-line add">+         instance_names_to_try: List[str] = [instance_name]</span><span class="diff-line add">+         if &#x27;-&#x27; in instance_name:</span><span class="diff-line add">+             underscore_instance: str = instance_name.replace(&#x27;-&#x27;, &#x27;_&#x27;)</span><span class="diff-line add">+             instance_names_to_try.append(underscore_instance)</span><span class="diff-line add">+             display.vvv(f&quot;[docker_var] Added underscore variant for instance: {underscore_instance}&quot;)</span><span class="diff-line add">+ </span><span class="diff-line add">+         var_prefixes_to_try: List[str] = [var_prefix]</span><span class="diff-line add">+         if &#x27;-&#x27; in var_prefix:</span><span class="diff-line add">+             underscore_prefix: str = var_prefix.replace(&#x27;-&#x27;, &#x27;_&#x27;)</span><span class="diff-line add">+             var_prefixes_to_try.append(underscore_prefix)</span><span class="diff-line add">+             display.vvv(f&quot;[docker_var] Added underscore variant for prefix: {underscore_prefix}&quot;)</span><span class="diff-line add">+ </span><span class="diff-line add">+         # Build the variable names to check</span><span class="diff-line add">+         vars_to_check: List[str] = []</span><span class="diff-line add">+         </span><span class="diff-line add">+         # For each instance name variant, add the primary variable</span><span class="diff-line add">+         for inst_name in instance_names_to_try:</span><span class="diff-line add">+             primary_var: str = inst_name + suffix</span><span class="diff-line add">+             vars_to_check.append(primary_var)</span><span class="diff-line add">+ </span><span class="diff-line add">+         # For each var prefix variant, add the fallback variable</span><span class="diff-line add">+         for var_pref in var_prefixes_to_try:</span><span class="diff-line add">+             fallback_var: str</span><span class="diff-line add">+             if suffix == &#x27;_name&#x27;:</span><span class="diff-line add">+                 fallback_var = var_pref + suffix</span><span class="diff-line add">+             else:</span><span class="diff-line add">+                 fallback_var = var_pref + &#x27;_role&#x27; + suffix</span><span class="diff-line add">+             vars_to_check.append(fallback_var)</span><span class="diff-line add">+ </span><span class="diff-line add">+         display.vvv(f&quot;[docker_var] Checking these keys in order: {vars_to_check}&quot;)</span><span class="diff-line add">+         if display.verbosity &gt;= 3:</span><span class="diff-line add">+             debug_keys = sorted([</span><span class="diff-line add">+                 k for k in variables</span><span class="diff-line add">+                 if suffix in k or k.endswith(suffix) or any(k.startswith(prefix) for prefix in instance_names_to_try + var_prefixes_to_try)</span><span class="diff-line add">+             ])</span><span class="diff-line add">+             display.vvv(f&quot;[docker_var] Relevant vars: {debug_keys}&quot;)</span><span class="diff-line add">+         </span><span class="diff-line add">+         # Try each variable name in order</span><span class="diff-line add">+         last_error: Optional[Exception] = None</span><span class="diff-line add">+         for var_name in vars_to_check:</span><span class="diff-line add">+             if var_name in variables:</span><span class="diff-line add">+                 raw_value = variables.get(var_name)</span><span class="diff-line add">+                 if raw_value is None:</span><span class="diff-line add">+                     display.vvv(f&quot;[docker_var] Skipping {var_name} (value is None)&quot;)</span><span class="diff-line add">+                     continue</span><span class="diff-line add">+                 try:</span><span class="diff-line add">+                     result = self._templar.template(raw_value, fail_on_undefined=True)</span><span class="diff-line add">+                     if result is not None:</span><span class="diff-line add">+                         # Check if we should convert JSON list to dict</span><span class="diff-line add">+                         if convert_json and self._is_json_string_list(result):</span><span class="diff-line add">+                             display.vvv(f&quot;[docker_var] Found JSON string list for {var_name}, converting to dict&quot;)</span><span class="diff-line add">+                             converted = self._convert_json_list_to_dict(result)</span><span class="diff-line add">+                             if converted is not None:</span><span class="diff-line add">+                                 return [converted]</span><span class="diff-line add">+                             else:</span><span class="diff-line add">+                                 display.vvv(f&quot;[docker_var] Conversion failed, returning original list&quot;)</span><span class="diff-line add">+ </span><span class="diff-line add">+                         display.vvv(f&quot;[docker_var] Returning templated value for {var_name}: {result}&quot;)</span><span class="diff-line add">+                         return [result]</span><span class="diff-line add">+                     else:</span><span class="diff-line add">+                         display.vvv(f&quot;[docker_var] {var_name} is None after templating, skipping&quot;)</span><span class="diff-line add">+                 except Exception as e:</span><span class="diff-line add">+                     display.vvv(f&quot;[docker_var] Error templating {var_name}: {e}&quot;)</span><span class="diff-line add">+                     last_error = e</span><span class="diff-line add">+             else:</span><span class="diff-line add">+                 display.vvv(f&quot;[docker_var] {var_name} not found in variables  skipping&quot;)</span><span class="diff-line add">+ </span><span class="diff-line add">+         # If we have a default, use it</span><span class="diff-line add">+         if default is not None:</span><span class="diff-line add">+             display.vvv(f&quot;[docker_var] No usable variable found, returning default: {default}&quot;)</span><span class="diff-line add">+             return [default]</span><span class="diff-line add">+ </span><span class="diff-line add">+         # If all attempts failed with errors, raise the last error</span><span class="diff-line add">+         if last_error is not None:</span><span class="diff-line add">+             raise last_error</span><span class="diff-line add">+ </span><span class="diff-line add">+         # Otherwise raise an error - variable not found and no default provided</span><span class="diff-line add">+         raise AnsibleLookupError(</span><span class="diff-line add">+             f&quot;[docker_var] Variable not found and no default provided. &quot;</span><span class="diff-line add">+             f&quot;Tried the following variables in order: {&#x27;, &#x27;.join(vars_to_check)}&quot;</span><span class="diff-line add">+         )</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-5">
                <div class="file-header">
                    <span class="badge added">added</span>
                    <h3>lookup_plugins/role_var.py</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line add">+ from ansible.plugins.lookup import LookupBase</span><span class="diff-line add">+ from ansible.errors import AnsibleLookupError</span><span class="diff-line add">+ from ansible.utils.display import Display</span><span class="diff-line add">+ from typing import Any, List, Optional, Dict</span><span class="diff-line add">+ import json</span><span class="diff-line add">+ </span><span class="diff-line add">+ display = Display()</span><span class="diff-line add">+ </span><span class="diff-line add">+ DOCUMENTATION = &quot;&quot;&quot;</span><span class="diff-line add">+     name: role_var</span><span class="diff-line add">+     author: salty</span><span class="diff-line add">+     version_added: &quot;N/A&quot;</span><span class="diff-line add">+     short_description: Look up a role variable with automatic fallback and JSON conversion</span><span class="diff-line add">+     description:</span><span class="diff-line add">+       - This lookup replicates lookup(&#x27;vars&#x27;, traefik_role_var + suffix, default=lookup(&#x27;vars&#x27;, role_name + &#x27;_role&#x27; + suffix))</span><span class="diff-line add">+       - When &#x27;role&#x27; parameter is specified, constructs the appropriate traefik_role_var for that role</span><span class="diff-line add">+       - For _name variables with dashes, checks both original and underscore-converted versions</span><span class="diff-line add">+       - Automatically converts lists of JSON strings to dictionaries when detected</span><span class="diff-line add">+     options:</span><span class="diff-line add">+       _terms:</span><span class="diff-line add">+         description: The suffix to append (e.g. &#x27;_dns_record&#x27;)</span><span class="diff-line add">+         required: true</span><span class="diff-line add">+       default:</span><span class="diff-line add">+         description: The default value to return if neither variable is found</span><span class="diff-line add">+         type: raw</span><span class="diff-line add">+         required: false</span><span class="diff-line add">+       role:</span><span class="diff-line add">+         description: The role name to use for lookup instead of the current role_name</span><span class="diff-line add">+         type: str</span><span class="diff-line add">+         required: false</span><span class="diff-line add">+       convert_json:</span><span class="diff-line add">+         description: Whether to automatically convert JSON string lists to dictionaries (default true)</span><span class="diff-line add">+         type: bool</span><span class="diff-line add">+         required: false</span><span class="diff-line add">+         default: true</span><span class="diff-line add">+ &quot;&quot;&quot;</span><span class="diff-line add">+ </span><span class="diff-line add">+ class LookupModule(LookupBase):</span><span class="diff-line add">+ </span><span class="diff-line add">+     def _is_json_string_list(self, value: Any) -&gt; bool:</span><span class="diff-line add">+         &quot;&quot;&quot;Check if value is a list of JSON strings&quot;&quot;&quot;</span><span class="diff-line add">+         if not isinstance(value, list):</span><span class="diff-line add">+             return False</span><span class="diff-line add">+         </span><span class="diff-line add">+         # Check if all items are strings that look like JSON objects</span><span class="diff-line add">+         for item in value:</span><span class="diff-line add">+             if not isinstance(item, str):</span><span class="diff-line add">+                 return False</span><span class="diff-line add">+             stripped = item.strip()</span><span class="diff-line add">+             if not (stripped.startswith(&#x27;{&#x27;) and stripped.endswith(&#x27;}&#x27;)):</span><span class="diff-line add">+                 return False</span><span class="diff-line add">+         </span><span class="diff-line add">+         return len(value) &gt; 0</span><span class="diff-line add">+ </span><span class="diff-line add">+     def _convert_json_list_to_dict(self, json_list: List[str]) -&gt; Optional[Dict[str, Any]]:</span><span class="diff-line add">+         &quot;&quot;&quot;Convert a list of JSON strings to a combined dictionary&quot;&quot;&quot;</span><span class="diff-line add">+         combined_dict: Dict[str, Any] = {}</span><span class="diff-line add">+ </span><span class="diff-line add">+         for json_str in json_list:</span><span class="diff-line add">+             try:</span><span class="diff-line add">+                 # Parse the JSON string directly</span><span class="diff-line add">+                 parsed = json.loads(json_str)</span><span class="diff-line add">+                 if isinstance(parsed, dict):</span><span class="diff-line add">+                     combined_dict.update(parsed)</span><span class="diff-line add">+                 else:</span><span class="diff-line add">+                     display.warning(f&quot;[role_var] JSON string parsed to non-dict: {parsed}&quot;)</span><span class="diff-line add">+                     return None</span><span class="diff-line add">+             except json.JSONDecodeError as je:</span><span class="diff-line add">+                 display.warning(f&quot;[role_var] Invalid JSON in: {json_str[:100]}... Error: {je}&quot;)</span><span class="diff-line add">+                 return None</span><span class="diff-line add">+             except (TypeError, AttributeError) as e:</span><span class="diff-line add">+                 display.warning(f&quot;[role_var] Failed to process JSON string: {e}&quot;)</span><span class="diff-line add">+                 return None</span><span class="diff-line add">+ </span><span class="diff-line add">+         display.vvv(f&quot;[role_var] Converted JSON list to dict with {len(combined_dict)} keys using manual parsing&quot;)</span><span class="diff-line add">+         return combined_dict</span><span class="diff-line add">+ </span><span class="diff-line add">+     def run(self, terms: List[str], variables: Optional[Dict[str, Any]] = None, **kwargs: Any) -&gt; List[Any]:</span><span class="diff-line add">+         if variables is None:</span><span class="diff-line add">+             variables = {}</span><span class="diff-line add">+ </span><span class="diff-line add">+         suffix: str = terms[0] if terms else &#x27;&#x27;</span><span class="diff-line add">+         self.set_options(var_options=variables, direct=kwargs)</span><span class="diff-line add">+         default: Any = self.get_option(&#x27;default&#x27;)</span><span class="diff-line add">+         specified_role: Optional[str] = self.get_option(&#x27;role&#x27;)</span><span class="diff-line add">+         convert_json: Optional[bool] = self.get_option(&#x27;convert_json&#x27;)</span><span class="diff-line add">+         if convert_json is None:</span><span class="diff-line add">+             convert_json = True</span><span class="diff-line add">+ </span><span class="diff-line add">+         self._templar.available_variables = variables</span><span class="diff-line add">+ </span><span class="diff-line add">+         # Use specified role if provided, otherwise fall back to role_name</span><span class="diff-line add">+         if specified_role:</span><span class="diff-line add">+             role_name: str = self._templar.template(specified_role, fail_on_undefined=True)</span><span class="diff-line add">+         else:</span><span class="diff-line add">+             if &#x27;role_name&#x27; not in variables:</span><span class="diff-line add">+                 raise KeyError(&quot;[role_var] Required variable &#x27;role_name&#x27; not found&quot;)</span><span class="diff-line add">+             role_name: str = self._templar.template(variables[&#x27;role_name&#x27;], fail_on_undefined=True)</span><span class="diff-line add">+         </span><span class="diff-line add">+         # If a custom role is specified, we need to construct the appropriate traefik_role_var for that role</span><span class="diff-line add">+         traefik_role_var: str</span><span class="diff-line add">+         if specified_role:</span><span class="diff-line add">+             # Replicate the logic: traefik_role_var: &quot;{{ lookup(&#x27;vars&#x27;, role_name + &#x27;_name&#x27;, default=role_name) }}&quot;</span><span class="diff-line add">+             custom_role_name_var: str = role_name + &#x27;_name&#x27;</span><span class="diff-line add">+             if custom_role_name_var in variables:</span><span class="diff-line add">+                 traefik_role_var = self._templar.template(variables[custom_role_name_var], fail_on_undefined=True)</span><span class="diff-line add">+             else:</span><span class="diff-line add">+                 traefik_role_var = role_name</span><span class="diff-line add">+             display.vvv(f&quot;[role_var] Using custom traefik_role_var for role &#x27;{role_name}&#x27;: {traefik_role_var}&quot;)</span><span class="diff-line add">+         else:</span><span class="diff-line add">+             if &#x27;traefik_role_var&#x27; not in variables:</span><span class="diff-line add">+                 raise KeyError(&quot;[role_var] Required variable &#x27;traefik_role_var&#x27; not found&quot;)</span><span class="diff-line add">+             traefik_role_var = self._templar.template(variables[&#x27;traefik_role_var&#x27;], fail_on_undefined=True)</span><span class="diff-line add">+ </span><span class="diff-line add">+         # Build the variable names to check</span><span class="diff-line add">+         primary_var: str</span><span class="diff-line add">+         fallback_var: str</span><span class="diff-line add">+         if suffix == &#x27;_name&#x27;:</span><span class="diff-line add">+             primary_var = traefik_role_var + suffix</span><span class="diff-line add">+             fallback_var = role_name + suffix</span><span class="diff-line add">+         else:</span><span class="diff-line add">+             primary_var = traefik_role_var + suffix</span><span class="diff-line add">+             fallback_var = role_name + &#x27;_role&#x27; + suffix</span><span class="diff-line add">+ </span><span class="diff-line add">+         # Create list of all variable names to check (including dash/underscore variants)</span><span class="diff-line add">+         vars_to_check: List[str] = []</span><span class="diff-line add">+         </span><span class="diff-line add">+         for var_name in [primary_var, fallback_var]:</span><span class="diff-line add">+             vars_to_check.append(var_name)</span><span class="diff-line add">+             # If the variable name contains dashes, also check the underscore version</span><span class="diff-line add">+             if &#x27;-&#x27; in var_name:</span><span class="diff-line add">+                 underscore_var = var_name.replace(&#x27;-&#x27;, &#x27;_&#x27;)</span><span class="diff-line add">+                 vars_to_check.append(underscore_var)</span><span class="diff-line add">+                 display.vvv(f&quot;[role_var] Added underscore variant: {underscore_var} for {var_name}&quot;)</span><span class="diff-line add">+ </span><span class="diff-line add">+         display.vvv(f&quot;[role_var] Checking these keys in order: {vars_to_check}&quot;)</span><span class="diff-line add">+         if display.verbosity &gt;= 3:</span><span class="diff-line add">+             debug_keys = sorted([</span><span class="diff-line add">+                 k for k in variables</span><span class="diff-line add">+                 if suffix in k or k.endswith(suffix) or k.startswith((traefik_role_var, role_name))</span><span class="diff-line add">+             ])</span><span class="diff-line add">+             display.vvv(f&quot;[role_var] Relevant vars: {debug_keys}&quot;)</span><span class="diff-line add">+ </span><span class="diff-line add">+         # Try each variable name in order</span><span class="diff-line add">+         last_error: Optional[Exception] = None</span><span class="diff-line add">+         for var_name in vars_to_check:</span><span class="diff-line add">+             if var_name in variables:</span><span class="diff-line add">+                 raw_value = variables.get(var_name)</span><span class="diff-line add">+                 if raw_value is None:</span><span class="diff-line add">+                     display.vvv(f&quot;[role_var] Skipping {var_name} (value is None)&quot;)</span><span class="diff-line add">+                     continue</span><span class="diff-line add">+                 try:</span><span class="diff-line add">+                     result = self._templar.template(raw_value, fail_on_undefined=True)</span><span class="diff-line add">+                     if result is not None:</span><span class="diff-line add">+                         # Check if we should convert JSON list to dict</span><span class="diff-line add">+                         if convert_json and self._is_json_string_list(result):</span><span class="diff-line add">+                             display.vvv(f&quot;[role_var] Found JSON string list for {var_name}, converting to dict&quot;)</span><span class="diff-line add">+                             converted = self._convert_json_list_to_dict(result)</span><span class="diff-line add">+                             if converted is not None:</span><span class="diff-line add">+                                 return [converted]</span><span class="diff-line add">+                             else:</span><span class="diff-line add">+                                 display.vvv(f&quot;[role_var] Conversion failed, returning original list&quot;)</span><span class="diff-line add">+ </span><span class="diff-line add">+                         display.vvv(f&quot;[role_var] Returning templated value for {var_name}: {result}&quot;)</span><span class="diff-line add">+                         return [result]</span><span class="diff-line add">+                     else:</span><span class="diff-line add">+                         display.vvv(f&quot;[role_var] {var_name} is None after templating, skipping&quot;)</span><span class="diff-line add">+                 except Exception as e:</span><span class="diff-line add">+                     display.vvv(f&quot;[role_var] Error templating {var_name}: {e}&quot;)</span><span class="diff-line add">+                     last_error = e</span><span class="diff-line add">+             else:</span><span class="diff-line add">+                 display.vvv(f&quot;[role_var] {var_name} not found in variables  skipping&quot;)</span><span class="diff-line add">+ </span><span class="diff-line add">+         # If we have a default, use it</span><span class="diff-line add">+         if default is not None:</span><span class="diff-line add">+             display.vvv(f&quot;[role_var] No usable variable found, returning default: {default}&quot;)</span><span class="diff-line add">+             return [default]</span><span class="diff-line add">+ </span><span class="diff-line add">+         # If all attempts failed with errors, raise the last error</span><span class="diff-line add">+         if last_error is not None:</span><span class="diff-line add">+             raise last_error</span><span class="diff-line add">+ </span><span class="diff-line add">+         # Otherwise raise an error - variable not found and no default provided</span><span class="diff-line add">+         raise AnsibleLookupError(</span><span class="diff-line add">+             f&quot;[role_var] Variable not found and no default provided. &quot;</span><span class="diff-line add">+             f&quot;Tried the following variables in order: {&#x27;, &#x27;.join(vars_to_check)}&quot;</span><span class="diff-line add">+         )</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-6">
                <div class="file-header">
                    <span class="badge added">added</span>
                    <h3>resources/tasks/instances/nzbget.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line add">+ #########################################################################</span><span class="diff-line add">+ # Title:         Saltbox: Resources | Tasks | Instances | Get NZBGet Info #</span><span class="diff-line add">+ # Author(s):     salty                                                    #</span><span class="diff-line add">+ # URL:           https://github.com/saltyorg/Saltbox                      #</span><span class="diff-line add">+ # --                                                                      #</span><span class="diff-line add">+ #########################################################################</span><span class="diff-line add">+ #                   GNU General Public License v3.0                       #</span><span class="diff-line add">+ #########################################################################</span><span class="diff-line add">+ ---</span><span class="diff-line add">+ - name: Resources | Tasks | Instances | Get Info | Check if NZBGet exists</span><span class="diff-line add">+   ansible.builtin.stat:</span><span class="diff-line add">+     path: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_config_location&#x27;, role=&#x27;nzbget&#x27;) }}&quot;</span><span class="diff-line add">+   register: nzbget_role_paths_config_location_stat</span><span class="diff-line add">+ </span><span class="diff-line add">+ - name: Resources | Tasks | Instances | Get Info | NZBGet tasks</span><span class="diff-line add">+   when: nzbget_role_paths_config_location_stat.stat.exists</span><span class="diff-line add">+   block:</span><span class="diff-line add">+     - name: Resources | Tasks | Instances | Get Info | Fetch NZBGet ControlUsername</span><span class="diff-line add">+       ansible.builtin.shell: &quot;grep -oP &#x27;^ControlUsername=\\K.*&#x27; {{ lookup(&#x27;role_var&#x27;, &#x27;_paths_config_location&#x27;, role=&#x27;nzbget&#x27;) }}&quot;</span><span class="diff-line add">+       register: nzbget_username_result</span><span class="diff-line add">+       changed_when: false</span><span class="diff-line add">+ </span><span class="diff-line add">+     - name: Resources | Tasks | Instances | Get Info | Fetch NZBGet ControlPassword</span><span class="diff-line add">+       ansible.builtin.shell: &quot;grep -oP &#x27;^ControlPassword=\\K.*&#x27; {{ lookup(&#x27;role_var&#x27;, &#x27;_paths_config_location&#x27;, role=&#x27;nzbget&#x27;) }}&quot;</span><span class="diff-line add">+       register: nzbget_password_result</span><span class="diff-line add">+       changed_when: false</span><span class="diff-line add">+ </span><span class="diff-line add">+     - name: Resources | Tasks | Instances | Get Info | Set &#x27;nzbget_info&#x27; variable</span><span class="diff-line add">+       ansible.builtin.set_fact:</span><span class="diff-line add">+         nzbget_info:</span><span class="diff-line add">+           name: nzbget</span><span class="diff-line add">+           url: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_web_url&#x27;, role=&#x27;nzbget&#x27;) }}&quot;</span><span class="diff-line add">+           username: &quot;{{ nzbget_username_result.stdout }}&quot;</span><span class="diff-line add">+           password: &quot;{{ nzbget_password_result.stdout }}&quot;</span><span class="diff-line add">+ </span><span class="diff-line add">+ - name: Resources | Tasks | Instances | Get Info | Set &#x27;nzbget_info&#x27; variable</span><span class="diff-line add">+   ansible.builtin.set_fact:</span><span class="diff-line add">+     nzbget_info:</span><span class="diff-line add">+       name: nzbget</span><span class="diff-line add">+       url: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_web_url&#x27;, role=&#x27;nzbget&#x27;) }}&quot;</span><span class="diff-line add">+       username: &quot;not installed&quot;</span><span class="diff-line add">+       password: &quot;not installed&quot;</span><span class="diff-line add">+   when: (not nzbget_role_paths_config_location_stat.stat.exists)</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-7">
                <div class="file-header">
                    <span class="badge added">added</span>
                    <h3>resources/tasks/instances/sabnzbd.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line add">+ #########################################################################</span><span class="diff-line add">+ # Title:         Saltbox: Resources | Tasks | Instances | Get SABnzbd Info #</span><span class="diff-line add">+ # Author(s):     salty                                                     #</span><span class="diff-line add">+ # URL:           https://github.com/saltyorg/Saltbox                       #</span><span class="diff-line add">+ # --                                                                       #</span><span class="diff-line add">+ #########################################################################</span><span class="diff-line add">+ #                   GNU General Public License v3.0                        #</span><span class="diff-line add">+ #########################################################################</span><span class="diff-line add">+ ---</span><span class="diff-line add">+ - name: Resources | Tasks | Instances | Get Info | Check if SABnzbd exists</span><span class="diff-line add">+   ansible.builtin.stat:</span><span class="diff-line add">+     path: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_config_location&#x27;, role=&#x27;sabnzbd&#x27;) }}&quot;</span><span class="diff-line add">+   register: sabnzbd_role_paths_config_location_stat</span><span class="diff-line add">+ </span><span class="diff-line add">+ - name: Resources | Tasks | Instances | Get Info | SABnzbd API Key tasks</span><span class="diff-line add">+   when: sabnzbd_role_paths_config_location_stat.stat.exists</span><span class="diff-line add">+   block:</span><span class="diff-line add">+     - name: Resources | Tasks | Instances | Get Info | Fetch SABnzbd API Key</span><span class="diff-line add">+       ansible.builtin.shell: &quot;grep -oP &#x27;^api_key = \\K.*&#x27; {{ lookup(&#x27;role_var&#x27;, &#x27;_paths_config_location&#x27;, role=&#x27;sabnzbd&#x27;) }}&quot;</span><span class="diff-line add">+       register: sabnzbd_api_key_result</span><span class="diff-line add">+       changed_when: false</span><span class="diff-line add">+ </span><span class="diff-line add">+     - name: Resources | Tasks | Instances | Get Info | Set &#x27;sabnzbd_info&#x27; variable</span><span class="diff-line add">+       ansible.builtin.set_fact:</span><span class="diff-line add">+         sabnzbd_info:</span><span class="diff-line add">+           name: sabnzbd</span><span class="diff-line add">+           url: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_web_url&#x27;, role=&#x27;sabnzbd&#x27;) }}&quot;</span><span class="diff-line add">+           api_key: &quot;{{ sabnzbd_api_key_result.stdout }}&quot;</span><span class="diff-line add">+ </span><span class="diff-line add">+ - name: Resources | Tasks | Instances | Get Info | Set &#x27;sabnzbd_info&#x27; variable</span><span class="diff-line add">+   ansible.builtin.set_fact:</span><span class="diff-line add">+     sabnzbd_info:</span><span class="diff-line add">+       name: sabnzbd</span><span class="diff-line add">+       url: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_web_url&#x27;, role=&#x27;sabnzbd&#x27;) }}&quot;</span><span class="diff-line add">+       api_key: &quot;not installed&quot;</span><span class="diff-line add">+   when: (not sabnzbd_role_paths_config_location_stat.stat.exists)</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-8">
                <div class="file-header">
                    <span class="badge added">added</span>
                    <h3>resources/tasks/variables/import_inventory_vars.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line add">+ #####################################################################################</span><span class="diff-line add">+ # Title:         Saltbox: Resources | Tasks | Variables | Import Inventory Vars     #</span><span class="diff-line add">+ # Author(s):     salty                                                              #</span><span class="diff-line add">+ # URL:           https://github.com/saltyorg/Saltbox                                #</span><span class="diff-line add">+ # --                                                                                #</span><span class="diff-line add">+ #####################################################################################</span><span class="diff-line add">+ #                   GNU General Public License v3.0                                 #</span><span class="diff-line add">+ #####################################################################################</span><span class="diff-line add">+ ---</span><span class="diff-line add">+ - name: &quot;Resources | Tasks | Variables | Import Inventory Vars | Check if &#x27;localhost.yml&#x27; exists&quot;</span><span class="diff-line add">+   ansible.builtin.stat:</span><span class="diff-line add">+     path: &quot;/srv/git/saltbox/inventories/host_vars/localhost.yml&quot;</span><span class="diff-line add">+   register: localhost_inventory_file</span><span class="diff-line add">+ </span><span class="diff-line add">+ - name: &quot;Resources | Tasks | Variables | Import Inventory Vars | Import Inventory variables&quot;</span><span class="diff-line add">+   ansible.builtin.include_vars: &quot;/srv/git/saltbox/inventories/host_vars/localhost.yml&quot;</span><span class="diff-line add">+   when: localhost_inventory_file.stat.exists</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-9">
                <div class="file-header">
                    <span class="badge added">added</span>
                    <h3>resources/tasks/variables/import_role_vars.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line add">+ ################################################################################</span><span class="diff-line add">+ # Title:         Saltbox: Resources | Tasks | Variables | Import Role Vars     #</span><span class="diff-line add">+ # Author(s):     salty                                                         #</span><span class="diff-line add">+ # URL:           https://github.com/saltyorg/Saltbox                           #</span><span class="diff-line add">+ # --                                                                           #</span><span class="diff-line add">+ ################################################################################</span><span class="diff-line add">+ #                   GNU General Public License v3.0                            #</span><span class="diff-line add">+ ################################################################################</span><span class="diff-line add">+ ---</span><span class="diff-line add">+ - name: &quot;Resources | Tasks | Variables | Import Role Vars | Include {{ import_role_name }} role default vars&quot;</span><span class="diff-line add">+   ansible.builtin.include_vars: &quot;/srv/git/saltbox/roles/{{ import_role_name }}/defaults/main.yml&quot;</span><span class="diff-line add">+ </span><span class="diff-line add">+ - name: &quot;Resources | Tasks | Variables | Import Role Vars | Check if &#x27;localhost.yml&#x27; exists&quot;</span><span class="diff-line add">+   ansible.builtin.stat:</span><span class="diff-line add">+     path: &quot;/srv/git/saltbox/inventories/host_vars/localhost.yml&quot;</span><span class="diff-line add">+   register: localhost_inventory_file</span><span class="diff-line add">+ </span><span class="diff-line add">+ - name: &quot;Resources | Tasks | Variables | Import Role Vars | Import Inventory variables&quot;</span><span class="diff-line add">+   ansible.builtin.include_vars: &quot;/srv/git/saltbox/inventories/host_vars/localhost.yml&quot;</span><span class="diff-line add">+   when: localhost_inventory_file.stat.exists</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-10">
                <div class="file-header">
                    <span class="badge added">added</span>
                    <h3>roles/cloudplow_disable/tasks/main.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line add">+ #########################################################################</span><span class="diff-line add">+ # Title:         Saltbox: Cloudplow Disable Role                        #</span><span class="diff-line add">+ # Author(s):     salty                                                  #</span><span class="diff-line add">+ # URL:           https://github.com/saltyorg/Saltbox                    #</span><span class="diff-line add">+ # --                                                                    #</span><span class="diff-line add">+ #########################################################################</span><span class="diff-line add">+ #                   GNU General Public License v3.0                     #</span><span class="diff-line add">+ #########################################################################</span><span class="diff-line add">+ ---</span><span class="diff-line add">+ - name: Delete Legacy Service</span><span class="diff-line add">+   ansible.builtin.include_tasks: &quot;{{ resources_tasks_path }}/systemd/delete_service.yml&quot;</span><span class="diff-line add">+   vars:</span><span class="diff-line add">+     _service_name: &quot;{{ cloudplow_service_name_old }}&quot;</span><span class="diff-line add">+ </span><span class="diff-line add">+ - name: Delete Service</span><span class="diff-line add">+   ansible.builtin.include_tasks: &quot;{{ resources_tasks_path }}/systemd/delete_service.yml&quot;</span><span class="diff-line add">+   vars:</span><span class="diff-line add">+     _service_name: &quot;{{ cloudplow_service_name }}&quot;</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-11">
                <div class="file-header">
                    <span class="badge added">added</span>
                    <h3>roles/motd/tasks/subtasks/emby_info.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line add">+ #########################################################################</span><span class="diff-line add">+ # Title:         Saltbox: MOTD | Build Emby Info                       #</span><span class="diff-line add">+ # Author(s):     salty                                                 #</span><span class="diff-line add">+ # URL:           https://github.com/saltyorg/Saltbox                   #</span><span class="diff-line add">+ # --                                                                   #</span><span class="diff-line add">+ #########################################################################</span><span class="diff-line add">+ #                   GNU General Public License v3.0                    #</span><span class="diff-line add">+ #########################################################################</span><span class="diff-line add">+ ---</span><span class="diff-line add">+ - name: Set &#x27;emby_info&#x27; variable</span><span class="diff-line add">+   ansible.builtin.set_fact:</span><span class="diff-line add">+     emby_info: &quot;{{ emby_info | default({}) | combine({emby_name: {&#x27;name&#x27;: emby_name, &#x27;url&#x27;: lookup(&#x27;role_var&#x27;, &#x27;_web_url&#x27;, role=emby_name), &#x27;token&#x27;: &#x27;not installed&#x27;}}) }}&quot;</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-12">
                <div class="file-header">
                    <span class="badge added">added</span>
                    <h3>roles/motd/tasks/subtasks/jellyfin_info.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line add">+ #########################################################################</span><span class="diff-line add">+ # Title:         Saltbox: MOTD | Build Jellyfin Info                   #</span><span class="diff-line add">+ # Author(s):     salty                                                 #</span><span class="diff-line add">+ # URL:           https://github.com/saltyorg/Saltbox                   #</span><span class="diff-line add">+ # --                                                                   #</span><span class="diff-line add">+ #########################################################################</span><span class="diff-line add">+ #                   GNU General Public License v3.0                    #</span><span class="diff-line add">+ #########################################################################</span><span class="diff-line add">+ ---</span><span class="diff-line add">+ - name: Set &#x27;jellyfin_info&#x27; variable</span><span class="diff-line add">+   ansible.builtin.set_fact:</span><span class="diff-line add">+     jellyfin_info: &quot;{{ jellyfin_info | default({}) | combine({jellyfin_name: {&#x27;name&#x27;: jellyfin_name, &#x27;url&#x27;: lookup(&#x27;role_var&#x27;, &#x27;_web_url&#x27;, role=jellyfin_name), &#x27;token&#x27;: &#x27;not installed&#x27;}}) }}&quot;</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-13">
                <div class="file-header">
                    <span class="badge added">added</span>
                    <h3>roles/motd/tasks/subtasks/qbittorrent_info.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line add">+ #########################################################################</span><span class="diff-line add">+ # Title:         Saltbox: MOTD | Build qBittorrent Info                 #</span><span class="diff-line add">+ # Author(s):     salty                                                  #</span><span class="diff-line add">+ # URL:           https://github.com/saltyorg/Saltbox                    #</span><span class="diff-line add">+ # --                                                                    #</span><span class="diff-line add">+ #########################################################################</span><span class="diff-line add">+ #                   GNU General Public License v3.0                     #</span><span class="diff-line add">+ #########################################################################</span><span class="diff-line add">+ ---</span><span class="diff-line add">+ - name: Set &#x27;qbittorrent_info&#x27; variable</span><span class="diff-line add">+   ansible.builtin.set_fact:</span><span class="diff-line add">+     qbittorrent_info: &quot;{{ qbittorrent_info | default({}) | combine({qbittorrent_name: {&#x27;name&#x27;: qbittorrent_name, &#x27;url&#x27;: lookup(&#x27;role_var&#x27;, &#x27;_web_url&#x27;, role=qbittorrent_name), &#x27;username&#x27;: user.name, &#x27;password&#x27;: user.pass}}) }}&quot;</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-14">
                <div class="file-header">
                    <span class="badge added">added</span>
                    <h3>roles/postgres_host/defaults/main.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line add">+ ##########################################################################</span><span class="diff-line add">+ # Title:         Saltbox: PostgreSQL | Default Variables                 #</span><span class="diff-line add">+ # Author(s):     salty                                                   #</span><span class="diff-line add">+ # URL:           https://github.com/saltyorg/Saltbox                     #</span><span class="diff-line add">+ # --                                                                     #</span><span class="diff-line add">+ ##########################################################################</span><span class="diff-line add">+ #                   GNU General Public License v3.0                      #</span><span class="diff-line add">+ ##########################################################################</span><span class="diff-line add">+ ---</span><span class="diff-line add">+ ################################</span><span class="diff-line add">+ # Basics</span><span class="diff-line add">+ ################################</span><span class="diff-line add">+ </span><span class="diff-line add">+ # Supports any versions from https://wiki.postgresql.org/wiki/Apt</span><span class="diff-line add">+ # Each version is unique and you cannot specify the same version twice</span><span class="diff-line add">+ postgres_host_role_versions: [&quot;17&quot;]</span><span class="diff-line add">+ </span><span class="diff-line add">+ ################################</span><span class="diff-line add">+ # Paths</span><span class="diff-line add">+ ################################</span><span class="diff-line add">+ </span><span class="diff-line add">+ postgres_host_role_data_directory: &quot;{{ server_appdata_path }}/postgresql&quot;</span><span class="diff-line add">+ </span><span class="diff-line add">+ ################################</span><span class="diff-line add">+ # Superuser</span><span class="diff-line add">+ ################################</span><span class="diff-line add">+ </span><span class="diff-line add">+ postgres_host_role_create_root_superuser: true</span><span class="diff-line add">+ postgres_host_role_root_superuser_name: &quot;root&quot;</span><span class="diff-line add">+ postgres_host_role_root_superuser_password: &quot;password4321&quot;</span><span class="diff-line add">+ </span><span class="diff-line add">+ ################################</span><span class="diff-line add">+ # Per-Version Configuration</span><span class="diff-line add">+ ################################</span><span class="diff-line add">+ </span><span class="diff-line add">+ # Example:</span><span class="diff-line add">+ # postgres_host_role_config:</span><span class="diff-line add">+ #   &quot;16&quot;:</span><span class="diff-line add">+ #     allowed_hosts:</span><span class="diff-line add">+ #       - &quot;172.19.0.0/16&quot;</span><span class="diff-line add">+ #       - &quot;10.0.0.0/8&quot;</span><span class="diff-line add">+ #     auth_method: &quot;md5&quot;</span><span class="diff-line add">+ #     users:</span><span class="diff-line add">+ #       - name: &quot;app_user&quot;</span><span class="diff-line add">+ #         password: &quot;password1&quot;</span><span class="diff-line add">+ #       - name: &quot;app_user2&quot;</span><span class="diff-line add">+ #         password: &quot;password2&quot;</span><span class="diff-line add">+ #     databases:</span><span class="diff-line add">+ #       - name: &quot;app_database&quot;</span><span class="diff-line add">+ #         users:</span><span class="diff-line add">+ #           - &quot;app_user&quot;</span><span class="diff-line add">+ #           - &quot;app_user2&quot;</span><span class="diff-line add">+ #       - name: &quot;metrics_db&quot;</span><span class="diff-line add">+ #         users:</span><span class="diff-line add">+ #           - &quot;app_user&quot;</span><span class="diff-line add">+ #   &quot;17&quot;:</span><span class="diff-line add">+ #     allowed_hosts:</span><span class="diff-line add">+ #       - &quot;172.19.0.0/16&quot;</span><span class="diff-line add">+ #     auth_method: &quot;scram-sha-256&quot;</span><span class="diff-line add">+ #     users:</span><span class="diff-line add">+ #       - name: &quot;app_user3&quot;</span><span class="diff-line add">+ #         password: &quot;password3&quot;</span><span class="diff-line add">+ #     databases:</span><span class="diff-line add">+ #       - name: &quot;new_app_database&quot;</span><span class="diff-line add">+ #         users:</span><span class="diff-line add">+ #           - &quot;app_user3&quot;</span><span class="diff-line add">+ postgres_host_role_config: {}</span><span class="diff-line add">+ </span><span class="diff-line add">+ ################################</span><span class="diff-line add">+ # Access Control</span><span class="diff-line add">+ ################################</span><span class="diff-line add">+ </span><span class="diff-line add">+ postgres_host_role_allowed_hosts:</span><span class="diff-line add">+   - &quot;172.19.0.0/16&quot;</span><span class="diff-line add">+ </span><span class="diff-line add">+ postgres_host_role_auth_method: &quot;scram-sha-256&quot;</span><span class="diff-line add">+ </span><span class="diff-line add">+ ################################</span><span class="diff-line add">+ # User &amp; Database Configuration</span><span class="diff-line add">+ ################################</span><span class="diff-line add">+ </span><span class="diff-line add">+ postgres_host_role_users:</span><span class="diff-line add">+   - name: &quot;{{ user.name }}&quot;</span><span class="diff-line add">+     password: &quot;{{ user.pass }}&quot;</span><span class="diff-line add">+ </span><span class="diff-line add">+ postgres_host_role_databases:</span><span class="diff-line add">+   - name: &quot;saltbox&quot;</span><span class="diff-line add">+     users: [&quot;{{ user.name }}&quot;]</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-15">
                <div class="file-header">
                    <span class="badge added">added</span>
                    <h3>roles/postgres_host/tasks/main.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line add">+ #########################################################################</span><span class="diff-line add">+ # Title:         Saltbox: PostgreSQL Host Role                          #</span><span class="diff-line add">+ # Author(s):     salty                                                  #</span><span class="diff-line add">+ # URL:           https://github.com/saltyorg/Saltbox                    #</span><span class="diff-line add">+ # --                                                                    #</span><span class="diff-line add">+ #########################################################################</span><span class="diff-line add">+ #                   GNU General Public License v3.0                     #</span><span class="diff-line add">+ #########################################################################</span><span class="diff-line add">+ ---</span><span class="diff-line add">+ - name: Update apt cache</span><span class="diff-line add">+   ansible.builtin.apt:</span><span class="diff-line add">+     update_cache: true</span><span class="diff-line add">+ </span><span class="diff-line add">+ - name: Install postgresql-common</span><span class="diff-line add">+   ansible.builtin.apt:</span><span class="diff-line add">+     name: postgresql-common</span><span class="diff-line add">+     state: latest</span><span class="diff-line add">+ </span><span class="diff-line add">+ - name: Run PGDG script</span><span class="diff-line add">+   ansible.builtin.command: /usr/share/postgresql-common/pgdg/apt.postgresql.org.sh -y</span><span class="diff-line add">+   args:</span><span class="diff-line add">+     creates: /etc/apt/sources.list.d/pgdg.list</span><span class="diff-line add">+ </span><span class="diff-line add">+ - name: Create PostgreSQL data directory</span><span class="diff-line add">+   ansible.builtin.file:</span><span class="diff-line add">+     path: &quot;{{ postgres_host_role_data_directory }}&quot;</span><span class="diff-line add">+     state: directory</span><span class="diff-line add">+     owner: &quot;{{ user.name }}&quot;</span><span class="diff-line add">+     group: &quot;{{ user.name }}&quot;</span><span class="diff-line add">+     mode: &#x27;0755&#x27;</span><span class="diff-line add">+ </span><span class="diff-line add">+ - name: Create symlink for entire PostgreSQL directory</span><span class="diff-line add">+   ansible.builtin.file:</span><span class="diff-line add">+     src: &quot;{{ postgres_host_role_data_directory }}&quot;</span><span class="diff-line add">+     dest: &quot;/etc/postgresql&quot;</span><span class="diff-line add">+     state: link</span><span class="diff-line add">+     owner: &quot;{{ user.name }}&quot;</span><span class="diff-line add">+     group: &quot;{{ user.name }}&quot;</span><span class="diff-line add">+     follow: false</span><span class="diff-line add">+     force: true</span><span class="diff-line add">+ </span><span class="diff-line add">+ - name: Install PostgreSQL packages for specified versions</span><span class="diff-line add">+   ansible.builtin.apt:</span><span class="diff-line add">+     name: &quot;postgresql-{{ item }}&quot;</span><span class="diff-line add">+     state: latest</span><span class="diff-line add">+   loop: &quot;{{ postgres_host_role_versions }}&quot;</span><span class="diff-line add">+ </span><span class="diff-line add">+ - name: Discover existing PostgreSQL clusters</span><span class="diff-line add">+   ansible.builtin.shell: |</span><span class="diff-line add">+     pg_lsclusters --no-header | awk &#x27;{print $1&quot;:&quot;$2&quot;:&quot;$3}&#x27;</span><span class="diff-line add">+   register: existing_clusters</span><span class="diff-line add">+   changed_when: false</span><span class="diff-line add">+   failed_when: false</span><span class="diff-line add">+ </span><span class="diff-line add">+ - name: Parse cluster information</span><span class="diff-line add">+   ansible.builtin.set_fact:</span><span class="diff-line add">+     postgres_cluster_info: &quot;{{ postgres_cluster_info | default([]) + [{&#x27;version&#x27;: item.split(&#x27;:&#x27;)[0], &#x27;name&#x27;: item.split(&#x27;:&#x27;)[1], &#x27;port&#x27;: item.split(&#x27;:&#x27;)[2]}] }}&quot;</span><span class="diff-line add">+   loop: &quot;{{ existing_clusters.stdout_lines | default([]) }}&quot;</span><span class="diff-line add">+   when: (existing_clusters.stdout_lines is defined)</span><span class="diff-line add">+ </span><span class="diff-line add">+ - name: Find all PostgreSQL services</span><span class="diff-line add">+   ansible.builtin.shell: |</span><span class="diff-line add">+     systemctl list-units --type=service --state=loaded --no-legend | grep postgresql | awk &#x27;{print $1}&#x27;</span><span class="diff-line add">+   register: postgres_services</span><span class="diff-line add">+   changed_when: false</span><span class="diff-line add">+   failed_when: false</span><span class="diff-line add">+ </span><span class="diff-line add">+ - name: Stop and disable unspecified PostgreSQL versions</span><span class="diff-line add">+   ansible.builtin.systemd:</span><span class="diff-line add">+     name: &quot;{{ item }}&quot;</span><span class="diff-line add">+     state: stopped</span><span class="diff-line add">+     enabled: false</span><span class="diff-line add">+   loop: &quot;{{ postgres_services.stdout_lines }}&quot;</span><span class="diff-line add">+   when:</span><span class="diff-line add">+     - postgres_services.stdout_lines is defined</span><span class="diff-line add">+     - item != &quot;postgresql.service&quot;</span><span class="diff-line add">+     - item not in (postgres_host_role_versions | map(&#x27;regex_replace&#x27;, &#x27;^(.*)$&#x27;, &#x27;postgresql@\\1-main.service&#x27;) | list)</span><span class="diff-line add">+   failed_when: false</span><span class="diff-line add">+ </span><span class="diff-line add">+ - name: Check if default clusters exist</span><span class="diff-line add">+   ansible.builtin.stat:</span><span class="diff-line add">+     path: &quot;/var/lib/postgresql/{{ item }}/main&quot;</span><span class="diff-line add">+   register: default_clusters_exist</span><span class="diff-line add">+   loop: &quot;{{ postgres_host_role_versions }}&quot;</span><span class="diff-line add">+ </span><span class="diff-line add">+ - name: Stop default clusters if they exist</span><span class="diff-line add">+   ansible.builtin.command: &gt;</span><span class="diff-line add">+     pg_ctlcluster {{ item.item }} main stop</span><span class="diff-line add">+   loop: &quot;{{ default_clusters_exist.results }}&quot;</span><span class="diff-line add">+   become: true</span><span class="diff-line add">+   become_user: &quot;{{ user.name }}&quot;</span><span class="diff-line add">+   when: item.stat.exists</span><span class="diff-line add">+   failed_when: false</span><span class="diff-line add">+ </span><span class="diff-line add">+ - name: Remove default clusters if they exist</span><span class="diff-line add">+   ansible.builtin.command: &gt;</span><span class="diff-line add">+     pg_dropcluster {{ item.item }} main</span><span class="diff-line add">+   loop: &quot;{{ default_clusters_exist.results }}&quot;</span><span class="diff-line add">+   become: true</span><span class="diff-line add">+   become_user: &quot;{{ user.name }}&quot;</span><span class="diff-line add">+   when: item.stat.exists</span><span class="diff-line add">+   failed_when: false</span><span class="diff-line add">+ </span><span class="diff-line add">+ - name: Check if clusters are already configured</span><span class="diff-line add">+   ansible.builtin.shell: |</span><span class="diff-line add">+     pg_lsclusters --no-header | grep &quot;^{{ item }}\s\+main&quot; || echo &quot;not_found&quot;</span><span class="diff-line add">+   register: clusters_configured</span><span class="diff-line add">+   loop: &quot;{{ postgres_host_role_versions }}&quot;</span><span class="diff-line add">+   become: true</span><span class="diff-line add">+   become_user: &quot;{{ user.name }}&quot;</span><span class="diff-line add">+   changed_when: false</span><span class="diff-line add">+   failed_when: false</span><span class="diff-line add">+ </span><span class="diff-line add">+ - name: Update port in postgresql.conf for existing clusters</span><span class="diff-line add">+   ansible.builtin.lineinfile:</span><span class="diff-line add">+     path: &quot;{{ postgres_host_role_data_directory }}/{{ item }}/main/postgresql.conf&quot;</span><span class="diff-line add">+     regexp: &quot;^#?port =&quot;</span><span class="diff-line add">+     line: &quot;port = {{ postgres_port_assignments[item] }}&quot;</span><span class="diff-line add">+     owner: &quot;{{ user.name }}&quot;</span><span class="diff-line add">+     group: &quot;{{ user.name }}&quot;</span><span class="diff-line add">+     mode: &#x27;0644&#x27;</span><span class="diff-line add">+   loop: &quot;{{ postgres_host_role_versions }}&quot;</span><span class="diff-line add">+   when: postgres_port_assignments[item] is defined</span><span class="diff-line add">+ </span><span class="diff-line add">+ - name: Create clusters with custom data directory and user</span><span class="diff-line add">+   ansible.builtin.command: &gt;</span><span class="diff-line add">+     pg_createcluster {{ item.item }} main</span><span class="diff-line add">+     --datadir={{ postgres_host_role_data_directory }}/{{ item.item }}/data</span><span class="diff-line add">+     --user={{ user.name }}</span><span class="diff-line add">+     --port={{ postgres_port_assignments[item.item] }}</span><span class="diff-line add">+   loop: &quot;{{ clusters_configured.results }}&quot;</span><span class="diff-line add">+   become: true</span><span class="diff-line add">+   become_user: &quot;{{ user.name }}&quot;</span><span class="diff-line add">+   when: (&#x27;not_found&#x27; in item.stdout)</span><span class="diff-line add">+ </span><span class="diff-line add">+ - name: Create systemd override directory for PostgreSQL service</span><span class="diff-line add">+   ansible.builtin.file:</span><span class="diff-line add">+     path: &quot;/etc/systemd/system/postgresql@.service.d&quot;</span><span class="diff-line add">+     state: directory</span><span class="diff-line add">+     owner: root</span><span class="diff-line add">+     group: root</span><span class="diff-line add">+     mode: &#x27;0755&#x27;</span><span class="diff-line add">+ </span><span class="diff-line add">+ - name: Create systemd override for PostgreSQL service</span><span class="diff-line add">+   ansible.builtin.copy:</span><span class="diff-line add">+     content: |</span><span class="diff-line add">+       [Service]</span><span class="diff-line add">+       User={{ user.name }}</span><span class="diff-line add">+       Group={{ user.name }}</span><span class="diff-line add">+ </span><span class="diff-line add">+       # Ensure runtime directory exists and has correct ownership</span><span class="diff-line add">+       ExecStartPre=+/bin/mkdir -p /var/run/postgresql</span><span class="diff-line add">+       ExecStartPre=+/bin/chown -R {{ user.name }}:{{ user.name }} /var/run/postgresql</span><span class="diff-line add">+       ExecStartPre=+/bin/chmod 0775 /var/run/postgresql</span><span class="diff-line add">+ </span><span class="diff-line add">+       # Ensure log directory has correct ownership</span><span class="diff-line add">+       ExecStartPre=+/bin/mkdir -p /var/run/postgresql</span><span class="diff-line add">+       ExecStartPre=+/bin/chown -R {{ user.name }}:{{ user.name }} /var/log/postgresql</span><span class="diff-line add">+     dest: &quot;/etc/systemd/system/postgresql@.service.d/override.conf&quot;</span><span class="diff-line add">+     owner: root</span><span class="diff-line add">+     group: root</span><span class="diff-line add">+     mode: &#x27;0644&#x27;</span><span class="diff-line add">+   register: postgres_systemd_override</span><span class="diff-line add">+ </span><span class="diff-line add">+ - name: Reload systemd daemon after override changes</span><span class="diff-line add">+   ansible.builtin.systemd:</span><span class="diff-line add">+     daemon_reload: true</span><span class="diff-line add">+   when: postgres_systemd_override.changed</span><span class="diff-line add">+ </span><span class="diff-line add">+ - name: Calculate desired port assignments based on version order</span><span class="diff-line add">+   ansible.builtin.set_fact:</span><span class="diff-line add">+     postgres_port_assignments: &quot;{{ postgres_port_assignments | default({}) | combine({item: (5432 + my_idx)}) }}&quot;</span><span class="diff-line add">+   loop: &quot;{{ postgres_host_role_versions }}&quot;</span><span class="diff-line add">+   loop_control:</span><span class="diff-line add">+     index_var: my_idx</span><span class="diff-line add">+ </span><span class="diff-line add">+ - name: Stop all PostgreSQL services before port validation</span><span class="diff-line add">+   ansible.builtin.systemd:</span><span class="diff-line add">+     name: &quot;postgresql@{{ item }}-main&quot;</span><span class="diff-line add">+     state: stopped</span><span class="diff-line add">+   loop: &quot;{{ postgres_host_role_versions }}&quot;</span><span class="diff-line add">+   failed_when: false</span><span class="diff-line add">+ </span><span class="diff-line add">+ - name: Stop generic PostgreSQL service</span><span class="diff-line add">+   ansible.builtin.systemd:</span><span class="diff-line add">+     name: postgresql</span><span class="diff-line add">+     state: stopped</span><span class="diff-line add">+   failed_when: false</span><span class="diff-line add">+ </span><span class="diff-line add">+ - name: Check if desired ports are available</span><span class="diff-line add">+   ansible.builtin.wait_for:</span><span class="diff-line add">+     port: &quot;{{ postgres_port_assignments[item] }}&quot;</span><span class="diff-line add">+     host: &quot;127.0.0.1&quot;</span><span class="diff-line add">+     state: stopped</span><span class="diff-line add">+     timeout: 1</span><span class="diff-line add">+   loop: &quot;{{ postgres_host_role_versions }}&quot;</span><span class="diff-line add">+   register: port_check_results</span><span class="diff-line add">+   failed_when: false</span><span class="diff-line add">+ </span><span class="diff-line add">+ - name: Fail if any desired ports are not available</span><span class="diff-line add">+   ansible.builtin.fail:</span><span class="diff-line add">+     msg: &quot;Port {{ postgres_port_assignments[item] }} for PostgreSQL version {{ item }} is not available (in use by another service)&quot;</span><span class="diff-line add">+   loop: &quot;{{ postgres_host_role_versions }}&quot;</span><span class="diff-line add">+   loop_control:</span><span class="diff-line add">+     index_var: port_idx</span><span class="diff-line add">+   when: port_check_results.results[port_idx].failed</span><span class="diff-line add">+ </span><span class="diff-line add">+ - name: Start PostgreSQL services with correct port assignments</span><span class="diff-line add">+   ansible.builtin.systemd:</span><span class="diff-line add">+     name: &quot;postgresql@{{ item }}-main&quot;</span><span class="diff-line add">+     state: started</span><span class="diff-line add">+     enabled: true</span><span class="diff-line add">+   loop: &quot;{{ postgres_host_role_versions }}&quot;</span><span class="diff-line add">+ </span><span class="diff-line add">+ - name: Ensure generic PostgreSQL service is enabled</span><span class="diff-line add">+   ansible.builtin.systemd:</span><span class="diff-line add">+     name: postgresql</span><span class="diff-line add">+     enabled: true</span><span class="diff-line add">+ </span><span class="diff-line add">+ - name: Rediscover PostgreSQL clusters after setup</span><span class="diff-line add">+   ansible.builtin.shell: |</span><span class="diff-line add">+     pg_lsclusters --no-header | awk &#x27;{print $1&quot;:&quot;$2&quot;:&quot;$3&quot;:&quot;$4}&#x27;</span><span class="diff-line add">+   register: updated_clusters</span><span class="diff-line add">+   changed_when: false</span><span class="diff-line add">+   failed_when: false</span><span class="diff-line add">+ </span><span class="diff-line add">+ - name: Parse updated cluster information</span><span class="diff-line add">+   ansible.builtin.set_fact:</span><span class="diff-line add">+     postgres_active_clusters: &quot;{{ postgres_active_clusters | default([]) + [{&#x27;version&#x27;: item.split(&#x27;:&#x27;)[0], &#x27;name&#x27;: item.split(&#x27;:&#x27;)[1], &#x27;port&#x27;: item.split(&#x27;:&#x27;)[2], &#x27;status&#x27;: item.split(&#x27;:&#x27;)[3]}] }}&quot;</span><span class="diff-line add">+   loop: &quot;{{ updated_clusters.stdout_lines | default([]) }}&quot;</span><span class="diff-line add">+   when:</span><span class="diff-line add">+     - (updated_clusters.stdout_lines is defined)</span><span class="diff-line add">+     - (item.split(&#x27;:&#x27;)[0] in postgres_host_role_versions)</span><span class="diff-line add">+ </span><span class="diff-line add">+ - name: Setup databases and users for each PostgreSQL version</span><span class="diff-line add">+   ansible.builtin.include_tasks: setup_version.yml</span><span class="diff-line add">+   vars:</span><span class="diff-line add">+     postgres_version: &quot;{{ postgres_item }}&quot;</span><span class="diff-line add">+     cluster_port: &quot;{{ postgres_port_assignments[postgres_item] }}&quot;</span><span class="diff-line add">+   loop: &quot;{{ postgres_host_role_versions | unique }}&quot;</span><span class="diff-line add">+   loop_control:</span><span class="diff-line add">+     loop_var: &quot;postgres_item&quot;</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-16">
                <div class="file-header">
                    <span class="badge added">added</span>
                    <h3>roles/postgres_host/tasks/setup_version.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line add">+ #########################################################################</span><span class="diff-line add">+ # Title:         Saltbox: PostgreSQL Host Role                          #</span><span class="diff-line add">+ # Author(s):     salty                                                  #</span><span class="diff-line add">+ # URL:           https://github.com/saltyorg/Saltbox                    #</span><span class="diff-line add">+ # --                                                                    #</span><span class="diff-line add">+ #########################################################################</span><span class="diff-line add">+ #                   GNU General Public License v3.0                     #</span><span class="diff-line add">+ #########################################################################</span><span class="diff-line add">+ ---</span><span class="diff-line add">+ - name: Set version-specific configuration for version {{ postgres_version }}</span><span class="diff-line add">+   ansible.builtin.set_fact:</span><span class="diff-line add">+     version_users: &quot;{{ postgres_host_role_config[postgres_version].users | default(postgres_host_role_users) }}&quot;</span><span class="diff-line add">+     version_databases: &quot;{{ postgres_host_role_config[postgres_version].databases | default(postgres_host_role_databases) }}&quot;</span><span class="diff-line add">+     version_allowed_hosts: &quot;{{ postgres_host_role_config[postgres_version].allowed_hosts | default(postgres_host_role_allowed_hosts) }}&quot;</span><span class="diff-line add">+     version_auth_method: &quot;{{ postgres_host_role_config[postgres_version].auth_method | default(postgres_host_role_auth_method) }}&quot;</span><span class="diff-line add">+ </span><span class="diff-line add">+ - name: Add allowed hosts to pg_hba.conf for version {{ postgres_version }}</span><span class="diff-line add">+   ansible.builtin.blockinfile:</span><span class="diff-line add">+     path: &quot;{{ postgres_host_role_data_directory }}/{{ postgres_version }}/main/pg_hba.conf&quot;</span><span class="diff-line add">+     marker: &quot;### SALTBOX MANAGED BLOCK - {mark} ###&quot;</span><span class="diff-line add">+     block: |</span><span class="diff-line add">+       {% for host in version_allowed_hosts %}</span><span class="diff-line add">+       # Allow connections from {{ host }}</span><span class="diff-line add">+       host    all             all             {{ &quot;%-18s&quot; | format(host) }}      {{ version_auth_method }}</span><span class="diff-line add">+       {% endfor %}</span><span class="diff-line add">+     owner: &quot;{{ user.name }}&quot;</span><span class="diff-line add">+     group: &quot;{{ user.name }}&quot;</span><span class="diff-line add">+     mode: &#x27;0640&#x27;</span><span class="diff-line add">+ </span><span class="diff-line add">+ - name: Create default user database for version {{ postgres_version }}</span><span class="diff-line add">+   community.postgresql.postgresql_db:</span><span class="diff-line add">+     name: &quot;{{ user.name }}&quot;</span><span class="diff-line add">+     state: present</span><span class="diff-line add">+     login_port: &quot;{{ cluster_port }}&quot;</span><span class="diff-line add">+     login_user: &quot;{{ user.name }}&quot;</span><span class="diff-line add">+   become: true</span><span class="diff-line add">+   become_user: &quot;{{ user.name }}&quot;</span><span class="diff-line add">+ </span><span class="diff-line add">+ - name: Create root superuser for version {{ postgres_version }}</span><span class="diff-line add">+   community.postgresql.postgresql_user:</span><span class="diff-line add">+     name: &quot;{{ postgres_host_role_root_superuser_name }}&quot;</span><span class="diff-line add">+     password: &quot;{{ postgres_host_role_root_superuser_password }}&quot;</span><span class="diff-line add">+     role_attr_flags: SUPERUSER,CREATEDB,CREATEROLE</span><span class="diff-line add">+     state: present</span><span class="diff-line add">+     login_port: &quot;{{ cluster_port }}&quot;</span><span class="diff-line add">+     login_user: &quot;{{ user.name }}&quot;</span><span class="diff-line add">+   become: true</span><span class="diff-line add">+   become_user: &quot;{{ user.name }}&quot;</span><span class="diff-line add">+   no_log: true</span><span class="diff-line add">+   when: (postgres_host_role_create_root_superuser | bool)</span><span class="diff-line add">+ </span><span class="diff-line add">+ - name: Create PostgreSQL users for version {{ postgres_version }}</span><span class="diff-line add">+   community.postgresql.postgresql_user:</span><span class="diff-line add">+     name: &quot;{{ item.name }}&quot;</span><span class="diff-line add">+     password: &quot;{{ item.password }}&quot;</span><span class="diff-line add">+     state: present</span><span class="diff-line add">+     login_port: &quot;{{ cluster_port }}&quot;</span><span class="diff-line add">+     login_user: &quot;{{ user.name }}&quot;</span><span class="diff-line add">+   loop: &quot;{{ version_users }}&quot;</span><span class="diff-line add">+   become: true</span><span class="diff-line add">+   become_user: &quot;{{ user.name }}&quot;</span><span class="diff-line add">+   no_log: true</span><span class="diff-line add">+   when: (version_users | length &gt; 0)</span><span class="diff-line add">+ </span><span class="diff-line add">+ - name: Create PostgreSQL databases for version {{ postgres_version }}</span><span class="diff-line add">+   community.postgresql.postgresql_db:</span><span class="diff-line add">+     name: &quot;{{ item.name }}&quot;</span><span class="diff-line add">+     state: present</span><span class="diff-line add">+     login_port: &quot;{{ cluster_port }}&quot;</span><span class="diff-line add">+     login_user: &quot;{{ user.name }}&quot;</span><span class="diff-line add">+   loop: &quot;{{ version_databases }}&quot;</span><span class="diff-line add">+   become: true</span><span class="diff-line add">+   become_user: &quot;{{ user.name }}&quot;</span><span class="diff-line add">+   when: (version_databases | length &gt; 0)</span><span class="diff-line add">+ </span><span class="diff-line add">+ - name: Grant database privileges to users for version {{ postgres_version }}</span><span class="diff-line add">+   community.postgresql.postgresql_privs:</span><span class="diff-line add">+     login_db: &quot;{{ item.0.name }}&quot;</span><span class="diff-line add">+     roles: &quot;{{ item.1 }}&quot;</span><span class="diff-line add">+     privs: ALL</span><span class="diff-line add">+     type: database</span><span class="diff-line add">+     state: present</span><span class="diff-line add">+     login_port: &quot;{{ cluster_port }}&quot;</span><span class="diff-line add">+     login_user: &quot;{{ user.name }}&quot;</span><span class="diff-line add">+   loop: &quot;{{ version_databases | subelements(&#x27;users&#x27;, skip_missing=True) }}&quot;</span><span class="diff-line add">+   become: true</span><span class="diff-line add">+   become_user: &quot;{{ user.name }}&quot;</span><span class="diff-line add">+   when: (version_databases | length &gt; 0)</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-17">
                <div class="file-header">
                    <span class="badge added">added</span>
                    <h3>roles/pre_tasks/defaults/main.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line add">+ ##########################################################################</span><span class="diff-line add">+ # Title:         Saltbox: pre_tasks | Default Variables                  #</span><span class="diff-line add">+ # Author(s):     salty                                                   #</span><span class="diff-line add">+ # URL:           https://github.com/saltyorg/Saltbox                     #</span><span class="diff-line add">+ # --                                                                     #</span><span class="diff-line add">+ ##########################################################################</span><span class="diff-line add">+ #                   GNU General Public License v3.0                      #</span><span class="diff-line add">+ ##########################################################################</span><span class="diff-line add">+ ---</span><span class="diff-line add">+ pre_tasks_saltbox_mod_location: &quot;{{ server_appdata_path }}/saltbox_mod&quot;</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-18">
                <div class="file-header">
                    <span class="badge added">added</span>
                    <h3>roles/traefik_template/templates/docker-compose.yml.j2</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line add">+ ---</span><span class="diff-line add">+ services:</span><span class="diff-line add">+   {{ traefik_template_name }}:</span><span class="diff-line add">+     container_name: {{ traefik_template_name }}</span><span class="diff-line add">+     environment: # Change this as needed for your image</span><span class="diff-line add">+       PUID: &quot;{{ uid }}&quot;</span><span class="diff-line add">+       PGID: &quot;{{ gid }}&quot;</span><span class="diff-line add">+       TZ: &quot;{{ tz }}&quot;</span><span class="diff-line add">+     hostname: {{ traefik_template_name }}</span><span class="diff-line add">+     image: your_image:your_tag</span><span class="diff-line add">+     labels:</span><span class="diff-line add">+ {% for key, value in docker_labels_common | dictsort %}</span><span class="diff-line add">+       {{ key }}: {{ value }}</span><span class="diff-line add">+ {% endfor %}</span><span class="diff-line add">+ {% if ((service_gluetun_enabled.user_input | lower) | bool) %}</span><span class="diff-line add">+     network_mode: {{ traefik_template_role_docker_network_mode }}</span><span class="diff-line add">+ {% else %}</span><span class="diff-line add">+     networks:</span><span class="diff-line add">+       - saltbox</span><span class="diff-line add">+ {% endif %}</span><span class="diff-line add">+     restart: unless-stopped</span><span class="diff-line add">+     volumes: # Change this as needed for your image</span><span class="diff-line add">+       - {{ server_appdata_path }}/{{ traefik_template_name }}:/config</span><span class="diff-line add">+       - /etc/localtime:/etc/localtime:ro</span><span class="diff-line add">+ </span><span class="diff-line add">+ {% if not ((service_gluetun_enabled.user_input | lower) | bool) %}</span><span class="diff-line add">+ networks:</span><span class="diff-line add">+   saltbox:</span><span class="diff-line add">+     external: true</span><span class="diff-line add">+ {% endif %}</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-19">
                <div class="file-header">
                    <span class="badge added">added</span>
                    <h3>scripts/saltbox-defaults-linter.py</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line add">+ #!/usr/bin/env python3</span><span class="diff-line add">+ &quot;&quot;&quot;</span><span class="diff-line add">+ Saltbox Role Defaults Linter</span><span class="diff-line add">+ Enforces Saltbox formatting rules for role defaults/main.yml files</span><span class="diff-line add">+ </span><span class="diff-line add">+ Rules:</span><span class="diff-line add">+ 1. Operator Alignment: | and + operators must align with first character after &quot;{{</span><span class="diff-line add">+    - Standard: All operators align with base position (first char after &quot;{{ )</span><span class="diff-line add">+    - Exception: When &#x27;else&#x27; is followed by content on a new line that continues,</span><span class="diff-line add">+      subsequent operators within that else branch align with content after &#x27;else &#x27;</span><span class="diff-line add">+    - Context resets when if/else blocks close (marked by )) or )))</span><span class="diff-line add">+ </span><span class="diff-line add">+ 2. If/Else Alignment: if and else keywords must align vertically within {{ }} brackets</span><span class="diff-line add">+ &quot;&quot;&quot;</span><span class="diff-line add">+ </span><span class="diff-line add">+ import re</span><span class="diff-line add">+ import sys</span><span class="diff-line add">+ from pathlib import Path</span><span class="diff-line add">+ from typing import List</span><span class="diff-line add">+ </span><span class="diff-line add">+ </span><span class="diff-line add">+ class LintError:</span><span class="diff-line add">+     &quot;&quot;&quot;Represents a single linting error&quot;&quot;&quot;</span><span class="diff-line add">+ </span><span class="diff-line add">+     def __init__(self, file: str, line: int, message: str, repo_url: str = None, commit_sha: str = None):</span><span class="diff-line add">+         self.file = file</span><span class="diff-line add">+         self.line = line</span><span class="diff-line add">+         self.message = message</span><span class="diff-line add">+         self.repo_url = repo_url</span><span class="diff-line add">+         self.commit_sha = commit_sha</span><span class="diff-line add">+ </span><span class="diff-line add">+     def to_github_annotation(self) -&gt; str:</span><span class="diff-line add">+         &quot;&quot;&quot;</span><span class="diff-line add">+         Format error as GitHub Actions annotation</span><span class="diff-line add">+ </span><span class="diff-line add">+         Includes a clickable link to the file at the specific commit in the message,</span><span class="diff-line add">+         since GitHub&#x27;s default annotation links only point to the commit page</span><span class="diff-line add">+         (which doesn&#x27;t show the file if it wasn&#x27;t modified in that commit).</span><span class="diff-line add">+         &quot;&quot;&quot;</span><span class="diff-line add">+         # Build GitHub blob URL if we have repo and commit info</span><span class="diff-line add">+         if self.repo_url and self.commit_sha:</span><span class="diff-line add">+             # Format: https://github.com/owner/repo/blob/commit_sha/path/to/file.yml#L123</span><span class="diff-line add">+             github_link = f&quot;{self.repo_url}/blob/{self.commit_sha}/{self.file}#L{self.line}&quot;</span><span class="diff-line add">+             message_with_link = f&quot;{self.message} - {github_link}&quot;</span><span class="diff-line add">+         else:</span><span class="diff-line add">+             message_with_link = self.message</span><span class="diff-line add">+ </span><span class="diff-line add">+         return f&quot;::error file={self.file},line={self.line}::{message_with_link}&quot;</span><span class="diff-line add">+ </span><span class="diff-line add">+     def __str__(self) -&gt; str:</span><span class="diff-line add">+         return f&quot;{self.file}:{self.line} - {self.message}&quot;</span><span class="diff-line add">+ </span><span class="diff-line add">+ </span><span class="diff-line add">+ class DefaultsLinter:</span><span class="diff-line add">+     &quot;&quot;&quot;Lints a single defaults/main.yml file&quot;&quot;&quot;</span><span class="diff-line add">+ </span><span class="diff-line add">+     def __init__(self, file_path: Path, repo_url: str = None, commit_sha: str = None):</span><span class="diff-line add">+         self.file_path = file_path</span><span class="diff-line add">+         self.repo_url = repo_url</span><span class="diff-line add">+         self.commit_sha = commit_sha</span><span class="diff-line add">+         self.lines = file_path.read_text().splitlines()</span><span class="diff-line add">+         self.errors: List[LintError] = []</span><span class="diff-line add">+ </span><span class="diff-line add">+     def check_operator_alignment(self):</span><span class="diff-line add">+         &quot;&quot;&quot;</span><span class="diff-line add">+         Rule 1: Check | and + operators align with first character after &#x27;{{ &#x27;</span><span class="diff-line add">+ </span><span class="diff-line add">+         Standard alignment - all operators at base position:</span><span class="diff-line add">+             sonarr_role_docker_envs: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_envs_default&#x27;, role=&#x27;sonarr&#x27;)</span><span class="diff-line add">+                                          | combine(lookup(&#x27;role_var&#x27;, &#x27;_docker_envs_custom&#x27;, role=&#x27;sonarr&#x27;)) }}&quot;</span><span class="diff-line add">+                                          ^ Aligns with &#x27;l&#x27; in lookup (position after &quot;{{ )</span><span class="diff-line add">+ </span><span class="diff-line add">+         Multiple operators - all at same base position:</span><span class="diff-line add">+             wikijs_role_docker_networks: &quot;{{ docker_networks_common</span><span class="diff-line add">+                                              + lookup(&#x27;role_var&#x27;, &#x27;_docker_networks_default&#x27;, role=&#x27;wikijs&#x27;)</span><span class="diff-line add">+                                              + lookup(&#x27;role_var&#x27;, &#x27;_docker_networks_custom&#x27;, role=&#x27;wikijs&#x27;) }}&quot;</span><span class="diff-line add">+                                              ^ All + align with &#x27;d&#x27; in docker_networks_common</span><span class="diff-line add">+ </span><span class="diff-line add">+         Exception - else with continuing content creates new context:</span><span class="diff-line add">+             dozzle_role_docker_commands: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_commands_agent&#x27;, role=&#x27;dozzle&#x27;)</span><span class="diff-line add">+                                              + lookup(&#x27;role_var&#x27;, &#x27;_docker_commands_default&#x27;, role=&#x27;dozzle&#x27;)</span><span class="diff-line add">+                                           if lookup(&#x27;role_var&#x27;, &#x27;_agent_mode&#x27;, role=&#x27;dozzle&#x27;)</span><span class="diff-line add">+                                           else lookup(&#x27;role_var&#x27;, &#x27;_docker_commands_default&#x27;, role=&#x27;dozzle&#x27;)</span><span class="diff-line add">+                                                + lookup(&#x27;role_var&#x27;, &#x27;_docker_commands_custom&#x27;, role=&#x27;dozzle&#x27;) }}&quot;</span><span class="diff-line add">+                                                ^ This + aligns with &#x27;l&#x27; in lookup after &#x27;else &#x27;, not with base</span><span class="diff-line add">+ </span><span class="diff-line add">+         Inline if/else (no context change):</span><span class="diff-line add">+             traefik_role_docker_labels: &quot;{{ docker_labels_saltbox</span><span class="diff-line add">+                                             | combine((lookup(&#x27;role_var&#x27;, &#x27;_docker_labels_http&#x27;, role=&#x27;traefik&#x27;)</span><span class="diff-line add">+                                                       if traefik_http</span><span class="diff-line add">+                                                       else lookup(&#x27;role_var&#x27;, &#x27;_docker_labels_dns&#x27;, role=&#x27;traefik&#x27;)))</span><span class="diff-line add">+                                             | combine(lookup(&#x27;role_var&#x27;, &#x27;_docker_labels_custom&#x27;, role=&#x27;traefik&#x27;)) }}&quot;</span><span class="diff-line add">+                                             ^ All | remain at base position - inline if/else doesn&#x27;t change context</span><span class="diff-line add">+         &quot;&quot;&quot;</span><span class="diff-line add">+         i = 0</span><span class="diff-line add">+         while i &lt; len(self.lines):</span><span class="diff-line add">+             curr_line = self.lines[i]</span><span class="diff-line add">+ </span><span class="diff-line add">+             # Match variable definitions starting multi-line Jinja expressions</span><span class="diff-line add">+             # Pattern: variable_name: &quot;{{ &lt;content&gt;</span><span class="diff-line add">+             match = re.match(r&#x27;^([a-z_]+): &quot;{{ (.+)&#x27;, curr_line)</span><span class="diff-line add">+ </span><span class="diff-line add">+             # Only process if:</span><span class="diff-line add">+             # 1. Line matches pattern</span><span class="diff-line add">+             # 2. Line doesn&#x27;t end with }} (multi-line expression)</span><span class="diff-line add">+             if match and &#x27;}}&#x27; not in curr_line:</span><span class="diff-line add">+                 var_name = match.group(1)</span><span class="diff-line add">+ </span><span class="diff-line add">+                 # This is the start of a multi-line expression</span><span class="diff-line add">+                 # Track the expected alignment position for continuation lines</span><span class="diff-line add">+                 expected_alignment = len(curr_line.split(&#x27;&quot;{{&#x27;)[0] + &#x27;&quot;{{ &#x27;)</span><span class="diff-line add">+ </span><span class="diff-line add">+                 # Now check all continuation lines until we hit }}</span><span class="diff-line add">+                 j = i + 1</span><span class="diff-line add">+                 # Track alignment context - changes when we encounter &#x27;else&#x27; with content</span><span class="diff-line add">+                 # and resets when if/else blocks close</span><span class="diff-line add">+                 current_alignment = expected_alignment</span><span class="diff-line add">+                 in_else_context = False</span><span class="diff-line add">+ </span><span class="diff-line add">+                 while j &lt; len(self.lines):</span><span class="diff-line add">+                     continuation_line = self.lines[j]</span><span class="diff-line add">+ </span><span class="diff-line add">+                     # Check if this line closes an if/else block (ends with )) or }))</span><span class="diff-line add">+                     # This resets alignment context back to base</span><span class="diff-line add">+                     if in_else_context and re.search(r&#x27;\)\)(?:\)|$)&#x27;, continuation_line.rstrip()):</span><span class="diff-line add">+                         current_alignment = expected_alignment</span><span class="diff-line add">+                         in_else_context = False</span><span class="diff-line add">+ </span><span class="diff-line add">+                     # Check if this line starts with &#x27;else&#x27; followed by content that continues</span><span class="diff-line add">+                     # This creates a new alignment context for subsequent operators</span><span class="diff-line add">+                     # Pattern: else followed by lookup/variable (not just closing like &#x27;])&#x27;)</span><span class="diff-line add">+                     # BUT: only if the else block doesn&#x27;t close on the same line</span><span class="diff-line add">+                     else_match = re.match(r&#x27;^(\s+)else (lookup|[a-z_]+)&#x27;, continuation_line)</span><span class="diff-line add">+                     if else_match:</span><span class="diff-line add">+                         # Check if this line also closes the if/else block (contains )))</span><span class="diff-line add">+                         # If so, don&#x27;t set a persistent context</span><span class="diff-line add">+                         closes_immediately = re.search(r&#x27;\)\)\)&#x27;, continuation_line)</span><span class="diff-line add">+ </span><span class="diff-line add">+                         if not closes_immediately:</span><span class="diff-line add">+                             # New alignment context: content after &#x27;else &#x27;</span><span class="diff-line add">+                             # Only persists if the line doesn&#x27;t close the block</span><span class="diff-line add">+                             current_alignment = len(else_match.group(1)) + len(&#x27;else &#x27;)</span><span class="diff-line add">+                             in_else_context = True</span><span class="diff-line add">+ </span><span class="diff-line add">+                     # Check if this line has an operator</span><span class="diff-line add">+                     op_match = re.match(r&#x27;^(\s+)([|+]) &#x27;, continuation_line)</span><span class="diff-line add">+ </span><span class="diff-line add">+                     if op_match:</span><span class="diff-line add">+                         actual_spaces = len(op_match.group(1))</span><span class="diff-line add">+                         operator = op_match.group(2)</span><span class="diff-line add">+ </span><span class="diff-line add">+                         # Use current alignment context (changes after &#x27;else&#x27;, resets after closing parens)</span><span class="diff-line add">+                         expected_spaces = current_alignment</span><span class="diff-line add">+ </span><span class="diff-line add">+                         if actual_spaces != expected_spaces:</span><span class="diff-line add">+                             diff = actual_spaces - expected_spaces</span><span class="diff-line add">+ </span><span class="diff-line add">+                             # Get relative path for GitHub annotation</span><span class="diff-line add">+                             try:</span><span class="diff-line add">+                                 relative_path = str(self.file_path.relative_to(Path.cwd()))</span><span class="diff-line add">+                             except ValueError:</span><span class="diff-line add">+                                 relative_path = str(self.file_path)</span><span class="diff-line add">+ </span><span class="diff-line add">+                             self.errors.append(LintError(</span><span class="diff-line add">+                                 file=relative_path,</span><span class="diff-line add">+                                 line=j + 1,  # Convert to 1-indexed</span><span class="diff-line add">+                                 message=f&quot;[operator-alignment] Variable &#x27;{var_name}&#x27;: Operator &#x27;{operator}&#x27; at column {actual_spaces}, expected {expected_spaces} (off by {diff:+d})&quot;,</span><span class="diff-line add">+                                 repo_url=self.repo_url,</span><span class="diff-line add">+                                 commit_sha=self.commit_sha</span><span class="diff-line add">+                             ))</span><span class="diff-line add">+ </span><span class="diff-line add">+                     # Stop if we&#x27;ve reached the end of the Jinja block</span><span class="diff-line add">+                     if &#x27;}}&#x27; in continuation_line:</span><span class="diff-line add">+                         break</span><span class="diff-line add">+ </span><span class="diff-line add">+                     j += 1</span><span class="diff-line add">+ </span><span class="diff-line add">+                 # Skip ahead past the multi-line block we just processed</span><span class="diff-line add">+                 i = j</span><span class="diff-line add">+ </span><span class="diff-line add">+             i += 1</span><span class="diff-line add">+ </span><span class="diff-line add">+     def check_ifelse_alignment(self):</span><span class="diff-line add">+         &quot;&quot;&quot;</span><span class="diff-line add">+         Rule 2: Check if/else keywords align within same {{ }} brackets</span><span class="diff-line add">+ </span><span class="diff-line add">+         Example:</span><span class="diff-line add">+             variable: &quot;{{ value</span><span class="diff-line add">+                        if condition</span><span class="diff-line add">+                        else other_value }}&quot;</span><span class="diff-line add">+                        ^ if and else must align vertically</span><span class="diff-line add">+         &quot;&quot;&quot;</span><span class="diff-line add">+         in_multiline_jinja = False</span><span class="diff-line add">+         jinja_lines = []</span><span class="diff-line add">+         jinja_start_line = 0</span><span class="diff-line add">+ </span><span class="diff-line add">+         for i, line in enumerate(self.lines, 1):</span><span class="diff-line add">+             # Detect start of multi-line Jinja expression</span><span class="diff-line add">+             if &#x27;&quot;{{&#x27; in line and &#x27;}}&#x27; not in line:</span><span class="diff-line add">+                 in_multiline_jinja = True</span><span class="diff-line add">+                 jinja_lines = [line]</span><span class="diff-line add">+                 jinja_start_line = i</span><span class="diff-line add">+ </span><span class="diff-line add">+             elif in_multiline_jinja:</span><span class="diff-line add">+                 jinja_lines.append(line)</span><span class="diff-line add">+ </span><span class="diff-line add">+                 # Check if we&#x27;ve reached the end of the Jinja block</span><span class="diff-line add">+                 if &#x27;}}&#x27; in line:</span><span class="diff-line add">+                     # Find lines containing &#x27;if&#x27; and &#x27;else&#x27;</span><span class="diff-line add">+                     if_lines = [l for l in jinja_lines if &#x27; if &#x27; in l or l.strip().startswith(&#x27;if &#x27;)]</span><span class="diff-line add">+                     else_lines = [l for l in jinja_lines if &#x27; else &#x27; in l or l.strip().startswith(&#x27;else &#x27;)]</span><span class="diff-line add">+ </span><span class="diff-line add">+                     # Only check if both if and else exist in the same block</span><span class="diff-line add">+                     if if_lines and else_lines:</span><span class="diff-line add">+                         # Find indentation of &#x27;if&#x27; and &#x27;else&#x27; keywords</span><span class="diff-line add">+                         if_indent = None</span><span class="diff-line add">+                         else_indent = None</span><span class="diff-line add">+ </span><span class="diff-line add">+                         for l in jinja_lines:</span><span class="diff-line add">+                             if &#x27; if &#x27; in l:</span><span class="diff-line add">+                                 # Calculate column position where &#x27;if&#x27; appears</span><span class="diff-line add">+                                 if_indent = len(l) - len(l.lstrip())</span><span class="diff-line add">+                             if &#x27; else &#x27; in l or l.strip().startswith(&#x27;else &#x27;):</span><span class="diff-line add">+                                 else_indent = len(l) - len(l.lstrip())</span><span class="diff-line add">+ </span><span class="diff-line add">+                         # Check if if and else align</span><span class="diff-line add">+                         if if_indent is not None and else_indent is not None:</span><span class="diff-line add">+                             if if_indent != else_indent:</span><span class="diff-line add">+                                 diff = else_indent - if_indent</span><span class="diff-line add">+                                 # Get relative path for GitHub annotation</span><span class="diff-line add">+                                 try:</span><span class="diff-line add">+                                     relative_path = str(self.file_path.relative_to(Path.cwd()))</span><span class="diff-line add">+                                 except ValueError:</span><span class="diff-line add">+                                     relative_path = str(self.file_path)</span><span class="diff-line add">+ </span><span class="diff-line add">+                                 self.errors.append(LintError(</span><span class="diff-line add">+                                     file=relative_path,</span><span class="diff-line add">+                                     line=jinja_start_line,</span><span class="diff-line add">+                                     message=f&quot;[ifelse-alignment] &#x27;if&#x27; at column {if_indent} doesn&#x27;t align with &#x27;else&#x27; at column {else_indent} (off by {diff:+d})&quot;,</span><span class="diff-line add">+                                     repo_url=self.repo_url,</span><span class="diff-line add">+                                     commit_sha=self.commit_sha</span><span class="diff-line add">+                                 ))</span><span class="diff-line add">+ </span><span class="diff-line add">+                     # Reset state</span><span class="diff-line add">+                     in_multiline_jinja = False</span><span class="diff-line add">+                     jinja_lines = []</span><span class="diff-line add">+ </span><span class="diff-line add">+     def lint(self) -&gt; List[LintError]:</span><span class="diff-line add">+         &quot;&quot;&quot;Run all lint checks and return list of errors&quot;&quot;&quot;</span><span class="diff-line add">+         self.check_operator_alignment()</span><span class="diff-line add">+         self.check_ifelse_alignment()</span><span class="diff-line add">+         return self.errors</span><span class="diff-line add">+ </span><span class="diff-line add">+ </span><span class="diff-line add">+ def main():</span><span class="diff-line add">+     &quot;&quot;&quot;Main entry point for the linter&quot;&quot;&quot;</span><span class="diff-line add">+     import os</span><span class="diff-line add">+ </span><span class="diff-line add">+     if len(sys.argv) &lt; 2:</span><span class="diff-line add">+         print(&quot;Usage: python3 saltbox-defaults-linter.py &lt;roles_directory&gt;&quot;)</span><span class="diff-line add">+         print(&quot;\nExample:&quot;)</span><span class="diff-line add">+         print(&quot;  python3 saltbox-defaults-linter.py roles/&quot;)</span><span class="diff-line add">+         sys.exit(1)</span><span class="diff-line add">+ </span><span class="diff-line add">+     roles_dir = Path(sys.argv[1])</span><span class="diff-line add">+ </span><span class="diff-line add">+     if not roles_dir.exists():</span><span class="diff-line add">+         print(f&quot;Error: Directory &#x27;{roles_dir}&#x27; does not exist&quot;)</span><span class="diff-line add">+         sys.exit(1)</span><span class="diff-line add">+ </span><span class="diff-line add">+     if not roles_dir.is_dir():</span><span class="diff-line add">+         print(f&quot;Error: &#x27;{roles_dir}&#x27; is not a directory&quot;)</span><span class="diff-line add">+         sys.exit(1)</span><span class="diff-line add">+ </span><span class="diff-line add">+     # Get GitHub repo and commit info from environment variables (set by GitHub Actions)</span><span class="diff-line add">+     # GITHUB_REPOSITORY format: &quot;owner/repo&quot;</span><span class="diff-line add">+     # GITHUB_SHA: commit SHA that triggered the workflow</span><span class="diff-line add">+     github_repo = os.environ.get(&#x27;GITHUB_REPOSITORY&#x27;)</span><span class="diff-line add">+     github_sha = os.environ.get(&#x27;GITHUB_SHA&#x27;)</span><span class="diff-line add">+ </span><span class="diff-line add">+     # Build full repo URL if we have the repository name</span><span class="diff-line add">+     repo_url = f&quot;https://github.com/{github_repo}&quot; if github_repo else None</span><span class="diff-line add">+ </span><span class="diff-line add">+     all_errors = []</span><span class="diff-line add">+     files_checked = 0</span><span class="diff-line add">+ </span><span class="diff-line add">+     # Find and lint all defaults/main.yml files</span><span class="diff-line add">+     for defaults_file in sorted(roles_dir.glob(&quot;*/defaults/main.yml&quot;)):</span><span class="diff-line add">+         linter = DefaultsLinter(defaults_file, repo_url=repo_url, commit_sha=github_sha)</span><span class="diff-line add">+         errors = linter.lint()</span><span class="diff-line add">+         all_errors.extend(errors)</span><span class="diff-line add">+         files_checked += 1</span><span class="diff-line add">+ </span><span class="diff-line add">+     # Output results</span><span class="diff-line add">+     if all_errors:</span><span class="diff-line add">+         print(f&quot; Found {len(all_errors)} formatting error(s) in {files_checked} file(s):\n&quot;)</span><span class="diff-line add">+         for error in all_errors:</span><span class="diff-line add">+             print(error.to_github_annotation())</span><span class="diff-line add">+         print(f&quot;\nTotal: {len(all_errors)} error(s)&quot;)</span><span class="diff-line add">+         sys.exit(1)</span><span class="diff-line add">+     else:</span><span class="diff-line add">+         print(f&quot; All {files_checked} role defaults files pass formatting checks&quot;)</span><span class="diff-line add">+         sys.exit(0)</span><span class="diff-line add">+ </span><span class="diff-line add">+ </span><span class="diff-line add">+ if __name__ == &quot;__main__&quot;:</span><span class="diff-line add">+     main()</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-20">
                <div class="file-header">
                    <span class="badge removed">removed</span>
                    <h3>resources/roles/dns/files/fetch_cloudflare_records.py</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line del">- import argparse</span><span class="diff-line del">- import cloudflare</span><span class="diff-line del">- from cloudflare import Cloudflare</span><span class="diff-line del">- import json</span><span class="diff-line del">- import sys</span><span class="diff-line del">- import datetime</span><span class="diff-line del">- from typing import List, cast</span><span class="diff-line del">- </span><span class="diff-line del">- </span><span class="diff-line del">- class CustomJSONEncoder(json.JSONEncoder):</span><span class="diff-line del">-     def default(self, obj):</span><span class="diff-line del">-         if isinstance(obj, datetime.datetime):</span><span class="diff-line del">-             return obj.strftime(&#x27;%Y-%m-%dT%H:%M:%S.%fZ&#x27;)</span><span class="diff-line del">-         return json.JSONEncoder.default(self, obj)</span><span class="diff-line del">- </span><span class="diff-line del">- </span><span class="diff-line del">- def fetch_dns_records(client: Cloudflare, zone_id: str, record_name: str) -&gt; list:</span><span class="diff-line del">-     try:</span><span class="diff-line del">-         records = client.dns.records.list(zone_id=zone_id, name=record_name).to_dict()</span><span class="diff-line del">-         results = cast(List[dict], records[&quot;result&quot;])</span><span class="diff-line del">-         return results</span><span class="diff-line del">-     except cloudflare.APIConnectionError as e:</span><span class="diff-line del">-         print(f&#x27;Error fetching DNS records: {e}&#x27;, file=sys.stderr)</span><span class="diff-line del">-         raise</span><span class="diff-line del">-     except Exception as e:</span><span class="diff-line del">-         print(f&#x27;Unexpected error: {e}&#x27;, file=sys.stderr)</span><span class="diff-line del">-         raise</span><span class="diff-line del">- </span><span class="diff-line del">- </span><span class="diff-line del">- def get_zone_id(client: Cloudflare, zone_name: str) -&gt; str:</span><span class="diff-line del">-     try:</span><span class="diff-line del">-         zone = client.zones.list(name=zone_name)</span><span class="diff-line del">-         if len(zone.result) == 0:</span><span class="diff-line del">-             raise ValueError(f&#x27;Specified zone: {zone_name} was not found&#x27;)</span><span class="diff-line del">-         return zone.result[0].id</span><span class="diff-line del">-     except cloudflare.APIConnectionError as e:</span><span class="diff-line del">-         print(f&#x27;Error fetching zone ID: {e}&#x27;, file=sys.stderr)</span><span class="diff-line del">-         raise</span><span class="diff-line del">-     except Exception as e:</span><span class="diff-line del">-         print(f&#x27;Unexpected error: {e}&#x27;, file=sys.stderr)</span><span class="diff-line del">-         raise</span><span class="diff-line del">- </span><span class="diff-line del">- </span><span class="diff-line del">- def main():</span><span class="diff-line del">-     parser = argparse.ArgumentParser(</span><span class="diff-line del">-         prog=&#x27;Saltbox Cloudflare Helper&#x27;,</span><span class="diff-line del">-         description=&#x27;Parses Cloudflare Zone Records&#x27;,</span><span class="diff-line del">-         epilog=&#x27;&#x27;)</span><span class="diff-line del">- </span><span class="diff-line del">-     parser.add_argument(&#x27;--auth_key&#x27;, required=True, help=&#x27;API key for Cloudflare&#x27;)</span><span class="diff-line del">-     parser.add_argument(&#x27;--auth_email&#x27;, required=True, help=&#x27;Email associated with Cloudflare account&#x27;)</span><span class="diff-line del">-     parser.add_argument(&#x27;--zone_name&#x27;, required=True, help=&#x27;Name of the Cloudflare zone&#x27;)</span><span class="diff-line del">-     parser.add_argument(&#x27;--record&#x27;, required=True, help=&#x27;DNS record to fetch&#x27;)</span><span class="diff-line del">- </span><span class="diff-line del">-     args = parser.parse_args()</span><span class="diff-line del">- </span><span class="diff-line del">-     cf = Cloudflare(api_email=args.auth_email, api_key=args.auth_key)</span><span class="diff-line del">- </span><span class="diff-line del">-     try:</span><span class="diff-line del">-         zone_id = get_zone_id(cf, args.zone_name)</span><span class="diff-line del">-         print(json.dumps(fetch_dns_records(cf, zone_id, args.record), cls=CustomJSONEncoder))</span><span class="diff-line del">-     except ValueError as e:</span><span class="diff-line del">-         print(f&#x27;Error: {e}&#x27;, file=sys.stderr)</span><span class="diff-line del">-         exit(1)</span><span class="diff-line del">-     except Exception as e:</span><span class="diff-line del">-         print(f&#x27;Failed to fetch DNS records: {e}&#x27;, file=sys.stderr)</span><span class="diff-line del">-         exit(1)</span><span class="diff-line del">- </span><span class="diff-line del">-     exit(0)</span><span class="diff-line del">- </span><span class="diff-line del">- </span><span class="diff-line del">- if __name__ == &#x27;__main__&#x27;:</span><span class="diff-line del">-     main()</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-21">
                <div class="file-header">
                    <span class="badge removed">removed</span>
                    <h3>resources/roles/dns/files/requirements.txt</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line del">- requests==2.32.5</span><span class="diff-line del">- cloudflare==4.3.1</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-22">
                <div class="file-header">
                    <span class="badge removed">removed</span>
                    <h3>resources/roles/dns/tasks/cloudflare/subtasks/checksum.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line del">- #########################################################################</span><span class="diff-line del">- # Title:         Saltbox: DNS | Cloudflare | Checksum                   #</span><span class="diff-line del">- # Author(s):     salty                                                  #</span><span class="diff-line del">- # URL:           https://github.com/saltyorg/Saltbox                    #</span><span class="diff-line del">- # --                                                                    #</span><span class="diff-line del">- #########################################################################</span><span class="diff-line del">- #                   GNU General Public License v3.0                     #</span><span class="diff-line del">- #########################################################################</span><span class="diff-line del">- ---</span><span class="diff-line del">- - name: Cloudflare | Checksum | Get &#x27;fetch_cloudflare_records.py&#x27; checksum</span><span class="diff-line del">-   ansible.builtin.stat:</span><span class="diff-line del">-     path: &quot;{{ resources_path }}/roles/dns/files/fetch_cloudflare_records.py&quot;</span><span class="diff-line del">-     checksum_algorithm: sha256</span><span class="diff-line del">-   register: repo_fetch_cloudflare_records_py_checksum</span><span class="diff-line del">- </span><span class="diff-line del">- - name: Cloudflare | Checksum | Get &#x27;requirements.txt&#x27; checksum</span><span class="diff-line del">-   ansible.builtin.stat:</span><span class="diff-line del">-     path: &quot;{{ resources_path }}/roles/dns/files/requirements.txt&quot;</span><span class="diff-line del">-     checksum_algorithm: sha256</span><span class="diff-line del">-   register: repo_requirements_txt_checksum</span><span class="diff-line del">- </span><span class="diff-line del">- - name: Cloudflare | Checksum | Get installed &#x27;fetch_cloudflare_records.py&#x27; checksum</span><span class="diff-line del">-   ansible.builtin.stat:</span><span class="diff-line del">-     path: &quot;{{ cloudflare_path }}/fetch_cloudflare_records.py&quot;</span><span class="diff-line del">-     checksum_algorithm: sha256</span><span class="diff-line del">-   register: installed_fetch_cloudflare_records_py_checksum</span><span class="diff-line del">- </span><span class="diff-line del">- - name: Cloudflare | Checksum | Get installed &#x27;requirements.txt&#x27; checksum</span><span class="diff-line del">-   ansible.builtin.stat:</span><span class="diff-line del">-     path: &quot;{{ cloudflare_path }}/requirements.txt&quot;</span><span class="diff-line del">-     checksum_algorithm: sha256</span><span class="diff-line del">-   register: installed_requirements_txt_checksum</span><span class="diff-line del">- </span><span class="diff-line del">- - name: Cloudflare | Checksum | Check for updates</span><span class="diff-line del">-   ansible.builtin.set_fact:</span><span class="diff-line del">-     cloudflare_reinstall: true</span><span class="diff-line del">-   when: (not installed_fetch_cloudflare_records_py_checksum.stat.exists) or</span><span class="diff-line del">-         (not installed_requirements_txt_checksum.stat.exists) or</span><span class="diff-line del">-         (repo_fetch_cloudflare_records_py_checksum.stat.checksum != installed_fetch_cloudflare_records_py_checksum.stat.checksum) or</span><span class="diff-line del">-         (repo_requirements_txt_checksum.stat.checksum != installed_requirements_txt_checksum.stat.checksum)</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-23">
                <div class="file-header">
                    <span class="badge removed">removed</span>
                    <h3>resources/roles/dns/tasks/cloudflare/subtasks/python.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line del">- #########################################################################</span><span class="diff-line del">- # Title:         Saltbox: DNS | Cloudflare | Python                     #</span><span class="diff-line del">- # Author(s):     salty                                                  #</span><span class="diff-line del">- # URL:           https://github.com/saltyorg/Saltbox                    #</span><span class="diff-line del">- # --                                                                    #</span><span class="diff-line del">- #########################################################################</span><span class="diff-line del">- #                   GNU General Public License v3.0                     #</span><span class="diff-line del">- #########################################################################</span><span class="diff-line del">- ---</span><span class="diff-line del">- - name: &quot;Cloudflare | Python | Verify Python {{ cloudflare_python_version }} installation&quot;</span><span class="diff-line del">-   ansible.builtin.command: &quot;{{ python_bin }} python find {{ cloudflare_python_version }} --managed-python&quot;</span><span class="diff-line del">-   register: cloudflare_uv_python_path</span><span class="diff-line del">-   changed_when: false</span><span class="diff-line del">-   failed_when: false</span><span class="diff-line del">-   environment: &quot;{{ python_environment }}&quot;</span><span class="diff-line del">-   become: true</span><span class="diff-line del">-   become_user: &quot;{{ user.name }}&quot;</span><span class="diff-line del">- </span><span class="diff-line del">- - name: &quot;Cloudflare | Python | Check if Python needs upgrading&quot;</span><span class="diff-line del">-   ansible.builtin.set_fact:</span><span class="diff-line del">-     cloudflare_reinstall: &quot;{{ (cloudflare_uv_python_path.rc != 0)</span><span class="diff-line del">-                               or (cloudflare_folder_symlink.stat.lnk_target is defined</span><span class="diff-line del">-                                  and (cloudflare_folder_symlink.stat.lnk_target != cloudflare_uv_python_path.stdout)) }}&quot;</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-24">
                <div class="file-header">
                    <span class="badge removed">removed</span>
                    <h3>resources/roles/dns/tasks/cloudflare/subtasks/setup.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line del">- #########################################################################</span><span class="diff-line del">- # Title:         Saltbox: DNS | Cloudflare | Setup                      #</span><span class="diff-line del">- # Author(s):     salty                                                  #</span><span class="diff-line del">- # URL:           https://github.com/saltyorg/Saltbox                    #</span><span class="diff-line del">- # --                                                                    #</span><span class="diff-line del">- #########################################################################</span><span class="diff-line del">- #                   GNU General Public License v3.0                     #</span><span class="diff-line del">- #########################################################################</span><span class="diff-line del">- ---</span><span class="diff-line del">- - name: Cloudflare | Setup | Setup venv block</span><span class="diff-line del">-   block:</span><span class="diff-line del">-     - name: Cloudflare | Setup | Cleanup folder</span><span class="diff-line del">-       ansible.builtin.file:</span><span class="diff-line del">-         path: &quot;{{ cloudflare_path }}&quot;</span><span class="diff-line del">-         state: absent</span><span class="diff-line del">- </span><span class="diff-line del">-     - name: Cloudflare | Setup | Create directory</span><span class="diff-line del">-       ansible.builtin.file:</span><span class="diff-line del">-         path: &quot;{{ cloudflare_path }}&quot;</span><span class="diff-line del">-         state: directory</span><span class="diff-line del">-         owner: &quot;{{ user.name }}&quot;</span><span class="diff-line del">-         group: &quot;{{ user.name }}&quot;</span><span class="diff-line del">-         mode: &quot;0775&quot;</span><span class="diff-line del">-         recurse: true</span><span class="diff-line del">- </span><span class="diff-line del">-     - name: Cloudflare | Setup | Import Cloudflare files</span><span class="diff-line del">-       ansible.builtin.copy:</span><span class="diff-line del">-         src: &quot;{{ item }}&quot;</span><span class="diff-line del">-         force: true</span><span class="diff-line del">-         dest: &quot;{{ cloudflare_path }}/{{ item | basename }}&quot;</span><span class="diff-line del">-         owner: &quot;{{ user.name }}&quot;</span><span class="diff-line del">-         group: &quot;{{ user.name }}&quot;</span><span class="diff-line del">-         mode: &quot;0664&quot;</span><span class="diff-line del">-       with_items: &quot;{{ cloudflare_files }}&quot;</span><span class="diff-line del">- </span><span class="diff-line del">-     - name: Cloudflare | Setup | Execute Python role</span><span class="diff-line del">-       ansible.builtin.include_role:</span><span class="diff-line del">-         name: &quot;python&quot;</span><span class="diff-line del">-       vars:</span><span class="diff-line del">-         python_version: &quot;{{ cloudflare_python_version }}&quot;</span><span class="diff-line del">- </span><span class="diff-line del">-     - name: &quot;Cloudflare | Setup | Lookup Python {{ cloudflare_python_version }} installation&quot;</span><span class="diff-line del">-       ansible.builtin.command: &quot;{{ python_bin }} python find {{ cloudflare_python_version }} --managed-python&quot;</span><span class="diff-line del">-       register: cloudflare_python_install_path_lookup</span><span class="diff-line del">-       changed_when: false</span><span class="diff-line del">-       environment: &quot;{{ python_environment }}&quot;</span><span class="diff-line del">-       become: true</span><span class="diff-line del">-       become_user: &quot;{{ user.name }}&quot;</span><span class="diff-line del">- </span><span class="diff-line del">-     - name: Cloudflare | Setup | Set Python version</span><span class="diff-line del">-       ansible.builtin.set_fact:</span><span class="diff-line del">-         cloudflare_python_install_path: &quot;{{ cloudflare_python_install_path_lookup.stdout }}&quot;</span><span class="diff-line del">- </span><span class="diff-line del">-     - name: Cloudflare | Setup | Delete venv folder</span><span class="diff-line del">-       ansible.builtin.file:</span><span class="diff-line del">-         path: &quot;{{ cloudflare_venv_path }}&quot;</span><span class="diff-line del">-         state: absent</span><span class="diff-line del">- </span><span class="diff-line del">-     - name: Cloudflare | Create venv</span><span class="diff-line del">-       ansible.builtin.command:</span><span class="diff-line del">-         cmd: &quot;{{ cloudflare_python_install_path }} -m venv {{ cloudflare_venv_path }}&quot;</span><span class="diff-line del">-       args:</span><span class="diff-line del">-         creates: &quot;{{ cloudflare_venv_path }}&quot;</span><span class="diff-line del">-       become: true</span><span class="diff-line del">-       become_user: &quot;{{ user.name }}&quot;</span><span class="diff-line del">- </span><span class="diff-line del">-     - name: Cloudflare | Install pip requirements</span><span class="diff-line del">-       ansible.builtin.pip:</span><span class="diff-line del">-         requirements: &quot;{{ cloudflare_requirements_path }}&quot;</span><span class="diff-line del">-         virtualenv: &quot;{{ cloudflare_venv_path }}&quot;</span><span class="diff-line del">-         virtualenv_command: &quot;{{ cloudflare_venv_path }}/bin/python3 -m pip&quot;</span><span class="diff-line del">-       become: true</span><span class="diff-line del">-       become_user: &quot;{{ user.name }}&quot;</span><span class="diff-line del">- </span><span class="diff-line del">-   rescue:</span><span class="diff-line del">-     - name: Cloudflare | Setup | Delete venv folder</span><span class="diff-line del">-       ansible.builtin.file:</span><span class="diff-line del">-         path: &quot;{{ cloudflare_venv_path }}&quot;</span><span class="diff-line del">-         state: absent</span><span class="diff-line del">- </span><span class="diff-line del">-     - name: Cloudflare | Setup | Print Failure</span><span class="diff-line del">-       ansible.builtin.fail:</span><span class="diff-line del">-         msg:</span><span class="diff-line del">-           - &quot;Setting up the Cloudflare venv failed for some reason.&quot;</span><span class="diff-line del">-           - &quot;This usually means issues with apt. Make sure &#x27;sudo apt update&#x27; and &#x27;sudo apt upgrade&#x27; works before retrying.&quot;</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-25">
                <div class="file-header">
                    <span class="badge removed">removed</span>
                    <h3>resources/tasks/instances/readarr.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line del">- ############################################################################</span><span class="diff-line del">- # Title:         Saltbox: Resources | Tasks | Instances | Get Readarr Info #</span><span class="diff-line del">- # Author(s):     salty                                                     #</span><span class="diff-line del">- # URL:           https://github.com/saltyorg/Saltbox                       #</span><span class="diff-line del">- # --                                                                       #</span><span class="diff-line del">- ############################################################################</span><span class="diff-line del">- #                   GNU General Public License v3.0                        #</span><span class="diff-line del">- ############################################################################</span><span class="diff-line del">- ---</span><span class="diff-line del">- - name: Resources | Tasks | Instances | Get Info | Check if Readarr exists</span><span class="diff-line del">-   ansible.builtin.stat:</span><span class="diff-line del">-     path: &quot;{{ readarr_paths_config_location }}&quot;</span><span class="diff-line del">-   register: readarr_paths_config_location_stat</span><span class="diff-line del">- </span><span class="diff-line del">- - name: Resources | Tasks | Instances | Get Info | Readarr API Key tasks</span><span class="diff-line del">-   when: readarr_paths_config_location_stat.stat.exists</span><span class="diff-line del">-   block:</span><span class="diff-line del">-     - name: Resources | Tasks | Instances | Get Info | Fetch Readarr API Key</span><span class="diff-line del">-       community.general.xml:</span><span class="diff-line del">-         path: &quot;{{ readarr_paths_config_location }}&quot;</span><span class="diff-line del">-         xpath: /Config/ApiKey</span><span class="diff-line del">-         content: text</span><span class="diff-line del">-       register: xmlresp</span><span class="diff-line del">- </span><span class="diff-line del">-     - name: Resources | Tasks | Instances | Get Info | Set &#x27;readarr_info&#x27; variable</span><span class="diff-line del">-       ansible.builtin.set_fact:</span><span class="diff-line del">-         readarr_info: &quot;{{ readarr_info | default({}) | combine({readarr_name: {&#x27;name&#x27;: readarr_name, &#x27;url&#x27;: readarr_web_url, &#x27;api_key&#x27;: xmlresp.matches[0].ApiKey}}) }}&quot;</span><span class="diff-line del">- </span><span class="diff-line del">- - name: Resources | Tasks | Instances | Get Info | Set &#x27;readarr_info&#x27; variable</span><span class="diff-line del">-   ansible.builtin.set_fact:</span><span class="diff-line del">-     readarr_info: &quot;{{ readarr_info | default({}) | combine({readarr_name: {&#x27;name&#x27;: readarr_name, &#x27;url&#x27;: readarr_web_url, &#x27;api_key&#x27;: &#x27;not installed&#x27;}}) }}&quot;</span><span class="diff-line del">-   when: (not readarr_paths_config_location_stat.stat.exists)</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-26">
                <div class="file-header">
                    <span class="badge removed">removed</span>
                    <h3>roles/autobrr/templates/config.toml.j2</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line del">- # config.toml</span><span class="diff-line del">- </span><span class="diff-line del">- # Hostname / IP</span><span class="diff-line del">- #</span><span class="diff-line del">- # Default: &quot;localhost&quot;</span><span class="diff-line del">- #</span><span class="diff-line del">- host = &quot;0.0.0.0&quot;</span><span class="diff-line del">- </span><span class="diff-line del">- # Port</span><span class="diff-line del">- #</span><span class="diff-line del">- # Default: 7474</span><span class="diff-line del">- #</span><span class="diff-line del">- port = 7474</span><span class="diff-line del">- </span><span class="diff-line del">- # Base url</span><span class="diff-line del">- # Set custom baseUrl eg /autobrr/ to serve in subdirectory.</span><span class="diff-line del">- # Not needed for subdomain, or by accessing with the :port directly.</span><span class="diff-line del">- #</span><span class="diff-line del">- # Optional</span><span class="diff-line del">- #</span><span class="diff-line del">- #baseUrl = &quot;/autobrr/&quot;</span><span class="diff-line del">- </span><span class="diff-line del">- # autobrr logs file</span><span class="diff-line del">- # If not defined, logs to stdout</span><span class="diff-line del">- #</span><span class="diff-line del">- # Optional</span><span class="diff-line del">- #</span><span class="diff-line del">- logPath = &quot;log/autobrr.log&quot;</span><span class="diff-line del">- </span><span class="diff-line del">- # Log level</span><span class="diff-line del">- #</span><span class="diff-line del">- # Default: &quot;DEBUG&quot;</span><span class="diff-line del">- #</span><span class="diff-line del">- # Options: &quot;ERROR&quot;, &quot;DEBUG&quot;, &quot;INFO&quot;, &quot;WARN&quot;, &quot;TRACE&quot;</span><span class="diff-line del">- #</span><span class="diff-line del">- logLevel = &quot;INFO&quot;</span><span class="diff-line del">- </span><span class="diff-line del">- # Session secret</span><span class="diff-line del">- # Can be generated by running: head /dev/urandom | tr -dc A-Za-z0-9 | head -c16</span><span class="diff-line del">- sessionSecret = &quot;{{ autobrr_secret.stdout }}&quot;</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-27">
                <div class="file-header">
                    <span class="badge removed">removed</span>
                    <h3>roles/cloudplow/tasks/subtasks/disable.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line del">- #########################################################################</span><span class="diff-line del">- # Title:         Saltbox: Cloudplow | Disable Task                      #</span><span class="diff-line del">- # Author(s):     salty                                                  #</span><span class="diff-line del">- # URL:           https://github.com/saltyorg/Saltbox                    #</span><span class="diff-line del">- # --                                                                    #</span><span class="diff-line del">- #########################################################################</span><span class="diff-line del">- #                   GNU General Public License v3.0                     #</span><span class="diff-line del">- #########################################################################</span><span class="diff-line del">- ---</span><span class="diff-line del">- - name: Delete Service</span><span class="diff-line del">-   ansible.builtin.include_tasks: &quot;{{ resources_tasks_path }}/systemd/delete_service.yml&quot;</span><span class="diff-line del">-   vars:</span><span class="diff-line del">-     _service_name: &quot;{{ cloudplow_service_name }}&quot;</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-28">
                <div class="file-header">
                    <span class="badge removed">removed</span>
                    <h3>roles/diag/files/cloudflare_ssl.py</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line del">- import argparse</span><span class="diff-line del">- import cloudflare</span><span class="diff-line del">- from cloudflare import Cloudflare</span><span class="diff-line del">- </span><span class="diff-line del">- </span><span class="diff-line del">- def get_zone_id(client: Cloudflare, zone_name: str) -&gt; str:</span><span class="diff-line del">-     try:</span><span class="diff-line del">-         zone = client.zones.list(name=zone_name)</span><span class="diff-line del">-         if len(zone.result) == 0:</span><span class="diff-line del">-             raise ValueError(f&#x27;Specified zone: {zone_name} was not found&#x27;)</span><span class="diff-line del">-         return zone.result[0].id</span><span class="diff-line del">-     except cloudflare.APIConnectionError as e:</span><span class="diff-line del">-         exit(f&#x27;Error fetching zone ID: {e}&#x27;)</span><span class="diff-line del">-     except Exception as e:</span><span class="diff-line del">-         exit(f&#x27;Unexpected error: {e}&#x27;)</span><span class="diff-line del">- </span><span class="diff-line del">- </span><span class="diff-line del">- def get_ssl_tls_mode(auth_email, auth_key, zone_name):</span><span class="diff-line del">-     cf = Cloudflare(api_email=auth_email, api_key=auth_key)</span><span class="diff-line del">- </span><span class="diff-line del">-     zone_id = get_zone_id(cf, zone_name)</span><span class="diff-line del">- </span><span class="diff-line del">-     # Get the SSL/TLS settings for the zone</span><span class="diff-line del">-     try:</span><span class="diff-line del">-         ssl_settings = cf.zones.settings.get(setting_id=&#x27;ssl&#x27;, zone_id=zone_id).to_dict()</span><span class="diff-line del">-         ssl_mode = ssl_settings[&#x27;value&#x27;]</span><span class="diff-line del">-         print(f&quot;{ssl_mode}&quot;)</span><span class="diff-line del">-     except cloudflare.APIConnectionError as e:</span><span class="diff-line del">-         exit(f&#x27;/zones/settings/ssl.get - {e} - API call failed&#x27;)</span><span class="diff-line del">-     except Exception as e:</span><span class="diff-line del">-         exit(f&#x27;/zones/settings/ssl.get - {e} - API call failed&#x27;)</span><span class="diff-line del">- </span><span class="diff-line del">- </span><span class="diff-line del">- def main():</span><span class="diff-line del">-     parser = argparse.ArgumentParser(</span><span class="diff-line del">-         prog=&#x27;SSL/TLS Mode Checker&#x27;,</span><span class="diff-line del">-         description=&#x27;Retrieves Cloudflare SSL/TLS Encryption Mode for a Zone&#x27;,</span><span class="diff-line del">-         epilog=&#x27;&#x27;)</span><span class="diff-line del">- </span><span class="diff-line del">-     parser.add_argument(&#x27;--auth_key&#x27;, required=True, help=&#x27;Cloudflare API key&#x27;)</span><span class="diff-line del">-     parser.add_argument(&#x27;--auth_email&#x27;, required=True, help=&#x27;Cloudflare account email&#x27;)</span><span class="diff-line del">-     parser.add_argument(&#x27;--zone_name&#x27;, required=True, help=&#x27;Name of the Cloudflare zone&#x27;)</span><span class="diff-line del">- </span><span class="diff-line del">-     args = parser.parse_args()</span><span class="diff-line del">- </span><span class="diff-line del">-     get_ssl_tls_mode(args.auth_email, args.auth_key, args.zone_name)</span><span class="diff-line del">- </span><span class="diff-line del">- </span><span class="diff-line del">- if __name__ == &#x27;__main__&#x27;:</span><span class="diff-line del">-     main()</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-29">
                <div class="file-header">
                    <span class="badge removed">removed</span>
                    <h3>roles/jaeger/defaults/main.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line del">- ##########################################################################</span><span class="diff-line del">- # Title:         Saltbox: Jaeger | Default Variables                     #</span><span class="diff-line del">- # Author(s):     salty                                                   #</span><span class="diff-line del">- # URL:           https://github.com/saltyorg/Saltbox                     #</span><span class="diff-line del">- # --                                                                     #</span><span class="diff-line del">- ##########################################################################</span><span class="diff-line del">- #                   GNU General Public License v3.0                      #</span><span class="diff-line del">- ##########################################################################</span><span class="diff-line del">- ---</span><span class="diff-line del">- ################################</span><span class="diff-line del">- # Basics</span><span class="diff-line del">- ################################</span><span class="diff-line del">- </span><span class="diff-line del">- jaeger_name: jaeger</span><span class="diff-line del">- </span><span class="diff-line del">- ################################</span><span class="diff-line del">- # Paths</span><span class="diff-line del">- ################################</span><span class="diff-line del">- </span><span class="diff-line del">- jaeger_paths_folder: &quot;{{ jaeger_name }}&quot;</span><span class="diff-line del">- jaeger_paths_location: &quot;{{ server_appdata_path }}/{{ jaeger_paths_folder }}&quot;</span><span class="diff-line del">- jaeger_paths_folders_list:</span><span class="diff-line del">-   - &quot;{{ jaeger_paths_location }}&quot;</span><span class="diff-line del">- </span><span class="diff-line del">- ################################</span><span class="diff-line del">- # Web</span><span class="diff-line del">- ################################</span><span class="diff-line del">- </span><span class="diff-line del">- jaeger_web_subdomain: &quot;{{ jaeger_name }}&quot;</span><span class="diff-line del">- jaeger_web_domain: &quot;{{ user.domain }}&quot;</span><span class="diff-line del">- jaeger_web_port: &quot;16686&quot;</span><span class="diff-line del">- jaeger_web_url: &quot;{{ &#x27;https://&#x27; + (jaeger_web_subdomain + &#x27;.&#x27; + jaeger_web_domain</span><span class="diff-line del">-                  if (jaeger_web_subdomain | length &gt; 0)</span><span class="diff-line del">-                  else jaeger_web_domain) }}&quot;</span><span class="diff-line del">- </span><span class="diff-line del">- ################################</span><span class="diff-line del">- # DNS</span><span class="diff-line del">- ################################</span><span class="diff-line del">- </span><span class="diff-line del">- jaeger_dns_record: &quot;{{ jaeger_web_subdomain }}&quot;</span><span class="diff-line del">- jaeger_dns_zone: &quot;{{ jaeger_web_domain }}&quot;</span><span class="diff-line del">- jaeger_dns_proxy: &quot;{{ dns.proxied }}&quot;</span><span class="diff-line del">- </span><span class="diff-line del">- ################################</span><span class="diff-line del">- # Traefik</span><span class="diff-line del">- ################################</span><span class="diff-line del">- </span><span class="diff-line del">- jaeger_traefik_sso_middleware: &quot;{{ traefik_default_sso_middleware }}&quot;</span><span class="diff-line del">- jaeger_traefik_middleware_default: &quot;{{ traefik_default_middleware }}&quot;</span><span class="diff-line del">- jaeger_traefik_middleware_custom: &quot;&quot;</span><span class="diff-line del">- jaeger_traefik_certresolver: &quot;{{ traefik_default_certresolver }}&quot;</span><span class="diff-line del">- jaeger_traefik_enabled: true</span><span class="diff-line del">- jaeger_traefik_api_enabled: false</span><span class="diff-line del">- jaeger_traefik_api_endpoint: &quot;&quot;</span><span class="diff-line del">- </span><span class="diff-line del">- ################################</span><span class="diff-line del">- # Docker</span><span class="diff-line del">- ################################</span><span class="diff-line del">- </span><span class="diff-line del">- # Container</span><span class="diff-line del">- jaeger_docker_container: &quot;{{ jaeger_name }}&quot;</span><span class="diff-line del">- </span><span class="diff-line del">- # Image</span><span class="diff-line del">- jaeger_docker_image_pull: true</span><span class="diff-line del">- jaeger_docker_image_tag: &quot;latest&quot;</span><span class="diff-line del">- jaeger_docker_image: &quot;jaegertracing/all-in-one:{{ jaeger_docker_image_tag }}&quot;</span><span class="diff-line del">- </span><span class="diff-line del">- # Ports</span><span class="diff-line del">- jaeger_docker_ports_defaults: []</span><span class="diff-line del">- jaeger_docker_ports_custom: []</span><span class="diff-line del">- jaeger_docker_ports: &quot;{{ jaeger_docker_ports_defaults</span><span class="diff-line del">-                          + jaeger_docker_ports_custom }}&quot;</span><span class="diff-line del">- </span><span class="diff-line del">- # Envs</span><span class="diff-line del">- jaeger_docker_envs_default:</span><span class="diff-line del">-   TZ: &quot;{{ tz }}&quot;</span><span class="diff-line del">-   COLLECTOR_ZIPKIN_HTTP_PORT: &quot;9411&quot;</span><span class="diff-line del">- jaeger_docker_envs_custom: {}</span><span class="diff-line del">- jaeger_docker_envs: &quot;{{ jaeger_docker_envs_default</span><span class="diff-line del">-                         | combine(jaeger_docker_envs_custom) }}&quot;</span><span class="diff-line del">- </span><span class="diff-line del">- # Commands</span><span class="diff-line del">- jaeger_docker_commands_default: []</span><span class="diff-line del">- jaeger_docker_commands_custom: []</span><span class="diff-line del">- jaeger_docker_commands: &quot;{{ jaeger_docker_commands_default</span><span class="diff-line del">-                             + jaeger_docker_commands_custom }}&quot;</span><span class="diff-line del">- </span><span class="diff-line del">- # Volumes</span><span class="diff-line del">- jaeger_docker_volumes_default: []</span><span class="diff-line del">- jaeger_docker_volumes_custom: []</span><span class="diff-line del">- jaeger_docker_volumes: &quot;{{ jaeger_docker_volumes_default</span><span class="diff-line del">-                            + jaeger_docker_volumes_custom }}&quot;</span><span class="diff-line del">- </span><span class="diff-line del">- # Devices</span><span class="diff-line del">- jaeger_docker_devices_default: []</span><span class="diff-line del">- jaeger_docker_devices_custom: []</span><span class="diff-line del">- jaeger_docker_devices: &quot;{{ jaeger_docker_devices_default</span><span class="diff-line del">-                            + jaeger_docker_devices_custom }}&quot;</span><span class="diff-line del">- </span><span class="diff-line del">- # Hosts</span><span class="diff-line del">- jaeger_docker_hosts_default: {}</span><span class="diff-line del">- jaeger_docker_hosts_custom: {}</span><span class="diff-line del">- jaeger_docker_hosts: &quot;{{ docker_hosts_common</span><span class="diff-line del">-                          | combine(jaeger_docker_hosts_default)</span><span class="diff-line del">-                          | combine(jaeger_docker_hosts_custom) }}&quot;</span><span class="diff-line del">- </span><span class="diff-line del">- # Labels</span><span class="diff-line del">- jaeger_docker_labels_default: {}</span><span class="diff-line del">- jaeger_docker_labels_custom: {}</span><span class="diff-line del">- jaeger_docker_labels: &quot;{{ docker_labels_common</span><span class="diff-line del">-                           | combine(jaeger_docker_labels_default)</span><span class="diff-line del">-                           | combine(jaeger_docker_labels_custom) }}&quot;</span><span class="diff-line del">- </span><span class="diff-line del">- # Hostname</span><span class="diff-line del">- jaeger_docker_hostname: &quot;{{ jaeger_name }}&quot;</span><span class="diff-line del">- </span><span class="diff-line del">- # Networks</span><span class="diff-line del">- jaeger_docker_networks_alias: &quot;{{ jaeger_name }}&quot;</span><span class="diff-line del">- jaeger_docker_networks_default: []</span><span class="diff-line del">- jaeger_docker_networks_custom: []</span><span class="diff-line del">- jaeger_docker_networks: &quot;{{ docker_networks_common</span><span class="diff-line del">-                             + jaeger_docker_networks_default</span><span class="diff-line del">-                             + jaeger_docker_networks_custom }}&quot;</span><span class="diff-line del">- </span><span class="diff-line del">- # Capabilities</span><span class="diff-line del">- jaeger_docker_capabilities_default: []</span><span class="diff-line del">- jaeger_docker_capabilities_custom: []</span><span class="diff-line del">- jaeger_docker_capabilities: &quot;{{ jaeger_docker_capabilities_default</span><span class="diff-line del">-                                 + jaeger_docker_capabilities_custom }}&quot;</span><span class="diff-line del">- </span><span class="diff-line del">- # Security Opts</span><span class="diff-line del">- jaeger_docker_security_opts_default: []</span><span class="diff-line del">- jaeger_docker_security_opts_custom: []</span><span class="diff-line del">- jaeger_docker_security_opts: &quot;{{ jaeger_docker_security_opts_default</span><span class="diff-line del">-                                  + jaeger_docker_security_opts_custom }}&quot;</span><span class="diff-line del">- </span><span class="diff-line del">- # Restart Policy</span><span class="diff-line del">- jaeger_docker_restart_policy: unless-stopped</span><span class="diff-line del">- </span><span class="diff-line del">- # State</span><span class="diff-line del">- jaeger_docker_state: started</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-30">
                <div class="file-header">
                    <span class="badge removed">removed</span>
                    <h3>roles/jaeger/tasks/main.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line del">- #########################################################################</span><span class="diff-line del">- # Title:         Saltbox: Jaeger Role                                   #</span><span class="diff-line del">- # Author(s):     salty                                                  #</span><span class="diff-line del">- # URL:           https://github.com/saltyorg/Saltbox                    #</span><span class="diff-line del">- # --                                                                    #</span><span class="diff-line del">- #########################################################################</span><span class="diff-line del">- #                   GNU General Public License v3.0                     #</span><span class="diff-line del">- #########################################################################</span><span class="diff-line del">- ---</span><span class="diff-line del">- - name: Add DNS record</span><span class="diff-line del">-   ansible.builtin.include_tasks: &quot;{{ resources_tasks_path }}/dns/tasker.yml&quot;</span><span class="diff-line del">-   vars:</span><span class="diff-line del">-     dns_record: &quot;{{ lookup(&#x27;vars&#x27;, role_name + &#x27;_dns_record&#x27;) }}&quot;</span><span class="diff-line del">-     dns_zone: &quot;{{ lookup(&#x27;vars&#x27;, role_name + &#x27;_dns_zone&#x27;) }}&quot;</span><span class="diff-line del">-     dns_proxy: &quot;{{ lookup(&#x27;vars&#x27;, role_name + &#x27;_dns_proxy&#x27;) }}&quot;</span><span class="diff-line del">- </span><span class="diff-line del">- - name: Remove existing Docker container</span><span class="diff-line del">-   ansible.builtin.include_tasks: &quot;{{ resources_tasks_path }}/docker/remove_docker_container.yml&quot;</span><span class="diff-line del">- </span><span class="diff-line del">- - name: Create directories</span><span class="diff-line del">-   ansible.builtin.include_tasks: &quot;{{ resources_tasks_path }}/directories/create_directories.yml&quot;</span><span class="diff-line del">- </span><span class="diff-line del">- - name: Create Docker container</span><span class="diff-line del">-   ansible.builtin.include_tasks: &quot;{{ resources_tasks_path }}/docker/create_docker_container.yml&quot;</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-31">
                <div class="file-header">
                    <span class="badge removed">removed</span>
                    <h3>roles/readarr/defaults/main.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line del">- ##########################################################################</span><span class="diff-line del">- # Title:         Saltbox: Readarr | Default Variables                    #</span><span class="diff-line del">- # Author(s):     salty                                                   #</span><span class="diff-line del">- # URL:           https://github.com/saltyorg/Saltbox                     #</span><span class="diff-line del">- # --                                                                     #</span><span class="diff-line del">- ##########################################################################</span><span class="diff-line del">- #                   GNU General Public License v3.0                      #</span><span class="diff-line del">- ##########################################################################</span><span class="diff-line del">- ---</span><span class="diff-line del">- ################################</span><span class="diff-line del">- # Basics</span><span class="diff-line del">- ################################</span><span class="diff-line del">- </span><span class="diff-line del">- readarr_instances: [&quot;readarr&quot;]</span><span class="diff-line del">- </span><span class="diff-line del">- ################################</span><span class="diff-line del">- # Settings</span><span class="diff-line del">- ################################</span><span class="diff-line del">- </span><span class="diff-line del">- readarr_external_auth: true</span><span class="diff-line del">- </span><span class="diff-line del">- ################################</span><span class="diff-line del">- # Paths</span><span class="diff-line del">- ################################</span><span class="diff-line del">- </span><span class="diff-line del">- readarr_paths_folder: &quot;{{ readarr_name }}&quot;</span><span class="diff-line del">- readarr_paths_location: &quot;{{ server_appdata_path }}/{{ readarr_paths_folder }}&quot;</span><span class="diff-line del">- readarr_paths_folders_list:</span><span class="diff-line del">-   - &quot;{{ readarr_paths_location }}&quot;</span><span class="diff-line del">-   - &quot;/mnt/local/Media/Books&quot;</span><span class="diff-line del">- readarr_paths_config_location: &quot;{{ readarr_paths_location }}/config.xml&quot;</span><span class="diff-line del">- </span><span class="diff-line del">- ################################</span><span class="diff-line del">- # Web</span><span class="diff-line del">- ################################</span><span class="diff-line del">- </span><span class="diff-line del">- readarr_web_subdomain: &quot;{{ readarr_name }}&quot;</span><span class="diff-line del">- readarr_web_domain: &quot;{{ user.domain }}&quot;</span><span class="diff-line del">- readarr_web_port: &quot;8787&quot;</span><span class="diff-line del">- readarr_web_url: &quot;{{ &#x27;https://&#x27; + (lookup(&#x27;vars&#x27;, readarr_name + &#x27;_web_subdomain&#x27;, default=readarr_web_subdomain) + &#x27;.&#x27; + lookup(&#x27;vars&#x27;, readarr_name + &#x27;_web_domain&#x27;, default=readarr_web_domain)</span><span class="diff-line del">-                   if (lookup(&#x27;vars&#x27;, readarr_name + &#x27;_web_subdomain&#x27;, default=readarr_web_subdomain) | length &gt; 0)</span><span class="diff-line del">-                   else lookup(&#x27;vars&#x27;, readarr_name + &#x27;_web_domain&#x27;, default=readarr_web_domain)) }}&quot;</span><span class="diff-line del">- </span><span class="diff-line del">- ################################</span><span class="diff-line del">- # DNS</span><span class="diff-line del">- ################################</span><span class="diff-line del">- </span><span class="diff-line del">- readarr_dns_record: &quot;{{ lookup(&#x27;vars&#x27;, readarr_name + &#x27;_web_subdomain&#x27;, default=readarr_web_subdomain) }}&quot;</span><span class="diff-line del">- readarr_dns_zone: &quot;{{ lookup(&#x27;vars&#x27;, readarr_name + &#x27;_web_domain&#x27;, default=readarr_web_domain) }}&quot;</span><span class="diff-line del">- readarr_dns_proxy: &quot;{{ dns.proxied }}&quot;</span><span class="diff-line del">- </span><span class="diff-line del">- ################################</span><span class="diff-line del">- # Traefik</span><span class="diff-line del">- ################################</span><span class="diff-line del">- </span><span class="diff-line del">- readarr_traefik_sso_middleware: &quot;{{ traefik_default_sso_middleware }}&quot;</span><span class="diff-line del">- readarr_traefik_middleware_default: &quot;{{ traefik_default_middleware</span><span class="diff-line del">-                                         + (&#x27;,themepark-&#x27; + lookup(&#x27;vars&#x27;, readarr_name + &#x27;_name&#x27;, default=readarr_name)</span><span class="diff-line del">-                                           if (readarr_themepark_enabled and global_themepark_plugin_enabled)</span><span class="diff-line del">-                                           else &#x27;&#x27;) }}&quot;</span><span class="diff-line del">- readarr_traefik_middleware_custom: &quot;&quot;</span><span class="diff-line del">- readarr_traefik_certresolver: &quot;{{ traefik_default_certresolver }}&quot;</span><span class="diff-line del">- readarr_traefik_enabled: true</span><span class="diff-line del">- readarr_traefik_api_enabled: true</span><span class="diff-line del">- readarr_traefik_api_endpoint: &quot;PathPrefix(`/api`) || PathPrefix(`/feed`) || PathPrefix(`/ping`)&quot;</span><span class="diff-line del">- </span><span class="diff-line del">- ################################</span><span class="diff-line del">- # API</span><span class="diff-line del">- ################################</span><span class="diff-line del">- </span><span class="diff-line del">- # default to blank</span><span class="diff-line del">- readarr_api_key:</span><span class="diff-line del">- </span><span class="diff-line del">- ################################</span><span class="diff-line del">- # THEME</span><span class="diff-line del">- ################################</span><span class="diff-line del">- </span><span class="diff-line del">- # Options can be found at https://github.com/themepark-dev/theme.park</span><span class="diff-line del">- readarr_themepark_enabled: false</span><span class="diff-line del">- readarr_themepark_app: &quot;readarr&quot;</span><span class="diff-line del">- readarr_themepark_theme: &quot;{{ global_themepark_theme }}&quot;</span><span class="diff-line del">- readarr_themepark_domain: &quot;{{ global_themepark_domain }}&quot;</span><span class="diff-line del">- readarr_themepark_addons: []</span><span class="diff-line del">- </span><span class="diff-line del">- ################################</span><span class="diff-line del">- # Docker</span><span class="diff-line del">- ################################</span><span class="diff-line del">- </span><span class="diff-line del">- # Container</span><span class="diff-line del">- readarr_docker_container: &quot;{{ readarr_name }}&quot;</span><span class="diff-line del">- </span><span class="diff-line del">- # Image</span><span class="diff-line del">- readarr_docker_image_pull: true</span><span class="diff-line del">- readarr_docker_image_repo: &quot;ghcr.io/hotio/readarr&quot;</span><span class="diff-line del">- readarr_docker_image_tag: &quot;latest&quot;</span><span class="diff-line del">- readarr_docker_image: &quot;{{ lookup(&#x27;vars&#x27;, readarr_name + &#x27;_docker_image_repo&#x27;, default=readarr_docker_image_repo)</span><span class="diff-line del">-                           + &#x27;:&#x27; + lookup(&#x27;vars&#x27;, readarr_name + &#x27;_docker_image_tag&#x27;, default=readarr_docker_image_tag) }}&quot;</span><span class="diff-line del">- </span><span class="diff-line del">- # Ports</span><span class="diff-line del">- readarr_docker_ports_defaults: []</span><span class="diff-line del">- readarr_docker_ports_custom: []</span><span class="diff-line del">- readarr_docker_ports: &quot;{{ lookup(&#x27;vars&#x27;, readarr_name + &#x27;_docker_ports_defaults&#x27;, default=readarr_docker_ports_defaults)</span><span class="diff-line del">-                           + lookup(&#x27;vars&#x27;, readarr_name + &#x27;_docker_ports_custom&#x27;, default=readarr_docker_ports_custom) }}&quot;</span><span class="diff-line del">- </span><span class="diff-line del">- # Envs</span><span class="diff-line del">- readarr_docker_envs_default:</span><span class="diff-line del">-   PUID: &quot;{{ uid }}&quot;</span><span class="diff-line del">-   PGID: &quot;{{ gid }}&quot;</span><span class="diff-line del">-   UMASK: &quot;002&quot;</span><span class="diff-line del">-   TZ: &quot;{{ tz }}&quot;</span><span class="diff-line del">- readarr_docker_envs_custom: {}</span><span class="diff-line del">- readarr_docker_envs: &quot;{{ lookup(&#x27;vars&#x27;, readarr_name + &#x27;_docker_envs_default&#x27;, default=readarr_docker_envs_default)</span><span class="diff-line del">-                          | combine(lookup(&#x27;vars&#x27;, readarr_name + &#x27;_docker_envs_custom&#x27;, default=readarr_docker_envs_custom)) }}&quot;</span><span class="diff-line del">- </span><span class="diff-line del">- # Commands</span><span class="diff-line del">- readarr_docker_commands_default: []</span><span class="diff-line del">- readarr_docker_commands_custom: []</span><span class="diff-line del">- readarr_docker_commands: &quot;{{ lookup(&#x27;vars&#x27;, readarr_name + &#x27;_docker_commands_default&#x27;, default=readarr_docker_commands_default)</span><span class="diff-line del">-                              + lookup(&#x27;vars&#x27;, readarr_name + &#x27;_docker_commands_custom&#x27;, default=readarr_docker_commands_custom) }}&quot;</span><span class="diff-line del">- </span><span class="diff-line del">- # Volumes</span><span class="diff-line del">- readarr_docker_volumes_default:</span><span class="diff-line del">-   - &quot;{{ readarr_paths_location }}:/config&quot;</span><span class="diff-line del">-   - &quot;{{ server_appdata_path }}/scripts:/scripts&quot;</span><span class="diff-line del">- readarr_docker_volumes_custom: []</span><span class="diff-line del">- readarr_docker_volumes: &quot;{{ lookup(&#x27;vars&#x27;, readarr_name + &#x27;_docker_volumes_default&#x27;, default=readarr_docker_volumes_default)</span><span class="diff-line del">-                             + lookup(&#x27;vars&#x27;, readarr_name + &#x27;_docker_volumes_custom&#x27;, default=readarr_docker_volumes_custom) }}&quot;</span><span class="diff-line del">- </span><span class="diff-line del">- # Devices</span><span class="diff-line del">- readarr_docker_devices_default: []</span><span class="diff-line del">- readarr_docker_devices_custom: []</span><span class="diff-line del">- readarr_docker_devices: &quot;{{ lookup(&#x27;vars&#x27;, readarr_name + &#x27;_docker_devices_default&#x27;, default=readarr_docker_devices_default)</span><span class="diff-line del">-                             + lookup(&#x27;vars&#x27;, readarr_name + &#x27;_docker_devices_custom&#x27;, default=readarr_docker_devices_custom) }}&quot;</span><span class="diff-line del">- </span><span class="diff-line del">- # Hosts</span><span class="diff-line del">- readarr_docker_hosts_default: {}</span><span class="diff-line del">- readarr_docker_hosts_custom: {}</span><span class="diff-line del">- readarr_docker_hosts: &quot;{{ docker_hosts_common</span><span class="diff-line del">-                           | combine(lookup(&#x27;vars&#x27;, readarr_name + &#x27;_docker_hosts_default&#x27;, default=readarr_docker_hosts_default))</span><span class="diff-line del">-                           | combine(lookup(&#x27;vars&#x27;, readarr_name + &#x27;_docker_hosts_custom&#x27;, default=readarr_docker_hosts_custom)) }}&quot;</span><span class="diff-line del">- </span><span class="diff-line del">- # Labels</span><span class="diff-line del">- readarr_docker_labels_default: {}</span><span class="diff-line del">- readarr_docker_labels_custom: {}</span><span class="diff-line del">- readarr_docker_labels: &quot;{{ docker_labels_common</span><span class="diff-line del">-                            | combine(lookup(&#x27;vars&#x27;, readarr_name + &#x27;_docker_labels_default&#x27;, default=readarr_docker_labels_default))</span><span class="diff-line del">-                            | combine((traefik_themepark_labels</span><span class="diff-line del">-                                      if (readarr_themepark_enabled and global_themepark_plugin_enabled)</span><span class="diff-line del">-                                      else {}),</span><span class="diff-line del">-                                      lookup(&#x27;vars&#x27;, readarr_name + &#x27;_docker_labels_custom&#x27;, default=readarr_docker_labels_custom)) }}&quot;</span><span class="diff-line del">- </span><span class="diff-line del">- # Hostname</span><span class="diff-line del">- readarr_docker_hostname: &quot;{{ readarr_name }}&quot;</span><span class="diff-line del">- </span><span class="diff-line del">- # Network Mode</span><span class="diff-line del">- readarr_docker_network_mode_default: &quot;{{ docker_networks_name_common }}&quot;</span><span class="diff-line del">- readarr_docker_network_mode: &quot;{{ lookup(&#x27;vars&#x27;, readarr_name + &#x27;_docker_network_mode_default&#x27;, default=readarr_docker_network_mode_default) }}&quot;</span><span class="diff-line del">- </span><span class="diff-line del">- # Networks</span><span class="diff-line del">- readarr_docker_networks_alias: &quot;{{ readarr_name }}&quot;</span><span class="diff-line del">- readarr_docker_networks_default: []</span><span class="diff-line del">- readarr_docker_networks_custom: []</span><span class="diff-line del">- readarr_docker_networks: &quot;{{ docker_networks_common</span><span class="diff-line del">-                              + lookup(&#x27;vars&#x27;, readarr_name + &#x27;_docker_networks_default&#x27;, default=readarr_docker_networks_default)</span><span class="diff-line del">-                              + lookup(&#x27;vars&#x27;, readarr_name + &#x27;_docker_networks_custom&#x27;, default=readarr_docker_networks_custom) }}&quot;</span><span class="diff-line del">- </span><span class="diff-line del">- # Capabilities</span><span class="diff-line del">- readarr_docker_capabilities_default: []</span><span class="diff-line del">- readarr_docker_capabilities_custom: []</span><span class="diff-line del">- readarr_docker_capabilities: &quot;{{ lookup(&#x27;vars&#x27;, readarr_name + &#x27;_docker_capabilities_default&#x27;, default=readarr_docker_capabilities_default)</span><span class="diff-line del">-                                  + lookup(&#x27;vars&#x27;, readarr_name + &#x27;_docker_capabilities_custom&#x27;, default=readarr_docker_capabilities_custom) }}&quot;</span><span class="diff-line del">- </span><span class="diff-line del">- # Security Opts</span><span class="diff-line del">- readarr_docker_security_opts_default: []</span><span class="diff-line del">- readarr_docker_security_opts_custom: []</span><span class="diff-line del">- readarr_docker_security_opts: &quot;{{ lookup(&#x27;vars&#x27;, readarr_name + &#x27;_docker_security_opts_default&#x27;, default=readarr_docker_security_opts_default)</span><span class="diff-line del">-                                   + lookup(&#x27;vars&#x27;, readarr_name + &#x27;_docker_security_opts_custom&#x27;, default=readarr_docker_security_opts_custom) }}&quot;</span><span class="diff-line del">- </span><span class="diff-line del">- # Restart Policy</span><span class="diff-line del">- readarr_docker_restart_policy: unless-stopped</span><span class="diff-line del">- </span><span class="diff-line del">- # State</span><span class="diff-line del">- readarr_docker_state: started</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-32">
                <div class="file-header">
                    <span class="badge removed">removed</span>
                    <h3>roles/readarr/tasks/main.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line del">- #########################################################################</span><span class="diff-line del">- # Title:         Saltbox: Readarr Role                                  #</span><span class="diff-line del">- # Author(s):     salty                                                  #</span><span class="diff-line del">- # URL:           https://github.com/saltyorg/Saltbox                    #</span><span class="diff-line del">- # --                                                                    #</span><span class="diff-line del">- #########################################################################</span><span class="diff-line del">- #                   GNU General Public License v3.0                     #</span><span class="diff-line del">- #########################################################################</span><span class="diff-line del">- ---</span><span class="diff-line del">- - name: &quot;Execute Readarr roles&quot;</span><span class="diff-line del">-   ansible.builtin.include_tasks: main2.yml</span><span class="diff-line del">-   vars:</span><span class="diff-line del">-     readarr_name: &quot;{{ instance }}&quot;</span><span class="diff-line del">-   with_items: &quot;{{ readarr_instances }}&quot;</span><span class="diff-line del">-   loop_control:</span><span class="diff-line del">-     loop_var: instance</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-33">
                <div class="file-header">
                    <span class="badge removed">removed</span>
                    <h3>roles/readarr/tasks/main2.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line del">- #########################################################################</span><span class="diff-line del">- # Title:         Saltbox: Readarr                                       #</span><span class="diff-line del">- # Author(s):     salty                                                  #</span><span class="diff-line del">- # URL:           https://github.com/saltyorg/Saltbox                    #</span><span class="diff-line del">- # --                                                                    #</span><span class="diff-line del">- #########################################################################</span><span class="diff-line del">- #                   GNU General Public License v3.0                     #</span><span class="diff-line del">- #########################################################################</span><span class="diff-line del">- ---</span><span class="diff-line del">- - name: Add DNS record</span><span class="diff-line del">-   ansible.builtin.include_tasks: &quot;{{ resources_tasks_path }}/dns/tasker.yml&quot;</span><span class="diff-line del">-   vars:</span><span class="diff-line del">-     dns_record: &quot;{{ lookup(&#x27;vars&#x27;, role_name + &#x27;_dns_record&#x27;) }}&quot;</span><span class="diff-line del">-     dns_zone: &quot;{{ lookup(&#x27;vars&#x27;, role_name + &#x27;_dns_zone&#x27;) }}&quot;</span><span class="diff-line del">-     dns_proxy: &quot;{{ lookup(&#x27;vars&#x27;, role_name + &#x27;_dns_proxy&#x27;) }}&quot;</span><span class="diff-line del">- </span><span class="diff-line del">- - name: Remove existing Docker container</span><span class="diff-line del">-   ansible.builtin.include_tasks: &quot;{{ resources_tasks_path }}/docker/remove_docker_container.yml&quot;</span><span class="diff-line del">- </span><span class="diff-line del">- - name: Create directories</span><span class="diff-line del">-   ansible.builtin.include_tasks: &quot;{{ resources_tasks_path }}/directories/create_directories.yml&quot;</span><span class="diff-line del">- </span><span class="diff-line del">- - name: Create Docker container</span><span class="diff-line del">-   ansible.builtin.include_tasks: &quot;{{ resources_tasks_path }}/docker/create_docker_container.yml&quot;</span><span class="diff-line del">- </span><span class="diff-line del">- - name: &quot;Tweak Settings when SSO is enabled&quot;</span><span class="diff-line del">-   ansible.builtin.import_tasks: &quot;subtasks/auth.yml&quot;</span><span class="diff-line del">-   when: (lookup(&#x27;vars&#x27;, readarr_name + &#x27;_traefik_sso_middleware&#x27;, default=readarr_traefik_sso_middleware) | length &gt; 0) and lookup(&#x27;vars&#x27;, readarr_name + &#x27;_external_auth&#x27;, default=readarr_external_auth)</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-34">
                <div class="file-header">
                    <span class="badge removed">removed</span>
                    <h3>roles/readarr/tasks/subtasks/auth.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line del">- #########################################################################</span><span class="diff-line del">- # Title:         Saltbox: Readarr | Auth Tasks                          #</span><span class="diff-line del">- # Author(s):     salty                                                  #</span><span class="diff-line del">- # URL:           https://github.com/saltyorg/Saltbox                    #</span><span class="diff-line del">- # --                                                                    #</span><span class="diff-line del">- #########################################################################</span><span class="diff-line del">- #                   GNU General Public License v3.0                     #</span><span class="diff-line del">- #########################################################################</span><span class="diff-line del">- ---</span><span class="diff-line del">- - name: Auth | Wait for &#x27;config.xml&#x27; to be created</span><span class="diff-line del">-   ansible.builtin.wait_for:</span><span class="diff-line del">-     path: &quot;/opt/{{ readarr_name }}/config.xml&quot;</span><span class="diff-line del">-     state: present</span><span class="diff-line del">- </span><span class="diff-line del">- - name: Auth | Wait for 10 seconds</span><span class="diff-line del">-   ansible.builtin.wait_for:</span><span class="diff-line del">-     timeout: 10</span><span class="diff-line del">- </span><span class="diff-line del">- - name: Auth | Lookup AuthenticationMethod value</span><span class="diff-line del">-   community.general.xml:</span><span class="diff-line del">-     path: &quot;/opt/{{ readarr_name }}/config.xml&quot;</span><span class="diff-line del">-     xpath: &quot;/Config/AuthenticationMethod&quot;</span><span class="diff-line del">-     content: &quot;text&quot;</span><span class="diff-line del">-   register: xmlresp</span><span class="diff-line del">- </span><span class="diff-line del">- - name: Auth | Toggle AuthenticationMethod to External</span><span class="diff-line del">-   when: ((xmlresp.matches[0].AuthenticationMethod is defined) and (xmlresp.matches[0].AuthenticationMethod != &#x27;External&#x27;))</span><span class="diff-line del">-   block:</span><span class="diff-line del">-     - name: Auth | Change the &#x27;AuthenticationMethod&#x27; attribute to &#x27;External&#x27;</span><span class="diff-line del">-       community.general.xml:</span><span class="diff-line del">-         path: &quot;/opt/{{ readarr_name }}/config.xml&quot;</span><span class="diff-line del">-         xpath: &quot;/Config/AuthenticationMethod&quot;</span><span class="diff-line del">-         value: &quot;External&quot;</span><span class="diff-line del">- </span><span class="diff-line del">-     - name: Auth | Restart Docker container</span><span class="diff-line del">-       ansible.builtin.include_tasks: &quot;{{ resources_tasks_path }}/docker/restart_docker_container.yml&quot;</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-35">
                <div class="file-header">
                    <span class="badge removed">removed</span>
                    <h3>roles/scripts/files/plex_autoscan_url.sh</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line del">- #!/usr/bin/env bash</span><span class="diff-line del">- #########################################################################</span><span class="diff-line del">- # Title:         Plex Autoscan URL Script                               #</span><span class="diff-line del">- # Author(s):     desimaniac                                             #</span><span class="diff-line del">- # URL:           https://github.com/saltyorg/Saltbox                    #</span><span class="diff-line del">- # Description:   Prints out the Plex Autoscan URL.                      #</span><span class="diff-line del">- # --                                                                    #</span><span class="diff-line del">- #########################################################################</span><span class="diff-line del">- #                   GNU General Public License v3.0                     #</span><span class="diff-line del">- #########################################################################</span><span class="diff-line del">- </span><span class="diff-line del">- ################################</span><span class="diff-line del">- # Constants</span><span class="diff-line del">- ################################</span><span class="diff-line del">- </span><span class="diff-line del">- # Regular colors</span><span class="diff-line del">- readonly NORMAL=&quot;\033[0;39m&quot;</span><span class="diff-line del">- readonly GREEN=&quot;\033[32m&quot;</span><span class="diff-line del">- </span><span class="diff-line del">- # Bold colors</span><span class="diff-line del">- readonly BRED=&quot;\033[1;31m&quot;</span><span class="diff-line del">- readonly BWHITE=&quot;\033[1;37m&quot;</span><span class="diff-line del">- readonly BBLUE=&quot;\033[1;34m&quot;</span><span class="diff-line del">- </span><span class="diff-line del">- # Config files</span><span class="diff-line del">- readonly SB_ANSIBLE=&quot;/srv/git/saltbox/ansible.cfg&quot;</span><span class="diff-line del">- readonly SB_ACCOUNTS=&quot;/srv/git/saltbox/accounts.yml&quot;</span><span class="diff-line del">- readonly PAS_CONFIG=&quot;/opt/plex_autoscan/config/config.json&quot;</span><span class="diff-line del">- </span><span class="diff-line del">- # Boolean vars</span><span class="diff-line del">- readonly TRUE=1</span><span class="diff-line del">- readonly FALSE=0</span><span class="diff-line del">- </span><span class="diff-line del">- ################################</span><span class="diff-line del">- # Functions</span><span class="diff-line del">- ################################</span><span class="diff-line del">- </span><span class="diff-line del">- function banner1() {</span><span class="diff-line del">-     if [ -x &quot;$(command -v toilet)&quot; ]; then</span><span class="diff-line del">-         echo &quot;&quot;</span><span class="diff-line del">-         toilet &#x27;Plex Autoscan URL&#x27; -f standard --filter metal --filter border:metal --width 86</span><span class="diff-line del">-     fi</span><span class="diff-line del">- }</span><span class="diff-line del">- </span><span class="diff-line del">- function banner2() {</span><span class="diff-line del">- echo -e &quot;</span><span class="diff-line del">- ${GREEN}</span><span class="diff-line del">- ${GREEN} Title:             Plex Autoscan URL Script                                       </span><span class="diff-line del">- ${GREEN} Author(s):         desimaniac                                                     </span><span class="diff-line del">- ${GREEN} URL:               https://github.com/saltyorg/Saltbox                            </span><span class="diff-line del">- ${GREEN} Description:       Prints out the Plex Autoscan URL.                              </span><span class="diff-line del">- ${GREEN}</span><span class="diff-line del">- ${GREEN}                        GNU General Public License v3.0                            </span><span class="diff-line del">- ${GREEN}</span><span class="diff-line del">- ${NORMAL}&quot;</span><span class="diff-line del">- }</span><span class="diff-line del">- </span><span class="diff-line del">- function sanity_check() {</span><span class="diff-line del">-     # Sanity checks</span><span class="diff-line del">-     if ! [[ -x &quot;$(command -v jq)&quot; ]]; then</span><span class="diff-line del">-         echo -e ${BRED}&quot; Error: &quot;${NORMAL}&quot;&#x27;&quot;${BWHITE}&quot;jq&quot;${NORMAL}&quot;&#x27; is not installed.&quot;\</span><span class="diff-line del">-         ${NORMAL}&quot;Run &#x27;&quot;${BWHITE}&quot;sudo apt-get install jq&quot;${NORMAL}&quot;&#x27; to install.&quot; &gt;&amp;2</span><span class="diff-line del">-         echo &quot;&quot;</span><span class="diff-line del">-         exit 1</span><span class="diff-line del">-     elif ! [[ -x &quot;$(command -v yyq)&quot; ]]; then</span><span class="diff-line del">-         echo -e ${BRED}&quot; Error: &quot;${NORMAL}&quot;&#x27;&quot;${BWHITE}&quot;yyq&quot;${NORMAL}&quot;&#x27; is not installed.&quot;\</span><span class="diff-line del">-         ${NORMAL}&quot;Run &#x27;&quot;${BWHITE}&quot;sb install yyq&quot;${NORMAL}&quot;&#x27; to install.&quot; &gt;&amp;2</span><span class="diff-line del">-         echo &quot;&quot;</span><span class="diff-line del">-         exit 1</span><span class="diff-line del">-     elif [[ ! -f ${PAS_CONFIG} ]]; then</span><span class="diff-line del">-         echo -e ${BRED}&quot; Error: &quot;${NORMAL}&quot;File &#x27;&quot;${BWHITE}${PAS_CONFIG}${NORMAL}&quot;&#x27; is not found.&quot; &gt;&amp;2</span><span class="diff-line del">-         echo &quot;&quot;</span><span class="diff-line del">-         exit 1</span><span class="diff-line del">-     elif [[ ! -f ${SB_ACCOUNTS} ]]; then</span><span class="diff-line del">-         echo -e ${BRED}&quot; Error: &quot;${NORMAL}&quot;File &#x27;&quot;${BWHITE}${SB_ACCOUNTS}${NORMAL}&quot;&#x27; is not found.&quot; &gt;&amp;2</span><span class="diff-line del">-         echo &quot;&quot;</span><span class="diff-line del">-         exit 1</span><span class="diff-line del">-     fi</span><span class="diff-line del">- </span><span class="diff-line del">-     # Validate JSON file</span><span class="diff-line del">-     cat ${PAS_CONFIG} | jq -e . &gt;/dev/null 2&gt;&amp;1</span><span class="diff-line del">-     rc=$?</span><span class="diff-line del">-     if [[ $rc != 0 ]]; then</span><span class="diff-line del">-         echo -e ${BRED}&quot; Error: &quot;${NORMAL}&quot;Invalid JSON format in &#x27;&quot;${BWHITE}${PAS_CONFIG}${NORMAL}&quot;&#x27;.&quot;  &gt;&amp;2</span><span class="diff-line del">-         echo &quot;&quot;</span><span class="diff-line del">-         echo -e &quot; See &#x27;JSON Format Errors&#x27; on the Wiki FAQ page.&quot;  &gt;&amp;2</span><span class="diff-line del">-         echo &quot;&quot;</span><span class="diff-line del">-         exit 1</span><span class="diff-line del">-     fi</span><span class="diff-line del">- }</span><span class="diff-line del">- </span><span class="diff-line del">- function build_url() {</span><span class="diff-line del">-     # Get variables from Plex Autoscan config</span><span class="diff-line del">-     SERVER_IP=$(cat ${PAS_CONFIG} | jq -r .SERVER_IP)</span><span class="diff-line del">-     SERVER_PORT=$(cat ${PAS_CONFIG} | jq -r .SERVER_PORT)</span><span class="diff-line del">-     SERVER_PASS=$(cat ${PAS_CONFIG} | jq -r .SERVER_PASS)</span><span class="diff-line del">- </span><span class="diff-line del">-     # Get variables from Saltbox account settings</span><span class="diff-line del">-     DOMAIN=$(yyq &#x27;.user.domain&#x27; ${SB_ACCOUNTS} )</span><span class="diff-line del">- </span><span class="diff-line del">-     # If SERVER_IP is 0.0.0.0, assign public IP address to REAL_IP.</span><span class="diff-line del">-     if [[ ${SERVER_IP} = 0.0.0.0 ]]; then</span><span class="diff-line del">-         REAL_IP=&quot;$(dig -4 TXT +short o-o.myaddr.l.google.com @ns1.google.com | awk -F&#x27;\&quot;&#x27; &#x27;{ print $2}&#x27;)&quot;</span><span class="diff-line del">-     else</span><span class="diff-line del">-         REAL_IP=${SERVER_IP}</span><span class="diff-line del">-     fi</span><span class="diff-line del">- </span><span class="diff-line del">-     # Declare Subdomains Array</span><span class="diff-line del">-     declare -a SUBDOMAINS=(</span><span class="diff-line del">-         &quot;plex.${DOMAIN}&quot;</span><span class="diff-line del">-         &quot;mediabox.${DOMAIN}&quot;</span><span class="diff-line del">-         &quot;saltbox.${DOMAIN}&quot;</span><span class="diff-line del">-         &quot;${REAL_IP}&quot;</span><span class="diff-line del">-     )</span><span class="diff-line del">- </span><span class="diff-line del">-     # Get length of the subdomains array</span><span class="diff-line del">-     SUBDOMAIN_LEN=${#SUBDOMAINS[@]}</span><span class="diff-line del">- </span><span class="diff-line del">-     # Declare variables for while loop</span><span class="diff-line del">-     declare -i COUNT=0</span><span class="diff-line del">-     SUBDOMAIN_IP=&quot;&quot;</span><span class="diff-line del">- </span><span class="diff-line del">-     # Determine which subdomain points to the actual host IP address (vs a CDN one, for example)</span><span class="diff-line del">-     while [[ ((${REAL_IP} != ${SUBDOMAIN_IP}) &amp;&amp; (${COUNT} &lt; ${SUBDOMAIN_LEN})) ]]; do</span><span class="diff-line del">-         SUBDOMAIN=${SUBDOMAINS[$COUNT]}</span><span class="diff-line del">-         SUBDOMAIN_IP=$(dig -4 +short ${SUBDOMAIN} @8.8.8.8)</span><span class="diff-line del">-         COUNT+=1</span><span class="diff-line del">-     done</span><span class="diff-line del">- }</span><span class="diff-line del">- </span><span class="diff-line del">- # Print Plex Autoscan URL</span><span class="diff-line del">- function print_url() {</span><span class="diff-line del">- </span><span class="diff-line del">-     if (( SIMPLE - 1 )); then</span><span class="diff-line del">-         echo -e ${BWHITE}&quot;Your Plex Autoscan URL:&quot;</span><span class="diff-line del">-         echo -e ${BBLUE}&quot;http://${SUBDOMAIN}:${SERVER_PORT}/${SERVER_PASS}&quot;${NORMAL}</span><span class="diff-line del">-         echo &quot;&quot;</span><span class="diff-line del">-     else</span><span class="diff-line del">-         echo http://${SUBDOMAIN}:${SERVER_PORT}/${SERVER_PASS}</span><span class="diff-line del">-     fi</span><span class="diff-line del">- </span><span class="diff-line del">- }</span><span class="diff-line del">- </span><span class="diff-line del">- ################################</span><span class="diff-line del">- # Argument Parser</span><span class="diff-line del">- ################################</span><span class="diff-line del">- </span><span class="diff-line del">- ## https://stackoverflow.com/a/39398359</span><span class="diff-line del">- SIMPLE=${FALSE}</span><span class="diff-line del">- # As long as there is at least one more argument, keep looping</span><span class="diff-line del">- while [[ $# -gt 0 ]]; do</span><span class="diff-line del">-     key=&quot;$1&quot;</span><span class="diff-line del">-     case &quot;$key&quot; in</span><span class="diff-line del">-         # This flag type option will catch either -s or --simple</span><span class="diff-line del">-         -s|--simple)</span><span class="diff-line del">-         SIMPLE=${TRUE}</span><span class="diff-line del">-         ;;</span><span class="diff-line del">-         *)</span><span class="diff-line del">-         # Exit when unknown argument is passed</span><span class="diff-line del">-         echo &quot;Unknown option &#x27;$key&#x27;&quot;</span><span class="diff-line del">-         exit 10</span><span class="diff-line del">-         ;;</span><span class="diff-line del">-     esac</span><span class="diff-line del">-     shift</span><span class="diff-line del">- done</span><span class="diff-line del">- </span><span class="diff-line del">- ################################</span><span class="diff-line del">- # Main</span><span class="diff-line del">- ################################</span><span class="diff-line del">- </span><span class="diff-line del">- function main ()</span><span class="diff-line del">- {</span><span class="diff-line del">-     if [[ ${SIMPLE} == ${FALSE} ]]; then</span><span class="diff-line del">-         banner1</span><span class="diff-line del">-         banner2</span><span class="diff-line del">-     fi</span><span class="diff-line del">-         sanity_check</span><span class="diff-line del">-         build_url</span><span class="diff-line del">-         print_url</span><span class="diff-line del">- }</span><span class="diff-line del">- </span><span class="diff-line del">- main &quot;$@&quot;</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-36">
                <div class="file-header">
                    <span class="badge removed">removed</span>
                    <h3>roles/scripts/files/plexsql.sh</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line del">- #!/bin/bash</span><span class="diff-line del">- # if script name is plexsql.sh then</span><span class="diff-line del">- # usage is - ./plexsql.sh &quot;select something from some_table where something = something_else&quot;</span><span class="diff-line del">- # </span><span class="diff-line del">- mkdir -p /opt/plexsql</span><span class="diff-line del">- sqlplex=&quot;/opt/plexsql/Plex SQLite&quot;</span><span class="diff-line del">- docker stop plex</span><span class="diff-line del">- docker cp plex:/usr/lib/plexmediaserver/. /opt/plexsql</span><span class="diff-line del">- cd &quot;/opt/plex/Library/Application Support/Plex Media Server/Plug-in Support/Databases&quot;</span><span class="diff-line del">- cp com.plexapp.plugins.library.db com.plexapp.plugins.library.db.original</span><span class="diff-line del">- &quot;$sqlplex&quot; com.plexapp.plugins.library.db &quot;$1&quot;</span><span class="diff-line del">- </span><span class="diff-line del">- #and if you want to do something other than select statements use this instead</span><span class="diff-line del">- #cp com.plexapp.plugins.library.db com.plexapp.plugins.library.db.original</span><span class="diff-line del">- #&quot;$sqlplex&quot; com.plexapp.plugins.library.db &quot;DROP index &#x27;index_title_sort_naturalsort&#x27;&quot;</span><span class="diff-line del">- #&quot;$sqlplex&quot; com.plexapp.plugins.library.db &quot;DELETE from schema_migrations where version=&#x27;20180501000000&#x27;&quot;</span><span class="diff-line del">- #&quot;$sqlplex&quot; com.plexapp.plugins.library.db &quot;$1&quot;</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-37">
                <div class="file-header">
                    <span class="badge removed">removed</span>
                    <h3>roles/scripts/files/restart_containers.sh</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line del">- #!/bin/bash</span><span class="diff-line del">- #########################################################################</span><span class="diff-line del">- # Title:         Restart Running Containers Script                      #</span><span class="diff-line del">- # Author(s):     desimaniac                                             #</span><span class="diff-line del">- # URL:           https://github.com/saltyorg/Saltbox                    #</span><span class="diff-line del">- # Description:   Stop running containers and start them back up.        #</span><span class="diff-line del">- # --                                                                    #</span><span class="diff-line del">- #########################################################################</span><span class="diff-line del">- #                   GNU General Public License v3.0                     #</span><span class="diff-line del">- #########################################################################</span><span class="diff-line del">- </span><span class="diff-line del">- </span><span class="diff-line del">- # Regular color(s)</span><span class="diff-line del">- NORMAL=&quot;\033[0;39m&quot;</span><span class="diff-line del">- GREEN=&quot;\033[32m&quot;</span><span class="diff-line del">- </span><span class="diff-line del">- echo -e &quot;</span><span class="diff-line del">- $GREEN</span><span class="diff-line del">-  </span><span class="diff-line del">-   Title:             Restart Running Containers Script                              </span><span class="diff-line del">-   Author(s):         desimaniac, salty                                              </span><span class="diff-line del">-   URL:               https://github.com/saltyorg/Saltbox                            </span><span class="diff-line del">-   Description:       Stop running containers and start them back up.                </span><span class="diff-line del">-  </span><span class="diff-line del">-                          GNU General Public License v3.0                            </span><span class="diff-line del">-  </span><span class="diff-line del">- $NORMAL</span><span class="diff-line del">- &quot;</span><span class="diff-line del">- </span><span class="diff-line del">- containers=$(docker ps -q)</span><span class="diff-line del">- echo Stopping $containers</span><span class="diff-line del">- docker=$(docker stop $containers)</span><span class="diff-line del">- </span><span class="diff-line del">- sleep 3</span><span class="diff-line del">- </span><span class="diff-line del">- echo Starting $containers</span><span class="diff-line del">- docker=$(docker start $containers)</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-38">
                <div class="file-header">
                    <span class="badge removed">removed</span>
                    <h3>roles/settings/files/settings-updater.py</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line del">- #!/srv/ansible/venv/bin/python3</span><span class="diff-line del">- &quot;&quot;&quot;</span><span class="diff-line del">- </span><span class="diff-line del">-     #########################################################################</span><span class="diff-line del">-     # Title:         Settings Updater Script                                #</span><span class="diff-line del">-     # Author(s):     l3uddz, chazlarson, salty                              #</span><span class="diff-line del">-     # URL:           https://github.com/saltyorg/Saltbox                    #</span><span class="diff-line del">-     # Description:   Adds variables to settings.yml.                        #</span><span class="diff-line del">-     # --                                                                    #</span><span class="diff-line del">-     #########################################################################</span><span class="diff-line del">-     #                   GNU General Public License v3.0                     #</span><span class="diff-line del">-     #########################################################################</span><span class="diff-line del">- </span><span class="diff-line del">- &quot;&quot;&quot;</span><span class="diff-line del">- import logging</span><span class="diff-line del">- import os</span><span class="diff-line del">- import sys</span><span class="diff-line del">- from logging.handlers import RotatingFileHandler</span><span class="diff-line del">- </span><span class="diff-line del">- from ruamel.yaml import YAML</span><span class="diff-line del">- from ruamel.yaml.comments import CommentedMap</span><span class="diff-line del">- </span><span class="diff-line del">- ############################################################</span><span class="diff-line del">- # INIT</span><span class="diff-line del">- ############################################################</span><span class="diff-line del">- </span><span class="diff-line del">- </span><span class="diff-line del">- log = None</span><span class="diff-line del">- </span><span class="diff-line del">- </span><span class="diff-line del">- def init_logging(playbook_path):</span><span class="diff-line del">-     # log settings</span><span class="diff-line del">-     log_format = &#x27;%(asctime)s - %(levelname)-10s - %(name)-35s - %(funcName)-35s - %(message)s&#x27;</span><span class="diff-line del">-     log_file_path = os.path.join(playbook_path, &quot;settings-updater.log&quot;)</span><span class="diff-line del">-     log_level = logging.DEBUG</span><span class="diff-line del">- </span><span class="diff-line del">-     # init root_logger</span><span class="diff-line del">-     log_formatter = logging.Formatter(log_format)</span><span class="diff-line del">-     root_logger = logging.getLogger()</span><span class="diff-line del">-     root_logger.setLevel(log_level)</span><span class="diff-line del">- </span><span class="diff-line del">-     # init console_logger</span><span class="diff-line del">-     console_handler = logging.StreamHandler(sys.stdout)</span><span class="diff-line del">-     console_handler.setFormatter(log_formatter)</span><span class="diff-line del">-     root_logger.addHandler(console_handler)</span><span class="diff-line del">- </span><span class="diff-line del">-     # init file_logger</span><span class="diff-line del">-     file_handler = RotatingFileHandler(</span><span class="diff-line del">-         log_file_path,</span><span class="diff-line del">-         maxBytes=1024 * 1024 * 5,</span><span class="diff-line del">-         backupCount=5</span><span class="diff-line del">-     )</span><span class="diff-line del">-     file_handler.setFormatter(log_formatter)</span><span class="diff-line del">-     root_logger.addHandler(file_handler)</span><span class="diff-line del">- </span><span class="diff-line del">-     # Set chosen logging level</span><span class="diff-line del">-     root_logger.setLevel(log_level)</span><span class="diff-line del">- </span><span class="diff-line del">-     # Get logger</span><span class="diff-line del">-     return root_logger.getChild(&quot;settings-updater&quot;)</span><span class="diff-line del">- </span><span class="diff-line del">- </span><span class="diff-line del">- ############################################################</span><span class="diff-line del">- # UPDATER</span><span class="diff-line del">- ############################################################</span><span class="diff-line del">- </span><span class="diff-line del">- def load_settings(file_to_load):</span><span class="diff-line del">-     yaml_instance = YAML()</span><span class="diff-line del">-     yaml_instance.preserve_quotes = True</span><span class="diff-line del">- </span><span class="diff-line del">-     settings = None</span><span class="diff-line del">-     try:</span><span class="diff-line del">-         with open(file_to_load, &quot;r&quot;) as f:</span><span class="diff-line del">-             settings = yaml_instance.load(f)</span><span class="diff-line del">-     except Exception:</span><span class="diff-line del">-         log.exception(&quot;Exception loading %s: &quot;, file_to_load)</span><span class="diff-line del">-     return settings</span><span class="diff-line del">- </span><span class="diff-line del">- def dump_settings(settings, file_to_dump):</span><span class="diff-line del">-     dumped = False</span><span class="diff-line del">-     try:</span><span class="diff-line del">-         yaml_instance = YAML()</span><span class="diff-line del">-         yaml_instance.preserve_quotes = True</span><span class="diff-line del">-         with open(file_to_dump, &#x27;w&#x27;) as fp:</span><span class="diff-line del">-             yaml_instance.dump(settings, fp)</span><span class="diff-line del">-         dumped = True</span><span class="diff-line del">-     except Exception:</span><span class="diff-line del">-         log.exception(&quot;Exception dumping upgraded %s: &quot;, file_to_dump)</span><span class="diff-line del">-     return dumped</span><span class="diff-line del">- </span><span class="diff-line del">- def is_remote_entry(thing):</span><span class="diff-line del">-     ret_val = False</span><span class="diff-line del">-     if type(thing) == CommentedMap:</span><span class="diff-line del">-         rem_set = {&#x27;port&#x27;, &#x27;remote&#x27;, &#x27;template&#x27;, &#x27;cache&#x27;}</span><span class="diff-line del">-         for k in thing.keys():</span><span class="diff-line del">-             ret_val = ret_val or (k in rem_set)</span><span class="diff-line del">-     return ret_val</span><span class="diff-line del">- </span><span class="diff-line del">- def _inner_upgrade(settings1, settings2, key=None, overwrite=False):</span><span class="diff-line del">-     sub_upgraded = False</span><span class="diff-line del">-     merged = settings2.copy()</span><span class="diff-line del">- </span><span class="diff-line del">-     if isinstance(settings1, dict):</span><span class="diff-line del">-         for k, v in settings1.items():</span><span class="diff-line del">-             # missing k</span><span class="diff-line del">-             if k not in settings2:</span><span class="diff-line del">-                 merged[k] = v</span><span class="diff-line del">-                 sub_upgraded = True</span><span class="diff-line del">-                 if not key:</span><span class="diff-line del">-                     log.info(&quot;Added %r setting: %s&quot;, str(k), str(v))</span><span class="diff-line del">-                 else:</span><span class="diff-line del">-                     log.info(&quot;Added %r to setting %r: %s&quot;, str(k), str(key), str(v))</span><span class="diff-line del">-                 continue</span><span class="diff-line del">- </span><span class="diff-line del">-             # iterate children</span><span class="diff-line del">-             if isinstance(v, dict) or isinstance(v, list):</span><span class="diff-line del">-                 merged[k], did_upgrade = _inner_upgrade(settings1[k], settings2[k], key=k,</span><span class="diff-line del">-                                                                 overwrite=overwrite)</span><span class="diff-line del">-                 sub_upgraded = did_upgrade if did_upgrade else sub_upgraded</span><span class="diff-line del">-             elif settings1[k] != settings2[k] and overwrite:</span><span class="diff-line del">-                 merged = settings1</span><span class="diff-line del">-                 sub_upgraded = True</span><span class="diff-line del">-     elif isinstance(settings1, list) and key:</span><span class="diff-line del">-         for v in settings1:</span><span class="diff-line del">-             is_remote = is_remote_entry(v)</span><span class="diff-line del">-             might_not_want_it = len(settings2) &gt; 0</span><span class="diff-line del">-             if v not in settings2 and not is_remote and not might_not_want_it:</span><span class="diff-line del">-                 merged.append(v)</span><span class="diff-line del">-                 sub_upgraded = True</span><span class="diff-line del">-                 log.info(&quot;Added to setting %r: %s&quot;, str(key), str(v))</span><span class="diff-line del">-                 continue</span><span class="diff-line del">- </span><span class="diff-line del">-     return merged, sub_upgraded</span><span class="diff-line del">- </span><span class="diff-line del">- def upgrade_settings(defaults, currents):</span><span class="diff-line del">-     upgraded_settings, upgraded = _inner_upgrade(defaults, currents)</span><span class="diff-line del">-     return upgraded, upgraded_settings</span><span class="diff-line del">- </span><span class="diff-line del">- ############################################################</span><span class="diff-line del">- # MAIN</span><span class="diff-line del">- ############################################################</span><span class="diff-line del">- </span><span class="diff-line del">- if __name__ == &quot;__main__&quot;:</span><span class="diff-line del">-     # get playbook dir</span><span class="diff-line del">-     if not len(sys.argv) &gt;= 4:</span><span class="diff-line del">-         print(&quot;3 arguments must be supplied, playbook_dir default_settings current_settings&quot;)</span><span class="diff-line del">-         sys.exit(1)</span><span class="diff-line del">-     playbook_dir = sys.argv[1]</span><span class="diff-line del">-     default_file = sys.argv[2]</span><span class="diff-line del">-     current_file = sys.argv[3]</span><span class="diff-line del">- </span><span class="diff-line del">-     # init logging</span><span class="diff-line del">-     log = init_logging(playbook_dir)</span><span class="diff-line del">- </span><span class="diff-line del">-     # load settings</span><span class="diff-line del">-     default_settings = load_settings(os.path.join(playbook_dir, default_file))</span><span class="diff-line del">-     if not default_settings:</span><span class="diff-line del">-         log.error(&quot;Failed loading \&#x27;%s\&#x27;. Aborting...&quot;, default_file)</span><span class="diff-line del">-         sys.exit(1)</span><span class="diff-line del">- </span><span class="diff-line del">-     current_settings = load_settings(os.path.join(playbook_dir, current_file))</span><span class="diff-line del">-     if not current_settings:</span><span class="diff-line del">-         log.error(&quot;Failed loading \&#x27;%s\&#x27;. Aborting...&quot;, current_file)</span><span class="diff-line del">-         sys.exit(1)</span><span class="diff-line del">- </span><span class="diff-line del">-     # compare/upgrade settings</span><span class="diff-line del">-     did_upgrade, upgraded_settings = upgrade_settings(default_settings, current_settings)</span><span class="diff-line del">-     if not did_upgrade:</span><span class="diff-line del">-         log.info(&quot;There were no settings changes to apply.&quot;)</span><span class="diff-line del">-         sys.exit(0)</span><span class="diff-line del">-     else:</span><span class="diff-line del">-         if not dump_settings(upgraded_settings, os.path.join(playbook_dir, current_file)):</span><span class="diff-line del">-             log.error(&quot;Failed dumping updated \&#x27;%s\&#x27;.&quot;, current_file)</span><span class="diff-line del">-             sys.exit(1)</span><span class="diff-line del">-         log.info(&quot;Successfully upgraded: \&#x27;%s\&#x27;.&quot;, current_file)</span><span class="diff-line del">-         sys.exit(2)</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-39">
                <div class="file-header">
                    <span class="badge removed">removed</span>
                    <h3>roles/settings/tasks/main.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line del">- #########################################################################</span><span class="diff-line del">- # Title:         Saltbox: Settings Role                                 #</span><span class="diff-line del">- # Author(s):     desimaniac                                             #</span><span class="diff-line del">- # URL:           https://github.com/saltyorg/Saltbox                    #</span><span class="diff-line del">- # --                                                                    #</span><span class="diff-line del">- #########################################################################</span><span class="diff-line del">- #                   GNU General Public License v3.0                     #</span><span class="diff-line del">- #########################################################################</span><span class="diff-line del">- ---</span><span class="diff-line del">- - name: &quot;Settings | Start&quot;</span><span class="diff-line del">-   ansible.builtin.include_tasks: &quot;subtasks/start.yml&quot;</span><span class="diff-line del">- </span><span class="diff-line del">- - name: &quot;Settings | Main 2&quot;</span><span class="diff-line del">-   ansible.builtin.include_tasks: &quot;main2.yml&quot;</span><span class="diff-line del">-   loop: &quot;{{ config_files }}&quot;</span><span class="diff-line del">-   loop_control:</span><span class="diff-line del">-     loop_var: outer_item</span><span class="diff-line del">- </span><span class="diff-line del">- - name: &quot;Settings | Finish&quot;</span><span class="diff-line del">-   ansible.builtin.include_tasks: &quot;subtasks/finish.yml&quot;</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-40">
                <div class="file-header">
                    <span class="badge removed">removed</span>
                    <h3>roles/settings/tasks/main2.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line del">- #########################################################################</span><span class="diff-line del">- # Title:         Saltbox: Settings | Main 2                             #</span><span class="diff-line del">- # Author(s):     desimaniac                                             #</span><span class="diff-line del">- # URL:           https://github.com/saltyorg/Saltbox                    #</span><span class="diff-line del">- # --                                                                    #</span><span class="diff-line del">- #########################################################################</span><span class="diff-line del">- #                   GNU General Public License v3.0                     #</span><span class="diff-line del">- #########################################################################</span><span class="diff-line del">- ---</span><span class="diff-line del">- - name: &quot;Settings | Copy&quot;</span><span class="diff-line del">-   ansible.builtin.include_tasks: &quot;subtasks/copy.yml&quot;</span><span class="diff-line del">-   vars:</span><span class="diff-line del">-     file: &quot;{{ outer_item }}&quot;</span><span class="diff-line del">- </span><span class="diff-line del">- - name: &quot;Settings | Migrator&quot;</span><span class="diff-line del">-   ansible.builtin.include_tasks: &quot;subtasks/migrator.yml&quot;</span><span class="diff-line del">-   vars:</span><span class="diff-line del">-     file: &quot;{{ outer_item }}&quot;</span><span class="diff-line del">- </span><span class="diff-line del">- - name: &quot;Settings | Updater&quot;</span><span class="diff-line del">-   ansible.builtin.include_tasks: &quot;subtasks/updater.yml&quot;</span><span class="diff-line del">-   vars:</span><span class="diff-line del">-     file: &quot;{{ outer_item }}&quot;</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-41">
                <div class="file-header">
                    <span class="badge removed">removed</span>
                    <h3>roles/settings/tasks/subtasks/copy.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line del">- #########################################################################</span><span class="diff-line del">- # Title:         Saltbox: Settings | Copy                               #</span><span class="diff-line del">- # Author(s):     desimaniac                                             #</span><span class="diff-line del">- # URL:           https://github.com/saltyorg/Saltbox                    #</span><span class="diff-line del">- # --                                                                    #</span><span class="diff-line del">- #########################################################################</span><span class="diff-line del">- #                   GNU General Public License v3.0                     #</span><span class="diff-line del">- #########################################################################</span><span class="diff-line del">- ---</span><span class="diff-line del">- # Check for config files and import they are missing</span><span class="diff-line del">- - name: &quot;Copy | Check if &#x27;{{ file }}&#x27; exists&quot;</span><span class="diff-line del">-   ansible.builtin.stat:</span><span class="diff-line del">-     path: &quot;{{ playbook_dir }}/{{ file }}&quot;</span><span class="diff-line del">-   register: file0</span><span class="diff-line del">- </span><span class="diff-line del">- - name: &quot;Copy | Copy &#x27;{{ file }}.default&#x27; to &#x27;{{ file }}&#x27;&quot;</span><span class="diff-line del">-   ansible.builtin.copy:</span><span class="diff-line del">-     src: &quot;{{ playbook_dir }}/defaults/{{ file }}.default&quot;</span><span class="diff-line del">-     dest: &quot;{{ playbook_dir }}/{{ file }}&quot;</span><span class="diff-line del">-     owner: &quot;{{ saltbox_yml.stat.uid }}&quot;</span><span class="diff-line del">-     group: &quot;{{ saltbox_yml.stat.gid }}&quot;</span><span class="diff-line del">-     mode: &quot;0664&quot;</span><span class="diff-line del">-   when: (not file0.stat.exists)</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-42">
                <div class="file-header">
                    <span class="badge removed">removed</span>
                    <h3>roles/settings/tasks/subtasks/finish.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line del">- #########################################################################</span><span class="diff-line del">- # Title:         Saltbox: Settings | Finish                             #</span><span class="diff-line del">- # Author(s):     desimaniac                                             #</span><span class="diff-line del">- # URL:           https://github.com/saltyorg/Saltbox                    #</span><span class="diff-line del">- # --                                                                    #</span><span class="diff-line del">- #########################################################################</span><span class="diff-line del">- #                   GNU General Public License v3.0                     #</span><span class="diff-line del">- #########################################################################</span><span class="diff-line del">- ---</span><span class="diff-line del">- - name: &quot;Finish | Check &#x27;settings-updater.py&#x27; for new settings&quot;</span><span class="diff-line del">-   ansible.builtin.debug: # noqa jinja[invalid]</span><span class="diff-line del">-     msg:</span><span class="diff-line del">-       - &quot;The &#x27;settings_updater.py&#x27; script updated the following</span><span class="diff-line del">-           file{{ &#x27;s&#x27; if (files_updated_successfully | length &gt; 1) else &#x27;&#x27; }}: &#x27;{{ files_updated_successfully | join(&#x27;, &#x27;) | trim }}&#x27;&quot;</span><span class="diff-line del">-       - &quot;Please check {{ &#x27;these files&#x27; if (files_updated_successfully | length &gt; 1) else &#x27;this file&#x27; }} for the newly added settings&quot;</span><span class="diff-line del">-       - &quot;You can also review the log file: &#x27;settings-updater.log&#x27;&quot;</span><span class="diff-line del">-   when: (files_updated_successfully | length &gt; 0)</span><span class="diff-line del">- </span><span class="diff-line del">- - name: Traefik 3.0 Migration block</span><span class="diff-line del">-   when: traefik3_migration</span><span class="diff-line del">-   block:</span><span class="diff-line del">-     - name: Provide link to migration docs # Update to main docs page when docs are updated</span><span class="diff-line del">-       ansible.builtin.pause:</span><span class="diff-line del">-         prompt: &quot;Make sure you read the migration docs (press enter to continue): https://docs.saltbox.dev/saltbox/upgrade/traefik3/&quot;</span><span class="diff-line del">- </span><span class="diff-line del">- # Make sure accounts.yml has been filled in by user</span><span class="diff-line del">- - name: &quot;Finish | Get stats on &#x27;accounts.yml&#x27; for hash check&quot;</span><span class="diff-line del">-   ansible.builtin.stat:</span><span class="diff-line del">-     path: &quot;{{ playbook_dir }}/accounts.yml&quot;</span><span class="diff-line del">-   register: accounts_yml</span><span class="diff-line del">- </span><span class="diff-line del">- - name: &quot;Finish | Get stats on &#x27;accounts.yml.default&#x27; for hash check&quot;</span><span class="diff-line del">-   ansible.builtin.stat:</span><span class="diff-line del">-     path: &quot;{{ playbook_dir }}/defaults/accounts.yml.default&quot;</span><span class="diff-line del">-   register: accounts_yml_default</span><span class="diff-line del">- </span><span class="diff-line del">- # Sanity Checks</span><span class="diff-line del">- - name: &quot;Finish | Ensure that &#x27;accounts.yml&#x27; is configured&quot;</span><span class="diff-line del">-   ansible.builtin.assert:</span><span class="diff-line del">-     that:</span><span class="diff-line del">-       - accounts_yml.stat.exists</span><span class="diff-line del">-       - accounts_yml.stat.checksum != accounts_yml_default.stat.checksum</span><span class="diff-line del">-       - user.domain != &quot;testsaltbox.ml&quot;</span><span class="diff-line del">-     msg: &quot;You must configure &#x27;accounts.yml&#x27; before running the Saltbox installer&quot;</span><span class="diff-line del">- </span><span class="diff-line del">- # Exit playbook When necessary</span><span class="diff-line del">- - name: Finish | Exit Tasks</span><span class="diff-line del">-   when: exit_is_necessary</span><span class="diff-line del">-   block:</span><span class="diff-line del">-     - name: &quot;Finish | Check &#x27;settings-updater.py&#x27; run status for errors&quot;</span><span class="diff-line del">-       ansible.builtin.debug:</span><span class="diff-line del">-         msg:</span><span class="diff-line del">-           - &quot;The &#x27;settings_updater.py&#x27; script exited with an error when updating the following</span><span class="diff-line del">-               file{{ &#x27;s&#x27; if (files_updated_unsuccessfully | length &gt; 1) else &#x27;&#x27; }}: &#x27;{{ files_updated_unsuccessfully | join(&#x27;, &#x27;) | trim }}&#x27;&quot;</span><span class="diff-line del">-           - &quot;Please check &#x27;settings-updater.log&#x27; for details&quot;</span><span class="diff-line del">-       when: (files_updated_unsuccessfully | length &gt; 0)</span><span class="diff-line del">- </span><span class="diff-line del">-     - name: &quot;Finish | Exit so that user can check updated config files&quot;</span><span class="diff-line del">-       ansible.builtin.debug:</span><span class="diff-line del">-         msg: &quot;Saltbox Installer will now exit.&quot;</span><span class="diff-line del">- </span><span class="diff-line del">-     - name: &quot;Finish | Exit&quot;</span><span class="diff-line del">-       ansible.builtin.meta: end_play</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-43">
                <div class="file-header">
                    <span class="badge removed">removed</span>
                    <h3>roles/settings/tasks/subtasks/migrator.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line del">- #########################################################################</span><span class="diff-line del">- # Title:         Saltbox: Settings | Migrator                           #</span><span class="diff-line del">- # Author(s):     desimaniac, salty                                      #</span><span class="diff-line del">- # URL:           https://github.com/saltyorg/Saltbox                    #</span><span class="diff-line del">- # --                                                                    #</span><span class="diff-line del">- #########################################################################</span><span class="diff-line del">- #                   GNU General Public License v3.0                     #</span><span class="diff-line del">- #########################################################################</span><span class="diff-line del">- ---</span><span class="diff-line del">- - name: Migrator | Migrations for all config files</span><span class="diff-line del">-   block:</span><span class="diff-line del">-     - name: Migrator | All | Migration 01</span><span class="diff-line del">-       ansible.builtin.include_tasks: &quot;migrator/all/migration_01.yml&quot;</span><span class="diff-line del">-       when: (file != &quot;backup_config.yml&quot;)</span><span class="diff-line del">- </span><span class="diff-line del">- - name: Migrator | Migrations for &#x27;accounts.yml&#x27;</span><span class="diff-line del">-   when: (file == &quot;accounts.yml&quot;)</span><span class="diff-line del">-   block:</span><span class="diff-line del">-     - name: Migrator | &#x27;accounts.yml&#x27; | Migration 01</span><span class="diff-line del">-       ansible.builtin.include_tasks: &quot;migrator/accounts_yml/migration_01.yml&quot;</span><span class="diff-line del">- </span><span class="diff-line del">- - name: Migrator | Migrations for &#x27;adv_settings.yml&#x27;</span><span class="diff-line del">-   when: (file == &quot;adv_settings.yml&quot;)</span><span class="diff-line del">-   block:</span><span class="diff-line del">-     - name: Migrator | &#x27;adv_settings.yml&#x27; | Migration 01</span><span class="diff-line del">-       ansible.builtin.include_tasks: &quot;migrator/adv_settings_yml/migration_01.yml&quot;</span><span class="diff-line del">- </span><span class="diff-line del">- - name: Migrator | Migrations for &#x27;backup_config.yml&#x27;</span><span class="diff-line del">-   when: (file == &quot;backup_config.yml&quot;)</span><span class="diff-line del">-   block:</span><span class="diff-line del">-     - name: Migrator | &#x27;backup_config.yml&#x27; | Migration 01</span><span class="diff-line del">-       ansible.builtin.include_tasks: &quot;migrator/backup_config_yml/migration_01.yml&quot;</span><span class="diff-line del">- </span><span class="diff-line del">- - name: Migrator | Migrations for &#x27;providers.yml&#x27;</span><span class="diff-line del">-   when: (file == &quot;providers.yml&quot;)</span><span class="diff-line del">-   block:</span><span class="diff-line del">-     - name: Migrator | &#x27;providers.yml&#x27; | Migration 01</span><span class="diff-line del">-       ansible.builtin.include_tasks: &quot;migrator/providers_yml/migration_01.yml&quot;</span><span class="diff-line del">- </span><span class="diff-line del">- - name: Migrator | Migrations for &#x27;settings.yml&#x27;</span><span class="diff-line del">-   when: (file == &quot;settings.yml&quot;)</span><span class="diff-line del">-   block:</span><span class="diff-line del">-     - name: Migrator | &#x27;settings.yml&#x27; | Migration 01</span><span class="diff-line del">-       ansible.builtin.include_tasks: &quot;migrator/settings_yml/migration_01.yml&quot;</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-44">
                <div class="file-header">
                    <span class="badge removed">removed</span>
                    <h3>roles/settings/tasks/subtasks/migrator/accounts_yml/migration_01.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line del">- ########################################################################################</span><span class="diff-line del">- # Title:         Saltbox: Settings | Migrator | &#x27;accounts.yml&#x27; | Migration 01          #</span><span class="diff-line del">- # Author(s):     desimaniac                                                            #</span><span class="diff-line del">- # URL:           https://github.com/saltyorg/Saltbox                                   #</span><span class="diff-line del">- # --                                                                                   #</span><span class="diff-line del">- ########################################################################################</span><span class="diff-line del">- #                            GNU General Public License v3.0                           #</span><span class="diff-line del">- ########################################################################################</span><span class="diff-line del">- ---</span><span class="diff-line del">- - name: &quot;Migrator | &#x27;accounts.yml&#x27; | Migration 01 | Set variables&quot;</span><span class="diff-line del">-   ansible.builtin.set_fact:</span><span class="diff-line del">-     plex_settings: &quot;{{ not ((plex is undefined)</span><span class="diff-line del">-                             or</span><span class="diff-line del">-                             (plex is none)</span><span class="diff-line del">-                             or</span><span class="diff-line del">-                             (plex | trim | length == 0)) }}&quot;</span><span class="diff-line del">- </span><span class="diff-line del">- - name: Migrator | &#x27;adv_settings.yml&#x27; | Migration 01 | Delete &#x27;plex&#x27; dict</span><span class="diff-line del">-   ansible.builtin.shell: |</span><span class="diff-line del">-     yyq -i &#x27;del(.plex)&#x27; {{ playbook_dir }}/{{ file }}</span><span class="diff-line del">-   become: true</span><span class="diff-line del">-   become_user: &quot;{{ saltbox_yml.stat.pw_name }}&quot;</span><span class="diff-line del">-   when: plex_settings</span><span class="diff-line del">- </span><span class="diff-line del">- - name: Migrator | &#x27;accounts.yml&#x27; | Migration 01 | Remove &#x27;null&#x27; values</span><span class="diff-line del">-   ansible.builtin.replace:</span><span class="diff-line del">-     path: &quot;{{ playbook_dir }}/{{ file }}&quot;</span><span class="diff-line del">-     regexp: &#x27;(?&lt;=: )\bnull\s*$&#x27;</span><span class="diff-line del">-     replace: &#x27;&#x27;</span><span class="diff-line del">-     owner: &quot;{{ saltbox_yml.stat.uid }}&quot;</span><span class="diff-line del">-     group: &quot;{{ saltbox_yml.stat.gid }}&quot;</span><span class="diff-line del">-     mode: &quot;0664&quot;</span><span class="diff-line del">- </span><span class="diff-line del">- - name: Migrator | &#x27;accounts.yml&#x27; | Migration 01 | Re-import Variables</span><span class="diff-line del">-   ansible.builtin.include_vars: &quot;{{ playbook_dir }}/{{ file }}&quot;</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-45">
                <div class="file-header">
                    <span class="badge removed">removed</span>
                    <h3>roles/settings/tasks/subtasks/migrator/adv_settings_yml/migration_01.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line del">- ########################################################################################</span><span class="diff-line del">- # Title:         Saltbox: Settings | Migrator | &#x27;adv_settings.yml&#x27; | Migration 01      #</span><span class="diff-line del">- # Author(s):     desimaniac, salty                                                     #</span><span class="diff-line del">- # URL:           https://github.com/saltyorg/Saltbox                                   #</span><span class="diff-line del">- # --                                                                                   #</span><span class="diff-line del">- ########################################################################################</span><span class="diff-line del">- #                            GNU General Public License v3.0                           #</span><span class="diff-line del">- ########################################################################################</span><span class="diff-line del">- </span><span class="diff-line del">- ---</span><span class="diff-line del">- - name: &quot;Migrator | &#x27;adv_settings.yml&#x27; | Migration 01 | Set variables&quot;</span><span class="diff-line del">-   ansible.builtin.set_fact:</span><span class="diff-line del">-     old_traefik_tls_settings: &quot;{{ not ((traefik is undefined)</span><span class="diff-line del">-                                   or</span><span class="diff-line del">-                                   (traefik is none)</span><span class="diff-line del">-                                   or</span><span class="diff-line del">-                                   (traefik | trim | length == 0)</span><span class="diff-line del">-                                   or</span><span class="diff-line del">-                                   (traefik.tls is undefined)</span><span class="diff-line del">-                                   or</span><span class="diff-line del">-                                   (traefik.tls is none)</span><span class="diff-line del">-                                   or</span><span class="diff-line del">-                                   (traefik.tls | trim | length == 0)) }}&quot;</span><span class="diff-line del">-     old_traefik_http_settings: &quot;{{ not ((traefik is undefined)</span><span class="diff-line del">-                                    or</span><span class="diff-line del">-                                    (traefik is none)</span><span class="diff-line del">-                                    or</span><span class="diff-line del">-                                    (traefik | trim | length == 0)</span><span class="diff-line del">-                                    or</span><span class="diff-line del">-                                    (traefik.http is undefined)</span><span class="diff-line del">-                                    or</span><span class="diff-line del">-                                    (traefik.http is none)</span><span class="diff-line del">-                                    or</span><span class="diff-line del">-                                    (traefik.http | trim | length == 0)) }}&quot;</span><span class="diff-line del">-     old_zerossl_settings: &quot;{{ not ((dns is undefined)</span><span class="diff-line del">-                               or</span><span class="diff-line del">-                               (dns is none)</span><span class="diff-line del">-                               or</span><span class="diff-line del">-                               (dns | trim | length == 0)</span><span class="diff-line del">-                               or</span><span class="diff-line del">-                               (dns.zerossl is undefined)</span><span class="diff-line del">-                               or</span><span class="diff-line del">-                               (dns.zerossl is none)</span><span class="diff-line del">-                               or</span><span class="diff-line del">-                               (dns.zerossl | trim | length == 0)) }}&quot;</span><span class="diff-line del">-     traefik_metrics_settings: &quot;{{ not ((traefik is undefined)</span><span class="diff-line del">-                                   or</span><span class="diff-line del">-                                   (traefik is none)</span><span class="diff-line del">-                                   or</span><span class="diff-line del">-                                   (traefik | trim | length == 0)</span><span class="diff-line del">-                                   or</span><span class="diff-line del">-                                   (traefik.metrics is undefined)</span><span class="diff-line del">-                                   or</span><span class="diff-line del">-                                   (traefik.metrics is none)</span><span class="diff-line del">-                                   or</span><span class="diff-line del">-                                   (traefik.metrics | trim | length == 0)) }}&quot;</span><span class="diff-line del">-     old_dockerhub: &quot;{{ not ((dockerhub is undefined)</span><span class="diff-line del">-                        or</span><span class="diff-line del">-                        (dockerhub is none)</span><span class="diff-line del">-                        or</span><span class="diff-line del">-                        (dockerhub | trim | length == 0)) }}&quot;</span><span class="diff-line del">-     old_dns_enabled: &quot;{{ not ((dns.enabled is undefined)</span><span class="diff-line del">-                          or</span><span class="diff-line del">-                          (dns.enabled is none)</span><span class="diff-line del">-                          or</span><span class="diff-line del">-                          (dns.enabled | trim | length == 0)) }}&quot;</span><span class="diff-line del">-     old_feeder_mount: &quot;{{ not ((mounts.feeder is undefined)</span><span class="diff-line del">-                           or</span><span class="diff-line del">-                           (mounts.feeder is none)</span><span class="diff-line del">-                           or</span><span class="diff-line del">-                           (mounts.feeder | trim | length == 0)) }}&quot;</span><span class="diff-line del">-     old_remote_mount: &quot;{{ not ((mounts.remote is undefined)</span><span class="diff-line del">-                           or</span><span class="diff-line del">-                           (mounts.remote is none)</span><span class="diff-line del">-                           or</span><span class="diff-line del">-                           (mounts.remote | trim | length == 0)) }}&quot;</span><span class="diff-line del">- </span><span class="diff-line del">- - name: Migrator | &#x27;adv_settings.yml&#x27; | Migration 01 | Delete &#x27;traefik.tls&#x27; dict</span><span class="diff-line del">-   ansible.builtin.shell: |</span><span class="diff-line del">-     yyq -i &#x27;del(.traefik.tls)&#x27; {{ playbook_dir }}/{{ file }}</span><span class="diff-line del">-   become: true</span><span class="diff-line del">-   become_user: &quot;{{ saltbox_yml.stat.pw_name }}&quot;</span><span class="diff-line del">-   when: old_traefik_tls_settings</span><span class="diff-line del">- </span><span class="diff-line del">- - name: Migrator | &#x27;adv_settings.yml&#x27; | Migration 01 | Rebuild &#x27;traefik.cert.http_validation&#x27; dict</span><span class="diff-line del">-   ansible.builtin.shell: |</span><span class="diff-line del">-     yyq -i &#x27;.traefik.cert.http_validation = &quot;{{ &#x27;yes&#x27; if (traefik.http | default(false)) else &#x27;no&#x27; }}&quot;&#x27; {{ playbook_dir }}/{{ file }}</span><span class="diff-line del">-   become: true</span><span class="diff-line del">-   become_user: &quot;{{ saltbox_yml.stat.pw_name }}&quot;</span><span class="diff-line del">-   when: old_traefik_http_settings</span><span class="diff-line del">- </span><span class="diff-line del">- - name: Migrator | &#x27;adv_settings.yml&#x27; | Migration 01 | Delete &#x27;traefik.http&#x27; dict</span><span class="diff-line del">-   ansible.builtin.shell: |</span><span class="diff-line del">-     yyq -i &#x27;del(.traefik.http)&#x27; {{ playbook_dir }}/{{ file }}</span><span class="diff-line del">-   become: true</span><span class="diff-line del">-   become_user: &quot;{{ saltbox_yml.stat.pw_name }}&quot;</span><span class="diff-line del">-   when: old_traefik_http_settings</span><span class="diff-line del">- </span><span class="diff-line del">- - name: Migrator | &#x27;adv_settings.yml&#x27; | Migration 01 | Rebuild &#x27;traefik.cert.zerossl&#x27; dict</span><span class="diff-line del">-   ansible.builtin.shell: |</span><span class="diff-line del">-     yyq -i &#x27;.traefik.cert.zerossl = &quot;{{ &#x27;yes&#x27; if (dns.zerossl | default(false)) else &#x27;no&#x27; }}&quot;&#x27; {{ playbook_dir }}/{{ file }}</span><span class="diff-line del">-   become: true</span><span class="diff-line del">-   become_user: &quot;{{ saltbox_yml.stat.pw_name }}&quot;</span><span class="diff-line del">-   when: old_zerossl_settings</span><span class="diff-line del">- </span><span class="diff-line del">- - name: Migrator | &#x27;adv_settings.yml&#x27; | Migration 01 | Delete &#x27;dns.zerossl&#x27; dict</span><span class="diff-line del">-   ansible.builtin.shell: |</span><span class="diff-line del">-     yyq -i &#x27;del(.dns.zerossl)&#x27; {{ playbook_dir }}/{{ file }}</span><span class="diff-line del">-   become: true</span><span class="diff-line del">-   become_user: &quot;{{ saltbox_yml.stat.pw_name }}&quot;</span><span class="diff-line del">-   when: old_zerossl_settings</span><span class="diff-line del">- </span><span class="diff-line del">- - name: Migrator | &#x27;adv_settings.yml&#x27; | Migration 01 | Rebuild &#x27;traefik.metrics&#x27; dict</span><span class="diff-line del">-   ansible.builtin.shell: |</span><span class="diff-line del">-     yyq -i &#x27;.traefik.metrics = &quot;no&quot;&#x27; {{ playbook_dir }}/{{ file }}</span><span class="diff-line del">-   become: true</span><span class="diff-line del">-   become_user: &quot;{{ saltbox_yml.stat.pw_name }}&quot;</span><span class="diff-line del">-   when: (not traefik_metrics_settings)</span><span class="diff-line del">- </span><span class="diff-line del">- - name: Migrator | &#x27;adv_settings.yml&#x27; | Migration 01 | Delete &#x27;dockerhub&#x27; dict</span><span class="diff-line del">-   ansible.builtin.shell: |</span><span class="diff-line del">-     yyq -i &#x27;del(.dockerhub)&#x27; {{ playbook_dir }}/{{ file }}</span><span class="diff-line del">-   become: true</span><span class="diff-line del">-   become_user: &quot;{{ saltbox_yml.stat.pw_name }}&quot;</span><span class="diff-line del">-   when: old_dockerhub</span><span class="diff-line del">- </span><span class="diff-line del">- - name: Migrator | &#x27;adv_settings.yml&#x27; | Migration 01 | Delete &#x27;dns.enabled&#x27; key-pair</span><span class="diff-line del">-   ansible.builtin.shell: |</span><span class="diff-line del">-     yyq -i &#x27;del(.dns.enabled)&#x27; {{ playbook_dir }}/{{ file }}</span><span class="diff-line del">-   become: true</span><span class="diff-line del">-   become_user: &quot;{{ saltbox_yml.stat.pw_name }}&quot;</span><span class="diff-line del">-   when: old_dns_enabled</span><span class="diff-line del">- </span><span class="diff-line del">- - name: Migrator | &#x27;adv_settings.yml&#x27; | Migration 01 | Delete &#x27;mounts.feeder&#x27; dict</span><span class="diff-line del">-   ansible.builtin.shell: |</span><span class="diff-line del">-     yyq -i &#x27;del(.mounts.feeder)&#x27; {{ playbook_dir }}/{{ file }}</span><span class="diff-line del">-   become: true</span><span class="diff-line del">-   become_user: &quot;{{ saltbox_yml.stat.pw_name }}&quot;</span><span class="diff-line del">-   when: old_feeder_mount</span><span class="diff-line del">- </span><span class="diff-line del">- - name: Migrator | &#x27;adv_settings.yml&#x27; | Migration 01 | Delete &#x27;mounts.remote&#x27; dict</span><span class="diff-line del">-   ansible.builtin.shell: |</span><span class="diff-line del">-     yyq -i &#x27;del(.mounts.remote)&#x27; {{ playbook_dir }}/{{ file }}</span><span class="diff-line del">-   become: true</span><span class="diff-line del">-   become_user: &quot;{{ saltbox_yml.stat.pw_name }}&quot;</span><span class="diff-line del">-   when: old_remote_mount</span><span class="diff-line del">- </span><span class="diff-line del">- - name: Migrator | &#x27;adv_settings.yml&#x27; | Migration 01 | Delete &#x27;gpu.nvidia&#x27; dict</span><span class="diff-line del">-   ansible.builtin.shell: |</span><span class="diff-line del">-     yyq -i &#x27;del(.gpu.nvidia)&#x27; {{ playbook_dir }}/{{ file }}</span><span class="diff-line del">-   become: true</span><span class="diff-line del">-   become_user: &quot;{{ saltbox_yml.stat.pw_name }}&quot;</span><span class="diff-line del">-   when: gpu is defined and gpu.nvidia is defined</span><span class="diff-line del">- </span><span class="diff-line del">- - name: Migrator | &#x27;adv_settings.yml&#x27; | Migration 01 | Delete &#x27;traefik.tracing&#x27; dict</span><span class="diff-line del">-   ansible.builtin.shell: |</span><span class="diff-line del">-     yyq -i &#x27;del(.traefik.tracing)&#x27; {{ playbook_dir }}/{{ file }}</span><span class="diff-line del">-   become: true</span><span class="diff-line del">-   become_user: &quot;{{ saltbox_yml.stat.pw_name }}&quot;</span><span class="diff-line del">-   when: traefik is defined and traefik.tracing is defined</span><span class="diff-line del">- </span><span class="diff-line del">- - name: Migrator | &#x27;adv_settings.yml&#x27; | Migration 01 | Delete &#x27;traefik.subdomains.jaeger&#x27; dict</span><span class="diff-line del">-   ansible.builtin.shell: |</span><span class="diff-line del">-     yyq -i &#x27;del(.traefik.subdomains.jaeger)&#x27; {{ playbook_dir }}/{{ file }}</span><span class="diff-line del">-   become: true</span><span class="diff-line del">-   become_user: &quot;{{ saltbox_yml.stat.pw_name }}&quot;</span><span class="diff-line del">-   when: traefik is defined and traefik.subdomains is defined and traefik.subdomains.jaeger is defined</span><span class="diff-line del">- </span><span class="diff-line del">- - name: Migrator | &#x27;adv_settings.yml&#x27; | Migration 01 | Remove &#x27;null&#x27; values</span><span class="diff-line del">-   ansible.builtin.replace:</span><span class="diff-line del">-     path: &quot;{{ playbook_dir }}/{{ file }}&quot;</span><span class="diff-line del">-     regexp: &#x27;(?&lt;=: )\bnull\s*$&#x27;</span><span class="diff-line del">-     replace: &#x27;&#x27;</span><span class="diff-line del">-     owner: &quot;{{ saltbox_yml.stat.uid }}&quot;</span><span class="diff-line del">-     group: &quot;{{ saltbox_yml.stat.gid }}&quot;</span><span class="diff-line del">-     mode: &quot;0664&quot;</span><span class="diff-line del">- </span><span class="diff-line del">- - name: Migrator | &#x27;adv_settings.yml&#x27; | Migration 01 | Re-import Variables</span><span class="diff-line del">-   ansible.builtin.include_vars: &quot;{{ playbook_dir }}/{{ file }}&quot;</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-46">
                <div class="file-header">
                    <span class="badge removed">removed</span>
                    <h3>roles/settings/tasks/subtasks/migrator/all/migration_01.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line del">- ########################################################################################</span><span class="diff-line del">- # Title:         Saltbox: Settings | Migrator | All | Migration 01                     #</span><span class="diff-line del">- # Author(s):     desimaniac, salty                                                     #</span><span class="diff-line del">- # URL:           https://github.com/saltyorg/Saltbox                                   #</span><span class="diff-line del">- # --                                                                                   #</span><span class="diff-line del">- ########################################################################################</span><span class="diff-line del">- #                            GNU General Public License v3.0                           #</span><span class="diff-line del">- ########################################################################################</span><span class="diff-line del">- ---</span><span class="diff-line del">- - name: Migrator | All | &#x27;{{ file }}&#x27; | Migration 01 | Add single space after colon (if needed)</span><span class="diff-line del">-   ansible.builtin.replace:</span><span class="diff-line del">-     path: &quot;{{ playbook_dir }}/{{ file }}&quot;</span><span class="diff-line del">-     regexp: &#x27;(:)[ \t]*(.*)&#x27;</span><span class="diff-line del">-     replace: &#x27;\1 \2&#x27;</span><span class="diff-line del">-     owner: &quot;{{ saltbox_yml.stat.uid }}&quot;</span><span class="diff-line del">-     group: &quot;{{ saltbox_yml.stat.gid }}&quot;</span><span class="diff-line del">-     mode: &quot;0664&quot;</span><span class="diff-line del">- </span><span class="diff-line del">- - name: Migrator | All | &#x27;{{ file }}&#x27; | Migration 01 | Re-import Variables</span><span class="diff-line del">-   ansible.builtin.include_vars: &quot;{{ playbook_dir }}/{{ file }}&quot;</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-47">
                <div class="file-header">
                    <span class="badge removed">removed</span>
                    <h3>roles/settings/tasks/subtasks/migrator/backup_config_yml/migration_01.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line del">- ########################################################################################</span><span class="diff-line del">- # Title:         Saltbox: Settings | Migrator | &#x27;backup_config.yml&#x27; | Migration 01     #</span><span class="diff-line del">- # Author(s):     desimaniac, salty                                                     #</span><span class="diff-line del">- # URL:           https://github.com/saltyorg/Saltbox                                   #</span><span class="diff-line del">- # --                                                                                   #</span><span class="diff-line del">- ########################################################################################</span><span class="diff-line del">- #                            GNU General Public License v3.0                           #</span><span class="diff-line del">- ########################################################################################</span><span class="diff-line del">- ---</span><span class="diff-line del">- - name: &quot;Migrator | &#x27;backup_config.yml&#x27; | Migration 01 | Set variables&quot;</span><span class="diff-line del">-   ansible.builtin.set_fact:</span><span class="diff-line del">-     old_settings: &quot;{{ (backup.cron.enable is defined)</span><span class="diff-line del">-                       or</span><span class="diff-line del">-                       (backup.cron.cron_state is defined) }}&quot;</span><span class="diff-line del">- </span><span class="diff-line del">- - name: Migrator | &#x27;backup_config.yml&#x27; | Migration 01 | Rebuild &#x27;backup.cron&#x27; dict</span><span class="diff-line del">-   ansible.builtin.shell: |</span><span class="diff-line del">-     yyq -i &#x27;del(.backup.cron.cron_state)&#x27; {{ playbook_dir }}/{{ file }}</span><span class="diff-line del">-     yyq -i &#x27;del(.backup.cron.enable)&#x27; {{ playbook_dir }}/{{ file }}</span><span class="diff-line del">-   become: true</span><span class="diff-line del">-   become_user: &quot;{{ saltbox_yml.stat.pw_name }}&quot;</span><span class="diff-line del">-   when: old_settings</span><span class="diff-line del">- </span><span class="diff-line del">- - name: Migrator | &#x27;backup_config.yml&#x27; | Migration 01 | Remove &#x27;null&#x27; values</span><span class="diff-line del">-   ansible.builtin.replace:</span><span class="diff-line del">-     path: &quot;{{ playbook_dir }}/{{ file }}&quot;</span><span class="diff-line del">-     regexp: &#x27;(?&lt;=: )\bnull\s*$&#x27;</span><span class="diff-line del">-     replace: &#x27;&#x27;</span><span class="diff-line del">-     owner: &quot;{{ saltbox_yml.stat.uid }}&quot;</span><span class="diff-line del">-     group: &quot;{{ saltbox_yml.stat.gid }}&quot;</span><span class="diff-line del">-     mode: &quot;0664&quot;</span><span class="diff-line del">- </span><span class="diff-line del">- - name: Migrator | &#x27;backup_config.yml&#x27; | Migration 01 | Re-import Variables</span><span class="diff-line del">-   ansible.builtin.include_vars: &quot;{{ playbook_dir }}/{{ file }}&quot;</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-48">
                <div class="file-header">
                    <span class="badge removed">removed</span>
                    <h3>roles/settings/tasks/subtasks/migrator/providers_yml/migration_01.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line del">- ########################################################################################</span><span class="diff-line del">- # Title:         Saltbox: Settings | Migrator | &#x27;providers.yml&#x27; | Migration 01         #</span><span class="diff-line del">- # Author(s):     salty                                                                 #</span><span class="diff-line del">- # URL:           https://github.com/saltyorg/Saltbox                                   #</span><span class="diff-line del">- # --                                                                                   #</span><span class="diff-line del">- ########################################################################################</span><span class="diff-line del">- #                            GNU General Public License v3.0                           #</span><span class="diff-line del">- ########################################################################################</span><span class="diff-line del">- ---</span><span class="diff-line del">- - name: &quot;Migrator | &#x27;backup_config.yml&#x27; | Migration 01 | Set variables&quot;</span><span class="diff-line del">-   ansible.builtin.set_fact:</span><span class="diff-line del">-     old_godaddy: &quot;{{ (goddady is defined) }}&quot;</span><span class="diff-line del">-     old_godaddy_filled: &quot;{{ (goddady is defined) and</span><span class="diff-line del">-                             (goddady is not none) and</span><span class="diff-line del">-                             (goddady | trim | length &gt; 0) and</span><span class="diff-line del">-                             (goddady.api_key is defined) and</span><span class="diff-line del">-                             (goddady.api_key is not none) and</span><span class="diff-line del">-                             (goddady.api_key | length &gt; 0) and</span><span class="diff-line del">-                             (goddady.api_secret is defined) and</span><span class="diff-line del">-                             (goddady.api_secret is not none) and</span><span class="diff-line del">-                             (goddady.api_secret | length &gt; 0) }}&quot;</span><span class="diff-line del">- </span><span class="diff-line del">- - name: Migrator | &#x27;backup_config.yml&#x27; | Migration 01 | Delete &#x27;goddady&#x27; dict</span><span class="diff-line del">-   ansible.builtin.shell: |</span><span class="diff-line del">-     yyq -i &#x27;del(.goddady)&#x27; {{ playbook_dir }}/{{ file }}</span><span class="diff-line del">-   become: true</span><span class="diff-line del">-   become_user: &quot;{{ saltbox_yml.stat.pw_name }}&quot;</span><span class="diff-line del">-   when: old_godaddy</span><span class="diff-line del">- </span><span class="diff-line del">- - name: Migrator | &#x27;backup_config.yml&#x27; | Migration 01 | Rebuild &#x27;godaddy&#x27; dict</span><span class="diff-line del">-   ansible.builtin.shell: |</span><span class="diff-line del">-     yyq -i &#x27;.godaddy.api_key = &quot;{{ goddady.api_key }}&quot;&#x27; {{ playbook_dir }}/{{ file }}</span><span class="diff-line del">-     yyq -i &#x27;.godaddy.api_secret = &quot;{{ goddady.api_secret }}&quot;&#x27; {{ playbook_dir }}/{{ file }}</span><span class="diff-line del">-   become: true</span><span class="diff-line del">-   become_user: &quot;{{ saltbox_yml.stat.pw_name }}&quot;</span><span class="diff-line del">-   when: old_godaddy_filled</span><span class="diff-line del">- </span><span class="diff-line del">- - name: Migrator | &#x27;backup_config.yml&#x27; | Migration 01 | Remove &#x27;null&#x27; values</span><span class="diff-line del">-   ansible.builtin.replace:</span><span class="diff-line del">-     path: &quot;{{ playbook_dir }}/{{ file }}&quot;</span><span class="diff-line del">-     regexp: &#x27;(?&lt;=: )\bnull\s*$&#x27;</span><span class="diff-line del">-     replace: &#x27;&#x27;</span><span class="diff-line del">-     owner: &quot;{{ saltbox_yml.stat.uid }}&quot;</span><span class="diff-line del">-     group: &quot;{{ saltbox_yml.stat.gid }}&quot;</span><span class="diff-line del">-     mode: &quot;0664&quot;</span><span class="diff-line del">- </span><span class="diff-line del">- - name: Migrator | &#x27;backup_config.yml&#x27; | Migration 01 | Re-import Variables</span><span class="diff-line del">-   ansible.builtin.include_vars: &quot;{{ playbook_dir }}/{{ file }}&quot;</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-49">
                <div class="file-header">
                    <span class="badge removed">removed</span>
                    <h3>roles/settings/tasks/subtasks/migrator/settings_yml/migration_01.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line del">- ########################################################################################</span><span class="diff-line del">- # Title:         Saltbox: Settings | Migrator | &#x27;settings.yml&#x27; | Migration 01          #</span><span class="diff-line del">- # Author(s):     salty                                                                 #</span><span class="diff-line del">- # URL:           https://github.com/saltyorg/Saltbox                                   #</span><span class="diff-line del">- # --                                                                                   #</span><span class="diff-line del">- ########################################################################################</span><span class="diff-line del">- #                            GNU General Public License v3.0                           #</span><span class="diff-line del">- ########################################################################################</span><span class="diff-line del">- </span><span class="diff-line del">- ---</span><span class="diff-line del">- - name: &quot;Migrator | &#x27;settings.yml&#x27; | Migration 01 | Set variables&quot;</span><span class="diff-line del">-   ansible.builtin.set_fact:</span><span class="diff-line del">-     old_download: &quot;{{ not</span><span class="diff-line del">-                       ((downloads.nzbs is undefined)</span><span class="diff-line del">-                       or</span><span class="diff-line del">-                       (downloads.torrents is undefined)) }}&quot;</span><span class="diff-line del">-     old_feeder_mount: &quot;{{ (not ((mounts.feeder is undefined)</span><span class="diff-line del">-                           or</span><span class="diff-line del">-                           (mounts.feeder is none)</span><span class="diff-line del">-                           or</span><span class="diff-line del">-                           (mounts.feeder | trim | length == 0)))</span><span class="diff-line del">-                           and mounts.feeder }}&quot;</span><span class="diff-line del">- </span><span class="diff-line del">- - name: Migrator | &#x27;settings.yml&#x27; | Migration 01 | Rebuild &#x27;downloads&#x27; dict</span><span class="diff-line del">-   ansible.builtin.shell: |</span><span class="diff-line del">-     yyq -i &#x27;del(.downloads)&#x27; {{ playbook_dir }}/{{ file }}</span><span class="diff-line del">-     yyq -i &#x27;.downloads = &quot;/mnt/unionfs/downloads&quot;&#x27; {{ playbook_dir }}/{{ file }}</span><span class="diff-line del">-   become: true</span><span class="diff-line del">-   become_user: &quot;{{ saltbox_yml.stat.pw_name }}&quot;</span><span class="diff-line del">-   when: old_download</span><span class="diff-line del">- </span><span class="diff-line del">- - name: Migrator | &#x27;settings.yml&#x27; | Migration 01 | Delete &#x27;rclone.remote&#x27; dict</span><span class="diff-line del">-   ansible.builtin.shell: |</span><span class="diff-line del">-     yyq -i &#x27;del(.rclone.remote)&#x27; {{ playbook_dir }}/{{ file }}</span><span class="diff-line del">-   become: true</span><span class="diff-line del">-   become_user: &quot;{{ saltbox_yml.stat.pw_name }}&quot;</span><span class="diff-line del">-   when: rclone.remote is defined</span><span class="diff-line del">- </span><span class="diff-line del">- - name: Migrator | &#x27;settings.yml&#x27; | Migration 01 | Create &#x27;rclone.remotes&#x27; dict</span><span class="diff-line del">-   ansible.builtin.shell: |</span><span class="diff-line del">-     yyq -i &#x27;.rclone.remotes += [{&quot;remote&quot;: &quot;{{ rclone.remote }}&quot;, &quot;settings&quot;: {&quot;mount&quot;: true, &quot;template&quot;: &quot;google&quot;, &quot;union&quot;: true, &quot;upload&quot;: true, &quot;upload_from&quot;: &quot;/mnt/local/Media&quot;, &quot;vfs_cache&quot;: {&quot;enabled&quot;: false, &quot;size&quot;: &quot;50G&quot;, &quot;max_age&quot;: &quot;504h&quot;}}}]&#x27; {{ playbook_dir }}/{{ file }}</span><span class="diff-line del">-   become: true</span><span class="diff-line del">-   become_user: &quot;{{ saltbox_yml.stat.pw_name }}&quot;</span><span class="diff-line del">-   when: (rclone.remotes is undefined) and rclone_old_remote_is_defined</span><span class="diff-line del">- </span><span class="diff-line del">- - name: Migrator | &#x27;settings.yml&#x27; | Migration 01 | Create &#x27;rclone.remotes&#x27; dict</span><span class="diff-line del">-   ansible.builtin.shell: |</span><span class="diff-line del">-     yyq -i &#x27;.rclone.remotes += [{&quot;remote&quot;: &quot;google&quot;, &quot;settings&quot;: {&quot;mount&quot;: true, &quot;template&quot;: &quot;google&quot;, &quot;union&quot;: true, &quot;upload&quot;: true, &quot;upload_from&quot;: &quot;/mnt/local/Media&quot;, &quot;vfs_cache&quot;: {&quot;enabled&quot;: false, &quot;size&quot;: &quot;50G&quot;, &quot;max_age&quot;: &quot;504h&quot;}}}]&#x27; {{ playbook_dir }}/{{ file }}</span><span class="diff-line del">-   become: true</span><span class="diff-line del">-   become_user: &quot;{{ saltbox_yml.stat.pw_name }}&quot;</span><span class="diff-line del">-   when: (rclone.remotes is undefined) and not rclone_old_remote_is_defined</span><span class="diff-line del">- </span><span class="diff-line del">- - name: Migrator | &#x27;settings.yml&#x27; | Migration 01 | Add feeder to remotes</span><span class="diff-line del">-   ansible.builtin.shell: |</span><span class="diff-line del">-     yyq -i &#x27;.rclone.remotes += [{&quot;remote&quot;: &quot;feeder&quot;, &quot;settings&quot;: {&quot;mount&quot;: true, &quot;template&quot;: &quot;sftp&quot;, &quot;union&quot;: true, &quot;upload&quot;: false, &quot;upload_from&quot;: &quot;/mnt/local/Media&quot;, &quot;vfs_cache&quot;: {&quot;enabled&quot;: false, &quot;size&quot;: &quot;50G&quot;, &quot;max_age&quot;: &quot;504h&quot;}}}]&#x27; {{ playbook_dir }}/{{ file }}</span><span class="diff-line del">-   become: true</span><span class="diff-line del">-   become_user: &quot;{{ saltbox_yml.stat.pw_name }}&quot;</span><span class="diff-line del">-   when: old_feeder_mount</span><span class="diff-line del">- </span><span class="diff-line del">- - name: Migrator | &#x27;settings.yml&#x27; | Migration 01 | Create &#x27;rclone.enabled&#x27; dict</span><span class="diff-line del">-   ansible.builtin.shell: |</span><span class="diff-line del">-     yyq -i &#x27;.rclone.enabled = {{ &quot;true&quot; if (rclone_old_remote_is_defined or rclone_remote_is_defined) else &quot;false&quot; }}&#x27; {{ playbook_dir }}/{{ file }}</span><span class="diff-line del">-   become: true</span><span class="diff-line del">-   become_user: &quot;{{ saltbox_yml.stat.pw_name }}&quot;</span><span class="diff-line del">-   when: (rclone.enabled is undefined)</span><span class="diff-line del">- </span><span class="diff-line del">- - name: Migrator | &#x27;settings.yml&#x27; | Migration 01 | Upgrade to new settings format</span><span class="diff-line del">-   when: (rclone.remotes is defined) and (rclone.remotes is not none) and (rclone.remotes | length &gt; 0)</span><span class="diff-line del">-   block:</span><span class="diff-line del">-     - name: Migrator | &#x27;settings.yml&#x27; | Migration 01 | Read current config file</span><span class="diff-line del">-       ansible.builtin.slurp:</span><span class="diff-line del">-         src: /srv/git/saltbox/settings.yml</span><span class="diff-line del">-       register: settings_config_content</span><span class="diff-line del">- </span><span class="diff-line del">-     - name: Migrator | &#x27;settings.yml&#x27; | Migration 01 | Parse the configuration</span><span class="diff-line del">-       ansible.builtin.set_fact:</span><span class="diff-line del">-         settings_config: &quot;{{ settings_config_content[&#x27;content&#x27;] | b64decode | from_yaml }}&quot;</span><span class="diff-line del">- </span><span class="diff-line del">-     - name: Migrator | &#x27;settings.yml&#x27; | Migration 01 | Transform the data structure</span><span class="diff-line del">-       ansible.builtin.set_fact:</span><span class="diff-line del">-         new_remotes: &quot;{{ new_remotes | default([]) + [{&#x27;remote&#x27;: item.remote, &#x27;settings&#x27;: {&#x27;mount&#x27;: true, &#x27;template&#x27;: (item.template | default(&#x27;google&#x27;)), &#x27;union&#x27;: true, &#x27;upload&#x27;: (item.upload | default(false)), &#x27;upload_from&#x27;: (item.upload_from | default(&#x27;/mnt/local/Media&#x27;)), &#x27;vfs_cache&#x27;: {&#x27;enabled&#x27;: (item.vfs_cache.enabled | default(false)), &#x27;max_age&#x27;: (item.vfs_cache.max_age | default(&#x27;504h&#x27;)), &#x27;size&#x27;: (item.vfs_cache.size | default(&#x27;50G&#x27;))}}}] }}&quot;</span><span class="diff-line del">-       loop: &quot;{{ settings_config.rclone.remotes }}&quot;</span><span class="diff-line del">-       when: item.template is defined</span><span class="diff-line del">- </span><span class="diff-line del">-     - name: Migrator | &#x27;settings.yml&#x27; | Migration 01 | Combine new structure with original config</span><span class="diff-line del">-       ansible.builtin.set_fact:</span><span class="diff-line del">-         new_config: &quot;{{ (settings_config | combine({&#x27;rclone&#x27;: {&#x27;remotes&#x27;: new_remotes}}, recursive=True)) }}&quot;</span><span class="diff-line del">-       when: new_remotes is defined</span><span class="diff-line del">- </span><span class="diff-line del">-     - name: Migrator | &#x27;settings.yml&#x27; | Migration 01 | Write the new configuration file</span><span class="diff-line del">-       ansible.builtin.copy:</span><span class="diff-line del">-         dest: /srv/git/saltbox/settings.yml</span><span class="diff-line del">-         content: &quot;{{ new_config | to_nice_yaml }}&quot;</span><span class="diff-line del">-         owner: &quot;{{ saltbox_yml.stat.uid }}&quot;</span><span class="diff-line del">-         group: &quot;{{ saltbox_yml.stat.gid }}&quot;</span><span class="diff-line del">-         mode: &quot;0664&quot;</span><span class="diff-line del">-       when: new_remotes is defined</span><span class="diff-line del">- </span><span class="diff-line del">- - name: Migrator | &#x27;settings.yml&#x27; | Migration 01 | Ensure enable_refresh is set correctly for each remote</span><span class="diff-line del">-   when: (settings_config.rclone.remotes is defined) and (settings_config.rclone.remotes is not none) and (settings_config.rclone.remotes | length &gt; 0)</span><span class="diff-line del">-   block:</span><span class="diff-line del">-     - name: Migrator | &#x27;settings.yml&#x27; | Migration 01 | Read current config file</span><span class="diff-line del">-       ansible.builtin.slurp:</span><span class="diff-line del">-         src: /srv/git/saltbox/settings.yml</span><span class="diff-line del">-       register: settings_config_content</span><span class="diff-line del">- </span><span class="diff-line del">-     - name: Migrator | &#x27;settings.yml&#x27; | Migration 01 | Parse the configuration</span><span class="diff-line del">-       ansible.builtin.set_fact:</span><span class="diff-line del">-         settings_config: &quot;{{ settings_config_content[&#x27;content&#x27;] | b64decode | from_yaml }}&quot;</span><span class="diff-line del">- </span><span class="diff-line del">-     - name: Migrator | &#x27;settings.yml&#x27; | Migration 01 | Process each remote</span><span class="diff-line del">-       ansible.builtin.set_fact:</span><span class="diff-line del">-         updated_remotes: &quot;{{ updated_remotes | default([]) + [item | combine({&#x27;settings&#x27;: item.settings | combine({&#x27;enable_refresh&#x27;: (item.settings.template != &#x27;sftp&#x27;)}, recursive=True)}, recursive=True)</span><span class="diff-line del">-                                                              if &#x27;enable_refresh&#x27; not in item.settings</span><span class="diff-line del">-                                                              else item] }}&quot;</span><span class="diff-line del">-       loop: &quot;{{ settings_config.rclone.remotes }}&quot;</span><span class="diff-line del">-       loop_control:</span><span class="diff-line del">-         loop_var: item</span><span class="diff-line del">- </span><span class="diff-line del">-     - name: Migrator | &#x27;settings.yml&#x27; | Migration 01 | Update configuration with new remotes</span><span class="diff-line del">-       ansible.builtin.set_fact:</span><span class="diff-line del">-         updated_config: &quot;{{ settings_config | combine({&#x27;rclone&#x27;: {&#x27;remotes&#x27;: updated_remotes}}, recursive=True) }}&quot;</span><span class="diff-line del">- </span><span class="diff-line del">-     - name: Migrator | &#x27;settings.yml&#x27; | Migration 01 | Write updated configuration to file</span><span class="diff-line del">-       ansible.builtin.copy:</span><span class="diff-line del">-         dest: /srv/git/saltbox/settings.yml</span><span class="diff-line del">-         content: &quot;{{ updated_config | to_nice_yaml }}&quot;</span><span class="diff-line del">-         owner: &quot;{{ saltbox_yml.stat.uid }}&quot;</span><span class="diff-line del">-         group: &quot;{{ saltbox_yml.stat.gid }}&quot;</span><span class="diff-line del">-         mode: &quot;0664&quot;</span><span class="diff-line del">- </span><span class="diff-line del">- - name: Migrator | &#x27;settings.yml&#x27; | Migration 01 | Convert &#x27;true&#x27; to &#x27;yes&#x27;</span><span class="diff-line del">-   ansible.builtin.command: &gt;</span><span class="diff-line del">-     yyq &#x27;</span><span class="diff-line del">-       (.. | select(tag == &quot;!!bool&quot; and . == true)) |= &quot;yes&quot;</span><span class="diff-line del">-     &#x27; /srv/git/saltbox/settings.yml -i</span><span class="diff-line del">- </span><span class="diff-line del">- - name: Migrator | &#x27;settings.yml&#x27; | Migration 01 | Convert &#x27;false&#x27; to &#x27;no&#x27;</span><span class="diff-line del">-   ansible.builtin.command: &gt;</span><span class="diff-line del">-     yyq &#x27;</span><span class="diff-line del">-       (.. | select(tag == &quot;!!bool&quot; and . == false)) |= &quot;no&quot;</span><span class="diff-line del">-     &#x27; /srv/git/saltbox/settings.yml -i</span><span class="diff-line del">- </span><span class="diff-line del">- - name: Migrator | &#x27;settings.yml&#x27; | Migration 01 | Remove &#x27;null&#x27; values</span><span class="diff-line del">-   ansible.builtin.replace:</span><span class="diff-line del">-     path: &quot;{{ playbook_dir }}/{{ file }}&quot;</span><span class="diff-line del">-     regexp: &#x27;(?&lt;=: )\bnull\s*$&#x27;</span><span class="diff-line del">-     replace: &#x27;&#x27;</span><span class="diff-line del">-     owner: &quot;{{ saltbox_yml.stat.uid }}&quot;</span><span class="diff-line del">-     group: &quot;{{ saltbox_yml.stat.gid }}&quot;</span><span class="diff-line del">-     mode: &quot;0664&quot;</span><span class="diff-line del">- </span><span class="diff-line del">- - name: Migrator | &#x27;settings.yml&#x27; | Migration 01 | Re-import Variables</span><span class="diff-line del">-   ansible.builtin.include_vars: &quot;{{ playbook_dir }}/{{ file }}&quot;</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-50">
                <div class="file-header">
                    <span class="badge removed">removed</span>
                    <h3>roles/settings/tasks/subtasks/start.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line del">- #########################################################################</span><span class="diff-line del">- # Title:         Saltbox: Settings | Start                              #</span><span class="diff-line del">- # Author(s):     desimaniac                                             #</span><span class="diff-line del">- # URL:           https://github.com/saltyorg/Saltbox                    #</span><span class="diff-line del">- # --                                                                    #</span><span class="diff-line del">- #########################################################################</span><span class="diff-line del">- #                   GNU General Public License v3.0                     #</span><span class="diff-line del">- #########################################################################</span><span class="diff-line del">- ---</span><span class="diff-line del">- - name: &quot;Start | Install yyq&quot;</span><span class="diff-line del">-   ansible.builtin.include_role:</span><span class="diff-line del">-     name: yyq</span><span class="diff-line del">- </span><span class="diff-line del">- - name: &quot;Start | Get &#x27;saltbox.yml&#x27; info&quot;</span><span class="diff-line del">-   ansible.builtin.stat:</span><span class="diff-line del">-     path: &quot;{{ playbook_dir }}/saltbox.yml&quot;</span><span class="diff-line del">-   register: saltbox_yml</span><span class="diff-line del">- </span><span class="diff-line del">- - name: &quot;Start | Create list of config files&quot;</span><span class="diff-line del">-   ansible.builtin.set_fact:</span><span class="diff-line del">-     config_files:</span><span class="diff-line del">-       - &quot;accounts.yml&quot;</span><span class="diff-line del">-       - &quot;settings.yml&quot;</span><span class="diff-line del">-       - &quot;adv_settings.yml&quot;</span><span class="diff-line del">-       - &quot;backup_config.yml&quot;</span><span class="diff-line del">-       - &quot;providers.yml&quot;</span><span class="diff-line del">-       - &quot;hetzner_vlan.yml&quot;</span><span class="diff-line del">-     traefik3_migration: &quot;{{ true if (rclone.remotes is undefined) else false }}&quot;</span><span class="diff-line del">- </span><span class="diff-line del">- - name: Start | Initialize vars with empty lists</span><span class="diff-line del">-   ansible.builtin.set_fact:</span><span class="diff-line del">-     files_updated_successfully: []</span><span class="diff-line del">-     files_updated_unsuccessfully: []</span><span class="diff-line del">-     exit_is_necessary: false</span><span class="diff-line del">- </span><span class="diff-line del">- - name: &quot;Start | Check if &#x27;settings-updater.log&#x27; exists&quot;</span><span class="diff-line del">-   ansible.builtin.stat:</span><span class="diff-line del">-     path: &quot;{{ playbook_dir }}/settings-updater.log&quot;</span><span class="diff-line del">-   register: settings_updater_log</span><span class="diff-line del">- </span><span class="diff-line del">- - name: &quot;Start | Reset ownership of &#x27;settings-updater.log&#x27;&quot;</span><span class="diff-line del">-   ansible.builtin.file:</span><span class="diff-line del">-     path: &quot;{{ playbook_dir }}/settings-updater.log&quot;</span><span class="diff-line del">-     state: file</span><span class="diff-line del">-     owner: &quot;{{ saltbox_yml.stat.uid }}&quot;</span><span class="diff-line del">-     group: &quot;{{ saltbox_yml.stat.gid }}&quot;</span><span class="diff-line del">-     mode: &quot;0664&quot;</span><span class="diff-line del">-   when: settings_updater_log.stat.exists</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-51">
                <div class="file-header">
                    <span class="badge removed">removed</span>
                    <h3>roles/settings/tasks/subtasks/updater.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line del">- #########################################################################</span><span class="diff-line del">- # Title:         Saltbox: Settings | Updater                            #</span><span class="diff-line del">- # Author(s):     desimaniac, l3uddz                                     #</span><span class="diff-line del">- # URL:           https://github.com/saltyorg/Saltbox                    #</span><span class="diff-line del">- # --                                                                    #</span><span class="diff-line del">- #########################################################################</span><span class="diff-line del">- #                   GNU General Public License v3.0                     #</span><span class="diff-line del">- #########################################################################</span><span class="diff-line del">- ---</span><span class="diff-line del">- - name: &quot;Updater | Run &#x27;settings-updater.py&#x27; for &#x27;{{ file }}&#x27;&quot;</span><span class="diff-line del">-   ansible.builtin.script: &quot;&#x27;roles/settings/files/settings-updater.py&#x27; &#x27;{{ playbook_dir }}&#x27; &#x27;defaults/{{ file }}.default&#x27; &#x27;{{ file }}&#x27;&quot;</span><span class="diff-line del">-   become: true</span><span class="diff-line del">-   become_user: &quot;{{ saltbox_yml.stat.pw_name }}&quot;</span><span class="diff-line del">-   register: settings_updater</span><span class="diff-line del">-   ignore_errors: true</span><span class="diff-line del">-   changed_when: false</span><span class="diff-line del">-   failed_when: (settings_updater.rc == 1)</span><span class="diff-line del">- </span><span class="diff-line del">- - name: Updater | Build &#x27;files_updated_successfully&#x27; list</span><span class="diff-line del">-   ansible.builtin.set_fact:</span><span class="diff-line del">-     files_updated_successfully: &quot;{{ files_updated_successfully + [file] }}&quot;</span><span class="diff-line del">-   when: (settings_updater.rc == 2)</span><span class="diff-line del">- </span><span class="diff-line del">- - name: Updater | Build &#x27;files_updated_unsuccessfully&#x27; list</span><span class="diff-line del">-   ansible.builtin.set_fact:</span><span class="diff-line del">-     files_updated_unsuccessfully: &quot;{{ files_updated_unsuccessfully + [file] }}&quot;</span><span class="diff-line del">-   when: (settings_updater.rc == 1)</span><span class="diff-line del">- </span><span class="diff-line del">- - name: Updater | Set &#x27;exit_is_necessary&#x27; variable</span><span class="diff-line del">-   ansible.builtin.set_fact:</span><span class="diff-line del">-     exit_is_necessary: true</span><span class="diff-line del">-   when: (settings_updater.rc == 2)</span><span class="diff-line del">- </span><span class="diff-line del">- - name: Updater | Sort Keys</span><span class="diff-line del">-   ansible.builtin.shell: yyq -i &#x27;sort_keys(..)&#x27; {{ playbook_dir }}/{{ file }}</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-52">
                <div class="file-header">
                    <span class="badge removed">removed</span>
                    <h3>roles/sub_zero/defaults/main.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line del">- ##########################################################################</span><span class="diff-line del">- # Title:         Saltbox: Plex Plugins / Sub-Zero | Default Variables    #</span><span class="diff-line del">- # Author(s):     desimaniac                                              #</span><span class="diff-line del">- # URL:           https://github.com/saltyorg/Saltbox                     #</span><span class="diff-line del">- # --                                                                     #</span><span class="diff-line del">- ##########################################################################</span><span class="diff-line del">- #                   GNU General Public License v3.0                      #</span><span class="diff-line del">- ##########################################################################</span><span class="diff-line del">- ---</span><span class="diff-line del">- ################################</span><span class="diff-line del">- # Paths</span><span class="diff-line del">- ################################</span><span class="diff-line del">- </span><span class="diff-line del">- plex_plugin_subzero_paths_location: &quot;{{ plex_paths_plugins_location }}/Sub-Zero.bundle&quot;</span><span class="diff-line del">- </span><span class="diff-line del">- plex_plugin_subzero_paths_info_plist_location: &quot;{{ plex_plugin_subzero_paths_location }}/Contents/Info.plist&quot;</span><span class="diff-line del">- </span><span class="diff-line del">- ################################</span><span class="diff-line del">- # Repository</span><span class="diff-line del">- ################################</span><span class="diff-line del">- </span><span class="diff-line del">- plex_plugin_subzero_release_url: &quot;{{ svm }}https://api.github.com/repos/pannal/Sub-Zero.bundle/releases/latest&quot;</span><span class="diff-line del">- </span><span class="diff-line del">- plex_plugin_subzero_download_url_backup: https://github.com/pannal/Sub-Zero.bundle/releases/download/2.6.5.3152/Sub-Zero.bundle-2.6.5.3152.zip</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-53">
                <div class="file-header">
                    <span class="badge removed">removed</span>
                    <h3>roles/sub_zero/tasks/main.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line del">- #########################################################################</span><span class="diff-line del">- # Title:         Saltbox: Plex Plugins / Sub-Zero                       #</span><span class="diff-line del">- # Author(s):     desimaniac                                             #</span><span class="diff-line del">- # URL:           https://github.com/saltyorg/Saltbox                    #</span><span class="diff-line del">- # --                                                                    #</span><span class="diff-line del">- #########################################################################</span><span class="diff-line del">- #                   GNU General Public License v3.0                     #</span><span class="diff-line del">- #########################################################################</span><span class="diff-line del">- ---</span><span class="diff-line del">- - name: Check if Plex instance is defined</span><span class="diff-line del">-   ansible.builtin.set_fact:</span><span class="diff-line del">-     plex_name: &quot;{{ plex_name | default(plex_instances[0]) }}&quot;</span><span class="diff-line del">- </span><span class="diff-line del">- - name: Check for previously installed Sub-Zero Plugin</span><span class="diff-line del">-   ansible.builtin.stat:</span><span class="diff-line del">-     path: &quot;{{ plex_plugin_subzero_paths_info_plist_location }}&quot;</span><span class="diff-line del">-   register: plex_plugin_subzero_bundle_status</span><span class="diff-line del">- </span><span class="diff-line del">- - name: Tasks for previously installed Sub-Zero Plugin</span><span class="diff-line del">-   when: plex_plugin_subzero_bundle_status.stat.exists</span><span class="diff-line del">-   block:</span><span class="diff-line del">-     - name: Set default value for &#x27;plex_plugin_subzero_is_outdated&#x27; variable</span><span class="diff-line del">-       ansible.builtin.set_fact:</span><span class="diff-line del">-         plex_plugin_subzero_is_outdated: false</span><span class="diff-line del">- </span><span class="diff-line del">-     # https://stackoverflow.com/a/51109708/10975859</span><span class="diff-line del">-     - name: Check version of previously installed Sub-Zero</span><span class="diff-line del">-       community.general.xml:</span><span class="diff-line del">-         path: &quot;{{ plex_plugin_subzero_paths_info_plist_location }}&quot;</span><span class="diff-line del">-         xpath: /plist/dict/key[.=&#x27;CFBundleVersion&#x27;]/following-sibling::*[1]</span><span class="diff-line del">-         content: &#x27;text&#x27;</span><span class="diff-line del">-       register: plex_plugin_subzero_info_plist_xmlresp_1</span><span class="diff-line del">- </span><span class="diff-line del">-     - name: Set &#x27;plex_plugin_subzero_previously_installed_version&#x27; variable</span><span class="diff-line del">-       ansible.builtin.set_fact:</span><span class="diff-line del">-         plex_plugin_subzero_previously_installed_version: &quot;{{ plex_plugin_subzero_info_plist_xmlresp_1.matches[0].string }}&quot;</span><span class="diff-line del">- </span><span class="diff-line del">-     - name: Check latest available version for Sub-Zero</span><span class="diff-line del">-       ansible.builtin.shell: curl -s {{ plex_plugin_subzero_release_url }} | jq -r .tag_name</span><span class="diff-line del">-       register: plex_plugin_subzero_latest_version</span><span class="diff-line del">-       ignore_errors: true</span><span class="diff-line del">-       changed_when: false</span><span class="diff-line del">- </span><span class="diff-line del">-     - name: Compare installed Sub-Zero Plugin version with latest one</span><span class="diff-line del">-       ansible.builtin.set_fact:</span><span class="diff-line del">-         plex_plugin_subzero_is_outdated: &quot;{{</span><span class="diff-line del">-             (plex_plugin_subzero_latest_version is failed) or</span><span class="diff-line del">-               ((plex_plugin_subzero_latest_version is success) and</span><span class="diff-line del">-               (plex_plugin_subzero_previously_installed_version is version(plex_plugin_subzero_latest_version.stdout, &#x27;&lt;&#x27;))) }}&quot;</span><span class="diff-line del">- </span><span class="diff-line del">- - name: Install Sub-Zero Plugin</span><span class="diff-line del">-   when: (not plex_plugin_subzero_bundle_status.stat.exists) or</span><span class="diff-line del">-         (plex_plugin_subzero_bundle_status.stat.exists and plex_plugin_subzero_is_outdated) or</span><span class="diff-line del">-         (&#x27;plex-plugin-sub-zero-reinstall&#x27; in ansible_run_tags) or (&#x27;plex-plugin-sub-zero&#x27; in ansible_run_tags)</span><span class="diff-line del">-   block:</span><span class="diff-line del">-     - name: Check to see if {{ plex_name | title }} is running</span><span class="diff-line del">-       when: (&#x27;plex-plugin-sub-zero&#x27; in ansible_run_tags) or (&#x27;plex-plugin-sub-zero-reinstall&#x27; in ansible_run_tags)</span><span class="diff-line del">-       block:</span><span class="diff-line del">-         - name: Gather list of running Docker containers</span><span class="diff-line del">-           ansible.builtin.shell: &quot;docker ps --format &#x27;{{ &#x27;{{&#x27; }} .Names{{ &#x27;}}&#x27; }}&#x27; | xargs echo -n&quot;</span><span class="diff-line del">-           register: docker_running_containers_list</span><span class="diff-line del">- </span><span class="diff-line del">-         - name: Set &#x27;docker_running_containers_list&#x27; variable</span><span class="diff-line del">-           ansible.builtin.set_fact:</span><span class="diff-line del">-             docker_running_containers_list: &quot;{{ (docker_running_containers_list.stdout).split() }}&quot;</span><span class="diff-line del">- </span><span class="diff-line del">-         - name: &quot;Stop {{ plex_name | title }} container&quot;</span><span class="diff-line del">-           ansible.builtin.include_tasks: &quot;{{ resources_tasks_path }}/docker/stop_docker_container.yml&quot;</span><span class="diff-line del">-           vars:</span><span class="diff-line del">-             var_prefix: &quot;plex&quot;</span><span class="diff-line del">-           when: (plex_docker_container in docker_running_containers_list)</span><span class="diff-line del">- </span><span class="diff-line del">-     - name: Remove outdated Sub-Zero Plugin</span><span class="diff-line del">-       ansible.builtin.file:</span><span class="diff-line del">-         path: &quot;{{ plex_plugin_subzero_paths_location }}&quot;</span><span class="diff-line del">-         state: absent</span><span class="diff-line del">- </span><span class="diff-line del">-     - name: Get latest Sub-Zero Plugin URL</span><span class="diff-line del">-       ansible.builtin.shell: |</span><span class="diff-line del">-         curl -s {{ plex_plugin_subzero_release_url }} \</span><span class="diff-line del">-           | jq -r &quot;.assets[] | select(.name | test(\&quot;Sub-Zero.bundle\&quot;)) | .browser_download_url&quot;</span><span class="diff-line del">-       register: plex_plugin_subzero_download_url</span><span class="diff-line del">-       ignore_errors: true</span><span class="diff-line del">-       changed_when: false</span><span class="diff-line del">- </span><span class="diff-line del">-     - name: Set &#x27;plex_plugin_subzero_download_url&#x27; variable</span><span class="diff-line del">-       ansible.builtin.set_fact:</span><span class="diff-line del">-         plex_plugin_subzero_download_url: &quot;{{ plex_plugin_subzero_download_url.stdout | default(plex_plugin_subzero_download_url_backup, true) }}&quot;</span><span class="diff-line del">- </span><span class="diff-line del">-     - name: &quot;Create {{ plex_name | title }} &#x27;plug-ins&#x27; directory&quot;</span><span class="diff-line del">-       ansible.builtin.file:</span><span class="diff-line del">-         path: &quot;{{ item }}&quot;</span><span class="diff-line del">-         state: directory</span><span class="diff-line del">-         owner: &quot;{{ user.name }}&quot;</span><span class="diff-line del">-         group: &quot;{{ user.name }}&quot;</span><span class="diff-line del">-         mode: &quot;0775&quot;</span><span class="diff-line del">-         recurse: true</span><span class="diff-line del">-       with_items:</span><span class="diff-line del">-         - &quot;{{ plex_paths_plugins_location }}&quot;</span><span class="diff-line del">- </span><span class="diff-line del">-     - name: Install Sub-Zero Plugin</span><span class="diff-line del">-       ansible.builtin.unarchive:</span><span class="diff-line del">-         src: &quot;{{ plex_plugin_subzero_download_url }}&quot;</span><span class="diff-line del">-         dest: &quot;{{ plex_paths_plugins_location }}&quot;</span><span class="diff-line del">-         copy: false</span><span class="diff-line del">-         owner: &quot;{{ user.name }}&quot;</span><span class="diff-line del">-         group: &quot;{{ user.name }}&quot;</span><span class="diff-line del">-         mode: &quot;0775&quot;</span><span class="diff-line del">-         validate_certs: false</span><span class="diff-line del">-       register: plex_plugin_subzero_download_status</span><span class="diff-line del">-       ignore_errors: true</span><span class="diff-line del">- </span><span class="diff-line del">-     - name: Post-Successfull Sub-Zero Plugin Download</span><span class="diff-line del">-       when: (plex_plugin_subzero_download_status is success)</span><span class="diff-line del">-       block:</span><span class="diff-line del">-         - name: Check for newly installed Sub-Zero Plugin</span><span class="diff-line del">-           ansible.builtin.stat:</span><span class="diff-line del">-             path: &quot;{{ plex_plugin_subzero_paths_info_plist_location }}&quot;</span><span class="diff-line del">-           register: plex_plugin_subzero_info_plist_status</span><span class="diff-line del">- </span><span class="diff-line del">-         - name: Post-Successfull Sub-Zero Plugin Install</span><span class="diff-line del">-           when: plex_plugin_subzero_info_plist_status.stat.exists</span><span class="diff-line del">-           block:</span><span class="diff-line del">-             - name: Check version of newly installed Sub-Zero Plugin</span><span class="diff-line del">-               community.general.xml:</span><span class="diff-line del">-                 path: &quot;{{ plex_plugin_subzero_paths_info_plist_location }}&quot;</span><span class="diff-line del">-                 xpath: /plist/dict/key[.=&#x27;CFBundleVersion&#x27;]/following-sibling::*[1]</span><span class="diff-line del">-                 content: &#x27;text&#x27;</span><span class="diff-line del">-               register: plex_plugin_subzero_info_plist_xmlresp_2</span><span class="diff-line del">- </span><span class="diff-line del">-             - name: Set &#x27;subzero_newly_installed_version&#x27; variable</span><span class="diff-line del">-               ansible.builtin.set_fact:</span><span class="diff-line del">-                 plex_plugin_subzero_newly_installed_version: &quot;{{ plex_plugin_subzero_info_plist_xmlresp_2.matches[0].string }}&quot;</span><span class="diff-line del">- </span><span class="diff-line del">-             - name: Display Sub-Zero Plugin version</span><span class="diff-line del">-               ansible.builtin.debug:</span><span class="diff-line del">-                 msg: &quot;Sub-Zero Plugin version {{ plex_plugin_subzero_newly_installed_version }} installed.&quot;</span><span class="diff-line del">- </span><span class="diff-line del">-     - name: Sub-Zero Plugin install failed</span><span class="diff-line del">-       ansible.builtin.debug:</span><span class="diff-line del">-         msg: &quot;Sub-Zero Plugin install failed.&quot;</span><span class="diff-line del">-       when: (plex_plugin_subzero_download_status is failed) or</span><span class="diff-line del">-             ((plex_plugin_subzero_download_status is success) and (not plex_plugin_subzero_info_plist_status.stat.exists))</span><span class="diff-line del">- </span><span class="diff-line del">-     - name: &quot;Start {{ plex_name | title }} container&quot;</span><span class="diff-line del">-       ansible.builtin.include_tasks: &quot;{{ resources_tasks_path }}/docker/start_docker_container.yml&quot;</span><span class="diff-line del">-       vars:</span><span class="diff-line del">-         var_prefix: &quot;plex&quot;</span><span class="diff-line del">-       when: (&#x27;plex-plugin-sub-zero&#x27; in ansible_run_tags) or</span><span class="diff-line del">-             (&#x27;plex-plugin-sub-zero-reinstall&#x27; in ansible_run_tags) or</span><span class="diff-line del">-             (plex_docker_container in docker_running_containers_list)</span><span class="diff-line del">- </span><span class="diff-line del">- - name: Sub-Zero Plugin was not updated</span><span class="diff-line del">-   ansible.builtin.debug:</span><span class="diff-line del">-     msg: &quot;Sub-Zero is already the latest version.&quot;</span><span class="diff-line del">-   when:</span><span class="diff-line del">-     - plex_plugin_subzero_bundle_status.stat.exists</span><span class="diff-line del">-     - (not plex_plugin_subzero_is_outdated)</span><span class="diff-line del">-     - (&#x27;plex-plugin-sub-zero-reinstall&#x27; not in ansible_run_tags)</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-54">
                <div class="file-header">
                    <span class="badge removed">removed</span>
                    <h3>roles/webtools/defaults/main.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line del">- ##########################################################################</span><span class="diff-line del">- # Title:         Saltbox: Plex Plugins / WebTools | Default Variables    #</span><span class="diff-line del">- # Author(s):     desimaniac                                              #</span><span class="diff-line del">- # URL:           https://github.com/saltyorg/Saltbox                     #</span><span class="diff-line del">- # --                                                                     #</span><span class="diff-line del">- ##########################################################################</span><span class="diff-line del">- #                   GNU General Public License v3.0                      #</span><span class="diff-line del">- ##########################################################################</span><span class="diff-line del">- ---</span><span class="diff-line del">- ################################</span><span class="diff-line del">- # Paths</span><span class="diff-line del">- ################################</span><span class="diff-line del">- </span><span class="diff-line del">- plex_plugin_webtools_paths_location: &quot;{{ plex_paths_plugins_location }}/WebTools.bundle&quot;</span><span class="diff-line del">- </span><span class="diff-line del">- plex_plugin_webtools_paths_version_location: &quot;{{ plex_plugin_webtools_paths_location }}/VERSION&quot;</span><span class="diff-line del">- </span><span class="diff-line del">- plex_plugin_webtools_paths_preferences_location: &quot;{{ plex_paths_plugin_support_location }}/Preferences/com.plexapp.plugins.WebTools.xml&quot;</span><span class="diff-line del">- </span><span class="diff-line del">- ################################</span><span class="diff-line del">- # Repository</span><span class="diff-line del">- ################################</span><span class="diff-line del">- </span><span class="diff-line del">- plex_plugin_webtools_release_url: &quot;{{ svm }}https://api.github.com/repos/ukdtom/WebTools.bundle/releases/latest&quot;</span><span class="diff-line del">- </span><span class="diff-line del">- plex_plugin_webtools_download_url_backup: https://github.com/ukdtom/WebTools.bundle/releases/download/3.0.0/WebTools.bundle.zip</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-55">
                <div class="file-header">
                    <span class="badge removed">removed</span>
                    <h3>roles/webtools/tasks/main.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line del">- #########################################################################</span><span class="diff-line del">- # Title:         Saltbox: Plex Plugins / WebTools                       #</span><span class="diff-line del">- # Author(s):     desimaniac                                             #</span><span class="diff-line del">- # URL:           https://github.com/saltyorg/Saltbox                    #</span><span class="diff-line del">- # --                                                                    #</span><span class="diff-line del">- #########################################################################</span><span class="diff-line del">- #                   GNU General Public License v3.0                     #</span><span class="diff-line del">- #########################################################################</span><span class="diff-line del">- ---</span><span class="diff-line del">- - name: Check if Plex instance is defined</span><span class="diff-line del">-   ansible.builtin.set_fact:</span><span class="diff-line del">-     plex_name: &quot;{{ plex_name | default(plex_instances[0]) }}&quot;</span><span class="diff-line del">- </span><span class="diff-line del">- - name: Check for previously installed WebTools Plugin</span><span class="diff-line del">-   ansible.builtin.stat:</span><span class="diff-line del">-     path: &quot;{{ plex_plugin_webtools_paths_version_location }}&quot;</span><span class="diff-line del">-   register: plex_plugin_webtools_bundle_status</span><span class="diff-line del">- </span><span class="diff-line del">- - name: Tasks for previously installed WebTools Plugin</span><span class="diff-line del">-   when: plex_plugin_webtools_bundle_status.stat.exists</span><span class="diff-line del">-   block:</span><span class="diff-line del">-     - name: Set default value for &#x27;plex_plugin_webtools_is_outdated&#x27; variable</span><span class="diff-line del">-       ansible.builtin.set_fact:</span><span class="diff-line del">-         plex_plugin_webtools_is_outdated: false</span><span class="diff-line del">- </span><span class="diff-line del">-     - name: Check version of previously installed WebTools Plugin</span><span class="diff-line del">-       ansible.builtin.shell: cat &#x27;{{ plex_plugin_webtools_paths_version_location }}&#x27; |  head -n 1 | awk &#x27;{ print }&#x27;</span><span class="diff-line del">-       register: plex_plugin_webtools_previously_installed_version</span><span class="diff-line del">-       changed_when: false</span><span class="diff-line del">- </span><span class="diff-line del">-     - name: Set &#x27;plex_plugin_webtools_previously_installed_version&#x27; variable</span><span class="diff-line del">-       ansible.builtin.set_fact:</span><span class="diff-line del">-         plex_plugin_webtools_previously_installed_version: &quot;{{ plex_plugin_webtools_previously_installed_version.stdout }}&quot;</span><span class="diff-line del">- </span><span class="diff-line del">-     - name: Check latest available version for WebTools</span><span class="diff-line del">-       ansible.builtin.shell: curl -s {{ plex_plugin_webtools_release_url }} | jq -r .tag_name</span><span class="diff-line del">-       register: plex_plugin_webtools_latest_version</span><span class="diff-line del">-       ignore_errors: true</span><span class="diff-line del">-       changed_when: false</span><span class="diff-line del">- </span><span class="diff-line del">-     - name: Compare installed WebTools Plugin version with latest one</span><span class="diff-line del">-       ansible.builtin.set_fact:</span><span class="diff-line del">-         plex_plugin_webtools_is_outdated: &quot;{{</span><span class="diff-line del">-             (plex_plugin_webtools_latest_version is failed) or</span><span class="diff-line del">-               ((plex_plugin_webtools_latest_version is success) and</span><span class="diff-line del">-               (plex_plugin_webtools_previously_installed_version is version(plex_plugin_webtools_latest_version.stdout, &#x27;&lt;&#x27;, strict=True))) }}&quot;</span><span class="diff-line del">- </span><span class="diff-line del">- - name: Install WebTools Plugin</span><span class="diff-line del">-   when: (not plex_plugin_webtools_bundle_status.stat.exists) or</span><span class="diff-line del">-         (plex_plugin_webtools_bundle_status.stat.exists and plex_plugin_webtools_is_outdated) or</span><span class="diff-line del">-         (&#x27;plex-plugin-webtools-reinstall&#x27; in ansible_run_tags)</span><span class="diff-line del">-   block:</span><span class="diff-line del">-     - name: Check to see if {{ plex_name | title }} is running</span><span class="diff-line del">-       when: (&#x27;plex-plugin-webtools&#x27; in ansible_run_tags) or (&#x27;plex-plugin-webtools-reinstall&#x27; in ansible_run_tags)</span><span class="diff-line del">-       block:</span><span class="diff-line del">-         - name: Gather list of running Docker containers</span><span class="diff-line del">-           ansible.builtin.shell: &quot;docker ps --format &#x27;{{ &#x27;{{&#x27; }} .Names{{ &#x27;}}&#x27; }}&#x27; | xargs echo -n&quot;</span><span class="diff-line del">-           register: docker_running_containers_list</span><span class="diff-line del">-           changed_when: false</span><span class="diff-line del">- </span><span class="diff-line del">-         - name: Set &#x27;docker_running_containers_list&#x27; variable</span><span class="diff-line del">-           ansible.builtin.set_fact:</span><span class="diff-line del">-             docker_running_containers_list: &quot;{{ (docker_running_containers_list.stdout).split() }}&quot;</span><span class="diff-line del">- </span><span class="diff-line del">-         - name: Stop {{ plex_name | title }} container</span><span class="diff-line del">-           ansible.builtin.include_tasks: &quot;{{ resources_tasks_path }}/docker/stop_docker_container.yml&quot;</span><span class="diff-line del">-           vars:</span><span class="diff-line del">-             var_prefix: &quot;plex&quot;</span><span class="diff-line del">- </span><span class="diff-line del">-           when: (plex_docker_container in docker_running_containers_list)</span><span class="diff-line del">- </span><span class="diff-line del">-     - name: Remove outdated WebTools Plugin</span><span class="diff-line del">-       ansible.builtin.file:</span><span class="diff-line del">-         path: &quot;{{ plex_plugin_webtools_paths_location }}&quot;</span><span class="diff-line del">-         state: absent</span><span class="diff-line del">- </span><span class="diff-line del">-     - name: Get latest WebTools Plugin URL</span><span class="diff-line del">-       ansible.builtin.shell: |</span><span class="diff-line del">-         curl -s {{ plex_plugin_webtools_release_url }} \</span><span class="diff-line del">-           | jq -r &quot;.assets[] | select(.name | test(\&quot;WebTools.bundle.zip\&quot;)) | .browser_download_url&quot;</span><span class="diff-line del">-       register: plex_plugin_webtools_download_url</span><span class="diff-line del">-       ignore_errors: true</span><span class="diff-line del">-       changed_when: false</span><span class="diff-line del">- </span><span class="diff-line del">-     - name: Set &#x27;plex_plugin_webtools_download_url&#x27; variable</span><span class="diff-line del">-       ansible.builtin.set_fact:</span><span class="diff-line del">-         plex_plugin_webtools_download_url: &quot;{{ plex_plugin_webtools_download_url.stdout | default(plex_plugin_webtools_download_url_backup, true) }}&quot;</span><span class="diff-line del">- </span><span class="diff-line del">-     - name: &quot;Create {{ plex_name | title }} &#x27;plug-ins&#x27; directory&quot;</span><span class="diff-line del">-       ansible.builtin.file:</span><span class="diff-line del">-         path: &quot;{{ item }}&quot;</span><span class="diff-line del">-         state: directory</span><span class="diff-line del">-         owner: &quot;{{ user.name }}&quot;</span><span class="diff-line del">-         group: &quot;{{ user.name }}&quot;</span><span class="diff-line del">-         mode: &quot;0775&quot;</span><span class="diff-line del">-         recurse: true</span><span class="diff-line del">-       with_items:</span><span class="diff-line del">-         - &quot;{{ plex_paths_plugins_location }}&quot;</span><span class="diff-line del">- </span><span class="diff-line del">-     - name: Install WebTools Plugin</span><span class="diff-line del">-       ansible.builtin.unarchive:</span><span class="diff-line del">-         src: &quot;{{ plex_plugin_webtools_download_url }}&quot;</span><span class="diff-line del">-         dest: &quot;{{ plex_paths_plugins_location }}&quot;</span><span class="diff-line del">-         copy: false</span><span class="diff-line del">-         owner: &quot;{{ user.name }}&quot;</span><span class="diff-line del">-         group: &quot;{{ user.name }}&quot;</span><span class="diff-line del">-         mode: &quot;0775&quot;</span><span class="diff-line del">-         validate_certs: false</span><span class="diff-line del">-       register: plex_plugin_webtools_download_status</span><span class="diff-line del">-       ignore_errors: true</span><span class="diff-line del">- </span><span class="diff-line del">-     - name: Post-Successfull WebTools Plugin Download</span><span class="diff-line del">-       when: (plex_plugin_webtools_download_status is success)</span><span class="diff-line del">-       block:</span><span class="diff-line del">-         - name: Check for newly installed WebTools Plugin</span><span class="diff-line del">-           ansible.builtin.stat:</span><span class="diff-line del">-             path: &quot;{{ plex_plugin_webtools_paths_version_location }}&quot;</span><span class="diff-line del">-           register: plex_plugin_webtools_version_status</span><span class="diff-line del">- </span><span class="diff-line del">-         - name: Post-Successfull WebTools Plugin Install</span><span class="diff-line del">-           when: plex_plugin_webtools_version_status.stat.exists</span><span class="diff-line del">-           block:</span><span class="diff-line del">-             - name: Check version of newly installed WebTools Plugin</span><span class="diff-line del">-               ansible.builtin.shell: cat &#x27;{{ plex_plugin_webtools_paths_version_location }}&#x27; |  head -n 1 | awk &#x27;{ print }&#x27;</span><span class="diff-line del">-               register: plex_plugin_webtools_newly_installed_version</span><span class="diff-line del">-               changed_when: false</span><span class="diff-line del">- </span><span class="diff-line del">-             - name: Set &#x27;plex_plugin_webtools_previously_installed_version&#x27; variable</span><span class="diff-line del">-               ansible.builtin.set_fact:</span><span class="diff-line del">-                 plex_plugin_webtools_newly_installed_version: &quot;{{ plex_plugin_webtools_newly_installed_version.stdout }}&quot;</span><span class="diff-line del">- </span><span class="diff-line del">-             - name: Display WebTools Plugin version</span><span class="diff-line del">-               ansible.builtin.debug:</span><span class="diff-line del">-                 msg: &quot;WebTools Plugin version {{ plex_plugin_webtools_newly_installed_version }} installed.&quot;</span><span class="diff-line del">- </span><span class="diff-line del">-     - name: WebTools Plugin install failed</span><span class="diff-line del">-       ansible.builtin.debug:</span><span class="diff-line del">-         msg: &quot;WebTools Plugin install failed.&quot;</span><span class="diff-line del">-       when: (plex_plugin_webtools_download_status is failed) or</span><span class="diff-line del">-             ((plex_plugin_webtools_download_status is success) and (not plex_plugin_webtools_version_status.stat.exists))</span><span class="diff-line del">- </span><span class="diff-line del">-     - name: Start {{ plex_name | title }} container</span><span class="diff-line del">-       ansible.builtin.include_tasks: &quot;{{ resources_tasks_path }}/docker/start_docker_container.yml&quot;</span><span class="diff-line del">-       vars:</span><span class="diff-line del">-         var_prefix: &quot;plex&quot;</span><span class="diff-line del">-       when:</span><span class="diff-line del">-         - (&#x27;plex-plugin-webtools&#x27; in ansible_run_tags) or (&#x27;plex-plugin-webtools-reinstall&#x27; in ansible_run_tags)</span><span class="diff-line del">-         - (plex_docker_container in docker_running_containers_list)</span><span class="diff-line del">- </span><span class="diff-line del">- - name: WebTools Plugin was not updated</span><span class="diff-line del">-   ansible.builtin.debug:</span><span class="diff-line del">-     msg: &quot;WebTools is already the latest version.&quot;</span><span class="diff-line del">-   when:</span><span class="diff-line del">-     - plex_plugin_webtools_bundle_status.stat.exists</span><span class="diff-line del">-     - (not plex_plugin_webtools_is_outdated)</span><span class="diff-line del">-     - (&#x27;plex-plugin-webtools-reinstall&#x27; not in ansible_run_tags)</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-56">
                <div class="file-header">
                    <span class="badge removed">removed</span>
                    <h3>scripts/salty-linter.py</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line del">- import os</span><span class="diff-line del">- import sys</span><span class="diff-line del">- </span><span class="diff-line del">- def lint_ansible_defaults(content, file_path):</span><span class="diff-line del">-     errors = []</span><span class="diff-line del">-     lines = content.split(&#x27;\n&#x27;)</span><span class="diff-line del">-     </span><span class="diff-line del">-     multi_line_jinja_start = None</span><span class="diff-line del">-     within_multi_line_jinja = False</span><span class="diff-line del">- </span><span class="diff-line del">-     for line_no, line in enumerate(lines, start=1):</span><span class="diff-line del">-         stripped_line = line.strip()</span><span class="diff-line del">- </span><span class="diff-line del">-         if stripped_line == &#x27;---&#x27;:</span><span class="diff-line del">-             continue</span><span class="diff-line del">- </span><span class="diff-line del">-         if &#x27;{{&#x27; in stripped_line and not within_multi_line_jinja:</span><span class="diff-line del">-             multi_line_jinja_start = line.find(&#x27;{{&#x27;)</span><span class="diff-line del">-             within_multi_line_jinja = &#x27;}}&#x27; not in stripped_line</span><span class="diff-line del">- </span><span class="diff-line del">-         elif within_multi_line_jinja:</span><span class="diff-line del">-             if &#x27;if&#x27; in stripped_line or &#x27;else&#x27; in stripped_line:</span><span class="diff-line del">-                 if line.find(&#x27;if&#x27;) &lt; multi_line_jinja_start and line.find(&#x27;else&#x27;) &lt; multi_line_jinja_start:</span><span class="diff-line del">-                     message = f&quot;&#x27;if/else&#x27; within Jinja expression should align with the start.&quot;</span><span class="diff-line del">-                     errors.append((line_no, message))</span><span class="diff-line del">- </span><span class="diff-line del">-             if &#x27;}}&#x27; in stripped_line:</span><span class="diff-line del">-                 within_multi_line_jinja = False</span><span class="diff-line del">- </span><span class="diff-line del">-         if &#x27;}}&#x27; in stripped_line and within_multi_line_jinja:</span><span class="diff-line del">-             within_multi_line_jinja = False</span><span class="diff-line del">- </span><span class="diff-line del">-     for error in errors:</span><span class="diff-line del">-         line_no, message = error</span><span class="diff-line del">-         print(f&quot;::warning file={file_path},line={line_no},endLine={line_no},title=Salty Lint Error::{message}&quot;)</span><span class="diff-line del">- </span><span class="diff-line del">-     return len(errors) &gt; 0</span><span class="diff-line del">- </span><span class="diff-line del">- def crawl_and_lint_ansible_roles(roles_dir):</span><span class="diff-line del">-     errors_found = False</span><span class="diff-line del">- </span><span class="diff-line del">-     if not os.path.exists(roles_dir):</span><span class="diff-line del">-         print(&quot;Roles directory does not exist.&quot;)</span><span class="diff-line del">-         return</span><span class="diff-line del">- </span><span class="diff-line del">-     for role_name in os.listdir(roles_dir):</span><span class="diff-line del">-         defaults_main_path = os.path.join(roles_dir, role_name, &quot;defaults&quot;, &quot;main.yml&quot;)</span><span class="diff-line del">-         if os.path.isfile(defaults_main_path):</span><span class="diff-line del">-             with open(defaults_main_path, &#x27;r&#x27;) as file:</span><span class="diff-line del">-                 content = file.read()</span><span class="diff-line del">-                 if lint_ansible_defaults(content, defaults_main_path):</span><span class="diff-line del">-                     errors_found = True</span><span class="diff-line del">- </span><span class="diff-line del">-     sys.exit(1 if errors_found else 0)</span><span class="diff-line del">- </span><span class="diff-line del">- if len(sys.argv) &lt; 2:</span><span class="diff-line del">-     print(&quot;Usage: python script.py /path/to/your/ansible/roles&quot;)</span><span class="diff-line del">-     sys.exit(1)</span><span class="diff-line del">- </span><span class="diff-line del">- roles_directory_path = sys.argv[1]</span><span class="diff-line del">- crawl_and_lint_ansible_roles(roles_directory_path)</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-57">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>.ansible-lint</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -12,20 +12,17 @@</span><span class="diff-line context"> offline: false</span><span class="diff-line context"> </span><span class="diff-line context"> skip_list:</span><span class="diff-line del">-  - braces</span><span class="diff-line del">-  - git-latest</span><span class="diff-line del">-  - no-changed-when</span><span class="diff-line del">-  - ignore-errors</span><span class="diff-line del">-  - risky-shell-pipe</span><span class="diff-line del">-  - package-latest</span><span class="diff-line del">-  - no-handler</span><span class="diff-line context">   - command-instead-of-module</span><span class="diff-line context">   - command-instead-of-shell</span><span class="diff-line del">-  - deprecated-command-syntax</span><span class="diff-line del">-  - yaml[line-length]</span><span class="diff-line del">-  - yaml[truthy]</span><span class="diff-line del">-  - schema[tasks]</span><span class="diff-line add">+  - ignore-errors</span><span class="diff-line add">+  - latest[git]</span><span class="diff-line context">   - name[casing]</span><span class="diff-line context">   - name[template]</span><span class="diff-line add">+  - no-changed-when</span><span class="diff-line add">+  - no-handler</span><span class="diff-line add">+  - package-latest</span><span class="diff-line add">+  - risky-shell-pipe</span><span class="diff-line add">+  - schema[playbook]</span><span class="diff-line add">+  - schema[tasks]</span><span class="diff-line context">   - var-naming[no-role-prefix]</span><span class="diff-line del">-  - schema[playbook]</span><span class="diff-line add">+  - yaml[line-length]</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-58">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>.github/workflows/retry.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -30,13 +30,30 @@</span><span class="diff-line context">             echo &quot;attempt_allowed=false&quot; &gt;&gt; $GITHUB_OUTPUT</span><span class="diff-line context">           fi</span><span class="diff-line context"> </span><span class="diff-line add">+      - name: Check for lint failures</span><span class="diff-line add">+        id: check_lint</span><span class="diff-line add">+        if: steps.check_attempts.outputs.attempt_allowed == &#x27;true&#x27;</span><span class="diff-line add">+        env:</span><span class="diff-line add">+          GH_TOKEN: ${{ github.token }}</span><span class="diff-line add">+          GH_REPO: ${{ github.repository }}</span><span class="diff-line add">+        run: |</span><span class="diff-line add">+          failed_jobs=$(gh run view ${{ github.event.workflow_run.id }} --json jobs -q &#x27;.jobs[] | select(.conclusion == &quot;failure&quot;) | .name&#x27;)</span><span class="diff-line add">+</span><span class="diff-line add">+          if echo &quot;$failed_jobs&quot; | grep -qE &#x27;^(ansible-lint|defaults-lint)$&#x27;; then</span><span class="diff-line add">+            echo &quot;Lint job failed - skipping retry&quot;</span><span class="diff-line add">+            echo &quot;skip_retry=true&quot; &gt;&gt; $GITHUB_OUTPUT</span><span class="diff-line add">+          else</span><span class="diff-line add">+            echo &quot;No lint failures detected&quot;</span><span class="diff-line add">+            echo &quot;skip_retry=false&quot; &gt;&gt; $GITHUB_OUTPUT</span><span class="diff-line add">+          fi</span><span class="diff-line add">+</span><span class="diff-line context">       - name: Sleep for 60 seconds</span><span class="diff-line del">-        if: steps.check_attempts.outputs.attempt_allowed == &#x27;true&#x27;</span><span class="diff-line add">+        if: steps.check_attempts.outputs.attempt_allowed == &#x27;true&#x27; &amp;&amp; steps.check_lint.outputs.skip_retry != &#x27;true&#x27;</span><span class="diff-line context">         run: sleep 60s</span><span class="diff-line context">         shell: bash</span><span class="diff-line context"> </span><span class="diff-line context">       - name: rerun ${{ github.event.workflow_run.id }}</span><span class="diff-line del">-        if: steps.check_attempts.outputs.attempt_allowed == &#x27;true&#x27;</span><span class="diff-line add">+        if: steps.check_attempts.outputs.attempt_allowed == &#x27;true&#x27; &amp;&amp; steps.check_lint.outputs.skip_retry != &#x27;true&#x27;</span><span class="diff-line context">         env:</span><span class="diff-line context">           GH_REPO: ${{ github.repository }}</span><span class="diff-line context">           GH_TOKEN: ${{ github.token }}</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-59">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>.github/workflows/saltbox-os.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -23,6 +23,19 @@</span><span class="diff-line context">         working-directory: ${{ github.workspace }}</span><span class="diff-line context">         run: ansible-lint</span><span class="diff-line context"> </span><span class="diff-line add">+  defaults-lint:</span><span class="diff-line add">+    if: github.event_name == &#x27;pull_request&#x27; || !(github.event_name == &#x27;push&#x27; &amp;&amp; github.actor == &#x27;renovate[bot]&#x27;)</span><span class="diff-line add">+    runs-on: ubuntu-24.04</span><span class="diff-line add">+    steps:</span><span class="diff-line add">+      - uses: actions/checkout@v5</span><span class="diff-line add">+</span><span class="diff-line add">+      - uses: actions/setup-python@v6</span><span class="diff-line add">+        with:</span><span class="diff-line add">+          python-version: &#x27;3.13&#x27;</span><span class="diff-line add">+</span><span class="diff-line add">+      - name: Run Defaults Linter</span><span class="diff-line add">+        run: python3 scripts/saltbox-defaults-linter.py roles/</span><span class="diff-line add">+</span><span class="diff-line context">   find-roles:</span><span class="diff-line context">     if: github.event_name == &#x27;pull_request&#x27; || !(github.event_name == &#x27;push&#x27; &amp;&amp; github.actor == &#x27;renovate[bot]&#x27;)</span><span class="diff-line context">     runs-on: ubuntu-24.04</span><span class="diff-line hunk">@@ -32,51 +45,52 @@</span><span class="diff-line context">       - uses: actions/checkout@v5</span><span class="diff-line context">       - id: set-matrix</span><span class="diff-line context">         run: |</span><span class="diff-line del">-          ROLES=$(awk &#x27;/# Core/{flag=1;next}/# Apps End/{flag=0}flag&#x27; saltbox.yml | awk &#x27;!/#/&#x27; | awk -F&#x27;[][]&#x27; &#x27;{print $2}&#x27; | tr &#x27;\n&#x27; &#x27;,&#x27; | sed &#x27;s/,*$//&#x27; | awk -F&#x27;,&#x27; &#x27;{ for( i=1; i&lt;=NF; i++ ) print $i }&#x27; | awk &#x27;{ gsub(/ /,&quot;&quot;); print }&#x27;| sort -u | awk -vORS=, &#x27;{ print $1 }&#x27; | sed &#x27;s/,$/\n/&#x27; | sed &quot;s/.\(roles\|common\|hetzner\|kernel\|motd\|mounts\|nvidia\|nvidia-purge\|preinstall\|rclone\|scripts\|shell\|system\|traefik\|traefik-reset-certs\|user\|cloudflare\|plex-db\|arr-db\|ddns\|cloudplow\|cloudplow-reset\|btrfsmaintenance\|download-clients\|download-indexers\|media-server\|python\|yyq\|crowdsec\).,//g&quot;)</span><span class="diff-line del">-          echo &quot;matrix={\&quot;roles\&quot;:[$ROLES],\&quot;os\&quot;:[\&quot;20.04\&quot;,\&quot;22.04\&quot;,\&quot;24.04\&quot;]}&quot; &gt;&gt; $GITHUB_OUTPUT</span><span class="diff-line add">+          ROLES=$(awk &#x27;/# Core/{flag=1;next}/# Apps End/{flag=0}flag&#x27; saltbox.yml | awk &#x27;!/#/&#x27; | awk -F&#x27;[][]&#x27; &#x27;{print $2}&#x27; | tr &#x27;\n&#x27; &#x27;,&#x27; | sed &#x27;s/,*$//&#x27; | awk -F&#x27;,&#x27; &#x27;{ for( i=1; i&lt;=NF; i++ ) print $i }&#x27; | awk &#x27;{ gsub(/ /,&quot;&quot;); print }&#x27;| sort -u | awk -vORS=, &#x27;{ print $1 }&#x27; | sed &#x27;s/,$/\n/&#x27; | sed &quot;s/.\(roles\|common\|hetzner\|kernel\|motd\|mounts\|nvidia\|nvidia-purge\|preinstall\|rclone\|scripts\|shell\|system\|traefik\|traefik-reset-certs\|user\|cloudflare\|plex-db\|arr-db\|ddns\|cloudplow\|cloudplow-reset\|btrfsmaintenance\|download-clients\|download-indexers\|media-server\|python\|yyq\|crowdsec\|postgres-host\).,//g&quot;)</span><span class="diff-line add">+          echo &quot;matrix={\&quot;roles\&quot;:[$ROLES],\&quot;os\&quot;:[\&quot;22.04\&quot;,\&quot;24.04\&quot;]}&quot; &gt;&gt; $GITHUB_OUTPUT</span><span class="diff-line context"> </span><span class="diff-line context">   install:</span><span class="diff-line context">     name: &#x27;${{ matrix.roles }}-${{ matrix.os }}&#x27;</span><span class="diff-line context">     runs-on: ubuntu-${{ matrix.os }}</span><span class="diff-line del">-    needs: [ansible-lint, find-roles]</span><span class="diff-line add">+    needs: [ansible-lint, defaults-lint, find-roles]</span><span class="diff-line context">     strategy:</span><span class="diff-line context">       matrix: ${{ fromJson(needs.find-roles.outputs.matrix) }}</span><span class="diff-line context">       fail-fast: false</span><span class="diff-line context">     steps:</span><span class="diff-line context">       - uses: actions/checkout@v5</span><span class="diff-line context"> </span><span class="diff-line add">+      - name: Tune GitHub-hosted runner network</span><span class="diff-line add">+        run: sudo ethtool -K eth0 tx off rx off</span><span class="diff-line add">+</span><span class="diff-line add">+      - name: Print pip dependencies</span><span class="diff-line add">+        run: cat ./requirements/requirements-saltbox.txt</span><span class="diff-line add">+</span><span class="diff-line add">+      - name: Install sb binary</span><span class="diff-line add">+        uses: jaxxstorm/action-install-gh-release@v2.1.0</span><span class="diff-line add">+        with:</span><span class="diff-line add">+          repo: saltyorg/sb-go</span><span class="diff-line add">+          tag: latest</span><span class="diff-line add">+          extension-matching: disable</span><span class="diff-line add">+          platform: linux</span><span class="diff-line add">+          arch: amd64</span><span class="diff-line add">+          rename-to: sb</span><span class="diff-line add">+          chmod: &quot;0755&quot;</span><span class="diff-line add">+</span><span class="diff-line add">+      - name: Check sb version</span><span class="diff-line add">+        run: |</span><span class="diff-line add">+          sudo mv /opt/hostedtoolcache/saltyorg/sb-go/latest/linux-amd64/sb /usr/local/bin/sb</span><span class="diff-line add">+          /usr/local/bin/sb version</span><span class="diff-line add">+</span><span class="diff-line context">       - name: Create Directories</span><span class="diff-line del">-        run: sudo mkdir -p /srv/ansible /srv/git/sb</span><span class="diff-line del">-</span><span class="diff-line del">-      - name: Copy requirements.txt</span><span class="diff-line del">-        run: sudo cp ./requirements/requirements-saltbox.txt /srv/git/sb/requirements-saltbox.txt</span><span class="diff-line add">+        run: sudo mkdir -p /srv/git</span><span class="diff-line context"> </span><span class="diff-line context">       - name: Chown /srv/git</span><span class="diff-line context">         run: sudo chown -R runner:runner /srv/git</span><span class="diff-line context"> </span><span class="diff-line del">-      - name: Tune GitHub-hosted runner network</span><span class="diff-line del">-        run: sudo ethtool -K eth0 tx off rx off</span><span class="diff-line del">-</span><span class="diff-line del">-      - name: Print pip dependencies</span><span class="diff-line del">-        run: cat /srv/git/sb/requirements-saltbox.txt</span><span class="diff-line add">+      - name: Symlink cloned repository to /srv/git/saltbox</span><span class="diff-line add">+        run: ln -s $GITHUB_WORKSPACE /srv/git/saltbox</span><span class="diff-line context"> </span><span class="diff-line context">       - name: Install Dependencies</span><span class="diff-line del">-        run: curl https://raw.githubusercontent.com/saltyorg/sb/master/sb_dep.sh --output sb_dep.sh &amp;&amp; sudo bash sb_dep.sh -v &amp;&amp; /srv/ansible/venv/bin/ansible --version</span><span class="diff-line del">-</span><span class="diff-line del">-      - name: Symlink cloned repository to /srv/git/saltbox</span><span class="diff-line del">-        run: sudo ln -s $GITHUB_WORKSPACE /srv/git/saltbox</span><span class="diff-line del">-</span><span class="diff-line del">-      - name: Install saltbox.fact</span><span class="diff-line del">-        run: |</span><span class="diff-line del">-          mkdir -p $GITHUB_WORKSPACE/ansible_facts.d</span><span class="diff-line del">-          curl -fsSL https://github.com/saltyorg/ansible-facts/releases/latest/download/saltbox-facts -o $GITHUB_WORKSPACE/ansible_facts.d/saltbox.fact</span><span class="diff-line del">-          chmod +x $GITHUB_WORKSPACE/ansible_facts.d/saltbox.fact</span><span class="diff-line del">-</span><span class="diff-line del">-      - name: Chown /srv/git</span><span class="diff-line del">-        run: sudo chown -R runner:runner /srv/git</span><span class="diff-line del">-</span><span class="diff-line del">-      - name: Import default configuration</span><span class="diff-line del">-        run: for i in defaults/*; do cp -n $i &quot;$(basename &quot;${i%.*}&quot;)&quot;; done</span><span class="diff-line add">+        run: /usr/local/bin/sb gha &amp;&amp; /srv/ansible/venv/bin/ansible --version</span><span class="diff-line context"> </span><span class="diff-line context">       - name: Edit accounts.yml</span><span class="diff-line context">         run: sed -i &#x27;s/seed/runner/g&#x27; accounts.yml</span><span class="diff-line hunk">@@ -90,6 +104,8 @@</span><span class="diff-line context">       - name: Create basic vars file</span><span class="diff-line context">         run: |</span><span class="diff-line context">           echo &quot;continuous_integration: true&quot; &gt; vars.yml</span><span class="diff-line add">+          echo &quot;server_appdata_path: /opt2&quot; &gt;&gt; vars.yml</span><span class="diff-line add">+          sudo mkdir -p /opt2</span><span class="diff-line context"> </span><span class="diff-line context">       - name: Add Docker Hub info to vars file</span><span class="diff-line context">         if: github.repository == &#x27;saltyorg/Saltbox&#x27; &amp;&amp; github.event.repository.fork == false</span><span class="diff-line hunk">@@ -98,9 +114,59 @@</span><span class="diff-line context">           echo &quot;  token: ${{ secrets.DOCKERHUB_TOKEN }}&quot; &gt;&gt; vars.yml</span><span class="diff-line context">           echo &quot;  user: ${{ secrets.DOCKERHUB_USERNAME }}&quot; &gt;&gt; vars.yml</span><span class="diff-line context"> </span><span class="diff-line add">+      - name: Install Saltbox Preinstall</span><span class="diff-line add">+        run: sudo /srv/ansible/venv/bin/ansible-playbook saltbox.yml --tags &quot;preinstall&quot; --skip-tags &quot;settings&quot; --extra-vars &quot;@vars.yml&quot;</span><span class="diff-line add">+</span><span class="diff-line add">+      - name: Run saltbox.fact</span><span class="diff-line add">+        run: /srv/git/saltbox/ansible_facts.d/saltbox.fact</span><span class="diff-line add">+</span><span class="diff-line context">       - name: Install Saltbox Core</span><span class="diff-line context">         run: sudo /srv/ansible/venv/bin/ansible-playbook saltbox.yml --tags &quot;core&quot; --skip-tags &quot;settings&quot; --extra-vars &quot;@vars.yml&quot;</span><span class="diff-line context">         if: ${{ !(contains(matrix.roles, &#x27;saltbox&#x27;) || contains(matrix.roles, &#x27;feederbox&#x27;) || contains(matrix.roles, &#x27;mediabox&#x27;) || contains(matrix.roles, &#x27;core&#x27;)) }}</span><span class="diff-line context"> </span><span class="diff-line context">       - name: Install ${{ matrix.roles }}</span><span class="diff-line context">         run: sudo /srv/ansible/venv/bin/ansible-playbook saltbox.yml --tags &quot;${{ matrix.roles }}&quot; --skip-tags &quot;settings&quot; --extra-vars &quot;@vars.yml&quot;</span><span class="diff-line add">+</span><span class="diff-line add">+      - name: Run Tree on app data folder</span><span class="diff-line add">+        run: sudo tree -aug /opt2</span><span class="diff-line add">+</span><span class="diff-line add">+      - name: Inspect all Docker containers</span><span class="diff-line add">+        run: |</span><span class="diff-line add">+          echo &quot;=== Inspecting all Docker containers ===&quot;</span><span class="diff-line add">+</span><span class="diff-line add">+          # Get list of all containers (running and stopped)</span><span class="diff-line add">+          ALL_CONTAINERS=$(docker ps -a -q)</span><span class="diff-line add">+</span><span class="diff-line add">+          if [ -z &quot;$ALL_CONTAINERS&quot; ]; then</span><span class="diff-line add">+            echo &quot;No containers found on this system&quot;</span><span class="diff-line add">+            exit 0</span><span class="diff-line add">+          fi</span><span class="diff-line add">+</span><span class="diff-line add">+          echo &quot;Found containers: $ALL_CONTAINERS&quot;</span><span class="diff-line add">+          echo &quot;&quot;</span><span class="diff-line add">+</span><span class="diff-line add">+          # Loop through each container and inspect it</span><span class="diff-line add">+          for container_id in $ALL_CONTAINERS; do</span><span class="diff-line add">+            echo &quot;=========================================&quot;</span><span class="diff-line add">+            echo &quot;Inspecting container: $container_id&quot;</span><span class="diff-line add">+            echo &quot;=========================================&quot;</span><span class="diff-line add">+</span><span class="diff-line add">+            # Get container name and status for better readability</span><span class="diff-line add">+            CONTAINER_NAME=$(docker inspect --format=&#x27;{{.Name}}&#x27; $container_id | sed &#x27;s/^\///&#x27;)</span><span class="diff-line add">+            CONTAINER_STATUS=$(docker inspect --format=&#x27;{{.State.Status}}&#x27; $container_id)</span><span class="diff-line add">+</span><span class="diff-line add">+            echo &quot;Container Name: $CONTAINER_NAME&quot;</span><span class="diff-line add">+            echo &quot;Container Status: $CONTAINER_STATUS&quot;</span><span class="diff-line add">+            echo &quot;&quot;</span><span class="diff-line add">+            echo &quot;Full inspection details:&quot;</span><span class="diff-line add">+            echo &quot;----------------------------------------&quot;</span><span class="diff-line add">+</span><span class="diff-line add">+            # Print full inspection details</span><span class="diff-line add">+            docker inspect $container_id</span><span class="diff-line add">+</span><span class="diff-line add">+            echo &quot;&quot;</span><span class="diff-line add">+            echo &quot;=========================================&quot;</span><span class="diff-line add">+            echo &quot;&quot;</span><span class="diff-line add">+          done</span><span class="diff-line add">+</span><span class="diff-line add">+          echo &quot;=== Container inspection completed ===&quot;</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-60">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>.github/workflows/saltbox.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -55,6 +55,19 @@</span><span class="diff-line context">         working-directory: ${{ github.workspace }}</span><span class="diff-line context">         run: ansible-lint</span><span class="diff-line context"> </span><span class="diff-line add">+  defaults-lint:</span><span class="diff-line add">+    if: github.event_name == &#x27;pull_request&#x27; || !(github.event_name == &#x27;push&#x27; &amp;&amp; github.actor == &#x27;renovate[bot]&#x27;)</span><span class="diff-line add">+    runs-on: ubuntu-24.04</span><span class="diff-line add">+    steps:</span><span class="diff-line add">+      - uses: actions/checkout@v5</span><span class="diff-line add">+</span><span class="diff-line add">+      - uses: actions/setup-python@v6</span><span class="diff-line add">+        with:</span><span class="diff-line add">+          python-version: &#x27;3.13&#x27;</span><span class="diff-line add">+</span><span class="diff-line add">+      - name: Run Defaults Linter</span><span class="diff-line add">+        run: python3 scripts/saltbox-defaults-linter.py roles/</span><span class="diff-line add">+</span><span class="diff-line context">   find-roles:</span><span class="diff-line context">     if: github.event_name == &#x27;pull_request&#x27; || !(github.event_name == &#x27;push&#x27; &amp;&amp; github.actor == &#x27;renovate[bot]&#x27;)</span><span class="diff-line context">     runs-on: ubuntu-24.04</span><span class="diff-line hunk">@@ -63,50 +76,51 @@</span><span class="diff-line context">     steps:</span><span class="diff-line context">       - uses: actions/checkout@v5</span><span class="diff-line context">       - id: set-matrix</span><span class="diff-line del">-        run: echo &quot;matrix={\&quot;roles\&quot;:[$(awk &#x27;/# Core/{flag=1;next}/# Apps End/{flag=0}flag&#x27; saltbox.yml | awk &#x27;!/#/&#x27; | awk -F&#x27;[][]&#x27; &#x27;{print $2}&#x27; | tr &#x27;\n&#x27; &#x27;,&#x27; | sed &#x27;s/,*$//&#x27; | awk -F&#x27;,&#x27; &#x27;{ for( i=1; i&lt;=NF; i++ ) print $i }&#x27; | awk &#x27;{ gsub(/ /,&quot;&quot;); print }&#x27;| sort -u | awk -vORS=, &#x27;{ print $1 }&#x27; | sed &#x27;s/,$/\n/&#x27; | sed &quot;s/.\(roles\|common\|hetzner\|kernel\|motd\|motd-generate-config\|mounts\|nvidia\|nvidia-purge\|preinstall\|rclone\|scripts\|shell\|system\|traefik\|traefik-reset-certs\|user\|cloudflare\|plex-db\|arr-db\|ddns\|cloudplow\|cloudplow-reset\|btrfsmaintenance\|download-clients\|download-indexers\|media-server\|python\|yyq\|crowdsec\).,//g&quot;)]}&quot; &gt;&gt; $GITHUB_OUTPUT</span><span class="diff-line add">+        run: echo &quot;matrix={\&quot;roles\&quot;:[$(awk &#x27;/# Core/{flag=1;next}/# Apps End/{flag=0}flag&#x27; saltbox.yml | awk &#x27;!/#/&#x27; | awk -F&#x27;[][]&#x27; &#x27;{print $2}&#x27; | tr &#x27;\n&#x27; &#x27;,&#x27; | sed &#x27;s/,*$//&#x27; | awk -F&#x27;,&#x27; &#x27;{ for( i=1; i&lt;=NF; i++ ) print $i }&#x27; | awk &#x27;{ gsub(/ /,&quot;&quot;); print }&#x27;| sort -u | awk -vORS=, &#x27;{ print $1 }&#x27; | sed &#x27;s/,$/\n/&#x27; | sed &quot;s/.\(roles\|common\|docker\|hetzner\|kernel\|motd\|motd-generate-config\|mounts\|nvidia\|nvidia-purge\|preinstall\|rclone\|scripts\|shell\|system\|traefik\|traefik-reset-certs\|user\|cloudflare\|plex-db\|arr-db\|ddns\|cloudplow\|cloudplow-reset\|btrfsmaintenance\|download-clients\|download-indexers\|media-server\|python\|yyq\|crowdsec\|postgres-host\).,//g&quot;)]}&quot; &gt;&gt; $GITHUB_OUTPUT</span><span class="diff-line context"> </span><span class="diff-line context">   install:</span><span class="diff-line context">     name: &#x27;${{ matrix.roles }}&#x27;</span><span class="diff-line context">     runs-on: ubuntu-24.04</span><span class="diff-line del">-    needs: [ansible-lint, find-roles]</span><span class="diff-line add">+    needs: [ansible-lint, defaults-lint, find-roles]</span><span class="diff-line context">     strategy:</span><span class="diff-line context">       matrix: ${{ fromJson(needs.find-roles.outputs.matrix) }}</span><span class="diff-line context">       fail-fast: false</span><span class="diff-line context">     steps:</span><span class="diff-line context">       - uses: actions/checkout@v5</span><span class="diff-line context"> </span><span class="diff-line add">+      - name: Tune GitHub-hosted runner network</span><span class="diff-line add">+        run: sudo ethtool -K eth0 tx off rx off</span><span class="diff-line add">+</span><span class="diff-line add">+      - name: Print pip dependencies</span><span class="diff-line add">+        run: cat ./requirements/requirements-saltbox.txt</span><span class="diff-line add">+</span><span class="diff-line add">+      - name: Install sb binary</span><span class="diff-line add">+        uses: jaxxstorm/action-install-gh-release@v2.1.0</span><span class="diff-line add">+        with:</span><span class="diff-line add">+          repo: saltyorg/sb-go</span><span class="diff-line add">+          tag: latest</span><span class="diff-line add">+          extension-matching: disable</span><span class="diff-line add">+          platform: linux</span><span class="diff-line add">+          arch: amd64</span><span class="diff-line add">+          rename-to: sb</span><span class="diff-line add">+          chmod: &quot;0755&quot;</span><span class="diff-line add">+</span><span class="diff-line add">+      - name: Check sb version</span><span class="diff-line add">+        run: |</span><span class="diff-line add">+          sudo mv /opt/hostedtoolcache/saltyorg/sb-go/latest/linux-amd64/sb /usr/local/bin/sb</span><span class="diff-line add">+          /usr/local/bin/sb version</span><span class="diff-line add">+</span><span class="diff-line context">       - name: Create Directories</span><span class="diff-line del">-        run: sudo mkdir -p /srv/ansible /srv/git/sb</span><span class="diff-line del">-</span><span class="diff-line del">-      - name: Copy requirements.txt</span><span class="diff-line del">-        run: sudo cp ./requirements/requirements-saltbox.txt /srv/git/sb/requirements-saltbox.txt</span><span class="diff-line add">+        run: sudo mkdir -p /srv/git</span><span class="diff-line context"> </span><span class="diff-line context">       - name: Chown /srv/git</span><span class="diff-line context">         run: sudo chown -R runner:runner /srv/git</span><span class="diff-line context"> </span><span class="diff-line del">-      - name: Tune GitHub-hosted runner network</span><span class="diff-line del">-        run: sudo ethtool -K eth0 tx off rx off</span><span class="diff-line del">-</span><span class="diff-line del">-      - name: Print pip dependencies</span><span class="diff-line del">-        run: cat /srv/git/sb/requirements-saltbox.txt</span><span class="diff-line add">+      - name: Symlink cloned repository to /srv/git/saltbox</span><span class="diff-line add">+        run: ln -s $GITHUB_WORKSPACE /srv/git/saltbox</span><span class="diff-line context"> </span><span class="diff-line context">       - name: Install Dependencies</span><span class="diff-line del">-        run: curl https://raw.githubusercontent.com/saltyorg/sb/master/sb_dep.sh --output sb_dep.sh &amp;&amp; sudo bash sb_dep.sh -v &amp;&amp; /srv/ansible/venv/bin/ansible --version</span><span class="diff-line del">-</span><span class="diff-line del">-      - name: Symlink cloned repository to /srv/git/saltbox</span><span class="diff-line del">-        run: sudo ln -s $GITHUB_WORKSPACE /srv/git/saltbox</span><span class="diff-line del">-</span><span class="diff-line del">-      - name: Install saltbox.fact</span><span class="diff-line del">-        run: |</span><span class="diff-line del">-          mkdir -p $GITHUB_WORKSPACE/ansible_facts.d</span><span class="diff-line del">-          curl -fsSL https://github.com/saltyorg/ansible-facts/releases/latest/download/saltbox-facts -o $GITHUB_WORKSPACE/ansible_facts.d/saltbox.fact</span><span class="diff-line del">-          chmod +x $GITHUB_WORKSPACE/ansible_facts.d/saltbox.fact</span><span class="diff-line del">-</span><span class="diff-line del">-      - name: Chown /srv/git</span><span class="diff-line del">-        run: sudo chown -R runner:runner /srv/git</span><span class="diff-line del">-</span><span class="diff-line del">-      - name: Import default configuration</span><span class="diff-line del">-        run: for i in defaults/*; do cp -n $i &quot;$(basename &quot;${i%.*}&quot;)&quot;; done</span><span class="diff-line add">+        run: /usr/local/bin/sb gha &amp;&amp; /srv/ansible/venv/bin/ansible --version</span><span class="diff-line context"> </span><span class="diff-line context">       - name: Edit accounts.yml</span><span class="diff-line context">         run: sed -i &#x27;s/seed/runner/g&#x27; accounts.yml</span><span class="diff-line hunk">@@ -120,6 +134,8 @@</span><span class="diff-line context">       - name: Create basic vars file</span><span class="diff-line context">         run: |</span><span class="diff-line context">           echo &quot;continuous_integration: true&quot; &gt; vars.yml</span><span class="diff-line add">+          echo &quot;server_appdata_path: /opt2&quot; &gt;&gt; vars.yml</span><span class="diff-line add">+          sudo mkdir -p /opt2</span><span class="diff-line context"> </span><span class="diff-line context">       - name: Add Docker Hub info to vars file</span><span class="diff-line context">         if: github.repository == &#x27;saltyorg/Saltbox&#x27; &amp;&amp; github.event.repository.fork == false</span><span class="diff-line hunk">@@ -128,9 +144,59 @@</span><span class="diff-line context">           echo &quot;  token: ${{ secrets.DOCKERHUB_TOKEN }}&quot; &gt;&gt; vars.yml</span><span class="diff-line context">           echo &quot;  user: ${{ secrets.DOCKERHUB_USERNAME }}&quot; &gt;&gt; vars.yml</span><span class="diff-line context"> </span><span class="diff-line add">+      - name: Install Saltbox Preinstall</span><span class="diff-line add">+        run: sudo /srv/ansible/venv/bin/ansible-playbook saltbox.yml --tags &quot;preinstall&quot; --skip-tags &quot;settings&quot; --extra-vars &quot;@vars.yml&quot;</span><span class="diff-line add">+</span><span class="diff-line add">+      - name: Run saltbox.fact</span><span class="diff-line add">+        run: /srv/git/saltbox/ansible_facts.d/saltbox.fact</span><span class="diff-line add">+</span><span class="diff-line context">       - name: Install Saltbox Core</span><span class="diff-line context">         run: sudo /srv/ansible/venv/bin/ansible-playbook saltbox.yml --tags &quot;core&quot; --skip-tags &quot;settings&quot; --extra-vars &quot;@vars.yml&quot;</span><span class="diff-line context">         if: ${{ !(contains(matrix.roles, &#x27;saltbox&#x27;) || contains(matrix.roles, &#x27;feederbox&#x27;) || contains(matrix.roles, &#x27;mediabox&#x27;) || contains(matrix.roles, &#x27;core&#x27;)) }}</span><span class="diff-line context"> </span><span class="diff-line context">       - name: Install ${{ matrix.roles }}</span><span class="diff-line context">         run: sudo /srv/ansible/venv/bin/ansible-playbook saltbox.yml --tags &quot;${{ matrix.roles }}&quot; --skip-tags &quot;settings&quot; --extra-vars &quot;@vars.yml&quot;</span><span class="diff-line add">+</span><span class="diff-line add">+      - name: Run Tree on app data folder</span><span class="diff-line add">+        run: sudo tree -aug /opt2</span><span class="diff-line add">+</span><span class="diff-line add">+      - name: Inspect all Docker containers</span><span class="diff-line add">+        run: |</span><span class="diff-line add">+          echo &quot;=== Inspecting all Docker containers ===&quot;</span><span class="diff-line add">+</span><span class="diff-line add">+          # Get list of all containers (running and stopped)</span><span class="diff-line add">+          ALL_CONTAINERS=$(docker ps -a -q)</span><span class="diff-line add">+</span><span class="diff-line add">+          if [ -z &quot;$ALL_CONTAINERS&quot; ]; then</span><span class="diff-line add">+            echo &quot;No containers found on this system&quot;</span><span class="diff-line add">+            exit 0</span><span class="diff-line add">+          fi</span><span class="diff-line add">+</span><span class="diff-line add">+          echo &quot;Found containers: $ALL_CONTAINERS&quot;</span><span class="diff-line add">+          echo &quot;&quot;</span><span class="diff-line add">+</span><span class="diff-line add">+          # Loop through each container and inspect it</span><span class="diff-line add">+          for container_id in $ALL_CONTAINERS; do</span><span class="diff-line add">+            echo &quot;=========================================&quot;</span><span class="diff-line add">+            echo &quot;Inspecting container: $container_id&quot;</span><span class="diff-line add">+            echo &quot;=========================================&quot;</span><span class="diff-line add">+</span><span class="diff-line add">+            # Get container name and status for better readability</span><span class="diff-line add">+            CONTAINER_NAME=$(docker inspect --format=&#x27;{{.Name}}&#x27; $container_id | sed &#x27;s/^\///&#x27;)</span><span class="diff-line add">+            CONTAINER_STATUS=$(docker inspect --format=&#x27;{{.State.Status}}&#x27; $container_id)</span><span class="diff-line add">+</span><span class="diff-line add">+            echo &quot;Container Name: $CONTAINER_NAME&quot;</span><span class="diff-line add">+            echo &quot;Container Status: $CONTAINER_STATUS&quot;</span><span class="diff-line add">+            echo &quot;&quot;</span><span class="diff-line add">+            echo &quot;Full inspection details:&quot;</span><span class="diff-line add">+            echo &quot;----------------------------------------&quot;</span><span class="diff-line add">+</span><span class="diff-line add">+            # Print full inspection details</span><span class="diff-line add">+            docker inspect $container_id</span><span class="diff-line add">+</span><span class="diff-line add">+            echo &quot;&quot;</span><span class="diff-line add">+            echo &quot;=========================================&quot;</span><span class="diff-line add">+            echo &quot;&quot;</span><span class="diff-line add">+          done</span><span class="diff-line add">+</span><span class="diff-line add">+          echo &quot;=== Container inspection completed ===&quot;</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-61">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>.gitignore</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -3,6 +3,13 @@</span><span class="diff-line context"> </span><span class="diff-line context"> ### Python ###</span><span class="diff-line context"> *.pyc</span><span class="diff-line add">+*.py[cod]</span><span class="diff-line add">+*$py.class</span><span class="diff-line add">+/__pycache__/</span><span class="diff-line add">+/library/__pycache__/</span><span class="diff-line add">+/scripts/__pycache__/</span><span class="diff-line add">+/lookup_plugins/__pycache__/</span><span class="diff-line add">+/filter_plugins/__pycache__/</span><span class="diff-line context"> </span><span class="diff-line context"> ### Ansible ###</span><span class="diff-line context"> /backup.lock</span><span class="diff-line hunk">@@ -34,4 +41,5 @@</span><span class="diff-line context"> /.idea</span><span class="diff-line context"> /*.log</span><span class="diff-line context"> /*.log.*</span><span class="diff-line del">-.vscode/settings.json</span><span class="diff-line add">+.vscode/</span><span class="diff-line add">+.claude/</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-62">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>README.md</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -101,19 +101,63 @@</span><span class="diff-line context">         &lt;/a&gt;</span><span class="diff-line context">     &lt;/td&gt;</span><span class="diff-line context">     &lt;td align=&quot;center&quot; style=&quot;word-wrap: break-word; width: 150.0; height: 150.0&quot;&gt;</span><span class="diff-line add">+        &lt;a href=https://github.com/jonathanfinley&gt;</span><span class="diff-line add">+            &lt;img src=https://avatars.githubusercontent.com/u/23283167?v=4 width=&quot;100;&quot;  alt=jonathanfinley/&gt;</span><span class="diff-line add">+            &lt;br /&gt;</span><span class="diff-line add">+            &lt;sub style=&quot;font-size:14px&quot;&gt;&lt;b&gt;jonathanfinley&lt;/b&gt;&lt;/sub&gt;</span><span class="diff-line add">+        &lt;/a&gt;</span><span class="diff-line add">+    &lt;/td&gt;</span><span class="diff-line add">+&lt;/tr&gt;</span><span class="diff-line add">+&lt;tr&gt;</span><span class="diff-line add">+    &lt;td align=&quot;center&quot; style=&quot;word-wrap: break-word; width: 150.0; height: 150.0&quot;&gt;</span><span class="diff-line context">         &lt;a href=https://github.com/chazlarson&gt;</span><span class="diff-line context">             &lt;img src=https://avatars.githubusercontent.com/u/3865541?v=4 width=&quot;100;&quot;  alt=Chaz Larson/&gt;</span><span class="diff-line context">             &lt;br /&gt;</span><span class="diff-line context">             &lt;sub style=&quot;font-size:14px&quot;&gt;&lt;b&gt;Chaz Larson&lt;/b&gt;&lt;/sub&gt;</span><span class="diff-line context">         &lt;/a&gt;</span><span class="diff-line context">     &lt;/td&gt;</span><span class="diff-line del">-&lt;/tr&gt;</span><span class="diff-line del">-&lt;tr&gt;</span><span class="diff-line del">-    &lt;td align=&quot;center&quot; style=&quot;word-wrap: break-word; width: 150.0; height: 150.0&quot;&gt;</span><span class="diff-line del">-        &lt;a href=https://github.com/jonathanfinley&gt;</span><span class="diff-line del">-            &lt;img src=https://avatars.githubusercontent.com/u/23283167?v=4 width=&quot;100;&quot;  alt=jonathanfinley/&gt;</span><span class="diff-line del">-            &lt;br /&gt;</span><span class="diff-line del">-            &lt;sub style=&quot;font-size:14px&quot;&gt;&lt;b&gt;jonathanfinley&lt;/b&gt;&lt;/sub&gt;</span><span class="diff-line add">+    &lt;td align=&quot;center&quot; style=&quot;word-wrap: break-word; width: 150.0; height: 150.0&quot;&gt;</span><span class="diff-line add">+        &lt;a href=https://github.com/RXWatcher&gt;</span><span class="diff-line add">+            &lt;img src=https://avatars.githubusercontent.com/u/14085001?v=4 width=&quot;100;&quot;  alt=RXWatcher/&gt;</span><span class="diff-line add">+            &lt;br /&gt;</span><span class="diff-line add">+            &lt;sub style=&quot;font-size:14px&quot;&gt;&lt;b&gt;RXWatcher&lt;/b&gt;&lt;/sub&gt;</span><span class="diff-line add">+        &lt;/a&gt;</span><span class="diff-line add">+    &lt;/td&gt;</span><span class="diff-line add">+    &lt;td align=&quot;center&quot; style=&quot;word-wrap: break-word; width: 150.0; height: 150.0&quot;&gt;</span><span class="diff-line add">+        &lt;a href=https://github.com/JigSawFr&gt;</span><span class="diff-line add">+            &lt;img src=https://avatars.githubusercontent.com/u/5781907?v=4 width=&quot;100;&quot;  alt=JigSaw/&gt;</span><span class="diff-line add">+            &lt;br /&gt;</span><span class="diff-line add">+            &lt;sub style=&quot;font-size:14px&quot;&gt;&lt;b&gt;JigSaw&lt;/b&gt;&lt;/sub&gt;</span><span class="diff-line add">+        &lt;/a&gt;</span><span class="diff-line add">+    &lt;/td&gt;</span><span class="diff-line add">+    &lt;td align=&quot;center&quot; style=&quot;word-wrap: break-word; width: 150.0; height: 150.0&quot;&gt;</span><span class="diff-line add">+        &lt;a href=https://github.com/andrewkhunn&gt;</span><span class="diff-line add">+            &lt;img src=https://avatars.githubusercontent.com/u/116436?v=4 width=&quot;100;&quot;  alt=Andrew Hunn/&gt;</span><span class="diff-line add">+            &lt;br /&gt;</span><span class="diff-line add">+            &lt;sub style=&quot;font-size:14px&quot;&gt;&lt;b&gt;Andrew Hunn&lt;/b&gt;&lt;/sub&gt;</span><span class="diff-line add">+        &lt;/a&gt;</span><span class="diff-line add">+    &lt;/td&gt;</span><span class="diff-line add">+    &lt;td align=&quot;center&quot; style=&quot;word-wrap: break-word; width: 150.0; height: 150.0&quot;&gt;</span><span class="diff-line add">+        &lt;a href=https://github.com/BeansIsFat&gt;</span><span class="diff-line add">+            &lt;img src=https://avatars.githubusercontent.com/u/24848012?v=4 width=&quot;100;&quot;  alt=Beans Baxter/&gt;</span><span class="diff-line add">+            &lt;br /&gt;</span><span class="diff-line add">+            &lt;sub style=&quot;font-size:14px&quot;&gt;&lt;b&gt;Beans Baxter&lt;/b&gt;&lt;/sub&gt;</span><span class="diff-line add">+        &lt;/a&gt;</span><span class="diff-line add">+    &lt;/td&gt;</span><span class="diff-line add">+    &lt;td align=&quot;center&quot; style=&quot;word-wrap: break-word; width: 150.0; height: 150.0&quot;&gt;</span><span class="diff-line add">+        &lt;a href=https://github.com/maximuskowalski&gt;</span><span class="diff-line add">+            &lt;img src=https://avatars.githubusercontent.com/u/13492750?v=4 width=&quot;100;&quot;  alt=Max Kowalski/&gt;</span><span class="diff-line add">+            &lt;br /&gt;</span><span class="diff-line add">+            &lt;sub style=&quot;font-size:14px&quot;&gt;&lt;b&gt;Max Kowalski&lt;/b&gt;&lt;/sub&gt;</span><span class="diff-line add">+        &lt;/a&gt;</span><span class="diff-line add">+    &lt;/td&gt;</span><span class="diff-line add">+&lt;/tr&gt;</span><span class="diff-line add">+&lt;tr&gt;</span><span class="diff-line add">+    &lt;td align=&quot;center&quot; style=&quot;word-wrap: break-word; width: 150.0; height: 150.0&quot;&gt;</span><span class="diff-line add">+        &lt;a href=https://github.com/TABLE272&gt;</span><span class="diff-line add">+            &lt;img src=https://avatars.githubusercontent.com/u/11992630?v=4 width=&quot;100;&quot;  alt=TABLE272/&gt;</span><span class="diff-line add">+            &lt;br /&gt;</span><span class="diff-line add">+            &lt;sub style=&quot;font-size:14px&quot;&gt;&lt;b&gt;TABLE272&lt;/b&gt;&lt;/sub&gt;</span><span class="diff-line context">         &lt;/a&gt;</span><span class="diff-line context">     &lt;/td&gt;</span><span class="diff-line context">     &lt;td align=&quot;center&quot; style=&quot;word-wrap: break-word; width: 150.0; height: 150.0&quot;&gt;</span><span class="diff-line hunk">@@ -124,54 +168,17 @@</span><span class="diff-line context">         &lt;/a&gt;</span><span class="diff-line context">     &lt;/td&gt;</span><span class="diff-line context">     &lt;td align=&quot;center&quot; style=&quot;word-wrap: break-word; width: 150.0; height: 150.0&quot;&gt;</span><span class="diff-line del">-        &lt;a href=https://github.com/kbgvirus&gt;</span><span class="diff-line del">-            &lt;img src=https://avatars.githubusercontent.com/u/20810766?v=4 width=&quot;100;&quot;  alt=Alon Nitzan/&gt;</span><span class="diff-line del">-            &lt;br /&gt;</span><span class="diff-line del">-            &lt;sub style=&quot;font-size:14px&quot;&gt;&lt;b&gt;Alon Nitzan&lt;/b&gt;&lt;/sub&gt;</span><span class="diff-line del">-        &lt;/a&gt;</span><span class="diff-line del">-    &lt;/td&gt;</span><span class="diff-line del">-    &lt;td align=&quot;center&quot; style=&quot;word-wrap: break-word; width: 150.0; height: 150.0&quot;&gt;</span><span class="diff-line del">-        &lt;a href=https://github.com/RXWatcher&gt;</span><span class="diff-line del">-            &lt;img src=https://avatars.githubusercontent.com/u/14085001?v=4 width=&quot;100;&quot;  alt=RXWatcher/&gt;</span><span class="diff-line del">-            &lt;br /&gt;</span><span class="diff-line del">-            &lt;sub style=&quot;font-size:14px&quot;&gt;&lt;b&gt;RXWatcher&lt;/b&gt;&lt;/sub&gt;</span><span class="diff-line del">-        &lt;/a&gt;</span><span class="diff-line del">-    &lt;/td&gt;</span><span class="diff-line del">-    &lt;td align=&quot;center&quot; style=&quot;word-wrap: break-word; width: 150.0; height: 150.0&quot;&gt;</span><span class="diff-line del">-        &lt;a href=https://github.com/JigSawFr&gt;</span><span class="diff-line del">-            &lt;img src=https://avatars.githubusercontent.com/u/5781907?v=4 width=&quot;100;&quot;  alt=JigSaw/&gt;</span><span class="diff-line del">-            &lt;br /&gt;</span><span class="diff-line del">-            &lt;sub style=&quot;font-size:14px&quot;&gt;&lt;b&gt;JigSaw&lt;/b&gt;&lt;/sub&gt;</span><span class="diff-line del">-        &lt;/a&gt;</span><span class="diff-line del">-    &lt;/td&gt;</span><span class="diff-line del">-    &lt;td align=&quot;center&quot; style=&quot;word-wrap: break-word; width: 150.0; height: 150.0&quot;&gt;</span><span class="diff-line del">-        &lt;a href=https://github.com/TABLE272&gt;</span><span class="diff-line del">-            &lt;img src=https://avatars.githubusercontent.com/u/11992630?v=4 width=&quot;100;&quot;  alt=TABLE272/&gt;</span><span class="diff-line del">-            &lt;br /&gt;</span><span class="diff-line del">-            &lt;sub style=&quot;font-size:14px&quot;&gt;&lt;b&gt;TABLE272&lt;/b&gt;&lt;/sub&gt;</span><span class="diff-line del">-        &lt;/a&gt;</span><span class="diff-line del">-    &lt;/td&gt;</span><span class="diff-line del">-&lt;/tr&gt;</span><span class="diff-line del">-&lt;tr&gt;</span><span class="diff-line del">-    &lt;td align=&quot;center&quot; style=&quot;word-wrap: break-word; width: 150.0; height: 150.0&quot;&gt;</span><span class="diff-line del">-        &lt;a href=https://github.com/maximuskowalski&gt;</span><span class="diff-line del">-            &lt;img src=https://avatars.githubusercontent.com/u/13492750?v=4 width=&quot;100;&quot;  alt=Max Kowalski/&gt;</span><span class="diff-line del">-            &lt;br /&gt;</span><span class="diff-line del">-            &lt;sub style=&quot;font-size:14px&quot;&gt;&lt;b&gt;Max Kowalski&lt;/b&gt;&lt;/sub&gt;</span><span class="diff-line del">-        &lt;/a&gt;</span><span class="diff-line del">-    &lt;/td&gt;</span><span class="diff-line del">-    &lt;td align=&quot;center&quot; style=&quot;word-wrap: break-word; width: 150.0; height: 150.0&quot;&gt;</span><span class="diff-line del">-        &lt;a href=https://github.com/BeansIsFat&gt;</span><span class="diff-line del">-            &lt;img src=https://avatars.githubusercontent.com/u/24848012?v=4 width=&quot;100;&quot;  alt=Beans Baxter/&gt;</span><span class="diff-line del">-            &lt;br /&gt;</span><span class="diff-line del">-            &lt;sub style=&quot;font-size:14px&quot;&gt;&lt;b&gt;Beans Baxter&lt;/b&gt;&lt;/sub&gt;</span><span class="diff-line del">-        &lt;/a&gt;</span><span class="diff-line del">-    &lt;/td&gt;</span><span class="diff-line del">-    &lt;td align=&quot;center&quot; style=&quot;word-wrap: break-word; width: 150.0; height: 150.0&quot;&gt;</span><span class="diff-line del">-        &lt;a href=https://github.com/andrewkhunn&gt;</span><span class="diff-line del">-            &lt;img src=https://avatars.githubusercontent.com/u/116436?v=4 width=&quot;100;&quot;  alt=Andrew Hunn/&gt;</span><span class="diff-line del">-            &lt;br /&gt;</span><span class="diff-line del">-            &lt;sub style=&quot;font-size:14px&quot;&gt;&lt;b&gt;Andrew Hunn&lt;/b&gt;&lt;/sub&gt;</span><span class="diff-line add">+        &lt;a href=https://github.com/lonix&gt;</span><span class="diff-line add">+            &lt;img src=https://avatars.githubusercontent.com/u/2330355?v=4 width=&quot;100;&quot;  alt=Stian Buch Larsen/&gt;</span><span class="diff-line add">+            &lt;br /&gt;</span><span class="diff-line add">+            &lt;sub style=&quot;font-size:14px&quot;&gt;&lt;b&gt;Stian Buch Larsen&lt;/b&gt;&lt;/sub&gt;</span><span class="diff-line add">+        &lt;/a&gt;</span><span class="diff-line add">+    &lt;/td&gt;</span><span class="diff-line add">+    &lt;td align=&quot;center&quot; style=&quot;word-wrap: break-word; width: 150.0; height: 150.0&quot;&gt;</span><span class="diff-line add">+        &lt;a href=https://github.com/Migz93&gt;</span><span class="diff-line add">+            &lt;img src=https://avatars.githubusercontent.com/u/33037112?v=4 width=&quot;100;&quot;  alt=Migz93/&gt;</span><span class="diff-line add">+            &lt;br /&gt;</span><span class="diff-line add">+            &lt;sub style=&quot;font-size:14px&quot;&gt;&lt;b&gt;Migz93&lt;/b&gt;&lt;/sub&gt;</span><span class="diff-line context">         &lt;/a&gt;</span><span class="diff-line context">     &lt;/td&gt;</span><span class="diff-line context">     &lt;td align=&quot;center&quot; style=&quot;word-wrap: break-word; width: 150.0; height: 150.0&quot;&gt;</span><span class="diff-line hunk">@@ -182,28 +189,14 @@</span><span class="diff-line context">         &lt;/a&gt;</span><span class="diff-line context">     &lt;/td&gt;</span><span class="diff-line context">     &lt;td align=&quot;center&quot; style=&quot;word-wrap: break-word; width: 150.0; height: 150.0&quot;&gt;</span><span class="diff-line del">-        &lt;a href=https://github.com/Migz93&gt;</span><span class="diff-line del">-            &lt;img src=https://avatars.githubusercontent.com/u/33037112?v=4 width=&quot;100;&quot;  alt=Migz93/&gt;</span><span class="diff-line del">-            &lt;br /&gt;</span><span class="diff-line del">-            &lt;sub style=&quot;font-size:14px&quot;&gt;&lt;b&gt;Migz93&lt;/b&gt;&lt;/sub&gt;</span><span class="diff-line del">-        &lt;/a&gt;</span><span class="diff-line del">-    &lt;/td&gt;</span><span class="diff-line del">-    &lt;td align=&quot;center&quot; style=&quot;word-wrap: break-word; width: 150.0; height: 150.0&quot;&gt;</span><span class="diff-line del">-        &lt;a href=https://github.com/lonix&gt;</span><span class="diff-line del">-            &lt;img src=https://avatars.githubusercontent.com/u/2330355?v=4 width=&quot;100;&quot;  alt=Stian Buch Larsen/&gt;</span><span class="diff-line del">-            &lt;br /&gt;</span><span class="diff-line del">-            &lt;sub style=&quot;font-size:14px&quot;&gt;&lt;b&gt;Stian Buch Larsen&lt;/b&gt;&lt;/sub&gt;</span><span class="diff-line del">-        &lt;/a&gt;</span><span class="diff-line del">-    &lt;/td&gt;</span><span class="diff-line del">-&lt;/tr&gt;</span><span class="diff-line del">-&lt;tr&gt;</span><span class="diff-line del">-    &lt;td align=&quot;center&quot; style=&quot;word-wrap: break-word; width: 150.0; height: 150.0&quot;&gt;</span><span class="diff-line context">         &lt;a href=https://github.com/Aethenn&gt;</span><span class="diff-line context">             &lt;img src=https://avatars.githubusercontent.com/u/58144688?v=4 width=&quot;100;&quot;  alt=Aethenn/&gt;</span><span class="diff-line context">             &lt;br /&gt;</span><span class="diff-line context">             &lt;sub style=&quot;font-size:14px&quot;&gt;&lt;b&gt;Aethenn&lt;/b&gt;&lt;/sub&gt;</span><span class="diff-line context">         &lt;/a&gt;</span><span class="diff-line context">     &lt;/td&gt;</span><span class="diff-line add">+&lt;/tr&gt;</span><span class="diff-line add">+&lt;tr&gt;</span><span class="diff-line context">     &lt;td align=&quot;center&quot; style=&quot;word-wrap: break-word; width: 150.0; height: 150.0&quot;&gt;</span><span class="diff-line context">         &lt;a href=https://github.com/horjulf&gt;</span><span class="diff-line context">             &lt;img src=https://avatars.githubusercontent.com/u/6215635?v=4 width=&quot;100;&quot;  alt=Filipe/&gt;</span><span class="diff-line hunk">@@ -239,8 +232,6 @@</span><span class="diff-line context">             &lt;sub style=&quot;font-size:14px&quot;&gt;&lt;b&gt;Patrick Sindelka&lt;/b&gt;&lt;/sub&gt;</span><span class="diff-line context">         &lt;/a&gt;</span><span class="diff-line context">     &lt;/td&gt;</span><span class="diff-line del">-&lt;/tr&gt;</span><span class="diff-line del">-&lt;tr&gt;</span><span class="diff-line context">     &lt;td align=&quot;center&quot; style=&quot;word-wrap: break-word; width: 150.0; height: 150.0&quot;&gt;</span><span class="diff-line context">         &lt;a href=https://github.com/bandwith&gt;</span><span class="diff-line context">             &lt;img src=https://avatars.githubusercontent.com/u/62576?v=4 width=&quot;100;&quot;  alt=bandwith/&gt;</span><span class="diff-line hunk">@@ -248,6 +239,8 @@</span><span class="diff-line context">             &lt;sub style=&quot;font-size:14px&quot;&gt;&lt;b&gt;bandwith&lt;/b&gt;&lt;/sub&gt;</span><span class="diff-line context">         &lt;/a&gt;</span><span class="diff-line context">     &lt;/td&gt;</span><span class="diff-line add">+&lt;/tr&gt;</span><span class="diff-line add">+&lt;tr&gt;</span><span class="diff-line context">     &lt;td align=&quot;center&quot; style=&quot;word-wrap: break-word; width: 150.0; height: 150.0&quot;&gt;</span><span class="diff-line context">         &lt;a href=https://github.com/powerdude&gt;</span><span class="diff-line context">             &lt;img src=https://avatars.githubusercontent.com/u/780882?v=4 width=&quot;100;&quot;  alt=powerdude/&gt;</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-63">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>ansible.cfg</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -2,6 +2,7 @@</span><span class="diff-line context"> inventory = ./inventories/local</span><span class="diff-line context"> roles_path = roles:resources/roles</span><span class="diff-line context"> filter_plugins = ./filter_plugins</span><span class="diff-line add">+lookup_plugins = ./lookup_plugins</span><span class="diff-line context"> library = ./library</span><span class="diff-line context"> log_path = ./saltbox.log</span><span class="diff-line context"> callbacks_enabled = profile_tasks</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-64">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>filter_plugins/rclone_filters.py</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -1,4 +1,6 @@</span><span class="diff-line context"> def filter_rclone_remote_name(item):</span><span class="diff-line add">+    # &#x27;name&#x27; is an optional field in settings.yml, only used when template is &#x27;nfs&#x27;.</span><span class="diff-line add">+    # If not provided, falls back to extracting the name from the remote string.</span><span class="diff-line context">     if &#x27;settings&#x27; in item and &#x27;name&#x27; in item[&#x27;settings&#x27;] and item[&#x27;settings&#x27;][&#x27;template&#x27;] == &#x27;nfs&#x27;:</span><span class="diff-line context">         return item[&#x27;settings&#x27;][&#x27;name&#x27;]</span><span class="diff-line context">     else:</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-65">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>inventories/group_vars/all.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -43,7 +43,7 @@</span><span class="diff-line context"> </span><span class="diff-line context"> cloudflare_records_enabled: &quot;{{ cloudflare_is_enabled }}&quot;</span><span class="diff-line context"> </span><span class="diff-line del">-plex_account_lookup: &quot;{{ &#x27;/opt/saltbox/plex.ini&#x27; | check_plex_ini(plex_instances[0]) }}&quot;</span><span class="diff-line add">+plex_account_lookup: &quot;{{ (server_appdata_path + &#x27;/saltbox/plex.ini&#x27;) | check_plex_ini(plex_instances[0]) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> plex_account_is_enabled: &quot;{{ plex_account_lookup.exists and</span><span class="diff-line context">                              (plex_account_lookup.identifier | length &gt; 0) and</span><span class="diff-line hunk">@@ -83,12 +83,12 @@</span><span class="diff-line context">                                   (rclone.remote is not none) and</span><span class="diff-line context">                                   (rclone.remote | trim | length &gt; 0) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line add">+rclone_mounts_ipv4_only: &quot;{{ mounts.ipv4_only | bool }}&quot;</span><span class="diff-line add">+</span><span class="diff-line context"> use_cloudplow: &quot;{{ rclone_remote_is_defined and use_remote }}&quot;</span><span class="diff-line del">-</span><span class="diff-line context"> use_remote: &quot;{{ (rclone.enabled | bool) and not continuous_integration }}&quot;</span><span class="diff-line del">-</span><span class="diff-line context"> use_motd: &quot;{{ motd_install | bool }}&quot;</span><span class="diff-line del">-</span><span class="diff-line add">+use_intel: &quot;{{ gpu.intel | bool }}&quot;</span><span class="diff-line context"> use_nvidia: &quot;{{ nvidia_enabled | bool }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line hunk">@@ -96,8 +96,8 @@</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line context"> server_root_path: &quot;/&quot;</span><span class="diff-line del">-</span><span class="diff-line context"> server_appdata_path: &quot;{{ server_root_path | regex_replace(&#x27;\\/$&#x27;, &#x27;&#x27;) + &#x27;/opt&#x27; }}&quot;</span><span class="diff-line add">+server_local_folder_path: &quot;/mnt/local&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # Paths</span><span class="diff-line hunk">@@ -119,20 +119,24 @@</span><span class="diff-line context"> # User</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-uid: &quot;{{ ansible_local.saltbox.users[user.name].uid }}&quot;</span><span class="diff-line del">-gid: &quot;{{ ansible_local.saltbox.users[user.name].gid }}&quot;</span><span class="diff-line del">-vgid: &quot;{{ ansible_local.saltbox.groups.video.gid }}&quot;</span><span class="diff-line del">-rgid: &quot;{{ ansible_local.saltbox.groups.render.gid }}&quot;</span><span class="diff-line del">-dockergid: &quot;{{ ansible_local.saltbox.groups.docker.gid }}&quot;</span><span class="diff-line add">+uid: &quot;{{ ansible_facts[&#x27;ansible_local&#x27;][&#x27;saltbox&#x27;][&#x27;users&#x27;][user.name][&#x27;uid&#x27;] }}&quot;</span><span class="diff-line add">+gid: &quot;{{ ansible_facts[&#x27;ansible_local&#x27;][&#x27;saltbox&#x27;][&#x27;users&#x27;][user.name][&#x27;gid&#x27;] }}&quot;</span><span class="diff-line add">+vgid: &quot;{{ ansible_facts[&#x27;ansible_local&#x27;][&#x27;saltbox&#x27;][&#x27;groups&#x27;][&#x27;video&#x27;][&#x27;gid&#x27;] }}&quot;</span><span class="diff-line add">+rgid: &quot;{{ ansible_facts[&#x27;ansible_local&#x27;][&#x27;saltbox&#x27;][&#x27;groups&#x27;][&#x27;render&#x27;][&#x27;gid&#x27;] }}&quot;</span><span class="diff-line add">+dockergid: &quot;{{ ansible_facts[&#x27;ansible_local&#x27;][&#x27;saltbox&#x27;][&#x27;groups&#x27;][&#x27;docker&#x27;][&#x27;gid&#x27;] }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # Timezone</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line context"> tz: &quot;{{ system.timezone</span><span class="diff-line del">-     if system is defined and system.timezone is defined and &#x27;auto&#x27; not in system.timezone | lower</span><span class="diff-line del">-     else ansible_local.saltbox.timezone.timezone</span><span class="diff-line del">-          if ansible_local is defined and ansible_local.saltbox.timezone is defined and ansible_local.saltbox.timezone.timezone is defined and ansible_local.saltbox.timezone.timezone | trim | length &gt; 0</span><span class="diff-line add">+     if (system is defined) and (system.timezone is defined) and (&#x27;auto&#x27; not in system.timezone | lower)</span><span class="diff-line add">+     else ansible_facts[&#x27;ansible_local&#x27;][&#x27;saltbox&#x27;][&#x27;timezone&#x27;][&#x27;timezone&#x27;]</span><span class="diff-line add">+          if (ansible_facts[&#x27;ansible_local&#x27;])</span><span class="diff-line add">+             and (ansible_facts[&#x27;ansible_local&#x27;][&#x27;saltbox&#x27;] is defined)</span><span class="diff-line add">+             and (ansible_facts[&#x27;ansible_local&#x27;][&#x27;saltbox&#x27;][&#x27;timezone&#x27;] is defined)</span><span class="diff-line add">+             and (ansible_facts[&#x27;ansible_local&#x27;][&#x27;saltbox&#x27;][&#x27;timezone&#x27;][&#x27;timezone&#x27;] is defined)</span><span class="diff-line add">+             and (ansible_facts[&#x27;ansible_local&#x27;][&#x27;saltbox&#x27;][&#x27;timezone&#x27;][&#x27;timezone&#x27;] | trim | length &gt; 0)</span><span class="diff-line context">           else &#x27;Etc/UTC&#x27; }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line hunk">@@ -141,12 +145,16 @@</span><span class="diff-line context"> </span><span class="diff-line context"> ip_address_host: &quot;0.0.0.0&quot;</span><span class="diff-line context"> ip_address_localhost: &quot;127.0.0.1&quot;</span><span class="diff-line del">-ip_address_public: &quot;{{ ansible_local.saltbox.ip.public_ip }}&quot;</span><span class="diff-line del">-ip_address_public_is_valid: &quot;{{ false if ansible_local.saltbox.ip.failed_ipv4 else true }}&quot;</span><span class="diff-line del">-ip_address_public_error: &quot;{{ ansible_local.saltbox.ip.error_ipv4 }}&quot;</span><span class="diff-line del">-ipv6_address_public: &quot;{{ ansible_local.saltbox.ip.public_ipv6 }}&quot;</span><span class="diff-line del">-ipv6_address_public_is_valid: &quot;{{ false if ansible_local.saltbox.ip.failed_ipv6 else true }}&quot;</span><span class="diff-line del">-ipv6_address_public_error: &quot;{{ ansible_local.saltbox.ip.error_ipv6 }}&quot;</span><span class="diff-line add">+ip_address_public: &quot;{{ ansible_facts[&#x27;ansible_local&#x27;][&#x27;saltbox&#x27;][&#x27;ip&#x27;][&#x27;public_ip&#x27;] }}&quot;</span><span class="diff-line add">+ip_address_public_is_valid: &quot;{{ false</span><span class="diff-line add">+                             if ansible_facts[&#x27;ansible_local&#x27;][&#x27;saltbox&#x27;][&#x27;ip&#x27;][&#x27;failed_ipv4&#x27;]</span><span class="diff-line add">+                             else true }}&quot;</span><span class="diff-line add">+ip_address_public_error: &quot;{{ ansible_facts[&#x27;ansible_local&#x27;][&#x27;saltbox&#x27;][&#x27;ip&#x27;][&#x27;error_ipv4&#x27;] }}&quot;</span><span class="diff-line add">+ipv6_address_public: &quot;{{ ansible_facts[&#x27;ansible_local&#x27;][&#x27;saltbox&#x27;][&#x27;ip&#x27;][&#x27;public_ipv6&#x27;] }}&quot;</span><span class="diff-line add">+ipv6_address_public_is_valid: &quot;{{ false</span><span class="diff-line add">+                               if ansible_facts[&#x27;ansible_local&#x27;][&#x27;saltbox&#x27;][&#x27;ip&#x27;][&#x27;failed_ipv6&#x27;]</span><span class="diff-line add">+                               else true }}&quot;</span><span class="diff-line add">+ipv6_address_public_error: &quot;{{ ansible_facts[&#x27;ansible_local&#x27;][&#x27;saltbox&#x27;][&#x27;ip&#x27;][&#x27;error_ipv6&#x27;] }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # Theme</span><span class="diff-line hunk">@@ -191,37 +199,39 @@</span><span class="diff-line context"> traefik_default_certresolver: &quot;{{ traefik_default_certprovider</span><span class="diff-line context">                                if (not (traefik_http | bool))</span><span class="diff-line context">                                else (traefik_default_resolver if not zerossl_is_enabled else traefik_default_zerossl_resolver) }}&quot;</span><span class="diff-line add">+traefik_role_wildcard_enabled: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_traefik_wildcard_enabled&#x27;, default=(not traefik_http)) | bool }}&quot;</span><span class="diff-line add">+</span><span class="diff-line context"> </span><span class="diff-line context"> traefik_error_pages_enabled: &quot;{{ traefik.error_pages | bool }}&quot;</span><span class="diff-line del">-traefik_error_pages_role_enabled: &quot;{{ lookup(&#x27;vars&#x27;, traefik_role_var + &#x27;_traefik_error_pages_enabled&#x27;, default=lookup(&#x27;vars&#x27;, role_name + &#x27;_traefik_error_pages_enabled&#x27;, default=false)) | bool }}&quot;</span><span class="diff-line del">-traefik_error_pages_middleware: &quot;{{ &#x27;error-pages-middleware@docker,&#x27;</span><span class="diff-line del">-                                 if traefik_error_pages_enabled and traefik_error_pages_role_enabled</span><span class="diff-line add">+traefik_error_pages_role_enabled: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_traefik_error_pages_enabled&#x27;, default=false) | bool }}&quot;</span><span class="diff-line add">+traefik_error_pages_middleware: &quot;{{ &#x27;error-pages-middleware@docker&#x27;</span><span class="diff-line add">+                                 if (traefik_error_pages_enabled and traefik_error_pages_role_enabled)</span><span class="diff-line context">                                  else &#x27;&#x27; }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> traefik_default_robot: true</span><span class="diff-line context"> traefik_default_gzip: false</span><span class="diff-line context"> traefik_default_autodetect: false</span><span class="diff-line del">-traefik_default_cloudflarewarp: &quot;{{ lookup(&#x27;vars&#x27;, traefik_role_var + &#x27;_dns_proxy&#x27;, default=lookup(&#x27;vars&#x27;, role_name + &#x27;_dns_proxy&#x27;, default=dns.proxied)) and cloudflare_is_enabled and traefik_plugin_cloudflarewarp_enabled }}&quot;</span><span class="diff-line add">+traefik_default_cloudflarewarp: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_dns_proxy&#x27;, default=dns_proxied) and cloudflare_is_enabled and traefik_plugin_cloudflarewarp_enabled }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> traefik_default_middleware_default: &quot;{{ traefik_error_pages_middleware</span><span class="diff-line context">                                         + &#x27;globalHeaders@file,secureHeaders@file&#x27;</span><span class="diff-line context">                                         + (&#x27;,autodetect@docker&#x27;</span><span class="diff-line del">-                                          if (lookup(&#x27;vars&#x27;, traefik_role_var + &#x27;_traefik_autodetect_enabled&#x27;, default=lookup(&#x27;vars&#x27;, role_name + &#x27;_traefik_autodetect_enabled&#x27;, default=traefik_default_autodetect)) | bool)</span><span class="diff-line add">+                                          if (lookup(&#x27;role_var&#x27;, &#x27;_traefik_autodetect_enabled&#x27;, default=traefik_default_autodetect) | bool)</span><span class="diff-line context">                                           else &#x27;&#x27;)</span><span class="diff-line context">                                         + (&#x27;,gzip@docker&#x27;</span><span class="diff-line del">-                                          if (lookup(&#x27;vars&#x27;, traefik_role_var + &#x27;_traefik_gzip_enabled&#x27;, default=lookup(&#x27;vars&#x27;, role_name + &#x27;_traefik_gzip_enabled&#x27;, default=traefik_default_gzip)) | bool)</span><span class="diff-line add">+                                          if (lookup(&#x27;role_var&#x27;, &#x27;_traefik_gzip_enabled&#x27;, default=traefik_default_gzip) | bool)</span><span class="diff-line context">                                           else &#x27;&#x27;)</span><span class="diff-line context">                                         + (&#x27;,robotHeaders@file&#x27;</span><span class="diff-line del">-                                          if (lookup(&#x27;vars&#x27;, traefik_role_var + &#x27;_traefik_robot_enabled&#x27;, default=lookup(&#x27;vars&#x27;, role_name + &#x27;_traefik_robot_enabled&#x27;, default=traefik_default_robot)) | bool)</span><span class="diff-line add">+                                          if (lookup(&#x27;role_var&#x27;, &#x27;_traefik_robot_enabled&#x27;, default=traefik_default_robot) | bool)</span><span class="diff-line context">                                           else &#x27;&#x27;)</span><span class="diff-line context">                                         + (&#x27;,hsts@file&#x27;</span><span class="diff-line context">                                           if (traefik.hsts | bool)</span><span class="diff-line context">                                           else &#x27;&#x27;)</span><span class="diff-line context">                                         + (&#x27;,cloudflarewarp@docker&#x27;</span><span class="diff-line del">-                                          if (traefik_default_cloudflarewarp | bool)</span><span class="diff-line add">+                                          if traefik_default_cloudflarewarp</span><span class="diff-line context">                                           else &#x27;&#x27;)</span><span class="diff-line context">                                         + (&#x27;,crowdsec@docker&#x27;</span><span class="diff-line del">-                                          if (lookup(&#x27;vars&#x27;, traefik_role_var + &#x27;_traefik_crowdsec_enabled&#x27;, default=lookup(&#x27;vars&#x27;, role_name + &#x27;_traefik_crowdsec_enabled&#x27;, default=crowdsec_is_enabled)))</span><span class="diff-line add">+                                          if (lookup(&#x27;role_var&#x27;, &#x27;_traefik_crowdsec_enabled&#x27;, default=crowdsec_is_enabled))</span><span class="diff-line context">                                           else &#x27;&#x27;)</span><span class="diff-line context">                                         + (&#x27;,&#x27; if (traefik_role_middleware_sso | length &gt; 0)</span><span class="diff-line context">                                                else &#x27;&#x27;)</span><span class="diff-line hunk">@@ -232,71 +242,80 @@</span><span class="diff-line context">                                   if (not traefik_default_middleware_custom.startswith(&#x27;,&#x27;) and traefik_default_middleware_custom | length &gt; 0)</span><span class="diff-line context">                                   else traefik_default_middleware_custom) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line del">-traefik_role_middleware_sso: &quot;{{ lookup(&#x27;vars&#x27;, traefik_role_var + &#x27;_traefik_sso_middleware&#x27;, default=lookup(&#x27;vars&#x27;, role_name + &#x27;_traefik_sso_middleware&#x27;, default=&#x27;&#x27;)) }}&quot;</span><span class="diff-line del">-traefik_role_middleware_default: &quot;{{ lookup(&#x27;vars&#x27;, traefik_role_var + &#x27;_traefik_middleware_default&#x27;, default=lookup(&#x27;vars&#x27;, role_name + &#x27;_traefik_middleware_default&#x27;, default=&#x27;&#x27;)) }}&quot;</span><span class="diff-line del">-traefik_role_middleware_custom: &quot;{{ lookup(&#x27;vars&#x27;, traefik_role_var + &#x27;_traefik_middleware_custom&#x27;, default=lookup(&#x27;vars&#x27;, role_name + &#x27;_traefik_middleware_custom&#x27;, default=&#x27;&#x27;)) }}&quot;</span><span class="diff-line add">+traefik_role_middleware_sso: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_traefik_sso_middleware&#x27;, default=&#x27;&#x27;) }}&quot;</span><span class="diff-line add">+traefik_role_middleware_default: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_traefik_middleware_default&#x27;, default=&#x27;&#x27;) }}&quot;</span><span class="diff-line add">+traefik_role_middleware_custom: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_traefik_middleware_custom&#x27;, default=&#x27;&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> traefik_middleware: &quot;{{ traefik_role_middleware_default</span><span class="diff-line context">                         + (&#x27;,&#x27; + traefik_role_middleware_custom</span><span class="diff-line context">                           if (not traefik_role_middleware_custom.startswith(&#x27;,&#x27;) and traefik_role_middleware_custom | length &gt; 0)</span><span class="diff-line context">                           else traefik_role_middleware_custom) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line del">-traefik_default_middleware_default_http: &quot;{{ traefik_error_pages_middleware }}globalHeaders@file,redirect-to-https@docker&quot;</span><span class="diff-line add">+traefik_default_middleware_default_http:</span><span class="diff-line add">+  - &quot;{{ traefik_error_pages_middleware }}&quot;</span><span class="diff-line add">+  - &quot;globalHeaders@file&quot;</span><span class="diff-line add">+  - &quot;{{ (&#x27;&#x27;</span><span class="diff-line add">+     if (lookup(&#x27;role_var&#x27;, &#x27;_traefik_middleware_http_insecure&#x27;, default=false) | bool)</span><span class="diff-line add">+     else &#x27;redirect-to-https@docker&#x27;) }}&quot;</span><span class="diff-line context"> traefik_default_middleware_custom_http: &quot;&quot;</span><span class="diff-line del">-traefik_default_middleware_http: &quot;{{ traefik_default_middleware_default_http</span><span class="diff-line add">+traefik_default_middleware_http: &quot;{{ (traefik_default_middleware_default_http | select() | join(&#x27;,&#x27;))</span><span class="diff-line context">                                      + (&#x27;,&#x27; + traefik_default_middleware_custom_http</span><span class="diff-line context">                                        if (not traefik_default_middleware_custom_http.startswith(&#x27;,&#x27;) and traefik_default_middleware_custom_http | length &gt; 0)</span><span class="diff-line context">                                        else traefik_default_middleware_custom_http)</span><span class="diff-line context">                                      + (&#x27;,autodetect@docker&#x27;</span><span class="diff-line del">-                                       if (lookup(&#x27;vars&#x27;, traefik_role_var + &#x27;_traefik_autodetect_enabled&#x27;, default=lookup(&#x27;vars&#x27;, role_name + &#x27;_traefik_autodetect_enabled&#x27;, default=traefik_default_autodetect)) | bool)</span><span class="diff-line add">+                                       if (lookup(&#x27;role_var&#x27;, &#x27;_traefik_autodetect_enabled&#x27;, default=traefik_default_autodetect) | bool)</span><span class="diff-line context">                                        else &#x27;&#x27;)</span><span class="diff-line context">                                      + (&#x27;,gzip@docker&#x27;</span><span class="diff-line del">-                                       if (lookup(&#x27;vars&#x27;, traefik_role_var + &#x27;_traefik_gzip_enabled&#x27;, default=lookup(&#x27;vars&#x27;, role_name + &#x27;_traefik_gzip_enabled&#x27;, default=traefik_default_gzip)) | bool)</span><span class="diff-line add">+                                       if (lookup(&#x27;role_var&#x27;, &#x27;_traefik_gzip_enabled&#x27;, default=traefik_default_gzip) | bool)</span><span class="diff-line context">                                        else &#x27;&#x27;)</span><span class="diff-line context">                                      + (&#x27;,robotHeaders@file&#x27;</span><span class="diff-line del">-                                       if (lookup(&#x27;vars&#x27;, traefik_role_var + &#x27;_traefik_robot_enabled&#x27;, default=lookup(&#x27;vars&#x27;, role_name + &#x27;_traefik_robot_enabled&#x27;, default=traefik_default_robot)) | bool)</span><span class="diff-line add">+                                       if (lookup(&#x27;role_var&#x27;, &#x27;_traefik_robot_enabled&#x27;, default=traefik_default_robot) | bool)</span><span class="diff-line context">                                        else &#x27;&#x27;)</span><span class="diff-line context">                                      + (&#x27;,cloudflarewarp@docker&#x27;</span><span class="diff-line context">                                        if (traefik_default_cloudflarewarp | bool)</span><span class="diff-line context">                                        else &#x27;&#x27;)</span><span class="diff-line context">                                      + (&#x27;,crowdsec@docker&#x27;</span><span class="diff-line del">-                                       if (lookup(&#x27;vars&#x27;, traefik_role_var + &#x27;_traefik_crowdsec_enabled&#x27;, default=lookup(&#x27;vars&#x27;, role_name + &#x27;_traefik_crowdsec_enabled&#x27;, default=crowdsec_is_enabled)) | bool)</span><span class="diff-line add">+                                       if (lookup(&#x27;role_var&#x27;, &#x27;_traefik_crowdsec_enabled&#x27;, default=crowdsec_is_enabled) | bool)</span><span class="diff-line context">                                        else &#x27;&#x27;)</span><span class="diff-line context">                                      + (&#x27;,&#x27; if (traefik_role_middleware_sso | length &gt; 0)</span><span class="diff-line context">                                        else &#x27;&#x27;)</span><span class="diff-line context">                                      + traefik_role_middleware_sso }}&quot;</span><span class="diff-line context"> </span><span class="diff-line del">-traefik_default_middleware_default_http_api: &quot;globalHeaders@file,redirect-to-https@docker&quot;</span><span class="diff-line add">+traefik_default_middleware_default_http_api:</span><span class="diff-line add">+  - &quot;globalHeaders@file&quot;</span><span class="diff-line add">+  - &quot;{{ (&#x27;&#x27;</span><span class="diff-line add">+     if (lookup(&#x27;role_var&#x27;, &#x27;_traefik_middleware_http_api_insecure&#x27;, default=false) | bool)</span><span class="diff-line add">+     else &#x27;redirect-to-https@docker&#x27;) }}&quot;</span><span class="diff-line context"> traefik_default_middleware_custom_http_api: &quot;&quot;</span><span class="diff-line del">-traefik_default_middleware_http_api: &quot;{{ traefik_default_middleware_default_http_api</span><span class="diff-line add">+traefik_default_middleware_http_api: &quot;{{ (traefik_default_middleware_default_http_api | select() | join(&#x27;,&#x27;))</span><span class="diff-line context">                                          + (&#x27;,&#x27; + traefik_default_middleware_custom_http_api</span><span class="diff-line context">                                            if (not traefik_default_middleware_custom_http_api.startswith(&#x27;,&#x27;) and traefik_default_middleware_custom_http_api | length &gt; 0)</span><span class="diff-line context">                                            else traefik_default_middleware_custom_http_api)</span><span class="diff-line context">                                          + (&#x27;,autodetect@docker&#x27;</span><span class="diff-line del">-                                           if (lookup(&#x27;vars&#x27;, traefik_role_var + &#x27;_traefik_autodetect_enabled&#x27;, default=lookup(&#x27;vars&#x27;, role_name + &#x27;_traefik_autodetect_enabled&#x27;, default=traefik_default_autodetect)) | bool)</span><span class="diff-line add">+                                           if (lookup(&#x27;role_var&#x27;, &#x27;_traefik_autodetect_enabled&#x27;, default=traefik_default_autodetect) | bool)</span><span class="diff-line context">                                            else &#x27;&#x27;)</span><span class="diff-line context">                                          + (&#x27;,gzip@docker&#x27;</span><span class="diff-line del">-                                           if (lookup(&#x27;vars&#x27;, traefik_role_var + &#x27;_traefik_gzip_enabled&#x27;, default=lookup(&#x27;vars&#x27;, role_name + &#x27;_traefik_gzip_enabled&#x27;, default=traefik_default_gzip)) | bool)</span><span class="diff-line add">+                                           if (lookup(&#x27;role_var&#x27;, &#x27;_traefik_gzip_enabled&#x27;, default=traefik_default_gzip) | bool)</span><span class="diff-line context">                                            else &#x27;&#x27;)</span><span class="diff-line context">                                           + (&#x27;,robotHeaders@file&#x27;</span><span class="diff-line del">-                                           if (lookup(&#x27;vars&#x27;, traefik_role_var + &#x27;_traefik_robot_enabled&#x27;, default=lookup(&#x27;vars&#x27;, role_name + &#x27;_traefik_robot_enabled&#x27;, default=traefik_default_robot)) | bool)</span><span class="diff-line add">+                                           if (lookup(&#x27;role_var&#x27;, &#x27;_traefik_robot_enabled&#x27;, default=traefik_default_robot) | bool)</span><span class="diff-line context">                                            else &#x27;&#x27;)</span><span class="diff-line context">                                          + (&#x27;,cloudflarewarp@docker&#x27;</span><span class="diff-line context">                                            if (traefik_default_cloudflarewarp | bool)</span><span class="diff-line context">                                            else &#x27;&#x27;)</span><span class="diff-line context">                                          + (&#x27;,crowdsec@docker&#x27;</span><span class="diff-line del">-                                           if (lookup(&#x27;vars&#x27;, traefik_role_var + &#x27;_traefik_crowdsec_enabled&#x27;, default=lookup(&#x27;vars&#x27;, role_name + &#x27;_traefik_crowdsec_enabled&#x27;, default=crowdsec_is_enabled)) | bool)</span><span class="diff-line add">+                                           if (lookup(&#x27;role_var&#x27;, &#x27;_traefik_crowdsec_enabled&#x27;, default=crowdsec_is_enabled) | bool)</span><span class="diff-line context">                                            else &#x27;&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> traefik_default_middleware_default_api: &quot;{{ &#x27;globalHeaders@file,secureHeaders@file&#x27;</span><span class="diff-line context">                                             + (&#x27;,autodetect@docker&#x27;</span><span class="diff-line del">-                                              if (lookup(&#x27;vars&#x27;, traefik_role_var + &#x27;_traefik_autodetect_enabled&#x27;, default=lookup(&#x27;vars&#x27;, role_name + &#x27;_traefik_autodetect_enabled&#x27;, default=traefik_default_autodetect)) | bool)</span><span class="diff-line add">+                                              if (lookup(&#x27;role_var&#x27;, &#x27;_traefik_autodetect_enabled&#x27;, default=traefik_default_autodetect) | bool)</span><span class="diff-line context">                                               else &#x27;&#x27;)</span><span class="diff-line context">                                             + (&#x27;,gzip@docker&#x27;</span><span class="diff-line del">-                                              if (lookup(&#x27;vars&#x27;, traefik_role_var + &#x27;_traefik_gzip_enabled&#x27;, default=lookup(&#x27;vars&#x27;, role_name + &#x27;_traefik_gzip_enabled&#x27;, default=traefik_default_gzip)) | bool)</span><span class="diff-line add">+                                              if (lookup(&#x27;role_var&#x27;, &#x27;_traefik_gzip_enabled&#x27;, default=traefik_default_gzip) | bool)</span><span class="diff-line context">                                               else &#x27;&#x27;)</span><span class="diff-line context">                                             + (&#x27;,robotHeaders@file&#x27;</span><span class="diff-line del">-                                              if (lookup(&#x27;vars&#x27;, traefik_role_var + &#x27;_traefik_robot_enabled&#x27;, default=lookup(&#x27;vars&#x27;, role_name + &#x27;_traefik_robot_enabled&#x27;, default=traefik_default_robot)) | bool)</span><span class="diff-line add">+                                              if (lookup(&#x27;role_var&#x27;, &#x27;_traefik_robot_enabled&#x27;, default=traefik_default_robot) | bool)</span><span class="diff-line context">                                               else &#x27;&#x27;)</span><span class="diff-line context">                                             + (&#x27;,hsts@file&#x27;</span><span class="diff-line context">                                               if (traefik.hsts | bool)</span><span class="diff-line hunk">@@ -305,7 +324,7 @@</span><span class="diff-line context">                                               if (traefik_default_cloudflarewarp | bool)</span><span class="diff-line context">                                               else &#x27;&#x27;)</span><span class="diff-line context">                                             + (&#x27;,crowdsec@docker&#x27;</span><span class="diff-line del">-                                              if (lookup(&#x27;vars&#x27;, traefik_role_var + &#x27;_traefik_crowdsec_enabled&#x27;, default=lookup(&#x27;vars&#x27;, role_name + &#x27;_traefik_crowdsec_enabled&#x27;, default=crowdsec_is_enabled)) | bool)</span><span class="diff-line add">+                                              if (lookup(&#x27;role_var&#x27;, &#x27;_traefik_crowdsec_enabled&#x27;, default=crowdsec_is_enabled) | bool)</span><span class="diff-line context">                                               else &#x27;&#x27;) }}&quot;</span><span class="diff-line context"> traefik_default_middleware_custom_api: &quot;&quot;</span><span class="diff-line context"> traefik_default_middleware_api: &quot;{{ traefik_default_middleware_default_api</span><span class="diff-line hunk">@@ -315,52 +334,52 @@</span><span class="diff-line context"> </span><span class="diff-line context"> traefik_default_sso_middleware: &quot;authelia@docker&quot;</span><span class="diff-line context"> </span><span class="diff-line del">-traefik_role_enabled: &quot;{{ lookup(&#x27;vars&#x27;, traefik_role_var + &#x27;_traefik_enabled&#x27;, default=lookup(&#x27;vars&#x27;, role_name + &#x27;_traefik_enabled&#x27;, default=false)) | bool }}&quot;</span><span class="diff-line del">-traefik_role_api_enabled: &quot;{{ lookup(&#x27;vars&#x27;, traefik_role_var + &#x27;_traefik_api_enabled&#x27;, default=lookup(&#x27;vars&#x27;, role_name + &#x27;_traefik_api_enabled&#x27;, default=false)) | bool }}&quot;</span><span class="diff-line add">+traefik_role_enabled: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_traefik_enabled&#x27;, default=false) | bool }}&quot;</span><span class="diff-line add">+traefik_role_api_enabled: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_traefik_api_enabled&#x27;, default=false) | bool }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> traefik_http: &quot;{{ false</span><span class="diff-line context">                if ((traefik_challenge_provider != &#x27;cloudflare&#x27;) or cloudflare_is_enabled)</span><span class="diff-line context">                else true }}&quot;</span><span class="diff-line context"> </span><span class="diff-line del">-traefik_subdomain: &quot;{{ lookup(&#x27;vars&#x27;, traefik_role_var + &#x27;_web_subdomain&#x27;, default=lookup(&#x27;vars&#x27;, role_name + &#x27;_web_subdomain&#x27;, default=omit)) }}&quot;</span><span class="diff-line del">-traefik_domain: &quot;{{ lookup(&#x27;vars&#x27;, traefik_role_var + &#x27;_web_domain&#x27;, default=lookup(&#x27;vars&#x27;, role_name + &#x27;_web_domain&#x27;, default=omit)) }}&quot;</span><span class="diff-line add">+traefik_subdomain: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_web_subdomain&#x27;, default=omit) }}&quot;</span><span class="diff-line add">+traefik_domain: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_web_domain&#x27;, default=omit) }}&quot;</span><span class="diff-line context"> traefik_router: &quot;{{ lookup(&#x27;vars&#x27;, traefik_role_var + &#x27;_name&#x27;, default=lookup(&#x27;vars&#x27;, role_name + &#x27;_name&#x27;, default=omit)) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line del">-traefik_loadbalancer_port: &quot;{{ lookup(&#x27;vars&#x27;, traefik_role_var + &#x27;_web_port&#x27;, default=lookup(&#x27;vars&#x27;, role_name + &#x27;_web_port&#x27;, default=omit)) }}&quot;</span><span class="diff-line del">-traefik_loadbalancer_scheme: &quot;{{ lookup(&#x27;vars&#x27;, traefik_role_var + &#x27;_web_scheme&#x27;, default=lookup(&#x27;vars&#x27;, role_name + &#x27;_web_scheme&#x27;, default=omit)) }}&quot;</span><span class="diff-line add">+traefik_loadbalancer_port: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_web_port&#x27;, default=omit) }}&quot;</span><span class="diff-line add">+traefik_loadbalancer_scheme: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_web_scheme&#x27;, default=omit) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> traefik_host: &quot;{{ traefik_subdomain + &#x27;.&#x27; + traefik_domain</span><span class="diff-line context">                if (traefik_subdomain | length &gt; 0)</span><span class="diff-line context">                else traefik_domain }}&quot;</span><span class="diff-line context"> </span><span class="diff-line del">-traefik_host_override_lookup: &quot;{{ lookup(&#x27;vars&#x27;, traefik_role_var + &#x27;_web_host_override&#x27;, default=lookup(&#x27;vars&#x27;, role_name + &#x27;_web_host_override&#x27;, default=&#x27;&#x27;)) }}&quot;</span><span class="diff-line del">-traefik_fqdn_override_lookup: &quot;{{ lookup(&#x27;vars&#x27;, traefik_role_var + &#x27;_web_fqdn_override&#x27;, default=lookup(&#x27;vars&#x27;, role_name + &#x27;_web_fqdn_override&#x27;, default=&#x27;&#x27;)) }}&quot;</span><span class="diff-line add">+traefik_host_override_lookup: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_web_host_override&#x27;, default=&#x27;&#x27;) }}&quot;</span><span class="diff-line add">+traefik_fqdn_override_lookup: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_web_fqdn_override&#x27;, default=[]) }}&quot;</span><span class="diff-line context"> traefik_host_template: &quot;{{ traefik_host | traefik_host_rule(traefik_host_override_lookup, traefik_fqdn_override_lookup) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line del">-traefik_entrypoint_web_default: &quot;{{ &#x27;web&#x27; if not (lookup(&#x27;vars&#x27;, traefik_role_var + &#x27;_traefik_tailscale_enabled&#x27;, default=false) | bool) else &#x27;tailscale-web&#x27; }}&quot;</span><span class="diff-line del">-traefik_entrypoint_web: &quot;{{ lookup(&#x27;vars&#x27;, traefik_role_var + &#x27;_traefik_entrypoint_web&#x27;, default=traefik_entrypoint_web_default) }}&quot;</span><span class="diff-line del">-traefik_entrypoint_websecure_default: &quot;{{ &#x27;websecure&#x27; if not (lookup(&#x27;vars&#x27;, traefik_role_var + &#x27;_traefik_tailscale_enabled&#x27;, default=false) | bool) else &#x27;tailscale-websecure&#x27; }}&quot;</span><span class="diff-line del">-traefik_entrypoint_websecure: &quot;{{ lookup(&#x27;vars&#x27;, traefik_role_var + &#x27;_traefik_entrypoint_websecure&#x27;, default=traefik_entrypoint_websecure_default) }}&quot;</span><span class="diff-line add">+traefik_entrypoint_tailscale_default: false</span><span class="diff-line add">+traefik_entrypoint_web_default: &quot;{{ &#x27;web&#x27; if not (lookup(&#x27;role_var&#x27;, &#x27;_traefik_tailscale_enabled&#x27;, default=traefik_entrypoint_tailscale_default) | bool) else &#x27;tailscale-web&#x27; }}&quot;</span><span class="diff-line add">+traefik_entrypoint_web: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_traefik_entrypoint_web&#x27;, default=traefik_entrypoint_web_default) }}&quot;</span><span class="diff-line add">+traefik_entrypoint_websecure_default: &quot;{{ &#x27;websecure&#x27; if not (lookup(&#x27;role_var&#x27;, &#x27;_traefik_tailscale_enabled&#x27;, default=traefik_entrypoint_tailscale_default) | bool) else &#x27;tailscale-websecure&#x27; }}&quot;</span><span class="diff-line add">+traefik_entrypoint_websecure: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_traefik_entrypoint_websecure&#x27;, default=traefik_entrypoint_websecure_default) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> traefik_url: &quot;{{ &#x27;https://&#x27;</span><span class="diff-line del">-                 + (lookup(&#x27;vars&#x27;, traefik_role_var + &#x27;_web_subdomain&#x27;, default=lookup(&#x27;vars&#x27;, role_name + &#x27;_web_subdomain&#x27;, default=&#x27;&#x27;)) + &#x27;.&#x27;</span><span class="diff-line del">-                 + lookup(&#x27;vars&#x27;, traefik_role_var + &#x27;_web_domain&#x27;, default=lookup(&#x27;vars&#x27;, role_name + &#x27;_web_domain&#x27;, default=&#x27;&#x27;))</span><span class="diff-line del">-              if (lookup(&#x27;vars&#x27;, traefik_role_var + &#x27;_web_subdomain&#x27;, default=lookup(&#x27;vars&#x27;, role_name + &#x27;_web_subdomain&#x27;, default=&#x27;&#x27;)) | length &gt; 0)</span><span class="diff-line del">-              else lookup(&#x27;vars&#x27;, traefik_role_var + &#x27;_web_domain&#x27;, default=lookup(&#x27;vars&#x27;, role_name + &#x27;_web_domain&#x27;, default=&#x27;&#x27;))) }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-traefik_themepark_labels:</span><span class="diff-line del">-  - &#x27;{ &quot;traefik.http.middlewares.themepark-{{ traefik_router }}.plugin.themepark.app&quot;: &quot;{{ lookup(&quot;vars&quot;, traefik_role_var + &quot;_themepark_app&quot;, default=role_name) }}&quot; }&#x27;</span><span class="diff-line del">-  - &#x27;{ &quot;traefik.http.middlewares.themepark-{{ traefik_router }}.plugin.themepark.theme&quot;: &quot;{{ lookup(&quot;vars&quot;, traefik_role_var + &quot;_themepark_theme&quot;, default=lookup(&quot;vars&quot;, role_name + &quot;_themepark_theme&quot;, default=&quot;&quot;)) }}&quot; }&#x27;</span><span class="diff-line del">-  - &#x27;{ &quot;traefik.http.middlewares.themepark-{{ traefik_router }}.plugin.themepark.addons&quot;: &quot;{{ (lookup(&quot;vars&quot;, traefik_role_var + &quot;_themepark_addons&quot;, default=lookup(&quot;vars&quot;, role_name + &quot;_themepark_addons&quot;, default=&quot;&quot;)) | join(&quot;,&quot;))</span><span class="diff-line del">-                                                                                           if lookup(&quot;vars&quot;, traefik_role_var + &quot;_themepark_addons&quot;, default=lookup(&quot;vars&quot;, role_name + &quot;_themepark_addons&quot;, default=&quot;&quot;)) | length &gt; 0</span><span class="diff-line add">+                 + ((lookup(&#x27;role_var&#x27;, &#x27;_web_subdomain&#x27;, default=&#x27;&#x27;) + &#x27;.&#x27;</span><span class="diff-line add">+                 + lookup(&#x27;role_var&#x27;, &#x27;_web_domain&#x27;, default=&#x27;&#x27;))</span><span class="diff-line add">+              if (lookup(&#x27;role_var&#x27;, &#x27;_web_subdomain&#x27;, default=&#x27;&#x27;) | length &gt; 0)</span><span class="diff-line add">+              else lookup(&#x27;role_var&#x27;, &#x27;_web_domain&#x27;, default=&#x27;&#x27;)) }}&quot;</span><span class="diff-line add">+</span><span class="diff-line add">+traefik_themepark_labels_tmp:</span><span class="diff-line add">+  - &#x27;{ &quot;traefik.http.middlewares.themepark-{{ traefik_router }}.plugin.themepark.app&quot;: &quot;{{ lookup(&quot;role_var&quot;, &quot;_themepark_app&quot;, default=role_name) }}&quot; }&#x27;</span><span class="diff-line add">+  - &#x27;{ &quot;traefik.http.middlewares.themepark-{{ traefik_router }}.plugin.themepark.theme&quot;: &quot;{{ lookup(&quot;role_var&quot;, &quot;_themepark_theme&quot;, default=&quot;&quot;) }}&quot; }&#x27;</span><span class="diff-line add">+  - &#x27;{ &quot;traefik.http.middlewares.themepark-{{ traefik_router }}.plugin.themepark.addons&quot;: &quot;{{ (lookup(&quot;role_var&quot;, &quot;_themepark_addons&quot;, default=&quot;&quot;) | join(&quot;,&quot;))</span><span class="diff-line add">+                                                                                           if lookup(&quot;role_var&quot;, &quot;_themepark_addons&quot;, default=&quot;&quot;) | length &gt; 0</span><span class="diff-line context">                                                                                            else omit }}&quot; }&#x27;</span><span class="diff-line context"> </span><span class="diff-line add">+traefik_themepark_labels: &quot;{{ traefik_themepark_labels_tmp | map(&#x27;from_json&#x27;) | combine | dict2items | rejectattr(&#x27;value&#x27;, &#x27;equalto&#x27;, &#x27;&#x27;) | items2dict }}&quot;</span><span class="diff-line add">+</span><span class="diff-line context"> ################################</span><span class="diff-line context"> # Docker</span><span class="diff-line context"> ################################</span><span class="diff-line del">-</span><span class="diff-line del">-# Toggles pruning of dangling images after container creation.</span><span class="diff-line del">-docker_create_image_prune: true</span><span class="diff-line context"> </span><span class="diff-line context"> docker_volumes_downloads_nzbs: &quot;{{ [downloads_usenet_path + &#x27;:/downloads/nzbs&#x27;]</span><span class="diff-line context">                                 if nzbs_downloads_path_is_defined</span><span class="diff-line hunk">@@ -378,87 +397,105 @@</span><span class="diff-line context">   - &quot;/mnt:/mnt:rslave&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> docker_volumes_common: &quot;{{ docker_volumes_common_folders + docker_volumes_downloads_common</span><span class="diff-line del">-                        if (lookup(&#x27;vars&#x27;, traefik_role_var + &#x27;_docker_volumes_download&#x27;, default=true) | bool)</span><span class="diff-line add">+                        if (lookup(&#x27;role_var&#x27;, &#x27;_docker_volumes_download&#x27;, default=true) | bool)</span><span class="diff-line context">                         else docker_volumes_common_folders }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> docker_hosts_common: {}</span><span class="diff-line context"> </span><span class="diff-line context"> docker_labels_docker_depends_on_template:</span><span class="diff-line del">-  com.github.saltbox.depends_on: &quot;{{ lookup(&#x27;vars&#x27;, traefik_role_var + &#x27;_depends_on&#x27;, default=lookup(&#x27;vars&#x27;, role_name + &#x27;_depends_on&#x27;, default=docker_container_network_mode_lookup))</span><span class="diff-line add">+  com.github.saltbox.depends_on: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_depends_on&#x27;, default=docker_container_network_mode_lookup)</span><span class="diff-line context">                                   if docker_container_network_mode</span><span class="diff-line del">-                                  else lookup(&#x27;vars&#x27;, traefik_role_var + &#x27;_depends_on&#x27;, default=lookup(&#x27;vars&#x27;, role_name + &#x27;_depends_on&#x27;)) }}&quot;</span><span class="diff-line add">+                                  else lookup(&#x27;role_var&#x27;, &#x27;_depends_on&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> docker_labels_docker_depends_on_delay_template:</span><span class="diff-line del">-  com.github.saltbox.depends_on.delay: &quot;{{ lookup(&#x27;vars&#x27;, traefik_role_var + &#x27;_depends_on_delay&#x27;, default=lookup(&#x27;vars&#x27;, role_name + &#x27;_depends_on_delay&#x27;, default=&#x27;0&#x27;))</span><span class="diff-line add">+  com.github.saltbox.depends_on.delay: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_depends_on_delay&#x27;, default=&#x27;0&#x27;)</span><span class="diff-line context">                                         if docker_container_network_mode</span><span class="diff-line del">-                                        else lookup(&#x27;vars&#x27;, traefik_role_var + &#x27;_depends_on_delay&#x27;, default=lookup(&#x27;vars&#x27;, role_name + &#x27;_depends_on_delay&#x27;)) }}&quot;</span><span class="diff-line add">+                                        else lookup(&#x27;role_var&#x27;, &#x27;_depends_on_delay&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> docker_labels_docker_depends_on_healthchecks_template:</span><span class="diff-line del">-  com.github.saltbox.depends_on.healthchecks: &quot;{{ lookup(&#x27;vars&#x27;, traefik_role_var + &#x27;_depends_on_healthchecks&#x27;, default=lookup(&#x27;vars&#x27;, role_name + &#x27;_depends_on_healthchecks&#x27;, default=&#x27;true&#x27;))</span><span class="diff-line add">+  com.github.saltbox.depends_on.healthchecks: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_depends_on_healthchecks&#x27;, default=&#x27;true&#x27;)</span><span class="diff-line context">                                                if docker_container_network_mode</span><span class="diff-line del">-                                               else lookup(&#x27;vars&#x27;, traefik_role_var + &#x27;_depends_on_healthchecks&#x27;, default=lookup(&#x27;vars&#x27;, role_name + &#x27;_depends_on_healthchecks&#x27;)) }}&quot;</span><span class="diff-line add">+                                               else lookup(&#x27;role_var&#x27;, &#x27;_depends_on_healthchecks&#x27;) }}&quot;</span><span class="diff-line add">+</span><span class="diff-line add">+docker_labels_diun_enabled: true</span><span class="diff-line add">+docker_labels_autoheal_enabled: true</span><span class="diff-line add">+docker_labels_autoheal_timeout: &quot;10&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> docker_labels_diun_template:</span><span class="diff-line context">   diun.enable: &quot;true&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> docker_labels_autoheal_template:</span><span class="diff-line context">   autoheal: &quot;true&quot;</span><span class="diff-line del">-  autoheal.stop.timeout: &quot;{{ lookup(&#x27;vars&#x27;, role_name + &#x27;_docker_stop_timeout&#x27;, default=&#x27;10&#x27;) }}&quot;</span><span class="diff-line add">+  autoheal.stop.timeout: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_stop_timeout&#x27;, default=docker_labels_autoheal_timeout) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> docker_labels_custom_common: {}</span><span class="diff-line context"> </span><span class="diff-line context"> docker_labels_saltbox_tmp:</span><span class="diff-line context">   - com.github.saltbox.saltbox_managed: &quot;true&quot;</span><span class="diff-line del">-  - &quot;{{ docker_labels_diun_template if (lookup(&#x27;vars&#x27;, role_name + &#x27;_diun_enabled&#x27;, default=true) | bool) else omit }}&quot;</span><span class="diff-line del">-  - &quot;{{ docker_labels_autoheal_template if (lookup(&#x27;vars&#x27;, role_name + &#x27;_autoheal_enabled&#x27;, default=true) | bool) else omit }}&quot;</span><span class="diff-line del">-  - &quot;{{ docker_labels_docker_depends_on_template if ((lookup(&#x27;vars&#x27;, role_name + &#x27;_depends_on&#x27;, default=&#x27;&#x27;) | length &gt; 0) or docker_container_network_mode) else omit }}&quot;</span><span class="diff-line del">-  - &quot;{{ docker_labels_docker_depends_on_delay_template if ((lookup(&#x27;vars&#x27;, role_name + &#x27;_depends_on_delay&#x27;, default=&#x27;&#x27;) | length &gt; 0) or docker_container_network_mode) else omit }}&quot;</span><span class="diff-line del">-  - &quot;{{ docker_labels_docker_depends_on_healthchecks_template if ((lookup(&#x27;vars&#x27;, role_name + &#x27;_depends_on_healthchecks&#x27;, default=&#x27;&#x27;) | length &gt; 0) or docker_container_network_mode) else omit }}&quot;</span><span class="diff-line add">+  - com.github.saltbox.saltbox_controller: &quot;{{ &#x27;true&#x27; if (lookup(&#x27;role_var&#x27;, &#x27;_docker_controller&#x27;, default=true) | bool) else &#x27;false&#x27; }}&quot;</span><span class="diff-line add">+  - &quot;{{ docker_labels_diun_template if (lookup(&#x27;role_var&#x27;, &#x27;_diun_enabled&#x27;, default=docker_labels_diun_enabled) | bool) else omit }}&quot;</span><span class="diff-line add">+  - &quot;{{ docker_labels_autoheal_template if (lookup(&#x27;role_var&#x27;, &#x27;_autoheal_enabled&#x27;, default=docker_labels_autoheal_enabled) | bool) else omit }}&quot;</span><span class="diff-line add">+  - &quot;{{ docker_labels_docker_depends_on_template if ((lookup(&#x27;role_var&#x27;, &#x27;_depends_on&#x27;, default=&#x27;&#x27;) | length &gt; 0) or docker_container_network_mode) else omit }}&quot;</span><span class="diff-line add">+  - &quot;{{ docker_labels_docker_depends_on_delay_template if ((lookup(&#x27;role_var&#x27;, &#x27;_depends_on_delay&#x27;, default=&#x27;&#x27;) | length &gt; 0) or docker_container_network_mode) else omit }}&quot;</span><span class="diff-line add">+  - &quot;{{ docker_labels_docker_depends_on_healthchecks_template if ((lookup(&#x27;role_var&#x27;, &#x27;_depends_on_healthchecks&#x27;, default=&#x27;&#x27;) | length &gt; 0) or docker_container_network_mode) else omit }}&quot;</span><span class="diff-line context">   - &quot;{{ docker_labels_custom_common }}&quot;</span><span class="diff-line context"> </span><span class="diff-line del">-docker_container_network_mode: &quot;{{ &#x27;container:&#x27; in lookup(&#x27;vars&#x27;, traefik_role_var + &#x27;_docker_network_mode&#x27;, default=lookup(&#x27;vars&#x27;, role_name + &#x27;_docker_network_mode&#x27;, default=docker_networks_name_common)) }}&quot;</span><span class="diff-line del">-docker_container_network_mode_lookup: &quot;{{ lookup(&#x27;vars&#x27;, traefik_role_var + &#x27;_docker_network_mode&#x27;, default=lookup(&#x27;vars&#x27;, role_name + &#x27;_docker_network_mode&#x27;, default=docker_networks_name_common)) | split(&#x27;:&#x27;) | last }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-docker_labels_saltbox: &quot;{{ docker_labels_saltbox_tmp | reject(&#x27;equalto&#x27;, omit) | list }}&quot;</span><span class="diff-line add">+docker_labels_wildcard_template:</span><span class="diff-line add">+  - &#x27;{ &quot;traefik.http.routers.{{ traefik_router }}.tls.domains[0].main&quot;: &quot;{{ traefik_domain }}&quot; }&#x27;</span><span class="diff-line add">+  - &#x27;{ &quot;traefik.http.routers.{{ traefik_router }}.tls.domains[0].sans&quot;: &quot;{{ &quot;*.&quot; + traefik_domain }}&quot; }&#x27;</span><span class="diff-line add">+docker_labels_wildcard_dict: &quot;{{ (docker_labels_wildcard_template | map(&#x27;from_json&#x27;) | combine) if traefik_role_wildcard_enabled else {} }}&quot;</span><span class="diff-line add">+</span><span class="diff-line add">+docker_labels_wildcard_api_template:</span><span class="diff-line add">+  - &#x27;{ &quot;traefik.http.routers.{{ traefik_router }}-api.tls.domains[0].main&quot;: &quot;{{ traefik_domain }}&quot; }&#x27;</span><span class="diff-line add">+  - &#x27;{ &quot;traefik.http.routers.{{ traefik_router }}-api.tls.domains[0].sans&quot;: &quot;{{ &quot;*.&quot; + traefik_domain }}&quot; }&#x27;</span><span class="diff-line add">+docker_labels_wildcard_api_dict: &quot;{{ (docker_labels_wildcard_api_template | map(&#x27;from_json&#x27;) | combine) if traefik_role_wildcard_enabled else {} }}&quot;</span><span class="diff-line add">+</span><span class="diff-line add">+docker_container_network_mode: &quot;{{ &#x27;container:&#x27; in lookup(&#x27;role_var&#x27;, &#x27;_docker_network_mode&#x27;, default=docker_networks_name_common) }}&quot;</span><span class="diff-line add">+docker_container_network_mode_lookup: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_network_mode&#x27;, default=docker_networks_name_common) | split(&#x27;:&#x27;) | last }}&quot;</span><span class="diff-line add">+</span><span class="diff-line add">+docker_labels_saltbox: &quot;{{ docker_labels_saltbox_tmp | flatten | select(&#x27;mapping&#x27;) | combine }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> docker_labels_traefik_main:</span><span class="diff-line del">-  - traefik.enable: &quot;true&quot;</span><span class="diff-line add">+  - &#x27;{ &quot;traefik.enable&quot;: &quot;true&quot; }&#x27;</span><span class="diff-line context">   - &#x27;{ &quot;traefik.http.routers.{{ traefik_router }}-http.entrypoints&quot;: &quot;{{ traefik_entrypoint_web }}&quot; }&#x27;</span><span class="diff-line context">   - &#x27;{ &quot;traefik.http.routers.{{ traefik_router }}-http.service&quot;: &quot;{{ traefik_router }}-http&quot; }&#x27;</span><span class="diff-line context">   - &#x27;{ &quot;traefik.http.routers.{{ traefik_router }}-http.rule&quot;: &quot;{{ traefik_host_template }}&quot; }&#x27;</span><span class="diff-line context">   - &#x27;{ &quot;traefik.http.routers.{{ traefik_router }}-http.priority&quot;: &quot;20&quot; }&#x27;</span><span class="diff-line del">-  - &#x27;{ &quot;traefik.http.routers.{{ traefik_router }}-http.middlewares&quot;: &quot;{{ lookup(&quot;vars&quot;, traefik_role_var + &quot;_traefik_middleware_http&quot;, default=lookup(&quot;vars&quot;, role_name + &quot;_traefik_middleware_http&quot;, default=traefik_default_middleware_http)) }}&quot; }&#x27;</span><span class="diff-line add">+  - &#x27;{ &quot;traefik.http.routers.{{ traefik_router }}-http.middlewares&quot;: &quot;{{ lookup(&quot;role_var&quot;, &quot;_traefik_middleware_http&quot;, default=traefik_default_middleware_http) }}&quot; }&#x27;</span><span class="diff-line context">   - &#x27;{ &quot;traefik.http.routers.{{ traefik_router }}.entrypoints&quot;: &quot;{{ traefik_entrypoint_websecure }}&quot; }&#x27;</span><span class="diff-line context">   - &#x27;{ &quot;traefik.http.routers.{{ traefik_router }}.service&quot;: &quot;{{ traefik_router }}&quot; }&#x27;</span><span class="diff-line context">   - &#x27;{ &quot;traefik.http.routers.{{ traefik_router }}.rule&quot;: &quot;{{ traefik_host_template }}&quot; }&#x27;</span><span class="diff-line del">-  - &#x27;{ &quot;traefik.http.routers.{{ traefik_router }}.priority&quot;: &quot;{{ lookup(&quot;vars&quot;, traefik_role_var + &quot;_traefik_priority&quot;, default=lookup(&quot;vars&quot;, role_name + &quot;_traefik_priority&quot;, default=&quot;20&quot;)) }}&quot; }&#x27;</span><span class="diff-line del">-  - &#x27;{ &quot;traefik.http.routers.{{ traefik_router }}.tls.certresolver&quot;: &quot;{{ lookup(&quot;vars&quot;, traefik_role_var + &quot;_traefik_certresolver&quot;, default=lookup(&quot;vars&quot;, role_name + &quot;_traefik_certresolver&quot;, default=traefik_default_certresolver)) }}&quot; }&#x27;</span><span class="diff-line add">+  - &#x27;{ &quot;traefik.http.routers.{{ traefik_router }}.priority&quot;: &quot;{{ lookup(&quot;role_var&quot;, &quot;_traefik_priority&quot;, default=&quot;20&quot;) }}&quot; }&#x27;</span><span class="diff-line add">+  - &#x27;{ &quot;traefik.http.routers.{{ traefik_router }}.tls.certresolver&quot;: &quot;{{ lookup(&quot;role_var&quot;, &quot;_traefik_certresolver&quot;, default=traefik_default_certresolver) }}&quot; }&#x27;</span><span class="diff-line context">   - &#x27;{ &quot;traefik.http.routers.{{ traefik_router }}.tls.options&quot;: &quot;securetls@file&quot; }&#x27;</span><span class="diff-line context">   - &#x27;{ &quot;traefik.http.routers.{{ traefik_router }}.middlewares&quot;: &quot;{{ traefik_middleware }}&quot; }&#x27;</span><span class="diff-line del">-  - &#x27;{ &quot;traefik.http.services.{{ traefik_router }}-http.loadbalancer.server.port&quot;: &quot;{{ lookup(&quot;vars&quot;, traefik_role_var + &quot;_web_http_port&quot;, default=lookup(&quot;vars&quot;, role_name + &quot;_web_http_port&quot;, default=traefik_loadbalancer_port)) }}&quot; }&#x27;</span><span class="diff-line del">-  - &#x27;{ &quot;traefik.http.services.{{ traefik_router }}-http.loadbalancer.server.scheme&quot;: &quot;{{ lookup(&quot;vars&quot;, traefik_role_var + &quot;_web_http_scheme&quot;, default=lookup(&quot;vars&quot;, role_name + &quot;_web_http_scheme&quot;, default=traefik_loadbalancer_scheme)) }}&quot; }&#x27;</span><span class="diff-line del">-  - &#x27;{ &quot;traefik.http.services.{{ traefik_router }}-http.loadbalancer.serverstransport&quot;: &quot;{{ lookup(&quot;vars&quot;, traefik_role_var + &quot;_web_http_serverstransport&quot;, default=lookup(&quot;vars&quot;, role_name + &quot;_web_http_serverstransport&quot;, default=omit)) }}&quot; }&#x27;</span><span class="diff-line add">+  - &#x27;{ &quot;traefik.http.services.{{ traefik_router }}-http.loadbalancer.server.port&quot;: &quot;{{ lookup(&quot;role_var&quot;, &quot;_web_http_port&quot;, default=traefik_loadbalancer_port) }}&quot; }&#x27;</span><span class="diff-line add">+  - &#x27;{ &quot;traefik.http.services.{{ traefik_router }}-http.loadbalancer.server.scheme&quot;: &quot;{{ lookup(&quot;role_var&quot;, &quot;_web_http_scheme&quot;, default=traefik_loadbalancer_scheme) }}&quot; }&#x27;</span><span class="diff-line add">+  - &#x27;{ &quot;traefik.http.services.{{ traefik_router }}-http.loadbalancer.serverstransport&quot;: &quot;{{ lookup(&quot;role_var&quot;, &quot;_web_http_serverstransport&quot;, default=omit) }}&quot; }&#x27;</span><span class="diff-line context">   - &#x27;{ &quot;traefik.http.services.{{ traefik_router }}.loadbalancer.server.port&quot;: &quot;{{ traefik_loadbalancer_port }}&quot; }&#x27;</span><span class="diff-line context">   - &#x27;{ &quot;traefik.http.services.{{ traefik_router }}.loadbalancer.server.scheme&quot;: &quot;{{ traefik_loadbalancer_scheme }}&quot; }&#x27;</span><span class="diff-line del">-  - &#x27;{ &quot;traefik.http.services.{{ traefik_router }}.loadbalancer.serverstransport&quot;: &quot;{{ lookup(&quot;vars&quot;, traefik_role_var + &quot;_web_serverstransport&quot;, default=lookup(&quot;vars&quot;, role_name + &quot;_web_serverstransport&quot;, default=omit)) }}&quot; }&#x27;</span><span class="diff-line add">+  - &#x27;{ &quot;traefik.http.services.{{ traefik_router }}.loadbalancer.serverstransport&quot;: &quot;{{ lookup(&quot;role_var&quot;, &quot;_web_serverstransport&quot;, default=omit) }}&quot; }&#x27;</span><span class="diff-line context"> </span><span class="diff-line context"> docker_labels_traefik_api:</span><span class="diff-line context">   - &#x27;{ &quot;traefik.http.routers.{{ traefik_router }}-api-http.entrypoints&quot;: &quot;{{ traefik_entrypoint_web }}&quot; }&#x27;</span><span class="diff-line context">   - &#x27;{ &quot;traefik.http.routers.{{ traefik_router }}-api-http.service&quot;: &quot;{{ traefik_router }}&quot; }&#x27;</span><span class="diff-line del">-  - &#x27;{ &quot;traefik.http.routers.{{ traefik_router }}-api-http.rule&quot;: &quot;{{ traefik_host_template }} &amp;&amp; ({{ lookup(&quot;vars&quot;, traefik_role_var + &quot;_traefik_api_endpoint&quot;, default=lookup(&quot;vars&quot;, role_name + &quot;_traefik_api_endpoint&quot;, default=omit)) }})&quot; }&#x27;</span><span class="diff-line add">+  - &#x27;{ &quot;traefik.http.routers.{{ traefik_router }}-api-http.rule&quot;: &quot;{{ traefik_host_template }} &amp;&amp; ({{ lookup(&quot;role_var&quot;, &quot;_traefik_api_endpoint&quot;, default=omit) }})&quot; }&#x27;</span><span class="diff-line context">   - &#x27;{ &quot;traefik.http.routers.{{ traefik_router }}-api-http.priority&quot;: &quot;30&quot; }&#x27;</span><span class="diff-line del">-  - &#x27;{ &quot;traefik.http.routers.{{ traefik_router }}-api-http.middlewares&quot;: &quot;{{ lookup(&quot;vars&quot;, traefik_role_var + &quot;_traefik_api_middleware_http&quot;, default=lookup(&quot;vars&quot;, role_name + &quot;_traefik_api_middleware_http&quot;, default=traefik_default_middleware_http_api)) }}&quot; }&#x27;</span><span class="diff-line add">+  - &#x27;{ &quot;traefik.http.routers.{{ traefik_router }}-api-http.middlewares&quot;: &quot;{{ lookup(&quot;role_var&quot;, &quot;_traefik_api_middleware_http&quot;, default=traefik_default_middleware_http_api) }}&quot; }&#x27;</span><span class="diff-line context">   - &#x27;{ &quot;traefik.http.routers.{{ traefik_router }}-api.entrypoints&quot;: &quot;{{ traefik_entrypoint_websecure }}&quot; }&#x27;</span><span class="diff-line context">   - &#x27;{ &quot;traefik.http.routers.{{ traefik_router }}-api.service&quot;: &quot;{{ traefik_router }}&quot; }&#x27;</span><span class="diff-line del">-  - &#x27;{ &quot;traefik.http.routers.{{ traefik_router }}-api.rule&quot;: &quot;{{ traefik_host_template }} &amp;&amp; ({{ lookup(&quot;vars&quot;, traefik_role_var + &quot;_traefik_api_endpoint&quot;, default=lookup(&quot;vars&quot;, role_name + &quot;_traefik_api_endpoint&quot;, default=omit)) }})&quot; }&#x27;</span><span class="diff-line add">+  - &#x27;{ &quot;traefik.http.routers.{{ traefik_router }}-api.rule&quot;: &quot;{{ traefik_host_template }} &amp;&amp; ({{ lookup(&quot;role_var&quot;, &quot;_traefik_api_endpoint&quot;, default=omit) }})&quot; }&#x27;</span><span class="diff-line context">   - &#x27;{ &quot;traefik.http.routers.{{ traefik_router }}-api.priority&quot;: &quot;30&quot; }&#x27;</span><span class="diff-line del">-  - &#x27;{ &quot;traefik.http.routers.{{ traefik_router }}-api.tls.certresolver&quot;: &quot;{{ lookup(&quot;vars&quot;, traefik_role_var + &quot;_traefik_certresolver&quot;, default=lookup(&quot;vars&quot;, role_name + &quot;_traefik_certresolver&quot;, default=traefik_default_certresolver)) }}&quot; }&#x27;</span><span class="diff-line add">+  - &#x27;{ &quot;traefik.http.routers.{{ traefik_router }}-api.tls.certresolver&quot;: &quot;{{ lookup(&quot;role_var&quot;, &quot;_traefik_certresolver&quot;, default=traefik_default_certresolver) }}&quot; }&#x27;</span><span class="diff-line context">   - &#x27;{ &quot;traefik.http.routers.{{ traefik_router }}-api.tls.options&quot;: &quot;securetls@file&quot; }&#x27;</span><span class="diff-line del">-  - &#x27;{ &quot;traefik.http.routers.{{ traefik_router }}-api.middlewares&quot;: &quot;{{ lookup(&quot;vars&quot;, traefik_role_var + &quot;_traefik_api_middleware&quot;, default=lookup(&quot;vars&quot;, role_name + &quot;_traefik_api_middleware&quot;, default=traefik_default_middleware_api)) }}&quot; }&#x27;</span><span class="diff-line del">-</span><span class="diff-line del">-docker_labels_traefik: &quot;{{ docker_labels_traefik_main | combine(docker_labels_traefik_api)</span><span class="diff-line add">+  - &#x27;{ &quot;traefik.http.routers.{{ traefik_router }}-api.middlewares&quot;: &quot;{{ lookup(&quot;role_var&quot;, &quot;_traefik_api_middleware&quot;, default=traefik_default_middleware_api) }}&quot; }&#x27;</span><span class="diff-line add">+</span><span class="diff-line add">+docker_labels_traefik_main_dict: &quot;{{ docker_labels_traefik_main | map(&#x27;from_json&#x27;) | combine | dict2items | rejectattr(&#x27;value&#x27;, &#x27;equalto&#x27;, &#x27;&#x27;) | items2dict }}&quot;</span><span class="diff-line add">+docker_labels_traefik_api_dict: &quot;{{ docker_labels_traefik_api | map(&#x27;from_json&#x27;) | combine | dict2items | rejectattr(&#x27;value&#x27;, &#x27;equalto&#x27;, &#x27;&#x27;) | items2dict }}&quot;</span><span class="diff-line add">+</span><span class="diff-line add">+docker_labels_traefik: &quot;{{ (docker_labels_traefik_main_dict | combine(docker_labels_traefik_api_dict, docker_labels_wildcard_dict, docker_labels_wildcard_api_dict)</span><span class="diff-line context">                         if traefik_role_api_enabled</span><span class="diff-line del">-                        else docker_labels_traefik_main }}&quot;</span><span class="diff-line add">+                        else docker_labels_traefik_main_dict) | combine(docker_labels_wildcard_dict) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> docker_labels_common: &quot;{{ docker_labels_saltbox | combine(docker_labels_traefik)</span><span class="diff-line context">                        if traefik_role_enabled</span><span class="diff-line hunk">@@ -466,8 +503,8 @@</span><span class="diff-line context"> </span><span class="diff-line context"> docker_networks_name_common: saltbox</span><span class="diff-line context"> </span><span class="diff-line del">-docker_networks_alias_template: &quot;{{ (lookup(&#x27;vars&#x27;, role_name + &#x27;_docker_networks_alias&#x27;) | split(&#x27; &#x27;))</span><span class="diff-line del">-                                    + (lookup(&#x27;vars&#x27;, lookup(&#x27;vars&#x27;, role_name + &#x27;_name&#x27;, default=role_name) + &#x27;_docker_networks_alias_custom&#x27;, default=[])) }}&quot;</span><span class="diff-line add">+docker_networks_alias_template: &quot;{{ [lookup(&#x27;role_var&#x27;, &#x27;_docker_networks_alias&#x27;)]</span><span class="diff-line add">+                                    + lookup(&#x27;role_var&#x27;, &#x27;_docker_networks_alias_custom&#x27;, default=[]) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> docker_networks_common:</span><span class="diff-line context">   - name: &quot;{{ docker_networks_name_common }}&quot;</span><span class="diff-line hunk">@@ -486,14 +523,14 @@</span><span class="diff-line context"> docker_log_driver_json: &quot;json-file&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> docker_log_driver: &quot;{{ docker_log_driver_json</span><span class="diff-line del">-                    if docker.json_driver</span><span class="diff-line add">+                    if (docker.json_driver | bool)</span><span class="diff-line context">                     else &#x27;default&#x27; }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> docker_log_options_json:</span><span class="diff-line context">   tag: &quot;{% raw %}&#x27;{{.ImageName}}|{{.Name}}|{{.ImageFullID}}|{{.FullID}}&#x27;{% endraw %}&quot; # noqa jinja[spacing]</span><span class="diff-line context"> </span><span class="diff-line context"> docker_log_options: &quot;{{ docker_log_options_json</span><span class="diff-line del">-                     if docker.json_driver</span><span class="diff-line add">+                     if (docker.json_driver | bool)</span><span class="diff-line context">                      else &#x27;default&#x27; }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> docker_network_container_health_delay: 5</span><span class="diff-line hunk">@@ -511,8 +548,11 @@</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line context"> reboot_is_necessary: false</span><span class="diff-line del">-skip_dns: &quot;{{ not (dns.ipv4 or dns.ipv6) }}&quot;</span><span class="diff-line del">-role_dns_enabled: &quot;{{ lookup(&#x27;vars&#x27;, role_name + &#x27;_dns_enabled&#x27;, default=true) | bool }}&quot;</span><span class="diff-line add">+dns_proxied: &quot;{{ dns.proxied | bool }}&quot;</span><span class="diff-line add">+skip_dns: &quot;{{ not (dns_ipv4_enabled or dns_ipv6_enabled) }}&quot;</span><span class="diff-line add">+role_dns_enabled: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_dns_enabled&#x27;, default=true) | bool }}&quot;</span><span class="diff-line add">+dns_ipv4_enabled: &quot;{{ dns.ipv4 | bool }}&quot;</span><span class="diff-line add">+dns_ipv6_enabled: &quot;{{ dns.ipv6 | bool }}&quot;</span><span class="diff-line context"> docker_legacy_volume: false</span><span class="diff-line context"> ansible_retry_count: &quot;2&quot;</span><span class="diff-line context"> ansible_retry_count_ci: &quot;5&quot;</span><span class="diff-line hunk">@@ -524,15 +564,23 @@</span><span class="diff-line context"> backup_rclone_transfers: 4</span><span class="diff-line context"> backup_rclone_drive_chunk_size: 128M</span><span class="diff-line context"> backup_rclone_dropbox_chunk_size: 128M</span><span class="diff-line add">+backup_local_enabled: &quot;{{ backup.local.enable | bool }}&quot;</span><span class="diff-line add">+backup_rclone_enabled: &quot;{{ backup.rclone.enable | bool }}&quot;</span><span class="diff-line add">+backup_rsync_enabled: &quot;{{ backup.rsync.enable | bool }}&quot;</span><span class="diff-line add">+backup_snapshot_enabled: &quot;{{ backup.misc.snapshot | bool }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> reverse_proxy_apps:</span><span class="diff-line context">   - traefik</span><span class="diff-line context"> </span><span class="diff-line del">-torrent_apps:</span><span class="diff-line del">-  - deluge</span><span class="diff-line del">-  - delugevpn</span><span class="diff-line del">-  - qbittorrent</span><span class="diff-line del">-  - qbittorrentvpn</span><span class="diff-line del">-  - rutorrent</span><span class="diff-line del">-  - transmission</span><span class="diff-line del">-  - transmissionvpn</span><span class="diff-line add">+torrent_apps_saltbox:</span><span class="diff-line add">+  - &quot;{{ deluge_instances | default(&#x27;deluge&#x27;) }}&quot;</span><span class="diff-line add">+  - &quot;{{ qbittorrent_instances | default(&#x27;qbittorrent&#x27;) }}&quot;</span><span class="diff-line add">+  - &quot;{{ rutorrent_name | default(&#x27;rutorrent&#x27;) }}&quot;</span><span class="diff-line add">+</span><span class="diff-line add">+torrent_apps_sandbox:</span><span class="diff-line add">+  - &quot;{{ delugevpn_name | default(&#x27;delugevpn&#x27;) }}&quot;</span><span class="diff-line add">+  - &quot;{{ qbittorrentvpn_instances | default(&#x27;qbittorrentvpn&#x27;) }}&quot;</span><span class="diff-line add">+  - &quot;{{ transmission_instances | default(&#x27;transmission&#x27;) }}&quot;</span><span class="diff-line add">+  - &quot;{{ transmissionvpn_name | default(&#x27;transmissionvpn&#x27;) }}&quot;</span><span class="diff-line add">+</span><span class="diff-line add">+torrent_apps: &quot;{{ (torrent_apps_saltbox + torrent_apps_sandbox) | flatten | unique | sort }}&quot;</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-66">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>library/find_open_port.py</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -2,7 +2,6 @@</span><span class="diff-line context"> </span><span class="diff-line context"> from ansible.module_utils.basic import AnsibleModule</span><span class="diff-line context"> import subprocess</span><span class="diff-line del">-import json</span><span class="diff-line context"> </span><span class="diff-line context"> DOCUMENTATION = &quot;&quot;&quot;</span><span class="diff-line context"> ---</span><span class="diff-line hunk">@@ -36,6 +35,10 @@</span><span class="diff-line context"> </span><span class="diff-line context"> def find_port(module, low_bound, high_bound, protocol):</span><span class="diff-line context">     try:</span><span class="diff-line add">+        if low_bound &lt; 1:</span><span class="diff-line add">+            module.fail_json(msg=&quot;Low bound must be at least 1&quot;)</span><span class="diff-line add">+        if high_bound &gt; 65535:</span><span class="diff-line add">+            module.fail_json(msg=&quot;High bound must be at most 65535&quot;)</span><span class="diff-line context">         if high_bound &lt;= low_bound:</span><span class="diff-line context">             module.fail_json(msg=&quot;High bound must be higher than low bound&quot;)</span><span class="diff-line context"> </span><span class="diff-line hunk">@@ -46,14 +49,17 @@</span><span class="diff-line context">         if protocol == &#x27;tcp&#x27;:</span><span class="diff-line context">             cmd = &quot;ss -Htan&quot;</span><span class="diff-line context">             awk_cmd = &quot;awk &#x27;{print $4}&#x27;&quot;</span><span class="diff-line add">+            state_filter = &quot;grep LISTEN&quot;</span><span class="diff-line context">         elif protocol == &#x27;udp&#x27;:</span><span class="diff-line context">             cmd = &quot;ss -Huan&quot;</span><span class="diff-line context">             awk_cmd = &quot;awk &#x27;{print $4}&#x27;&quot;</span><span class="diff-line add">+            state_filter = &quot;grep UNCONN&quot;</span><span class="diff-line context">         else:  # both</span><span class="diff-line context">             cmd = &quot;ss -Htuan&quot;</span><span class="diff-line context">             awk_cmd = &quot;awk &#x27;{print $5}&#x27;&quot;</span><span class="diff-line add">+            state_filter = &quot;grep -E &#x27;LISTEN|UNCONN&#x27;&quot;</span><span class="diff-line context"> </span><span class="diff-line del">-        cmd += &quot; | grep LISTEN | &quot; + awk_cmd + &quot; | grep -Eo &#x27;[0-9]+$&#x27; | sort -u&quot;</span><span class="diff-line add">+        cmd += &quot; | &quot; + state_filter + &quot; | &quot; + awk_cmd + &quot; | grep -Eo &#x27;[0-9]+$&#x27; | sort -u&quot;</span><span class="diff-line context"> </span><span class="diff-line context">         # Run command to get ports in use</span><span class="diff-line context">         ports_in_use = subprocess.check_output(cmd, shell=True)</span><span class="diff-line hunk">@@ -67,10 +73,12 @@</span><span class="diff-line context">             candidate = min(available_ports)</span><span class="diff-line context">             return False, {&quot;port&quot;: candidate}</span><span class="diff-line context">         else:</span><span class="diff-line del">-            return False, {&quot;msg&quot;: &quot;No available port found in the specified range&quot;}</span><span class="diff-line add">+            return True, {&quot;msg&quot;: &quot;No available port found in the specified range&quot;}</span><span class="diff-line context"> </span><span class="diff-line del">-    except Exception as e:</span><span class="diff-line del">-        module.fail_json(msg=str(e))</span><span class="diff-line add">+    except subprocess.CalledProcessError as e:</span><span class="diff-line add">+        module.fail_json(msg=f&quot;Failed to execute ss command: {e}&quot;)</span><span class="diff-line add">+    except ValueError as e:</span><span class="diff-line add">+        module.fail_json(msg=f&quot;Failed to parse port numbers: {e}&quot;)</span><span class="diff-line context"> </span><span class="diff-line context"> def main():</span><span class="diff-line context">     module = AnsibleModule(</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-67">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>library/migrate_folder.py</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -105,12 +105,13 @@</span><span class="diff-line context"> import grp</span><span class="diff-line context"> import stat</span><span class="diff-line context"> import traceback</span><span class="diff-line add">+from typing import Any, Optional, Tuple</span><span class="diff-line context"> </span><span class="diff-line context"> from ansible.module_utils.basic import AnsibleModule</span><span class="diff-line del">-from ansible.module_utils.pycompat24 import get_exception</span><span class="diff-line add">+</span><span class="diff-line context"> </span><span class="diff-line context"> # Helper to safely get UID/GID</span><span class="diff-line del">-def get_id_info(module, owner=None, group=None):</span><span class="diff-line add">+def get_id_info(module: AnsibleModule, owner: Optional[str] = None, group: Optional[str] = None) -&gt; Tuple[int, int]:</span><span class="diff-line context">     uid = -1</span><span class="diff-line context">     gid = -1</span><span class="diff-line context">     if owner is not None:</span><span class="diff-line hunk">@@ -126,21 +127,23 @@</span><span class="diff-line context">     return uid, gid</span><span class="diff-line context"> </span><span class="diff-line context"> # Helper to validate and convert mode</span><span class="diff-line del">-def validate_mode(module, mode_str):</span><span class="diff-line add">+def validate_mode(module: AnsibleModule, mode_str: Optional[str]) -&gt; Optional[int]:</span><span class="diff-line context">     if mode_str is None:</span><span class="diff-line context">         return None</span><span class="diff-line context">     try:</span><span class="diff-line context">         # Ensure it&#x27;s treated as octal</span><span class="diff-line del">-        if not isinstance(mode_str, str):</span><span class="diff-line del">-             mode_str = str(mode_str)</span><span class="diff-line del">-        if not mode_str.startswith(&#x27;0&#x27;):</span><span class="diff-line del">-             mode_str = &#x27;0&#x27; + mode_str # Ensure octal interpretation for int()</span><span class="diff-line del">-        return int(mode_str, 8)</span><span class="diff-line add">+        mode_value = mode_str</span><span class="diff-line add">+        if not isinstance(mode_value, str):</span><span class="diff-line add">+            mode_value = str(mode_value)</span><span class="diff-line add">+        if not mode_value.startswith(&#x27;0&#x27;):</span><span class="diff-line add">+            mode_value = &#x27;0&#x27; + mode_value  # Ensure octal interpretation for int()</span><span class="diff-line add">+        return int(mode_value, 8)</span><span class="diff-line context">     except (ValueError, TypeError):</span><span class="diff-line context">         module.fail_json(msg=f&quot;Invalid mode &#x27;{mode_str}&#x27; specified. Must be an octal number string (e.g., &#x27;0775&#x27;).&quot;)</span><span class="diff-line del">-</span><span class="diff-line del">-</span><span class="diff-line del">-def run_module():</span><span class="diff-line add">+        return None  # This line is unreachable but satisfies type checker</span><span class="diff-line add">+</span><span class="diff-line add">+</span><span class="diff-line add">+def run_module() -&gt; None:</span><span class="diff-line context">     module_args = dict(</span><span class="diff-line context">         legacy_path=dict(type=&#x27;str&#x27;, required=True),</span><span class="diff-line context">         new_path=dict(type=&#x27;str&#x27;, required=True),</span><span class="diff-line hunk">@@ -150,7 +153,7 @@</span><span class="diff-line context">         recurse=dict(type=&#x27;bool&#x27;, required=False, default=False)</span><span class="diff-line context">     )</span><span class="diff-line context"> </span><span class="diff-line del">-    result = dict(</span><span class="diff-line add">+    result: dict[str, Any] = dict(</span><span class="diff-line context">         changed=False,</span><span class="diff-line context">         moved=False,</span><span class="diff-line context">         created=False,</span><span class="diff-line hunk">@@ -181,18 +184,15 @@</span><span class="diff-line context">     # Check path statuses and types</span><span class="diff-line context">     legacy_exists = os.path.lexists(legacy_path)</span><span class="diff-line context">     new_exists = os.path.lexists(new_path)</span><span class="diff-line del">-    legacy_is_dir = False</span><span class="diff-line del">-    new_is_dir = False</span><span class="diff-line del">-</span><span class="diff-line del">-    if legacy_exists:</span><span class="diff-line del">-        if not os.path.isdir(legacy_path):</span><span class="diff-line del">-             module.fail_json(msg=f&quot;Legacy path &#x27;{legacy_path}&#x27; exists but is not a directory.&quot;)</span><span class="diff-line del">-        legacy_is_dir = True</span><span class="diff-line del">-</span><span class="diff-line del">-    if new_exists:</span><span class="diff-line del">-        if not os.path.isdir(new_path):</span><span class="diff-line del">-             module.fail_json(msg=f&quot;New path &#x27;{new_path}&#x27; exists but is not a directory.&quot;)</span><span class="diff-line del">-        new_is_dir = True</span><span class="diff-line add">+</span><span class="diff-line add">+    if legacy_exists and not os.path.isdir(legacy_path):</span><span class="diff-line add">+        module.fail_json(msg=f&quot;Legacy path &#x27;{legacy_path}&#x27; exists but is not a directory.&quot;)</span><span class="diff-line add">+</span><span class="diff-line add">+    if new_exists and not os.path.isdir(new_path):</span><span class="diff-line add">+        module.fail_json(msg=f&quot;New path &#x27;{new_path}&#x27; exists but is not a directory.&quot;)</span><span class="diff-line add">+</span><span class="diff-line add">+    legacy_is_dir = legacy_exists and os.path.isdir(legacy_path)</span><span class="diff-line add">+    new_is_dir = new_exists and os.path.isdir(new_path)</span><span class="diff-line context"> </span><span class="diff-line context">     # --- Check Mode Early Exit ---</span><span class="diff-line context">     if module.check_mode:</span><span class="diff-line hunk">@@ -241,20 +241,19 @@</span><span class="diff-line context">         try:</span><span class="diff-line context">             # Ensure all parent directories exist before moving</span><span class="diff-line context">             parent_dir = os.path.dirname(new_path)</span><span class="diff-line del">-            created_dirs = []</span><span class="diff-line del">-            </span><span class="diff-line add">+</span><span class="diff-line context">             if parent_dir and not os.path.exists(parent_dir):</span><span class="diff-line context">                 # Find which directories we&#x27;ll need to create</span><span class="diff-line context">                 path_to_create = parent_dir</span><span class="diff-line del">-                dirs_to_create = []</span><span class="diff-line del">-                </span><span class="diff-line add">+                dirs_to_create: list[str] = []</span><span class="diff-line add">+</span><span class="diff-line context">                 while path_to_create and path_to_create != &#x27;/&#x27; and path_to_create != &#x27;&#x27; and not os.path.exists(path_to_create):</span><span class="diff-line context">                     dirs_to_create.append(path_to_create)</span><span class="diff-line context">                     path_to_create = os.path.dirname(path_to_create)</span><span class="diff-line del">-                </span><span class="diff-line add">+</span><span class="diff-line context">                 # Create parent directories</span><span class="diff-line context">                 os.makedirs(parent_dir, exist_ok=True)</span><span class="diff-line del">-                </span><span class="diff-line add">+</span><span class="diff-line context">                 # Apply ownership and permissions only to directories we just created</span><span class="diff-line context">                 if (owner is not None or group is not None or mode_int is not None) and dirs_to_create:</span><span class="diff-line context">                     for created_dir in dirs_to_create:</span><span class="diff-line hunk">@@ -262,7 +261,7 @@</span><span class="diff-line context">                             try:</span><span class="diff-line context">                                 if owner is not None or group is not None:</span><span class="diff-line context">                                     current_stat = os.stat(created_dir)</span><span class="diff-line del">-                                    os.chown(created_dir, </span><span class="diff-line add">+                                    os.chown(created_dir,</span><span class="diff-line context">                                             uid if uid != -1 else current_stat.st_uid,</span><span class="diff-line context">                                             gid if gid != -1 else current_stat.st_gid)</span><span class="diff-line context">                                 if mode_int is not None:</span><span class="diff-line hunk">@@ -349,7 +348,7 @@</span><span class="diff-line context">     # --- Exit ---</span><span class="diff-line context">     module.exit_json(**result)</span><span class="diff-line context"> </span><span class="diff-line del">-def main():</span><span class="diff-line add">+def main() -&gt; None:</span><span class="diff-line context">     run_module()</span><span class="diff-line context"> </span><span class="diff-line context"> if __name__ == &#x27;__main__&#x27;:</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-68">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>library/qbittorrent_passwd.py</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -1,40 +1,123 @@</span><span class="diff-line context"> #!/usr/bin/python</span><span class="diff-line del">-from ansible.module_utils.basic import AnsibleModule</span><span class="diff-line add">+# -*- coding: utf-8 -*-</span><span class="diff-line add">+</span><span class="diff-line add">+from __future__ import absolute_import, division, print_function</span><span class="diff-line add">+__metaclass__ = type</span><span class="diff-line add">+</span><span class="diff-line add">+DOCUMENTATION = r&#x27;&#x27;&#x27;</span><span class="diff-line add">+---</span><span class="diff-line add">+module: qbittorrent_password_hash</span><span class="diff-line add">+short_description: Generates a password hash compatible with qBittorrent.</span><span class="diff-line add">+description:</span><span class="diff-line add">+    - Takes a plain text password and generates a salted hash using the PBKDF2-HMAC-SHA512 algorithm.</span><span class="diff-line add">+    - Uses 100,000 iterations and a 16-byte random salt, matching qBittorrent&#x27;s expected format.</span><span class="diff-line add">+    - The output format is &quot;@ByteArray(SALT_BASE64:HASH_BASE64)&quot;.</span><span class="diff-line add">+    - This module is useful for generating password hashes to be placed in qBittorrent configuration files non-interactively.</span><span class="diff-line add">+    - The input password parameter has `no_log=True` set for security.</span><span class="diff-line add">+options:</span><span class="diff-line add">+    password:</span><span class="diff-line add">+        description: The plain text password to hash.</span><span class="diff-line add">+        type: str</span><span class="diff-line add">+        required: true</span><span class="diff-line add">+        no_log: true</span><span class="diff-line add">+author:</span><span class="diff-line add">+    - Salty</span><span class="diff-line add">+&#x27;&#x27;&#x27;</span><span class="diff-line add">+</span><span class="diff-line add">+EXAMPLES = r&#x27;&#x27;&#x27;</span><span class="diff-line add">+- name: Generate qBittorrent password hash</span><span class="diff-line add">+  qbittorrent_passwd:</span><span class="diff-line add">+    password: &quot;supersecretpassword&quot;</span><span class="diff-line add">+  register: qbit_hash_result</span><span class="diff-line add">+</span><span class="diff-line add">+- name: Display the generated hash</span><span class="diff-line add">+  debug:</span><span class="diff-line add">+    var: qbit_hash_result.hash</span><span class="diff-line add">+&#x27;&#x27;&#x27;</span><span class="diff-line add">+</span><span class="diff-line add">+RETURN = r&#x27;&#x27;&#x27;</span><span class="diff-line add">+hash:</span><span class="diff-line add">+    description: The generated qBittorrent-compatible password hash string.</span><span class="diff-line add">+    type: str</span><span class="diff-line add">+    returned: on success</span><span class="diff-line add">+    sample: &quot;@ByteArray(aBcDeFgHiJkLmNoPqRsTuVw==:xYz123AbCdEfGhIjKlMnOpQrStUvWxYz12/abc+def=)&quot;</span><span class="diff-line add">+changed:</span><span class="diff-line add">+    description: Indicates if any state was changed. Always false for this module.</span><span class="diff-line add">+    type: bool</span><span class="diff-line add">+    returned: always</span><span class="diff-line add">+    sample: false</span><span class="diff-line add">+&#x27;&#x27;&#x27;</span><span class="diff-line add">+</span><span class="diff-line context"> import base64</span><span class="diff-line context"> import hashlib</span><span class="diff-line context"> import os</span><span class="diff-line add">+from typing import Any</span><span class="diff-line add">+from ansible.module_utils.basic import AnsibleModule</span><span class="diff-line context"> </span><span class="diff-line del">-def qbittorrent_passwd(plain_passwd):</span><span class="diff-line add">+</span><span class="diff-line add">+def generate_qbittorrent_hash(plain_passwd: str) -&gt; str:</span><span class="diff-line add">+    &quot;&quot;&quot;</span><span class="diff-line add">+    Generates a qBittorrent compatible password hash (PBKDF2-HMAC-SHA512).</span><span class="diff-line add">+    &quot;&quot;&quot;</span><span class="diff-line add">+    ITERATIONS = 100_000  # Standard iteration count for qBittorrent</span><span class="diff-line add">+    SALT_SIZE = 16        # Standard salt size (bytes)</span><span class="diff-line add">+</span><span class="diff-line context">     try:</span><span class="diff-line del">-        ITERATIONS = 100_000</span><span class="diff-line del">-        SALT_SIZE = 16</span><span class="diff-line add">+        salt = os.urandom(SALT_SIZE)</span><span class="diff-line add">+        # Ensure password is bytes for hashing</span><span class="diff-line add">+        password_bytes = plain_passwd.encode()</span><span class="diff-line add">+        </span><span class="diff-line add">+        # Generate the hash</span><span class="diff-line add">+        derived_key = hashlib.pbkdf2_hmac(</span><span class="diff-line add">+            hash_name=&#x27;sha512&#x27;,</span><span class="diff-line add">+            password=password_bytes,</span><span class="diff-line add">+            salt=salt,</span><span class="diff-line add">+            iterations=ITERATIONS</span><span class="diff-line add">+        )</span><span class="diff-line add">+        </span><span class="diff-line add">+        # Encode salt and hash in Base64</span><span class="diff-line add">+        salt_b64 = base64.b64encode(salt).decode()</span><span class="diff-line add">+        hash_b64 = base64.b64encode(derived_key).decode()</span><span class="diff-line add">+        </span><span class="diff-line add">+        # Format according to qBittorrent&#x27;s expectation</span><span class="diff-line add">+        return f&quot;@ByteArray({salt_b64}:{hash_b64})&quot;</span><span class="diff-line context"> </span><span class="diff-line del">-        salt = os.urandom(SALT_SIZE)</span><span class="diff-line del">-        h = hashlib.pbkdf2_hmac(&quot;sha512&quot;, plain_passwd.encode(), salt, ITERATIONS)</span><span class="diff-line del">-        return &quot;@ByteArray({}:{})&quot;.format(base64.b64encode(salt).decode(), base64.b64encode(h).decode())</span><span class="diff-line context">     except Exception as e:</span><span class="diff-line del">-        raise ValueError(f&quot;Error generating password hash: {str(e)}&quot;)</span><span class="diff-line add">+        # Wrap underlying exception for better debugging upstream</span><span class="diff-line add">+        raise ValueError(f&quot;Error generating password hash: {str(e)}&quot;) from e</span><span class="diff-line context"> </span><span class="diff-line del">-def main():</span><span class="diff-line add">+</span><span class="diff-line add">+def main() -&gt; None:</span><span class="diff-line context">     module_args = dict(</span><span class="diff-line context">         password=dict(type=&#x27;str&#x27;, required=True, no_log=True)</span><span class="diff-line context">     )</span><span class="diff-line context"> </span><span class="diff-line del">-    result = dict(</span><span class="diff-line del">-        changed=False,</span><span class="diff-line del">-        msg=&#x27;&#x27;</span><span class="diff-line del">-    )</span><span class="diff-line add">+    result: dict[str, Any] = {</span><span class="diff-line add">+        &#x27;changed&#x27;: False,</span><span class="diff-line add">+        &#x27;hash&#x27;: &#x27;&#x27;,</span><span class="diff-line add">+    }</span><span class="diff-line context"> </span><span class="diff-line context">     module = AnsibleModule(</span><span class="diff-line context">         argument_spec=module_args,</span><span class="diff-line del">-        supports_check_mode=True</span><span class="diff-line add">+        supports_check_mode=False</span><span class="diff-line context">     )</span><span class="diff-line context"> </span><span class="diff-line add">+    plain_password: str = module.params[&#x27;password&#x27;]</span><span class="diff-line add">+</span><span class="diff-line context">     try:</span><span class="diff-line del">-        result[&#x27;msg&#x27;] = qbittorrent_passwd(module.params[&#x27;password&#x27;])</span><span class="diff-line add">+        # Generate the hash using the dedicated function</span><span class="diff-line add">+        generated_hash = generate_qbittorrent_hash(plain_password)</span><span class="diff-line add">+        result[&#x27;hash&#x27;] = generated_hash</span><span class="diff-line add">+    </span><span class="diff-line context">     except ValueError as err:</span><span class="diff-line del">-        module.fail_json(msg=str(err))</span><span class="diff-line add">+        # If the hashing function raised ValueError, fail the module</span><span class="diff-line add">+        module.fail_json(msg=f&quot;Failed to generate qBittorrent hash: {str(err)}&quot;, **result)</span><span class="diff-line add">+    except Exception as e:</span><span class="diff-line add">+         # Catch any other unexpected errors during execution</span><span class="diff-line add">+         module.fail_json(msg=f&quot;An unexpected error occurred: {str(e)}&quot;, **result)</span><span class="diff-line context"> </span><span class="diff-line add">+</span><span class="diff-line add">+    # Exit successfully, returning the hash</span><span class="diff-line context">     module.exit_json(**result)</span><span class="diff-line context"> </span><span class="diff-line context"> if __name__ == &#x27;__main__&#x27;:</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-69">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>library/saltbox_facts.py</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -18,6 +18,7 @@</span><span class="diff-line context">         owner: user1</span><span class="diff-line context">         group: group1</span><span class="diff-line context">         mode: &quot;0640&quot;</span><span class="diff-line add">+        base_path: &quot;{{ server_appdata_path }}&quot;</span><span class="diff-line context">       register: register_var</span><span class="diff-line context"> </span><span class="diff-line context">     # Save facts with overwrite (ignores existing values)</span><span class="diff-line hunk">@@ -28,6 +29,7 @@</span><span class="diff-line context">         keys:</span><span class="diff-line context">           key1: value1</span><span class="diff-line context">           key2: value2</span><span class="diff-line add">+        base_path: &quot;{{ server_appdata_path }}&quot;</span><span class="diff-line context">         overwrite: true</span><span class="diff-line context">       register: register_var</span><span class="diff-line context"> </span><span class="diff-line hunk">@@ -41,6 +43,7 @@</span><span class="diff-line context">         keys:</span><span class="diff-line context">           key1: &quot;&quot;</span><span class="diff-line context">           key2: &quot;&quot;</span><span class="diff-line add">+        base_path: &quot;{{ server_appdata_path }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context">     # Delete entire instance</span><span class="diff-line context">     - name: Delete instance</span><span class="diff-line hunk">@@ -49,6 +52,7 @@</span><span class="diff-line context">         instance: instance1</span><span class="diff-line context">         method: delete</span><span class="diff-line context">         delete_type: instance</span><span class="diff-line add">+        base_path: &quot;{{ server_appdata_path }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context">     # Delete entire role (removes configuration file)</span><span class="diff-line context">     - name: Delete role</span><span class="diff-line hunk">@@ -57,6 +61,7 @@</span><span class="diff-line context">         instance: instance1</span><span class="diff-line context">         method: delete</span><span class="diff-line context">         delete_type: role</span><span class="diff-line add">+        base_path: &quot;{{ server_appdata_path }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context">     # Save with default owner/group (current user)</span><span class="diff-line context">     - name: Save facts with defaults</span><span class="diff-line hunk">@@ -65,6 +70,7 @@</span><span class="diff-line context">         instance: instance1</span><span class="diff-line context">         keys:</span><span class="diff-line context">           key1: value1</span><span class="diff-line add">+        base_path: &quot;{{ server_appdata_path }}&quot;</span><span class="diff-line context">       register: register_var</span><span class="diff-line context"> </span><span class="diff-line context">     # Save with specific file permissions</span><span class="diff-line hunk">@@ -75,6 +81,7 @@</span><span class="diff-line context">         keys:</span><span class="diff-line context">           key1: value1</span><span class="diff-line context">         mode: &quot;0600&quot;</span><span class="diff-line add">+        base_path: &quot;{{ server_appdata_path }}&quot;</span><span class="diff-line context">       register: register_var</span><span class="diff-line context"> </span><span class="diff-line context"> Return Values:</span><span class="diff-line hunk">@@ -90,22 +97,22 @@</span><span class="diff-line context">         description: Informational or error message</span><span class="diff-line context">         type: str</span><span class="diff-line context">         returned: when applicable</span><span class="diff-line del">-    warnings:</span><span class="diff-line del">-        description: List of warning messages</span><span class="diff-line del">-        type: list</span><span class="diff-line del">-        returned: when applicable</span><span class="diff-line context"> &quot;&quot;&quot;</span><span class="diff-line context"> </span><span class="diff-line del">-from ansible.module_utils.basic import AnsibleModule</span><span class="diff-line add">+from __future__ import annotations</span><span class="diff-line add">+</span><span class="diff-line context"> import configparser</span><span class="diff-line add">+import grp</span><span class="diff-line context"> import os</span><span class="diff-line context"> import pwd</span><span class="diff-line del">-import grp</span><span class="diff-line add">+import shutil</span><span class="diff-line context"> import tempfile</span><span class="diff-line del">-import shutil</span><span class="diff-line context"> from io import StringIO</span><span class="diff-line del">-</span><span class="diff-line del">-def validate_instance_name(instance):</span><span class="diff-line add">+from typing import Any</span><span class="diff-line add">+</span><span class="diff-line add">+from ansible.module_utils.basic import AnsibleModule</span><span class="diff-line add">+</span><span class="diff-line add">+def validate_instance_name(instance: Any) -&gt; None:</span><span class="diff-line context">     &quot;&quot;&quot;</span><span class="diff-line context">     Validate that the instance name is a string.</span><span class="diff-line context"> </span><span class="diff-line hunk">@@ -118,7 +125,7 @@</span><span class="diff-line context">     if not isinstance(instance, str):</span><span class="diff-line context">         raise ValueError(&quot;Instance name must be a string&quot;)</span><span class="diff-line context"> </span><span class="diff-line del">-def validate_keys(keys):</span><span class="diff-line add">+def validate_keys(keys: Any) -&gt; None:</span><span class="diff-line context">     &quot;&quot;&quot;</span><span class="diff-line context">     Validate configuration keys and values.</span><span class="diff-line context"> </span><span class="diff-line hunk">@@ -130,7 +137,7 @@</span><span class="diff-line context">     &quot;&quot;&quot;</span><span class="diff-line context">     if not isinstance(keys, dict):</span><span class="diff-line context">         raise ValueError(&quot;Keys must be a dictionary&quot;)</span><span class="diff-line del">-    </span><span class="diff-line add">+</span><span class="diff-line context">     for key, value in keys.items():</span><span class="diff-line context">         if not isinstance(key, str):</span><span class="diff-line context">             raise ValueError(f&quot;Invalid key &#x27;{key}&#x27;: must be a string&quot;)</span><span class="diff-line hunk">@@ -139,12 +146,13 @@</span><span class="diff-line context">                 f&quot;Invalid value type for key &#x27;{key}&#x27;: must be string, number, or boolean&quot;</span><span class="diff-line context">             )</span><span class="diff-line context"> </span><span class="diff-line del">-def get_file_path(role):</span><span class="diff-line add">+def get_file_path(role: str, base_path: str) -&gt; str:</span><span class="diff-line context">     &quot;&quot;&quot;</span><span class="diff-line context">     Get the configuration file path for a role.</span><span class="diff-line context"> </span><span class="diff-line context">     Args:</span><span class="diff-line context">         role (str): Name of the role</span><span class="diff-line add">+        base_path (str): Base directory path</span><span class="diff-line context"> </span><span class="diff-line context">     Returns:</span><span class="diff-line context">         str: Full path to the configuration file</span><span class="diff-line hunk">@@ -154,9 +162,9 @@</span><span class="diff-line context">     &quot;&quot;&quot;</span><span class="diff-line context">     if not isinstance(role, str):</span><span class="diff-line context">         raise ValueError(&quot;Role name must be a string&quot;)</span><span class="diff-line del">-    return f&quot;/opt/saltbox/{role}.ini&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-def atomic_write(file_path, content, mode, owner, group):</span><span class="diff-line add">+    return f&quot;{base_path}/saltbox/{role}.ini&quot;</span><span class="diff-line add">+</span><span class="diff-line add">+def atomic_write(file_path: str, content: str, mode: int, owner: str, group: str) -&gt; None:</span><span class="diff-line context">     &quot;&quot;&quot;</span><span class="diff-line context">     Write content to file atomically with proper permissions.</span><span class="diff-line context"> </span><span class="diff-line hunk">@@ -173,24 +181,24 @@</span><span class="diff-line context">     &quot;&quot;&quot;</span><span class="diff-line context">     directory = os.path.dirname(file_path)</span><span class="diff-line context">     os.makedirs(directory, exist_ok=True)</span><span class="diff-line del">-    </span><span class="diff-line add">+</span><span class="diff-line context">     temp_fd, temp_path = tempfile.mkstemp(dir=directory)</span><span class="diff-line context">     try:</span><span class="diff-line context">         with os.fdopen(temp_fd, &#x27;w&#x27;) as temp_file:</span><span class="diff-line context">             temp_file.write(content)</span><span class="diff-line del">-        </span><span class="diff-line add">+</span><span class="diff-line context">         os.chmod(temp_path, mode)</span><span class="diff-line del">-        os.chown(temp_path, </span><span class="diff-line add">+        os.chown(temp_path,</span><span class="diff-line context">                 pwd.getpwnam(owner).pw_uid,</span><span class="diff-line context">                 grp.getgrnam(group).gr_gid)</span><span class="diff-line del">-        </span><span class="diff-line add">+</span><span class="diff-line context">         shutil.move(temp_path, file_path)</span><span class="diff-line context">     except Exception:</span><span class="diff-line context">         if os.path.exists(temp_path):</span><span class="diff-line context">             os.unlink(temp_path)</span><span class="diff-line context">         raise</span><span class="diff-line context"> </span><span class="diff-line del">-def load_existing_facts(file_path, instance):</span><span class="diff-line add">+def load_existing_facts(file_path: str, instance: str) -&gt; dict[str, str]:</span><span class="diff-line context">     &quot;&quot;&quot;</span><span class="diff-line context">     Load existing facts from configuration file for a specific instance.</span><span class="diff-line context"> </span><span class="diff-line hunk">@@ -206,7 +214,7 @@</span><span class="diff-line context">     &quot;&quot;&quot;</span><span class="diff-line context">     try:</span><span class="diff-line context">         validate_instance_name(instance)</span><span class="diff-line del">-        </span><span class="diff-line add">+</span><span class="diff-line context">         config = configparser.ConfigParser(</span><span class="diff-line context">             interpolation=None,</span><span class="diff-line context">             comment_prefixes=(&#x27;#&#x27;,),</span><span class="diff-line hunk">@@ -215,11 +223,11 @@</span><span class="diff-line context">             delimiters=(&#x27;=&#x27;,),</span><span class="diff-line context">             empty_lines_in_values=False</span><span class="diff-line context">         )</span><span class="diff-line del">-        </span><span class="diff-line del">-        config.optionxform = str</span><span class="diff-line del">-        </span><span class="diff-line del">-        existing_facts = {}</span><span class="diff-line del">-        </span><span class="diff-line add">+</span><span class="diff-line add">+        config.optionxform = lambda optionstr: optionstr  # Preserve case sensitivity for config keys</span><span class="diff-line add">+</span><span class="diff-line add">+        existing_facts: dict[str, str] = {}</span><span class="diff-line add">+</span><span class="diff-line context">         if os.path.exists(file_path):</span><span class="diff-line context">             config.read(file_path)</span><span class="diff-line context">             if config.has_section(instance):</span><span class="diff-line hunk">@@ -228,15 +236,15 @@</span><span class="diff-line context">                         value = config.get(instance, key)</span><span class="diff-line context">                         if value != &#x27;None&#x27;:</span><span class="diff-line context">                             existing_facts[key] = value</span><span class="diff-line del">-                </span><span class="diff-line add">+</span><span class="diff-line context">         return existing_facts</span><span class="diff-line del">-        </span><span class="diff-line add">+</span><span class="diff-line context">     except configparser.Error as e:</span><span class="diff-line context">         raise Exception(f&quot;Configuration parsing error: {str(e)}&quot;)</span><span class="diff-line context">     except Exception as e:</span><span class="diff-line context">         raise Exception(f&quot;Unexpected error: {str(e)}&quot;)</span><span class="diff-line context"> </span><span class="diff-line del">-def process_facts(file_path, instance, keys, owner, group, mode, overwrite=False):</span><span class="diff-line add">+def process_facts(file_path: str, instance: str, keys: dict[str, Any], owner: str, group: str, mode: int, overwrite: bool = False) -&gt; tuple[dict[str, str], bool]:</span><span class="diff-line context">     &quot;&quot;&quot;</span><span class="diff-line context">     Process facts by loading existing values and saving new ones as needed.</span><span class="diff-line context"> </span><span class="diff-line hunk">@@ -258,14 +266,14 @@</span><span class="diff-line context">     try:</span><span class="diff-line context">         validate_instance_name(instance)</span><span class="diff-line context">         validate_keys(keys)</span><span class="diff-line del">-        </span><span class="diff-line add">+</span><span class="diff-line context">         # Load existing facts first</span><span class="diff-line context">         existing_facts = load_existing_facts(file_path, instance)</span><span class="diff-line del">-        </span><span class="diff-line add">+</span><span class="diff-line context">         # Determine final facts based on overwrite setting</span><span class="diff-line del">-        final_facts = {}</span><span class="diff-line del">-        keys_to_save = {}</span><span class="diff-line del">-        </span><span class="diff-line add">+        final_facts: dict[str, str] = {}</span><span class="diff-line add">+        keys_to_save: dict[str, str] = {}</span><span class="diff-line add">+</span><span class="diff-line context">         if overwrite:</span><span class="diff-line context">             # Overwrite mode: use provided keys, keep existing keys not in provided keys</span><span class="diff-line context">             final_facts.update(existing_facts)</span><span class="diff-line hunk">@@ -275,16 +283,16 @@</span><span class="diff-line context">             # Default mode: keep existing values, only add new keys</span><span class="diff-line context">             final_facts.update({k: str(v) for k, v in keys.items()})</span><span class="diff-line context">             final_facts.update(existing_facts)  # Existing values override new ones</span><span class="diff-line del">-            </span><span class="diff-line add">+</span><span class="diff-line context">             # Only save keys that don&#x27;t exist yet</span><span class="diff-line context">             for key, value in keys.items():</span><span class="diff-line context">                 if key not in existing_facts:</span><span class="diff-line context">                     keys_to_save[key] = str(value)</span><span class="diff-line del">-        </span><span class="diff-line add">+</span><span class="diff-line context">         # If no new keys to save, return existing facts without changes</span><span class="diff-line context">         if not keys_to_save:</span><span class="diff-line context">             return final_facts, False</span><span class="diff-line del">-        </span><span class="diff-line add">+</span><span class="diff-line context">         # Save new/updated keys</span><span class="diff-line context">         config = configparser.ConfigParser(</span><span class="diff-line context">             interpolation=None,</span><span class="diff-line hunk">@@ -294,21 +302,21 @@</span><span class="diff-line context">             delimiters=(&#x27;=&#x27;,),</span><span class="diff-line context">             empty_lines_in_values=False</span><span class="diff-line context">         )</span><span class="diff-line del">-        </span><span class="diff-line del">-        config.optionxform = str</span><span class="diff-line del">-        </span><span class="diff-line add">+</span><span class="diff-line add">+        config.optionxform = lambda optionstr: optionstr  # Preserve case sensitivity for config keys</span><span class="diff-line add">+</span><span class="diff-line context">         if os.path.exists(file_path):</span><span class="diff-line context">             config.read(file_path)</span><span class="diff-line context"> </span><span class="diff-line context">         changed = False</span><span class="diff-line del">-        </span><span class="diff-line add">+</span><span class="diff-line context">         if not config.has_section(instance):</span><span class="diff-line context">             config.add_section(instance)</span><span class="diff-line context">             changed = True</span><span class="diff-line context"> </span><span class="diff-line context">         for key, value in keys_to_save.items():</span><span class="diff-line del">-            if (not config.has_section(instance) or </span><span class="diff-line del">-                not config.has_option(instance, key) or </span><span class="diff-line add">+            if (not config.has_section(instance) or</span><span class="diff-line add">+                not config.has_option(instance, key) or</span><span class="diff-line context">                 config.get(instance, key) != str(value)):</span><span class="diff-line context">                 config.set(instance, key, str(value))</span><span class="diff-line context">                 changed = True</span><span class="diff-line hunk">@@ -317,11 +325,11 @@</span><span class="diff-line context">             with StringIO() as string_buffer:</span><span class="diff-line context">                 config.write(string_buffer)</span><span class="diff-line context">                 config_str = string_buffer.getvalue()</span><span class="diff-line del">-            </span><span class="diff-line add">+</span><span class="diff-line context">             atomic_write(file_path, config_str, mode, owner, group)</span><span class="diff-line context"> </span><span class="diff-line context">         return final_facts, changed</span><span class="diff-line del">-        </span><span class="diff-line add">+</span><span class="diff-line context">     except (OSError, IOError) as e:</span><span class="diff-line context">         raise Exception(f&quot;File operation error: {str(e)}&quot;)</span><span class="diff-line context">     except configparser.Error as e:</span><span class="diff-line hunk">@@ -329,7 +337,7 @@</span><span class="diff-line context">     except Exception as e:</span><span class="diff-line context">         raise Exception(f&quot;Unexpected error: {str(e)}&quot;)</span><span class="diff-line context"> </span><span class="diff-line del">-def delete_facts(file_path, delete_type, instance, keys):</span><span class="diff-line add">+def delete_facts(file_path: str, delete_type: str, instance: str, keys: dict[str, Any]) -&gt; bool:</span><span class="diff-line context">     &quot;&quot;&quot;</span><span class="diff-line context">     Delete facts from configuration file.</span><span class="diff-line context"> </span><span class="diff-line hunk">@@ -356,7 +364,7 @@</span><span class="diff-line context">             return False</span><span class="diff-line context"> </span><span class="diff-line context">         config = configparser.ConfigParser(interpolation=None)</span><span class="diff-line del">-        config.optionxform = str</span><span class="diff-line add">+        config.optionxform = lambda optionstr: optionstr  # Preserve case sensitivity for config keys</span><span class="diff-line context">         config.read(file_path)</span><span class="diff-line context">         changed = False</span><span class="diff-line context"> </span><span class="diff-line hunk">@@ -374,14 +382,14 @@</span><span class="diff-line context">             with StringIO() as string_buffer:</span><span class="diff-line context">                 config.write(string_buffer)</span><span class="diff-line context">                 config_str = string_buffer.getvalue()</span><span class="diff-line del">-            </span><span class="diff-line add">+</span><span class="diff-line context">             stat = os.stat(file_path)</span><span class="diff-line del">-            atomic_write(file_path, config_str, stat.st_mode, </span><span class="diff-line add">+            atomic_write(file_path, config_str, stat.st_mode,</span><span class="diff-line context">                         pwd.getpwuid(stat.st_uid).pw_name,</span><span class="diff-line context">                         grp.getgrgid(stat.st_gid).gr_name)</span><span class="diff-line context"> </span><span class="diff-line context">         return changed</span><span class="diff-line del">-        </span><span class="diff-line add">+</span><span class="diff-line context">     except (OSError, IOError) as e:</span><span class="diff-line context">         raise Exception(f&quot;File operation error: {str(e)}&quot;)</span><span class="diff-line context">     except configparser.Error as e:</span><span class="diff-line hunk">@@ -389,7 +397,7 @@</span><span class="diff-line context">     except Exception as e:</span><span class="diff-line context">         raise Exception(f&quot;Unexpected error: {str(e)}&quot;)</span><span class="diff-line context"> </span><span class="diff-line del">-def parse_mode(mode):</span><span class="diff-line add">+def parse_mode(mode: Any) -&gt; int:</span><span class="diff-line context">     &quot;&quot;&quot;</span><span class="diff-line context">     Parse and validate file mode.</span><span class="diff-line context"> </span><span class="diff-line hunk">@@ -413,7 +421,7 @@</span><span class="diff-line context">     else:</span><span class="diff-line context">         raise ValueError(&quot;Mode must be a quoted octal number starting with &#x27;0&#x27; (e.g., &#x27;0640&#x27;).&quot;)</span><span class="diff-line context"> </span><span class="diff-line del">-def get_current_user():</span><span class="diff-line add">+def get_current_user() -&gt; str:</span><span class="diff-line context">     &quot;&quot;&quot;</span><span class="diff-line context">     Get current user name.</span><span class="diff-line context"> </span><span class="diff-line hunk">@@ -422,7 +430,7 @@</span><span class="diff-line context">     &quot;&quot;&quot;</span><span class="diff-line context">     return pwd.getpwuid(os.getuid()).pw_name</span><span class="diff-line context"> </span><span class="diff-line del">-def run_module():</span><span class="diff-line add">+def run_module() -&gt; None:</span><span class="diff-line context">     &quot;&quot;&quot;</span><span class="diff-line context">     Main module execution.</span><span class="diff-line context"> </span><span class="diff-line hunk">@@ -440,6 +448,7 @@</span><span class="diff-line context">     - group (str): File group (default: current user)</span><span class="diff-line context">     - mode (str): File mode in octal string format (default: &#x27;0640&#x27;)</span><span class="diff-line context">     - overwrite (bool): If True, overwrite existing values; if False, keep existing (default: False)</span><span class="diff-line add">+    - base_path (str): Base directory path for storing configuration files (required)</span><span class="diff-line context">     &quot;&quot;&quot;</span><span class="diff-line context">     module_args = dict(</span><span class="diff-line context">         role=dict(type=&#x27;str&#x27;, required=True),</span><span class="diff-line hunk">@@ -450,14 +459,14 @@</span><span class="diff-line context">         owner=dict(type=&#x27;str&#x27;, required=False),</span><span class="diff-line context">         group=dict(type=&#x27;str&#x27;, required=False),</span><span class="diff-line context">         mode=dict(type=&#x27;str&#x27;, required=False, default=&#x27;0640&#x27;),</span><span class="diff-line del">-        overwrite=dict(type=&#x27;bool&#x27;, required=False, default=False)</span><span class="diff-line add">+        overwrite=dict(type=&#x27;bool&#x27;, required=False, default=False),</span><span class="diff-line add">+        base_path=dict(type=&#x27;str&#x27;, required=True)</span><span class="diff-line context">     )</span><span class="diff-line context"> </span><span class="diff-line context">     result = dict(</span><span class="diff-line context">         changed=False,</span><span class="diff-line context">         message=&#x27;&#x27;,</span><span class="diff-line del">-        facts={},</span><span class="diff-line del">-        warnings=[]</span><span class="diff-line add">+        facts={}</span><span class="diff-line context">     )</span><span class="diff-line context"> </span><span class="diff-line context">     module = AnsibleModule(</span><span class="diff-line hunk">@@ -466,19 +475,20 @@</span><span class="diff-line context">     )</span><span class="diff-line context"> </span><span class="diff-line context">     try:</span><span class="diff-line del">-        role = module.params[&#x27;role&#x27;]</span><span class="diff-line del">-        instance = module.params[&#x27;instance&#x27;]</span><span class="diff-line del">-        method = module.params.get(&#x27;method&#x27;)</span><span class="diff-line del">-        keys = module.params[&#x27;keys&#x27;]</span><span class="diff-line del">-        delete_type = module.params.get(&#x27;delete_type&#x27;)</span><span class="diff-line del">-        overwrite = module.params[&#x27;overwrite&#x27;]</span><span class="diff-line del">-        </span><span class="diff-line add">+        role: str = module.params[&#x27;role&#x27;]</span><span class="diff-line add">+        instance: str = module.params[&#x27;instance&#x27;]</span><span class="diff-line add">+        method: str | None = module.params.get(&#x27;method&#x27;)</span><span class="diff-line add">+        keys: dict[str, Any] = module.params[&#x27;keys&#x27;]</span><span class="diff-line add">+        delete_type: str | None = module.params.get(&#x27;delete_type&#x27;)</span><span class="diff-line add">+        overwrite: bool = module.params[&#x27;overwrite&#x27;]</span><span class="diff-line add">+        base_path: str = module.params[&#x27;base_path&#x27;]</span><span class="diff-line add">+</span><span class="diff-line context">         current_user = get_current_user()</span><span class="diff-line del">-        owner = module.params.get(&#x27;owner&#x27;) or current_user</span><span class="diff-line del">-        group = module.params.get(&#x27;group&#x27;) or current_user</span><span class="diff-line add">+        owner: str = module.params.get(&#x27;owner&#x27;) or current_user</span><span class="diff-line add">+        group: str = module.params.get(&#x27;group&#x27;) or current_user</span><span class="diff-line context"> </span><span class="diff-line context">         mode = parse_mode(module.params[&#x27;mode&#x27;])</span><span class="diff-line del">-        file_path = get_file_path(role)</span><span class="diff-line add">+        file_path = get_file_path(role, base_path)</span><span class="diff-line context"> </span><span class="diff-line context">         if method == &#x27;delete&#x27;:</span><span class="diff-line context">             if not delete_type:</span><span class="diff-line hunk">@@ -495,7 +505,7 @@</span><span class="diff-line context">     except Exception as e:</span><span class="diff-line context">         module.fail_json(msg=str(e))</span><span class="diff-line context"> </span><span class="diff-line del">-def main():</span><span class="diff-line add">+def main() -&gt; None:</span><span class="diff-line context">     &quot;&quot;&quot;</span><span class="diff-line context">     Module entry point.</span><span class="diff-line context">     &quot;&quot;&quot;</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-70">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>requirements/requirements-saltbox.txt</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -1,8 +1,10 @@</span><span class="diff-line del">-ansible==11.11.0</span><span class="diff-line del">-ansible-lint==25.9.2</span><span class="diff-line add">+aiohttp==3.13.2</span><span class="diff-line add">+ansible==13.0.0</span><span class="diff-line add">+ansible-lint==25.11.0</span><span class="diff-line context"> apprise==1.9.5</span><span class="diff-line context"> argon2_cffi==25.1.0</span><span class="diff-line context"> certbot==5.1.0</span><span class="diff-line add">+cloudflare==4.3.1</span><span class="diff-line context"> dnspython==2.8.0</span><span class="diff-line context"> docker==7.1.0</span><span class="diff-line context"> jinja2==3.1.6</span><span class="diff-line hunk">@@ -12,9 +14,10 @@</span><span class="diff-line context"> netaddr==1.3.0</span><span class="diff-line context"> passlib==1.7.4</span><span class="diff-line context"> pexpect==4.9.0</span><span class="diff-line add">+psycopg[binary]==3.2.12</span><span class="diff-line context"> PyMySQL==1.1.2</span><span class="diff-line context"> pyOpenSSL==25.3.0</span><span class="diff-line context"> requests==2.32.5</span><span class="diff-line context"> ruamel.yaml==0.18.16</span><span class="diff-line context"> tld==0.13.1</span><span class="diff-line del">-uv==0.9.6</span><span class="diff-line add">+uv==0.9.10</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-71">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>resources/roles/dns/defaults/main.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -8,12 +8,3 @@</span><span class="diff-line context"> #########################################################################</span><span class="diff-line context"> ---</span><span class="diff-line context"> cloudflare_allow_nested_proxy: false</span><span class="diff-line del">-cloudflare_reinstall: false</span><span class="diff-line del">-cloudflare_path: &quot;/srv/cloudflare-helper&quot;</span><span class="diff-line del">-cloudflare_venv_path: &quot;{{ cloudflare_path }}/venv&quot;</span><span class="diff-line del">-cloudflare_python_version: &quot;3.10&quot;</span><span class="diff-line del">-cloudflare_script_path: &quot;{{ cloudflare_path }}/fetch_cloudflare_records.py&quot;</span><span class="diff-line del">-cloudflare_requirements_path: &quot;{{ cloudflare_path }}/requirements.txt&quot;</span><span class="diff-line del">-cloudflare_files:</span><span class="diff-line del">-  - &quot;fetch_cloudflare_records.py&quot;</span><span class="diff-line del">-  - &quot;requirements.txt&quot;</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-72">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>resources/roles/dns/tasks/cloudflare/main.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -7,39 +7,26 @@</span><span class="diff-line context"> #                   GNU General Public License v3.0                     #</span><span class="diff-line context"> #########################################################################</span><span class="diff-line context"> ---</span><span class="diff-line del">-- name: Cloudflare | Cleanup legacy folder</span><span class="diff-line add">+- name: Cloudflare | Cleanup legacy folders</span><span class="diff-line context">   ansible.builtin.file:</span><span class="diff-line del">-    path: &quot;/srv/cloudflare&quot;</span><span class="diff-line add">+    path: &quot;{{ item }}&quot;</span><span class="diff-line context">     state: absent</span><span class="diff-line add">+  loop:</span><span class="diff-line add">+    - &quot;/srv/cloudflare&quot;</span><span class="diff-line add">+    - &quot;/srv/cloudflare-helper&quot;</span><span class="diff-line context"> </span><span class="diff-line del">-- name: Cloudflare | Check if &#x27;{{ cloudflare_path }}&#x27; folder exists</span><span class="diff-line del">-  ansible.builtin.stat:</span><span class="diff-line del">-    path: &quot;{{ cloudflare_path }}&quot;</span><span class="diff-line del">-  register: cloudflare_folder</span><span class="diff-line del">-</span><span class="diff-line del">-- name: Cloudflare | Check if Python symlink exists</span><span class="diff-line del">-  ansible.builtin.stat:</span><span class="diff-line del">-    path: &quot;{{ cloudflare_path }}/venv/bin/python{{ cloudflare_python_version }}&quot;</span><span class="diff-line del">-  register: cloudflare_folder_symlink</span><span class="diff-line del">-</span><span class="diff-line del">-- name: Cloudflare | Python Migration</span><span class="diff-line del">-  ansible.builtin.include_tasks: &quot;subtasks/python.yml&quot;</span><span class="diff-line del">-  when: cloudflare_folder_symlink.stat.exists</span><span class="diff-line del">-</span><span class="diff-line del">-- name: Cloudflare | Checksum</span><span class="diff-line del">-  ansible.builtin.include_tasks: &quot;subtasks/checksum.yml&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-- name: Cloudflare | Setup</span><span class="diff-line del">-  ansible.builtin.include_tasks: &quot;subtasks/setup.yml&quot;</span><span class="diff-line del">-  when: (not cloudflare_folder.stat.exists) or (not cloudflare_folder_symlink.stat.exists) or (cloudflare_reinstall | bool)</span><span class="diff-line add">+- name: Set IP variables</span><span class="diff-line add">+  ansible.builtin.set_fact:</span><span class="diff-line add">+    ipv4_address_public_template: &quot;{{ lookup(&#x27;vars&#x27;, ansible_parent_role_names | first + &#x27;_dns_ipv4&#x27;, default=lookup(&#x27;vars&#x27;, ansible_parent_role_names | first + &#x27;_role_dns_ipv4&#x27;, default=ip_address_public)) }}&quot;</span><span class="diff-line add">+    ipv6_address_public_template: &quot;{{ lookup(&#x27;vars&#x27;, ansible_parent_role_names | first + &#x27;_dns_ipv4&#x27;, default=lookup(&#x27;vars&#x27;, ansible_parent_role_names | first + &#x27;_role_dns_ipv6&#x27;, default=ipv6_address_public)) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Cloudflare | Tailscale block</span><span class="diff-line del">-  when: traefik_tailscale_enabled and lookup(&#x27;vars&#x27;, ansible_parent_role_names | first + &#x27;_traefik_tailscale_enabled&#x27;, default=false)</span><span class="diff-line add">+  when: traefik_tailscale_enabled and lookup(&#x27;vars&#x27;, ansible_parent_role_names | first + &#x27;_traefik_tailscale_enabled&#x27;, default=lookup(&#x27;vars&#x27;, ansible_parent_role_names | first + &#x27;_role_traefik_tailscale_enabled&#x27;, default=false))</span><span class="diff-line context">   block:</span><span class="diff-line context">     - name: Get Tailscale IPs</span><span class="diff-line context">       ansible.builtin.shell: &quot;tailscale ip&quot;</span><span class="diff-line context">       register: dns_tailscale_ips</span><span class="diff-line del">-      failed_when: dns_tailscale_ips.rc != 0</span><span class="diff-line add">+      failed_when: (dns_tailscale_ips.rc != 0)</span><span class="diff-line context"> </span><span class="diff-line context">     - name: Set Tailscale variables</span><span class="diff-line context">       ansible.builtin.set_fact:</span><span class="diff-line hunk">@@ -48,8 +35,8 @@</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Cloudflare | Add DNS Record</span><span class="diff-line context">   ansible.builtin.include_tasks: &quot;subtasks/add_dns_record.yml&quot;</span><span class="diff-line del">-  when: dns_action != &#x27;remove&#x27;</span><span class="diff-line add">+  when: (dns_action != &#x27;remove&#x27;)</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Cloudflare | Remove DNS Record</span><span class="diff-line context">   ansible.builtin.include_tasks: &quot;subtasks/remove_dns_record.yml&quot;</span><span class="diff-line del">-  when: dns_action == &#x27;remove&#x27;</span><span class="diff-line add">+  when: (dns_action == &#x27;remove&#x27;)</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-73">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>resources/roles/dns/tasks/cloudflare/subtasks/add_dns_record.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -15,18 +15,16 @@</span><span class="diff-line context">   when: (not cloudflare_allow_nested_proxy) and (&quot;.&quot; in dns_record) and dns_proxy</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Cloudflare | Add DNS Record | Fetch Record information</span><span class="diff-line del">-  ansible.builtin.shell: &quot;{{ cloudflare_path }}/venv/bin/python3 {{ cloudflare_script_path }} --auth_key &#x27;{{ cloudflare.api }}&#x27; --auth_email &#x27;{{ cloudflare.email }}&#x27; --zone_name &#x27;{{ dns_zone }}&#x27; --record &#x27;{{ dns_record }}.{{ dns_zone }}&#x27;&quot;</span><span class="diff-line add">+  cloudflare_dns_records:</span><span class="diff-line add">+    auth_email: &quot;{{ cloudflare.email }}&quot;</span><span class="diff-line add">+    auth_key: &quot;{{ cloudflare.api }}&quot;</span><span class="diff-line add">+    zone_name: &quot;{{ dns_zone }}&quot;</span><span class="diff-line add">+    record: &quot;{{ dns_record }}.{{ dns_zone }}&quot;</span><span class="diff-line context">   register: cloudflare_record</span><span class="diff-line del">-  ignore_errors: true</span><span class="diff-line context"> </span><span class="diff-line del">-- name: Cloudflare | Add DNS Record | Print Failure Output</span><span class="diff-line del">-  ansible.builtin.fail:</span><span class="diff-line del">-    msg: &quot;{{ cloudflare_record.stderr }}&quot;</span><span class="diff-line del">-  when: cloudflare_record.rc != 0</span><span class="diff-line del">-</span><span class="diff-line del">-- name: Cloudflare | Add DNS Record | Convert JSON to Dictionary</span><span class="diff-line add">+- name: Cloudflare | Add DNS Record | Set variables</span><span class="diff-line context">   ansible.builtin.set_fact:</span><span class="diff-line del">-    cloudflare_record_dict: &quot;{{ cloudflare_record.stdout | from_json }}&quot;</span><span class="diff-line add">+    cloudflare_record_dict: &quot;{{ cloudflare_record.records }}&quot;</span><span class="diff-line context">     cloudflare_ipv4_record: []</span><span class="diff-line context">     cloudflare_ipv6_record: []</span><span class="diff-line context"> </span><span class="diff-line hunk">@@ -45,7 +43,7 @@</span><span class="diff-line context">     label: &quot;{{ item.name }} - {{ item.type }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Cloudflare | Add DNS Record | Tasks on success</span><span class="diff-line del">-  when: cloudflare_dns_record_removal_status is succeeded and cloudflare_dns_record_removal_status.changed</span><span class="diff-line add">+  when: (cloudflare_dns_record_removal_status is succeeded) and cloudflare_dns_record_removal_status.changed</span><span class="diff-line context">   block:</span><span class="diff-line context">     - name: Cloudflare | Add DNS Record | Set &#x27;dns_record_print&#x27; variable</span><span class="diff-line context">       ansible.builtin.set_fact:</span><span class="diff-line hunk">@@ -73,20 +71,20 @@</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Cloudflare | Add DNS Record | IPv4 Tasks</span><span class="diff-line context">   ansible.builtin.include_tasks: &quot;add_dns_record/ipv4_enabled.yml&quot;</span><span class="diff-line del">-  when: dns.ipv4 and</span><span class="diff-line del">-        ((not ((cloudflare_ipv4_record is defined and (cloudflare_ipv4_record | length &gt; 0)) and (cloudflare_ipv4_record.content == ip_address_public) and (cloudflare_ipv4_record.proxied == dns_proxy)))</span><span class="diff-line del">-         or not (cloudflare_ipv4_record is defined and (cloudflare_ipv4_record | length &gt; 0)))</span><span class="diff-line add">+  when: dns_ipv4_enabled and</span><span class="diff-line add">+        ((not (((cloudflare_ipv4_record is defined) and (cloudflare_ipv4_record | length &gt; 0)) and (cloudflare_ipv4_record.content == ipv4_address_public_template) and (cloudflare_ipv4_record.proxied == dns_proxy)))</span><span class="diff-line add">+         or not ((cloudflare_ipv4_record is defined) and (cloudflare_ipv4_record | length &gt; 0)))</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Cloudflare | Add DNS Record | IPv4 Disable Tasks</span><span class="diff-line context">   ansible.builtin.include_tasks: &quot;add_dns_record/ipv4_disabled.yml&quot;</span><span class="diff-line del">-  when: (not dns.ipv4) and (cloudflare_ipv4_record is defined and (cloudflare_ipv4_record | length &gt; 0))</span><span class="diff-line add">+  when: (not dns_ipv4_enabled) and ((cloudflare_ipv4_record is defined) and (cloudflare_ipv4_record | length &gt; 0))</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Cloudflare | Add DNS Record | IPv6 Enabled Block</span><span class="diff-line context">   ansible.builtin.include_tasks: &quot;add_dns_record/ipv6_enabled.yml&quot;</span><span class="diff-line del">-  when: dns.ipv6 and</span><span class="diff-line del">-        ((not ((cloudflare_ipv6_record is defined and (cloudflare_ipv6_record | length &gt; 0)) and (cloudflare_ipv6_record.content == ipv6_address_public) and (cloudflare_ipv6_record.proxied == dns_proxy)))</span><span class="diff-line del">-         or not (cloudflare_ipv6_record is defined and (cloudflare_ipv6_record | length &gt; 0)))</span><span class="diff-line add">+  when: dns_ipv6_enabled and</span><span class="diff-line add">+        ((not (((cloudflare_ipv6_record is defined) and (cloudflare_ipv6_record | length &gt; 0)) and (cloudflare_ipv6_record.content == ipv6_address_public_template) and (cloudflare_ipv6_record.proxied == dns_proxy)))</span><span class="diff-line add">+         or not ((cloudflare_ipv6_record is defined) and (cloudflare_ipv6_record | length &gt; 0)))</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Cloudflare | Add DNS Record | IPv6 Disable Block</span><span class="diff-line context">   ansible.builtin.include_tasks: &quot;add_dns_record/ipv6_disabled.yml&quot;</span><span class="diff-line del">-  when: (not dns.ipv6) and (cloudflare_ipv6_record is defined and (cloudflare_ipv6_record | length &gt; 0))</span><span class="diff-line add">+  when: (not dns_ipv6_enabled) and ((cloudflare_ipv6_record is defined) and (cloudflare_ipv6_record | length &gt; 0))</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-74">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>resources/roles/dns/tasks/cloudflare/subtasks/add_dns_record/ipv4_enabled.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -10,7 +10,7 @@</span><span class="diff-line context"> - name: Cloudflare | Add DNS Record | IPv4 | Validate IP variable</span><span class="diff-line context">   ansible.builtin.fail:</span><span class="diff-line context">     msg: &quot;{{ ip_address_public_error }}&quot;</span><span class="diff-line del">-  when: (not ip_address_public_is_valid)</span><span class="diff-line add">+  when: (not ip_address_public_is_valid) and (ipv4_address_public_template == ip_address_public)</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Cloudflare | Add DNS Record | IPv4 | Add DNS Record</span><span class="diff-line context">   community.general.cloudflare_dns:</span><span class="diff-line hunk">@@ -21,8 +21,8 @@</span><span class="diff-line context">     solo: true</span><span class="diff-line context">     proxied: &quot;{{ dns_proxy }}&quot;</span><span class="diff-line context">     type: A</span><span class="diff-line del">-    value: &quot;{{ ip_address_public</span><span class="diff-line del">-            if not lookup(&#x27;vars&#x27;, ansible_parent_role_names | first + &#x27;_traefik_tailscale_enabled&#x27;, default=false)</span><span class="diff-line add">+    value: &quot;{{ ipv4_address_public_template</span><span class="diff-line add">+            if not lookup(&#x27;vars&#x27;, ansible_parent_role_names | first + &#x27;_traefik_tailscale_enabled&#x27;, default=lookup(&#x27;vars&#x27;, ansible_parent_role_names | first + &#x27;_role_traefik_tailscale_enabled&#x27;, default=false))</span><span class="diff-line context">             else dns_tailscale_ipv4 }}&quot;</span><span class="diff-line context">     record: &quot;{{ dns_record }}&quot;</span><span class="diff-line context">   register: cloudflare_dns_record_creation_status</span><span class="diff-line hunk">@@ -36,4 +36,4 @@</span><span class="diff-line context"> </span><span class="diff-line context">     - name: Cloudflare | Add DNS Record | IPv4 | Display DNS Record creation status</span><span class="diff-line context">       ansible.builtin.debug:</span><span class="diff-line del">-        msg: &quot;DNS A Record for &#x27;{{ dns_record_print }}&#x27; set to &#x27;{{ ip_address_public }}&#x27; was added. Proxy: {{ dns_proxy }}&quot;</span><span class="diff-line add">+        msg: &quot;DNS A Record for &#x27;{{ dns_record_print }}&#x27; set to &#x27;{{ ipv4_address_public_template }}&#x27; was added. Proxy: {{ dns_proxy }}&quot;</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-75">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>resources/roles/dns/tasks/cloudflare/subtasks/add_dns_record/ipv6_enabled.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -10,7 +10,7 @@</span><span class="diff-line context"> - name: Cloudflare | Add DNS Record | IPv6 | Validate IPv6 variable</span><span class="diff-line context">   ansible.builtin.fail:</span><span class="diff-line context">     msg: &quot;{{ ipv6_address_public_error }}&quot;</span><span class="diff-line del">-  when: (not ipv6_address_public_is_valid)</span><span class="diff-line add">+  when: (not ipv6_address_public_is_valid) and (ipv6_address_public_template == ipv6_address_public)</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Cloudflare | Add DNS Record | IPv6 | Add DNS Record</span><span class="diff-line context">   community.general.cloudflare_dns:</span><span class="diff-line hunk">@@ -21,8 +21,8 @@</span><span class="diff-line context">     solo: true</span><span class="diff-line context">     proxied: &quot;{{ dns_proxy }}&quot;</span><span class="diff-line context">     type: AAAA</span><span class="diff-line del">-    value: &quot;{{ ipv6_address_public</span><span class="diff-line del">-            if not lookup(&#x27;vars&#x27;, ansible_parent_role_names | first + &#x27;_traefik_tailscale_enabled&#x27;, default=false)</span><span class="diff-line add">+    value: &quot;{{ ipv6_address_public_template</span><span class="diff-line add">+            if (not lookup(&#x27;vars&#x27;, ansible_parent_role_names | first + &#x27;_traefik_tailscale_enabled&#x27;, default=lookup(&#x27;vars&#x27;, ansible_parent_role_names | first + &#x27;_role_traefik_tailscale_enabled&#x27;, default=false)))</span><span class="diff-line context">             else dns_tailscale_ipv6 }}&quot;</span><span class="diff-line context">     record: &quot;{{ dns_record }}&quot;</span><span class="diff-line context">   register: cloudflare_dns_v6_record_creation_status</span><span class="diff-line hunk">@@ -36,4 +36,4 @@</span><span class="diff-line context"> </span><span class="diff-line context">     - name: Cloudflare | Add DNS Record | IPv6 | Display DNS Record creation status</span><span class="diff-line context">       ansible.builtin.debug:</span><span class="diff-line del">-        msg: &quot;DNS AAAA Record for &#x27;{{ dns_record_print }}&#x27; set to &#x27;{{ ipv6_address_public }}&#x27; was added. Proxy: {{ dns_proxy }}&quot;</span><span class="diff-line add">+        msg: &quot;DNS AAAA Record for &#x27;{{ dns_record_print }}&#x27; set to &#x27;{{ ipv6_address_public_template }}&#x27; was added. Proxy: {{ dns_proxy }}&quot;</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-76">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>resources/roles/dns/tasks/cloudflare/subtasks/remove_dns_record.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -18,7 +18,7 @@</span><span class="diff-line context">   register: cloudflare_dns_record_removal_status</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Cloudflare | Remove DNS Record | IPv4 | Tasks on success</span><span class="diff-line del">-  when: cloudflare_dns_record_removal_status is succeeded</span><span class="diff-line add">+  when: (cloudflare_dns_record_removal_status is succeeded)</span><span class="diff-line context">   block:</span><span class="diff-line context">     - name: Cloudflare | Remove DNS Record | IPv4 | Set &#x27;dns_record_print&#x27; variable</span><span class="diff-line context">       ansible.builtin.set_fact:</span><span class="diff-line hunk">@@ -39,7 +39,7 @@</span><span class="diff-line context">   register: cloudflare_dns_v6_record_removal_status</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Cloudflare | Remove DNS Record | IPv6 | Tasks on success</span><span class="diff-line del">-  when: cloudflare_dns_v6_record_removal_status is succeeded</span><span class="diff-line add">+  when: (cloudflare_dns_v6_record_removal_status is succeeded)</span><span class="diff-line context">   block:</span><span class="diff-line context">     - name: Cloudflare | Remove DNS Record | IPv6 | Set &#x27;dns_record_print&#x27; variable</span><span class="diff-line context">       ansible.builtin.set_fact:</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-77">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>resources/tasks/directories/create_directories.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -11,9 +11,9 @@</span><span class="diff-line context">   ansible.builtin.file:</span><span class="diff-line context">     path: &quot;{{ item }}&quot;</span><span class="diff-line context">     state: directory</span><span class="diff-line del">-    owner: &quot;{{ lookup(&#x27;vars&#x27;, role_name + &#x27;_paths_owner&#x27;, default=user.name) }}&quot;</span><span class="diff-line del">-    group: &quot;{{ lookup(&#x27;vars&#x27;, role_name + &#x27;_paths_group&#x27;, default=user.name) }}&quot;</span><span class="diff-line del">-    mode: &quot;{{ lookup(&#x27;vars&#x27;, role_name + &#x27;_paths_permissions&#x27;, default=&#x27;0775&#x27;) }}&quot;</span><span class="diff-line del">-    recurse: &quot;{{ lookup(&#x27;vars&#x27;, role_name + &#x27;_paths_recursive&#x27;, default=false) }}&quot;</span><span class="diff-line del">-  with_items: &quot;{{ lookup(&#x27;vars&#x27;, role_name + &#x27;_paths_folders_list&#x27;)</span><span class="diff-line del">-                  + lookup(&#x27;vars&#x27;, role_name + &#x27;_paths_folders_list_custom&#x27;, default=[]) }}&quot;</span><span class="diff-line add">+    owner: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_owner&#x27;, default=user.name) }}&quot;</span><span class="diff-line add">+    group: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_group&#x27;, default=user.name) }}&quot;</span><span class="diff-line add">+    mode: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_permissions&#x27;, default=&#x27;0775&#x27;) }}&quot;</span><span class="diff-line add">+    recurse: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_recursive&#x27;, default=false) }}&quot;</span><span class="diff-line add">+  with_items: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_folders_list&#x27;)</span><span class="diff-line add">+                  + lookup(&#x27;role_var&#x27;, &#x27;_paths_folders_list_custom&#x27;, default=[]) }}&quot;</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-78">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>resources/tasks/dns/tasker2.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -7,49 +7,18 @@</span><span class="diff-line context"> #                   GNU General Public License v3.0                     #</span><span class="diff-line context"> #########################################################################</span><span class="diff-line context"> ---</span><span class="diff-line del">-- name: Resources | Tasks | DNS | Tasker | Get FLD</span><span class="diff-line del">-  ansible.builtin.shell: |</span><span class="diff-line del">-    {{ saltbox_python }} -c &quot;from tld import get_tld; res = get_tld(\&quot;http://{{ dns_zone | default(user.domain) }}\&quot;, as_object=True); print(res.fld)&quot;</span><span class="diff-line del">-  register: fld</span><span class="diff-line del">-</span><span class="diff-line del">-- name: Resources | Tasks | DNS | Tasker | Get subdomain</span><span class="diff-line del">-  when: dns_record | length &gt; 0</span><span class="diff-line del">-  block:</span><span class="diff-line del">-    - name: Resources | Tasks | DNS | Tasker | Set subdomain var</span><span class="diff-line del">-      ansible.builtin.set_fact:</span><span class="diff-line del">-        subdomain_block: 1</span><span class="diff-line del">-</span><span class="diff-line del">-    - name: Resources | Tasks | DNS | Tasker | Get subdomain</span><span class="diff-line del">-      ansible.builtin.shell: |</span><span class="diff-line del">-        {{ saltbox_python }} -c &quot;from tld import get_tld; res = get_tld(\&quot;http://{{ dns_record }}.{{ dns_zone | default(user.domain) }}\&quot;, as_object=True); print(res.subdomain)&quot;</span><span class="diff-line del">-      register: subdomain_notempty</span><span class="diff-line del">-</span><span class="diff-line del">-- name: Resources | Tasks | DNS | Tasker | Get subdomain</span><span class="diff-line del">-  when: dns_record | length == 0</span><span class="diff-line del">-  block:</span><span class="diff-line del">-    - name: Resources | Tasks | DNS | Tasker | Set subdomain var</span><span class="diff-line del">-      ansible.builtin.set_fact:</span><span class="diff-line del">-        subdomain_block: 0</span><span class="diff-line del">-</span><span class="diff-line del">-    - name: Resources | Tasks | DNS | Tasker | Get subdomain</span><span class="diff-line del">-      ansible.builtin.shell: |</span><span class="diff-line del">-        {{ saltbox_python }} -c &quot;from tld import get_tld; res = get_tld(\&quot;http://{{ dns_zone | default(user.domain) }}\&quot;, as_object=True); print(res.subdomain)&quot;</span><span class="diff-line del">-      register: subdomain_empty</span><span class="diff-line del">-</span><span class="diff-line del">-- name: Resources | Tasks | DNS | Tasker | Set subdomain var</span><span class="diff-line del">-  ansible.builtin.set_fact:</span><span class="diff-line del">-    subdomain: &quot;{{ subdomain_notempty.stdout</span><span class="diff-line del">-                if (subdomain_block)</span><span class="diff-line del">-                else subdomain_empty.stdout }}&quot;</span><span class="diff-line add">+- name: Resources | Tasks | DNS | Tasker | Parse domain</span><span class="diff-line add">+  tld_parse:</span><span class="diff-line add">+    url: &quot;{{ dns_zone | default(user.domain) }}&quot;</span><span class="diff-line add">+    record: &quot;{{ dns_record | default(&#x27;&#x27;) }}&quot;</span><span class="diff-line add">+  register: domain_parsed</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Resources | Tasks | DNS | Tasker | Set &#x27;_dns_*&#x27; variables</span><span class="diff-line context">   ansible.builtin.set_fact:</span><span class="diff-line del">-    _dns_tasker_zone: &quot;{{ fld.stdout }}&quot;</span><span class="diff-line del">-    _dns_tasker_record: &quot;{{ subdomain</span><span class="diff-line del">-                         if (subdomain | length &gt; 0)</span><span class="diff-line del">-                         else &#x27;@&#x27; }}&quot;</span><span class="diff-line add">+    _dns_tasker_zone: &quot;{{ domain_parsed.fld }}&quot;</span><span class="diff-line add">+    _dns_tasker_record: &quot;{{ domain_parsed.record }}&quot;</span><span class="diff-line context">     _dns_tasker_action: &quot;{{ dns_action | default(&#x27;add&#x27;) }}&quot;</span><span class="diff-line del">-    _dns_tasker_proxy: &quot;{{ dns_proxy | default(dns.proxied) }}&quot;</span><span class="diff-line add">+    _dns_tasker_proxy: &quot;{{ dns_proxy | default(dns_proxied) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Resources | Tasks | DNS | Tasker | Sent task to DNS Role</span><span class="diff-line context">   ansible.builtin.include_role:</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-79">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>resources/tasks/docker/create_docker_container.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -13,126 +13,185 @@</span><span class="diff-line context">                   if (var_prefix is defined)</span><span class="diff-line context">                   else role_name }}&quot;</span><span class="diff-line context"> </span><span class="diff-line add">+- name: Resources | Tasks | Docker | Create Docker Container | Set instance name</span><span class="diff-line add">+  ansible.builtin.set_fact:</span><span class="diff-line add">+    _instance_name: &quot;{{ lookup(&#x27;vars&#x27;, _var_prefix + &#x27;_name&#x27;, default=_var_prefix) }}&quot;</span><span class="diff-line add">+</span><span class="diff-line add">+- name: Resources | Tasks | Docker | Create Docker Container | Set variables that need omit handling</span><span class="diff-line add">+  ansible.builtin.set_fact:</span><span class="diff-line add">+    _docker_command: &quot;{{ (lookup(&#x27;docker_var&#x27;, &#x27;_docker_commands&#x27;, default=[]) | reject(&#x27;equalto&#x27;, omit) | list) }}&quot;</span><span class="diff-line add">+    _docker_cpus: &quot;{{ lookup(&#x27;docker_var&#x27;, &#x27;_docker_cpus&#x27;, default=docker_cpus_default) }}&quot;</span><span class="diff-line add">+    _docker_env: &quot;{{ (nvidia_docker_env if use_nvidia else {}) | combine(lookup(&#x27;docker_var&#x27;, &#x27;_docker_envs&#x27;, default={})) }}&quot;</span><span class="diff-line add">+    _docker_etc_hosts: &quot;{{ (docker_hosts_common if lookup(&#x27;docker_var&#x27;, &#x27;_docker_hosts_use_common&#x27;, default=true) else {}) | combine(lookup(&#x27;docker_var&#x27;, &#x27;_docker_hosts&#x27;, default={}))</span><span class="diff-line add">+                        if not (&#x27;container:&#x27; in lookup(&#x27;docker_var&#x27;, &#x27;_docker_network_mode&#x27;, default=docker_networks_name_common))</span><span class="diff-line add">+                        else {} }}&quot;</span><span class="diff-line add">+    _docker_exposed_ports: &quot;{{ (lookup(&#x27;docker_var&#x27;, &#x27;_docker_exposed_ports&#x27;, default=[]) | unique | reject(&#x27;equalto&#x27;, omit) | list)</span><span class="diff-line add">+                            if not (&#x27;container:&#x27; in lookup(&#x27;docker_var&#x27;, &#x27;_docker_network_mode&#x27;, default=docker_networks_name_common))</span><span class="diff-line add">+                            else [] }}&quot;</span><span class="diff-line add">+    _docker_hostname: &quot;{{ lookup(&#x27;docker_var&#x27;, &#x27;_docker_hostname&#x27;, default=&#x27;&#x27;)</span><span class="diff-line add">+                       if (lookup(&#x27;docker_var&#x27;, &#x27;_docker_network_mode&#x27;, default=docker_networks_name_common) == docker_networks_name_common)</span><span class="diff-line add">+                       else &#x27;&#x27; }}&quot;</span><span class="diff-line add">+    _docker_labels: &quot;{{ (docker_labels_common if lookup(&#x27;docker_var&#x27;, &#x27;_docker_labels_use_common&#x27;, default=true) else {}) | combine(lookup(&#x27;docker_var&#x27;, &#x27;_docker_labels&#x27;, default={})) }}&quot;</span><span class="diff-line add">+    _docker_log_driver: &quot;{{ docker_log_driver if (docker_log_driver != &#x27;default&#x27;) else lookup(&#x27;docker_var&#x27;, &#x27;_docker_log_driver&#x27;, default=&#x27;&#x27;) }}&quot;</span><span class="diff-line add">+    _docker_log_options: &quot;{{ docker_log_options if (docker_log_options != &#x27;default&#x27;) else lookup(&#x27;docker_var&#x27;, &#x27;_docker_log_options&#x27;, default={}) }}&quot;</span><span class="diff-line add">+    _docker_memory: &quot;{{ lookup(&#x27;docker_var&#x27;, &#x27;_docker_memory&#x27;, default=docker_memory_default) }}&quot;</span><span class="diff-line add">+    _docker_networks: &quot;{{ lookup(&#x27;docker_var&#x27;, &#x27;_docker_networks&#x27;, default=[])</span><span class="diff-line add">+                       if not ((lookup(&#x27;docker_var&#x27;, &#x27;_docker_network_mode&#x27;, default=docker_networks_name_common) == &#x27;host&#x27;) or (&#x27;container&#x27; in lookup(&#x27;docker_var&#x27;, &#x27;_docker_network_mode&#x27;, default=docker_networks_name_common)))</span><span class="diff-line add">+                       else [] }}&quot;</span><span class="diff-line add">+    _docker_published_ports: &quot;{{ (lookup(&#x27;docker_var&#x27;, &#x27;_docker_ports&#x27;, default=[]) | unique | reject(&#x27;equalto&#x27;, omit) | list)</span><span class="diff-line add">+                              if not (&#x27;container:&#x27; in lookup(&#x27;docker_var&#x27;, &#x27;_docker_network_mode&#x27;, default=docker_networks_name_common))</span><span class="diff-line add">+                              else [] }}&quot;</span><span class="diff-line add">+    _docker_volumes: &quot;{{ ((docker_volumes_common + lookup(&#x27;docker_var&#x27;, &#x27;_docker_volumes&#x27;, default=[]))</span><span class="diff-line add">+                      if (lookup(&#x27;docker_var&#x27;, &#x27;_docker_volumes_global&#x27;, default=true) | bool)</span><span class="diff-line add">+                      else lookup(&#x27;docker_var&#x27;, &#x27;_docker_volumes&#x27;, default=[])) | unique | reject(&#x27;equalto&#x27;, omit) | list }}&quot;</span><span class="diff-line add">+</span><span class="diff-line context"> - name: Resources | Tasks | Docker | Create Docker Container | Network Container Health Status</span><span class="diff-line context">   ansible.builtin.include_tasks: &quot;{{ resources_tasks_path }}/docker/network_container_health_status.yml&quot;</span><span class="diff-line del">-  when: (&#x27;container:&#x27; in lookup(&#x27;vars&#x27;, _var_prefix + &#x27;_docker_network_mode&#x27;, default=docker_networks_name_common))</span><span class="diff-line add">+  when: (&#x27;container:&#x27; in lookup(&#x27;docker_var&#x27;, &#x27;_docker_network_mode&#x27;, default=docker_networks_name_common))</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Resources | Tasks | Docker | Create Docker Container | Create Docker Container # noqa args[module]</span><span class="diff-line context">   community.docker.docker_container:</span><span class="diff-line del">-    auto_remove: &quot;{{ lookup(&#x27;vars&#x27;, _var_prefix + &#x27;_docker_auto_remove&#x27;, default=omit) }}&quot;</span><span class="diff-line del">-    blkio_weight: &quot;{{ lookup(&#x27;vars&#x27;, _var_prefix + &#x27;_docker_blkio_weight&#x27;, default=omit) }}&quot;</span><span class="diff-line del">-    cap_drop: &quot;{{ lookup(&#x27;vars&#x27;, _var_prefix + &#x27;_docker_cap_drop&#x27;, default=omit) }}&quot;</span><span class="diff-line del">-    capabilities: &quot;{{ lookup(&#x27;vars&#x27;, _var_prefix + &#x27;_docker_capabilities&#x27;, default=omit) }}&quot;</span><span class="diff-line del">-    cgroup_parent: &quot;{{ lookup(&#x27;vars&#x27;, _var_prefix + &#x27;_docker_cgroup_parent&#x27;, default=omit) }}&quot;</span><span class="diff-line del">-    cleanup: &quot;{{ lookup(&#x27;vars&#x27;, _var_prefix + &#x27;_docker_cleanup&#x27;, default=omit) }}&quot;</span><span class="diff-line del">-    command: &quot;{{ lookup(&#x27;vars&#x27;, _var_prefix + &#x27;_docker_commands&#x27;, default=omit) | reject(&#x27;equalto&#x27;, omit) | list }}&quot;</span><span class="diff-line add">+    auto_remove: &quot;{{ lookup(&#x27;docker_var&#x27;, &#x27;_docker_auto_remove&#x27;, default=omit) }}&quot;</span><span class="diff-line add">+    blkio_weight: &quot;{{ lookup(&#x27;docker_var&#x27;, &#x27;_docker_blkio_weight&#x27;, default=omit) }}&quot;</span><span class="diff-line add">+    cap_drop: &quot;{{ lookup(&#x27;docker_var&#x27;, &#x27;_docker_cap_drop&#x27;, default=omit) }}&quot;</span><span class="diff-line add">+    capabilities: &quot;{{ lookup(&#x27;docker_var&#x27;, &#x27;_docker_capabilities&#x27;, default=omit) }}&quot;</span><span class="diff-line add">+    cgroup_parent: &quot;{{ lookup(&#x27;docker_var&#x27;, &#x27;_docker_cgroup_parent&#x27;, default=omit) }}&quot;</span><span class="diff-line add">+    cgroupns_mode: &quot;{{ lookup(&#x27;docker_var&#x27;, &#x27;_docker_cgroupns_mode&#x27;, default=omit) }}&quot;</span><span class="diff-line add">+    cleanup: &quot;{{ lookup(&#x27;docker_var&#x27;, &#x27;_docker_cleanup&#x27;, default=omit) }}&quot;</span><span class="diff-line add">+    command: &quot;{{ _docker_command</span><span class="diff-line add">+              if (_docker_command | length &gt; 0)</span><span class="diff-line add">+              else omit }}&quot;</span><span class="diff-line context">     command_handling: compatibility</span><span class="diff-line context">     container_default_behavior: compatibility</span><span class="diff-line del">-    cpu_period: &quot;{{ lookup(&#x27;vars&#x27;, _var_prefix + &#x27;_docker_cpu_period&#x27;, default=omit) }}&quot;</span><span class="diff-line del">-    cpu_quota: &quot;{{ lookup(&#x27;vars&#x27;, _var_prefix + &#x27;_docker_cpu_quota&#x27;, default=omit) }}&quot;</span><span class="diff-line del">-    cpu_shares: &quot;{{ lookup(&#x27;vars&#x27;, _var_prefix + &#x27;_docker_cpu_shares&#x27;, default=omit) }}&quot;</span><span class="diff-line del">-    cpus: &quot;{{ (docker_cpus_default is defined) | ternary(docker_cpus_default, lookup(&#x27;vars&#x27;, _var_prefix + &#x27;_docker_cpus&#x27;, default=omit)) }}&quot;</span><span class="diff-line del">-    cpuset_cpus: &quot;{{ lookup(&#x27;vars&#x27;, _var_prefix + &#x27;_docker_cpuset_cpus&#x27;, default=omit) }}&quot;</span><span class="diff-line del">-    cpuset_mems: &quot;{{ lookup(&#x27;vars&#x27;, _var_prefix + &#x27;_docker_cpuset_mems&#x27;, default=omit) }}&quot;</span><span class="diff-line add">+    cpu_period: &quot;{{ lookup(&#x27;docker_var&#x27;, &#x27;_docker_cpu_period&#x27;, default=omit) }}&quot;</span><span class="diff-line add">+    cpu_quota: &quot;{{ lookup(&#x27;docker_var&#x27;, &#x27;_docker_cpu_quota&#x27;, default=omit) }}&quot;</span><span class="diff-line add">+    cpu_shares: &quot;{{ lookup(&#x27;docker_var&#x27;, &#x27;_docker_cpu_shares&#x27;, default=omit) }}&quot;</span><span class="diff-line add">+    cpus: &quot;{{ _docker_cpus</span><span class="diff-line add">+           if (_docker_cpus | length &gt; 0)</span><span class="diff-line add">+           else omit }}&quot;</span><span class="diff-line add">+    cpuset_cpus: &quot;{{ lookup(&#x27;docker_var&#x27;, &#x27;_docker_cpuset_cpus&#x27;, default=omit) }}&quot;</span><span class="diff-line add">+    cpuset_mems: &quot;{{ lookup(&#x27;docker_var&#x27;, &#x27;_docker_cpuset_mems&#x27;, default=omit) }}&quot;</span><span class="diff-line context">     default_host_ip: &quot;&quot;</span><span class="diff-line del">-    device_read_bps: &quot;{{ lookup(&#x27;vars&#x27;, _var_prefix + &#x27;_docker_device_read_bps&#x27;, default=omit) }}&quot;</span><span class="diff-line del">-    device_read_iops: &quot;{{ lookup(&#x27;vars&#x27;, _var_prefix + &#x27;_docker_device_read_iops&#x27;, default=omit) }}&quot;</span><span class="diff-line del">-    device_requests: &quot;{{ lookup(&#x27;vars&#x27;, _var_prefix + &#x27;_docker_device_requests&#x27;, default=omit) }}&quot;</span><span class="diff-line del">-    device_write_bps: &quot;{{ lookup(&#x27;vars&#x27;, _var_prefix + &#x27;_docker_device_write_bps&#x27;, default=omit) }}&quot;</span><span class="diff-line del">-    device_write_iops: &quot;{{ lookup(&#x27;vars&#x27;, _var_prefix + &#x27;_docker_device_write_iops&#x27;, default=omit) }}&quot;</span><span class="diff-line del">-    devices: &quot;{{ lookup(&#x27;vars&#x27;, _var_prefix + &#x27;_docker_devices&#x27;, default=omit) }}&quot;</span><span class="diff-line del">-    dns_opts: &quot;{{ lookup(&#x27;vars&#x27;, _var_prefix + &#x27;_docker_dns_opts&#x27;, default=omit) }}&quot;</span><span class="diff-line del">-    dns_search_domains: &quot;{{ lookup(&#x27;vars&#x27;, _var_prefix + &#x27;_docker_dns_search_domains&#x27;, default=omit) }}&quot;</span><span class="diff-line del">-    dns_servers: &quot;{{ lookup(&#x27;vars&#x27;, _var_prefix + &#x27;_docker_dns_servers&#x27;, default=omit) }}&quot;</span><span class="diff-line del">-    domainname: &quot;{{ lookup(&#x27;vars&#x27;, _var_prefix + &#x27;_docker_domainname&#x27;, default=omit) }}&quot;</span><span class="diff-line del">-    entrypoint: &quot;{{ lookup(&#x27;vars&#x27;, _var_prefix + &#x27;_docker_entrypoint&#x27;, default=omit) }}&quot;</span><span class="diff-line del">-    env: &quot;{{ (nvidia_docker_env if use_nvidia else {})</span><span class="diff-line del">-             | combine(lookup(&#x27;vars&#x27;, _var_prefix + &#x27;_docker_envs&#x27;, default={}))</span><span class="diff-line del">-             | default(omit) }}&quot;</span><span class="diff-line del">-    env_file: &quot;{{ lookup(&#x27;vars&#x27;, _var_prefix + &#x27;_docker_env_file&#x27;, default=omit) }}&quot;</span><span class="diff-line del">-    etc_hosts: &quot;{{ lookup(&#x27;vars&#x27;, _var_prefix + &#x27;_docker_hosts&#x27;, default=omit)</span><span class="diff-line del">-                if not (&#x27;container:&#x27; in lookup(&#x27;vars&#x27;, _var_prefix + &#x27;_docker_network_mode&#x27;, default=docker_networks_name_common))</span><span class="diff-line del">-                else {} }}&quot;</span><span class="diff-line del">-    exposed_ports: &quot;{{ (lookup(&#x27;vars&#x27;, _var_prefix + &#x27;_docker_exposed_ports&#x27;, default=[]) | unique | reject(&#x27;equalto&#x27;, omit) | list)</span><span class="diff-line del">-                    if not (&#x27;container:&#x27; in lookup(&#x27;vars&#x27;, _var_prefix + &#x27;_docker_network_mode&#x27;, default=docker_networks_name_common))</span><span class="diff-line del">-                    else [] }}&quot;</span><span class="diff-line del">-    groups: &quot;{{ lookup(&#x27;vars&#x27;, _var_prefix + &#x27;_docker_groups&#x27;, default=omit) }}&quot;</span><span class="diff-line del">-    healthcheck: &quot;{{ lookup(&#x27;vars&#x27;, _var_prefix + &#x27;_docker_healthcheck&#x27;, default=omit) }}&quot;</span><span class="diff-line del">-    hostname: &quot;{{ lookup(&#x27;vars&#x27;, _var_prefix + &#x27;_docker_hostname&#x27;, default=omit)</span><span class="diff-line del">-               if (lookup(&#x27;vars&#x27;, _var_prefix + &#x27;_docker_network_mode&#x27;, default=docker_networks_name_common) == docker_networks_name_common)</span><span class="diff-line add">+    detach: true</span><span class="diff-line add">+    device_cgroup_rules: &quot;{{ lookup(&#x27;docker_var&#x27;, &#x27;_docker_device_cgroup_rules&#x27;, default=omit) }}&quot;</span><span class="diff-line add">+    device_read_bps: &quot;{{ lookup(&#x27;docker_var&#x27;, &#x27;_docker_device_read_bps&#x27;, default=omit) }}&quot;</span><span class="diff-line add">+    device_read_iops: &quot;{{ lookup(&#x27;docker_var&#x27;, &#x27;_docker_device_read_iops&#x27;, default=omit) }}&quot;</span><span class="diff-line add">+    device_requests: &quot;{{ lookup(&#x27;docker_var&#x27;, &#x27;_docker_device_requests&#x27;, default=omit) }}&quot;</span><span class="diff-line add">+    device_write_bps: &quot;{{ lookup(&#x27;docker_var&#x27;, &#x27;_docker_device_write_bps&#x27;, default=omit) }}&quot;</span><span class="diff-line add">+    device_write_iops: &quot;{{ lookup(&#x27;docker_var&#x27;, &#x27;_docker_device_write_iops&#x27;, default=omit) }}&quot;</span><span class="diff-line add">+    devices: &quot;{{ lookup(&#x27;docker_var&#x27;, &#x27;_docker_devices&#x27;, default=omit) }}&quot;</span><span class="diff-line add">+    dns_opts: &quot;{{ lookup(&#x27;docker_var&#x27;, &#x27;_docker_dns_opts&#x27;, default=omit) }}&quot;</span><span class="diff-line add">+    dns_search_domains: &quot;{{ lookup(&#x27;docker_var&#x27;, &#x27;_docker_dns_search_domains&#x27;, default=omit) }}&quot;</span><span class="diff-line add">+    dns_servers: &quot;{{ lookup(&#x27;docker_var&#x27;, &#x27;_docker_dns_servers&#x27;, default=omit) }}&quot;</span><span class="diff-line add">+    domainname: &quot;{{ lookup(&#x27;docker_var&#x27;, &#x27;_docker_domainname&#x27;, default=omit) }}&quot;</span><span class="diff-line add">+    entrypoint: &quot;{{ lookup(&#x27;docker_var&#x27;, &#x27;_docker_entrypoint&#x27;, default=omit) }}&quot;</span><span class="diff-line add">+    env: &quot;{{ _docker_env</span><span class="diff-line add">+          if (_docker_env | length &gt; 0)</span><span class="diff-line add">+          else omit }}&quot;</span><span class="diff-line add">+    env_file: &quot;{{ lookup(&#x27;docker_var&#x27;, &#x27;_docker_env_file&#x27;, default=omit) }}&quot;</span><span class="diff-line add">+    etc_hosts: &quot;{{ _docker_etc_hosts</span><span class="diff-line add">+                if (_docker_etc_hosts | length &gt; 0)</span><span class="diff-line add">+                else omit }}&quot;</span><span class="diff-line add">+    exposed_ports: &quot;{{ _docker_exposed_ports</span><span class="diff-line add">+                    if (_docker_exposed_ports | length &gt; 0)</span><span class="diff-line add">+                    else omit }}&quot;</span><span class="diff-line add">+    groups: &quot;{{ lookup(&#x27;docker_var&#x27;, &#x27;_docker_groups&#x27;, default=omit) }}&quot;</span><span class="diff-line add">+    healthcheck: &quot;{{ lookup(&#x27;docker_var&#x27;, &#x27;_docker_healthcheck&#x27;, default=omit) }}&quot;</span><span class="diff-line add">+    healthy_wait_timeout: &quot;{{ lookup(&#x27;docker_var&#x27;, &#x27;_docker_healthy_wait_timeout&#x27;, default=300) }}&quot;</span><span class="diff-line add">+    hostname: &quot;{{ _docker_hostname</span><span class="diff-line add">+               if (_docker_hostname | length &gt; 0)</span><span class="diff-line context">                else omit }}&quot;</span><span class="diff-line del">-    image: &quot;{{ lookup(&#x27;vars&#x27;, _var_prefix + &#x27;_docker_image&#x27;) }}&quot;</span><span class="diff-line del">-    init: &quot;{{ lookup(&#x27;vars&#x27;, _var_prefix + &#x27;_docker_init&#x27;, default=omit) }}&quot;</span><span class="diff-line del">-    ipc_mode: &quot;{{ lookup(&#x27;vars&#x27;, _var_prefix + &#x27;_docker_ipc_mode&#x27;, default=omit) }}&quot;</span><span class="diff-line del">-    keep_volumes: &quot;{{ lookup(&#x27;vars&#x27;, _var_prefix + &#x27;_docker_keep_volumes&#x27;, default=omit) }}&quot;</span><span class="diff-line del">-    kernel_memory: &quot;{{ lookup(&#x27;vars&#x27;, _var_prefix + &#x27;_docker_kernel_memory&#x27;, default=omit) }}&quot;</span><span class="diff-line del">-    labels: &quot;{{ lookup(&#x27;vars&#x27;, _var_prefix + &#x27;_docker_labels&#x27;, default=omit) }}&quot;</span><span class="diff-line del">-    links: &quot;{{ lookup(&#x27;vars&#x27;, _var_prefix + &#x27;_docker_links&#x27;, default=omit) }}&quot;</span><span class="diff-line del">-    log_driver: &quot;{{ (docker_log_driver != &#x27;default&#x27;) | ternary(docker_log_driver, lookup(&#x27;vars&#x27;, _var_prefix + &#x27;_docker_log_driver&#x27;, default=omit)) }}&quot;</span><span class="diff-line del">-    log_options: &quot;{{ (docker_log_options != &#x27;default&#x27;) | ternary(docker_log_options, lookup(&#x27;vars&#x27;, _var_prefix + &#x27;_docker_log_options&#x27;, default=omit)) }}&quot;</span><span class="diff-line del">-    memory: &quot;{{ (docker_memory_default is defined) | ternary(docker_memory_default, lookup(&#x27;vars&#x27;, _var_prefix + &#x27;_docker_memory&#x27;, default=omit)) }}&quot;</span><span class="diff-line del">-    memory_reservation: &quot;{{ lookup(&#x27;vars&#x27;, _var_prefix + &#x27;_docker_memory_reservation&#x27;, default=omit) }}&quot;</span><span class="diff-line del">-    memory_swap: &quot;{{ lookup(&#x27;vars&#x27;, _var_prefix + &#x27;_docker_memory_swap&#x27;, default=omit) }}&quot;</span><span class="diff-line del">-    memory_swappiness: &quot;{{ lookup(&#x27;vars&#x27;, _var_prefix + &#x27;_docker_memory_swappiness&#x27;, default=omit) }}&quot;</span><span class="diff-line del">-    mounts: &quot;{{ lookup(&#x27;vars&#x27;, _var_prefix + &#x27;_docker_mounts&#x27;, default=omit) }}&quot;</span><span class="diff-line del">-    name: &quot;{{ lookup(&#x27;vars&#x27;, _var_prefix + &#x27;_docker_container&#x27;, default=_var_prefix) }}&quot;</span><span class="diff-line del">-    network_mode: &quot;{{ lookup(&#x27;vars&#x27;, _var_prefix + &#x27;_docker_network_mode&#x27;, default=docker_networks_name_common) }}&quot;</span><span class="diff-line del">-    networks: &quot;{{ omit</span><span class="diff-line del">-               if (lookup(&#x27;vars&#x27;, _var_prefix + &#x27;_docker_network_mode&#x27;, default=docker_networks_name_common) == &#x27;host&#x27;) or (&#x27;container&#x27; in lookup(&#x27;vars&#x27;, _var_prefix + &#x27;_docker_network_mode&#x27;, default=docker_networks_name_common))</span><span class="diff-line del">-               else lookup(&#x27;vars&#x27;, _var_prefix + &#x27;_docker_networks&#x27;) }}&quot;</span><span class="diff-line add">+    image: &quot;{{ lookup(&#x27;docker_var&#x27;, &#x27;_docker_image&#x27;) }}&quot;</span><span class="diff-line add">+    image_comparison: &quot;desired-image&quot;</span><span class="diff-line add">+    image_label_mismatch: &quot;ignore&quot;</span><span class="diff-line add">+    image_name_mismatch: &quot;recreate&quot;</span><span class="diff-line add">+    init: &quot;{{ lookup(&#x27;docker_var&#x27;, &#x27;_docker_init&#x27;, default=omit) }}&quot;</span><span class="diff-line add">+    ipc_mode: &quot;{{ lookup(&#x27;docker_var&#x27;, &#x27;_docker_ipc_mode&#x27;, default=omit) }}&quot;</span><span class="diff-line add">+    keep_volumes: &quot;{{ lookup(&#x27;docker_var&#x27;, &#x27;_docker_keep_volumes&#x27;, default=omit) }}&quot;</span><span class="diff-line add">+    kernel_memory: &quot;{{ lookup(&#x27;docker_var&#x27;, &#x27;_docker_kernel_memory&#x27;, default=omit) }}&quot;</span><span class="diff-line add">+    kill_signal: &quot;{{ lookup(&#x27;docker_var&#x27;, &#x27;_docker_kill_signal&#x27;, default=omit) }}&quot;</span><span class="diff-line add">+    labels: &quot;{{ _docker_labels</span><span class="diff-line add">+             if (_docker_labels | length &gt; 0)</span><span class="diff-line add">+             else omit }}&quot;</span><span class="diff-line add">+    links: &quot;{{ lookup(&#x27;docker_var&#x27;, &#x27;_docker_links&#x27;, default=omit) }}&quot;</span><span class="diff-line add">+    log_driver: &quot;{{ _docker_log_driver</span><span class="diff-line add">+                 if (_docker_log_driver | length &gt; 0)</span><span class="diff-line add">+                 else omit }}&quot;</span><span class="diff-line add">+    log_options: &quot;{{ _docker_log_options</span><span class="diff-line add">+                  if (_docker_log_options | length &gt; 0)</span><span class="diff-line add">+                  else omit }}&quot;</span><span class="diff-line add">+    memory: &quot;{{ _docker_memory</span><span class="diff-line add">+             if (_docker_memory | length &gt; 0)</span><span class="diff-line add">+             else omit }}&quot;</span><span class="diff-line add">+    memory_reservation: &quot;{{ lookup(&#x27;docker_var&#x27;, &#x27;_docker_memory_reservation&#x27;, default=omit) }}&quot;</span><span class="diff-line add">+    memory_swap: &quot;{{ lookup(&#x27;docker_var&#x27;, &#x27;_docker_memory_swap&#x27;, default=omit) }}&quot;</span><span class="diff-line add">+    memory_swappiness: &quot;{{ lookup(&#x27;docker_var&#x27;, &#x27;_docker_memory_swappiness&#x27;, default=omit) }}&quot;</span><span class="diff-line add">+    mounts: &quot;{{ lookup(&#x27;docker_var&#x27;, &#x27;_docker_mounts&#x27;, default=omit) }}&quot;</span><span class="diff-line add">+    name: &quot;{{ lookup(&#x27;docker_var&#x27;, &#x27;_docker_container&#x27;, default=_instance_name) }}&quot;</span><span class="diff-line add">+    network_mode: &quot;{{ lookup(&#x27;docker_var&#x27;, &#x27;_docker_network_mode&#x27;, default=docker_networks_name_common) }}&quot;</span><span class="diff-line add">+    networks: &quot;{{ _docker_networks</span><span class="diff-line add">+               if (_docker_networks | length &gt; 0)</span><span class="diff-line add">+               else omit }}&quot;</span><span class="diff-line context">     networks_cli_compatible: true</span><span class="diff-line del">-    oom_killer: &quot;{{ lookup(&#x27;vars&#x27;, _var_prefix + &#x27;_docker_oom_killer&#x27;, default=omit) }}&quot;</span><span class="diff-line del">-    oom_score_adj: &quot;{{ lookup(&#x27;vars&#x27;, _var_prefix + &#x27;_docker_oom_score_adj&#x27;, default=omit) }}&quot;</span><span class="diff-line del">-    output_logs: &quot;{{ lookup(&#x27;vars&#x27;, _var_prefix + &#x27;_docker_output_logs&#x27;, default=omit) }}&quot;</span><span class="diff-line del">-    paused: &quot;{{ lookup(&#x27;vars&#x27;, _var_prefix + &#x27;_docker_paused&#x27;, default=omit) }}&quot;</span><span class="diff-line del">-    pid_mode: &quot;{{ lookup(&#x27;vars&#x27;, _var_prefix + &#x27;_docker_pid_mode&#x27;, default=omit) }}&quot;</span><span class="diff-line del">-    privileged: &quot;{{ lookup(&#x27;vars&#x27;, _var_prefix + &#x27;_docker_privileged&#x27;, default=omit) }}&quot;</span><span class="diff-line del">-    published_ports: &quot;{{ (lookup(&#x27;vars&#x27;, _var_prefix + &#x27;_docker_ports&#x27;, default=[]) | unique | reject(&#x27;equalto&#x27;, omit) | list)</span><span class="diff-line del">-                      if not (&#x27;container:&#x27; in lookup(&#x27;vars&#x27;, _var_prefix + &#x27;_docker_network_mode&#x27;, default=docker_networks_name_common))</span><span class="diff-line del">-                      else [] }}&quot;</span><span class="diff-line del">-    pull: &quot;{{ lookup(&#x27;vars&#x27;, _var_prefix + &#x27;_docker_image_pull&#x27;, default=true) | bool }}&quot;</span><span class="diff-line del">-    read_only: &quot;{{ lookup(&#x27;vars&#x27;, _var_prefix + &#x27;_docker_read_only&#x27;, default=omit) }}&quot;</span><span class="diff-line del">-    recreate: &quot;{{ lookup(&#x27;vars&#x27;, _var_prefix + &#x27;_docker_recreate&#x27;, default=omit) }}&quot;</span><span class="diff-line del">-    restart_policy: &quot;{{ lookup(&#x27;vars&#x27;, _var_prefix + &#x27;_docker_restart_policy&#x27;, default=&#x27;unless-stopped&#x27;) }}&quot;</span><span class="diff-line del">-    restart_retries: &quot;{{ lookup(&#x27;vars&#x27;, _var_prefix + &#x27;_docker_restart_retries&#x27;, default=omit) }}&quot;</span><span class="diff-line del">-    runtime: &quot;{{ lookup(&#x27;vars&#x27;, _var_prefix + &#x27;_docker_runtime&#x27;, default=omit) }}&quot;</span><span class="diff-line del">-    security_opts: &quot;{{ lookup(&#x27;vars&#x27;, _var_prefix + &#x27;_docker_security_opts&#x27;, default=omit) }}&quot;</span><span class="diff-line del">-    shm_size: &quot;{{ lookup(&#x27;vars&#x27;, _var_prefix + &#x27;_docker_shm_size&#x27;, default=omit) }}&quot;</span><span class="diff-line add">+    oom_killer: &quot;{{ lookup(&#x27;docker_var&#x27;, &#x27;_docker_oom_killer&#x27;, default=omit) }}&quot;</span><span class="diff-line add">+    oom_score_adj: &quot;{{ lookup(&#x27;docker_var&#x27;, &#x27;_docker_oom_score_adj&#x27;, default=omit) }}&quot;</span><span class="diff-line add">+    output_logs: &quot;{{ lookup(&#x27;docker_var&#x27;, &#x27;_docker_output_logs&#x27;, default=omit) }}&quot;</span><span class="diff-line add">+    paused: &quot;{{ lookup(&#x27;docker_var&#x27;, &#x27;_docker_paused&#x27;, default=omit) }}&quot;</span><span class="diff-line add">+    pid_mode: &quot;{{ lookup(&#x27;docker_var&#x27;, &#x27;_docker_pid_mode&#x27;, default=omit) }}&quot;</span><span class="diff-line add">+    privileged: &quot;{{ lookup(&#x27;docker_var&#x27;, &#x27;_docker_privileged&#x27;, default=omit) }}&quot;</span><span class="diff-line add">+    published_ports: &quot;{{ _docker_published_ports</span><span class="diff-line add">+                      if (_docker_published_ports | length &gt; 0)</span><span class="diff-line add">+                      else omit }}&quot;</span><span class="diff-line add">+    pull: &quot;{{ lookup(&#x27;docker_var&#x27;, &#x27;_docker_image_pull&#x27;, default=true) | bool }}&quot;</span><span class="diff-line add">+    pull_check_mode_behavior: &quot;image_not_present&quot;</span><span class="diff-line add">+    read_only: &quot;{{ lookup(&#x27;docker_var&#x27;, &#x27;_docker_read_only&#x27;, default=omit) }}&quot;</span><span class="diff-line add">+    recreate: &quot;{{ lookup(&#x27;docker_var&#x27;, &#x27;_docker_recreate&#x27;, default=omit) }}&quot;</span><span class="diff-line add">+    restart_policy: &quot;{{ lookup(&#x27;docker_var&#x27;, &#x27;_docker_restart_policy&#x27;, default=&#x27;unless-stopped&#x27;) }}&quot;</span><span class="diff-line add">+    restart_retries: &quot;{{ lookup(&#x27;docker_var&#x27;, &#x27;_docker_restart_retries&#x27;, default=omit) }}&quot;</span><span class="diff-line add">+    runtime: &quot;{{ lookup(&#x27;docker_var&#x27;, &#x27;_docker_runtime&#x27;, default=omit) }}&quot;</span><span class="diff-line add">+    security_opts: &quot;{{ lookup(&#x27;docker_var&#x27;, &#x27;_docker_security_opts&#x27;, default=omit) }}&quot;</span><span class="diff-line add">+    shm_size: &quot;{{ lookup(&#x27;docker_var&#x27;, &#x27;_docker_shm_size&#x27;, default=omit) }}&quot;</span><span class="diff-line context">     state: started</span><span class="diff-line del">-    stop_timeout: &quot;{{ lookup(&#x27;vars&#x27;, _var_prefix + &#x27;_docker_stop_timeout&#x27;, default=&#x27;10&#x27;) }}&quot;</span><span class="diff-line del">-    storage_opts: &quot;{{ lookup(&#x27;vars&#x27;, _var_prefix + &#x27;_docker_storage_opts&#x27;, default=omit) }}&quot;</span><span class="diff-line del">-    sysctls: &quot;{{ lookup(&#x27;vars&#x27;, _var_prefix + &#x27;_docker_sysctls&#x27;, default=omit) }}&quot;</span><span class="diff-line add">+    stop_timeout: &quot;{{ lookup(&#x27;docker_var&#x27;, &#x27;_docker_stop_timeout&#x27;, default=&#x27;10&#x27;) }}&quot;</span><span class="diff-line add">+    storage_opts: &quot;{{ lookup(&#x27;docker_var&#x27;, &#x27;_docker_storage_opts&#x27;, default=omit) }}&quot;</span><span class="diff-line add">+    sysctls: &quot;{{ lookup(&#x27;docker_var&#x27;, &#x27;_docker_sysctls&#x27;, default=omit) }}&quot;</span><span class="diff-line context">     tls_hostname: localhost</span><span class="diff-line del">-    tmpfs: &quot;{{ lookup(&#x27;vars&#x27;, _var_prefix + &#x27;_docker_tmpfs&#x27;, default=omit) }}&quot;</span><span class="diff-line del">-    ulimits: &quot;{{ lookup(&#x27;vars&#x27;, _var_prefix + &#x27;_docker_ulimits&#x27;, default=omit) }}&quot;</span><span class="diff-line del">-    user: &quot;{{ lookup(&#x27;vars&#x27;, _var_prefix + &#x27;_docker_user&#x27;, default=omit) }}&quot;</span><span class="diff-line del">-    userns_mode: &quot;{{ lookup(&#x27;vars&#x27;, _var_prefix + &#x27;_docker_userns_mode&#x27;, default=omit) }}&quot;</span><span class="diff-line del">-    uts: &quot;{{ lookup(&#x27;vars&#x27;, _var_prefix + &#x27;_docker_uts&#x27;, default=omit) }}&quot;</span><span class="diff-line del">-    volume_driver: &quot;{{ lookup(&#x27;vars&#x27;, _var_prefix + &#x27;_docker_volume_driver&#x27;, default=omit) }}&quot;</span><span class="diff-line del">-    volumes: &quot;{{ ((docker_volumes_common + lookup(&#x27;vars&#x27;, _var_prefix + &#x27;_docker_volumes&#x27;, default=omit))</span><span class="diff-line del">-              if (lookup(&#x27;vars&#x27;, _var_prefix + &#x27;_docker_volumes_global&#x27;, default=true) | bool)</span><span class="diff-line del">-              else lookup(&#x27;vars&#x27;, _var_prefix + &#x27;_docker_volumes&#x27;, default=omit)) | unique | reject(&#x27;equalto&#x27;, omit) | list }}&quot;</span><span class="diff-line del">-    volumes_from: &quot;{{ lookup(&#x27;vars&#x27;, _var_prefix + &#x27;_docker_volumes_from&#x27;, default=omit) }}&quot;</span><span class="diff-line del">-    working_dir: &quot;{{ lookup(&#x27;vars&#x27;, _var_prefix + &#x27;_docker_working_dir&#x27;, default=omit) }}&quot;</span><span class="diff-line add">+    tmpfs: &quot;{{ lookup(&#x27;docker_var&#x27;, &#x27;_docker_tmpfs&#x27;, default=omit) }}&quot;</span><span class="diff-line add">+    ulimits: &quot;{{ lookup(&#x27;docker_var&#x27;, &#x27;_docker_ulimits&#x27;, default=omit) }}&quot;</span><span class="diff-line add">+    user: &quot;{{ lookup(&#x27;docker_var&#x27;, &#x27;_docker_user&#x27;, default=omit) }}&quot;</span><span class="diff-line add">+    userns_mode: &quot;{{ lookup(&#x27;docker_var&#x27;, &#x27;_docker_userns_mode&#x27;, default=omit) }}&quot;</span><span class="diff-line add">+    uts: &quot;{{ lookup(&#x27;docker_var&#x27;, &#x27;_docker_uts&#x27;, default=omit) }}&quot;</span><span class="diff-line add">+    volume_driver: &quot;{{ lookup(&#x27;docker_var&#x27;, &#x27;_docker_volume_driver&#x27;, default=omit) }}&quot;</span><span class="diff-line add">+    volumes: &quot;{{ _docker_volumes</span><span class="diff-line add">+              if (_docker_volumes | length &gt; 0)</span><span class="diff-line add">+              else omit }}&quot;</span><span class="diff-line add">+    volumes_from: &quot;{{ lookup(&#x27;docker_var&#x27;, &#x27;_docker_volumes_from&#x27;, default=omit) }}&quot;</span><span class="diff-line add">+    working_dir: &quot;{{ lookup(&#x27;docker_var&#x27;, &#x27;_docker_working_dir&#x27;, default=omit) }}&quot;</span><span class="diff-line context">   register: create_docker_result</span><span class="diff-line context">   retries: &quot;{{ ansible_retry_count</span><span class="diff-line context">             if (not continuous_integration)</span><span class="diff-line context">             else ansible_retry_count_ci }}&quot;</span><span class="diff-line del">-  timeout: &quot;{{ 300</span><span class="diff-line add">+  timeout: &quot;{{ lookup(&#x27;docker_var&#x27;, &#x27;_docker_create_timeout&#x27;, default=120)</span><span class="diff-line context">             if continuous_integration</span><span class="diff-line context">             else omit }}&quot;</span><span class="diff-line context">   delay: 10</span><span class="diff-line del">-  until: create_docker_result is succeeded</span><span class="diff-line add">+  until: (create_docker_result is succeeded)</span><span class="diff-line context"> </span><span class="diff-line del">-- name: Resources | Tasks | Docker | Create Docker Container | Prune dangling images</span><span class="diff-line add">+- name: &quot;Resources | Tasks | Docker | Create Docker Container | Wait for {{ docker_create_image_prune_delay_timeout }} seconds&quot;</span><span class="diff-line add">+  ansible.builtin.wait_for:</span><span class="diff-line add">+    timeout: &quot;{{ docker_create_image_prune_delay_timeout }}&quot;</span><span class="diff-line add">+  when: docker_create_image_prune and docker_create_image_prune_delay</span><span class="diff-line add">+</span><span class="diff-line add">+- name: Resources | Tasks | Docker | Create Docker Container | Prune images</span><span class="diff-line context">   community.docker.docker_prune:</span><span class="diff-line context">     images: true</span><span class="diff-line context">     images_filters:</span><span class="diff-line del">-      dangling: true</span><span class="diff-line add">+      until: 24h</span><span class="diff-line add">+    timeout: 120</span><span class="diff-line context">   when: docker_create_image_prune</span><span class="diff-line context">   register: prune_images_result</span><span class="diff-line context">   retries: &quot;{{ ansible_retry_count</span><span class="diff-line context">             if (not continuous_integration)</span><span class="diff-line context">             else ansible_retry_count_ci }}&quot;</span><span class="diff-line context">   delay: 10</span><span class="diff-line del">-  until: prune_images_result is succeeded</span><span class="diff-line add">+  until: (prune_images_result is succeeded)</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-80">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>resources/tasks/docker/network_container_health_status.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -11,17 +11,21 @@</span><span class="diff-line context">   ansible.builtin.wait_for:</span><span class="diff-line context">     timeout: &quot;{{ docker_network_container_health_delay }}&quot;</span><span class="diff-line context"> </span><span class="diff-line del">-- name: Resources | Tasks | Docker | Network Container Health Status | Check health of network linked container</span><span class="diff-line add">+- name: &quot;Resources | Tasks | Docker | Network Container Health Status | Set instance name&quot;</span><span class="diff-line add">+  ansible.builtin.set_fact:</span><span class="diff-line add">+    _instance_name: &quot;{{ lookup(&#x27;vars&#x27;, _var_prefix + &#x27;_name&#x27;, default=_var_prefix) }}&quot;</span><span class="diff-line add">+</span><span class="diff-line add">+- name: &quot;Resources | Tasks | Docker | Network Container Health Status | Check health of network linked container&quot;</span><span class="diff-line context">   community.docker.docker_container_info:</span><span class="diff-line del">-    name: &quot;{{ lookup(&#x27;vars&#x27;, _var_prefix + &#x27;_docker_network_mode&#x27;, default=docker_networks_name_common).split(&#x27;:&#x27;)[1] }}&quot;</span><span class="diff-line add">+    name: &quot;{{ lookup(&#x27;docker_var&#x27;, &#x27;_docker_network_mode&#x27;, default=docker_networks_name_common).split(&#x27;:&#x27;)[1] }}&quot;</span><span class="diff-line context">   register: docker_info</span><span class="diff-line context"> </span><span class="diff-line del">-- name: Resources | Tasks | Docker | Network Container Health Status | Fail if network linked container does not exist</span><span class="diff-line add">+- name: &quot;Resources | Tasks | Docker | Network Container Health Status | Fail if network linked container does not exist&quot;</span><span class="diff-line context">   ansible.builtin.fail:</span><span class="diff-line del">-    msg: &quot;{{ lookup(&#x27;vars&#x27;, _var_prefix + &#x27;_docker_container&#x27;, default=_var_prefix) }} is configured to use {{ lookup(&#x27;vars&#x27;, _var_prefix + &#x27;_docker_network_mode&#x27;, default=docker_networks_name_common).split(&#x27;:&#x27;)[1] }} for networking but it does not exist&quot;</span><span class="diff-line del">-  when: not docker_info.exists</span><span class="diff-line add">+    msg: &quot;{{ lookup(&#x27;docker_var&#x27;, &#x27;_docker_container&#x27;, default=_var_prefix) }} is configured to use {{ lookup(&#x27;docker_var&#x27;, &#x27;_docker_network_mode&#x27;, default=docker_networks_name_common).split(&#x27;:&#x27;)[1] }} for networking but it does not exist&quot;</span><span class="diff-line add">+  when: (not docker_info.exists)</span><span class="diff-line context"> </span><span class="diff-line del">-- name: Resources | Tasks | Docker | Network Container Health Status | Fail if network linked container is not healthy</span><span class="diff-line add">+- name: &quot;Resources | Tasks | Docker | Network Container Health Status | Fail if network linked container is not healthy&quot;</span><span class="diff-line context">   ansible.builtin.fail:</span><span class="diff-line del">-    msg: &quot;{{ lookup(&#x27;vars&#x27;, _var_prefix + &#x27;_docker_container&#x27;, default=_var_prefix) }} is configured to use {{ lookup(&#x27;vars&#x27;, _var_prefix + &#x27;_docker_network_mode&#x27;, default=docker_networks_name_common).split(&#x27;:&#x27;)[1] }} for networking but it is not healthy&quot;</span><span class="diff-line del">-  when: (&#x27;State&#x27; not in docker_info.container or &#x27;Health&#x27; not in docker_info.container.State or &#x27;Status&#x27; not in docker_info.container.State.Health or docker_info.container.State.Health.Status != &#x27;healthy&#x27;)</span><span class="diff-line add">+    msg: &quot;{{ lookup(&#x27;docker_var&#x27;, &#x27;_docker_container&#x27;, default=_var_prefix) }} is configured to use {{ lookup(&#x27;docker_var&#x27;, &#x27;_docker_network_mode&#x27;, default=docker_networks_name_common).split(&#x27;:&#x27;)[1] }} for networking but it is not healthy&quot;</span><span class="diff-line add">+  when: ((&#x27;State&#x27; not in docker_info.container) or (&#x27;Health&#x27; not in docker_info.container.State) or (&#x27;Status&#x27; not in docker_info.container.State.Health) or (docker_info.container.State.Health.Status != &#x27;healthy&#x27;))</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-81">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>resources/tasks/docker/remove_docker_container.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -13,18 +13,22 @@</span><span class="diff-line context">                   if (var_prefix is defined)</span><span class="diff-line context">                   else role_name }}&quot;</span><span class="diff-line context"> </span><span class="diff-line add">+- name: Resources | Tasks | Docker | Remove Docker Container | Set instance name</span><span class="diff-line add">+  ansible.builtin.set_fact:</span><span class="diff-line add">+    _instance_name: &quot;{{ lookup(&#x27;vars&#x27;, _var_prefix + &#x27;_name&#x27;, default=_var_prefix) }}&quot;</span><span class="diff-line add">+</span><span class="diff-line context"> - name: Resources | Tasks | Docker | Remove Docker Container | Remove Docker Container</span><span class="diff-line context">   community.docker.docker_container:</span><span class="diff-line context">     container_default_behavior: compatibility</span><span class="diff-line del">-    force_kill: &quot;{{ lookup(&#x27;vars&#x27;, _var_prefix + &#x27;_docker_force_kill&#x27;, default=omit) }}&quot;</span><span class="diff-line del">-    kill_signal: &quot;{{ lookup(&#x27;vars&#x27;, _var_prefix + &#x27;_docker_kill_signal&#x27;, default=omit) }}&quot;</span><span class="diff-line del">-    name: &quot;{{ var_prefix | default(lookup(&#x27;vars&#x27;, _var_prefix + &#x27;_docker_container&#x27;, default=_var_prefix)) }}&quot;</span><span class="diff-line add">+    force_kill: &quot;{{ lookup(&#x27;docker_var&#x27;, &#x27;_docker_force_kill&#x27;, default=omit) }}&quot;</span><span class="diff-line add">+    kill_signal: &quot;{{ lookup(&#x27;docker_var&#x27;, &#x27;_docker_kill_signal&#x27;, default=omit) }}&quot;</span><span class="diff-line add">+    name: &quot;{{ lookup(&#x27;docker_var&#x27;, &#x27;_docker_container&#x27;, default=_var_prefix) }}&quot;</span><span class="diff-line context">     state: absent</span><span class="diff-line del">-    stop_timeout: &quot;{{ lookup(&#x27;vars&#x27;, _var_prefix + &#x27;_docker_stop_timeout&#x27;, default=&#x27;10&#x27;) }}&quot;</span><span class="diff-line add">+    stop_timeout: &quot;{{ lookup(&#x27;docker_var&#x27;, &#x27;_docker_stop_timeout&#x27;, default=&#x27;180&#x27;) }}&quot;</span><span class="diff-line context">     tls_hostname: localhost</span><span class="diff-line context">   register: remove_docker_result</span><span class="diff-line context">   retries: &quot;{{ ansible_retry_count</span><span class="diff-line context">             if (not continuous_integration)</span><span class="diff-line context">             else ansible_retry_count_ci }}&quot;</span><span class="diff-line context">   delay: 10</span><span class="diff-line del">-  until: remove_docker_result is succeeded</span><span class="diff-line add">+  until: (remove_docker_result is succeeded)</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-82">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>resources/tasks/docker/restart_docker_container.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -13,14 +13,18 @@</span><span class="diff-line context">                   if (var_prefix is defined)</span><span class="diff-line context">                   else role_name }}&quot;</span><span class="diff-line context"> </span><span class="diff-line add">+- name: Resources | Tasks | Docker | Restart Docker Container | Set instance name</span><span class="diff-line add">+  ansible.builtin.set_fact:</span><span class="diff-line add">+    _instance_name: &quot;{{ lookup(&#x27;vars&#x27;, _var_prefix + &#x27;_name&#x27;, default=_var_prefix) }}&quot;</span><span class="diff-line add">+</span><span class="diff-line context"> - name: Resources | Tasks | Docker | Restart Docker Container | Stop Docker Container</span><span class="diff-line context">   community.docker.docker_container:</span><span class="diff-line context">     container_default_behavior: compatibility</span><span class="diff-line del">-    force_kill: &quot;{{ lookup(&#x27;vars&#x27;, _var_prefix + &#x27;_docker_force_kill&#x27;, default=omit) }}&quot;</span><span class="diff-line del">-    kill_signal: &quot;{{ lookup(&#x27;vars&#x27;, _var_prefix + &#x27;_docker_kill_signal&#x27;, default=omit) }}&quot;</span><span class="diff-line del">-    name: &quot;{{ lookup(&#x27;vars&#x27;, _var_prefix + &#x27;_docker_container&#x27;, default=_var_prefix) }}&quot;</span><span class="diff-line add">+    force_kill: &quot;{{ lookup(&#x27;docker_var&#x27;, &#x27;_docker_force_kill&#x27;, default=omit) }}&quot;</span><span class="diff-line add">+    kill_signal: &quot;{{ lookup(&#x27;docker_var&#x27;, &#x27;_docker_kill_signal&#x27;, default=omit) }}&quot;</span><span class="diff-line add">+    name: &quot;{{ lookup(&#x27;docker_var&#x27;, &#x27;_docker_container&#x27;, default=_var_prefix) }}&quot;</span><span class="diff-line context">     state: stopped</span><span class="diff-line del">-    stop_timeout: &quot;{{ lookup(&#x27;vars&#x27;, _var_prefix + &#x27;_docker_stop_timeout&#x27;, default=&#x27;180&#x27;) }}&quot;</span><span class="diff-line add">+    stop_timeout: &quot;{{ lookup(&#x27;docker_var&#x27;, &#x27;_docker_stop_timeout&#x27;, default=&#x27;180&#x27;) }}&quot;</span><span class="diff-line context">     tls_hostname: localhost</span><span class="diff-line context">     comparisons:</span><span class="diff-line context">       &#x27;*&#x27;: ignore</span><span class="diff-line hunk">@@ -29,12 +33,12 @@</span><span class="diff-line context">             if (not continuous_integration)</span><span class="diff-line context">             else ansible_retry_count_ci }}&quot;</span><span class="diff-line context">   delay: 10</span><span class="diff-line del">-  until: stop_docker_result is succeeded</span><span class="diff-line add">+  until: (stop_docker_result is succeeded)</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Resources | Tasks | Docker | Restart Docker Container | Start Docker Container</span><span class="diff-line context">   community.docker.docker_container:</span><span class="diff-line context">     container_default_behavior: compatibility</span><span class="diff-line del">-    name: &quot;{{ lookup(&#x27;vars&#x27;, _var_prefix + &#x27;_docker_container&#x27;, default=_var_prefix) }}&quot;</span><span class="diff-line add">+    name: &quot;{{ lookup(&#x27;docker_var&#x27;, &#x27;_docker_container&#x27;, default=_var_prefix) }}&quot;</span><span class="diff-line context">     state: started</span><span class="diff-line context">     tls_hostname: localhost</span><span class="diff-line context">     comparisons:</span><span class="diff-line hunk">@@ -44,4 +48,4 @@</span><span class="diff-line context">             if (not continuous_integration)</span><span class="diff-line context">             else ansible_retry_count_ci }}&quot;</span><span class="diff-line context">   delay: 10</span><span class="diff-line del">-  until: start_docker_result is succeeded</span><span class="diff-line add">+  until: (start_docker_result is succeeded)</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-83">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>resources/tasks/docker/set_docker_devices_variable.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -21,4 +21,4 @@</span><span class="diff-line context"> </span><span class="diff-line context">     - name: Resources | Tasks | Docker | Set Docker Devices Variable | Set &#x27;docker_devices&#x27; variable # noqa var-naming[no-jinja]</span><span class="diff-line context">       ansible.builtin.set_fact:</span><span class="diff-line del">-        &quot;{{ docker_devices_var_name }}&quot;: &quot;{{ [&#x27;/dev/dri:/dev/dri&#x27;] + lookup(&#x27;vars&#x27;, role_name + &#x27;_docker_devices_default&#x27;, default=[]) }}&quot;</span><span class="diff-line add">+        &quot;{{ docker_devices_var_name }}&quot;: &quot;{{ [&#x27;/dev/dri:/dev/dri&#x27;] + lookup(&#x27;docker_var&#x27;, &#x27;_docker_devices_default&#x27;, default=[]) }}&quot;</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-84">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>resources/tasks/docker/start_docker_container.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -13,10 +13,14 @@</span><span class="diff-line context">                   if (var_prefix is defined)</span><span class="diff-line context">                   else role_name }}&quot;</span><span class="diff-line context"> </span><span class="diff-line add">+- name: Resources | Tasks | Docker | Start Docker Container | Set instance name</span><span class="diff-line add">+  ansible.builtin.set_fact:</span><span class="diff-line add">+    _instance_name: &quot;{{ lookup(&#x27;vars&#x27;, _var_prefix + &#x27;_name&#x27;, default=_var_prefix) }}&quot;</span><span class="diff-line add">+</span><span class="diff-line context"> - name: Resources | Tasks | Docker | Start Docker Container | Start Docker Container</span><span class="diff-line context">   community.docker.docker_container:</span><span class="diff-line context">     container_default_behavior: compatibility</span><span class="diff-line del">-    name: &quot;{{ lookup(&#x27;vars&#x27;, _var_prefix + &#x27;_docker_container&#x27;, default=_var_prefix) }}&quot;</span><span class="diff-line add">+    name: &quot;{{ lookup(&#x27;docker_var&#x27;, &#x27;_docker_container&#x27;, default=_var_prefix) }}&quot;</span><span class="diff-line context">     state: started</span><span class="diff-line context">     tls_hostname: localhost</span><span class="diff-line context">     comparisons:</span><span class="diff-line hunk">@@ -26,4 +30,4 @@</span><span class="diff-line context">             if (not continuous_integration)</span><span class="diff-line context">             else ansible_retry_count_ci }}&quot;</span><span class="diff-line context">   delay: 10</span><span class="diff-line del">-  until: start_docker_result is succeeded</span><span class="diff-line add">+  until: (start_docker_result is succeeded)</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-85">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>resources/tasks/docker/start_saltbox_docker_containers.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -12,8 +12,8 @@</span><span class="diff-line context"> </span><span class="diff-line context"> - name: &quot;Resources | Tasks | Docker | Start Saltbox Docker Containers | Get Docker service state&quot;</span><span class="diff-line context">   ansible.builtin.set_fact:</span><span class="diff-line del">-    start_docker_service_running: &quot;{{ (services[&#x27;docker.service&#x27;] is defined) and (services[&#x27;docker.service&#x27;][&#x27;state&#x27;] == &#x27;running&#x27;) }}&quot;</span><span class="diff-line del">-    start_docker_containers_docker_controller_service_running: &quot;{{ (services[&#x27;saltbox_managed_docker_controller.service&#x27;] is defined) and (services[&#x27;saltbox_managed_docker_controller.service&#x27;][&#x27;state&#x27;] == &#x27;running&#x27;) }}&quot;</span><span class="diff-line add">+    start_docker_service_running: &quot;{{ (ansible_facts[&#x27;services&#x27;][&#x27;docker.service&#x27;] is defined) and (ansible_facts[&#x27;services&#x27;][&#x27;docker.service&#x27;][&#x27;state&#x27;] == &#x27;running&#x27;) }}&quot;</span><span class="diff-line add">+    start_docker_containers_docker_controller_service_running: &quot;{{ (ansible_facts[&#x27;services&#x27;][&#x27;saltbox_managed_docker_controller.service&#x27;] is defined) and (ansible_facts[&#x27;services&#x27;][&#x27;saltbox_managed_docker_controller.service&#x27;][&#x27;state&#x27;] == &#x27;running&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Resources | Tasks | Docker | Start Saltbox Docker Containers | Run Controller Tasks</span><span class="diff-line context">   when: start_docker_service_running and start_docker_containers_docker_controller_service_running</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-86">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>resources/tasks/docker/stop_docker_container.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -13,14 +13,18 @@</span><span class="diff-line context">                   if (var_prefix is defined)</span><span class="diff-line context">                   else role_name }}&quot;</span><span class="diff-line context"> </span><span class="diff-line add">+- name: Resources | Tasks | Docker | Stop Docker Container | Set instance name</span><span class="diff-line add">+  ansible.builtin.set_fact:</span><span class="diff-line add">+    _instance_name: &quot;{{ lookup(&#x27;vars&#x27;, _var_prefix + &#x27;_name&#x27;, default=_var_prefix) }}&quot;</span><span class="diff-line add">+</span><span class="diff-line context"> - name: Resources | Tasks | Docker | Stop Docker Container | Stop Docker Container</span><span class="diff-line context">   community.docker.docker_container:</span><span class="diff-line context">     container_default_behavior: compatibility</span><span class="diff-line del">-    force_kill: &quot;{{ lookup(&#x27;vars&#x27;, _var_prefix + &#x27;_docker_force_kill&#x27;, default=omit) }}&quot;</span><span class="diff-line del">-    kill_signal: &quot;{{ lookup(&#x27;vars&#x27;, _var_prefix + &#x27;_docker_kill_signal&#x27;, default=omit) }}&quot;</span><span class="diff-line del">-    name: &quot;{{ lookup(&#x27;vars&#x27;, _var_prefix + &#x27;_docker_container&#x27;, default=_var_prefix) }}&quot;</span><span class="diff-line add">+    force_kill: &quot;{{ lookup(&#x27;docker_var&#x27;, &#x27;_docker_force_kill&#x27;, default=omit) }}&quot;</span><span class="diff-line add">+    kill_signal: &quot;{{ lookup(&#x27;docker_var&#x27;, &#x27;_docker_kill_signal&#x27;, default=omit) }}&quot;</span><span class="diff-line add">+    name: &quot;{{ lookup(&#x27;docker_var&#x27;, &#x27;_docker_container&#x27;, default=_var_prefix) }}&quot;</span><span class="diff-line context">     state: stopped</span><span class="diff-line del">-    stop_timeout: &quot;{{ lookup(&#x27;vars&#x27;, _var_prefix + &#x27;_docker_stop_timeout&#x27;, default=&#x27;180&#x27;) }}&quot;</span><span class="diff-line add">+    stop_timeout: &quot;{{ lookup(&#x27;docker_var&#x27;, &#x27;_docker_stop_timeout&#x27;, default=&#x27;180&#x27;) }}&quot;</span><span class="diff-line context">     tls_hostname: localhost</span><span class="diff-line context">     comparisons:</span><span class="diff-line context">       &#x27;*&#x27;: ignore</span><span class="diff-line hunk">@@ -29,4 +33,4 @@</span><span class="diff-line context">             if (not continuous_integration)</span><span class="diff-line context">             else ansible_retry_count_ci }}&quot;</span><span class="diff-line context">   delay: 10</span><span class="diff-line del">-  until: stop_docker_result is succeeded</span><span class="diff-line add">+  until: (stop_docker_result is succeeded)</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-87">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>resources/tasks/docker/stop_saltbox_docker_containers.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -12,8 +12,8 @@</span><span class="diff-line context"> </span><span class="diff-line context"> - name: &quot;Resources | Tasks | Docker | Stop Saltbox Docker Containers | Get Docker service state&quot;</span><span class="diff-line context">   ansible.builtin.set_fact:</span><span class="diff-line del">-    stop_docker_service_running: &quot;{{ (services[&#x27;docker.service&#x27;] is defined) and (services[&#x27;docker.service&#x27;][&#x27;state&#x27;] == &#x27;running&#x27;) }}&quot;</span><span class="diff-line del">-    stop_docker_containers_docker_controller_service_running: &quot;{{ (services[&#x27;saltbox_managed_docker_controller.service&#x27;] is defined) and (services[&#x27;saltbox_managed_docker_controller.service&#x27;][&#x27;state&#x27;] == &#x27;running&#x27;) }}&quot;</span><span class="diff-line add">+    stop_docker_service_running: &quot;{{ (ansible_facts[&#x27;services&#x27;][&#x27;docker.service&#x27;] is defined) and (ansible_facts[&#x27;services&#x27;][&#x27;docker.service&#x27;][&#x27;state&#x27;] == &#x27;running&#x27;) }}&quot;</span><span class="diff-line add">+    stop_docker_containers_docker_controller_service_running: &quot;{{ (ansible_facts[&#x27;services&#x27;][&#x27;saltbox_managed_docker_controller.service&#x27;] is defined) and (ansible_facts[&#x27;services&#x27;][&#x27;saltbox_managed_docker_controller.service&#x27;][&#x27;state&#x27;] == &#x27;running&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Resources | Tasks | Docker | Stop Saltbox Docker Containers | Run Controller Tasks</span><span class="diff-line context">   when: stop_docker_service_running and stop_docker_containers_docker_controller_service_running</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-88">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>resources/tasks/git/clone_git_repo.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -15,10 +15,10 @@</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Resources | Tasks | Git | Clone Git Repo | Set &#x27;_git_repo_*&#x27; variables</span><span class="diff-line context">   ansible.builtin.set_fact:</span><span class="diff-line del">-    _git_repo_url: &quot;{{ lookup(&#x27;vars&#x27;, _var_prefix + &#x27;_git_repo_url&#x27;) }}&quot;</span><span class="diff-line del">-    _git_repo_dest: &quot;{{ lookup(&#x27;vars&#x27;, _var_prefix + &#x27;_git_repo_dest&#x27;) }}&quot;</span><span class="diff-line del">-    _git_repo_branch_primary: &quot;{{ lookup(&#x27;vars&#x27;, _var_prefix + &#x27;_git_repo_branch_primary&#x27;) }}&quot;</span><span class="diff-line del">-    _git_repo_branch_secondary: &quot;{{ lookup(&#x27;vars&#x27;, _var_prefix + &#x27;_git_repo_branch_secondary&#x27;, default=&#x27;master&#x27;) }}&quot;</span><span class="diff-line add">+    _git_repo_url: &quot;{{ git_repo_url }}&quot;</span><span class="diff-line add">+    _git_repo_dest: &quot;{{ git_repo_dest }}&quot;</span><span class="diff-line add">+    _git_repo_branch_primary: &quot;{{ git_repo_branch_primary }}&quot;</span><span class="diff-line add">+    _git_repo_branch_secondary: &quot;{{ git_repo_branch_secondary | default(&#x27;main&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Resources | Tasks | Git | Clone Git Repo | Check for existing git folder</span><span class="diff-line context">   ansible.builtin.stat:</span><span class="diff-line hunk">@@ -28,7 +28,6 @@</span><span class="diff-line context"> - name: Resources | Tasks | Git | Clone Git Repo | Existing repo block</span><span class="diff-line context">   when: _git_repo_dest_stat.stat.exists</span><span class="diff-line context">   block:</span><span class="diff-line del">-</span><span class="diff-line context">     - name: Resources | Tasks | Git | Clone Git Repo | Get current git branch</span><span class="diff-line context">       ansible.builtin.shell: |</span><span class="diff-line context">         cd {{ _git_repo_dest }}</span><span class="diff-line hunk">@@ -38,7 +37,7 @@</span><span class="diff-line context">     - name: Resources | Tasks | Git | Clone Git Repo | Update target branch</span><span class="diff-line context">       ansible.builtin.set_fact:</span><span class="diff-line context">         _git_repo_branch_primary: &quot;{{ _git_repo_branch_secondary }}&quot;</span><span class="diff-line del">-      when: _git_repo_branch_secondary == _git_repo_dest_current_branch | trim</span><span class="diff-line add">+      when: (_git_repo_branch_secondary == (_git_repo_dest_current_branch | trim))</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Resources | Tasks | Git | Clone Git Repo | git clone repo &#x27;{{ _git_repo_branch_primary }}&#x27;</span><span class="diff-line context">   ansible.builtin.git:</span><span class="diff-line hunk">@@ -53,9 +52,8 @@</span><span class="diff-line context">   register: _git_clone_status</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Resources | Tasks | Git | Clone Git Repo | Tasks when above fails</span><span class="diff-line del">-  when: _git_clone_status is failed</span><span class="diff-line add">+  when: (_git_clone_status is failed)</span><span class="diff-line context">   block:</span><span class="diff-line del">-</span><span class="diff-line context">     - name: Resources | Tasks | Git | Clone Git Repo | git clone repo &#x27;master&#x27; if above fails</span><span class="diff-line context">       ansible.builtin.git:</span><span class="diff-line context">         repo: &quot;{{ _git_repo_url }}&quot;</span><span class="diff-line hunk">@@ -76,4 +74,4 @@</span><span class="diff-line context">         git remote add origin {{ _git_repo_url }}</span><span class="diff-line context">         git fetch origin</span><span class="diff-line context">         git reset --hard origin/{{ _git_repo_branch_primary }}</span><span class="diff-line del">-      when: _git_clone_master_status is failed</span><span class="diff-line add">+      when: (_git_clone_master_status is failed)</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-89">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>resources/tasks/instances/get_info.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -7,12 +7,30 @@</span><span class="diff-line context"> #                   GNU General Public License v3.0                     #</span><span class="diff-line context"> #########################################################################</span><span class="diff-line context"> ---</span><span class="diff-line del">-- name: Resources | Tasks | Instances | Get Info | Run Sonarr Tasks</span><span class="diff-line del">-  ansible.builtin.include_tasks: sonarr.yml</span><span class="diff-line add">+- name: Resources | Tasks | Instances | Get Info | Run Lidarr Tasks</span><span class="diff-line add">+  ansible.builtin.include_tasks: lidarr.yml</span><span class="diff-line context">   vars:</span><span class="diff-line del">-    sonarr_name: &quot;{{ item }}&quot;</span><span class="diff-line del">-  with_items: &quot;{{ sonarr_instances }}&quot;</span><span class="diff-line del">-  when: (&#x27;sonarr&#x27; in get_info_list)</span><span class="diff-line add">+    lidarr_name: &quot;{{ item }}&quot;</span><span class="diff-line add">+  with_items: &quot;{{ lidarr_instances }}&quot;</span><span class="diff-line add">+  when: (&#x27;lidarr&#x27; in get_info_list)</span><span class="diff-line add">+</span><span class="diff-line add">+- name: Resources | Tasks | Instances | Get Info | Run NZBGet Tasks</span><span class="diff-line add">+  ansible.builtin.include_tasks: nzbget.yml</span><span class="diff-line add">+  when: (&#x27;nzbget&#x27; in get_info_list)</span><span class="diff-line add">+</span><span class="diff-line add">+- name: Resources | Tasks | Instances | Get Info | Run Overseerr Tasks</span><span class="diff-line add">+  ansible.builtin.include_tasks: overseerr.yml</span><span class="diff-line add">+  vars:</span><span class="diff-line add">+    overseerr_name: &quot;{{ item }}&quot;</span><span class="diff-line add">+  with_items: &quot;{{ overseerr_instances }}&quot;</span><span class="diff-line add">+  when: (&#x27;overseerr&#x27; in get_info_list)</span><span class="diff-line add">+</span><span class="diff-line add">+- name: Resources | Tasks | Instances | Get Info | Run Plex Tasks</span><span class="diff-line add">+  ansible.builtin.include_tasks: plex.yml</span><span class="diff-line add">+  vars:</span><span class="diff-line add">+    plex_name: &quot;{{ item }}&quot;</span><span class="diff-line add">+  with_items: &quot;{{ plex_instances }}&quot;</span><span class="diff-line add">+  when: (&#x27;plex&#x27; in get_info_list)</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Resources | Tasks | Instances | Get Info | Run Radarr Tasks</span><span class="diff-line context">   ansible.builtin.include_tasks: radarr.yml</span><span class="diff-line hunk">@@ -21,30 +39,13 @@</span><span class="diff-line context">   with_items: &quot;{{ radarr_instances }}&quot;</span><span class="diff-line context">   when: (&#x27;radarr&#x27; in get_info_list)</span><span class="diff-line context"> </span><span class="diff-line del">-- name: Resources | Tasks | Instances | Get Info | Run Lidarr Tasks</span><span class="diff-line del">-  ansible.builtin.include_tasks: lidarr.yml</span><span class="diff-line add">+- name: Resources | Tasks | Instances | Get Info | Run SABnzbd Tasks</span><span class="diff-line add">+  ansible.builtin.include_tasks: sabnzbd.yml</span><span class="diff-line add">+  when: (&#x27;sabnzbd&#x27; in get_info_list)</span><span class="diff-line add">+</span><span class="diff-line add">+- name: Resources | Tasks | Instances | Get Info | Run Sonarr Tasks</span><span class="diff-line add">+  ansible.builtin.include_tasks: sonarr.yml</span><span class="diff-line context">   vars:</span><span class="diff-line del">-    lidarr_name: &quot;{{ item }}&quot;</span><span class="diff-line del">-  with_items: &quot;{{ lidarr_instances }}&quot;</span><span class="diff-line del">-  when: (&#x27;lidarr&#x27; in get_info_list)</span><span class="diff-line del">-</span><span class="diff-line del">-- name: Resources | Tasks | Instances | Get Info | Run Readarr Tasks</span><span class="diff-line del">-  ansible.builtin.include_tasks: readarr.yml</span><span class="diff-line del">-  vars:</span><span class="diff-line del">-    readarr_name: &quot;{{ item }}&quot;</span><span class="diff-line del">-  with_items: &quot;{{ readarr_instances }}&quot;</span><span class="diff-line del">-  when: (&#x27;readarr&#x27; in get_info_list)</span><span class="diff-line del">-</span><span class="diff-line del">-- name: Resources | Tasks | Instances | Get Info | Run Plex Tasks</span><span class="diff-line del">-  ansible.builtin.include_tasks: plex.yml</span><span class="diff-line del">-  vars:</span><span class="diff-line del">-    plex_name: &quot;{{ item }}&quot;</span><span class="diff-line del">-  with_items: &quot;{{ plex_instances }}&quot;</span><span class="diff-line del">-  when: (&#x27;plex&#x27; in get_info_list)</span><span class="diff-line del">-</span><span class="diff-line del">-- name: Resources | Tasks | Instances | Get Info | Run Overseerr Tasks</span><span class="diff-line del">-  ansible.builtin.include_tasks: overseerr.yml</span><span class="diff-line del">-  vars:</span><span class="diff-line del">-    overseerr_name: &quot;{{ item }}&quot;</span><span class="diff-line del">-  with_items: &quot;{{ overseerr_instances }}&quot;</span><span class="diff-line del">-  when: (&#x27;overseerr&#x27; in get_info_list)</span><span class="diff-line add">+    sonarr_name: &quot;{{ item }}&quot;</span><span class="diff-line add">+  with_items: &quot;{{ sonarr_instances }}&quot;</span><span class="diff-line add">+  when: (&#x27;sonarr&#x27; in get_info_list)</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-90">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>resources/tasks/instances/lidarr.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -9,7 +9,7 @@</span><span class="diff-line context"> ---</span><span class="diff-line context"> - name: Resources | Tasks | Instances | Get Info | Check if Lidarr exists</span><span class="diff-line context">   ansible.builtin.stat:</span><span class="diff-line del">-    path: &quot;{{ lidarr_paths_config_location }}&quot;</span><span class="diff-line add">+    path: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_config_location&#x27;, role=&#x27;lidarr&#x27;) }}&quot;</span><span class="diff-line context">   register: lidarr_paths_config_location_stat</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Resources | Tasks | Instances | Get Info | Lidarr API Key tasks</span><span class="diff-line hunk">@@ -17,16 +17,16 @@</span><span class="diff-line context">   block:</span><span class="diff-line context">     - name: Resources | Tasks | Instances | Get Info | Fetch Lidarr API Key</span><span class="diff-line context">       community.general.xml:</span><span class="diff-line del">-        path: &quot;{{ lidarr_paths_config_location }}&quot;</span><span class="diff-line add">+        path: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_config_location&#x27;, role=&#x27;lidarr&#x27;) }}&quot;</span><span class="diff-line context">         xpath: /Config/ApiKey</span><span class="diff-line context">         content: text</span><span class="diff-line context">       register: xmlresp</span><span class="diff-line context"> </span><span class="diff-line context">     - name: Resources | Tasks | Instances | Get Info | Set &#x27;lidarr_info&#x27; variable</span><span class="diff-line context">       ansible.builtin.set_fact:</span><span class="diff-line del">-        lidarr_info: &quot;{{ lidarr_info | default({}) | combine({lidarr_name: {&#x27;name&#x27;: lidarr_name, &#x27;url&#x27;: lidarr_web_url, &#x27;api_key&#x27;: xmlresp.matches[0].ApiKey}}) }}&quot;</span><span class="diff-line add">+        lidarr_info: &quot;{{ lidarr_info | default({}) | combine({lidarr_name: {&#x27;name&#x27;: lidarr_name, &#x27;url&#x27;: lookup(&#x27;role_var&#x27;, &#x27;_web_url&#x27;, role=&#x27;lidarr&#x27;), &#x27;api_key&#x27;: xmlresp.matches[0].ApiKey}}) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Resources | Tasks | Instances | Get Info | Set &#x27;lidarr_info&#x27; variable</span><span class="diff-line context">   ansible.builtin.set_fact:</span><span class="diff-line del">-    lidarr_info: &quot;{{ lidarr_info | default({}) | combine({lidarr_name: {&#x27;name&#x27;: lidarr_name, &#x27;url&#x27;: lidarr_web_url, &#x27;api_key&#x27;: &#x27;not installed&#x27;}}) }}&quot;</span><span class="diff-line add">+    lidarr_info: &quot;{{ lidarr_info | default({}) | combine({lidarr_name: {&#x27;name&#x27;: lidarr_name, &#x27;url&#x27;: lookup(&#x27;role_var&#x27;, &#x27;_web_url&#x27;, role=&#x27;lidarr&#x27;), &#x27;api_key&#x27;: &#x27;not installed&#x27;}}) }}&quot;</span><span class="diff-line context">   when: (not lidarr_paths_config_location_stat.stat.exists)</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-91">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>resources/tasks/instances/overseerr.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -9,21 +9,21 @@</span><span class="diff-line context"> ---</span><span class="diff-line context"> - name: Resources | Tasks | Instances | Get Info | Check if Overseerr exists</span><span class="diff-line context">   ansible.builtin.stat:</span><span class="diff-line del">-    path: &quot;{{ overseerr_paths_config_location }}&quot;</span><span class="diff-line del">-  register: overseerr_paths_config_location_stat</span><span class="diff-line add">+    path: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_config_location&#x27;, role=&#x27;overseerr&#x27;) }}&quot;</span><span class="diff-line add">+  register: overseerr_role_paths_config_location_stat</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Resources | Tasks | Instances | Get Info | Overseerr API Key tasks</span><span class="diff-line del">-  when: overseerr_paths_config_location_stat.stat.exists</span><span class="diff-line add">+  when: overseerr_role_paths_config_location_stat.stat.exists</span><span class="diff-line context">   block:</span><span class="diff-line context">     - name: Resources | Tasks | Instances | Get Info | Fetch Overseerr API Key</span><span class="diff-line context">       ansible.builtin.set_fact:</span><span class="diff-line del">-        jsondata: &quot;{{ lookup(&#x27;ansible.builtin.file&#x27;, overseerr_paths_config_location) }}&quot;</span><span class="diff-line add">+        jsondata: &quot;{{ lookup(&#x27;ansible.builtin.file&#x27;, lookup(&#x27;role_var&#x27;, &#x27;_paths_config_location&#x27;, role=&#x27;overseerr&#x27;)) | from_json }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context">     - name: Resources | Tasks | Instances | Get Info | Set &#x27;overseerr_info&#x27; variable</span><span class="diff-line context">       ansible.builtin.set_fact:</span><span class="diff-line del">-        overseerr_info: &quot;{{ overseerr_info | default({}) | combine({overseerr_name: {&#x27;name&#x27;: overseerr_name, &#x27;url&#x27;: overseerr_web_url, &#x27;api_key&#x27;: jsondata.main.apiKey}}) }}&quot;</span><span class="diff-line add">+        overseerr_info: &quot;{{ overseerr_info | default({}) | combine({overseerr_name: {&#x27;name&#x27;: overseerr_name, &#x27;url&#x27;: lookup(&#x27;role_var&#x27;, &#x27;_web_url&#x27;, role=&#x27;overseerr&#x27;), &#x27;api_key&#x27;: jsondata.main.apiKey}}) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Resources | Tasks | Instances | Get Info | Set &#x27;overseerr_info&#x27; variable</span><span class="diff-line context">   ansible.builtin.set_fact:</span><span class="diff-line del">-    overseerr_info: &quot;{{ overseerr_info | default({}) | combine({overseerr_name: {&#x27;name&#x27;: overseerr_name, &#x27;url&#x27;: overseerr_web_url, &#x27;api_key&#x27;: &#x27;not installed&#x27;}}) }}&quot;</span><span class="diff-line del">-  when: (not overseerr_paths_config_location_stat.stat.exists)</span><span class="diff-line add">+    overseerr_info: &quot;{{ overseerr_info | default({}) | combine({overseerr_name: {&#x27;name&#x27;: overseerr_name, &#x27;url&#x27;: lookup(&#x27;role_var&#x27;, &#x27;_web_url&#x27;, role=&#x27;overseerr&#x27;), &#x27;api_key&#x27;: &#x27;not installed&#x27;}}) }}&quot;</span><span class="diff-line add">+  when: (not overseerr_role_paths_config_location_stat.stat.exists)</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-92">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>resources/tasks/instances/plex.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -18,4 +18,4 @@</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Resources | Tasks | Instances | Get Info | Set &#x27;plex_info&#x27; variable</span><span class="diff-line context">   ansible.builtin.set_fact:</span><span class="diff-line del">-    plex_info: &quot;{{ plex_info | default({}) | combine({plex_name: {&#x27;name&#x27;: plex_name, &#x27;url&#x27;: plex_web_url, &#x27;token&#x27;: plex_auth_token}}) }}&quot;</span><span class="diff-line add">+    plex_info: &quot;{{ plex_info | default({}) | combine({plex_name: {&#x27;name&#x27;: plex_name, &#x27;url&#x27;: lookup(&#x27;role_var&#x27;, &#x27;_web_url&#x27;, role=&#x27;plex&#x27;), &#x27;token&#x27;: plex_auth_token}}) }}&quot;</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-93">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>resources/tasks/instances/radarr.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -9,24 +9,24 @@</span><span class="diff-line context"> ---</span><span class="diff-line context"> - name: Resources | Tasks | Instances | Get Info | Check if Radarr exists</span><span class="diff-line context">   ansible.builtin.stat:</span><span class="diff-line del">-    path: &quot;{{ radarr_paths_config_location }}&quot;</span><span class="diff-line del">-  register: radarr_paths_config_location_stat</span><span class="diff-line add">+    path: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_config_location&#x27;, role=&#x27;radarr&#x27;) }}&quot;</span><span class="diff-line add">+  register: radarr_role_paths_config_location_stat</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Resources | Tasks | Instances | Get Info | Radarr API Key tasks</span><span class="diff-line del">-  when: radarr_paths_config_location_stat.stat.exists</span><span class="diff-line add">+  when: radarr_role_paths_config_location_stat.stat.exists</span><span class="diff-line context">   block:</span><span class="diff-line context">     - name: Resources | Tasks | Instances | Get Info | Fetch Radarr API Key</span><span class="diff-line context">       community.general.xml:</span><span class="diff-line del">-        path: &quot;{{ radarr_paths_config_location }}&quot;</span><span class="diff-line add">+        path: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_config_location&#x27;, role=&#x27;radarr&#x27;) }}&quot;</span><span class="diff-line context">         xpath: /Config/ApiKey</span><span class="diff-line context">         content: text</span><span class="diff-line context">       register: xmlresp</span><span class="diff-line context"> </span><span class="diff-line context">     - name: Resources | Tasks | Instances | Get Info | Set &#x27;radarr_info&#x27; variable</span><span class="diff-line context">       ansible.builtin.set_fact:</span><span class="diff-line del">-        radarr_info: &quot;{{ radarr_info | default({}) | combine({radarr_name: {&#x27;name&#x27;: radarr_name, &#x27;url&#x27;: radarr_web_url, &#x27;api_key&#x27;: xmlresp.matches[0].ApiKey}}) }}&quot;</span><span class="diff-line add">+        radarr_info: &quot;{{ radarr_info | default({}) | combine({radarr_name: {&#x27;name&#x27;: radarr_name, &#x27;url&#x27;: lookup(&#x27;role_var&#x27;, &#x27;_web_url&#x27;, role=&#x27;radarr&#x27;), &#x27;api_key&#x27;: xmlresp.matches[0].ApiKey}}) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Resources | Tasks | Instances | Get Info | Set &#x27;radarr_info&#x27; variable</span><span class="diff-line context">   ansible.builtin.set_fact:</span><span class="diff-line del">-    radarr_info: &quot;{{ radarr_info | default({}) | combine({radarr_name: {&#x27;name&#x27;: radarr_name, &#x27;url&#x27;: radarr_web_url, &#x27;api_key&#x27;: &#x27;not installed&#x27;}}) }}&quot;</span><span class="diff-line del">-  when: (not radarr_paths_config_location_stat.stat.exists)</span><span class="diff-line add">+    radarr_info: &quot;{{ radarr_info | default({}) | combine({radarr_name: {&#x27;name&#x27;: radarr_name, &#x27;url&#x27;: lookup(&#x27;role_var&#x27;, &#x27;_web_url&#x27;, role=&#x27;radarr&#x27;), &#x27;api_key&#x27;: &#x27;not installed&#x27;}}) }}&quot;</span><span class="diff-line add">+  when: (not radarr_role_paths_config_location_stat.stat.exists)</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-94">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>resources/tasks/instances/sonarr.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -9,24 +9,24 @@</span><span class="diff-line context"> ---</span><span class="diff-line context"> - name: Resources | Tasks | Instances | Get Info | Check if Sonarr exists</span><span class="diff-line context">   ansible.builtin.stat:</span><span class="diff-line del">-    path: &quot;{{ sonarr_paths_config_location }}&quot;</span><span class="diff-line del">-  register: sonarr_paths_config_location_stat</span><span class="diff-line add">+    path: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_config_location&#x27;, role=&#x27;sonarr&#x27;) }}&quot;</span><span class="diff-line add">+  register: sonarr_role_paths_config_location_stat</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Resources | Tasks | Instances | Get Info | Sonarr API Key tasks</span><span class="diff-line del">-  when: sonarr_paths_config_location_stat.stat.exists</span><span class="diff-line add">+  when: sonarr_role_paths_config_location_stat.stat.exists</span><span class="diff-line context">   block:</span><span class="diff-line context">     - name: Resources | Tasks | Instances | Get Info | Fetch Sonarr API Key</span><span class="diff-line context">       community.general.xml:</span><span class="diff-line del">-        path: &quot;{{ sonarr_paths_config_location }}&quot;</span><span class="diff-line add">+        path: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_config_location&#x27;, role=&#x27;sonarr&#x27;) }}&quot;</span><span class="diff-line context">         xpath: /Config/ApiKey</span><span class="diff-line context">         content: text</span><span class="diff-line context">       register: xmlresp</span><span class="diff-line context"> </span><span class="diff-line context">     - name: Resources | Tasks | Instances | Get Info | Set &#x27;sonarr_info&#x27; variable</span><span class="diff-line context">       ansible.builtin.set_fact:</span><span class="diff-line del">-        sonarr_info: &quot;{{ sonarr_info | default({}) | combine({sonarr_name: {&#x27;name&#x27;: sonarr_name, &#x27;url&#x27;: sonarr_web_url, &#x27;api_key&#x27;: xmlresp.matches[0].ApiKey}}) }}&quot;</span><span class="diff-line add">+        sonarr_info: &quot;{{ sonarr_info | default({}) | combine({sonarr_name: {&#x27;name&#x27;: sonarr_name, &#x27;url&#x27;: lookup(&#x27;role_var&#x27;, &#x27;_web_url&#x27;, role=&#x27;sonarr&#x27;), &#x27;api_key&#x27;: xmlresp.matches[0].ApiKey}}) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Resources | Tasks | Instances | Get Info | Set &#x27;sonarr_info&#x27; variable</span><span class="diff-line context">   ansible.builtin.set_fact:</span><span class="diff-line del">-    sonarr_info: &quot;{{ sonarr_info | default({}) | combine({sonarr_name: {&#x27;name&#x27;: sonarr_name, &#x27;url&#x27;: sonarr_web_url, &#x27;api_key&#x27;: &#x27;not installed&#x27;}}) }}&quot;</span><span class="diff-line del">-  when: (not sonarr_paths_config_location_stat.stat.exists)</span><span class="diff-line add">+    sonarr_info: &quot;{{ sonarr_info | default({}) | combine({sonarr_name: {&#x27;name&#x27;: sonarr_name, &#x27;url&#x27;: lookup(&#x27;role_var&#x27;, &#x27;_web_url&#x27;, role=&#x27;sonarr&#x27;), &#x27;api_key&#x27;: &#x27;not installed&#x27;}}) }}&quot;</span><span class="diff-line add">+  when: (not sonarr_role_paths_config_location_stat.stat.exists)</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-95">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>resources/tasks/systemd/delete_service.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -28,7 +28,7 @@</span><span class="diff-line context"> </span><span class="diff-line context">     - name: Resources | Tasks | systemd | Delete Service | get &#x27;{{ _service_file }}&#x27; state</span><span class="diff-line context">       ansible.builtin.set_fact:</span><span class="diff-line del">-        service_running: &quot;{{ (services[_service_file] is defined) and (services[_service_file][&#x27;state&#x27;] == &#x27;running&#x27;) }}&quot;</span><span class="diff-line add">+        service_running: &quot;{{ (ansible_facts[&#x27;services&#x27;][_service_file] is defined) and (ansible_facts[&#x27;services&#x27;][_service_file][&#x27;state&#x27;] == &#x27;running&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context">     - name: Resources | Tasks | systemd | Delete Service | stop &#x27;{{ _service_file }}&#x27;</span><span class="diff-line context">       ansible.builtin.systemd_service:</span><span class="diff-line hunk">@@ -50,4 +50,4 @@</span><span class="diff-line context"> </span><span class="diff-line context">     - name: Resources | Tasks | systemd | Delete Service | systemd daemon-reload</span><span class="diff-line context">       ansible.builtin.systemd_service:</span><span class="diff-line del">-        daemon_reload: yes</span><span class="diff-line add">+        daemon_reload: true</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-96">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>resources/tasks/systemd/disable_service.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -28,7 +28,7 @@</span><span class="diff-line context"> </span><span class="diff-line context">     - name: Resources | Tasks | systemd | Disable Service | get &#x27;{{ _service_file }}&#x27; state</span><span class="diff-line context">       ansible.builtin.set_fact:</span><span class="diff-line del">-        service_running: &quot;{{ (services[_service_file] is defined) and (services[_service_file][&#x27;state&#x27;] == &#x27;running&#x27;) }}&quot;</span><span class="diff-line add">+        service_running: &quot;{{ (ansible_facts[&#x27;services&#x27;][_service_file] is defined) and (ansible_facts[&#x27;services&#x27;][_service_file][&#x27;state&#x27;] == &#x27;running&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context">     - name: Resources | Tasks | systemd | Disable Service | stop &#x27;{{ _service_file }}&#x27;</span><span class="diff-line context">       ansible.builtin.systemd_service:</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-97">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>resources/tasks/systemd/stop_service.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -28,7 +28,7 @@</span><span class="diff-line context"> </span><span class="diff-line context">     - name: Resources | Tasks | systemd | Stop Service | get &#x27;{{ _service_file }}&#x27; state</span><span class="diff-line context">       ansible.builtin.set_fact:</span><span class="diff-line del">-        service_running: &quot;{{ (services[_service_file] is defined) and (services[_service_file][&#x27;state&#x27;] == &#x27;running&#x27;) }}&quot;</span><span class="diff-line add">+        service_running: &quot;{{ (ansible_facts[&#x27;services&#x27;][_service_file] is defined) and (ansible_facts[&#x27;services&#x27;][_service_file][&#x27;state&#x27;] == &#x27;running&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context">     - name: Resources | Tasks | systemd | Stop Service | stop &#x27;{{ _service_file }}&#x27;</span><span class="diff-line context">       ansible.builtin.systemd_service:</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-98">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>resources/tasks/systemd/update_service_credentials.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -39,5 +39,5 @@</span><span class="diff-line context"> </span><span class="diff-line context">     - name: Resources | Tasks | systemd | Update Service Credentials | systemd daemon-reload</span><span class="diff-line context">       ansible.builtin.systemd_service:</span><span class="diff-line del">-        daemon_reload: yes</span><span class="diff-line del">-      when: credentials_state is changed</span><span class="diff-line add">+        daemon_reload: true</span><span class="diff-line add">+      when: (credentials_state is changed)</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-99">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/arr_db/defaults/main.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -13,7 +13,6 @@</span><span class="diff-line context"> arr_db_sonarr_enabled: false</span><span class="diff-line context"> arr_db_radarr_enabled: false</span><span class="diff-line context"> arr_db_lidarr_enabled: false</span><span class="diff-line del">-arr_db_readarr_enabled: false</span><span class="diff-line context"> arr_db_whisparr_enabled: false</span><span class="diff-line context"> arr_db_prowlarr_enabled: false</span><span class="diff-line context"> arr_db_tautulli_enabled: false</span><span class="diff-line hunk">@@ -22,8 +21,8 @@</span><span class="diff-line context"> # Variables</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-arr_path_logs_db: &quot;{{ lookup(&#x27;vars&#x27;, arr_type + &#x27;_paths_location&#x27;) }}/logs.db&quot;</span><span class="diff-line del">-arr_path_main_db: &quot;{{ lookup(&#x27;vars&#x27;, arr_type + &#x27;_paths_location&#x27;) }}/{{ arr_type }}.db&quot;</span><span class="diff-line add">+arr_path_logs_db: &quot;{{ lookup(&#x27;vars&#x27;, arr_type + &#x27;_role_paths_location&#x27;) }}/logs.db&quot;</span><span class="diff-line add">+arr_path_main_db: &quot;{{ lookup(&#x27;vars&#x27;, arr_type + &#x27;_role_paths_location&#x27;) }}/{{ arr_type }}.db&quot;</span><span class="diff-line context"> arr_db_files:</span><span class="diff-line context">   - &quot;logs.db&quot;</span><span class="diff-line context">   - &quot;{{ arr_type }}.db&quot;</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-100">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/arr_db/tasks/arr.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -48,7 +48,7 @@</span><span class="diff-line context">         mode: &quot;0775&quot;</span><span class="diff-line context"> </span><span class="diff-line context">     - name: &quot;{{ arr_type | capitalize }} | Backup databases&quot;</span><span class="diff-line del">-      ansible.builtin.shell: &quot;cp &#x27;{{ lookup(&#x27;vars&#x27;, arr_type + &#x27;_paths_location&#x27;) }}/{{ item }}&#x27; /tmp/{{ lookup(&#x27;vars&#x27;, arr_type + &#x27;_name&#x27;) }}_backup/&quot;</span><span class="diff-line add">+      ansible.builtin.shell: &quot;cp &#x27;{{ lookup(&#x27;vars&#x27;, arr_type + &#x27;_role_paths_location&#x27;) }}/{{ item }}&#x27; /tmp/{{ lookup(&#x27;vars&#x27;, arr_type + &#x27;_name&#x27;) }}_backup/&quot;</span><span class="diff-line context">       loop: &quot;{{ arr_db_files }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context">     - name: &quot;{{ arr_type | capitalize }} | Vacuum &#x27;{{ arr_path_main_db | basename }}&#x27; database&quot;</span><span class="diff-line hunk">@@ -74,12 +74,12 @@</span><span class="diff-line context">   rescue:</span><span class="diff-line context">     - name: &quot;{{ arr_type | capitalize }} | Delete wal and shm files&quot;</span><span class="diff-line context">       ansible.builtin.file:</span><span class="diff-line del">-        path: &quot;{{ lookup(&#x27;vars&#x27;, arr_type + &#x27;_paths_location&#x27;) }}/{{ item }}&quot;</span><span class="diff-line add">+        path: &quot;{{ lookup(&#x27;vars&#x27;, arr_type + &#x27;_role_paths_location&#x27;) }}/{{ item }}&quot;</span><span class="diff-line context">         state: absent</span><span class="diff-line context">       with_items: &quot;{{ arr_db_temp_files }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context">     - name: &quot;{{ arr_type | capitalize }} | Restore database backup&quot;</span><span class="diff-line del">-      ansible.builtin.shell: &quot;cp -f &#x27;/tmp/{{ lookup(&#x27;vars&#x27;, arr_type + &#x27;_name&#x27;) }}_backup/{{ item }}&#x27; &#x27;{{ lookup(&#x27;vars&#x27;, arr_type + &#x27;_paths_location&#x27;) }}/{{ item }}&#x27;&quot;</span><span class="diff-line add">+      ansible.builtin.shell: &quot;cp -f &#x27;/tmp/{{ lookup(&#x27;vars&#x27;, arr_type + &#x27;_name&#x27;) }}_backup/{{ item }}&#x27; &#x27;{{ lookup(&#x27;vars&#x27;, arr_type + &#x27;_role_paths_location&#x27;) }}/{{ item }}&#x27;&quot;</span><span class="diff-line context">       loop: &quot;{{ arr_db_files }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: &quot;{{ arr_type | capitalize }} | Start Docker container&quot;</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-101">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/arr_db/tasks/main.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -13,13 +13,13 @@</span><span class="diff-line context">       - &quot;You must enable at least one of the role variables to run this role.&quot;</span><span class="diff-line context">       - &quot;Use the Saltbox inventory to enable.&quot;</span><span class="diff-line context">   when: not (arr_db_sonarr_enabled or arr_db_lidarr_enabled</span><span class="diff-line del">-             or arr_db_readarr_enabled or arr_db_whisparr_enabled</span><span class="diff-line del">-             or arr_db_prowlarr_enabled or arr_db_tautulli_enabled)</span><span class="diff-line add">+             or arr_db_whisparr_enabled or arr_db_prowlarr_enabled</span><span class="diff-line add">+             or arr_db_tautulli_enabled)</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Install SQLite3</span><span class="diff-line context">   ansible.builtin.apt:</span><span class="diff-line context">     name: sqlite3</span><span class="diff-line del">-    state: present</span><span class="diff-line add">+    state: latest</span><span class="diff-line context"> </span><span class="diff-line context"> - name: &quot;Execute Sonarr DB tasks&quot;</span><span class="diff-line context">   ansible.builtin.include_tasks: arr.yml</span><span class="diff-line hunk">@@ -51,16 +51,6 @@</span><span class="diff-line context">   loop_control:</span><span class="diff-line context">     loop_var: instance</span><span class="diff-line context"> </span><span class="diff-line del">-- name: &quot;Execute Readarr DB tasks&quot;</span><span class="diff-line del">-  ansible.builtin.include_tasks: arr.yml</span><span class="diff-line del">-  when: arr_db_readarr_enabled</span><span class="diff-line del">-  vars:</span><span class="diff-line del">-    readarr_name: &quot;{{ instance }}&quot;</span><span class="diff-line del">-    arr_type: &quot;readarr&quot;</span><span class="diff-line del">-  with_items: &quot;{{ readarr_instances }}&quot;</span><span class="diff-line del">-  loop_control:</span><span class="diff-line del">-    loop_var: instance</span><span class="diff-line del">-</span><span class="diff-line context"> - name: &quot;Execute Whisparr DB tasks&quot;</span><span class="diff-line context">   ansible.builtin.include_tasks: arr.yml</span><span class="diff-line context">   when: arr_db_whisparr_enabled</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-102">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/arr_db/tasks/tautulli.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -9,7 +9,7 @@</span><span class="diff-line context"> ---</span><span class="diff-line context"> - name: &quot;Tautulli | Check if &#x27;{{ arr_db_tautulli_database }}&#x27; exists&quot;</span><span class="diff-line context">   ansible.builtin.stat:</span><span class="diff-line del">-    path: &quot;{{ tautulli_paths_location }}/{{ arr_db_tautulli_database }}&quot;</span><span class="diff-line add">+    path: &quot;{{ tautulli_role_paths_location }}/{{ arr_db_tautulli_database }}&quot;</span><span class="diff-line context">   register: arr_db</span><span class="diff-line context"> </span><span class="diff-line context"> - name: &quot;Tautulli | Fail if database does not exist&quot;</span><span class="diff-line hunk">@@ -23,7 +23,7 @@</span><span class="diff-line context">     var_prefix: &quot;tautulli&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: &quot;Tautulli | Check if database passes integrity_check&quot;</span><span class="diff-line del">-  ansible.builtin.shell: &quot;sqlite3 &#x27;{{ tautulli_paths_location }}/{{ arr_db_tautulli_database }}&#x27; &#x27;PRAGMA integrity_check(1)&#x27;&quot;</span><span class="diff-line add">+  ansible.builtin.shell: &quot;sqlite3 &#x27;{{ tautulli_role_paths_location }}/{{ arr_db_tautulli_database }}&#x27; &#x27;PRAGMA integrity_check(1)&#x27;&quot;</span><span class="diff-line context">   register: arr_db_integrity_check</span><span class="diff-line context">   failed_when: (arr_db_integrity_check.stdout != &#x27;ok&#x27;)</span><span class="diff-line context"> </span><span class="diff-line hunk">@@ -38,27 +38,27 @@</span><span class="diff-line context">         mode: &quot;0775&quot;</span><span class="diff-line context"> </span><span class="diff-line context">     - name: &quot;Tautulli | Backup databases&quot;</span><span class="diff-line del">-      ansible.builtin.shell: &quot;cp &#x27;{{ tautulli_paths_location }}/{{ arr_db_tautulli_database }}&#x27; /tmp/{{ tautulli_name }}_backup/&quot;</span><span class="diff-line add">+      ansible.builtin.shell: &quot;cp &#x27;{{ tautulli_role_paths_location }}/{{ arr_db_tautulli_database }}&#x27; /tmp/{{ tautulli_name }}_backup/&quot;</span><span class="diff-line context"> </span><span class="diff-line context">     - name: &quot;Tautulli | Vacuum &#x27;{{ arr_db_tautulli_database | basename }}&#x27; database&quot;</span><span class="diff-line del">-      ansible.builtin.shell: &quot;sqlite3 &#x27;{{ tautulli_paths_location }}/{{ arr_db_tautulli_database }}&#x27; &#x27;VACUUM;&#x27;&quot;</span><span class="diff-line add">+      ansible.builtin.shell: &quot;sqlite3 &#x27;{{ tautulli_role_paths_location }}/{{ arr_db_tautulli_database }}&#x27; &#x27;VACUUM;&#x27;&quot;</span><span class="diff-line context">       register: arr_db_vacuum</span><span class="diff-line context">       failed_when: (arr_db_vacuum.rc != 0)</span><span class="diff-line context"> </span><span class="diff-line context">     - name: &quot;Tautulli | Reindex &#x27;{{ arr_db_tautulli_database | basename }}&#x27; database&quot;</span><span class="diff-line del">-      ansible.builtin.shell: &quot;sqlite3 &#x27;{{ tautulli_paths_location }}/{{ arr_db_tautulli_database }}&#x27; &#x27;REINDEX;&#x27;&quot;</span><span class="diff-line add">+      ansible.builtin.shell: &quot;sqlite3 &#x27;{{ tautulli_role_paths_location }}/{{ arr_db_tautulli_database }}&#x27; &#x27;REINDEX;&#x27;&quot;</span><span class="diff-line context">       register: arr_db_reindex</span><span class="diff-line context">       failed_when: (arr_db_reindex.rc != 0)</span><span class="diff-line context"> </span><span class="diff-line context">   rescue:</span><span class="diff-line context">     - name: &quot;Tautulli | Delete wal and shm files&quot;</span><span class="diff-line context">       ansible.builtin.file:</span><span class="diff-line del">-        path: &quot;{{ tautulli_paths_location }}/{{ item }}&quot;</span><span class="diff-line add">+        path: &quot;{{ tautulli_role_paths_location }}/{{ item }}&quot;</span><span class="diff-line context">         state: absent</span><span class="diff-line context">       with_items: &quot;{{ arr_db_tautulli_temp_files }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context">     - name: &quot;Tautulli | Restore database backup&quot;</span><span class="diff-line del">-      ansible.builtin.shell: &quot;cp -f &#x27;/tmp/{{ tautulli_name }}_backup/{{ arr_db_tautulli_database }}&#x27; &#x27;{{ tautulli_paths_location }}/{{ arr_db_tautulli_database }}&#x27;&quot;</span><span class="diff-line add">+      ansible.builtin.shell: &quot;cp -f &#x27;/tmp/{{ tautulli_name }}_backup/{{ arr_db_tautulli_database }}&#x27; &#x27;{{ tautulli_role_paths_location }}/{{ arr_db_tautulli_database }}&#x27;&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: &quot;Tautulli | Start Docker container&quot;</span><span class="diff-line context">   ansible.builtin.include_tasks: &quot;{{ resources_tasks_path }}/docker/start_docker_container.yml&quot;</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-103">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/asshama/tasks/subtasks/loop.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -22,28 +22,28 @@</span><span class="diff-line context">     owner: &quot;{{ user.name }}&quot;</span><span class="diff-line context">     group: &quot;{{ user.name }}&quot;</span><span class="diff-line context">   with_items:</span><span class="diff-line del">-    - &#x27;{{ plex_paths_location }}/Library/Application Support/Plex Media Server/Scanners&#x27;</span><span class="diff-line del">-    - &#x27;{{ plex_paths_location }}/Library/Application Support/Plex Media Server/Scanners/Series&#x27;</span><span class="diff-line del">-    - &#x27;{{ plex_paths_location }}/Library/Application Support/Plex Media Server/Plug-in Support/Data/com.plexapp.agents.hama/DataItems/AniDB&#x27;</span><span class="diff-line del">-    - &#x27;{{ plex_paths_location }}/Library/Application Support/Plex Media Server/Plug-in Support/Data/com.plexapp.agents.hama/DataItems/Plex&#x27;</span><span class="diff-line del">-    - &#x27;{{ plex_paths_location }}/Library/Application Support/Plex Media Server/Plug-in Support/Data/com.plexapp.agents.hama/DataItems/OMDB&#x27;</span><span class="diff-line del">-    - &#x27;{{ plex_paths_location }}/Library/Application Support/Plex Media Server/Plug-in Support/Data/com.plexapp.agents.hama/DataItems/TMDB&#x27;</span><span class="diff-line del">-    - &#x27;{{ plex_paths_location }}/Library/Application Support/Plex Media Server/Plug-in Support/Data/com.plexapp.agents.hama/DataItems/TVDB/blank&#x27;</span><span class="diff-line del">-    - &#x27;{{ plex_paths_location }}/Library/Application Support/Plex Media Server/Plug-in Support/Data/com.plexapp.agents.hama/DataItems/TVDB/_cache/fanart/original&#x27;</span><span class="diff-line del">-    - &#x27;{{ plex_paths_location }}/Library/Application Support/Plex Media Server/Plug-in Support/Data/com.plexapp.agents.hama/DataItems/TVDB/episodes&#x27;</span><span class="diff-line del">-    - &#x27;{{ plex_paths_location }}/Library/Application Support/Plex Media Server/Plug-in Support/Data/com.plexapp.agents.hama/DataItems/TVDB/fanart/original&#x27;</span><span class="diff-line del">-    - &#x27;{{ plex_paths_location }}/Library/Application Support/Plex Media Server/Plug-in Support/Data/com.plexapp.agents.hama/DataItems/TVDB/fanart/vignette&#x27;</span><span class="diff-line del">-    - &#x27;{{ plex_paths_location }}/Library/Application Support/Plex Media Server/Plug-in Support/Data/com.plexapp.agents.hama/DataItems/TVDB/graphical&#x27;</span><span class="diff-line del">-    - &#x27;{{ plex_paths_location }}/Library/Application Support/Plex Media Server/Plug-in Support/Data/com.plexapp.agents.hama/DataItems/TVDB/posters&#x27;</span><span class="diff-line del">-    - &#x27;{{ plex_paths_location }}/Library/Application Support/Plex Media Server/Plug-in Support/Data/com.plexapp.agents.hama/DataItems/TVDB/seasons&#x27;</span><span class="diff-line del">-    - &#x27;{{ plex_paths_location }}/Library/Application Support/Plex Media Server/Plug-in Support/Data/com.plexapp.agents.hama/DataItems/TVDB/seasonswide&#x27;</span><span class="diff-line del">-    - &#x27;{{ plex_paths_location }}/Library/Application Support/Plex Media Server/Plug-in Support/Data/com.plexapp.agents.hama/DataItems/TVDB/text&#x27;</span><span class="diff-line del">-    - &#x27;{{ plex_paths_location }}/Library/Application Support/Plex Media Server/Plug-in Support/Data/com.plexapp.agents.hama/DataItems/FanartTV&#x27;</span><span class="diff-line add">+    - &#x27;{{ plex_role_paths_location }}/Library/Application Support/Plex Media Server/Scanners&#x27;</span><span class="diff-line add">+    - &#x27;{{ plex_role_paths_location }}/Library/Application Support/Plex Media Server/Scanners/Series&#x27;</span><span class="diff-line add">+    - &#x27;{{ plex_role_paths_location }}/Library/Application Support/Plex Media Server/Plug-in Support/Data/com.plexapp.agents.hama/DataItems/AniDB&#x27;</span><span class="diff-line add">+    - &#x27;{{ plex_role_paths_location }}/Library/Application Support/Plex Media Server/Plug-in Support/Data/com.plexapp.agents.hama/DataItems/Plex&#x27;</span><span class="diff-line add">+    - &#x27;{{ plex_role_paths_location }}/Library/Application Support/Plex Media Server/Plug-in Support/Data/com.plexapp.agents.hama/DataItems/OMDB&#x27;</span><span class="diff-line add">+    - &#x27;{{ plex_role_paths_location }}/Library/Application Support/Plex Media Server/Plug-in Support/Data/com.plexapp.agents.hama/DataItems/TMDB&#x27;</span><span class="diff-line add">+    - &#x27;{{ plex_role_paths_location }}/Library/Application Support/Plex Media Server/Plug-in Support/Data/com.plexapp.agents.hama/DataItems/TVDB/blank&#x27;</span><span class="diff-line add">+    - &#x27;{{ plex_role_paths_location }}/Library/Application Support/Plex Media Server/Plug-in Support/Data/com.plexapp.agents.hama/DataItems/TVDB/_cache/fanart/original&#x27;</span><span class="diff-line add">+    - &#x27;{{ plex_role_paths_location }}/Library/Application Support/Plex Media Server/Plug-in Support/Data/com.plexapp.agents.hama/DataItems/TVDB/episodes&#x27;</span><span class="diff-line add">+    - &#x27;{{ plex_role_paths_location }}/Library/Application Support/Plex Media Server/Plug-in Support/Data/com.plexapp.agents.hama/DataItems/TVDB/fanart/original&#x27;</span><span class="diff-line add">+    - &#x27;{{ plex_role_paths_location }}/Library/Application Support/Plex Media Server/Plug-in Support/Data/com.plexapp.agents.hama/DataItems/TVDB/fanart/vignette&#x27;</span><span class="diff-line add">+    - &#x27;{{ plex_role_paths_location }}/Library/Application Support/Plex Media Server/Plug-in Support/Data/com.plexapp.agents.hama/DataItems/TVDB/graphical&#x27;</span><span class="diff-line add">+    - &#x27;{{ plex_role_paths_location }}/Library/Application Support/Plex Media Server/Plug-in Support/Data/com.plexapp.agents.hama/DataItems/TVDB/posters&#x27;</span><span class="diff-line add">+    - &#x27;{{ plex_role_paths_location }}/Library/Application Support/Plex Media Server/Plug-in Support/Data/com.plexapp.agents.hama/DataItems/TVDB/seasons&#x27;</span><span class="diff-line add">+    - &#x27;{{ plex_role_paths_location }}/Library/Application Support/Plex Media Server/Plug-in Support/Data/com.plexapp.agents.hama/DataItems/TVDB/seasonswide&#x27;</span><span class="diff-line add">+    - &#x27;{{ plex_role_paths_location }}/Library/Application Support/Plex Media Server/Plug-in Support/Data/com.plexapp.agents.hama/DataItems/TVDB/text&#x27;</span><span class="diff-line add">+    - &#x27;{{ plex_role_paths_location }}/Library/Application Support/Plex Media Server/Plug-in Support/Data/com.plexapp.agents.hama/DataItems/FanartTV&#x27;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: &quot;Get latest Absolute Series Scanner.py&quot;</span><span class="diff-line context">   ansible.builtin.get_url:</span><span class="diff-line context">     url: https://raw.githubusercontent.com/ZeroQI/Absolute-Series-Scanner/master/Scanners/Series/Absolute%20Series%20Scanner.py</span><span class="diff-line del">-    dest: &quot;{{ plex_paths_location }}/Library/Application Support/Plex Media Server/Scanners/Series/Absolute Series Scanner.py&quot;</span><span class="diff-line add">+    dest: &quot;{{ plex_role_paths_location }}/Library/Application Support/Plex Media Server/Scanners/Series/Absolute Series Scanner.py&quot;</span><span class="diff-line context">     mode: &quot;0775&quot;</span><span class="diff-line context">   register: x</span><span class="diff-line context">   until: &quot;x is not failed&quot;</span><span class="diff-line hunk">@@ -54,7 +54,7 @@</span><span class="diff-line context"> </span><span class="diff-line context"> - name: &quot;Set ASS directory permissions&quot;</span><span class="diff-line context">   ansible.builtin.file:</span><span class="diff-line del">-    path: &#x27;{{ plex_paths_location }}/Library/Application Support/Plex Media Server/Scanners&#x27;</span><span class="diff-line add">+    path: &#x27;{{ plex_role_paths_location }}/Library/Application Support/Plex Media Server/Scanners&#x27;</span><span class="diff-line context">     state: directory</span><span class="diff-line context">     mode: &quot;0775&quot;</span><span class="diff-line context">     owner: &quot;{{ user.name }}&quot;</span><span class="diff-line hunk">@@ -64,7 +64,7 @@</span><span class="diff-line context"> - name: &quot;Clone Hama Bundle&quot;</span><span class="diff-line context">   ansible.builtin.git:</span><span class="diff-line context">     repo: https://github.com/ZeroQI/Hama.bundle.git</span><span class="diff-line del">-    dest: &#x27;{{ plex_paths_location }}/Library/Application Support/Plex Media Server/Plug-ins/Hama.bundle&#x27;</span><span class="diff-line add">+    dest: &#x27;{{ plex_role_paths_location }}/Library/Application Support/Plex Media Server/Plug-ins/Hama.bundle&#x27;</span><span class="diff-line context">     clone: true</span><span class="diff-line context">     version: HEAD</span><span class="diff-line context">     force: true</span><span class="diff-line hunk">@@ -73,7 +73,7 @@</span><span class="diff-line context"> </span><span class="diff-line context"> - name: &quot;Set HAMA directory permissions&quot;</span><span class="diff-line context">   ansible.builtin.file:</span><span class="diff-line del">-    path: &#x27;{{ plex_paths_location }}/Library/Application Support/Plex Media Server/Plug-ins/Hama.bundle&#x27;</span><span class="diff-line add">+    path: &#x27;{{ plex_role_paths_location }}/Library/Application Support/Plex Media Server/Plug-ins/Hama.bundle&#x27;</span><span class="diff-line context">     state: directory</span><span class="diff-line context">     mode: &quot;0775&quot;</span><span class="diff-line context">     owner: &quot;{{ user.name }}&quot;</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-104">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/authelia/defaults/main.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -17,268 +17,330 @@</span><span class="diff-line context"> # Settings</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line add">+# Themes - Sub-section Start</span><span class="diff-line context"> # Options are light, dark, grey or auto.</span><span class="diff-line del">-authelia_theme: &quot;auto&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Options are file or ldap</span><span class="diff-line del">-authelia_authentication_backend: &quot;file&quot;</span><span class="diff-line del">-authelia_authentication_backend_password_reset_disable: &quot;false&quot;</span><span class="diff-line del">-authelia_authentication_backend_password_reset_custom_url: &quot;&quot;</span><span class="diff-line del">-authelia_authentication_backend_refresh_interval: &quot;5m&quot;</span><span class="diff-line del">-authelia_authentication_backend_file_path: &quot;/config/users_database.yml&quot;</span><span class="diff-line del">-authelia_authentication_backend_file_watch: &quot;true&quot;</span><span class="diff-line del">-authelia_authentication_backend_file_password_algorithm: &quot;argon2&quot;</span><span class="diff-line del">-authelia_authentication_backend_file_password_argon2_variant: &quot;argon2id&quot;</span><span class="diff-line del">-authelia_authentication_backend_file_password_argon2_iterations: &quot;3&quot;</span><span class="diff-line del">-authelia_authentication_backend_file_password_argon2_memory: &quot;65536&quot;</span><span class="diff-line del">-authelia_authentication_backend_file_password_argon2_parallelism: &quot;4&quot;</span><span class="diff-line del">-authelia_authentication_backend_file_password_argon2_key_length: &quot;32&quot;</span><span class="diff-line del">-authelia_authentication_backend_file_password_argon2_salt_length: &quot;16&quot;</span><span class="diff-line del">-</span><span class="diff-line add">+authelia_role_theme: &quot;auto&quot;</span><span class="diff-line add">+# Themes - Sub-section End</span><span class="diff-line add">+</span><span class="diff-line add">+# Logs - Sub-section Start</span><span class="diff-line add">+# [GLOBAL] Reference: https://www.authelia.com/configuration/miscellaneous/logging/</span><span class="diff-line add">+# [NOGLOBAL] Logrotate configuration variable</span><span class="diff-line add">+authelia_role_log_max_backups: &quot;3&quot;</span><span class="diff-line add">+# [NOGLOBAL] Logrotate configuration variable</span><span class="diff-line add">+authelia_role_log_max_size: &quot;10&quot;</span><span class="diff-line add">+authelia_role_log_level: &quot;info&quot;</span><span class="diff-line add">+authelia_role_log_format: &quot;text&quot;</span><span class="diff-line add">+authelia_role_log_file_path: &quot;/config/authelia.log&quot;</span><span class="diff-line add">+authelia_role_log_keep_stdout: true</span><span class="diff-line add">+# Logs - Sub-section End</span><span class="diff-line add">+</span><span class="diff-line add">+# Authentication Backend - Sub-section Start</span><span class="diff-line add">+# [GLOBAL] https://www.authelia.com/configuration/first-factor/introduction/</span><span class="diff-line add">+# [GLOBAL] https://www.authelia.com/configuration/first-factor/file/</span><span class="diff-line add">+# [NOGLOBAL] Options are file or ldap</span><span class="diff-line add">+authelia_role_authentication_backend: &quot;file&quot;</span><span class="diff-line add">+authelia_role_authentication_backend_password_change_disable: false</span><span class="diff-line add">+authelia_role_authentication_backend_password_reset_disable: false</span><span class="diff-line add">+authelia_role_authentication_backend_password_reset_custom_url: &quot;&quot;</span><span class="diff-line add">+authelia_role_authentication_backend_refresh_interval: &quot;5m&quot;</span><span class="diff-line add">+authelia_role_authentication_backend_file_path: &quot;/config/users_database.yml&quot;</span><span class="diff-line add">+authelia_role_authentication_backend_file_watch: true</span><span class="diff-line add">+authelia_role_authentication_backend_file_password_algorithm: &quot;argon2&quot;</span><span class="diff-line add">+authelia_role_authentication_backend_file_password_argon2_variant: &quot;argon2id&quot;</span><span class="diff-line add">+authelia_role_authentication_backend_file_password_argon2_iterations: &quot;3&quot;</span><span class="diff-line add">+authelia_role_authentication_backend_file_password_argon2_memory: &quot;65536&quot;</span><span class="diff-line add">+authelia_role_authentication_backend_file_password_argon2_parallelism: &quot;4&quot;</span><span class="diff-line add">+authelia_role_authentication_backend_file_password_argon2_key_length: &quot;32&quot;</span><span class="diff-line add">+authelia_role_authentication_backend_file_password_argon2_salt_length: &quot;16&quot;</span><span class="diff-line add">+# Authentication Backend - Sub-section End</span><span class="diff-line add">+</span><span class="diff-line add">+# Access Control - Sub-section Start</span><span class="diff-line context"> # Setting for default Access Control Policy - recommended options one_factor or two_factor</span><span class="diff-line context"> # Reference: https://www.authelia.com/configuration/security/access-control/#one_factor</span><span class="diff-line del">-authelia_access_control_policy: &quot;one_factor&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Settings for Duo</span><span class="diff-line del">-# Reference: https://www.authelia.com/configuration/second-factor/duo/</span><span class="diff-line del">-authelia_duo_enabled: false</span><span class="diff-line del">-authelia_duo_hostname: &quot;&quot;</span><span class="diff-line del">-authelia_duo_integration_key: &quot;&quot;</span><span class="diff-line del">-authelia_duo_secret_key: &quot;&quot;</span><span class="diff-line del">-authelia_duo_self_enrollment: &quot;true&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Settings for Webauthn</span><span class="diff-line del">-# Reference: https://www.authelia.com/configuration/second-factor/webauthn/</span><span class="diff-line del">-authelia_webauthn_disable: false</span><span class="diff-line del">-authelia_webauthn_display_name: &quot;Authelia&quot;</span><span class="diff-line del">-authelia_webauthn_attestation_conveyance_preference: &quot;indirect&quot;</span><span class="diff-line del">-authelia_webauthn_user_verification: &quot;preferred&quot;</span><span class="diff-line del">-authelia_webauthn_timeout: &quot;60s&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Settings for Notifier</span><span class="diff-line del">-# Reference: https://www.authelia.com/configuration/notifications/introduction/</span><span class="diff-line del">-# Options are filesystem or smtp. Options specific to smtp prefixed with smtp</span><span class="diff-line del">-authelia_notifier: &quot;filesystem&quot;</span><span class="diff-line del">-authelia_notifier_disable_startup_check: &quot;false&quot;</span><span class="diff-line del">-authelia_notifier_smtp_host: &quot;&quot;</span><span class="diff-line del">-authelia_notifier_smtp_port: &quot;&quot;</span><span class="diff-line del">-authelia_notifier_smtp_timeout: &quot;&quot;</span><span class="diff-line del">-authelia_notifier_smtp_username: &quot;&quot;</span><span class="diff-line del">-authelia_notifier_smtp_password: &quot;&quot;</span><span class="diff-line del">-authelia_notifier_smtp_sender: &quot;&quot;</span><span class="diff-line del">-authelia_notifier_smtp_identifier: &quot;&quot;</span><span class="diff-line del">-authelia_notifier_smtp_subject: &quot;&quot;</span><span class="diff-line del">-authelia_notifier_smtp_startup_check_address: &quot;&quot;</span><span class="diff-line del">-authelia_notifier_smtp_disable_require_tls: &quot;&quot;</span><span class="diff-line del">-authelia_notifier_smtp_disable_html_emails: &quot;&quot;</span><span class="diff-line del">-authelia_notifier_smtp_tls_server_name: &quot;&quot;</span><span class="diff-line del">-authelia_notifier_smtp_tls_skip_verify: &quot;&quot;</span><span class="diff-line del">-authelia_notifier_smtp_tls_minimum_version: &quot;&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Settings for Authelia&#x27;s server</span><span class="diff-line del">-# Reference: https://www.authelia.com/configuration/miscellaneous/server/</span><span class="diff-line del">-# https://www.authelia.com/c/server#buffer-sizes</span><span class="diff-line del">-authelia_server_address: &quot;0.0.0.0:9091&quot;</span><span class="diff-line del">-authelia_server_buffers_read: &quot;10485760&quot;</span><span class="diff-line del">-authelia_server_buffers_write: &quot;10485760&quot;</span><span class="diff-line del">-authelia_server_enable_pprof: &quot;false&quot;</span><span class="diff-line del">-authelia_server_enable_expvars: &quot;false&quot;</span><span class="diff-line del">-authelia_server_disable_healthcheck: &quot;false&quot;</span><span class="diff-line del">-authelia_server_headers_csp_template: &quot;default-src &#x27;self&#x27; *.{{ user.domain }} {{ user.domain }}; script-src &#x27;self&#x27; *.{{ user.domain }} {{ user.domain }}; script-src-elem &#x27;self&#x27; *.{{ user.domain }} {{ user.domain }}; script-src-attr &#x27;self&#x27; *.{{ user.domain }} {{ user.domain }}; style-src &#x27;self&#x27; *.{{ user.domain }} {{ user.domain }} &#x27;nonce-${NONCE}&#x27;; style-src-elem &#x27;self&#x27; *.{{ user.domain }} {{ user.domain }} &#x27;nonce-${NONCE}&#x27;; style-src-attr &#x27;self&#x27; *.{{ user.domain }} {{ user.domain }} &#x27;nonce-${NONCE}&#x27;; img-src &#x27;self&#x27; *.{{ user.domain }} {{ user.domain }}; font-src &#x27;self&#x27; *.{{ user.domain }} {{ user.domain }}; connect-src &#x27;self&#x27; *.{{ user.domain }} {{ user.domain }}; media-src &#x27;self&#x27; *.{{ user.domain }} {{ user.domain }}; object-src &#x27;self&#x27; *.{{ user.domain }} {{ user.domain }}; child-src &#x27;self&#x27; *.{{ user.domain }} {{ user.domain }}; frame-src &#x27;self&#x27; *.{{ user.domain }} {{ user.domain }}; worker-src &#x27;self&#x27; *.{{ user.domain }} {{ user.domain }}; frame-ancestors &#x27;self&#x27; *.{{ user.domain }} {{ user.domain }}; form-action &#x27;self&#x27; *.{{ user.domain }} {{ user.domain }}; base-uri &#x27;self&#x27;&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Settings for Logging</span><span class="diff-line del">-# Reference: https://www.authelia.com/configuration/miscellaneous/logging/</span><span class="diff-line del">-authelia_log_level: &quot;info&quot;</span><span class="diff-line del">-authelia_log_format: &quot;text&quot;</span><span class="diff-line del">-authelia_log_file_path: &quot;/config/authelia.log&quot;</span><span class="diff-line del">-authelia_log_keep_stdout: &quot;true&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# JWT</span><span class="diff-line del">-authelia_jwt_secret: &quot;{{ lookup(&#x27;password&#x27;, &#x27;/dev/null&#x27;, chars=[&#x27;ascii_letters&#x27;, &#x27;digits&#x27;], length=32) }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# TOTP</span><span class="diff-line del">-authelia_totp_issuer: &quot;authelia.com&quot;</span><span class="diff-line del">-authelia_totp_period: &quot;30&quot;</span><span class="diff-line del">-authelia_totp_skew: &quot;1&quot;</span><span class="diff-line del">-authelia_totp_digits: &quot;6&quot;</span><span class="diff-line del">-authelia_totp_secret_size: &quot;32&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Default redirection</span><span class="diff-line del">-authelia_default_redirection_url: &quot;&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Default 2FA Method</span><span class="diff-line del">-authelia_default_2fa_method: &quot;&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# NTP</span><span class="diff-line del">-authelia_ntp_address: &quot;time.cloudflare.com:123&quot;</span><span class="diff-line del">-authelia_ntp_version: &quot;3&quot;</span><span class="diff-line del">-authelia_ntp_max_desync: &quot;3s&quot;</span><span class="diff-line del">-authelia_ntp_disable_startup_check: &quot;false&quot;</span><span class="diff-line del">-authelia_ntp_disable_failure: &quot;false&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Password Policy</span><span class="diff-line del">-authelia_password_policy_standard_enabled: &quot;false&quot;</span><span class="diff-line del">-authelia_password_policy_standard_min_length: &quot;8&quot;</span><span class="diff-line del">-authelia_password_policy_standard_max_length: &quot;0&quot;</span><span class="diff-line del">-authelia_password_policy_standard_require_uppercase: &quot;true&quot;</span><span class="diff-line del">-authelia_password_policy_standard_require_lowercase: &quot;true&quot;</span><span class="diff-line del">-authelia_password_policy_standard_require_number: &quot;true&quot;</span><span class="diff-line del">-authelia_password_policy_standard_require_special: &quot;true&quot;</span><span class="diff-line del">-authelia_password_policy_zxcvbn_enabled: &quot;false&quot;</span><span class="diff-line del">-authelia_password_policy_zxcvbn_min_score: &quot;3&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Access Control</span><span class="diff-line del">-authelia_access_control_whitelist_host: false</span><span class="diff-line del">-authelia_access_control_default_policy: &quot;deny&quot;</span><span class="diff-line del">-authelia_access_control_rules:</span><span class="diff-line add">+authelia_role_access_control_policy: &quot;one_factor&quot;</span><span class="diff-line add">+# Whitelists the host IPv4/IPv6 addresses depending on which are enabled</span><span class="diff-line add">+authelia_role_access_control_whitelist_host: false</span><span class="diff-line add">+# Whitelists the saltbox Docker network IP subnet</span><span class="diff-line add">+authelia_role_access_control_whitelist_docker: false</span><span class="diff-line add">+# Skip docs</span><span class="diff-line add">+authelia_role_access_control_default_policy: &quot;deny&quot;</span><span class="diff-line add">+# Skip docs</span><span class="diff-line add">+authelia_role_access_control_rules:</span><span class="diff-line context">   - domain:</span><span class="diff-line context">       - &quot;{{ &#x27;*.&#x27; + user.domain | lower }}&quot;</span><span class="diff-line context">       - &quot;{{ user.domain | lower }}&quot;</span><span class="diff-line del">-    policy: &quot;{{ authelia_access_control_policy }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-authelia_access_control_whitelist_rules_lookup: &quot;{{ authelia_access_control_whitelist_rules if authelia_access_control_whitelist_host and ((dns.ipv4 | default(true)) or (dns.ipv6 | default(false))) else [] }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-authelia_access_control_whitelist_rules:</span><span class="diff-line add">+    policy: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_access_control_policy&#x27;, role=&#x27;authelia&#x27;) }}&quot;</span><span class="diff-line add">+</span><span class="diff-line add">+# Skip docs</span><span class="diff-line add">+authelia_role_access_control_whitelist_rules_lookup: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_access_control_whitelist_rules_docker_lookup&#x27;, role=&#x27;authelia&#x27;)</span><span class="diff-line add">+                                                         + lookup(&#x27;role_var&#x27;, &#x27;_access_control_whitelist_rules_host_lookup&#x27;, role=&#x27;authelia&#x27;) }}&quot;</span><span class="diff-line add">+</span><span class="diff-line add">+</span><span class="diff-line add">+# Skip docs</span><span class="diff-line add">+authelia_role_access_control_whitelist_rules_docker_lookup: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_access_control_whitelist_rules_docker&#x27;, role=&#x27;authelia&#x27;)</span><span class="diff-line add">+                                                             if lookup(&#x27;role_var&#x27;, &#x27;_access_control_whitelist_docker&#x27;, role=&#x27;authelia&#x27;)</span><span class="diff-line add">+                                                             else [] }}&quot;</span><span class="diff-line add">+</span><span class="diff-line add">+# Skip docs</span><span class="diff-line add">+authelia_role_access_control_whitelist_rules_host_lookup: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_access_control_whitelist_rules_host&#x27;, role=&#x27;authelia&#x27;)</span><span class="diff-line add">+                                                           if lookup(&#x27;role_var&#x27;, &#x27;_access_control_whitelist_host&#x27;, role=&#x27;authelia&#x27;) and (dns_ipv4_enabled or dns_ipv6_enabled)</span><span class="diff-line add">+                                                           else [] }}&quot;</span><span class="diff-line add">+</span><span class="diff-line add">+# Skip docs</span><span class="diff-line add">+authelia_role_access_control_whitelist_rules_host:</span><span class="diff-line context">   - domain:</span><span class="diff-line context">       - &quot;{{ &#x27;*.&#x27; + user.domain }}&quot;</span><span class="diff-line context">       - &quot;{{ user.domain }}&quot;</span><span class="diff-line context">     policy: bypass</span><span class="diff-line del">-    networks: &quot;{{ authelia_access_control_whitelist_networks | unique | reject(&#x27;equalto&#x27;, omit) | list }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-authelia_access_control_whitelist_networks:</span><span class="diff-line del">-  - &quot;{{ (ip_address_public + &#x27;/32&#x27;) if (dns.ipv4 | default(true)) else omit }}&quot;</span><span class="diff-line del">-  - &quot;{{ (ipv6_address_public + &#x27;/128&#x27;) if (dns.ipv6 | default(false)) else omit }}&quot;</span><span class="diff-line add">+    networks: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_access_control_whitelist_networks_host&#x27;, role=&#x27;authelia&#x27;) | unique | reject(&#x27;equalto&#x27;, omit) | list }}&quot;</span><span class="diff-line add">+</span><span class="diff-line add">+# Skip docs</span><span class="diff-line add">+authelia_role_access_control_whitelist_rules_docker:</span><span class="diff-line add">+  - domain:</span><span class="diff-line add">+      - &quot;{{ &#x27;*.&#x27; + user.domain }}&quot;</span><span class="diff-line add">+      - &quot;{{ user.domain }}&quot;</span><span class="diff-line add">+    policy: bypass</span><span class="diff-line add">+    networks: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_access_control_whitelist_networks_docker&#x27;, role=&#x27;authelia&#x27;) | unique | reject(&#x27;equalto&#x27;, omit) | list }}&quot;</span><span class="diff-line add">+</span><span class="diff-line add">+# Skip docs</span><span class="diff-line add">+authelia_role_access_control_whitelist_networks_docker:</span><span class="diff-line add">+  - &quot;172.19.0.0/16&quot;</span><span class="diff-line add">+</span><span class="diff-line add">+# Skip docs</span><span class="diff-line add">+authelia_role_access_control_whitelist_networks_host:</span><span class="diff-line add">+  - &quot;{{ (ip_address_public + &#x27;/32&#x27;) if dns_ipv4_enabled else omit }}&quot;</span><span class="diff-line add">+  - &quot;{{ (ipv6_address_public + &#x27;/128&#x27;) if dns_ipv6_enabled else omit }}&quot;</span><span class="diff-line add">+# Access Control - Sub-section End</span><span class="diff-line add">+</span><span class="diff-line add">+# Second Factor - Sub-section Start</span><span class="diff-line add">+authelia_role_default_2fa_method: &quot;&quot;</span><span class="diff-line add">+# Second Factor - Sub-section End</span><span class="diff-line add">+</span><span class="diff-line add">+# Second Factor - Duo - Sub-section Start</span><span class="diff-line add">+# [GLOBAL] Reference: https://www.authelia.com/configuration/second-factor/duo/</span><span class="diff-line add">+authelia_role_duo_enabled: false</span><span class="diff-line add">+authelia_role_duo_hostname: &quot;&quot;</span><span class="diff-line add">+authelia_role_duo_integration_key: &quot;&quot;</span><span class="diff-line add">+authelia_role_duo_secret_key: &quot;&quot;</span><span class="diff-line add">+authelia_role_duo_self_enrollment: true</span><span class="diff-line add">+# Second Factor - Duo - Sub-section End</span><span class="diff-line add">+</span><span class="diff-line add">+# Second Factor - Webauthn - Sub-section Start</span><span class="diff-line add">+# [GLOBAL] Reference: https://www.authelia.com/configuration/second-factor/webauthn/</span><span class="diff-line add">+authelia_role_webauthn_disable: false</span><span class="diff-line add">+authelia_role_webauthn_enable_passkey_login: false</span><span class="diff-line add">+authelia_role_webauthn_display_name: &quot;Authelia&quot;</span><span class="diff-line add">+authelia_role_webauthn_attestation_conveyance_preference: &quot;indirect&quot;</span><span class="diff-line add">+authelia_role_webauthn_timeout: &quot;60s&quot;</span><span class="diff-line add">+authelia_role_webauthn_filtering_prohibit_backup_eligibility: false</span><span class="diff-line add">+authelia_role_webauthn_filtering_permitted_aaguids: []</span><span class="diff-line add">+authelia_role_webauthn_filtering_prohibited_aaguids: []</span><span class="diff-line add">+authelia_role_webauthn_selection_criteria_attachment: &quot;cross-platform&quot;</span><span class="diff-line add">+authelia_role_webauthn_selection_criteria_discoverability: &quot;discouraged&quot;</span><span class="diff-line add">+authelia_role_webauthn_selection_criteria_user_verification: &quot;preferred&quot;</span><span class="diff-line add">+authelia_role_webauthn_metadata_enabled: false</span><span class="diff-line add">+authelia_role_webauthn_metadata_cache_policy: &quot;strict&quot;</span><span class="diff-line add">+authelia_role_webauthn_metadata_validate_trust_anchor: true</span><span class="diff-line add">+authelia_role_webauthn_metadata_validate_entry: true</span><span class="diff-line add">+authelia_role_webauthn_metadata_validate_entry_permit_zero_aaguid: false</span><span class="diff-line add">+authelia_role_webauthn_metadata_validate_status: true</span><span class="diff-line add">+authelia_role_webauthn_metadata_validate_status_permitted: []</span><span class="diff-line add">+authelia_role_webauthn_metadata_validate_status_prohibited: []</span><span class="diff-line add">+# Second Factor - Webauthn - Sub-section End</span><span class="diff-line add">+</span><span class="diff-line add">+# Notifier - Sub-section Start</span><span class="diff-line add">+# [GLOBAL] Reference: https://www.authelia.com/configuration/notifications/introduction/</span><span class="diff-line add">+# Options are filesystem or smtp. Options specific to smtp prefixed with smtp</span><span class="diff-line add">+authelia_role_notifier: &quot;filesystem&quot;</span><span class="diff-line add">+authelia_role_notifier_disable_startup_check: false</span><span class="diff-line add">+authelia_role_notifier_smtp_host: &quot;&quot;</span><span class="diff-line add">+authelia_role_notifier_smtp_port: &quot;&quot;</span><span class="diff-line add">+authelia_role_notifier_smtp_timeout: &quot;&quot;</span><span class="diff-line add">+authelia_role_notifier_smtp_username: &quot;&quot;</span><span class="diff-line add">+authelia_role_notifier_smtp_password: &quot;&quot;</span><span class="diff-line add">+authelia_role_notifier_smtp_sender: &quot;&quot;</span><span class="diff-line add">+authelia_role_notifier_smtp_identifier: &quot;&quot;</span><span class="diff-line add">+authelia_role_notifier_smtp_subject: &quot;&quot;</span><span class="diff-line add">+authelia_role_notifier_smtp_startup_check_address: &quot;&quot;</span><span class="diff-line add">+authelia_role_notifier_smtp_disable_require_tls: &quot;&quot;</span><span class="diff-line add">+authelia_role_notifier_smtp_disable_html_emails: &quot;&quot;</span><span class="diff-line add">+authelia_role_notifier_smtp_tls_server_name: &quot;&quot;</span><span class="diff-line add">+authelia_role_notifier_smtp_tls_skip_verify: &quot;&quot;</span><span class="diff-line add">+authelia_role_notifier_smtp_tls_minimum_version: &quot;&quot;</span><span class="diff-line add">+# Notifier - Sub-section End</span><span class="diff-line add">+</span><span class="diff-line add">+# Server - Sub-section Start</span><span class="diff-line add">+# [GLOBAL] Reference: https://www.authelia.com/configuration/miscellaneous/server/</span><span class="diff-line add">+authelia_role_server_address: &quot;0.0.0.0:9091&quot;</span><span class="diff-line add">+authelia_role_server_asset_path: &quot;&quot;</span><span class="diff-line add">+authelia_role_server_disable_healthcheck: false</span><span class="diff-line add">+authelia_role_server_buffers_read: &quot;10485760&quot;</span><span class="diff-line add">+authelia_role_server_buffers_write: &quot;10485760&quot;</span><span class="diff-line add">+authelia_role_server_timeouts_read: &quot;6s&quot;</span><span class="diff-line add">+authelia_role_server_timeouts_write: &quot;6s&quot;</span><span class="diff-line add">+authelia_role_server_timeouts_idle: &quot;30s&quot;</span><span class="diff-line add">+authelia_role_server_endpoints_enable_pprof: false</span><span class="diff-line add">+authelia_role_server_endpoints_enable_expvars: false</span><span class="diff-line add">+authelia_role_server_headers_csp_template: &quot;default-src &#x27;self&#x27; *.{{ user.domain }} {{ user.domain }}; script-src &#x27;self&#x27; *.{{ user.domain }} {{ user.domain }}; script-src-elem &#x27;self&#x27; *.{{ user.domain }} {{ user.domain }}; script-src-attr &#x27;self&#x27; *.{{ user.domain }} {{ user.domain }}; style-src &#x27;self&#x27; *.{{ user.domain }} {{ user.domain }} &#x27;nonce-${NONCE}&#x27;; style-src-elem &#x27;self&#x27; *.{{ user.domain }} {{ user.domain }} &#x27;nonce-${NONCE}&#x27;; style-src-attr &#x27;self&#x27; *.{{ user.domain }} {{ user.domain }} &#x27;nonce-${NONCE}&#x27;; img-src &#x27;self&#x27; *.{{ user.domain }} {{ user.domain }}; font-src &#x27;self&#x27; *.{{ user.domain }} {{ user.domain }}; connect-src &#x27;self&#x27; *.{{ user.domain }} {{ user.domain }}; media-src &#x27;self&#x27; *.{{ user.domain }} {{ user.domain }}; object-src &#x27;self&#x27; *.{{ user.domain }} {{ user.domain }}; child-src &#x27;self&#x27; *.{{ user.domain }} {{ user.domain }}; frame-src &#x27;self&#x27; *.{{ user.domain }} {{ user.domain }}; worker-src &#x27;self&#x27; *.{{ user.domain }} {{ user.domain }}; frame-ancestors &#x27;self&#x27; *.{{ user.domain }} {{ user.domain }}; form-action &#x27;self&#x27; *.{{ user.domain }} {{ user.domain }}; base-uri &#x27;self&#x27;&quot;</span><span class="diff-line add">+# Server - Sub-section End</span><span class="diff-line add">+</span><span class="diff-line add">+# Metrics - Sub-section Start</span><span class="diff-line add">+# [GLOBAL] Reference: https://www.authelia.com/configuration/telemetry/metrics/</span><span class="diff-line add">+authelia_role_telemetry_metrics_enabled: false</span><span class="diff-line add">+authelia_role_telemetry_metrics_address: &quot;tcp://0.0.0.0:9959&quot;</span><span class="diff-line add">+authelia_role_telemetry_metrics_buffers_read: &quot;4096&quot;</span><span class="diff-line add">+authelia_role_telemetry_metrics_buffers_write: &quot;4096&quot;</span><span class="diff-line add">+authelia_role_telemetry_metrics_timeouts_read: &quot;6s&quot;</span><span class="diff-line add">+authelia_role_telemetry_metrics_timeouts_write: &quot;6s&quot;</span><span class="diff-line add">+authelia_role_telemetry_metrics_timeouts_idle: &quot;30s&quot;</span><span class="diff-line add">+# Metrics - Sub-section End</span><span class="diff-line add">+</span><span class="diff-line add">+# Identity Validation - Sub-section Start</span><span class="diff-line add">+authelia_role_identity_validation_reset_password_jwt_lifespan: &quot;5m&quot;</span><span class="diff-line add">+authelia_role_identity_validation_reset_password_jwt_algorithm: &quot;HS256&quot;</span><span class="diff-line add">+authelia_role_identity_validation_elevated_session_code_lifespan: &quot;5m&quot;</span><span class="diff-line add">+authelia_role_identity_validation_elevated_session_elevation_lifespan: &quot;10m&quot;</span><span class="diff-line add">+authelia_role_identity_validation_elevated_session_characters: &quot;8&quot;</span><span class="diff-line add">+authelia_role_identity_validation_elevated_session_require_second_factor: false</span><span class="diff-line add">+authelia_role_identity_validation_elevated_session_skip_second_factor: false</span><span class="diff-line add">+# Identity Validation - Sub-section End</span><span class="diff-line add">+</span><span class="diff-line add">+# JWT - Sub-section Start</span><span class="diff-line add">+authelia_role_jwt_secret: &quot;{{ lookup(&#x27;password&#x27;, &#x27;/dev/null&#x27;, chars=[&#x27;ascii_letters&#x27;, &#x27;digits&#x27;], length=32) }}&quot;</span><span class="diff-line add">+# JWT - Sub-section End</span><span class="diff-line add">+</span><span class="diff-line add">+# TOTP - Sub-section Start</span><span class="diff-line add">+authelia_role_totp_disable: false</span><span class="diff-line add">+authelia_role_totp_issuer: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_web_subdomain&#x27;, role=&#x27;authelia&#x27;) + &#x27;.&#x27; + lookup(&#x27;role_var&#x27;, &#x27;_web_domain&#x27;, role=&#x27;authelia&#x27;) }}&quot;</span><span class="diff-line add">+authelia_role_totp_algorithm: &quot;SHA1&quot;</span><span class="diff-line add">+authelia_role_totp_digits: &quot;6&quot;</span><span class="diff-line add">+authelia_role_totp_period: &quot;30&quot;</span><span class="diff-line add">+authelia_role_totp_skew: &quot;1&quot;</span><span class="diff-line add">+authelia_role_totp_secret_size: &quot;32&quot;</span><span class="diff-line add">+authelia_role_totp_allowed_algorithms: [&quot;SHA1&quot;]</span><span class="diff-line add">+authelia_role_totp_allowed_digits: [&quot;6&quot;]</span><span class="diff-line add">+authelia_role_totp_allowed_periods: [&quot;30&quot;]</span><span class="diff-line add">+authelia_role_totp_disable_reuse_security_policy: false</span><span class="diff-line add">+# TOTP - Sub-section End</span><span class="diff-line add">+</span><span class="diff-line add">+# Session - Sub-section Start</span><span class="diff-line add">+authelia_role_default_redirection_url: &quot;&quot;</span><span class="diff-line add">+# Session - Sub-section End</span><span class="diff-line add">+</span><span class="diff-line add">+# NTP - Sub-section Start</span><span class="diff-line add">+authelia_role_ntp_address: &quot;time.cloudflare.com:123&quot;</span><span class="diff-line add">+authelia_role_ntp_version: &quot;3&quot;</span><span class="diff-line add">+authelia_role_ntp_max_desync: &quot;3s&quot;</span><span class="diff-line add">+authelia_role_ntp_disable_startup_check: false</span><span class="diff-line add">+authelia_role_ntp_disable_failure: false</span><span class="diff-line add">+# NTP - Sub-section End</span><span class="diff-line add">+</span><span class="diff-line add">+# Password Policy - Sub-section Start</span><span class="diff-line add">+authelia_role_password_policy_standard_enabled: false</span><span class="diff-line add">+authelia_role_password_policy_standard_min_length: &quot;8&quot;</span><span class="diff-line add">+authelia_role_password_policy_standard_max_length: &quot;0&quot;</span><span class="diff-line add">+authelia_role_password_policy_standard_require_uppercase: true</span><span class="diff-line add">+authelia_role_password_policy_standard_require_lowercase: true</span><span class="diff-line add">+authelia_role_password_policy_standard_require_number: true</span><span class="diff-line add">+authelia_role_password_policy_standard_require_special: true</span><span class="diff-line add">+authelia_role_password_policy_zxcvbn_enabled: false</span><span class="diff-line add">+authelia_role_password_policy_zxcvbn_min_score: &quot;3&quot;</span><span class="diff-line add">+# Password Policy - Sub-section End</span><span class="diff-line add">+</span><span class="diff-line add">+# Skip docs</span><span class="diff-line add">+authelia_role_response_headers:</span><span class="diff-line add">+  - &quot;Remote-User&quot;</span><span class="diff-line add">+  - &quot;Remote-Groups&quot;</span><span class="diff-line add">+  - &quot;Remote-Name&quot;</span><span class="diff-line add">+  - &quot;Remote-Email&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # Paths</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-authelia_paths_folder: &quot;{{ authelia_name }}&quot;</span><span class="diff-line del">-authelia_paths_location: &quot;{{ server_appdata_path }}/{{ authelia_paths_folder }}&quot;</span><span class="diff-line del">-authelia_paths_folders_list:</span><span class="diff-line del">-  - &quot;{{ authelia_paths_location }}&quot;</span><span class="diff-line add">+authelia_role_paths_folder: &quot;{{ authelia_name }}&quot;</span><span class="diff-line add">+authelia_role_paths_location: &quot;{{ server_appdata_path }}/{{ authelia_role_paths_folder }}&quot;</span><span class="diff-line add">+authelia_role_paths_folders_list:</span><span class="diff-line add">+  - &quot;{{ authelia_role_paths_location }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # Web</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-authelia_web_subdomain: &quot;{{ authelia.subdomain }}&quot;</span><span class="diff-line del">-authelia_web_domain: &quot;{{ user.domain }}&quot;</span><span class="diff-line del">-authelia_web_port: &quot;9091&quot;</span><span class="diff-line del">-authelia_web_url: &quot;{{ &#x27;https://&#x27; + (authelia_web_subdomain + &#x27;.&#x27; + authelia_web_domain</span><span class="diff-line del">-                   if (authelia_web_subdomain | length &gt; 0)</span><span class="diff-line del">-                   else authelia_web_domain) }}&quot;</span><span class="diff-line add">+authelia_role_web_subdomain: &quot;{{ authelia.subdomain }}&quot;</span><span class="diff-line add">+authelia_role_web_domain: &quot;{{ user.domain }}&quot;</span><span class="diff-line add">+authelia_role_web_port: &quot;9091&quot;</span><span class="diff-line add">+authelia_role_web_url: &quot;{{ &#x27;https://&#x27; + (lookup(&#x27;role_var&#x27;, &#x27;_web_subdomain&#x27;, role=&#x27;authelia&#x27;) + &#x27;.&#x27; + lookup(&#x27;role_var&#x27;, &#x27;_web_domain&#x27;, role=&#x27;authelia&#x27;)</span><span class="diff-line add">+                        if (lookup(&#x27;role_var&#x27;, &#x27;_web_subdomain&#x27;, role=&#x27;authelia&#x27;) | length &gt; 0)</span><span class="diff-line add">+                        else lookup(&#x27;role_var&#x27;, &#x27;_web_domain&#x27;, role=&#x27;authelia&#x27;)) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # DNS</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-authelia_dns_record: &quot;{{ authelia_web_subdomain }}&quot;</span><span class="diff-line del">-authelia_dns_zone: &quot;{{ authelia_web_domain }}&quot;</span><span class="diff-line del">-authelia_dns_proxy: &quot;{{ dns.proxied }}&quot;</span><span class="diff-line add">+authelia_role_dns_record: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_web_subdomain&#x27;, role=&#x27;authelia&#x27;) }}&quot;</span><span class="diff-line add">+authelia_role_dns_zone: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_web_domain&#x27;, role=&#x27;authelia&#x27;) }}&quot;</span><span class="diff-line add">+authelia_role_dns_proxy: &quot;{{ dns_proxied }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # Traefik</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-authelia_traefik_sso_middleware: &quot;&quot;</span><span class="diff-line del">-authelia_traefik_middleware_default: &quot;{{ traefik_default_middleware }}&quot;</span><span class="diff-line del">-authelia_traefik_middleware_custom: &quot;&quot;</span><span class="diff-line del">-authelia_traefik_certresolver: &quot;{{ traefik_default_certresolver }}&quot;</span><span class="diff-line del">-authelia_traefik_enabled: true</span><span class="diff-line del">-authelia_traefik_api_enabled: false</span><span class="diff-line del">-authelia_traefik_api_endpoint: &quot;&quot;</span><span class="diff-line add">+authelia_role_traefik_sso_middleware: &quot;&quot;</span><span class="diff-line add">+authelia_role_traefik_middleware_default: &quot;{{ traefik_default_middleware }}&quot;</span><span class="diff-line add">+authelia_role_traefik_middleware_custom: &quot;&quot;</span><span class="diff-line add">+authelia_role_traefik_certresolver: &quot;{{ traefik_default_certresolver }}&quot;</span><span class="diff-line add">+authelia_role_traefik_enabled: true</span><span class="diff-line add">+authelia_role_traefik_api_enabled: false</span><span class="diff-line add">+authelia_role_traefik_api_endpoint: &quot;&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # Docker</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line context"> # Container</span><span class="diff-line del">-authelia_docker_container: &quot;{{ authelia_name }}&quot;</span><span class="diff-line add">+authelia_role_docker_container: &quot;{{ authelia_name }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Image</span><span class="diff-line del">-authelia_docker_image_pull: true</span><span class="diff-line del">-authelia_docker_image_tag: &quot;4.38&quot;</span><span class="diff-line del">-authelia_docker_image: &quot;authelia/authelia:{{ authelia_docker_image_tag }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Ports</span><span class="diff-line del">-authelia_docker_ports_defaults: []</span><span class="diff-line del">-authelia_docker_ports_custom: []</span><span class="diff-line del">-authelia_docker_ports: &quot;{{ authelia_docker_ports_defaults</span><span class="diff-line del">-                           + authelia_docker_ports_custom }}&quot;</span><span class="diff-line add">+authelia_role_docker_image_pull: true</span><span class="diff-line add">+authelia_role_docker_image_repo: &quot;authelia/authelia&quot;</span><span class="diff-line add">+authelia_role_docker_image_tag: &quot;4.39&quot;</span><span class="diff-line add">+authelia_role_docker_image: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_image_repo&#x27;, role=&#x27;authelia&#x27;) }}:{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_image_tag&#x27;, role=&#x27;authelia&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Envs</span><span class="diff-line del">-authelia_docker_envs_default:</span><span class="diff-line add">+authelia_role_docker_envs_default:</span><span class="diff-line context">   TZ: &quot;{{ tz }}&quot;</span><span class="diff-line context">   PUID: &quot;{{ uid }}&quot;</span><span class="diff-line context">   PGID: &quot;{{ gid }}&quot;</span><span class="diff-line del">-authelia_docker_envs_custom: {}</span><span class="diff-line del">-authelia_docker_envs: &quot;{{ authelia_docker_envs_default</span><span class="diff-line del">-                          | combine(authelia_docker_envs_custom) }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Commands</span><span class="diff-line del">-authelia_docker_commands_default: []</span><span class="diff-line del">-authelia_docker_commands_custom: []</span><span class="diff-line del">-authelia_docker_commands: &quot;{{ authelia_docker_commands_default</span><span class="diff-line del">-                              + authelia_docker_commands_custom }}&quot;</span><span class="diff-line add">+authelia_role_docker_envs_custom: {}</span><span class="diff-line add">+authelia_role_docker_envs: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_envs_default&#x27;, role=&#x27;authelia&#x27;)</span><span class="diff-line add">+                               | combine(lookup(&#x27;role_var&#x27;, &#x27;_docker_envs_custom&#x27;, role=&#x27;authelia&#x27;)) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Volumes</span><span class="diff-line del">-authelia_docker_volumes_default:</span><span class="diff-line del">-  - &quot;{{ authelia_paths_location }}:/config&quot;</span><span class="diff-line del">-authelia_docker_volumes_custom: []</span><span class="diff-line del">-authelia_docker_volumes: &quot;{{ authelia_docker_volumes_default</span><span class="diff-line del">-                             + authelia_docker_volumes_custom }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Devices</span><span class="diff-line del">-authelia_docker_devices_default: []</span><span class="diff-line del">-authelia_docker_devices_custom: []</span><span class="diff-line del">-authelia_docker_devices: &quot;{{ authelia_docker_devices_default</span><span class="diff-line del">-                             + authelia_docker_devices_custom }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Hosts</span><span class="diff-line del">-authelia_docker_hosts_default: {}</span><span class="diff-line del">-authelia_docker_hosts_custom: {}</span><span class="diff-line del">-authelia_docker_hosts: &quot;{{ docker_hosts_common</span><span class="diff-line del">-                           | combine(authelia_docker_hosts_default)</span><span class="diff-line del">-                           | combine(authelia_docker_hosts_custom) }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Labels</span><span class="diff-line del">-authelia_docker_labels_default: {}</span><span class="diff-line del">-authelia_docker_labels_custom: {}</span><span class="diff-line del">-authelia_docker_labels: &quot;{{ docker_labels_common</span><span class="diff-line del">-                            | combine(authelia_docker_labels_default)</span><span class="diff-line del">-                            | combine(authelia_docker_labels_custom) }}&quot;</span><span class="diff-line add">+authelia_role_docker_volumes_default:</span><span class="diff-line add">+  - &quot;{{ authelia_role_paths_location }}:/config&quot;</span><span class="diff-line add">+authelia_role_docker_volumes_custom: []</span><span class="diff-line add">+authelia_role_docker_volumes: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_volumes_default&#x27;, role=&#x27;authelia&#x27;)</span><span class="diff-line add">+                                  + lookup(&#x27;role_var&#x27;, &#x27;_docker_volumes_custom&#x27;, role=&#x27;authelia&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Hostname</span><span class="diff-line del">-authelia_docker_hostname: &quot;{{ authelia_name }}&quot;</span><span class="diff-line add">+authelia_role_docker_hostname: &quot;{{ authelia_name }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Networks</span><span class="diff-line del">-authelia_docker_networks_alias: &quot;{{ authelia_name }}&quot;</span><span class="diff-line del">-authelia_docker_networks_default: []</span><span class="diff-line del">-authelia_docker_networks_custom: []</span><span class="diff-line del">-authelia_docker_networks: &quot;{{ docker_networks_common</span><span class="diff-line del">-                              + authelia_docker_networks_default</span><span class="diff-line del">-                              + authelia_docker_networks_custom }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Capabilities</span><span class="diff-line del">-authelia_docker_capabilities_default: []</span><span class="diff-line del">-authelia_docker_capabilities_custom: []</span><span class="diff-line del">-authelia_docker_capabilities: &quot;{{ authelia_docker_capabilities_default</span><span class="diff-line del">-                                  + authelia_docker_capabilities_custom }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Security Opts</span><span class="diff-line del">-authelia_docker_security_opts_default: []</span><span class="diff-line del">-authelia_docker_security_opts_custom: []</span><span class="diff-line del">-authelia_docker_security_opts: &quot;{{ authelia_docker_security_opts_default</span><span class="diff-line del">-                                   + authelia_docker_security_opts_custom }}&quot;</span><span class="diff-line add">+authelia_role_docker_networks_alias: &quot;{{ authelia_name }}&quot;</span><span class="diff-line add">+authelia_role_docker_networks_default: []</span><span class="diff-line add">+authelia_role_docker_networks_custom: []</span><span class="diff-line add">+authelia_role_docker_networks: &quot;{{ docker_networks_common</span><span class="diff-line add">+                                   + lookup(&#x27;role_var&#x27;, &#x27;_docker_networks_default&#x27;, role=&#x27;authelia&#x27;)</span><span class="diff-line add">+                                   + lookup(&#x27;role_var&#x27;, &#x27;_docker_networks_custom&#x27;, role=&#x27;authelia&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Restart Policy</span><span class="diff-line del">-authelia_docker_restart_policy: unless-stopped</span><span class="diff-line add">+authelia_role_docker_restart_policy: unless-stopped</span><span class="diff-line context"> </span><span class="diff-line context"> # State</span><span class="diff-line del">-authelia_docker_state: started</span><span class="diff-line add">+authelia_role_docker_state: started</span><span class="diff-line context"> </span><span class="diff-line context"> # Dependencies</span><span class="diff-line del">-authelia_depends_on: &quot;{{ &#x27;authelia-redis,lldap&#x27; if (authelia_authentication_backend == &#x27;ldap&#x27;) else &#x27;authelia-redis&#x27; }}&quot;</span><span class="diff-line del">-authelia_depends_on_delay: &quot;0&quot;</span><span class="diff-line del">-authelia_depends_on_healthchecks: &quot;{{ &#x27;true&#x27; if (authelia_authentication_backend == &#x27;ldap&#x27;) else &#x27;false&#x27; }}&quot;</span><span class="diff-line add">+authelia_role_depends_on: &quot;{{ &#x27;authelia-redis,lldap&#x27; if (lookup(&#x27;role_var&#x27;, &#x27;_authentication_backend&#x27;, role=&#x27;authelia&#x27;) == &#x27;ldap&#x27;) else &#x27;authelia-redis&#x27; }}&quot;</span><span class="diff-line add">+authelia_role_depends_on_delay: &quot;0&quot;</span><span class="diff-line add">+authelia_role_depends_on_healthchecks: &quot;{{ &#x27;true&#x27; if (lookup(&#x27;role_var&#x27;, &#x27;_authentication_backend&#x27;, role=&#x27;authelia&#x27;) == &#x27;ldap&#x27;) else &#x27;false&#x27; }}&quot;</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-105">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/authelia/tasks/main.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -14,15 +14,15 @@</span><span class="diff-line context"> </span><span class="diff-line context"> - name: &quot;Fail if invalid Authentication Backend&quot;</span><span class="diff-line context">   ansible.builtin.fail:</span><span class="diff-line del">-    msg: &quot;authelia_authentication_backend is not valid. Use &#x27;file&#x27; or &#x27;ldap&#x27;.&quot;</span><span class="diff-line del">-  when: not authelia_authentication_backend in [&quot;file&quot;, &quot;ldap&quot;]</span><span class="diff-line add">+    msg: &quot;{{ authelia_name }}_authentication_backend or {{ authelia_name }}_role_authentication_backend is not valid. Use &#x27;file&#x27; or &#x27;ldap&#x27;.&quot;</span><span class="diff-line add">+  when: not lookup(&#x27;role_var&#x27;, &#x27;_authentication_backend&#x27;) in [&quot;file&quot;, &quot;ldap&quot;]</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Remove existing Docker container</span><span class="diff-line context">   ansible.builtin.include_tasks: &quot;{{ resources_tasks_path }}/docker/remove_docker_container.yml&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Reset Authelia directory</span><span class="diff-line context">   ansible.builtin.file:</span><span class="diff-line del">-    path: &quot;{{ authelia_paths_location }}&quot;</span><span class="diff-line add">+    path: &quot;{{ authelia_role_paths_location }}&quot;</span><span class="diff-line context">     state: absent</span><span class="diff-line context">   when: (&#x27;authelia-reset&#x27; in ansible_run_tags)</span><span class="diff-line context"> </span><span class="diff-line hunk">@@ -31,29 +31,29 @@</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Check if &#x27;configuration.yml&#x27; exists</span><span class="diff-line context">   ansible.builtin.stat:</span><span class="diff-line del">-    path: &quot;{{ authelia_paths_location }}/configuration.yml&quot;</span><span class="diff-line add">+    path: &quot;{{ authelia_role_paths_location }}/configuration.yml&quot;</span><span class="diff-line context">   register: authelia_config_stat</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Load authentication_backend value</span><span class="diff-line context">   ansible.builtin.shell: |</span><span class="diff-line del">-    yyq &#x27;.authentication_backend&#x27; {{ authelia_paths_location }}/configuration.yml</span><span class="diff-line add">+    yyq &#x27;.authentication_backend&#x27; {{ authelia_role_paths_location }}/configuration.yml</span><span class="diff-line context">   register: authentication_backend_key</span><span class="diff-line context">   when: authelia_config_stat.stat.exists and (not &#x27;authelia-reset&#x27; in ansible_run_tags)</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Fail if Configuration was generated with incorrect authentication_backend</span><span class="diff-line context">   ansible.builtin.fail:</span><span class="diff-line context">     msg:</span><span class="diff-line del">-      - &quot;You seem to have changed &#x27;authelia_authentication_backend&#x27; but the old configuration still exists.&quot;</span><span class="diff-line add">+      - &quot;You seem to have changed &#x27;{{ authelia_name }}_authentication_backend&#x27; or &#x27;{{ authelia_name }}_role_authentication_backend&#x27; but the old configuration still exists.&quot;</span><span class="diff-line context">       - &quot;Backup the Authelia opt folder if you want to keep it and then run the &#x27;authelia-reset&#x27; tag.&quot;</span><span class="diff-line context">       - &quot;Port any modifications made to your configurations.yml from the backup that you want to keep.&quot;</span><span class="diff-line context">   when:</span><span class="diff-line context">     - (not &#x27;authelia-reset&#x27; in ansible_run_tags)</span><span class="diff-line context">     - authelia_config_stat.stat.exists</span><span class="diff-line del">-    - (((&#x27;ldap&#x27; in authentication_backend_key.stdout) and (authelia_authentication_backend == &#x27;file&#x27;))</span><span class="diff-line del">-      or ((&#x27;file&#x27; in authentication_backend_key.stdout) and (authelia_authentication_backend == &#x27;ldap&#x27;)))</span><span class="diff-line add">+    - (((&#x27;ldap&#x27; in authentication_backend_key.stdout) and (lookup(&#x27;role_var&#x27;, &#x27;_authentication_backend&#x27;) == &#x27;file&#x27;))</span><span class="diff-line add">+      or ((&#x27;file&#x27; in authentication_backend_key.stdout) and (lookup(&#x27;role_var&#x27;, &#x27;_authentication_backend&#x27;) == &#x27;ldap&#x27;)))</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Authentication Backend Task</span><span class="diff-line del">-  ansible.builtin.import_tasks: &quot;subtasks/auth_backend.yml&quot;</span><span class="diff-line add">+  ansible.builtin.include_tasks: &quot;subtasks/auth_backend.yml&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Remove legacy Redis Docker container</span><span class="diff-line context">   ansible.builtin.include_tasks: &quot;{{ resources_tasks_path }}/docker/remove_docker_container.yml&quot;</span><span class="diff-line hunk">@@ -65,7 +65,7 @@</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Cleanup legacy Redis directory</span><span class="diff-line context">   ansible.builtin.file:</span><span class="diff-line del">-    path: &quot;/opt/authelia_redis&quot;</span><span class="diff-line add">+    path: &quot;{{ server_appdata_path }}/authelia_redis&quot;</span><span class="diff-line context">     state: absent</span><span class="diff-line context"> </span><span class="diff-line context"> - name: &quot;Import Redis Role&quot;</span><span class="diff-line hunk">@@ -77,13 +77,39 @@</span><span class="diff-line context"> - name: Add DNS record</span><span class="diff-line context">   ansible.builtin.include_tasks: &quot;{{ resources_tasks_path }}/dns/tasker.yml&quot;</span><span class="diff-line context">   vars:</span><span class="diff-line del">-    dns_record: &quot;{{ lookup(&#x27;vars&#x27;, role_name + &#x27;_dns_record&#x27;) }}&quot;</span><span class="diff-line del">-    dns_zone: &quot;{{ lookup(&#x27;vars&#x27;, role_name + &#x27;_dns_zone&#x27;) }}&quot;</span><span class="diff-line del">-    dns_proxy: &quot;{{ lookup(&#x27;vars&#x27;, role_name + &#x27;_dns_proxy&#x27;) }}&quot;</span><span class="diff-line add">+    dns_record: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_dns_record&#x27;) }}&quot;</span><span class="diff-line add">+    dns_zone: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_dns_zone&#x27;) }}&quot;</span><span class="diff-line add">+    dns_proxy: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_dns_proxy&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Settings Task</span><span class="diff-line del">-  ansible.builtin.import_tasks: &quot;subtasks/settings.yml&quot;</span><span class="diff-line add">+  ansible.builtin.include_tasks: &quot;subtasks/settings.yml&quot;</span><span class="diff-line context">   when: (authelia_config_stat.stat.exists)</span><span class="diff-line add">+</span><span class="diff-line add">+- name: Logrotate | Create &#x27;authelia_logrotate&#x27; variable</span><span class="diff-line add">+  ansible.builtin.set_fact:</span><span class="diff-line add">+    authelia_logrotate:</span><span class="diff-line add">+      - path: &quot;{{ authelia_name }}&quot;</span><span class="diff-line add">+        content: |</span><span class="diff-line add">+          {{ server_appdata_path }}/{{ authelia_name }}/authelia.log {</span><span class="diff-line add">+              su {{ user.name }} {{ user.name }}</span><span class="diff-line add">+              rotate {{ lookup(&#x27;role_var&#x27;, &#x27;_log_max_backups&#x27;) }}</span><span class="diff-line add">+              size {{ lookup(&#x27;role_var&#x27;, &#x27;_log_max_size&#x27;) }}</span><span class="diff-line add">+              missingok</span><span class="diff-line add">+              notifempty</span><span class="diff-line add">+              postrotate</span><span class="diff-line add">+                docker kill --signal=&quot;HUP&quot; {{ lookup(&#x27;role_var&#x27;, &#x27;_docker_container&#x27;) }}</span><span class="diff-line add">+              endscript</span><span class="diff-line add">+              create 600 {{ user.name }} {{ user.name }}</span><span class="diff-line add">+          }</span><span class="diff-line add">+</span><span class="diff-line add">+- name: Logrotate | Add items to &#x27;/etc/logrotate.d&#x27;</span><span class="diff-line add">+  ansible.builtin.blockinfile:</span><span class="diff-line add">+    path: &quot;/etc/logrotate.d/{{ item.path }}&quot;</span><span class="diff-line add">+    marker: &quot;### SALTBOX MANAGED BLOCK - {mark} ###&quot;</span><span class="diff-line add">+    block: &quot;{{ item.content }}&quot;</span><span class="diff-line add">+    create: true</span><span class="diff-line add">+    mode: &quot;0644&quot;</span><span class="diff-line add">+  loop: &quot;{{ authelia_logrotate }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Create Docker container</span><span class="diff-line context">   ansible.builtin.include_tasks: &quot;{{ resources_tasks_path }}/docker/create_docker_container.yml&quot;</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-106">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/authelia/tasks/subtasks/auth_backend.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -8,9 +8,9 @@</span><span class="diff-line context"> ##########################################################################</span><span class="diff-line context"> ---</span><span class="diff-line context"> - name: Auth | Import File Backend Task</span><span class="diff-line del">-  ansible.builtin.import_tasks: &quot;subtasks/file_backend.yml&quot;</span><span class="diff-line del">-  when: (authelia_authentication_backend == &#x27;file&#x27;)</span><span class="diff-line add">+  ansible.builtin.include_tasks: &quot;subtasks/file_backend.yml&quot;</span><span class="diff-line add">+  when: (lookup(&#x27;role_var&#x27;, &#x27;_authentication_backend&#x27;, role=&#x27;authelia&#x27;) == &#x27;file&#x27;)</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Auth | Import LDAP Backend Task</span><span class="diff-line del">-  ansible.builtin.import_tasks: &quot;subtasks/ldap_backend.yml&quot;</span><span class="diff-line del">-  when: (authelia_authentication_backend == &#x27;ldap&#x27;)</span><span class="diff-line add">+  ansible.builtin.include_tasks: &quot;subtasks/ldap_backend.yml&quot;</span><span class="diff-line add">+  when: (lookup(&#x27;role_var&#x27;, &#x27;_authentication_backend&#x27;, role=&#x27;authelia&#x27;) == &#x27;ldap&#x27;)</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-107">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/authelia/tasks/subtasks/file_backend.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -9,38 +9,39 @@</span><span class="diff-line context"> ---</span><span class="diff-line context"> - name: File | Check if &#x27;users_database.yml&#x27; exists</span><span class="diff-line context">   ansible.builtin.stat:</span><span class="diff-line del">-    path: &quot;{{ authelia_paths_location }}/users_database.yml&quot;</span><span class="diff-line add">+    path: &quot;{{ authelia_role_paths_location }}/users_database.yml&quot;</span><span class="diff-line context">   register: authelia_user_config_stat</span><span class="diff-line context"> </span><span class="diff-line context"> - name: File | Import default &#x27;configuration.yml&#x27;</span><span class="diff-line context">   ansible.builtin.template:</span><span class="diff-line context">     src: configuration.yml.j2</span><span class="diff-line del">-    dest: &quot;{{ authelia_paths_location }}/configuration.yml&quot;</span><span class="diff-line add">+    dest: &quot;{{ authelia_role_paths_location }}/configuration.yml&quot;</span><span class="diff-line context">     owner: &quot;{{ user.name }}&quot;</span><span class="diff-line context">     group: &quot;{{ user.name }}&quot;</span><span class="diff-line context">     mode: &quot;0664&quot;</span><span class="diff-line context">   when: (not authelia_config_stat.stat.exists)</span><span class="diff-line context"> </span><span class="diff-line context"> - name: File | Format &#x27;configuration.yml&#x27;</span><span class="diff-line del">-  ansible.builtin.shell: &quot;yyq -i {{ authelia_paths_location }}/configuration.yml&quot;</span><span class="diff-line add">+  ansible.builtin.shell: &quot;yyq -i {{ authelia_role_paths_location }}/configuration.yml&quot;</span><span class="diff-line context">   when: (not authelia_config_stat.stat.exists)</span><span class="diff-line context"> </span><span class="diff-line context"> - name: File | Generate Password Hash</span><span class="diff-line context">   community.docker.docker_container:</span><span class="diff-line context">     name: authelia-password-hash</span><span class="diff-line del">-    image: &quot;{{ authelia_docker_image }}&quot;</span><span class="diff-line add">+    image: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_image&#x27;) }}&quot;</span><span class="diff-line context">     command: &quot;authelia crypto hash generate --config /config/configuration.yml --password {{ user.pass | quote }}&quot;</span><span class="diff-line del">-    detach: no</span><span class="diff-line add">+    detach: false</span><span class="diff-line context">     volumes:</span><span class="diff-line del">-      - &quot;{{ authelia_paths_location }}:/config&quot;</span><span class="diff-line add">+      - &quot;{{ authelia_role_paths_location }}:/config&quot;</span><span class="diff-line context">     networks:</span><span class="diff-line context">       - name: saltbox</span><span class="diff-line del">-    cleanup: yes</span><span class="diff-line add">+    cleanup: true</span><span class="diff-line context">     state: started</span><span class="diff-line context">     container_default_behavior: compatibility</span><span class="diff-line context">     tls_hostname: localhost</span><span class="diff-line context">     pull: true</span><span class="diff-line context">   register: authelia_password</span><span class="diff-line add">+  no_log: true</span><span class="diff-line context">   when: (not authelia_user_config_stat.stat.exists)</span><span class="diff-line context"> </span><span class="diff-line context"> - name: File | Sanitize Password Hash</span><span class="diff-line hunk">@@ -51,7 +52,7 @@</span><span class="diff-line context"> - name: File | Import default &#x27;users_database.yml&#x27;</span><span class="diff-line context">   ansible.builtin.template:</span><span class="diff-line context">     src: users_database.yml.j2</span><span class="diff-line del">-    dest: &quot;{{ authelia_paths_location }}/users_database.yml&quot;</span><span class="diff-line add">+    dest: &quot;{{ authelia_role_paths_location }}/users_database.yml&quot;</span><span class="diff-line context">     owner: &quot;{{ user.name }}&quot;</span><span class="diff-line context">     group: &quot;{{ user.name }}&quot;</span><span class="diff-line context">     mode: &quot;0664&quot;</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-108">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/authelia/tasks/subtasks/ldap_backend.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -8,26 +8,21 @@</span><span class="diff-line context"> ##########################################################################</span><span class="diff-line context"> ---</span><span class="diff-line context"> - name: LDAP | Get FLD</span><span class="diff-line del">-  ansible.builtin.shell: |</span><span class="diff-line del">-    {{ saltbox_python }} -c &quot;from tld import get_tld; res = get_tld(\&quot;http://{{ authelia_web_domain | default(user.domain) }}\&quot;, as_object=True); print(res.tld)&quot;</span><span class="diff-line del">-  register: authelia_tld</span><span class="diff-line del">-</span><span class="diff-line del">-- name: LDAP | Get FLD</span><span class="diff-line del">-  ansible.builtin.shell: |</span><span class="diff-line del">-    {{ saltbox_python }} -c &quot;from tld import get_tld; res = get_tld(\&quot;http://{{ authelia_web_domain | default(user.domain) }}\&quot;, as_object=True); print(res.domain)&quot;</span><span class="diff-line del">-  register: authelia_domain</span><span class="diff-line add">+  tld_parse:</span><span class="diff-line add">+    url: &quot;http://{{ lookup(&#x27;role_var&#x27;, &#x27;_web_domain&#x27;, role=&#x27;authelia&#x27;) }}&quot;</span><span class="diff-line add">+  register: authelia_tld_parse</span><span class="diff-line context"> </span><span class="diff-line context"> - name: LDAP | Import default &#x27;configuration.yml&#x27;</span><span class="diff-line context">   ansible.builtin.template:</span><span class="diff-line context">     src: configuration.yml.j2</span><span class="diff-line del">-    dest: &quot;{{ authelia_paths_location }}/configuration.yml&quot;</span><span class="diff-line add">+    dest: &quot;{{ authelia_role_paths_location }}/configuration.yml&quot;</span><span class="diff-line context">     owner: &quot;{{ user.name }}&quot;</span><span class="diff-line context">     group: &quot;{{ user.name }}&quot;</span><span class="diff-line context">     mode: &quot;0664&quot;</span><span class="diff-line context">   when: (not authelia_config_stat.stat.exists)</span><span class="diff-line context"> </span><span class="diff-line context"> - name: LDAP | Format &#x27;configuration.yml&#x27;</span><span class="diff-line del">-  ansible.builtin.shell: &quot;yyq -i {{ authelia_paths_location }}/configuration.yml&quot;</span><span class="diff-line add">+  ansible.builtin.shell: &quot;yyq -i {{ authelia_role_paths_location }}/configuration.yml&quot;</span><span class="diff-line context">   when: (not authelia_config_stat.stat.exists)</span><span class="diff-line context"> </span><span class="diff-line context"> - name: LDAP | Import lldap Role</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-109">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/authelia/tasks/subtasks/settings.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -9,24 +9,24 @@</span><span class="diff-line context"> ---</span><span class="diff-line context"> - name: Settings | Load encryption_key value</span><span class="diff-line context">   ansible.builtin.shell: |</span><span class="diff-line del">-    yyq &#x27;.storage.encryption_key&#x27; {{ authelia_paths_location }}/configuration.yml</span><span class="diff-line add">+    yyq &#x27;.storage.encryption_key&#x27; {{ authelia_role_paths_location }}/configuration.yml</span><span class="diff-line context">   register: authelia_encryption_key</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Settings | Add encryption_key to config file</span><span class="diff-line context">   ansible.builtin.shell: |</span><span class="diff-line del">-    yyq -i &#x27;.storage.encryption_key = &quot;{{ lookup(&#x27;password&#x27;, &#x27;/dev/null&#x27;, chars=[&#x27;ascii_letters&#x27;, &#x27;digits&#x27;], length=64) }}&quot;&#x27; {{ authelia_paths_location }}/configuration.yml</span><span class="diff-line add">+    yyq -i &#x27;.storage.encryption_key = &quot;{{ lookup(&#x27;password&#x27;, &#x27;/dev/null&#x27;, chars=[&#x27;ascii_letters&#x27;, &#x27;digits&#x27;], length=64) }}&quot;&#x27; {{ authelia_role_paths_location }}/configuration.yml</span><span class="diff-line context">   become: true</span><span class="diff-line context">   become_user: &quot;{{ user.name }}&quot;</span><span class="diff-line context">   when: authelia_encryption_key.stdout == &quot;null&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Settings | Load session.redis.host value</span><span class="diff-line context">   ansible.builtin.shell: |</span><span class="diff-line del">-    yyq &#x27;.session.redis.host&#x27; {{ authelia_paths_location }}/configuration.yml</span><span class="diff-line add">+    yyq &#x27;.session.redis.host&#x27; {{ authelia_role_paths_location }}/configuration.yml</span><span class="diff-line context">   register: authelia_session_redis_host</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Settings | Change session.redis.host value to &#x27;authelia_redis&#x27;</span><span class="diff-line context">   ansible.builtin.shell: |</span><span class="diff-line del">-    yyq -i &#x27;.session.redis.host = &quot;authelia-redis&quot;&#x27; {{ authelia_paths_location }}/configuration.yml</span><span class="diff-line add">+    yyq -i &#x27;.session.redis.host = &quot;authelia-redis&quot;&#x27; {{ authelia_role_paths_location }}/configuration.yml</span><span class="diff-line context">   become: true</span><span class="diff-line context">   become_user: &quot;{{ user.name }}&quot;</span><span class="diff-line context">   when: (authelia_session_redis_host.stdout == &quot;redis&quot;) or (authelia_session_redis_host.stdout == &quot;authelia_redis&quot;)</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-110">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/authelia/templates/configuration.yml.j2</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -3,91 +3,147 @@</span><span class="diff-line context"> #                   Authelia configuration                    #</span><span class="diff-line context"> ###############################################################</span><span class="diff-line context"> </span><span class="diff-line add">+# Options are light, dark, grey or auto</span><span class="diff-line add">+theme: {{ lookup(&#x27;role_var&#x27;, &#x27;_theme&#x27;, role=&#x27;authelia&#x27;) }}</span><span class="diff-line add">+</span><span class="diff-line add">+default_2fa_method: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_default_2fa_method&#x27;, role=&#x27;authelia&#x27;) }}&quot;</span><span class="diff-line add">+</span><span class="diff-line add">+server:</span><span class="diff-line add">+  address: {{ lookup(&#x27;role_var&#x27;, &#x27;_server_address&#x27;, role=&#x27;authelia&#x27;) }}</span><span class="diff-line add">+{% if lookup(&#x27;role_var&#x27;, &#x27;_server_asset_path&#x27;, role=&#x27;authelia&#x27;) | length &gt; 0 %}</span><span class="diff-line add">+  asset_path: {{ lookup(&#x27;role_var&#x27;, &#x27;_server_asset_path&#x27;, role=&#x27;authelia&#x27;) }}</span><span class="diff-line add">+{% endif %}</span><span class="diff-line add">+  disable_healthcheck: {{ lookup(&#x27;role_var&#x27;, &#x27;_server_disable_healthcheck&#x27;, role=&#x27;authelia&#x27;) | bool | lower }}</span><span class="diff-line add">+  buffers:</span><span class="diff-line add">+    read: {{ lookup(&#x27;role_var&#x27;, &#x27;_server_buffers_read&#x27;, role=&#x27;authelia&#x27;) }}</span><span class="diff-line add">+    write: {{ lookup(&#x27;role_var&#x27;, &#x27;_server_buffers_write&#x27;, role=&#x27;authelia&#x27;) }}</span><span class="diff-line add">+  timeouts:</span><span class="diff-line add">+    read: {{ lookup(&#x27;role_var&#x27;, &#x27;_server_timeouts_read&#x27;, role=&#x27;authelia&#x27;) }}</span><span class="diff-line add">+    write: {{ lookup(&#x27;role_var&#x27;, &#x27;_server_timeouts_write&#x27;, role=&#x27;authelia&#x27;) }}</span><span class="diff-line add">+    idle: {{ lookup(&#x27;role_var&#x27;, &#x27;_server_timeouts_idle&#x27;, role=&#x27;authelia&#x27;) }}</span><span class="diff-line add">+  endpoints:</span><span class="diff-line add">+    enable_pprof: {{ lookup(&#x27;role_var&#x27;, &#x27;_server_endpoints_enable_pprof&#x27;, role=&#x27;authelia&#x27;) }}</span><span class="diff-line add">+    enable_expvars: {{ lookup(&#x27;role_var&#x27;, &#x27;_server_endpoints_enable_expvars&#x27;, role=&#x27;authelia&#x27;) }}</span><span class="diff-line add">+  headers:</span><span class="diff-line add">+    csp_template: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_server_headers_csp_template&#x27;, role=&#x27;authelia&#x27;) }}&quot;</span><span class="diff-line add">+</span><span class="diff-line add">+log:</span><span class="diff-line add">+  level: {{ lookup(&#x27;role_var&#x27;, &#x27;_log_level&#x27;, role=&#x27;authelia&#x27;) }}</span><span class="diff-line add">+  format: {{ lookup(&#x27;role_var&#x27;, &#x27;_log_format&#x27;, role=&#x27;authelia&#x27;) }}</span><span class="diff-line add">+  file_path: {{ lookup(&#x27;role_var&#x27;, &#x27;_log_file_path&#x27;, role=&#x27;authelia&#x27;) }}</span><span class="diff-line add">+  keep_stdout: {{ lookup(&#x27;role_var&#x27;, &#x27;_log_keep_stdout&#x27;, role=&#x27;authelia&#x27;) | bool | lower }}</span><span class="diff-line add">+</span><span class="diff-line add">+telemetry:</span><span class="diff-line add">+  metrics:</span><span class="diff-line add">+    enabled: {{ lookup(&#x27;role_var&#x27;, &#x27;_telemetry_metrics_enabled&#x27;, role=&#x27;authelia&#x27;) | bool | lower }}</span><span class="diff-line add">+{% if lookup(&#x27;role_var&#x27;, &#x27;_telemetry_metrics_enabled&#x27;, role=&#x27;authelia&#x27;) | bool %}</span><span class="diff-line add">+    address: {{ lookup(&#x27;role_var&#x27;, &#x27;_telemetry_metrics_address&#x27;, role=&#x27;authelia&#x27;) }}</span><span class="diff-line add">+    buffers:</span><span class="diff-line add">+      read: {{ lookup(&#x27;role_var&#x27;, &#x27;_telemetry_metrics_buffers_read&#x27;, role=&#x27;authelia&#x27;) }}</span><span class="diff-line add">+      write: {{ lookup(&#x27;role_var&#x27;, &#x27;_telemetry_metrics_buffers_write&#x27;, role=&#x27;authelia&#x27;) }}</span><span class="diff-line add">+    timeouts:</span><span class="diff-line add">+      read: {{ lookup(&#x27;role_var&#x27;, &#x27;_telemetry_metrics_timeouts_read&#x27;, role=&#x27;authelia&#x27;) }}</span><span class="diff-line add">+      write: {{ lookup(&#x27;role_var&#x27;, &#x27;_telemetry_metrics_timeouts_write&#x27;, role=&#x27;authelia&#x27;) }}</span><span class="diff-line add">+      idle: {{ lookup(&#x27;role_var&#x27;, &#x27;_telemetry_metrics_timeouts_idle&#x27;, role=&#x27;authelia&#x27;) }}</span><span class="diff-line add">+{% endif %}</span><span class="diff-line add">+</span><span class="diff-line add">+totp:</span><span class="diff-line add">+  disable: {{ lookup(&#x27;role_var&#x27;, &#x27;_totp_disable&#x27;, role=&#x27;authelia&#x27;) | bool | lower }}</span><span class="diff-line add">+  issuer: {{ lookup(&#x27;role_var&#x27;, &#x27;_totp_issuer&#x27;, role=&#x27;authelia&#x27;) }}</span><span class="diff-line add">+  algorithm: {{ lookup(&#x27;role_var&#x27;, &#x27;_totp_algorithm&#x27;, role=&#x27;authelia&#x27;) }}</span><span class="diff-line add">+  digits: {{ lookup(&#x27;role_var&#x27;, &#x27;_totp_digits&#x27;, role=&#x27;authelia&#x27;) }}</span><span class="diff-line add">+  period: {{ lookup(&#x27;role_var&#x27;, &#x27;_totp_period&#x27;, role=&#x27;authelia&#x27;) }}</span><span class="diff-line add">+  skew: {{ lookup(&#x27;role_var&#x27;, &#x27;_totp_skew&#x27;, role=&#x27;authelia&#x27;) }}</span><span class="diff-line add">+  secret_size: {{ lookup(&#x27;role_var&#x27;, &#x27;_totp_secret_size&#x27;, role=&#x27;authelia&#x27;) }}</span><span class="diff-line add">+  allowed_algorithms: {{ lookup(&#x27;role_var&#x27;, &#x27;_totp_allowed_algorithms&#x27;, role=&#x27;authelia&#x27;) }}</span><span class="diff-line add">+  allowed_digits: {{ lookup(&#x27;role_var&#x27;, &#x27;_totp_allowed_digits&#x27;, role=&#x27;authelia&#x27;) }}</span><span class="diff-line add">+  allowed_periods: {{ lookup(&#x27;role_var&#x27;, &#x27;_totp_allowed_periods&#x27;, role=&#x27;authelia&#x27;) }}</span><span class="diff-line add">+  disable_reuse_security_policy: {{ lookup(&#x27;role_var&#x27;, &#x27;_totp_disable_reuse_security_policy&#x27;, role=&#x27;authelia&#x27;) | bool | lower }}</span><span class="diff-line add">+</span><span class="diff-line add">+webauthn:</span><span class="diff-line add">+  disable: {{ lookup(&#x27;role_var&#x27;, &#x27;_webauthn_disable&#x27;, role=&#x27;authelia&#x27;) | bool | lower }}</span><span class="diff-line add">+  enable_passkey_login: {{ lookup(&#x27;role_var&#x27;, &#x27;_webauthn_enable_passkey_login&#x27;, role=&#x27;authelia&#x27;) | bool | lower }}</span><span class="diff-line add">+  display_name: {{ lookup(&#x27;role_var&#x27;, &#x27;_webauthn_display_name&#x27;, role=&#x27;authelia&#x27;) }}</span><span class="diff-line add">+  attestation_conveyance_preference: {{ lookup(&#x27;role_var&#x27;, &#x27;_webauthn_attestation_conveyance_preference&#x27;, role=&#x27;authelia&#x27;) }}</span><span class="diff-line add">+  timeout: {{ lookup(&#x27;role_var&#x27;, &#x27;_webauthn_timeout&#x27;, role=&#x27;authelia&#x27;) }}</span><span class="diff-line add">+  filtering:</span><span class="diff-line add">+    prohibit_backup_eligibility: {{ lookup(&#x27;role_var&#x27;, &#x27;_webauthn_filtering_prohibit_backup_eligibility&#x27;, role=&#x27;authelia&#x27;) | bool | lower }}</span><span class="diff-line add">+{% if lookup(&#x27;role_var&#x27;, &#x27;_webauthn_filtering_permitted_aaguids&#x27;, role=&#x27;authelia&#x27;) | length &gt; 0 %}</span><span class="diff-line add">+    permitted_aaguids: {{ lookup(&#x27;role_var&#x27;, &#x27;_webauthn_filtering_permitted_aaguids&#x27;, role=&#x27;authelia&#x27;) }}</span><span class="diff-line add">+{% endif %}</span><span class="diff-line add">+{% if lookup(&#x27;role_var&#x27;, &#x27;_webauthn_filtering_prohibited_aaguids&#x27;, role=&#x27;authelia&#x27;) | length &gt; 0 %}</span><span class="diff-line add">+    prohibited_aaguids: {{ lookup(&#x27;role_var&#x27;, &#x27;_webauthn_filtering_prohibited_aaguids&#x27;, role=&#x27;authelia&#x27;) }}</span><span class="diff-line add">+{% endif %}</span><span class="diff-line add">+  selection_criteria:</span><span class="diff-line add">+    attachment: {{ lookup(&#x27;role_var&#x27;, &#x27;_webauthn_selection_criteria_attachment&#x27;, role=&#x27;authelia&#x27;) }}</span><span class="diff-line add">+    discoverability: {{ lookup(&#x27;role_var&#x27;, &#x27;_webauthn_selection_criteria_discoverability&#x27;, role=&#x27;authelia&#x27;) }}</span><span class="diff-line add">+    user_verification: {{ lookup(&#x27;role_var&#x27;, &#x27;_webauthn_selection_criteria_user_verification&#x27;, role=&#x27;authelia&#x27;) }}</span><span class="diff-line add">+  metadata:</span><span class="diff-line add">+    enabled: {{ lookup(&#x27;role_var&#x27;, &#x27;_webauthn_metadata_enabled&#x27;, role=&#x27;authelia&#x27;) | bool | lower }}</span><span class="diff-line add">+{% if lookup(&#x27;role_var&#x27;, &#x27;_webauthn_metadata_enabled&#x27;, role=&#x27;authelia&#x27;) | bool %}</span><span class="diff-line add">+    cache_policy: {{ lookup(&#x27;role_var&#x27;, &#x27;_webauthn_metadata_cache_policy&#x27;, role=&#x27;authelia&#x27;) }}</span><span class="diff-line add">+    validate_trust_anchor: {{ lookup(&#x27;role_var&#x27;, &#x27;_webauthn_metadata_validate_trust_anchor&#x27;, role=&#x27;authelia&#x27;) }}</span><span class="diff-line add">+    validate_entry: {{ lookup(&#x27;role_var&#x27;, &#x27;_webauthn_metadata_validate_entry&#x27;, role=&#x27;authelia&#x27;) }}</span><span class="diff-line add">+    validate_entry_permit_zero_aaguid: {{ lookup(&#x27;role_var&#x27;, &#x27;_webauthn_metadata_validate_entry_permit_zero_aaguid&#x27;, role=&#x27;authelia&#x27;) }}</span><span class="diff-line add">+    validate_status: {{ lookup(&#x27;role_var&#x27;, &#x27;_webauthn_metadata_validate_status&#x27;, role=&#x27;authelia&#x27;) }}</span><span class="diff-line add">+{% if lookup(&#x27;role_var&#x27;, &#x27;_webauthn_metadata_validate_status_permitted&#x27;, role=&#x27;authelia&#x27;) | length &gt; 0 %}</span><span class="diff-line add">+    validate_status_permitted: {{ lookup(&#x27;role_var&#x27;, &#x27;_webauthn_metadata_validate_status_permitted&#x27;, role=&#x27;authelia&#x27;) }}</span><span class="diff-line add">+{% endif %}</span><span class="diff-line add">+{% if lookup(&#x27;role_var&#x27;, &#x27;_webauthn_metadata_validate_status_prohibited&#x27;, role=&#x27;authelia&#x27;) | length &gt; 0 %}</span><span class="diff-line add">+    validate_status_prohibited: {{ lookup(&#x27;role_var&#x27;, &#x27;_webauthn_metadata_validate_status_prohibited&#x27;, role=&#x27;authelia&#x27;) }}</span><span class="diff-line add">+{% endif %}</span><span class="diff-line add">+{% endif %}</span><span class="diff-line add">+</span><span class="diff-line add">+{% if lookup(&#x27;role_var&#x27;, &#x27;_duo_enabled&#x27;, role=&#x27;authelia&#x27;) | bool %}</span><span class="diff-line add">+duo_api:</span><span class="diff-line add">+  disable: false</span><span class="diff-line add">+  hostname: {{ lookup(&#x27;role_var&#x27;, &#x27;_duo_hostname&#x27;, role=&#x27;authelia&#x27;) }}</span><span class="diff-line add">+  integration_key: {{ lookup(&#x27;role_var&#x27;, &#x27;_duo_integration_key&#x27;, role=&#x27;authelia&#x27;) }}</span><span class="diff-line add">+  secret_key: {{ lookup(&#x27;role_var&#x27;, &#x27;_duo_secret_key&#x27;, role=&#x27;authelia&#x27;) }}</span><span class="diff-line add">+  enable_self_enrollment: {{ lookup(&#x27;role_var&#x27;, &#x27;_duo_self_enrollment&#x27;, role=&#x27;authelia&#x27;) | bool | lower }}</span><span class="diff-line add">+{% endif %}</span><span class="diff-line add">+</span><span class="diff-line context"> identity_validation:</span><span class="diff-line context">   reset_password:</span><span class="diff-line del">-    jwt_secret: {{ authelia_jwt_secret }}</span><span class="diff-line del">-</span><span class="diff-line del">-# Options are light, dark, grey or auto</span><span class="diff-line del">-theme: {{ authelia_theme }}</span><span class="diff-line del">-</span><span class="diff-line del">-{% if authelia_default_redirection_url | length &gt; 0 %}</span><span class="diff-line del">-default_redirection_url: {{ authelia_default_redirection_url }}</span><span class="diff-line del">-</span><span class="diff-line del">-{% endif %}</span><span class="diff-line del">-default_2fa_method: &quot;{{ authelia_default_2fa_method }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-server:</span><span class="diff-line del">-  address: {{ authelia_server_address }}</span><span class="diff-line del">-  buffers:</span><span class="diff-line del">-    read: {{ authelia_server_buffers_read }}</span><span class="diff-line del">-    write: {{ authelia_server_buffers_write }}</span><span class="diff-line del">-  disable_healthcheck: {{ authelia_server_disable_healthcheck }}</span><span class="diff-line del">-  headers:</span><span class="diff-line del">-    csp_template: &quot;{{ authelia_server_headers_csp_template }}&quot;</span><span class="diff-line del">-  endpoints:</span><span class="diff-line del">-    enable_pprof: {{ authelia_server_enable_pprof }}</span><span class="diff-line del">-    enable_expvars: {{ authelia_server_enable_expvars }}</span><span class="diff-line del">-</span><span class="diff-line del">-log:</span><span class="diff-line del">-  level: {{ authelia_log_level }}</span><span class="diff-line del">-  format: {{ authelia_log_format }}</span><span class="diff-line del">-  file_path: {{ authelia_log_file_path }}</span><span class="diff-line del">-  keep_stdout: {{ authelia_log_keep_stdout }}</span><span class="diff-line del">-</span><span class="diff-line del">-totp:</span><span class="diff-line del">-  issuer: {{ authelia_totp_issuer }}</span><span class="diff-line del">-  period: {{ authelia_totp_period }}</span><span class="diff-line del">-  skew: {{ authelia_totp_skew }}</span><span class="diff-line del">-  digits: {{ authelia_totp_digits }}</span><span class="diff-line del">-  secret_size: {{ authelia_totp_secret_size }}</span><span class="diff-line del">-</span><span class="diff-line del">-{% if authelia_duo_enabled | bool %}</span><span class="diff-line del">-duo_api:</span><span class="diff-line del">-  disable: false</span><span class="diff-line del">-  hostname: {{ authelia_duo_hostname }}</span><span class="diff-line del">-  integration_key: {{ authelia_duo_integration_key }}</span><span class="diff-line del">-  secret_key: {{ authelia_duo_secret_key }}</span><span class="diff-line del">-  enable_self_enrollment: {{ authelia_duo_self_enrollment }}</span><span class="diff-line del">-{% else %}</span><span class="diff-line del">-#</span><span class="diff-line del">-# If you want to use Duo Push notifications</span><span class="diff-line del">-#</span><span class="diff-line del">-# duo_api:</span><span class="diff-line del">-#   hostname: api-123456789.example.com</span><span class="diff-line del">-#   integration_key: ABCDEF</span><span class="diff-line del">-#   secret_key: 1234567890abcdefghifjkl</span><span class="diff-line del">-#</span><span class="diff-line del">-# Read more at https://www.authelia.com/docs/configuration/duo-push-notifications.html</span><span class="diff-line del">-#</span><span class="diff-line del">-{% endif %}</span><span class="diff-line del">-</span><span class="diff-line del">-webauthn:</span><span class="diff-line del">-  disable: {{ authelia_webauthn_disable }}</span><span class="diff-line del">-  display_name: {{ authelia_webauthn_display_name }}</span><span class="diff-line del">-  attestation_conveyance_preference: {{ authelia_webauthn_attestation_conveyance_preference }}</span><span class="diff-line del">-  user_verification: {{ authelia_webauthn_user_verification }}</span><span class="diff-line del">-  timeout: {{ authelia_webauthn_timeout }}</span><span class="diff-line add">+    jwt_lifespan: {{ lookup(&#x27;role_var&#x27;, &#x27;_identity_validation_reset_password_jwt_lifespan&#x27;, role=&#x27;authelia&#x27;) }}</span><span class="diff-line add">+    jwt_algorithm: {{ lookup(&#x27;role_var&#x27;, &#x27;_identity_validation_reset_password_jwt_algorithm&#x27;, role=&#x27;authelia&#x27;) }}</span><span class="diff-line add">+    jwt_secret: {{ lookup(&#x27;role_var&#x27;, &#x27;_jwt_secret&#x27;, role=&#x27;authelia&#x27;) }}</span><span class="diff-line add">+  elevated_session:</span><span class="diff-line add">+    code_lifespan: {{ lookup(&#x27;role_var&#x27;, &#x27;_identity_validation_elevated_session_code_lifespan&#x27;, role=&#x27;authelia&#x27;) }}</span><span class="diff-line add">+    elevation_lifespan: {{ lookup(&#x27;role_var&#x27;, &#x27;_identity_validation_elevated_session_elevation_lifespan&#x27;, role=&#x27;authelia&#x27;) }}</span><span class="diff-line add">+    characters: {{ lookup(&#x27;role_var&#x27;, &#x27;_identity_validation_elevated_session_characters&#x27;, role=&#x27;authelia&#x27;) }}</span><span class="diff-line add">+    require_second_factor: {{ lookup(&#x27;role_var&#x27;, &#x27;_identity_validation_elevated_session_require_second_factor&#x27;, role=&#x27;authelia&#x27;) | bool | lower }}</span><span class="diff-line add">+    skip_second_factor: {{ lookup(&#x27;role_var&#x27;, &#x27;_identity_validation_elevated_session_skip_second_factor&#x27;, role=&#x27;authelia&#x27;) | bool | lower }}</span><span class="diff-line add">+</span><span class="diff-line add">+ntp:</span><span class="diff-line add">+  address: {{ lookup(&#x27;role_var&#x27;, &#x27;_ntp_address&#x27;, role=&#x27;authelia&#x27;) }}</span><span class="diff-line add">+  version: {{ lookup(&#x27;role_var&#x27;, &#x27;_ntp_version&#x27;, role=&#x27;authelia&#x27;) }}</span><span class="diff-line add">+  max_desync: {{ lookup(&#x27;role_var&#x27;, &#x27;_ntp_max_desync&#x27;, role=&#x27;authelia&#x27;) }}</span><span class="diff-line add">+  disable_startup_check: {{ lookup(&#x27;role_var&#x27;, &#x27;_ntp_disable_startup_check&#x27;, role=&#x27;authelia&#x27;) | bool | lower }}</span><span class="diff-line add">+  disable_failure: {{ lookup(&#x27;role_var&#x27;, &#x27;_ntp_disable_failure&#x27;, role=&#x27;authelia&#x27;) | bool | lower }}</span><span class="diff-line context"> </span><span class="diff-line context"> authentication_backend:</span><span class="diff-line add">+  password_change:</span><span class="diff-line add">+    disable: {{ lookup(&#x27;role_var&#x27;, &#x27;_authentication_backend_password_change_disable&#x27;, role=&#x27;authelia&#x27;) | bool | lower }}</span><span class="diff-line context">   password_reset:</span><span class="diff-line del">-    disable: {{ authelia_authentication_backend_password_reset_disable }}</span><span class="diff-line del">-    custom_url: &quot;{{ authelia_authentication_backend_password_reset_custom_url }}&quot;</span><span class="diff-line del">-  refresh_interval: {{ authelia_authentication_backend_refresh_interval }}</span><span class="diff-line del">-{% if authelia_authentication_backend == &#x27;file&#x27; %}</span><span class="diff-line add">+    disable: {{ lookup(&#x27;role_var&#x27;, &#x27;_authentication_backend_password_reset_disable&#x27;, role=&#x27;authelia&#x27;) | bool | lower }}</span><span class="diff-line add">+    custom_url: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_authentication_backend_password_reset_custom_url&#x27;, role=&#x27;authelia&#x27;) }}&quot;</span><span class="diff-line add">+  refresh_interval: {{ lookup(&#x27;role_var&#x27;, &#x27;_authentication_backend_refresh_interval&#x27;, role=&#x27;authelia&#x27;) }}</span><span class="diff-line add">+{% if lookup(&#x27;role_var&#x27;, &#x27;_authentication_backend&#x27;, role=&#x27;authelia&#x27;) == &#x27;file&#x27; %}</span><span class="diff-line context">   file:</span><span class="diff-line del">-    path: {{ authelia_authentication_backend_file_path }}</span><span class="diff-line del">-    watch: {{ authelia_authentication_backend_file_watch }}</span><span class="diff-line add">+    path: {{ lookup(&#x27;role_var&#x27;, &#x27;_authentication_backend_file_path&#x27;, role=&#x27;authelia&#x27;) }}</span><span class="diff-line add">+    watch: {{ lookup(&#x27;role_var&#x27;, &#x27;_authentication_backend_file_watch&#x27;, role=&#x27;authelia&#x27;) | bool | lower }}</span><span class="diff-line context">     password:</span><span class="diff-line del">-      algorithm: {{ authelia_authentication_backend_file_password_algorithm }}</span><span class="diff-line add">+      algorithm: {{ lookup(&#x27;role_var&#x27;, &#x27;_authentication_backend_file_password_algorithm&#x27;, role=&#x27;authelia&#x27;) }}</span><span class="diff-line context">       argon2:</span><span class="diff-line del">-        variant: {{ authelia_authentication_backend_file_password_argon2_variant }}</span><span class="diff-line del">-        iterations: {{ authelia_authentication_backend_file_password_argon2_iterations }}</span><span class="diff-line del">-        memory: {{ authelia_authentication_backend_file_password_argon2_memory }}</span><span class="diff-line del">-        parallelism: {{ authelia_authentication_backend_file_password_argon2_parallelism }}</span><span class="diff-line del">-        key_length: {{ authelia_authentication_backend_file_password_argon2_key_length }}</span><span class="diff-line del">-        salt_length: {{ authelia_authentication_backend_file_password_argon2_salt_length }}</span><span class="diff-line del">-{% endif %}</span><span class="diff-line del">-{% if authelia_authentication_backend == &#x27;ldap&#x27; %}</span><span class="diff-line add">+        variant: {{ lookup(&#x27;role_var&#x27;, &#x27;_authentication_backend_file_password_argon2_variant&#x27;, role=&#x27;authelia&#x27;) }}</span><span class="diff-line add">+        iterations: {{ lookup(&#x27;role_var&#x27;, &#x27;_authentication_backend_file_password_argon2_iterations&#x27;, role=&#x27;authelia&#x27;) }}</span><span class="diff-line add">+        memory: {{ lookup(&#x27;role_var&#x27;, &#x27;_authentication_backend_file_password_argon2_memory&#x27;, role=&#x27;authelia&#x27;) }}</span><span class="diff-line add">+        parallelism: {{ lookup(&#x27;role_var&#x27;, &#x27;_authentication_backend_file_password_argon2_parallelism&#x27;, role=&#x27;authelia&#x27;) }}</span><span class="diff-line add">+        key_length: {{ lookup(&#x27;role_var&#x27;, &#x27;_authentication_backend_file_password_argon2_key_length&#x27;, role=&#x27;authelia&#x27;) }}</span><span class="diff-line add">+        salt_length: {{ lookup(&#x27;role_var&#x27;, &#x27;_authentication_backend_file_password_argon2_salt_length&#x27;, role=&#x27;authelia&#x27;) }}</span><span class="diff-line add">+{% endif %}</span><span class="diff-line add">+{% if lookup(&#x27;role_var&#x27;, &#x27;_authentication_backend&#x27;, role=&#x27;authelia&#x27;) == &#x27;ldap&#x27; %}</span><span class="diff-line context">   ldap:</span><span class="diff-line context">     implementation: custom</span><span class="diff-line context">     address: ldap://lldap:3890</span><span class="diff-line hunk">@@ -95,44 +151,39 @@</span><span class="diff-line context">     tls:</span><span class="diff-line context">       skip_verify: true</span><span class="diff-line context">       minimum_version: TLS1.2</span><span class="diff-line del">-    base_dn: dc={{ authelia_domain.stdout }},dc={{ authelia_tld.stdout }}</span><span class="diff-line add">+    base_dn: dc={{ authelia_tld_parse.domain }},dc={{ authelia_tld_parse.tld }}</span><span class="diff-line context">     additional_users_dn: ou=people</span><span class="diff-line context">     users_filter: &quot;(&amp;({username_attribute}={input})(objectClass=person))&quot;</span><span class="diff-line context">     additional_groups_dn: ou=groups</span><span class="diff-line context">     groups_filter: &quot;(member={dn})&quot;</span><span class="diff-line del">-    </span><span class="diff-line del">-    user: uid={{ user.name }},ou=people,dc={{ authelia_domain.stdout }},dc={{ authelia_tld.stdout }}</span><span class="diff-line add">+    user: uid={{ user.name }},ou=people,dc={{ authelia_tld_parse.domain }},dc={{ authelia_tld_parse.tld }}</span><span class="diff-line context">     password: {{ user.pass }}</span><span class="diff-line context">     attributes:</span><span class="diff-line context">       group_name: cn</span><span class="diff-line context">       display_name: displayName</span><span class="diff-line context">       mail: mail</span><span class="diff-line del">-</span><span class="diff-line context"> {% endif %}</span><span class="diff-line context"> </span><span class="diff-line context"> password_policy:</span><span class="diff-line context">   standard:</span><span class="diff-line del">-    enabled: {{ authelia_password_policy_standard_enabled }}</span><span class="diff-line del">-    min_length: {{ authelia_password_policy_standard_min_length }}</span><span class="diff-line del">-    max_length: {{ authelia_password_policy_standard_max_length }}</span><span class="diff-line del">-    require_uppercase: {{ authelia_password_policy_standard_require_uppercase }}</span><span class="diff-line del">-    require_lowercase: {{ authelia_password_policy_standard_require_lowercase }}</span><span class="diff-line del">-    require_number: {{ authelia_password_policy_standard_require_number }}</span><span class="diff-line del">-    require_special: {{ authelia_password_policy_standard_require_special }}</span><span class="diff-line add">+    enabled: {{ lookup(&#x27;role_var&#x27;, &#x27;_password_policy_standard_enabled&#x27;, role=&#x27;authelia&#x27;) | bool | lower }}</span><span class="diff-line add">+    min_length: {{ lookup(&#x27;role_var&#x27;, &#x27;_password_policy_standard_min_length&#x27;, role=&#x27;authelia&#x27;) }}</span><span class="diff-line add">+    max_length: {{ lookup(&#x27;role_var&#x27;, &#x27;_password_policy_standard_max_length&#x27;, role=&#x27;authelia&#x27;) }}</span><span class="diff-line add">+    require_uppercase: {{ lookup(&#x27;role_var&#x27;, &#x27;_password_policy_standard_require_uppercase&#x27;, role=&#x27;authelia&#x27;) }}</span><span class="diff-line add">+    require_lowercase: {{ lookup(&#x27;role_var&#x27;, &#x27;_password_policy_standard_require_lowercase&#x27;, role=&#x27;authelia&#x27;) }}</span><span class="diff-line add">+    require_number: {{ lookup(&#x27;role_var&#x27;, &#x27;_password_policy_standard_require_number&#x27;, role=&#x27;authelia&#x27;) }}</span><span class="diff-line add">+    require_special: {{ lookup(&#x27;role_var&#x27;, &#x27;_password_policy_standard_require_special&#x27;, role=&#x27;authelia&#x27;) }}</span><span class="diff-line context">   zxcvbn:</span><span class="diff-line del">-    enabled: {{ authelia_password_policy_zxcvbn_enabled }}</span><span class="diff-line del">-    min_score: {{ authelia_password_policy_zxcvbn_min_score }}</span><span class="diff-line del">-</span><span class="diff-line del">-#</span><span class="diff-line del">-# Read more at https://www.authelia.com/docs/configuration/access-control.html</span><span class="diff-line del">-#</span><span class="diff-line add">+    enabled: {{ lookup(&#x27;role_var&#x27;, &#x27;_password_policy_zxcvbn_enabled&#x27;, role=&#x27;authelia&#x27;) | bool | lower }}</span><span class="diff-line add">+    min_score: {{ lookup(&#x27;role_var&#x27;, &#x27;_password_policy_zxcvbn_min_score&#x27;, role=&#x27;authelia&#x27;) }}</span><span class="diff-line add">+</span><span class="diff-line context"> access_control:</span><span class="diff-line del">-  default_policy: {{ authelia_access_control_default_policy }}</span><span class="diff-line add">+  default_policy: {{ lookup(&#x27;role_var&#x27;, &#x27;_access_control_default_policy&#x27;, role=&#x27;authelia&#x27;) }}</span><span class="diff-line context">   rules:</span><span class="diff-line del">-    {{ (authelia_access_control_whitelist_rules_lookup + authelia_access_control_rules) | to_nice_yaml | indent(4) }}</span><span class="diff-line add">+    {{ (lookup(&#x27;role_var&#x27;, &#x27;_access_control_whitelist_rules_lookup&#x27;, role=&#x27;authelia&#x27;) + lookup(&#x27;role_var&#x27;, &#x27;_access_control_rules&#x27;, role=&#x27;authelia&#x27;)) | to_nice_yaml | indent(4) }}</span><span class="diff-line context"> </span><span class="diff-line context"> session:</span><span class="diff-line del">-  name: {{ authelia_web_subdomain + &#x27;.&#x27; + authelia_web_domain | lower }}</span><span class="diff-line add">+  name: {{ (lookup(&#x27;role_var&#x27;, &#x27;_web_subdomain&#x27;, role=&#x27;authelia&#x27;) + &#x27;.&#x27; + lookup(&#x27;role_var&#x27;, &#x27;_web_domain&#x27;, role=&#x27;authelia&#x27;)) | lower }}</span><span class="diff-line context">   secret: {{ lookup(&#x27;password&#x27;, &#x27;/dev/null&#x27;, chars=[&#x27;ascii_letters&#x27;, &#x27;digits&#x27;], length=32) }}</span><span class="diff-line context">   expiration: 1h</span><span class="diff-line context">   inactivity: 5m</span><span class="diff-line hunk">@@ -142,13 +193,16 @@</span><span class="diff-line context">     host: authelia-redis</span><span class="diff-line context">     port: 6379</span><span class="diff-line context">   cookies:</span><span class="diff-line del">-    - domain: {{ authelia_web_domain | lower }}</span><span class="diff-line del">-      authelia_url: {{ authelia_web_url | lower }}</span><span class="diff-line del">-      name: authelia_{{ authelia_web_domain | lower }}</span><span class="diff-line add">+    - domain: {{ lookup(&#x27;role_var&#x27;, &#x27;_web_domain&#x27;, role=&#x27;authelia&#x27;) | lower }}</span><span class="diff-line add">+      authelia_url: {{ lookup(&#x27;role_var&#x27;, &#x27;_web_url&#x27;, role=&#x27;authelia&#x27;) | lower }}</span><span class="diff-line add">+      name: authelia_{{ lookup(&#x27;role_var&#x27;, &#x27;_web_domain&#x27;, role=&#x27;authelia&#x27;) | lower }}</span><span class="diff-line context">       same_site: lax</span><span class="diff-line context">       inactivity: 5m</span><span class="diff-line context">       expiration: 1h</span><span class="diff-line context">       remember_me: 1M</span><span class="diff-line add">+{% if lookup(&#x27;role_var&#x27;, &#x27;_default_redirection_url&#x27;, role=&#x27;authelia&#x27;) | length &gt; 0 %}</span><span class="diff-line add">+      default_redirection_url: {{ lookup(&#x27;role_var&#x27;, &#x27;_default_redirection_url&#x27;, role=&#x27;authelia&#x27;) }}</span><span class="diff-line add">+{% endif %}</span><span class="diff-line context"> </span><span class="diff-line context"> regulation:</span><span class="diff-line context">   max_retries: 3</span><span class="diff-line hunk">@@ -160,73 +214,29 @@</span><span class="diff-line context">   local:</span><span class="diff-line context">     path: /config/db.sqlite3</span><span class="diff-line context"> </span><span class="diff-line del">-ntp:</span><span class="diff-line del">-  address: &quot;{{ authelia_ntp_address }}&quot;</span><span class="diff-line del">-  version: {{ authelia_ntp_version }}</span><span class="diff-line del">-  max_desync: {{ authelia_ntp_max_desync }}</span><span class="diff-line del">-  disable_startup_check: {{ authelia_ntp_disable_startup_check }}</span><span class="diff-line del">-  disable_failure: {{ authelia_ntp_disable_failure }}</span><span class="diff-line del">-</span><span class="diff-line context"> notifier:</span><span class="diff-line del">-  disable_startup_check: {{ authelia_notifier_disable_startup_check }}</span><span class="diff-line del">-{% if authelia_notifier == &#x27;filesystem&#x27; %}</span><span class="diff-line add">+  disable_startup_check: {{ lookup(&#x27;role_var&#x27;, &#x27;_notifier_disable_startup_check&#x27;, role=&#x27;authelia&#x27;) | bool | lower }}</span><span class="diff-line add">+{% if lookup(&#x27;role_var&#x27;, &#x27;_notifier&#x27;, role=&#x27;authelia&#x27;) == &#x27;filesystem&#x27; %}</span><span class="diff-line context">   filesystem:</span><span class="diff-line context">     filename: /config/notification.txt</span><span class="diff-line context"> {% endif %}</span><span class="diff-line del">-{% if authelia_notifier == &#x27;smtp&#x27; %}</span><span class="diff-line add">+{% if lookup(&#x27;role_var&#x27;, &#x27;_notifier&#x27;, role=&#x27;authelia&#x27;) == &#x27;smtp&#x27; %}</span><span class="diff-line context">   smtp:</span><span class="diff-line del">-    host: {{ authelia_notifier_smtp_host }}</span><span class="diff-line del">-    port: {{ authelia_notifier_smtp_port }}</span><span class="diff-line del">-    timeout: {{ (authelia_notifier_smtp_timeout) | default(omit) }}</span><span class="diff-line del">-    username: {{ (authelia_notifier_smtp_username) | default(omit) }}</span><span class="diff-line del">-    password: {{ (authelia_notifier_smtp_password) | default(omit) }}</span><span class="diff-line del">-    sender: {{ authelia_notifier_smtp_sender }}</span><span class="diff-line del">-    identifier: {{ (authelia_notifier_smtp_identifier) | default(omit) }}</span><span class="diff-line del">-    subject: &quot;{{ (authelia_notifier_smtp_subject) | default(omit) }}&quot;</span><span class="diff-line del">-    startup_check_address: {{ (authelia_notifier_smtp_startup_check_address) | default(omit) }}</span><span class="diff-line del">-    disable_require_tls: {{ (authelia_notifier_smtp_disable_require_tls) | default(omit) }}</span><span class="diff-line del">-    disable_html_emails: {{ (authelia_notifier_smtp_disable_html_emails) | default(omit) }}</span><span class="diff-line add">+    host: {{ lookup(&#x27;role_var&#x27;, &#x27;_notifier_smtp_host&#x27;, role=&#x27;authelia&#x27;) }}</span><span class="diff-line add">+    port: {{ lookup(&#x27;role_var&#x27;, &#x27;_notifier_smtp_port&#x27;, role=&#x27;authelia&#x27;) }}</span><span class="diff-line add">+    timeout: {{ (lookup(&#x27;role_var&#x27;, &#x27;_notifier_smtp_timeout&#x27;, role=&#x27;authelia&#x27;)) | default(omit) }}</span><span class="diff-line add">+    username: {{ (lookup(&#x27;role_var&#x27;, &#x27;_notifier_smtp_username&#x27;, role=&#x27;authelia&#x27;)) | default(omit) }}</span><span class="diff-line add">+    password: {{ (lookup(&#x27;role_var&#x27;, &#x27;_notifier_smtp_password&#x27;, role=&#x27;authelia&#x27;)) | default(omit) }}</span><span class="diff-line add">+    sender: {{ lookup(&#x27;role_var&#x27;, &#x27;_notifier_smtp_sender&#x27;, role=&#x27;authelia&#x27;) }}</span><span class="diff-line add">+    identifier: {{ (lookup(&#x27;role_var&#x27;, &#x27;_notifier_smtp_identifier&#x27;, role=&#x27;authelia&#x27;)) | default(omit) }}</span><span class="diff-line add">+    subject: &quot;{{ (lookup(&#x27;role_var&#x27;, &#x27;_notifier_smtp_subject&#x27;, role=&#x27;authelia&#x27;)) | default(omit) }}&quot;</span><span class="diff-line add">+    startup_check_address: {{ (lookup(&#x27;role_var&#x27;, &#x27;_notifier_smtp_startup_check_address&#x27;, role=&#x27;authelia&#x27;)) | default(omit) }}</span><span class="diff-line add">+    disable_require_tls: {{ (lookup(&#x27;role_var&#x27;, &#x27;_notifier_smtp_disable_require_tls&#x27;, role=&#x27;authelia&#x27;)) | default(omit) }}</span><span class="diff-line add">+    disable_html_emails: {{ (lookup(&#x27;role_var&#x27;, &#x27;_notifier_smtp_disable_html_emails&#x27;, role=&#x27;authelia&#x27;)) | default(omit) }}</span><span class="diff-line context">     tls:</span><span class="diff-line del">-      server_name: {{ (authelia_notifier_smtp_tls_server_name) | default(omit) }}</span><span class="diff-line del">-      skip_verify: {{ (authelia_notifier_smtp_tls_skip_verify) | default(omit) }}</span><span class="diff-line del">-      minimum_version: {{ (authelia_notifier_smtp_tls_minimum_version) | default(omit) }}</span><span class="diff-line del">-{% else %}</span><span class="diff-line del">-#</span><span class="diff-line del">-# If you want to use email here is a template (Replace the above entry as you can only have one notifier configured)</span><span class="diff-line del">-#</span><span class="diff-line del">-# notifier:</span><span class="diff-line del">-#   disable_startup_check: false</span><span class="diff-line del">-#   smtp:</span><span class="diff-line del">-#     host: 127.0.0.1</span><span class="diff-line del">-#     port: 1025</span><span class="diff-line del">-#     timeout: 5s</span><span class="diff-line del">-#     username: test</span><span class="diff-line del">-#     password: password</span><span class="diff-line del">-#     sender: admin@example.com</span><span class="diff-line del">-#     identifier: localhost</span><span class="diff-line del">-#     subject: &quot;[Authelia] {title}&quot;</span><span class="diff-line del">-#     startup_check_address: test@authelia.com</span><span class="diff-line del">-#     disable_require_tls: false</span><span class="diff-line del">-#     disable_html_emails: false</span><span class="diff-line del">-#     tls:</span><span class="diff-line del">-#       server_name: smtp.example.com</span><span class="diff-line del">-#       skip_verify: false</span><span class="diff-line del">-#       minimum_version: TLS1.2</span><span class="diff-line del">-#</span><span class="diff-line del">-# Read more at https://www.authelia.com/docs/configuration/notifier/smtp.html</span><span class="diff-line del">-#</span><span class="diff-line del">-{% endif %}</span><span class="diff-line del">-</span><span class="diff-line del">-telemetry:</span><span class="diff-line del">-  metrics:</span><span class="diff-line del">-    enabled: false</span><span class="diff-line del">-    address: &quot;tcp://0.0.0.0:9959&quot;</span><span class="diff-line del">-    buffers:</span><span class="diff-line del">-      read: 4096</span><span class="diff-line del">-      write: 4096</span><span class="diff-line del">-    timeouts:</span><span class="diff-line del">-      read: 6s</span><span class="diff-line del">-      write: 6s</span><span class="diff-line del">-      idle: 30s</span><span class="diff-line add">+      server_name: {{ (lookup(&#x27;role_var&#x27;, &#x27;_notifier_smtp_tls_server_name&#x27;, role=&#x27;authelia&#x27;)) | default(omit) }}</span><span class="diff-line add">+      skip_verify: {{ (lookup(&#x27;role_var&#x27;, &#x27;_notifier_smtp_tls_skip_verify&#x27;, role=&#x27;authelia&#x27;)) | default(omit) }}</span><span class="diff-line add">+      minimum_version: {{ (lookup(&#x27;role_var&#x27;, &#x27;_notifier_smtp_tls_minimum_version&#x27;, role=&#x27;authelia&#x27;)) | default(omit) }}</span><span class="diff-line add">+{% endif %}</span><span class="diff-line context"> </span><span class="diff-line context"> ...</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-111">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/authentik/defaults/main.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -17,145 +17,160 @@</span><span class="diff-line context"> # Settings</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-authentik_email_host: &quot;localhost&quot;</span><span class="diff-line del">-authentik_email_port: &quot;25&quot;</span><span class="diff-line del">-authentik_email_username: &quot;&quot;</span><span class="diff-line del">-authentik_email_password: &quot;&quot;</span><span class="diff-line del">-authentik_email_tls: &quot;false&quot;</span><span class="diff-line del">-authentik_email_ssl: &quot;false&quot;</span><span class="diff-line del">-authentik_email_timeout: &quot;10&quot;</span><span class="diff-line del">-authentik_email_from: &quot;authentik@localhost&quot;</span><span class="diff-line del">-authentik_access_token_validity: &quot;24&quot; # Hours, only fresh installs use this</span><span class="diff-line add">+authentik_role_email_host: &quot;localhost&quot;</span><span class="diff-line add">+authentik_role_email_port: &quot;25&quot;</span><span class="diff-line add">+authentik_role_email_username: &quot;&quot;</span><span class="diff-line add">+authentik_role_email_password: &quot;&quot;</span><span class="diff-line add">+authentik_role_email_tls: &quot;false&quot;</span><span class="diff-line add">+authentik_role_email_ssl: &quot;false&quot;</span><span class="diff-line add">+authentik_role_email_timeout: &quot;10&quot;</span><span class="diff-line add">+authentik_role_email_from: &quot;authentik@localhost&quot;</span><span class="diff-line add">+authentik_role_access_token_validity: &quot;24&quot; # Hours, only fresh installs use this</span><span class="diff-line add">+</span><span class="diff-line add">+################################</span><span class="diff-line add">+# Legacy</span><span class="diff-line add">+################################</span><span class="diff-line add">+</span><span class="diff-line add">+# Do not edit or override using the inventory</span><span class="diff-line add">+authentik_role_redis_name: &quot;{{ authentik_name }}-redis&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # Postgres</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-authentik_postgres_name: &quot;{{ authentik_name }}-postgres&quot;</span><span class="diff-line del">-authentik_postgres_docker_env_db: &quot;authentik&quot;</span><span class="diff-line del">-authentik_postgres_docker_image_tag: &quot;16-alpine&quot;</span><span class="diff-line del">-authentik_postgres_docker_image_repo: &quot;postgres&quot;</span><span class="diff-line add">+# Authentik will always require postgres, this just allows you to skip the one Saltbox deploys</span><span class="diff-line add">+authentik_role_postgres_deploy: true</span><span class="diff-line add">+authentik_role_postgres_name: &quot;{{ authentik_name }}-postgres&quot;</span><span class="diff-line add">+authentik_role_postgres_user: &quot;{{ postgres_role_docker_env_user }}&quot;</span><span class="diff-line add">+authentik_role_postgres_password: &quot;{{ postgres_role_docker_env_password }}&quot;</span><span class="diff-line add">+authentik_role_postgres_docker_env_db: &quot;authentik&quot;</span><span class="diff-line add">+authentik_role_postgres_docker_image_tag: &quot;16-alpine&quot;</span><span class="diff-line add">+authentik_role_postgres_docker_image_repo: &quot;postgres&quot;</span><span class="diff-line add">+authentik_role_postgres_docker_healthcheck:</span><span class="diff-line add">+  test: [&quot;CMD-SHELL&quot;, &quot;pg_isready -d {{ lookup(&#x27;role_var&#x27;, &#x27;_postgres_docker_env_db&#x27;, role=&#x27;authentik&#x27;) }} -U {{ postgres_role_docker_env_user }}&quot;]</span><span class="diff-line add">+  start_period: 20s</span><span class="diff-line add">+  interval: 30s</span><span class="diff-line add">+  retries: 5</span><span class="diff-line add">+  timeout: 5s</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # Paths</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-authentik_paths_folder: &quot;{{ authentik_name }}&quot;</span><span class="diff-line del">-authentik_paths_location: &quot;{{ server_appdata_path }}/{{ authentik_paths_folder }}&quot;</span><span class="diff-line del">-authentik_paths_folders_list:</span><span class="diff-line del">-  - &quot;{{ authentik_paths_location }}&quot;</span><span class="diff-line del">-  - &quot;{{ authentik_paths_location }}/media&quot;</span><span class="diff-line del">-  - &quot;{{ authentik_paths_location }}/custom-templates&quot;</span><span class="diff-line del">-  - &quot;{{ authentik_paths_location }}/certs&quot;</span><span class="diff-line add">+authentik_role_paths_folder: &quot;{{ authentik_name }}&quot;</span><span class="diff-line add">+authentik_role_paths_location: &quot;{{ server_appdata_path }}/{{ authentik_role_paths_folder }}&quot;</span><span class="diff-line add">+authentik_role_paths_folders_list:</span><span class="diff-line add">+  - &quot;{{ authentik_role_paths_location }}&quot;</span><span class="diff-line add">+  - &quot;{{ authentik_role_paths_location }}/media&quot;</span><span class="diff-line add">+  - &quot;{{ authentik_role_paths_location }}/custom-templates&quot;</span><span class="diff-line add">+  - &quot;{{ authentik_role_paths_location }}/certs&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # Web</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-authentik_web_subdomain: &quot;auth&quot;</span><span class="diff-line del">-authentik_web_domain: &quot;{{ user.domain }}&quot;</span><span class="diff-line del">-authentik_web_port: &quot;9000&quot;</span><span class="diff-line del">-authentik_web_url: &quot;{{ &#x27;https://&#x27; + (authentik_web_subdomain + &#x27;.&#x27; + authentik_web_domain</span><span class="diff-line del">-                    if (authentik_web_subdomain | length &gt; 0)</span><span class="diff-line del">-                    else authentik_web_domain) }}&quot;</span><span class="diff-line add">+authentik_role_web_subdomain: &quot;auth&quot;</span><span class="diff-line add">+authentik_role_web_domain: &quot;{{ user.domain }}&quot;</span><span class="diff-line add">+authentik_role_web_port: &quot;9000&quot;</span><span class="diff-line add">+authentik_role_web_url: &quot;{{ &#x27;https://&#x27; + (lookup(&#x27;role_var&#x27;, &#x27;_web_subdomain&#x27;, role=&#x27;authentik&#x27;) + &#x27;.&#x27; + lookup(&#x27;role_var&#x27;, &#x27;_web_domain&#x27;, role=&#x27;authentik&#x27;)</span><span class="diff-line add">+                         if (lookup(&#x27;role_var&#x27;, &#x27;_web_subdomain&#x27;, role=&#x27;authentik&#x27;) | length &gt; 0)</span><span class="diff-line add">+                         else lookup(&#x27;role_var&#x27;, &#x27;_web_domain&#x27;, role=&#x27;authentik&#x27;)) }}&quot;</span><span class="diff-line add">+authentik_role_web_host: &quot;{{ (lookup(&#x27;role_var&#x27;, &#x27;_web_subdomain&#x27;, role=&#x27;authentik&#x27;) + &#x27;.&#x27; + lookup(&#x27;role_var&#x27;, &#x27;_web_domain&#x27;, role=&#x27;authentik&#x27;)</span><span class="diff-line add">+                          if (lookup(&#x27;role_var&#x27;, &#x27;_web_subdomain&#x27;, role=&#x27;authentik&#x27;) | length &gt; 0)</span><span class="diff-line add">+                          else lookup(&#x27;role_var&#x27;, &#x27;_web_domain&#x27;, role=&#x27;authentik&#x27;)) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # DNS</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-authentik_dns_record: &quot;{{ authentik_web_subdomain }}&quot;</span><span class="diff-line del">-authentik_dns_zone: &quot;{{ authentik_web_domain }}&quot;</span><span class="diff-line del">-authentik_dns_proxy: &quot;{{ dns.proxied }}&quot;</span><span class="diff-line add">+authentik_role_dns_record: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_web_subdomain&#x27;, role=&#x27;authentik&#x27;) }}&quot;</span><span class="diff-line add">+authentik_role_dns_zone: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_web_domain&#x27;, role=&#x27;authentik&#x27;) }}&quot;</span><span class="diff-line add">+authentik_role_dns_proxy: &quot;{{ dns_proxied }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # Traefik</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-authentik_traefik_sso_middleware: &quot;&quot;</span><span class="diff-line del">-authentik_traefik_middleware_default: &quot;{{ traefik_default_middleware }}&quot;</span><span class="diff-line del">-authentik_traefik_middleware_custom: &quot;&quot;</span><span class="diff-line del">-authentik_traefik_certresolver: &quot;{{ traefik_default_certresolver }}&quot;</span><span class="diff-line del">-authentik_traefik_enabled: true</span><span class="diff-line del">-authentik_traefik_api_enabled: false</span><span class="diff-line del">-authentik_traefik_api_endpoint: &quot;&quot;</span><span class="diff-line add">+authentik_role_traefik_sso_middleware: &quot;&quot;</span><span class="diff-line add">+authentik_role_traefik_middleware_default: &quot;{{ traefik_default_middleware }}&quot;</span><span class="diff-line add">+authentik_role_traefik_middleware_custom: &quot;&quot;</span><span class="diff-line add">+authentik_role_traefik_certresolver: &quot;{{ traefik_default_certresolver }}&quot;</span><span class="diff-line add">+authentik_role_traefik_enabled: true</span><span class="diff-line add">+authentik_role_traefik_api_enabled: false</span><span class="diff-line add">+authentik_role_traefik_api_endpoint: &quot;&quot;</span><span class="diff-line add">+authentik_role_traefik_outpost_catch_all: false</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # Setup</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-authentik_host: &quot;http://{{ authentik_name }}:9000&quot;</span><span class="diff-line del">-authentik_default_user: &quot;akadmin&quot;</span><span class="diff-line add">+authentik_role_host: &quot;http://{{ authentik_name }}:{{ lookup(&#x27;role_var&#x27;, &#x27;_web_port&#x27;, role=&#x27;authentik&#x27;) }}&quot;</span><span class="diff-line add">+authentik_role_default_user: &quot;akadmin&quot;</span><span class="diff-line add">+authentik_role_response_headers:</span><span class="diff-line add">+  - &quot;X-authentik-username&quot;</span><span class="diff-line add">+  - &quot;X-authentik-groups&quot;</span><span class="diff-line add">+  - &quot;X-authentik-entitlements&quot;</span><span class="diff-line add">+  - &quot;X-authentik-email&quot;</span><span class="diff-line add">+  - &quot;X-authentik-name&quot;</span><span class="diff-line add">+  - &quot;X-authentik-uid&quot;</span><span class="diff-line add">+  - &quot;X-authentik-jwt&quot;</span><span class="diff-line add">+  - &quot;X-authentik-meta-jwks&quot;</span><span class="diff-line add">+  - &quot;X-authentik-meta-outpost&quot;</span><span class="diff-line add">+  - &quot;X-authentik-meta-provider&quot;</span><span class="diff-line add">+  - &quot;X-authentik-meta-app&quot;</span><span class="diff-line add">+  - &quot;X-authentik-meta-version&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # Docker</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line context"> # Container</span><span class="diff-line del">-authentik_docker_container: &quot;{{ authentik_name }}&quot;</span><span class="diff-line add">+authentik_role_docker_container: &quot;{{ authentik_name }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Image</span><span class="diff-line del">-authentik_docker_image_pull: true</span><span class="diff-line del">-authentik_docker_image_tag: &quot;2025.8&quot;</span><span class="diff-line del">-authentik_docker_image: &quot;ghcr.io/goauthentik/server:{{ authentik_docker_image_tag }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Ports</span><span class="diff-line del">-authentik_docker_ports_defaults: []</span><span class="diff-line del">-authentik_docker_ports_custom: []</span><span class="diff-line del">-authentik_docker_ports: &quot;{{ authentik_docker_ports_defaults</span><span class="diff-line del">-                            + authentik_docker_ports_custom }}&quot;</span><span class="diff-line add">+authentik_role_docker_image_pull: true</span><span class="diff-line add">+authentik_role_docker_image_repo: &quot;ghcr.io/goauthentik/server&quot;</span><span class="diff-line add">+authentik_role_docker_image_tag: &quot;2025.10&quot;</span><span class="diff-line add">+authentik_role_docker_image: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_image_repo&#x27;, role=&#x27;authentik&#x27;) }}:{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_image_tag&#x27;, role=&#x27;authentik&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Envs</span><span class="diff-line del">-authentik_docker_envs_default:</span><span class="diff-line del">-  AUTHENTIK_REDIS__HOST: authentik-redis</span><span class="diff-line del">-  AUTHENTIK_POSTGRESQL__HOST: &quot;{{ authentik_postgres_name }}&quot;</span><span class="diff-line del">-  AUTHENTIK_POSTGRESQL__USER: &quot;{{ postgres_docker_env_user }}&quot;</span><span class="diff-line del">-  AUTHENTIK_POSTGRESQL__NAME: &quot;{{ authentik_postgres_docker_env_db }}&quot;</span><span class="diff-line del">-  AUTHENTIK_POSTGRESQL__PASSWORD: &quot;{{ postgres_docker_env_password }}&quot;</span><span class="diff-line add">+authentik_role_docker_envs_default:</span><span class="diff-line add">+  AUTHENTIK_POSTGRESQL__HOST: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_postgres_name&#x27;, role=&#x27;authentik&#x27;) }}&quot;</span><span class="diff-line add">+  AUTHENTIK_POSTGRESQL__USER: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_postgres_user&#x27;, role=&#x27;authentik&#x27;) }}&quot;</span><span class="diff-line add">+  AUTHENTIK_POSTGRESQL__NAME: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_postgres_docker_env_db&#x27;, role=&#x27;authentik&#x27;) }}&quot;</span><span class="diff-line add">+  AUTHENTIK_POSTGRESQL__PASSWORD: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_postgres_password&#x27;, role=&#x27;authentik&#x27;) }}&quot;</span><span class="diff-line context">   AUTHENTIK_SECRET_KEY: &quot;{{ authentik_saltbox_facts.facts.secret_key }}&quot;</span><span class="diff-line context">   AUTHENTIK_BOOTSTRAP_TOKEN: &quot;{{ omit if authentik_data_folder.stat.exists else authentik_bootstrap_token }}&quot;</span><span class="diff-line del">-  AUTHENTIK_EMAIL__HOST: &quot;{{ authentik_email_host }}&quot;</span><span class="diff-line del">-  AUTHENTIK_EMAIL__PORT: &quot;{{ authentik_email_port }}&quot;</span><span class="diff-line del">-  AUTHENTIK_EMAIL__USERNAME: &quot;{{ authentik_email_username }}&quot;</span><span class="diff-line del">-  AUTHENTIK_EMAIL__PASSWORD: &quot;{{ authentik_email_password }}&quot;</span><span class="diff-line del">-  AUTHENTIK_EMAIL__USE_TLS: &quot;{{ authentik_email_tls }}&quot;</span><span class="diff-line del">-  AUTHENTIK_EMAIL__USE_SSL: &quot;{{ authentik_email_ssl }}&quot;</span><span class="diff-line del">-  AUTHENTIK_EMAIL__TIMEOUT: &quot;{{ authentik_email_timeout }}&quot;</span><span class="diff-line del">-  AUTHENTIK_EMAIL__FROM: &quot;{{ authentik_email_from }}&quot;</span><span class="diff-line add">+  AUTHENTIK_EMAIL__HOST: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_email_host&#x27;, role=&#x27;authentik&#x27;) }}&quot;</span><span class="diff-line add">+  AUTHENTIK_EMAIL__PORT: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_email_port&#x27;, role=&#x27;authentik&#x27;) }}&quot;</span><span class="diff-line add">+  AUTHENTIK_EMAIL__USERNAME: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_email_username&#x27;, role=&#x27;authentik&#x27;) }}&quot;</span><span class="diff-line add">+  AUTHENTIK_EMAIL__PASSWORD: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_email_password&#x27;, role=&#x27;authentik&#x27;) }}&quot;</span><span class="diff-line add">+  AUTHENTIK_EMAIL__USE_TLS: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_email_tls&#x27;, role=&#x27;authentik&#x27;) }}&quot;</span><span class="diff-line add">+  AUTHENTIK_EMAIL__USE_SSL: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_email_ssl&#x27;, role=&#x27;authentik&#x27;) }}&quot;</span><span class="diff-line add">+  AUTHENTIK_EMAIL__TIMEOUT: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_email_timeout&#x27;, role=&#x27;authentik&#x27;) }}&quot;</span><span class="diff-line add">+  AUTHENTIK_EMAIL__FROM: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_email_from&#x27;, role=&#x27;authentik&#x27;) }}&quot;</span><span class="diff-line context">   AUTHENTIK_LISTEN__TRUSTED_PROXY_CIDRS: &quot;172.19.0.0/16&quot;</span><span class="diff-line del">-authentik_docker_envs_custom: {}</span><span class="diff-line del">-authentik_docker_envs: &quot;{{ authentik_docker_envs_default</span><span class="diff-line del">-                           | combine(authentik_docker_envs_custom) }}&quot;</span><span class="diff-line add">+authentik_role_docker_envs_custom: {}</span><span class="diff-line add">+authentik_role_docker_envs: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_envs_default&#x27;, role=&#x27;authentik&#x27;)</span><span class="diff-line add">+                                | combine(lookup(&#x27;role_var&#x27;, &#x27;_docker_envs_custom&#x27;, role=&#x27;authentik&#x27;)) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Commands</span><span class="diff-line del">-authentik_docker_commands_default:</span><span class="diff-line add">+authentik_role_docker_commands_default:</span><span class="diff-line context">   - &quot;server&quot;</span><span class="diff-line del">-authentik_docker_commands_custom: []</span><span class="diff-line del">-authentik_docker_commands: &quot;{{ authentik_docker_commands_default</span><span class="diff-line del">-                               + authentik_docker_commands_custom }}&quot;</span><span class="diff-line add">+authentik_role_docker_commands_custom: []</span><span class="diff-line add">+authentik_role_docker_commands: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_commands_default&#x27;, role=&#x27;authentik&#x27;)</span><span class="diff-line add">+                                    + lookup(&#x27;role_var&#x27;, &#x27;_docker_commands_custom&#x27;, role=&#x27;authentik&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Volumes</span><span class="diff-line del">-authentik_docker_volumes_default:</span><span class="diff-line del">-  - &quot;{{ authentik_paths_location }}/media:/media&quot;</span><span class="diff-line del">-  - &quot;{{ authentik_paths_location }}/custom-templates:/templates&quot;</span><span class="diff-line del">-authentik_docker_volumes_custom: []</span><span class="diff-line del">-authentik_docker_volumes: &quot;{{ authentik_docker_volumes_default</span><span class="diff-line del">-                              + authentik_docker_volumes_custom }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Devices</span><span class="diff-line del">-authentik_docker_devices_default: []</span><span class="diff-line del">-authentik_docker_devices_custom: []</span><span class="diff-line del">-authentik_docker_devices: &quot;{{ authentik_docker_devices_default</span><span class="diff-line del">-                              + authentik_docker_devices_custom }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Hosts</span><span class="diff-line del">-authentik_docker_hosts_default: {}</span><span class="diff-line del">-authentik_docker_hosts_custom: {}</span><span class="diff-line del">-authentik_docker_hosts: &quot;{{ docker_hosts_common</span><span class="diff-line del">-                            | combine(authentik_docker_hosts_default)</span><span class="diff-line del">-                            | combine(authentik_docker_hosts_custom) }}&quot;</span><span class="diff-line add">+authentik_role_docker_volumes_default:</span><span class="diff-line add">+  - &quot;{{ authentik_role_paths_location }}/media:/media&quot;</span><span class="diff-line add">+  - &quot;{{ authentik_role_paths_location }}/custom-templates:/templates&quot;</span><span class="diff-line add">+authentik_role_docker_volumes_custom: []</span><span class="diff-line add">+authentik_role_docker_volumes: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_volumes_default&#x27;, role=&#x27;authentik&#x27;)</span><span class="diff-line add">+                                   + lookup(&#x27;role_var&#x27;, &#x27;_docker_volumes_custom&#x27;, role=&#x27;authentik&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Labels</span><span class="diff-line del">-authentik_docker_labels_default:</span><span class="diff-line add">+authentik_role_docker_labels_default:</span><span class="diff-line context">   traefik.http.routers.authentik-outpost-http.entrypoints: &quot;web&quot;</span><span class="diff-line context">   traefik.http.routers.authentik-outpost-http.service: &quot;authentik-outpost-http&quot;</span><span class="diff-line context">   traefik.http.routers.authentik-outpost-http.rule: &quot;PathPrefix(`/outpost.goauthentik.io/`)&quot;</span><span class="diff-line hunk">@@ -165,46 +180,33 @@</span><span class="diff-line context">   traefik.http.routers.authentik-outpost.service: &quot;authentik-outpost&quot;</span><span class="diff-line context">   traefik.http.routers.authentik-outpost.rule: &quot;PathPrefix(`/outpost.goauthentik.io/`)&quot;</span><span class="diff-line context">   traefik.http.routers.authentik-outpost.tls.options: &quot;securetls@file&quot;</span><span class="diff-line del">-  traefik.http.routers.authentik-outpost.tls.certresolver: &quot;{{ authentik_traefik_certresolver }}&quot;</span><span class="diff-line add">+  traefik.http.routers.authentik-outpost.tls.certresolver: &quot;{{ authentik_role_traefik_certresolver }}&quot;</span><span class="diff-line context">   traefik.http.routers.authentik-outpost.middlewares: &quot;{{ traefik_default_middleware }}&quot;</span><span class="diff-line context">   traefik.http.routers.authentik-outpost.priority: &quot;99&quot;</span><span class="diff-line del">-  traefik.http.services.authentik-outpost-http.loadbalancer.server.port: &quot;9000&quot;</span><span class="diff-line del">-  traefik.http.services.authentik-outpost.loadbalancer.server.port: &quot;9000&quot;</span><span class="diff-line del">-authentik_docker_labels_custom: {}</span><span class="diff-line del">-authentik_docker_labels: &quot;{{ docker_labels_common</span><span class="diff-line del">-                             | combine(authentik_docker_labels_default)</span><span class="diff-line del">-                             | combine(authentik_docker_labels_custom) }}&quot;</span><span class="diff-line add">+  traefik.http.services.authentik-outpost-http.loadbalancer.server.port: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_web_port&#x27;, role=&#x27;authentik&#x27;) }}&quot;</span><span class="diff-line add">+  traefik.http.services.authentik-outpost.loadbalancer.server.port: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_web_port&#x27;, role=&#x27;authentik&#x27;) }}&quot;</span><span class="diff-line add">+authentik_role_docker_labels_custom: {}</span><span class="diff-line add">+authentik_role_docker_labels: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_labels_default&#x27;, role=&#x27;authentik&#x27;)</span><span class="diff-line add">+                                  | combine(lookup(&#x27;role_var&#x27;, &#x27;_docker_labels_custom&#x27;, role=&#x27;authentik&#x27;)) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Hostname</span><span class="diff-line del">-authentik_docker_hostname: &quot;{{ authentik_name }}&quot;</span><span class="diff-line add">+authentik_role_docker_hostname: &quot;{{ authentik_name }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Networks</span><span class="diff-line del">-authentik_docker_networks_alias: &quot;{{ authentik_name }}&quot;</span><span class="diff-line del">-authentik_docker_networks_default: []</span><span class="diff-line del">-authentik_docker_networks_custom: []</span><span class="diff-line del">-authentik_docker_networks: &quot;{{ docker_networks_common</span><span class="diff-line del">-                               + authentik_docker_networks_default</span><span class="diff-line del">-                               + authentik_docker_networks_custom }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Capabilities</span><span class="diff-line del">-authentik_docker_capabilities_default: []</span><span class="diff-line del">-authentik_docker_capabilities_custom: []</span><span class="diff-line del">-authentik_docker_capabilities: &quot;{{ authentik_docker_capabilities_default</span><span class="diff-line del">-                                   + authentik_docker_capabilities_custom }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Security Opts</span><span class="diff-line del">-authentik_docker_security_opts_default: []</span><span class="diff-line del">-authentik_docker_security_opts_custom: []</span><span class="diff-line del">-authentik_docker_security_opts: &quot;{{ authentik_docker_security_opts_default</span><span class="diff-line del">-                                    + authentik_docker_security_opts_custom }}&quot;</span><span class="diff-line add">+authentik_role_docker_networks_alias: &quot;{{ authentik_name }}&quot;</span><span class="diff-line add">+authentik_role_docker_networks_default: []</span><span class="diff-line add">+authentik_role_docker_networks_custom: []</span><span class="diff-line add">+authentik_role_docker_networks: &quot;{{ docker_networks_common</span><span class="diff-line add">+                                    + lookup(&#x27;role_var&#x27;, &#x27;_docker_networks_default&#x27;, role=&#x27;authentik&#x27;)</span><span class="diff-line add">+                                    + lookup(&#x27;role_var&#x27;, &#x27;_docker_networks_custom&#x27;, role=&#x27;authentik&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Restart Policy</span><span class="diff-line del">-authentik_docker_restart_policy: unless-stopped</span><span class="diff-line add">+authentik_role_docker_restart_policy: unless-stopped</span><span class="diff-line context"> </span><span class="diff-line context"> # State</span><span class="diff-line del">-authentik_docker_state: started</span><span class="diff-line add">+authentik_role_docker_state: started</span><span class="diff-line context"> </span><span class="diff-line context"> # Dependencies</span><span class="diff-line del">-authentik_depends_on: &quot;authentik-redis,{{ authentik_postgres_name }}&quot;</span><span class="diff-line del">-authentik_depends_on_delay: &quot;0&quot;</span><span class="diff-line del">-authentik_depends_on_healthchecks: &quot;false&quot;</span><span class="diff-line add">+authentik_role_depends_on: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_postgres_name&#x27;, role=&#x27;authentik&#x27;) }}&quot;</span><span class="diff-line add">+authentik_role_depends_on_delay: &quot;0&quot;</span><span class="diff-line add">+authentik_role_depends_on_healthchecks: &quot;true&quot;</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-112">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/authentik/tasks/main.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -7,62 +7,59 @@</span><span class="diff-line context"> #                   GNU General Public License v3.0                     #</span><span class="diff-line context"> #########################################################################</span><span class="diff-line context"> ---</span><span class="diff-line add">+- name: Import authentik_worker role variables</span><span class="diff-line add">+  ansible.builtin.include_tasks: &quot;{{ resources_tasks_path }}/variables/import_role_vars.yml&quot;</span><span class="diff-line add">+  vars:</span><span class="diff-line add">+    import_role_name: authentik_worker</span><span class="diff-line add">+</span><span class="diff-line context"> - name: Remove existing Docker containers</span><span class="diff-line context">   ansible.builtin.include_tasks: &quot;{{ resources_tasks_path }}/docker/remove_docker_container.yml&quot;</span><span class="diff-line context">   vars:</span><span class="diff-line context">     var_prefix: &quot;{{ item }}&quot;</span><span class="diff-line context">   loop:</span><span class="diff-line context">     - &quot;{{ authentik_name }}&quot;</span><span class="diff-line del">-    - &quot;authentik-worker&quot;</span><span class="diff-line del">-    - &quot;authentik-redis&quot;</span><span class="diff-line del">-    - &quot;authentik-postgres&quot;</span><span class="diff-line add">+    - &quot;{{ authentik_worker_name }}&quot;</span><span class="diff-line add">+    - &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_postgres_name&#x27;, role=&#x27;authentik&#x27;) }}&quot;</span><span class="diff-line add">+    - &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_redis_name&#x27;, role=&#x27;authentik&#x27;) }}&quot; # Legacy removal</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Reset Authentik directory</span><span class="diff-line context">   ansible.builtin.file:</span><span class="diff-line del">-    path: &quot;{{ authentik_paths_location }}&quot;</span><span class="diff-line add">+    path: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_location&#x27;, role=&#x27;authentik&#x27;) }}&quot;</span><span class="diff-line context">     state: absent</span><span class="diff-line context">   when: (&#x27;authentik-reset&#x27; in ansible_run_tags)</span><span class="diff-line context"> </span><span class="diff-line del">-- name: Check if &#x27;{{ authentik_paths_location }}&#x27; exists</span><span class="diff-line add">+- name: Check if &#x27;{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_location&#x27;, role=&#x27;authentik&#x27;) }}&#x27; exists</span><span class="diff-line context">   ansible.builtin.stat:</span><span class="diff-line del">-    path: &quot;{{ authentik_paths_location }}&quot;</span><span class="diff-line add">+    path: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_location&#x27;, role=&#x27;authentik&#x27;) }}&quot;</span><span class="diff-line context">   register: authentik_data_folder</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Generate Bootstrap Token</span><span class="diff-line context">   ansible.builtin.set_fact:</span><span class="diff-line context">     authentik_bootstrap_token: &quot;{{ lookup(&#x27;ansible.builtin.password&#x27;, &#x27;/dev/null&#x27;, chars=[&#x27;ascii_letters&#x27;, &#x27;digits&#x27;], length=50) }}&quot;</span><span class="diff-line add">+  when: (not authentik_data_folder.stat.exists)</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Create directories</span><span class="diff-line context">   ansible.builtin.include_tasks: &quot;{{ resources_tasks_path }}/directories/create_directories.yml&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-- name: &quot;Import Redis Role&quot;</span><span class="diff-line del">-  ansible.builtin.include_role:</span><span class="diff-line del">-    name: redis</span><span class="diff-line del">-  vars:</span><span class="diff-line del">-    redis_instances: [&quot;authentik-redis&quot;]</span><span class="diff-line del">-    redis_docker_image_tag: &quot;alpine&quot;</span><span class="diff-line del">-    redis_paths_folder: &quot;{{ authentik_paths_folder }}/redis&quot;</span><span class="diff-line del">-    redis_paths_location: &quot;{{ server_appdata_path }}/{{ redis_paths_folder }}&quot;</span><span class="diff-line del">-    redis_docker_commands_default:</span><span class="diff-line del">-      - &quot;--save 60 1 --loglevel warning&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: &quot;Import Postgres Role&quot;</span><span class="diff-line context">   ansible.builtin.include_role:</span><span class="diff-line context">     name: postgres</span><span class="diff-line context">   vars:</span><span class="diff-line del">-    postgres_instances: [&quot;{{ authentik_postgres_name }}&quot;]</span><span class="diff-line del">-    postgres_docker_image_tag: &quot;{{ authentik_postgres_docker_image_tag }}&quot;</span><span class="diff-line del">-    postgres_docker_image_repo: &quot;{{ authentik_postgres_docker_image_repo }}&quot;</span><span class="diff-line del">-    postgres_paths_folder: &quot;{{ authentik_paths_folder }}/postgres&quot;</span><span class="diff-line del">-    postgres_paths_location: &quot;{{ server_appdata_path }}/{{ postgres_paths_folder }}&quot;</span><span class="diff-line del">-    postgres_docker_env_db: &quot;{{ authentik_postgres_docker_env_db }}&quot;</span><span class="diff-line add">+    postgres_instances: [&quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_postgres_name&#x27;, role=&#x27;authentik&#x27;) }}&quot;]</span><span class="diff-line add">+    postgres_role_docker_image_tag: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_postgres_docker_image_tag&#x27;, role=&#x27;authentik&#x27;) }}&quot;</span><span class="diff-line add">+    postgres_role_docker_image_repo: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_postgres_docker_image_repo&#x27;, role=&#x27;authentik&#x27;) }}&quot;</span><span class="diff-line add">+    postgres_role_paths_folder: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_folder&#x27;, role=&#x27;authentik&#x27;) }}/postgres&quot;</span><span class="diff-line add">+    postgres_role_paths_location: &quot;{{ server_appdata_path }}/{{ postgres_role_paths_folder }}&quot;</span><span class="diff-line add">+    postgres_role_docker_env_db: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_postgres_docker_env_db&#x27;, role=&#x27;authentik&#x27;) }}&quot;</span><span class="diff-line add">+    postgres_role_docker_healthcheck: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_postgres_docker_healthcheck&#x27;, role=&#x27;authentik&#x27;) }}&quot;</span><span class="diff-line add">+  when: lookup(&#x27;role_var&#x27;, &#x27;_postgres_deploy&#x27;, role=&#x27;authentik&#x27;)</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Add DNS record</span><span class="diff-line context">   ansible.builtin.include_tasks: &quot;{{ resources_tasks_path }}/dns/tasker.yml&quot;</span><span class="diff-line context">   vars:</span><span class="diff-line del">-    dns_record: &quot;{{ lookup(&#x27;vars&#x27;, role_name + &#x27;_dns_record&#x27;) }}&quot;</span><span class="diff-line del">-    dns_zone: &quot;{{ lookup(&#x27;vars&#x27;, role_name + &#x27;_dns_zone&#x27;) }}&quot;</span><span class="diff-line del">-    dns_proxy: &quot;{{ lookup(&#x27;vars&#x27;, role_name + &#x27;_dns_proxy&#x27;) }}&quot;</span><span class="diff-line add">+    dns_record: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_dns_record&#x27;) }}&quot;</span><span class="diff-line add">+    dns_zone: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_dns_zone&#x27;) }}&quot;</span><span class="diff-line add">+    dns_proxy: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_dns_proxy&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: &quot;Save Authentik Saltbox facts&quot;</span><span class="diff-line context">   saltbox_facts:</span><span class="diff-line hunk">@@ -72,7 +69,16 @@</span><span class="diff-line context">       secret_key: &quot;{{ lookup(&#x27;ansible.builtin.password&#x27;, &#x27;/dev/null&#x27;, chars=[&#x27;ascii_letters&#x27;, &#x27;digits&#x27;], length=50) }}&quot;</span><span class="diff-line context">     owner: &quot;{{ user.name }}&quot;</span><span class="diff-line context">     group: &quot;{{ user.name }}&quot;</span><span class="diff-line add">+    base_path: &quot;{{ server_appdata_path }}&quot;</span><span class="diff-line context">   register: authentik_saltbox_facts</span><span class="diff-line add">+</span><span class="diff-line add">+- name: &quot;Wait for {{ lookup(&#x27;role_var&#x27;, &#x27;_postgres_name&#x27;, role=&#x27;authentik&#x27;) }} container to be healthy&quot;</span><span class="diff-line add">+  community.docker.docker_container_info:</span><span class="diff-line add">+    name: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_postgres_name&#x27;, role=&#x27;authentik&#x27;) }}&quot;</span><span class="diff-line add">+  until: &quot;authentik_postgres_container_info.container.State.Health.Status == &#x27;healthy&#x27;&quot;</span><span class="diff-line add">+  register: authentik_postgres_container_info</span><span class="diff-line add">+  retries: 15</span><span class="diff-line add">+  delay: 10</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Create Docker container</span><span class="diff-line context">   ansible.builtin.include_tasks: &quot;{{ resources_tasks_path }}/docker/create_docker_container.yml&quot;</span><span class="diff-line hunk">@@ -81,10 +87,6 @@</span><span class="diff-line context">   ansible.builtin.include_role:</span><span class="diff-line context">     name: authentik_worker</span><span class="diff-line context"> </span><span class="diff-line del">-- name: Setup Toggle</span><span class="diff-line del">-  ansible.builtin.set_fact:</span><span class="diff-line del">-    authentik_setup: &quot;{{ false if authentik_data_folder.stat.exists else true }}&quot;</span><span class="diff-line del">-</span><span class="diff-line context"> - name: Setup Task</span><span class="diff-line del">-  ansible.builtin.import_tasks: &quot;subtasks/setup.yml&quot;</span><span class="diff-line del">-  when: authentik_setup and not continuous_integration</span><span class="diff-line add">+  ansible.builtin.include_tasks: &quot;subtasks/setup.yml&quot;</span><span class="diff-line add">+  when: (not authentik_data_folder.stat.exists) and (not continuous_integration)</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-113">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/authentik/tasks/subtasks/setup.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -9,7 +9,7 @@</span><span class="diff-line context"> ---</span><span class="diff-line context"> - name: Validate bootstrap token (retry until Authentik is ready)</span><span class="diff-line context">   ansible.builtin.uri:</span><span class="diff-line del">-    url: &quot;{{ authentik_host }}/api/v3/core/users/me/&quot;</span><span class="diff-line add">+    url: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_host&#x27;, role=&#x27;authentik&#x27;) }}/api/v3/core/users/me/&quot;</span><span class="diff-line context">     method: GET</span><span class="diff-line context">     headers:</span><span class="diff-line context">       Authorization: &quot;Bearer {{ authentik_bootstrap_token }}&quot;</span><span class="diff-line hunk">@@ -20,7 +20,7 @@</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Create new admin user</span><span class="diff-line context">   ansible.builtin.uri:</span><span class="diff-line del">-    url: &quot;{{ authentik_host }}/api/v3/core/users/&quot;</span><span class="diff-line add">+    url: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_host&#x27;, role=&#x27;authentik&#x27;) }}/api/v3/core/users/&quot;</span><span class="diff-line context">     method: POST</span><span class="diff-line context">     body_format: json</span><span class="diff-line context">     headers:</span><span class="diff-line hunk">@@ -37,7 +37,7 @@</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Set new admin user&#x27;s password</span><span class="diff-line context">   ansible.builtin.uri:</span><span class="diff-line del">-    url: &quot;{{ authentik_host }}/api/v3/core/users/{{ new_user_response.json.pk }}/set_password/&quot;</span><span class="diff-line add">+    url: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_host&#x27;, role=&#x27;authentik&#x27;) }}/api/v3/core/users/{{ new_user_response.json.pk }}/set_password/&quot;</span><span class="diff-line context">     method: POST</span><span class="diff-line context">     body_format: json</span><span class="diff-line context">     headers:</span><span class="diff-line hunk">@@ -47,10 +47,11 @@</span><span class="diff-line context">     body:</span><span class="diff-line context">       password: &quot;{{ user.pass }}&quot;</span><span class="diff-line context">     status_code: 204</span><span class="diff-line add">+  no_log: true</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Create new admin group</span><span class="diff-line context">   ansible.builtin.uri:</span><span class="diff-line del">-    url: &quot;{{ authentik_host }}/api/v3/core/groups/&quot;</span><span class="diff-line add">+    url: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_host&#x27;, role=&#x27;authentik&#x27;) }}/api/v3/core/groups/&quot;</span><span class="diff-line context">     method: POST</span><span class="diff-line context">     body_format: json</span><span class="diff-line context">     headers:</span><span class="diff-line hunk">@@ -67,7 +68,7 @@</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Create token for new admin user</span><span class="diff-line context">   ansible.builtin.uri:</span><span class="diff-line del">-    url: &quot;{{ authentik_host }}/api/v3/core/tokens/&quot;</span><span class="diff-line add">+    url: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_host&#x27;, role=&#x27;authentik&#x27;) }}/api/v3/core/tokens/&quot;</span><span class="diff-line context">     method: POST</span><span class="diff-line context">     body_format: json</span><span class="diff-line context">     headers:</span><span class="diff-line hunk">@@ -83,7 +84,7 @@</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Get token for new admin user</span><span class="diff-line context">   ansible.builtin.uri:</span><span class="diff-line del">-    url: &quot;{{ authentik_host }}/api/v3/core/tokens/saltbox-api-token/view_key/&quot;</span><span class="diff-line add">+    url: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_host&#x27;, role=&#x27;authentik&#x27;) }}/api/v3/core/tokens/saltbox-api-token/view_key/&quot;</span><span class="diff-line context">     method: GET</span><span class="diff-line context">     body_format: json</span><span class="diff-line context">     headers:</span><span class="diff-line hunk">@@ -104,10 +105,11 @@</span><span class="diff-line context">       api_token: &quot;{{ authentik_admin_token }}&quot;</span><span class="diff-line context">     owner: &quot;{{ user.name }}&quot;</span><span class="diff-line context">     group: &quot;{{ user.name }}&quot;</span><span class="diff-line add">+    base_path: &quot;{{ server_appdata_path }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Retrieve flow instances</span><span class="diff-line context">   ansible.builtin.uri:</span><span class="diff-line del">-    url: &quot;{{ authentik_host }}/api/v3/flows/instances/&quot;</span><span class="diff-line add">+    url: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_host&#x27;, role=&#x27;authentik&#x27;) }}/api/v3/flows/instances/&quot;</span><span class="diff-line context">     method: GET</span><span class="diff-line context">     headers:</span><span class="diff-line context">       Authorization: &quot;Bearer {{ authentik_admin_token }}&quot;</span><span class="diff-line hunk">@@ -129,7 +131,7 @@</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Create Traefik Forward Auth provider</span><span class="diff-line context">   ansible.builtin.uri:</span><span class="diff-line del">-    url: &quot;{{ authentik_host }}/api/v3/providers/proxy/&quot;</span><span class="diff-line add">+    url: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_host&#x27;, role=&#x27;authentik&#x27;) }}/api/v3/providers/proxy/&quot;</span><span class="diff-line context">     method: POST</span><span class="diff-line context">     body_format: json</span><span class="diff-line context">     headers:</span><span class="diff-line hunk">@@ -140,16 +142,16 @@</span><span class="diff-line context">       name: &quot;Traefik Forward Auth&quot;</span><span class="diff-line context">       authorization_flow: &quot;{{ authentik_authorization_flow_uuid }}&quot;</span><span class="diff-line context">       invalidation_flow: &quot;{{ authentik_invalidation_flow_uuid }}&quot;</span><span class="diff-line del">-      cookie_domain: &quot;{{ authentik_web_domain }}&quot;</span><span class="diff-line del">-      external_host: &quot;{{ authentik_web_url }}&quot;</span><span class="diff-line add">+      cookie_domain: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_web_domain&#x27;, role=&#x27;authentik&#x27;) }}&quot;</span><span class="diff-line add">+      external_host: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_web_url&#x27;, role=&#x27;authentik&#x27;) }}&quot;</span><span class="diff-line context">       mode: &quot;forward_domain&quot;</span><span class="diff-line del">-      access_token_validity: &quot;hours={{ authentik_access_token_validity }}&quot;</span><span class="diff-line add">+      access_token_validity: &quot;hours={{ lookup(&#x27;role_var&#x27;, &#x27;_access_token_validity&#x27;, role=&#x27;authentik&#x27;) }}&quot;</span><span class="diff-line context">     status_code: 201</span><span class="diff-line context">   register: proxy_providers</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Create Traefik Forward Auth application</span><span class="diff-line context">   ansible.builtin.uri:</span><span class="diff-line del">-    url: &quot;{{ authentik_host }}/api/v3/core/applications/&quot;</span><span class="diff-line add">+    url: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_host&#x27;, role=&#x27;authentik&#x27;) }}/api/v3/core/applications/&quot;</span><span class="diff-line context">     method: POST</span><span class="diff-line context">     body_format: json</span><span class="diff-line context">     headers:</span><span class="diff-line hunk">@@ -165,7 +167,7 @@</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Retrieve Outposts</span><span class="diff-line context">   ansible.builtin.uri:</span><span class="diff-line del">-    url: &quot;{{ authentik_host }}/api/v3/outposts/instances/&quot;</span><span class="diff-line add">+    url: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_host&#x27;, role=&#x27;authentik&#x27;) }}/api/v3/outposts/instances/&quot;</span><span class="diff-line context">     method: GET</span><span class="diff-line context">     headers:</span><span class="diff-line context">       Authorization: &quot;Bearer {{ authentik_admin_token }}&quot;</span><span class="diff-line hunk">@@ -175,7 +177,7 @@</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Edit Embedded Outpost</span><span class="diff-line context">   ansible.builtin.uri:</span><span class="diff-line del">-    url: &quot;{{ authentik_host }}/api/v3/outposts/instances/{{ outposts.json.results[0].pk }}/&quot;</span><span class="diff-line add">+    url: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_host&#x27;, role=&#x27;authentik&#x27;) }}/api/v3/outposts/instances/{{ outposts.json.results[0].pk }}/&quot;</span><span class="diff-line context">     method: PATCH</span><span class="diff-line context">     body_format: json</span><span class="diff-line context">     headers:</span><span class="diff-line hunk">@@ -186,12 +188,12 @@</span><span class="diff-line context">       providers:</span><span class="diff-line context">         - &quot;{{ proxy_providers.json.pk }}&quot;</span><span class="diff-line context">       config:</span><span class="diff-line del">-        authentik_host: &quot;{{ authentik_web_url }}&quot;</span><span class="diff-line add">+        authentik_host: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_web_url&#x27;, role=&#x27;authentik&#x27;) }}&quot;</span><span class="diff-line context">     status_code: 200</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Get admins group ID</span><span class="diff-line context">   ansible.builtin.uri:</span><span class="diff-line del">-    url: &quot;{{ authentik_host }}/api/v3/core/groups/?name=admins&quot;</span><span class="diff-line add">+    url: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_host&#x27;, role=&#x27;authentik&#x27;) }}/api/v3/core/groups/?name=admins&quot;</span><span class="diff-line context">     method: GET</span><span class="diff-line context">     headers:</span><span class="diff-line context">       Authorization: &quot;Bearer {{ authentik_admin_token }}&quot;</span><span class="diff-line hunk">@@ -202,7 +204,7 @@</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Get all notification rules</span><span class="diff-line context">   ansible.builtin.uri:</span><span class="diff-line del">-    url: &quot;{{ authentik_host }}/api/v3/events/rules/&quot;</span><span class="diff-line add">+    url: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_host&#x27;, role=&#x27;authentik&#x27;) }}/api/v3/events/rules/&quot;</span><span class="diff-line context">     method: GET</span><span class="diff-line context">     headers:</span><span class="diff-line context">       Authorization: &quot;Bearer {{ authentik_admin_token }}&quot;</span><span class="diff-line hunk">@@ -213,7 +215,7 @@</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Update notification rules with admins group</span><span class="diff-line context">   ansible.builtin.uri:</span><span class="diff-line del">-    url: &quot;{{ authentik_host }}/api/v3/events/rules/{{ item.pk }}/&quot;</span><span class="diff-line add">+    url: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_host&#x27;, role=&#x27;authentik&#x27;) }}/api/v3/events/rules/{{ item.pk }}/&quot;</span><span class="diff-line context">     method: PATCH</span><span class="diff-line context">     body_format: json</span><span class="diff-line context">     headers:</span><span class="diff-line hunk">@@ -233,9 +235,10 @@</span><span class="diff-line context">     - &quot;authentik&quot;</span><span class="diff-line context">     - &quot;authentik-worker&quot;</span><span class="diff-line context"> </span><span class="diff-line del">-- name: Check if &#x27;{{ authentik_paths_location }}&#x27; exists</span><span class="diff-line add">+# To ensure bootstrap token is no longer set</span><span class="diff-line add">+- name: Check if &#x27;{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_location&#x27;, role=&#x27;authentik&#x27;) }}&#x27; exists</span><span class="diff-line context">   ansible.builtin.stat:</span><span class="diff-line del">-    path: &quot;{{ authentik_paths_location }}&quot;</span><span class="diff-line add">+    path: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_location&#x27;, role=&#x27;authentik&#x27;) }}&quot;</span><span class="diff-line context">   register: authentik_data_folder</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Create Docker container</span><span class="diff-line hunk">@@ -247,7 +250,7 @@</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Validate Saltbox token (retry until Authentik is ready)</span><span class="diff-line context">   ansible.builtin.uri:</span><span class="diff-line del">-    url: &quot;{{ authentik_host }}/api/v3/core/users/me/&quot;</span><span class="diff-line add">+    url: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_host&#x27;, role=&#x27;authentik&#x27;) }}/api/v3/core/users/me/&quot;</span><span class="diff-line context">     method: GET</span><span class="diff-line context">     headers:</span><span class="diff-line context">       Authorization: &quot;Bearer {{ authentik_admin_token }}&quot;</span><span class="diff-line hunk">@@ -258,7 +261,7 @@</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Delete authentik-bootstrap-token</span><span class="diff-line context">   ansible.builtin.uri:</span><span class="diff-line del">-    url: &quot;{{ authentik_host }}/api/v3/core/tokens/authentik-bootstrap-token/&quot;</span><span class="diff-line add">+    url: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_host&#x27;, role=&#x27;authentik&#x27;) }}/api/v3/core/tokens/authentik-bootstrap-token/&quot;</span><span class="diff-line context">     method: DELETE</span><span class="diff-line context">     headers:</span><span class="diff-line context">       Authorization: &quot;Bearer {{ authentik_admin_token }}&quot;</span><span class="diff-line hunk">@@ -267,7 +270,7 @@</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Get Users</span><span class="diff-line context">   ansible.builtin.uri:</span><span class="diff-line del">-    url: &quot;{{ authentik_host }}/api/v3/core/users/&quot;</span><span class="diff-line add">+    url: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_host&#x27;, role=&#x27;authentik&#x27;) }}/api/v3/core/users/&quot;</span><span class="diff-line context">     method: GET</span><span class="diff-line context">     headers:</span><span class="diff-line context">       Authorization: &quot;Bearer {{ authentik_admin_token }}&quot;</span><span class="diff-line hunk">@@ -275,15 +278,15 @@</span><span class="diff-line context">     status_code: 200</span><span class="diff-line context">   register: get_users_response</span><span class="diff-line context"> </span><span class="diff-line del">-- name: fact</span><span class="diff-line add">+- name: Set fact</span><span class="diff-line context">   ansible.builtin.set_fact:</span><span class="diff-line context">     akadmin_id: &quot;{{ item.pk }}&quot;</span><span class="diff-line context">   loop: &quot;{{ get_users_response.json.results }}&quot;</span><span class="diff-line del">-  when: item.username == authentik_default_user</span><span class="diff-line add">+  when: item.username == authentik_role_default_user</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Disable akadmin user</span><span class="diff-line context">   ansible.builtin.uri:</span><span class="diff-line del">-    url: &quot;{{ authentik_host }}/api/v3/core/users/{{ akadmin_id }}/&quot;</span><span class="diff-line add">+    url: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_host&#x27;, role=&#x27;authentik&#x27;) }}/api/v3/core/users/{{ akadmin_id }}/&quot;</span><span class="diff-line context">     method: PATCH</span><span class="diff-line context">     body_format: json</span><span class="diff-line context">     headers:</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-114">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/authentik_worker/defaults/main.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -18,95 +18,58 @@</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line context"> # Container</span><span class="diff-line del">-authentik_worker_docker_container: &quot;{{ authentik_worker_name }}&quot;</span><span class="diff-line add">+authentik_worker_role_docker_container: &quot;{{ authentik_worker_name }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Image</span><span class="diff-line del">-authentik_worker_docker_image_pull: true</span><span class="diff-line del">-authentik_worker_docker_image_tag: &quot;{{ authentik_docker_image_tag }}&quot;</span><span class="diff-line del">-authentik_worker_docker_image: &quot;ghcr.io/goauthentik/server:{{ authentik_worker_docker_image_tag }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Ports</span><span class="diff-line del">-authentik_worker_docker_ports_defaults: []</span><span class="diff-line del">-authentik_worker_docker_ports_custom: []</span><span class="diff-line del">-authentik_worker_docker_ports: &quot;{{ authentik_worker_docker_ports_defaults</span><span class="diff-line del">-                                   + authentik_worker_docker_ports_custom }}&quot;</span><span class="diff-line add">+authentik_worker_role_docker_image_pull: true</span><span class="diff-line add">+authentik_worker_role_docker_image_repo: &quot;ghcr.io/goauthentik/server&quot;</span><span class="diff-line add">+authentik_worker_role_docker_image_tag: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_image_tag&#x27;, role=&#x27;authentik&#x27;) }}&quot;</span><span class="diff-line add">+authentik_worker_role_docker_image: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_image_repo&#x27;, role=&#x27;authentik_worker&#x27;) }}:{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_image_tag&#x27;, role=&#x27;authentik_worker&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Envs</span><span class="diff-line del">-authentik_worker_docker_envs_default: &quot;{{ authentik_docker_envs_default }}&quot;</span><span class="diff-line del">-authentik_worker_docker_envs_custom: {}</span><span class="diff-line del">-authentik_worker_docker_envs: &quot;{{ authentik_worker_docker_envs_default</span><span class="diff-line del">-                                  | combine(authentik_worker_docker_envs_custom) }}&quot;</span><span class="diff-line add">+authentik_worker_role_docker_envs_default: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_envs_default&#x27;, role=&#x27;authentik&#x27;) }}&quot;</span><span class="diff-line add">+authentik_worker_role_docker_envs_custom: {}</span><span class="diff-line add">+authentik_worker_role_docker_envs: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_envs_default&#x27;, role=&#x27;authentik_worker&#x27;)</span><span class="diff-line add">+                                       | combine(lookup(&#x27;role_var&#x27;, &#x27;_docker_envs_custom&#x27;, role=&#x27;authentik_worker&#x27;)) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Commands</span><span class="diff-line del">-authentik_worker_docker_commands_default:</span><span class="diff-line add">+authentik_worker_role_docker_commands_default:</span><span class="diff-line context">   - &quot;worker&quot;</span><span class="diff-line del">-authentik_worker_docker_commands_custom: []</span><span class="diff-line del">-authentik_worker_docker_commands: &quot;{{ authentik_worker_docker_commands_default</span><span class="diff-line del">-                                      + authentik_worker_docker_commands_custom }}&quot;</span><span class="diff-line add">+authentik_worker_role_docker_commands_custom: []</span><span class="diff-line add">+authentik_worker_role_docker_commands: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_commands_default&#x27;, role=&#x27;authentik_worker&#x27;)</span><span class="diff-line add">+                                           + lookup(&#x27;role_var&#x27;, &#x27;_docker_commands_custom&#x27;, role=&#x27;authentik_worker&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Volumes</span><span class="diff-line del">-authentik_worker_docker_volumes_default:</span><span class="diff-line del">-  - &quot;{{ server_appdata_path }}/authentik/media:/media&quot;</span><span class="diff-line del">-  - &quot;{{ server_appdata_path }}/authentik/custom-templates:/templates&quot;</span><span class="diff-line del">-  - &quot;{{ server_appdata_path }}/authentik/certs:/certs&quot;</span><span class="diff-line add">+authentik_worker_role_docker_volumes_default:</span><span class="diff-line add">+  - &quot;{{ authentik_role_paths_location }}/media:/media&quot;</span><span class="diff-line add">+  - &quot;{{ authentik_role_paths_location }}/custom-templates:/templates&quot;</span><span class="diff-line add">+  - &quot;{{ authentik_role_paths_location }}/certs:/certs&quot;</span><span class="diff-line context">   - &quot;/var/run/docker.sock:/var/run/docker.sock&quot;</span><span class="diff-line del">-authentik_worker_docker_volumes_custom: []</span><span class="diff-line del">-authentik_worker_docker_volumes: &quot;{{ authentik_worker_docker_volumes_default</span><span class="diff-line del">-                                     + authentik_worker_docker_volumes_custom }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Devices</span><span class="diff-line del">-authentik_worker_docker_devices_default: []</span><span class="diff-line del">-authentik_worker_docker_devices_custom: []</span><span class="diff-line del">-authentik_worker_docker_devices: &quot;{{ authentik_worker_docker_devices_default</span><span class="diff-line del">-                                     + authentik_worker_docker_devices_custom }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Hosts</span><span class="diff-line del">-authentik_worker_docker_hosts_default: {}</span><span class="diff-line del">-authentik_worker_docker_hosts_custom: {}</span><span class="diff-line del">-authentik_worker_docker_hosts: &quot;{{ docker_hosts_common</span><span class="diff-line del">-                                   | combine(authentik_worker_docker_hosts_default)</span><span class="diff-line del">-                                   | combine(authentik_worker_docker_hosts_custom) }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Labels</span><span class="diff-line del">-authentik_worker_docker_labels_default: {}</span><span class="diff-line del">-authentik_worker_docker_labels_custom: {}</span><span class="diff-line del">-authentik_worker_docker_labels: &quot;{{ docker_labels_common</span><span class="diff-line del">-                                    | combine(authentik_worker_docker_labels_default)</span><span class="diff-line del">-                                    | combine(authentik_worker_docker_labels_custom) }}&quot;</span><span class="diff-line add">+authentik_worker_role_docker_volumes_custom: []</span><span class="diff-line add">+authentik_worker_role_docker_volumes: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_volumes_default&#x27;, role=&#x27;authentik_worker&#x27;)</span><span class="diff-line add">+                                          + lookup(&#x27;role_var&#x27;, &#x27;_docker_volumes_custom&#x27;, role=&#x27;authentik_worker&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Hostname</span><span class="diff-line del">-authentik_worker_docker_hostname: &quot;{{ authentik_worker_name }}&quot;</span><span class="diff-line add">+authentik_worker_role_docker_hostname: &quot;{{ authentik_worker_name }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Networks</span><span class="diff-line del">-authentik_worker_docker_networks_alias: &quot;{{ authentik_worker_name }}&quot;</span><span class="diff-line del">-authentik_worker_docker_networks_default: []</span><span class="diff-line del">-authentik_worker_docker_networks_custom: []</span><span class="diff-line del">-authentik_worker_docker_networks: &quot;{{ docker_networks_common</span><span class="diff-line del">-                                      + authentik_worker_docker_networks_default</span><span class="diff-line del">-                                      + authentik_worker_docker_networks_custom }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Capabilities</span><span class="diff-line del">-authentik_worker_docker_capabilities_default: []</span><span class="diff-line del">-authentik_worker_docker_capabilities_custom: []</span><span class="diff-line del">-authentik_worker_docker_capabilities: &quot;{{ authentik_worker_docker_capabilities_default</span><span class="diff-line del">-                                          + authentik_worker_docker_capabilities_custom }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Security Opts</span><span class="diff-line del">-authentik_worker_docker_security_opts_default: []</span><span class="diff-line del">-authentik_worker_docker_security_opts_custom: []</span><span class="diff-line del">-authentik_worker_docker_security_opts: &quot;{{ authentik_worker_docker_security_opts_default</span><span class="diff-line del">-                                           + authentik_worker_docker_security_opts_custom }}&quot;</span><span class="diff-line add">+authentik_worker_role_docker_networks_alias: &quot;{{ authentik_worker_name }}&quot;</span><span class="diff-line add">+authentik_worker_role_docker_networks_default: []</span><span class="diff-line add">+authentik_worker_role_docker_networks_custom: []</span><span class="diff-line add">+authentik_worker_role_docker_networks: &quot;{{ docker_networks_common</span><span class="diff-line add">+                                           + lookup(&#x27;role_var&#x27;, &#x27;_docker_networks_default&#x27;, role=&#x27;authentik_worker&#x27;)</span><span class="diff-line add">+                                           + lookup(&#x27;role_var&#x27;, &#x27;_docker_networks_custom&#x27;, role=&#x27;authentik_worker&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Restart Policy</span><span class="diff-line del">-authentik_worker_docker_restart_policy: unless-stopped</span><span class="diff-line add">+authentik_worker_role_docker_restart_policy: unless-stopped</span><span class="diff-line context"> </span><span class="diff-line context"> # State</span><span class="diff-line del">-authentik_worker_docker_state: started</span><span class="diff-line add">+authentik_worker_role_docker_state: started</span><span class="diff-line context"> </span><span class="diff-line context"> # Dependencies</span><span class="diff-line del">-authentik_worker_depends_on: &quot;authentik-redis,authentik-postgres&quot;</span><span class="diff-line del">-authentik_worker_depends_on_delay: &quot;0&quot;</span><span class="diff-line del">-authentik_worker_depends_on_healthchecks: &quot;false&quot;</span><span class="diff-line add">+authentik_worker_role_depends_on: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_postgres_name&#x27;, role=&#x27;authentik&#x27;) }}&quot;</span><span class="diff-line add">+authentik_worker_role_depends_on_delay: &quot;0&quot;</span><span class="diff-line add">+authentik_worker_role_depends_on_healthchecks: &quot;true&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # User</span><span class="diff-line del">-authentik_worker_docker_user: &quot;root&quot;</span><span class="diff-line add">+authentik_worker_role_docker_user: &quot;root&quot;</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-115">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/autobrr/defaults/main.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -17,128 +17,86 @@</span><span class="diff-line context"> # Paths</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-autobrr_paths_folder: &quot;{{ autobrr_name }}&quot;</span><span class="diff-line del">-autobrr_paths_location: &quot;{{ server_appdata_path }}/{{ autobrr_paths_folder }}&quot;</span><span class="diff-line del">-autobrr_paths_config_location: &quot;{{ autobrr_paths_location }}/config.toml&quot;</span><span class="diff-line del">-autobrr_paths_folders_list:</span><span class="diff-line del">-  - &quot;{{ autobrr_paths_location }}&quot;</span><span class="diff-line add">+autobrr_role_paths_folder: &quot;{{ autobrr_name }}&quot;</span><span class="diff-line add">+autobrr_role_paths_location: &quot;{{ server_appdata_path }}/{{ autobrr_role_paths_folder }}&quot;</span><span class="diff-line add">+autobrr_role_paths_config_location: &quot;{{ autobrr_role_paths_location }}/config.toml&quot;</span><span class="diff-line add">+autobrr_role_paths_folders_list:</span><span class="diff-line add">+  - &quot;{{ autobrr_role_paths_location }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # Web</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-autobrr_web_subdomain: &quot;{{ autobrr_name }}&quot;</span><span class="diff-line del">-autobrr_web_domain: &quot;{{ user.domain }}&quot;</span><span class="diff-line del">-autobrr_web_port: &quot;7474&quot;</span><span class="diff-line del">-autobrr_web_url: &quot;{{ &#x27;https://&#x27; + (autobrr_web_subdomain + &#x27;.&#x27; + autobrr_web_domain</span><span class="diff-line del">-                  if (autobrr_web_subdomain | length &gt; 0)</span><span class="diff-line del">-                  else autobrr_web_domain) }}&quot;</span><span class="diff-line add">+autobrr_role_web_subdomain: &quot;{{ autobrr_name }}&quot;</span><span class="diff-line add">+autobrr_role_web_domain: &quot;{{ user.domain }}&quot;</span><span class="diff-line add">+autobrr_role_web_port: &quot;7474&quot;</span><span class="diff-line add">+autobrr_role_web_url: &quot;{{ &#x27;https://&#x27; + (lookup(&#x27;role_var&#x27;, &#x27;_web_subdomain&#x27;, role=&#x27;autobrr&#x27;) + &#x27;.&#x27; + lookup(&#x27;role_var&#x27;, &#x27;_web_domain&#x27;, role=&#x27;autobrr&#x27;)</span><span class="diff-line add">+                       if (lookup(&#x27;role_var&#x27;, &#x27;_web_subdomain&#x27;, role=&#x27;autobrr&#x27;) | length &gt; 0)</span><span class="diff-line add">+                       else lookup(&#x27;role_var&#x27;, &#x27;_web_domain&#x27;, role=&#x27;autobrr&#x27;)) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # DNS</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-autobrr_dns_record: &quot;{{ autobrr_web_subdomain }}&quot;</span><span class="diff-line del">-autobrr_dns_zone: &quot;{{ autobrr_web_domain }}&quot;</span><span class="diff-line del">-autobrr_dns_proxy: &quot;{{ dns.proxied }}&quot;</span><span class="diff-line add">+autobrr_role_dns_record: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_web_subdomain&#x27;, role=&#x27;autobrr&#x27;) }}&quot;</span><span class="diff-line add">+autobrr_role_dns_zone: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_web_domain&#x27;, role=&#x27;autobrr&#x27;) }}&quot;</span><span class="diff-line add">+autobrr_role_dns_proxy: &quot;{{ dns_proxied }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # Traefik</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-autobrr_traefik_sso_middleware: &quot;{{ traefik_default_sso_middleware }}&quot;</span><span class="diff-line del">-autobrr_traefik_middleware_default: &quot;{{ traefik_default_middleware }}&quot;</span><span class="diff-line del">-autobrr_traefik_middleware_custom: &quot;&quot;</span><span class="diff-line del">-autobrr_traefik_certresolver: &quot;{{ traefik_default_certresolver }}&quot;</span><span class="diff-line del">-autobrr_traefik_enabled: true</span><span class="diff-line del">-autobrr_traefik_api_enabled: true</span><span class="diff-line del">-autobrr_traefik_api_endpoint: &quot;PathPrefix(`/api`)&quot;</span><span class="diff-line add">+autobrr_role_traefik_sso_middleware: &quot;{{ traefik_default_sso_middleware }}&quot;</span><span class="diff-line add">+autobrr_role_traefik_middleware_default: &quot;{{ traefik_default_middleware }}&quot;</span><span class="diff-line add">+autobrr_role_traefik_middleware_custom: &quot;&quot;</span><span class="diff-line add">+autobrr_role_traefik_certresolver: &quot;{{ traefik_default_certresolver }}&quot;</span><span class="diff-line add">+autobrr_role_traefik_enabled: true</span><span class="diff-line add">+autobrr_role_traefik_api_enabled: true</span><span class="diff-line add">+autobrr_role_traefik_api_endpoint: &quot;PathPrefix(`/api`)&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # Docker</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line context"> # Container</span><span class="diff-line del">-autobrr_docker_container: &quot;{{ autobrr_name }}&quot;</span><span class="diff-line add">+autobrr_role_docker_container: &quot;{{ autobrr_name }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Image</span><span class="diff-line del">-autobrr_docker_image_pull: true</span><span class="diff-line del">-autobrr_docker_image_tag: &quot;latest&quot;</span><span class="diff-line del">-autobrr_docker_image: &quot;ghcr.io/autobrr/autobrr:{{ autobrr_docker_image_tag }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Ports</span><span class="diff-line del">-autobrr_docker_ports_defaults: []</span><span class="diff-line del">-autobrr_docker_ports_custom: []</span><span class="diff-line del">-autobrr_docker_ports: &quot;{{ autobrr_docker_ports_defaults</span><span class="diff-line del">-                          + autobrr_docker_ports_custom }}&quot;</span><span class="diff-line add">+autobrr_role_docker_image_pull: true</span><span class="diff-line add">+autobrr_role_docker_image_repo: &quot;ghcr.io/autobrr/autobrr&quot;</span><span class="diff-line add">+autobrr_role_docker_image_tag: &quot;latest&quot;</span><span class="diff-line add">+autobrr_role_docker_image: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_image_repo&#x27;, role=&#x27;autobrr&#x27;) }}:{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_image_tag&#x27;, role=&#x27;autobrr&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Envs</span><span class="diff-line del">-autobrr_docker_envs_default:</span><span class="diff-line add">+autobrr_role_docker_envs_default:</span><span class="diff-line add">+  AUTOBRR__LOG_PATH: &quot;/config/logs&quot;</span><span class="diff-line context">   PUID: &quot;{{ uid }}&quot;</span><span class="diff-line context">   PGID: &quot;{{ gid }}&quot;</span><span class="diff-line context">   TZ: &quot;{{ tz }}&quot;</span><span class="diff-line del">-autobrr_docker_envs_custom: {}</span><span class="diff-line del">-autobrr_docker_envs: &quot;{{ autobrr_docker_envs_default</span><span class="diff-line del">-                         | combine(autobrr_docker_envs_custom) }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Commands</span><span class="diff-line del">-autobrr_docker_commands_default: []</span><span class="diff-line del">-autobrr_docker_commands_custom: []</span><span class="diff-line del">-autobrr_docker_commands: &quot;{{ autobrr_docker_commands_default</span><span class="diff-line del">-                             + autobrr_docker_commands_custom }}&quot;</span><span class="diff-line add">+autobrr_role_docker_envs_custom: {}</span><span class="diff-line add">+autobrr_role_docker_envs: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_envs_default&#x27;, role=&#x27;autobrr&#x27;)</span><span class="diff-line add">+                              | combine(lookup(&#x27;role_var&#x27;, &#x27;_docker_envs_custom&#x27;, role=&#x27;autobrr&#x27;)) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Volumes</span><span class="diff-line del">-autobrr_docker_volumes_default:</span><span class="diff-line del">-  - &quot;{{ autobrr_paths_location }}:/config&quot;</span><span class="diff-line del">-autobrr_docker_volumes_custom: []</span><span class="diff-line del">-autobrr_docker_volumes: &quot;{{ autobrr_docker_volumes_default</span><span class="diff-line del">-                            + autobrr_docker_volumes_custom }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Devices</span><span class="diff-line del">-autobrr_docker_devices_default: []</span><span class="diff-line del">-autobrr_docker_devices_custom: []</span><span class="diff-line del">-autobrr_docker_devices: &quot;{{ autobrr_docker_devices_default</span><span class="diff-line del">-                            + autobrr_docker_devices_custom }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Hosts</span><span class="diff-line del">-autobrr_docker_hosts_default: {}</span><span class="diff-line del">-autobrr_docker_hosts_custom: {}</span><span class="diff-line del">-autobrr_docker_hosts: &quot;{{ docker_hosts_common</span><span class="diff-line del">-                          | combine(autobrr_docker_hosts_default)</span><span class="diff-line del">-                          | combine(autobrr_docker_hosts_custom) }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Labels</span><span class="diff-line del">-autobrr_docker_labels_default: {}</span><span class="diff-line del">-autobrr_docker_labels_custom: {}</span><span class="diff-line del">-autobrr_docker_labels: &quot;{{ docker_labels_common</span><span class="diff-line del">-                           | combine(autobrr_docker_labels_default)</span><span class="diff-line del">-                           | combine(autobrr_docker_labels_custom) }}&quot;</span><span class="diff-line add">+autobrr_role_docker_volumes_default:</span><span class="diff-line add">+  - &quot;{{ autobrr_role_paths_location }}:/config&quot;</span><span class="diff-line add">+autobrr_role_docker_volumes_custom: []</span><span class="diff-line add">+autobrr_role_docker_volumes: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_volumes_default&#x27;, role=&#x27;autobrr&#x27;)</span><span class="diff-line add">+                                 + lookup(&#x27;role_var&#x27;, &#x27;_docker_volumes_custom&#x27;, role=&#x27;autobrr&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Hostname</span><span class="diff-line del">-autobrr_docker_hostname: &quot;{{ autobrr_name }}&quot;</span><span class="diff-line add">+autobrr_role_docker_hostname: &quot;{{ autobrr_name }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Networks</span><span class="diff-line del">-autobrr_docker_networks_alias: &quot;{{ autobrr_name }}&quot;</span><span class="diff-line del">-autobrr_docker_networks_default: []</span><span class="diff-line del">-autobrr_docker_networks_custom: []</span><span class="diff-line del">-autobrr_docker_networks: &quot;{{ docker_networks_common</span><span class="diff-line del">-                             + autobrr_docker_networks_default</span><span class="diff-line del">-                             + autobrr_docker_networks_custom }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Capabilities</span><span class="diff-line del">-autobrr_docker_capabilities_default: []</span><span class="diff-line del">-autobrr_docker_capabilities_custom: []</span><span class="diff-line del">-autobrr_docker_capabilities: &quot;{{ autobrr_docker_capabilities_default</span><span class="diff-line del">-                                 + autobrr_docker_capabilities_custom }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Security Opts</span><span class="diff-line del">-autobrr_docker_security_opts_default: []</span><span class="diff-line del">-autobrr_docker_security_opts_custom: []</span><span class="diff-line del">-autobrr_docker_security_opts: &quot;{{ autobrr_docker_security_opts_default</span><span class="diff-line del">-                                  + autobrr_docker_security_opts_custom }}&quot;</span><span class="diff-line add">+autobrr_role_docker_networks_alias: &quot;{{ autobrr_name }}&quot;</span><span class="diff-line add">+autobrr_role_docker_networks_default: []</span><span class="diff-line add">+autobrr_role_docker_networks_custom: []</span><span class="diff-line add">+autobrr_role_docker_networks: &quot;{{ docker_networks_common</span><span class="diff-line add">+                                  + lookup(&#x27;role_var&#x27;, &#x27;_docker_networks_default&#x27;, role=&#x27;autobrr&#x27;)</span><span class="diff-line add">+                                  + lookup(&#x27;role_var&#x27;, &#x27;_docker_networks_custom&#x27;, role=&#x27;autobrr&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Restart Policy</span><span class="diff-line del">-autobrr_docker_restart_policy: unless-stopped</span><span class="diff-line add">+autobrr_role_docker_restart_policy: unless-stopped</span><span class="diff-line context"> </span><span class="diff-line context"> # State</span><span class="diff-line del">-autobrr_docker_state: started</span><span class="diff-line add">+autobrr_role_docker_state: started</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-116">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/autobrr/tasks/main.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -10,47 +10,26 @@</span><span class="diff-line context"> - name: Add DNS record</span><span class="diff-line context">   ansible.builtin.include_tasks: &quot;{{ resources_tasks_path }}/dns/tasker.yml&quot;</span><span class="diff-line context">   vars:</span><span class="diff-line del">-    dns_record: &quot;{{ lookup(&#x27;vars&#x27;, role_name + &#x27;_dns_record&#x27;) }}&quot;</span><span class="diff-line del">-    dns_zone: &quot;{{ lookup(&#x27;vars&#x27;, role_name + &#x27;_dns_zone&#x27;) }}&quot;</span><span class="diff-line del">-    dns_proxy: &quot;{{ lookup(&#x27;vars&#x27;, role_name + &#x27;_dns_proxy&#x27;) }}&quot;</span><span class="diff-line add">+    dns_record: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_dns_record&#x27;) }}&quot;</span><span class="diff-line add">+    dns_zone: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_dns_zone&#x27;) }}&quot;</span><span class="diff-line add">+    dns_proxy: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_dns_proxy&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Remove existing Docker container</span><span class="diff-line context">   ansible.builtin.include_tasks: &quot;{{ resources_tasks_path }}/docker/remove_docker_container.yml&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Check if already installed</span><span class="diff-line context">   ansible.builtin.stat:</span><span class="diff-line del">-    path: &quot;{{ autobrr_paths_location }}&quot;</span><span class="diff-line add">+    path: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_location&#x27;, role=&#x27;autobrr&#x27;) }}&quot;</span><span class="diff-line context">   register: autobrr_directory</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Create directories</span><span class="diff-line context">   ansible.builtin.include_tasks: &quot;{{ resources_tasks_path }}/directories/create_directories.yml&quot;</span><span class="diff-line context"> </span><span class="diff-line del">-- name: Check if `{{ autobrr_paths_config_location | basename }}` exists</span><span class="diff-line del">-  ansible.builtin.stat:</span><span class="diff-line del">-    path: &quot;{{ autobrr_paths_config_location }}&quot;</span><span class="diff-line del">-  register: autobrr_config</span><span class="diff-line del">-</span><span class="diff-line del">-- name: New `{{ autobrr_paths_config_location | basename }}` tasks</span><span class="diff-line del">-  when: not autobrr_config.stat.exists</span><span class="diff-line del">-  block:</span><span class="diff-line del">-    - name: Generate sessionSecret</span><span class="diff-line del">-      ansible.builtin.shell: &quot;head /dev/urandom | tr -dc A-Za-z0-9 | head -c16&quot;</span><span class="diff-line del">-      register: autobrr_secret</span><span class="diff-line del">-</span><span class="diff-line del">-    - name: Import default `{{ autobrr_paths_config_location | basename }}`</span><span class="diff-line del">-      ansible.builtin.template:</span><span class="diff-line del">-        src: config.toml.j2</span><span class="diff-line del">-        dest: &quot;{{ autobrr_paths_config_location }}&quot;</span><span class="diff-line del">-        owner: &quot;{{ user.name }}&quot;</span><span class="diff-line del">-        group: &quot;{{ user.name }}&quot;</span><span class="diff-line del">-        mode: &quot;0664&quot;</span><span class="diff-line del">-</span><span class="diff-line context"> - name: Create Docker container</span><span class="diff-line context">   ansible.builtin.include_tasks: &quot;{{ resources_tasks_path }}/docker/create_docker_container.yml&quot;</span><span class="diff-line context"> </span><span class="diff-line del">-- name: Advise user to create Autobrr user</span><span class="diff-line del">-  ansible.builtin.debug:</span><span class="diff-line del">-    msg:</span><span class="diff-line del">-      - &quot;Run the following to create your user:&quot;</span><span class="diff-line del">-      - &quot;docker exec -it {{ lookup(&#x27;vars&#x27;, role_name + &#x27;_name&#x27;) }} sh -c &#x27;autobrrctl --config /config create-user {{ user.name }}&#x27;&quot;</span><span class="diff-line del">-  when: not autobrr_directory.stat.exists</span><span class="diff-line add">+- name: Create Autobrr user</span><span class="diff-line add">+  ansible.builtin.shell: |</span><span class="diff-line add">+    docker exec -i {{ autobrr_name }} sh -c &#x27;echo &quot;{{ user.pass }}&quot; | autobrrctl --config /config create-user {{ user.name }}&#x27;</span><span class="diff-line add">+  no_log: true</span><span class="diff-line add">+  when: (not autobrr_directory.stat.exists)</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-117">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/autoheal/defaults/main.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -18,85 +18,41 @@</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line context"> # Container</span><span class="diff-line del">-autoheal_docker_container: &quot;{{ autoheal_name }}&quot;</span><span class="diff-line add">+autoheal_role_docker_container: &quot;{{ autoheal_name }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Image</span><span class="diff-line del">-autoheal_docker_image_pull: true</span><span class="diff-line del">-autoheal_docker_image_tag: &quot;latest&quot;</span><span class="diff-line del">-autoheal_docker_image: &quot;willfarrell/autoheal:{{ autoheal_docker_image_tag }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Ports</span><span class="diff-line del">-autoheal_docker_ports_defaults: []</span><span class="diff-line del">-autoheal_docker_ports_custom: []</span><span class="diff-line del">-autoheal_docker_ports: &quot;{{ autoheal_docker_ports_defaults</span><span class="diff-line del">-                           + autoheal_docker_ports_custom }}&quot;</span><span class="diff-line add">+autoheal_role_docker_image_pull: true</span><span class="diff-line add">+autoheal_role_docker_image_tag: &quot;latest&quot;</span><span class="diff-line add">+autoheal_role_docker_image: &quot;willfarrell/autoheal:{{ autoheal_role_docker_image_tag }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Envs</span><span class="diff-line del">-autoheal_docker_envs_default:</span><span class="diff-line add">+autoheal_role_docker_envs_default:</span><span class="diff-line context">   AUTOHEAL_CONTAINER_LABEL: &quot;autoheal&quot;</span><span class="diff-line del">-autoheal_docker_envs_custom: {}</span><span class="diff-line del">-autoheal_docker_envs: &quot;{{ autoheal_docker_envs_default</span><span class="diff-line del">-                          | combine(autoheal_docker_envs_custom) }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Commands</span><span class="diff-line del">-autoheal_docker_commands_default: []</span><span class="diff-line del">-autoheal_docker_commands_custom: []</span><span class="diff-line del">-autoheal_docker_commands: &quot;{{ autoheal_docker_commands_default</span><span class="diff-line del">-                              + autoheal_docker_commands_custom }}&quot;</span><span class="diff-line add">+autoheal_role_docker_envs_custom: {}</span><span class="diff-line add">+autoheal_role_docker_envs: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_envs_default&#x27;, role=&#x27;autoheal&#x27;)</span><span class="diff-line add">+                               | combine(lookup(&#x27;role_var&#x27;, &#x27;_docker_envs_custom&#x27;, role=&#x27;autoheal&#x27;)) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Volumes</span><span class="diff-line del">-autoheal_docker_volumes_default:</span><span class="diff-line add">+autoheal_role_docker_volumes_default:</span><span class="diff-line context">   - &quot;/var/run/docker.sock:/var/run/docker.sock&quot;</span><span class="diff-line context">   - &quot;/etc/localtime:/etc/localtime:ro&quot;</span><span class="diff-line del">-autoheal_docker_volumes_custom: []</span><span class="diff-line del">-autoheal_docker_volumes: &quot;{{ autoheal_docker_volumes_default</span><span class="diff-line del">-                             + autoheal_docker_volumes_custom }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Devices</span><span class="diff-line del">-autoheal_docker_devices_default: []</span><span class="diff-line del">-autoheal_docker_devices_custom: []</span><span class="diff-line del">-autoheal_docker_devices: &quot;{{ autoheal_docker_devices_default</span><span class="diff-line del">-                             + autoheal_docker_devices_custom }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Hosts</span><span class="diff-line del">-autoheal_docker_hosts_default: {}</span><span class="diff-line del">-autoheal_docker_hosts_custom: {}</span><span class="diff-line del">-autoheal_docker_hosts: &quot;{{ docker_hosts_common</span><span class="diff-line del">-                           | combine(autoheal_docker_hosts_default)</span><span class="diff-line del">-                           | combine(autoheal_docker_hosts_custom) }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Labels</span><span class="diff-line del">-autoheal_docker_labels_default: {}</span><span class="diff-line del">-autoheal_docker_labels_custom: {}</span><span class="diff-line del">-autoheal_docker_labels: &quot;{{ docker_labels_common</span><span class="diff-line del">-                            | combine(autoheal_docker_labels_default)</span><span class="diff-line del">-                            | combine(autoheal_docker_labels_custom) }}&quot;</span><span class="diff-line add">+autoheal_role_docker_volumes_custom: []</span><span class="diff-line add">+autoheal_role_docker_volumes: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_volumes_default&#x27;, role=&#x27;autoheal&#x27;)</span><span class="diff-line add">+                                  + lookup(&#x27;role_var&#x27;, &#x27;_docker_volumes_custom&#x27;, role=&#x27;autoheal&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Hostname</span><span class="diff-line del">-autoheal_docker_hostname: &quot;{{ autoheal_name }}&quot;</span><span class="diff-line add">+autoheal_role_docker_hostname: &quot;{{ autoheal_name }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Networks</span><span class="diff-line del">-autoheal_docker_networks_alias: &quot;{{ autoheal_name }}&quot;</span><span class="diff-line del">-autoheal_docker_networks_default: []</span><span class="diff-line del">-autoheal_docker_networks_custom: []</span><span class="diff-line del">-autoheal_docker_networks: &quot;{{ docker_networks_common</span><span class="diff-line del">-                              + autoheal_docker_networks_default</span><span class="diff-line del">-                              + autoheal_docker_networks_custom }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Capabilities</span><span class="diff-line del">-autoheal_docker_capabilities_default: []</span><span class="diff-line del">-autoheal_docker_capabilities_custom: []</span><span class="diff-line del">-autoheal_docker_capabilities: &quot;{{ autoheal_docker_capabilities_default</span><span class="diff-line del">-                                  + autoheal_docker_capabilities_custom }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Security Opts</span><span class="diff-line del">-autoheal_docker_security_opts_default: []</span><span class="diff-line del">-autoheal_docker_security_opts_custom: []</span><span class="diff-line del">-autoheal_docker_security_opts: &quot;{{ autoheal_docker_security_opts_default</span><span class="diff-line del">-                                   + autoheal_docker_security_opts_custom }}&quot;</span><span class="diff-line add">+autoheal_role_docker_networks_alias: &quot;{{ autoheal_name }}&quot;</span><span class="diff-line add">+autoheal_role_docker_networks_default: []</span><span class="diff-line add">+autoheal_role_docker_networks_custom: []</span><span class="diff-line add">+autoheal_role_docker_networks: &quot;{{ docker_networks_common</span><span class="diff-line add">+                                   + lookup(&#x27;role_var&#x27;, &#x27;_docker_networks_default&#x27;, role=&#x27;autoheal&#x27;)</span><span class="diff-line add">+                                   + lookup(&#x27;role_var&#x27;, &#x27;_docker_networks_custom&#x27;, role=&#x27;autoheal&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Restart Policy</span><span class="diff-line del">-autoheal_docker_restart_policy: unless-stopped</span><span class="diff-line add">+autoheal_role_docker_restart_policy: unless-stopped</span><span class="diff-line context"> </span><span class="diff-line context"> # State</span><span class="diff-line del">-autoheal_docker_state: started</span><span class="diff-line add">+autoheal_role_docker_state: started</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-118">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/autoscan/defaults/main.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -17,142 +17,101 @@</span><span class="diff-line context"> # Paths</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-autoscan_paths_folder: &quot;{{ autoscan_name }}&quot;</span><span class="diff-line del">-autoscan_paths_location: &quot;{{ server_appdata_path }}/{{ autoscan_paths_folder }}&quot;</span><span class="diff-line del">-autoscan_paths_folders_list:</span><span class="diff-line del">-  - &quot;{{ autoscan_paths_location }}&quot;</span><span class="diff-line del">-autoscan_paths_config_location: &quot;{{ autoscan_paths_location }}/config.yml&quot;</span><span class="diff-line add">+autoscan_role_paths_folder: &quot;{{ autoscan_name }}&quot;</span><span class="diff-line add">+autoscan_role_paths_location: &quot;{{ server_appdata_path }}/{{ autoscan_role_paths_folder }}&quot;</span><span class="diff-line add">+autoscan_role_paths_folders_list:</span><span class="diff-line add">+  - &quot;{{ autoscan_role_paths_location }}&quot;</span><span class="diff-line add">+autoscan_role_paths_config_location: &quot;{{ autoscan_role_paths_location }}/config.yml&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # Web</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-autoscan_web_subdomain: &quot;{{ autoscan_name }}&quot;</span><span class="diff-line del">-autoscan_web_domain: &quot;{{ user.domain }}&quot;</span><span class="diff-line del">-autoscan_web_port: &quot;3030&quot;</span><span class="diff-line del">-autoscan_web_url: &quot;{{ &#x27;https://&#x27; + (lookup(&#x27;vars&#x27;, autoscan_name + &#x27;_web_subdomain&#x27;, default=autoscan_web_subdomain) + &#x27;.&#x27; + lookup(&#x27;vars&#x27;, autoscan_name + &#x27;_web_domain&#x27;, default=autoscan_web_domain)</span><span class="diff-line del">-                   if (lookup(&#x27;vars&#x27;, autoscan_name + &#x27;_web_subdomain&#x27;, default=autoscan_web_subdomain) | length &gt; 0)</span><span class="diff-line del">-                   else lookup(&#x27;vars&#x27;, autoscan_name + &#x27;_web_domain&#x27;, default=autoscan_web_domain)) }}&quot;</span><span class="diff-line add">+autoscan_role_web_subdomain: &quot;{{ autoscan_name }}&quot;</span><span class="diff-line add">+autoscan_role_web_domain: &quot;{{ user.domain }}&quot;</span><span class="diff-line add">+autoscan_role_web_port: &quot;3030&quot;</span><span class="diff-line add">+autoscan_role_web_url: &quot;{{ &#x27;https://&#x27; + (lookup(&#x27;role_var&#x27;, &#x27;_web_subdomain&#x27;, role=&#x27;autoscan&#x27;) + &#x27;.&#x27; + lookup(&#x27;role_var&#x27;, &#x27;_web_domain&#x27;, role=&#x27;autoscan&#x27;)</span><span class="diff-line add">+                        if (lookup(&#x27;role_var&#x27;, &#x27;_web_subdomain&#x27;, role=&#x27;autoscan&#x27;) | length &gt; 0)</span><span class="diff-line add">+                        else lookup(&#x27;role_var&#x27;, &#x27;_web_domain&#x27;, role=&#x27;autoscan&#x27;)) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # DNS</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-autoscan_dns_record: &quot;{{ lookup(&#x27;vars&#x27;, autoscan_name + &#x27;_web_subdomain&#x27;, default=autoscan_web_subdomain) }}&quot;</span><span class="diff-line del">-autoscan_dns_zone: &quot;{{ lookup(&#x27;vars&#x27;, autoscan_name + &#x27;_web_domain&#x27;, default=autoscan_web_domain) }}&quot;</span><span class="diff-line del">-autoscan_dns_proxy: &quot;{{ dns.proxied }}&quot;</span><span class="diff-line add">+autoscan_role_dns_record: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_web_subdomain&#x27;, role=&#x27;autoscan&#x27;) }}&quot;</span><span class="diff-line add">+autoscan_role_dns_zone: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_web_domain&#x27;, role=&#x27;autoscan&#x27;) }}&quot;</span><span class="diff-line add">+autoscan_role_dns_proxy: &quot;{{ dns_proxied }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # Traefik</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-autoscan_traefik_regex_middleware_string: &quot;,{{ autoscan_name }}-replacepathregex&quot;</span><span class="diff-line del">-autoscan_traefik_sso_middleware: &quot;&quot;</span><span class="diff-line del">-autoscan_traefik_middleware_default: &quot;{{ traefik_default_middleware + autoscan_traefik_regex_middleware_string }}&quot;</span><span class="diff-line del">-autoscan_traefik_middleware_custom: &quot;&quot;</span><span class="diff-line del">-autoscan_traefik_certresolver: &quot;{{ traefik_default_certresolver }}&quot;</span><span class="diff-line del">-autoscan_traefik_enabled: true</span><span class="diff-line del">-autoscan_traefik_api_enabled: false</span><span class="diff-line del">-autoscan_traefik_api_endpoint: &quot;&quot;</span><span class="diff-line add">+autoscan_role_traefik_regex_middleware_string: &quot;,{{ autoscan_name }}-replacepathregex&quot;</span><span class="diff-line add">+autoscan_role_traefik_sso_middleware: &quot;&quot;</span><span class="diff-line add">+autoscan_role_traefik_middleware_default: &quot;{{ traefik_default_middleware + autoscan_role_traefik_regex_middleware_string }}&quot;</span><span class="diff-line add">+autoscan_role_traefik_middleware_custom: &quot;&quot;</span><span class="diff-line add">+autoscan_role_traefik_certresolver: &quot;{{ traefik_default_certresolver }}&quot;</span><span class="diff-line add">+autoscan_role_traefik_enabled: true</span><span class="diff-line add">+autoscan_role_traefik_api_enabled: false</span><span class="diff-line add">+autoscan_role_traefik_api_endpoint: &quot;&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # Docker</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line context"> # Container</span><span class="diff-line del">-autoscan_docker_container: &quot;{{ autoscan_name }}&quot;</span><span class="diff-line add">+autoscan_role_docker_container: &quot;{{ autoscan_name }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Image</span><span class="diff-line del">-autoscan_docker_image_pull: true</span><span class="diff-line del">-autoscan_docker_image_tag: &quot;latest&quot;</span><span class="diff-line del">-autoscan_docker_image: &quot;saltydk/autoscan:{{ lookup(&#x27;vars&#x27;, autoscan_name + &#x27;_docker_image_tag&#x27;, default=autoscan_docker_image_tag) }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Ports</span><span class="diff-line del">-autoscan_docker_ports_defaults: []</span><span class="diff-line del">-autoscan_docker_ports_custom: []</span><span class="diff-line del">-autoscan_docker_ports: &quot;{{ lookup(&#x27;vars&#x27;, autoscan_name + &#x27;_docker_ports_defaults&#x27;, default=autoscan_docker_ports_defaults)</span><span class="diff-line del">-                           + lookup(&#x27;vars&#x27;, autoscan_name + &#x27;_docker_ports_custom&#x27;, default=autoscan_docker_ports_custom) }}&quot;</span><span class="diff-line add">+autoscan_role_docker_image_pull: true</span><span class="diff-line add">+autoscan_role_docker_image_repo: &quot;saltydk/autoscan&quot;</span><span class="diff-line add">+autoscan_role_docker_image_tag: &quot;latest&quot;</span><span class="diff-line add">+autoscan_role_docker_image: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_image_repo&#x27;, role=&#x27;autoscan&#x27;) }}:{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_image_tag&#x27;, role=&#x27;autoscan&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Envs</span><span class="diff-line del">-autoscan_docker_envs_default:</span><span class="diff-line add">+autoscan_role_docker_envs_default:</span><span class="diff-line context">   PUID: &quot;{{ uid }}&quot;</span><span class="diff-line context">   PGID: &quot;{{ gid }}&quot;</span><span class="diff-line context">   TZ: &quot;{{ tz }}&quot;</span><span class="diff-line del">-autoscan_docker_envs_custom: {}</span><span class="diff-line del">-autoscan_docker_envs: &quot;{{ lookup(&#x27;vars&#x27;, autoscan_name + &#x27;_docker_envs_default&#x27;, default=autoscan_docker_envs_default)</span><span class="diff-line del">-                          | combine(lookup(&#x27;vars&#x27;, autoscan_name + &#x27;_docker_envs_custom&#x27;, default=autoscan_docker_envs_custom)) }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Commands</span><span class="diff-line del">-autoscan_docker_commands_default: []</span><span class="diff-line del">-autoscan_docker_commands_custom: []</span><span class="diff-line del">-autoscan_docker_commands: &quot;{{ lookup(&#x27;vars&#x27;, autoscan_name + &#x27;_docker_commands_default&#x27;, default=autoscan_docker_commands_default)</span><span class="diff-line del">-                              + lookup(&#x27;vars&#x27;, autoscan_name + &#x27;_docker_commands_custom&#x27;, default=autoscan_docker_commands_custom) }}&quot;</span><span class="diff-line add">+autoscan_role_docker_envs_custom: {}</span><span class="diff-line add">+autoscan_role_docker_envs: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_envs_default&#x27;, role=&#x27;autoscan&#x27;)</span><span class="diff-line add">+                               | combine(lookup(&#x27;role_var&#x27;, &#x27;_docker_envs_custom&#x27;, role=&#x27;autoscan&#x27;)) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Volumes</span><span class="diff-line del">-autoscan_docker_volumes_default:</span><span class="diff-line del">-  - &quot;{{ autoscan_paths_location }}:/config&quot;</span><span class="diff-line del">-autoscan_docker_volumes_custom: []</span><span class="diff-line del">-autoscan_docker_volumes: &quot;{{ lookup(&#x27;vars&#x27;, autoscan_name + &#x27;_docker_volumes_default&#x27;, default=autoscan_docker_volumes_default)</span><span class="diff-line del">-                             + lookup(&#x27;vars&#x27;, autoscan_name + &#x27;_docker_volumes_custom&#x27;, default=autoscan_docker_volumes_custom) }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Devices</span><span class="diff-line del">-autoscan_docker_devices_default: []</span><span class="diff-line del">-autoscan_docker_devices_custom: []</span><span class="diff-line del">-autoscan_docker_devices: &quot;{{ lookup(&#x27;vars&#x27;, autoscan_name + &#x27;_docker_devices_default&#x27;, default=autoscan_docker_devices_default)</span><span class="diff-line del">-                             + lookup(&#x27;vars&#x27;, autoscan_name + &#x27;_docker_devices_custom&#x27;, default=autoscan_docker_devices_custom) }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Hosts</span><span class="diff-line del">-autoscan_docker_hosts_default: {}</span><span class="diff-line del">-autoscan_docker_hosts_custom: {}</span><span class="diff-line del">-autoscan_docker_hosts: &quot;{{ docker_hosts_common</span><span class="diff-line del">-                           | combine(lookup(&#x27;vars&#x27;, autoscan_name + &#x27;_docker_hosts_default&#x27;, default=autoscan_docker_hosts_default))</span><span class="diff-line del">-                           | combine(lookup(&#x27;vars&#x27;, autoscan_name + &#x27;_docker_hosts_custom&#x27;, default=autoscan_docker_hosts_custom)) }}&quot;</span><span class="diff-line add">+autoscan_role_docker_volumes_default:</span><span class="diff-line add">+  - &quot;{{ autoscan_role_paths_location }}:/config&quot;</span><span class="diff-line add">+autoscan_role_docker_volumes_custom: []</span><span class="diff-line add">+autoscan_role_docker_volumes: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_volumes_default&#x27;, role=&#x27;autoscan&#x27;)</span><span class="diff-line add">+                                  + lookup(&#x27;role_var&#x27;, &#x27;_docker_volumes_custom&#x27;, role=&#x27;autoscan&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Labels</span><span class="diff-line del">-autoscan_docker_labels_default:</span><span class="diff-line add">+autoscan_role_docker_labels_default:</span><span class="diff-line context">   - &#x27;{ &quot;traefik.http.middlewares.{{ traefik_router }}-replacepathregex.replacepathregex.regex&quot;: &quot;^/$&quot; }&#x27;</span><span class="diff-line context">   - &#x27;{ &quot;traefik.http.middlewares.{{ traefik_router }}-replacepathregex.replacepathregex.replacement&quot;: &quot;/triggers/manual&quot; }&#x27;</span><span class="diff-line context">   - &#x27;{ &quot;traefik.http.routers.{{ traefik_router }}-triggers.entrypoints&quot;: &quot;{{ traefik_entrypoint_websecure }}&quot; }&#x27;</span><span class="diff-line context">   - &#x27;{ &quot;traefik.http.routers.{{ traefik_router }}-triggers.service&quot;: &quot;{{ traefik_router }}&quot; }&#x27;</span><span class="diff-line context">   - &#x27;{ &quot;traefik.http.routers.{{ traefik_router }}-triggers.rule&quot;: &quot;Host(`{{ traefik_host }}`) &amp;&amp; PathPrefix(`/triggers`)&quot; }&#x27;</span><span class="diff-line del">-  - &#x27;{ &quot;traefik.http.routers.{{ traefik_router }}-triggers.priority&quot;: &quot;{{ lookup(&quot;vars&quot;, traefik_role_var + &quot;_traefik_priority&quot;, default=lookup(&quot;vars&quot;, role_name + &quot;_traefik_priority&quot;, default=&quot;40&quot;)) }}&quot; }&#x27;</span><span class="diff-line del">-  - &#x27;{ &quot;traefik.http.routers.{{ traefik_router }}-triggers.tls.certresolver&quot;: &quot;{{ lookup(&quot;vars&quot;, traefik_role_var + &quot;_traefik_certresolver&quot;, default=lookup(&quot;vars&quot;, role_name + &quot;_traefik_certresolver&quot;, default=traefik_default_certresolver)) }}&quot; }&#x27;</span><span class="diff-line add">+  - &#x27;{ &quot;traefik.http.routers.{{ traefik_router }}-triggers.priority&quot;: &quot;{{ lookup(&quot;role_var&quot;, &quot;_traefik_priority&quot;, role=&quot;autoscan&quot;, default=&quot;40&quot;) }}&quot; }&#x27;</span><span class="diff-line add">+  - &#x27;{ &quot;traefik.http.routers.{{ traefik_router }}-triggers.tls.certresolver&quot;: &quot;{{ lookup(&quot;role_var&quot;, &quot;_traefik_certresolver&quot;, role=&quot;autoscan&quot;, default=traefik_default_certresolver) }}&quot; }&#x27;</span><span class="diff-line context">   - &#x27;{ &quot;traefik.http.routers.{{ traefik_router }}-triggers.tls.options&quot;: &quot;securetls@file&quot; }&#x27;</span><span class="diff-line del">-  - &#x27;{ &quot;traefik.http.routers.{{ traefik_router }}-triggers.middlewares&quot;: &quot;{{ traefik_middleware | regex_replace(autoscan_traefik_regex_middleware_string) }}&quot; }&#x27;</span><span class="diff-line del">-autoscan_docker_labels_custom: {}</span><span class="diff-line del">-autoscan_docker_labels: &quot;{{ docker_labels_common</span><span class="diff-line del">-                            | combine(lookup(&#x27;vars&#x27;, autoscan_name + &#x27;_docker_labels_default&#x27;, default=autoscan_docker_labels_default))</span><span class="diff-line del">-                            | combine(lookup(&#x27;vars&#x27;, autoscan_name + &#x27;_docker_labels_custom&#x27;, default=autoscan_docker_labels_custom)) }}&quot;</span><span class="diff-line add">+  - &#x27;{ &quot;traefik.http.routers.{{ traefik_router }}-triggers.middlewares&quot;: &quot;{{ traefik_middleware | regex_replace(autoscan_role_traefik_regex_middleware_string) }}&quot; }&#x27;</span><span class="diff-line add">+autoscan_role_docker_labels_custom: {}</span><span class="diff-line add">+autoscan_role_docker_labels: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_labels_default&#x27;, role=&#x27;autoscan&#x27;)</span><span class="diff-line add">+                                 | combine(lookup(&#x27;role_var&#x27;, &#x27;_docker_labels_custom&#x27;, role=&#x27;autoscan&#x27;)) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Hostname</span><span class="diff-line del">-autoscan_docker_hostname: &quot;{{ autoscan_name }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Network Mode</span><span class="diff-line del">-autoscan_docker_network_mode_default: &quot;{{ docker_networks_name_common }}&quot;</span><span class="diff-line del">-autoscan_docker_network_mode: &quot;{{ lookup(&#x27;vars&#x27;, autoscan_name + &#x27;_docker_network_mode_default&#x27;, default=autoscan_docker_network_mode_default) }}&quot;</span><span class="diff-line add">+autoscan_role_docker_hostname: &quot;{{ autoscan_name }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Networks</span><span class="diff-line del">-autoscan_docker_networks_alias: &quot;{{ autoscan_name }}&quot;</span><span class="diff-line del">-autoscan_docker_networks_default: []</span><span class="diff-line del">-autoscan_docker_networks_custom: []</span><span class="diff-line del">-autoscan_docker_networks: &quot;{{ docker_networks_common</span><span class="diff-line del">-                              + lookup(&#x27;vars&#x27;, autoscan_name + &#x27;_docker_networks_default&#x27;, default=autoscan_docker_networks_default)</span><span class="diff-line del">-                              + lookup(&#x27;vars&#x27;, autoscan_name + &#x27;_docker_networks_custom&#x27;, default=autoscan_docker_networks_custom) }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Capabilities</span><span class="diff-line del">-autoscan_docker_capabilities_default: []</span><span class="diff-line del">-autoscan_docker_capabilities_custom: []</span><span class="diff-line del">-autoscan_docker_capabilities: &quot;{{ lookup(&#x27;vars&#x27;, autoscan_name + &#x27;_docker_capabilities_default&#x27;, default=autoscan_docker_capabilities_default)</span><span class="diff-line del">-                                  + lookup(&#x27;vars&#x27;, autoscan_name + &#x27;_docker_capabilities_custom&#x27;, default=autoscan_docker_capabilities_custom) }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Security Opts</span><span class="diff-line del">-autoscan_docker_security_opts_default: []</span><span class="diff-line del">-autoscan_docker_security_opts_custom: []</span><span class="diff-line del">-autoscan_docker_security_opts: &quot;{{ lookup(&#x27;vars&#x27;, autoscan_name + &#x27;_docker_security_opts_default&#x27;, default=autoscan_docker_security_opts_default)</span><span class="diff-line del">-                                   + lookup(&#x27;vars&#x27;, autoscan_name + &#x27;_docker_security_opts_custom&#x27;, default=autoscan_docker_security_opts_custom) }}&quot;</span><span class="diff-line add">+autoscan_role_docker_networks_alias: &quot;{{ autoscan_name }}&quot;</span><span class="diff-line add">+autoscan_role_docker_networks_default: []</span><span class="diff-line add">+autoscan_role_docker_networks_custom: []</span><span class="diff-line add">+autoscan_role_docker_networks: &quot;{{ docker_networks_common</span><span class="diff-line add">+                                   + lookup(&#x27;role_var&#x27;, &#x27;_docker_networks_default&#x27;, role=&#x27;autoscan&#x27;)</span><span class="diff-line add">+                                   + lookup(&#x27;role_var&#x27;, &#x27;_docker_networks_custom&#x27;, role=&#x27;autoscan&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Restart Policy</span><span class="diff-line del">-autoscan_docker_restart_policy: unless-stopped</span><span class="diff-line add">+autoscan_role_docker_restart_policy: unless-stopped</span><span class="diff-line context"> </span><span class="diff-line context"> # State</span><span class="diff-line del">-autoscan_docker_state: started</span><span class="diff-line add">+autoscan_role_docker_state: started</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-119">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/autoscan/tasks/main2.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -10,9 +10,9 @@</span><span class="diff-line context"> - name: Add DNS record</span><span class="diff-line context">   ansible.builtin.include_tasks: &quot;{{ resources_tasks_path }}/dns/tasker.yml&quot;</span><span class="diff-line context">   vars:</span><span class="diff-line del">-    dns_record: &quot;{{ lookup(&#x27;vars&#x27;, role_name + &#x27;_dns_record&#x27;) }}&quot;</span><span class="diff-line del">-    dns_zone: &quot;{{ lookup(&#x27;vars&#x27;, role_name + &#x27;_dns_zone&#x27;) }}&quot;</span><span class="diff-line del">-    dns_proxy: &quot;{{ lookup(&#x27;vars&#x27;, role_name + &#x27;_dns_proxy&#x27;) }}&quot;</span><span class="diff-line add">+    dns_record: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_dns_record&#x27;) }}&quot;</span><span class="diff-line add">+    dns_zone: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_dns_zone&#x27;) }}&quot;</span><span class="diff-line add">+    dns_proxy: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_dns_proxy&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Remove existing Docker container</span><span class="diff-line context">   ansible.builtin.include_tasks: &quot;{{ resources_tasks_path }}/docker/remove_docker_container.yml&quot;</span><span class="diff-line hunk">@@ -21,7 +21,7 @@</span><span class="diff-line context">   ansible.builtin.include_tasks: &quot;{{ resources_tasks_path }}/directories/create_directories.yml&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Import Settings task</span><span class="diff-line del">-  ansible.builtin.import_tasks: &quot;subtasks/settings.yml&quot;</span><span class="diff-line add">+  ansible.builtin.include_tasks: &quot;subtasks/settings.yml&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Create Docker container</span><span class="diff-line context">   ansible.builtin.include_tasks: &quot;{{ resources_tasks_path }}/docker/create_docker_container.yml&quot;</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-120">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/autoscan/tasks/subtasks/settings.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -7,12 +7,12 @@</span><span class="diff-line context"> #                   GNU General Public License v3.0                     #</span><span class="diff-line context"> #########################################################################</span><span class="diff-line context"> ---</span><span class="diff-line del">-- name: Settings | Check if `{{ autoscan_paths_config_location | basename }}` exists</span><span class="diff-line add">+- name: Settings | Check if `{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_config_location&#x27;, role=&#x27;autoscan&#x27;) | basename }}` exists</span><span class="diff-line context">   ansible.builtin.stat:</span><span class="diff-line del">-    path: &quot;{{ autoscan_paths_config_location }}&quot;</span><span class="diff-line add">+    path: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_config_location&#x27;, role=&#x27;autoscan&#x27;) }}&quot;</span><span class="diff-line context">   register: autoscan_config</span><span class="diff-line context"> </span><span class="diff-line del">-- name: Settings | New `{{ autoscan_paths_config_location | basename }}` tasks</span><span class="diff-line add">+- name: Settings | New `{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_config_location&#x27;, role=&#x27;autoscan&#x27;) | basename }}` tasks</span><span class="diff-line context">   when: (not autoscan_config.stat.exists)</span><span class="diff-line context">   block:</span><span class="diff-line context">     - name: Settings | Get Instance Info</span><span class="diff-line hunk">@@ -21,10 +21,10 @@</span><span class="diff-line context">         get_info_list:</span><span class="diff-line context">           - plex</span><span class="diff-line context"> </span><span class="diff-line del">-    - name: Settings | Import default `{{ autoscan_paths_config_location | basename }}`</span><span class="diff-line add">+    - name: Settings | Import default `{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_config_location&#x27;, role=&#x27;autoscan&#x27;) | basename }}`</span><span class="diff-line context">       ansible.builtin.template:</span><span class="diff-line context">         src: config.yml.j2</span><span class="diff-line del">-        dest: &quot;{{ autoscan_paths_config_location }}&quot;</span><span class="diff-line add">+        dest: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_config_location&#x27;, role=&#x27;autoscan&#x27;) }}&quot;</span><span class="diff-line context">         owner: &quot;{{ user.name }}&quot;</span><span class="diff-line context">         group: &quot;{{ user.name }}&quot;</span><span class="diff-line context">         mode: &quot;0664&quot;</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-121">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/autoscan/templates/config.yml.j2</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -41,12 +41,12 @@</span><span class="diff-line context"> </span><span class="diff-line context">       # rewrite inotify path to unified filesystem</span><span class="diff-line context">       rewrite:</span><span class="diff-line del">-        - from: ^/mnt/local/Media/</span><span class="diff-line add">+        - from: {{ &#x27;^&#x27; + server_local_folder_path }}/Media/</span><span class="diff-line context">           to: /mnt/unionfs/Media/</span><span class="diff-line context"> </span><span class="diff-line context">       # Local filesystem paths to monitor</span><span class="diff-line context">       paths:</span><span class="diff-line del">-        - path: /mnt/local/Media</span><span class="diff-line add">+        - path: {{ server_local_folder_path }}/Media</span><span class="diff-line context"> </span><span class="diff-line context">   sonarr:</span><span class="diff-line context"> {% for instance in sonarr_instances %}</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-122">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/backup/defaults/main.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -21,8 +21,8 @@</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line context"> backup_size_exclude_folders:</span><span class="diff-line del">-  - &quot;/opt/plex/Library/Application Support/Plex Media Server/Cache/PhotoTranscoder&quot;</span><span class="diff-line del">-  - &quot;/opt/plex/Library/Application Support/Plex Media Server/Cache/Transcode&quot;</span><span class="diff-line add">+  - &quot;{{ server_appdata_path }}/plex/Library/Application Support/Plex Media Server/Cache/PhotoTranscoder&quot;</span><span class="diff-line add">+  - &quot;{{ server_appdata_path }}/plex/Library/Application Support/Plex Media Server/Cache/Transcode&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # Notifications</span><span class="diff-line hunk">@@ -57,5 +57,5 @@</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line context"> snapshot_type: &quot;&quot;</span><span class="diff-line del">-backup_opt_path: &quot;/opt/&quot;</span><span class="diff-line add">+backup_opt_path: &quot;{{ server_appdata_path }}/&quot;</span><span class="diff-line context"> use_snapshot: false</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-123">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/backup/tasks/main.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -22,6 +22,11 @@</span><span class="diff-line context">           - &quot;Backup Role cannot run without a tag.&quot;</span><span class="diff-line context">           - &quot;Use backup or backup2 tag.&quot;</span><span class="diff-line context"> </span><span class="diff-line add">+- name: Import cloudplow role variables</span><span class="diff-line add">+  ansible.builtin.include_tasks: &quot;{{ resources_tasks_path }}/variables/import_role_vars.yml&quot;</span><span class="diff-line add">+  vars:</span><span class="diff-line add">+    import_role_name: cloudplow</span><span class="diff-line add">+</span><span class="diff-line context"> - name: Backup</span><span class="diff-line context">   block:</span><span class="diff-line context">     - name: &quot;Set &#x27;backup_success&#x27; variable&quot;</span><span class="diff-line hunk">@@ -29,10 +34,10 @@</span><span class="diff-line context">         backup_success: false</span><span class="diff-line context"> </span><span class="diff-line context">     - name: Sanity Check</span><span class="diff-line del">-      ansible.builtin.import_tasks: &quot;sanity_check.yml&quot;</span><span class="diff-line add">+      ansible.builtin.include_tasks: &quot;sanity_check.yml&quot;</span><span class="diff-line context"> </span><span class="diff-line context">     - name: Variables</span><span class="diff-line del">-      ansible.builtin.import_tasks: &quot;variables.yml&quot;</span><span class="diff-line add">+      ansible.builtin.include_tasks: &quot;variables.yml&quot;</span><span class="diff-line context">       tags:</span><span class="diff-line context">         - set-backup</span><span class="diff-line context">         - unset-backup</span><span class="diff-line hunk">@@ -41,14 +46,14 @@</span><span class="diff-line context">         - wipe-restore-service</span><span class="diff-line context"> </span><span class="diff-line context">     - name: Import Restore Service Cleanup</span><span class="diff-line del">-      ansible.builtin.import_tasks: &quot;wipe_restore_service.yml&quot;</span><span class="diff-line add">+      ansible.builtin.include_tasks: &quot;wipe_restore_service.yml&quot;</span><span class="diff-line context">       when: (&#x27;wipe-restore-service&#x27; in ansible_run_tags) and not (&#x27;backup&#x27; in ansible_run_tags)</span><span class="diff-line context">       tags:</span><span class="diff-line context">         - wipe-restore-service</span><span class="diff-line context"> </span><span class="diff-line context">     - name: Cron</span><span class="diff-line del">-      ansible.builtin.import_tasks: &quot;cron.yml&quot;</span><span class="diff-line del">-      when: ([&#x27;set-backup&#x27;, &#x27;unset-backup&#x27;] | intersect(ansible_run_tags)) and not (&#x27;backup&#x27; in ansible_run_tags)</span><span class="diff-line add">+      ansible.builtin.include_tasks: &quot;cron.yml&quot;</span><span class="diff-line add">+      when: (([&#x27;set-backup&#x27;, &#x27;unset-backup&#x27;] | intersect(ansible_run_tags)) | length &gt; 0) and not (&#x27;backup&#x27; in ansible_run_tags)</span><span class="diff-line context">       tags:</span><span class="diff-line context">         - set-backup</span><span class="diff-line context">         - unset-backup</span><span class="diff-line hunk">@@ -62,7 +67,7 @@</span><span class="diff-line context">         start_time: &quot;{{ start_time_lookup.stdout }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context">     - name: Snapshot</span><span class="diff-line del">-      ansible.builtin.import_tasks: &quot;snapshot.yml&quot;</span><span class="diff-line add">+      ansible.builtin.include_tasks: &quot;snapshot.yml&quot;</span><span class="diff-line context"> </span><span class="diff-line context">     - name: &quot;Notify | Saltbox Backup: Started Saltbox backup task&quot;</span><span class="diff-line context">       ansible.builtin.include_role:</span><span class="diff-line hunk">@@ -120,12 +125,12 @@</span><span class="diff-line context">         - &quot;/home/{{ user.name }}/logs&quot;</span><span class="diff-line context">         - &quot;{{ backup.local.destination }}&quot;</span><span class="diff-line context">         - &quot;{{ backup.local.destination }}/opt&quot;</span><span class="diff-line del">-        - &quot;/opt/systemd-backup&quot;</span><span class="diff-line del">-        - &quot;/opt/crontab-backup&quot;</span><span class="diff-line add">+        - &quot;{{ server_appdata_path }}/systemd-backup&quot;</span><span class="diff-line add">+        - &quot;{{ server_appdata_path }}/crontab-backup&quot;</span><span class="diff-line context"> </span><span class="diff-line context">     # Check if there is enough space in the local backup destination</span><span class="diff-line del">-    - name: Get size of opt folder</span><span class="diff-line del">-      ansible.builtin.shell: &quot;du -sk /opt || true&quot;</span><span class="diff-line add">+    - name: Get size of {{ server_appdata_path }} folder</span><span class="diff-line add">+      ansible.builtin.shell: &quot;du -sk {{ server_appdata_path }} || true&quot;</span><span class="diff-line context">       register: estimated_backup_size</span><span class="diff-line context"> </span><span class="diff-line context">     - name: Check existence of exclude folders</span><span class="diff-line hunk">@@ -235,13 +240,13 @@</span><span class="diff-line context">           else (playbook_dir + &#x27;/roles/backup/files/backup_excludes_list.txt&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context">     - name: Saltbox Restore Service</span><span class="diff-line del">-      ansible.builtin.import_tasks: &quot;restore_service.yml&quot;</span><span class="diff-line add">+      ansible.builtin.include_tasks: &quot;restore_service.yml&quot;</span><span class="diff-line context">       when: restore_service_enabled</span><span class="diff-line context">       tags:</span><span class="diff-line context">         - restore-service</span><span class="diff-line context">         - saltbox-restore-service</span><span class="diff-line context"> </span><span class="diff-line del">-    - name: &quot;Synchronize &#x27;/etc/systemd/system&#x27; to &#x27;/opt/systemd-backup&#x27; for inclusion in backup&quot;</span><span class="diff-line add">+    - name: &quot;Synchronize &#x27;/etc/systemd/system&#x27; to &#x27;{{ server_appdata_path }}/systemd-backup&#x27; for inclusion in backup&quot;</span><span class="diff-line context">       ansible.builtin.shell: |</span><span class="diff-line context">         /usr/bin/rsync \</span><span class="diff-line context">           --delay-updates \</span><span class="diff-line hunk">@@ -254,13 +259,13 @@</span><span class="diff-line context">           --exclude=&#x27;saltbox_managed_*&#x27; \</span><span class="diff-line context">           --include=&#x27;*.service&#x27; \</span><span class="diff-line context">           --include=&#x27;*.mount&#x27; \</span><span class="diff-line del">-          /etc/systemd/system/* /opt/systemd-backup/</span><span class="diff-line add">+          /etc/systemd/system/* {{ server_appdata_path }}/systemd-backup/</span><span class="diff-line context">       args:</span><span class="diff-line context">         executable: /bin/bash</span><span class="diff-line context">       ignore_errors: true</span><span class="diff-line context"> </span><span class="diff-line del">-    - name: &quot;Copying crontabs to &#x27;/opt/crontab-backup&#x27; for inclusion in backup&quot;</span><span class="diff-line del">-      ansible.builtin.shell: &quot;cp -f /var/spool/cron/crontabs/* /opt/crontab-backup&quot;</span><span class="diff-line add">+    - name: &quot;Copying crontabs to &#x27;{{ server_appdata_path }}/crontab-backup&#x27; for inclusion in backup&quot;</span><span class="diff-line add">+      ansible.builtin.shell: &quot;cp -f /var/spool/cron/crontabs/* {{ server_appdata_path }}/crontab-backup&quot;</span><span class="diff-line context">       ignore_errors: true</span><span class="diff-line context"> </span><span class="diff-line context">     - name: &quot;Reset permissions of folders&quot;</span><span class="diff-line hunk">@@ -272,61 +277,84 @@</span><span class="diff-line context">         mode: &quot;0775&quot;</span><span class="diff-line context">         recurse: true</span><span class="diff-line context">       with_items:</span><span class="diff-line del">-        - &quot;/opt/systemd-backup&quot;</span><span class="diff-line del">-        - &quot;/opt/crontab-backup&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-    # Stop Containers</span><span class="diff-line del">-</span><span class="diff-line del">-    - name: &quot;Gather list of running Docker containers&quot;</span><span class="diff-line del">-      ansible.builtin.shell: &quot;docker ps --format &#x27;{{ &#x27;{{&#x27; }} .Names{{ &#x27;}}&#x27; }}&#x27; --filter label=com.github.saltbox.saltbox_managed=true | xargs echo -n&quot;</span><span class="diff-line del">-      register: docker_containers</span><span class="diff-line del">-      ignore_errors: true</span><span class="diff-line del">-</span><span class="diff-line del">-    - name: Set &#x27;docker_containers&#x27; variable</span><span class="diff-line del">-      ansible.builtin.set_fact:</span><span class="diff-line del">-        docker_containers: &quot;{{ docker_containers.stdout if (docker_containers is success) else &#x27;&#x27; }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-    - name: Docker container tasks</span><span class="diff-line del">-      when: (docker_containers | trim | length &gt; 0)</span><span class="diff-line add">+        - &quot;{{ server_appdata_path }}/systemd-backup&quot;</span><span class="diff-line add">+        - &quot;{{ server_appdata_path }}/crontab-backup&quot;</span><span class="diff-line add">+</span><span class="diff-line add">+    - name: Populate Service Facts</span><span class="diff-line add">+      ansible.builtin.service_facts:</span><span class="diff-line add">+</span><span class="diff-line add">+    - name: Set docker_service_running</span><span class="diff-line add">+      ansible.builtin.set_fact:</span><span class="diff-line add">+        docker_service_running: &quot;{{ (ansible_facts[&#x27;services&#x27;][&#x27;docker.service&#x27;] is defined) and (ansible_facts[&#x27;services&#x27;][&#x27;docker.service&#x27;][&#x27;state&#x27;] == &#x27;running&#x27;) }}&quot;</span><span class="diff-line add">+</span><span class="diff-line add">+    - name: Stop Docker Container Tasks</span><span class="diff-line add">+      when: docker_service_running</span><span class="diff-line context">       block:</span><span class="diff-line del">-        - name: Convert Docker containers string into a list</span><span class="diff-line add">+        - name: &quot;Gather Docker container information&quot;</span><span class="diff-line add">+          community.docker.docker_host_info:</span><span class="diff-line add">+            containers: true</span><span class="diff-line add">+            containers_filters:</span><span class="diff-line add">+              label:</span><span class="diff-line add">+                - &quot;com.github.saltbox.saltbox_managed=true&quot;</span><span class="diff-line add">+              status:</span><span class="diff-line add">+                - &quot;running&quot;</span><span class="diff-line add">+          register: docker_info</span><span class="diff-line add">+</span><span class="diff-line add">+        - name: Extract and process container names</span><span class="diff-line context">           ansible.builtin.set_fact:</span><span class="diff-line del">-            docker_containers: &quot;{{ docker_containers.split() | reject(&#x27;in&#x27;, gluetun_instances | default([&#x27;gluetun&#x27;])) | sort }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-        - name: Filter out ignored apps from Docker containers list</span><span class="diff-line add">+            docker_containers: &quot;{{ docker_info.containers | map(attribute=&#x27;Names&#x27;) | map(&#x27;first&#x27;) | map(&#x27;regex_replace&#x27;, &#x27;^/&#x27;, &#x27;&#x27;) | reject(&#x27;in&#x27;, gluetun_instances | default([&#x27;gluetun&#x27;])) | sort }}&quot;</span><span class="diff-line add">+          when:</span><span class="diff-line add">+            - (docker_info is success)</span><span class="diff-line add">+            - (docker_info.containers is defined)</span><span class="diff-line add">+            - (docker_info.containers | length &gt; 0)</span><span class="diff-line add">+</span><span class="diff-line add">+        - name: Set empty list if no containers found</span><span class="diff-line context">           ansible.builtin.set_fact:</span><span class="diff-line del">-            docker_containers: &quot;{{ docker_containers | difference(reverse_proxy_apps + torrent_apps + backup_ignore_containers) }}&quot;</span><span class="diff-line del">-            ignore_containers: &quot;{{ reverse_proxy_apps + torrent_apps + backup_ignore_containers }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-        - name: Convert Docker containers list back to string</span><span class="diff-line del">-          ansible.builtin.set_fact:</span><span class="diff-line del">-            docker_containers_string: &quot;{{ docker_containers | join(&#x27; &#x27;) }}&quot;</span><span class="diff-line del">-            ignore_query_string: &gt;-</span><span class="diff-line del">-              {% if docker_containers | length &gt; 0 and ignore_containers | length &gt; 0 %}</span><span class="diff-line del">-                {%- set ignore_params = [] -%}</span><span class="diff-line del">-                {% for container in ignore_containers %}</span><span class="diff-line del">-                  {%- set _ = ignore_params.append(&#x27;ignore=&#x27; ~ container) -%}</span><span class="diff-line del">-                {%- endfor -%}</span><span class="diff-line del">-                {{ ignore_params | join(&#x27;&amp;&#x27;) }}</span><span class="diff-line del">-              {%- else -%}</span><span class="diff-line del">-              {% endif %}</span><span class="diff-line del">-</span><span class="diff-line del">-        - name: Stop Saltbox Docker containers</span><span class="diff-line del">-          ansible.builtin.include_tasks: &quot;{{ resources_tasks_path }}/docker/stop_saltbox_docker_containers.yml&quot;</span><span class="diff-line del">-          vars:</span><span class="diff-line del">-            _query_var: &quot;{{ &#x27;?&#x27; + ignore_query_string if (ignore_query_string | length &gt; 0) else &#x27;&#x27; }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-        - name: &quot;Stop all running Docker containers&quot;</span><span class="diff-line del">-          ansible.builtin.shell: &quot;docker stop {{ docker_containers_string }}&quot;</span><span class="diff-line del">-          ignore_errors: true</span><span class="diff-line del">-          when: (docker_containers_string | trim | length &gt; 0)</span><span class="diff-line del">-</span><span class="diff-line del">-        - name: &quot;Notify | Saltbox Backup: Stopped Docker containers&quot;</span><span class="diff-line del">-          ansible.builtin.include_role:</span><span class="diff-line del">-            name: notify</span><span class="diff-line del">-          vars:</span><span class="diff-line del">-            message: &quot;{{ backup_instance }} Backup: Stopped Docker containers.&quot;</span><span class="diff-line del">-          when: backup_notify_stop_docker_containers</span><span class="diff-line add">+            docker_containers: []</span><span class="diff-line add">+          when: (docker_info is not success) or (docker_info.containers is not defined) or (docker_info.containers | length == 0)</span><span class="diff-line add">+</span><span class="diff-line add">+        - name: Docker container tasks</span><span class="diff-line add">+          when: (docker_containers | length &gt; 0)</span><span class="diff-line add">+          block:</span><span class="diff-line add">+            - name: Build list of containers to ignore</span><span class="diff-line add">+              ansible.builtin.set_fact:</span><span class="diff-line add">+                ignore_containers: &quot;{{ reverse_proxy_apps + torrent_apps + backup_ignore_containers }}&quot;</span><span class="diff-line add">+</span><span class="diff-line add">+            - name: Filter out ignored apps from Docker containers list</span><span class="diff-line add">+              ansible.builtin.set_fact:</span><span class="diff-line add">+                docker_containers: &quot;{{ docker_containers | difference(ignore_containers) }}&quot;</span><span class="diff-line add">+</span><span class="diff-line add">+            - name: Convert Docker containers list back to string</span><span class="diff-line add">+              ansible.builtin.set_fact:</span><span class="diff-line add">+                docker_containers_string: &quot;{{ docker_containers | join(&#x27; &#x27;) }}&quot;</span><span class="diff-line add">+                ignore_query_string: &gt;-</span><span class="diff-line add">+                  {% if docker_containers | length &gt; 0 and ignore_containers | length &gt; 0 %}</span><span class="diff-line add">+                    {%- set ignore_params = [] -%}</span><span class="diff-line add">+                    {% for container in ignore_containers %}</span><span class="diff-line add">+                      {%- set _ = ignore_params.append(&#x27;ignore=&#x27; ~ container) -%}</span><span class="diff-line add">+                    {%- endfor -%}</span><span class="diff-line add">+                    {{ ignore_params | join(&#x27;&amp;&#x27;) }}</span><span class="diff-line add">+                  {%- else -%}</span><span class="diff-line add">+                  {% endif %}</span><span class="diff-line add">+</span><span class="diff-line add">+            - name: Stop Saltbox Docker containers</span><span class="diff-line add">+              ansible.builtin.include_tasks: &quot;{{ resources_tasks_path }}/docker/stop_saltbox_docker_containers.yml&quot;</span><span class="diff-line add">+              vars:</span><span class="diff-line add">+                _query_var: &quot;{{ &#x27;?&#x27; + ignore_query_string</span><span class="diff-line add">+                            if (ignore_query_string | length &gt; 0)</span><span class="diff-line add">+                            else &#x27;&#x27; }}&quot;</span><span class="diff-line add">+</span><span class="diff-line add">+            - name: &quot;Stop all running Docker containers&quot;</span><span class="diff-line add">+              ansible.builtin.shell: &quot;docker stop {{ docker_containers_string }}&quot;</span><span class="diff-line add">+              ignore_errors: true</span><span class="diff-line add">+              when: (docker_containers_string | trim | length &gt; 0)</span><span class="diff-line add">+</span><span class="diff-line add">+            - name: &quot;Notify | Saltbox Backup: Stopped Docker containers&quot;</span><span class="diff-line add">+              ansible.builtin.include_role:</span><span class="diff-line add">+                name: notify</span><span class="diff-line add">+              vars:</span><span class="diff-line add">+                message: &quot;{{ backup_instance }} Backup: Stopped Docker containers.&quot;</span><span class="diff-line add">+              when: backup_notify_stop_docker_containers</span><span class="diff-line context"> </span><span class="diff-line context">     # Custom User Files</span><span class="diff-line context"> </span><span class="diff-line hunk">@@ -342,16 +370,11 @@</span><span class="diff-line context">         - &quot;{{ backup_user_defined_files }}&quot;</span><span class="diff-line context">       when: (backup_user_defined_files | length &gt; 0)</span><span class="diff-line context"> </span><span class="diff-line del">-    # Services</span><span class="diff-line del">-</span><span class="diff-line del">-    - name: Populate Service Facts</span><span class="diff-line del">-      ansible.builtin.service_facts:</span><span class="diff-line del">-</span><span class="diff-line del">-      # Stop Cloudplow</span><span class="diff-line add">+    # Stop Cloudplow</span><span class="diff-line context"> </span><span class="diff-line context">     - name: Check if &#x27;cloudplow.service&#x27; exists</span><span class="diff-line context">       ansible.builtin.stat:</span><span class="diff-line del">-        path: &quot;/etc/systemd/system/cloudplow.service&quot;</span><span class="diff-line add">+        path: &quot;/etc/systemd/system/{{ cloudplow_service_name }}.service&quot;</span><span class="diff-line context">       register: cloudplow_service</span><span class="diff-line context"> </span><span class="diff-line context">     - name: Stop &#x27;cloudplow&#x27; service block</span><span class="diff-line hunk">@@ -359,11 +382,11 @@</span><span class="diff-line context">       block:</span><span class="diff-line context">         - name: Get &#x27;cloudplow&#x27; service state</span><span class="diff-line context">           ansible.builtin.set_fact:</span><span class="diff-line del">-            cloudplow_service_running: &quot;{{ (services[&#x27;cloudplow.service&#x27;] is defined) and (services[&#x27;cloudplow.service&#x27;][&#x27;state&#x27;] == &#x27;running&#x27;) }}&quot;</span><span class="diff-line add">+            cloudplow_service_running: &quot;{{ (ansible_facts[&#x27;services&#x27;][cloudplow_service_name + &#x27;.service&#x27;] is defined) and (ansible_facts[&#x27;services&#x27;][cloudplow_service_name + &#x27;.service&#x27;][&#x27;state&#x27;] == &#x27;running&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context">         - name: Stop &#x27;cloudplow&#x27; service</span><span class="diff-line context">           ansible.builtin.systemd_service:</span><span class="diff-line del">-            name: cloudplow</span><span class="diff-line add">+            name: &quot;{{ cloudplow_service_name }}&quot;</span><span class="diff-line context">             state: stopped</span><span class="diff-line context">           when: cloudplow_service_running</span><span class="diff-line context"> </span><span class="diff-line hunk">@@ -391,7 +414,7 @@</span><span class="diff-line context">     # Start Docker containers when snapshot is enabled</span><span class="diff-line context"> </span><span class="diff-line context">     - name: Snapshot | Start Docker containers</span><span class="diff-line del">-      when: use_snapshot</span><span class="diff-line add">+      when: docker_service_running and use_snapshot</span><span class="diff-line context">       block:</span><span class="diff-line context">         - name: &quot;Snapshot | Wait for 5 seconds before starting Docker containers&quot;</span><span class="diff-line context">           ansible.builtin.wait_for:</span><span class="diff-line hunk">@@ -510,7 +533,7 @@</span><span class="diff-line context">     # Start Docker containers when snapshot is not enabled</span><span class="diff-line context"> </span><span class="diff-line context">     - name: Start Docker Containers</span><span class="diff-line del">-      when: (not use_snapshot)</span><span class="diff-line add">+      when: docker_service_running and (not use_snapshot)</span><span class="diff-line context">       block:</span><span class="diff-line context">         - name: &quot;Wait for 5 seconds before starting Docker containers&quot;</span><span class="diff-line context">           ansible.builtin.wait_for:</span><span class="diff-line hunk">@@ -535,7 +558,7 @@</span><span class="diff-line context">     - name: &quot;Wait for 10 seconds before uploads&quot;</span><span class="diff-line context">       ansible.builtin.wait_for:</span><span class="diff-line context">         timeout: 10</span><span class="diff-line del">-      when: backup.rclone.enable or backup.rsync.enable</span><span class="diff-line add">+      when: backup_rclone_enabled or backup_rsync_enabled</span><span class="diff-line context"> </span><span class="diff-line context">     - name: &quot;Reset folder ownership of &#x27;{{ backup.local.destination }}/&#x27;&quot;</span><span class="diff-line context">       ansible.builtin.shell: &quot;chown -R {{ user.name }}:{{ user.name }} {{ backup.local.destination }}/&quot;</span><span class="diff-line hunk">@@ -561,7 +584,7 @@</span><span class="diff-line context">       become_user: &quot;{{ user.name }}&quot;</span><span class="diff-line context">       register: rclone_timestamp</span><span class="diff-line context">       ignore_errors: true</span><span class="diff-line del">-      when: backup.rclone.enable</span><span class="diff-line add">+      when: backup_rclone_enabled</span><span class="diff-line context"> </span><span class="diff-line context">     - name: Define Archive List</span><span class="diff-line context">       ansible.builtin.set_fact:</span><span class="diff-line hunk">@@ -592,13 +615,13 @@</span><span class="diff-line context">       register: rclone_move</span><span class="diff-line context">       failed_when: rclone_move.rc &gt; 3</span><span class="diff-line context">       ignore_errors: true</span><span class="diff-line del">-      when: backup.rclone.enable and (rclone_timestamp is defined) and (&#x27;Failed&#x27; not in rclone_timestamp.stderr)</span><span class="diff-line add">+      when: backup_rclone_enabled and (rclone_timestamp is defined) and (&#x27;Failed&#x27; not in rclone_timestamp.stderr)</span><span class="diff-line context">       loop: &quot;{{ backup_archive_list + (backup_user_defined_files | map(&#x27;basename&#x27;) | list) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context">     - name: &quot;Wait for 5 seconds before uploading&quot;</span><span class="diff-line context">       ansible.builtin.wait_for:</span><span class="diff-line context">         timeout: 5</span><span class="diff-line del">-      when: backup.rclone.enable or backup.rsync.enable</span><span class="diff-line add">+      when: backup_rclone_enabled or backup_rsync_enabled</span><span class="diff-line context"> </span><span class="diff-line context">     - name: &quot;Use rclone to upload backup to &#x27;{{ backup.rclone.destination }}&#x27;&quot;</span><span class="diff-line context">       ansible.builtin.shell: |</span><span class="diff-line hunk">@@ -608,21 +631,21 @@</span><span class="diff-line context">           {{ lookup(&#x27;vars&#x27;, &#x27;backup_&#x27; + backup.rclone.template + &#x27;_template&#x27;, default=&#x27;&#x27;) }} \</span><span class="diff-line context">           --stats=30s \</span><span class="diff-line context">           --bwlimit={{ backup_rclone_upload_speed_limit }} \</span><span class="diff-line del">-          {{ &#x27;--bind=&#x27; + ansible_default_ipv4.address if mounts.ipv4_only else &#x27;&#x27; }} \</span><span class="diff-line add">+          {{ &#x27;--bind=&#x27; + ansible_facts[&#x27;default_ipv4&#x27;][&#x27;address&#x27;] if rclone_mounts_ipv4_only else &#x27;&#x27; }} \</span><span class="diff-line context">           -vv \</span><span class="diff-line context">           --log-file=&#x27;{{ playbook_dir }}/backup_rclone.log&#x27; \</span><span class="diff-line context">           &#x27;{{ backup.local.destination }}&#x27; &#x27;{{ backup.rclone.destination }}&#x27;</span><span class="diff-line context">       environment: &quot;{{ backup_rclone_env }}&quot;</span><span class="diff-line context">       become: true</span><span class="diff-line context">       become_user: &quot;{{ user.name }}&quot;</span><span class="diff-line del">-      when: backup.rclone.enable</span><span class="diff-line add">+      when: backup_rclone_enabled</span><span class="diff-line context"> </span><span class="diff-line context">     - name: &quot;Notify | Saltbox Backup: Rclone uploaded backup to &#x27;{{ backup.rclone.destination }}&#x27;&quot;</span><span class="diff-line context">       ansible.builtin.include_role:</span><span class="diff-line context">         name: notify</span><span class="diff-line context">       vars:</span><span class="diff-line context">         message: &quot;{{ backup_instance }} Backup: Rclone uploaded backup to &#x27;{{ backup.rclone.destination }}&#x27;.&quot;</span><span class="diff-line del">-      when: backup.rclone.enable and backup_notify_rclone_complete</span><span class="diff-line add">+      when: backup_rclone_enabled and backup_notify_rclone_complete</span><span class="diff-line context"> </span><span class="diff-line context">     - name: &quot;Use rsync to upload backup to &#x27;{{ backup.rsync.destination }}&#x27;&quot;</span><span class="diff-line context">       ansible.posix.synchronize:</span><span class="diff-line hunk">@@ -633,14 +656,14 @@</span><span class="diff-line context">         dest_port: &quot;{{ backup.rsync.port }}&quot;</span><span class="diff-line context">       become: true</span><span class="diff-line context">       become_user: &quot;{{ user.name }}&quot;</span><span class="diff-line del">-      when: backup.rsync.enable</span><span class="diff-line add">+      when: backup_rsync_enabled</span><span class="diff-line context"> </span><span class="diff-line context">     - name: &quot;Notify | Saltbox Backup: Rsync uploaded backup to &#x27;{{ backup.rsync.destination }}&#x27;&quot;</span><span class="diff-line context">       ansible.builtin.include_role:</span><span class="diff-line context">         name: notify</span><span class="diff-line context">       vars:</span><span class="diff-line context">         message: &quot;{{ backup_instance }} Backup: Rsync uploaded backup to &#x27;{{ backup.rsync.destination }}&#x27;.&quot;</span><span class="diff-line del">-      when: backup.rsync.enable and backup_notify_rsync_complete</span><span class="diff-line add">+      when: backup_rsync_enabled and backup_notify_rsync_complete</span><span class="diff-line context"> </span><span class="diff-line context">     - name: Get Current Time</span><span class="diff-line context">       ansible.builtin.shell: &quot;date \&quot;+%s\&quot;&quot;</span><span class="diff-line hunk">@@ -662,7 +685,7 @@</span><span class="diff-line context"> </span><span class="diff-line context">     - name: &quot;Start &#x27;cloudplow&#x27; service&quot;</span><span class="diff-line context">       ansible.builtin.systemd_service:</span><span class="diff-line del">-        name: cloudplow</span><span class="diff-line add">+        name: &quot;{{ cloudplow_service_name }}&quot;</span><span class="diff-line context">         state: started</span><span class="diff-line context">       when: (cloudplow_service is defined) and cloudplow_service.stat.exists and cloudplow_service_running</span><span class="diff-line context"> </span><span class="diff-line hunk">@@ -670,7 +693,7 @@</span><span class="diff-line context">       ansible.builtin.file:</span><span class="diff-line context">         path: &quot;{{ backup.local.destination }}&quot;</span><span class="diff-line context">         state: absent</span><span class="diff-line del">-      when: (dir_files2.matched | int != 0) and (not backup.local.enable)</span><span class="diff-line add">+      when: (dir_files2.matched | int != 0) and (not backup_local_enabled)</span><span class="diff-line context"> </span><span class="diff-line context">     - name: &quot;Set &#x27;backup_success&#x27; variable&quot;</span><span class="diff-line context">       ansible.builtin.set_fact:</span><span class="diff-line hunk">@@ -709,7 +732,7 @@</span><span class="diff-line context">       ignore_errors: true</span><span class="diff-line context"> </span><span class="diff-line context">     - name: Start Docker Containers</span><span class="diff-line del">-      when: (not use_snapshot)</span><span class="diff-line add">+      when: docker_service_running and (not use_snapshot)</span><span class="diff-line context">       block:</span><span class="diff-line context">         - name: &quot;Wait for 5 seconds before starting Docker containers&quot;</span><span class="diff-line context">           ansible.builtin.wait_for:</span><span class="diff-line hunk">@@ -726,7 +749,7 @@</span><span class="diff-line context"> </span><span class="diff-line context">     - name: &quot;Start &#x27;cloudplow&#x27; service&quot;</span><span class="diff-line context">       ansible.builtin.systemd_service:</span><span class="diff-line del">-        name: cloudplow</span><span class="diff-line add">+        name: &quot;{{ cloudplow_service_name }}&quot;</span><span class="diff-line context">         state: started</span><span class="diff-line context">       when: (cloudplow_service is defined) and cloudplow_service.stat.exists and cloudplow_service_running</span><span class="diff-line context"> </span><span class="diff-line hunk">@@ -751,7 +774,7 @@</span><span class="diff-line context">       ignore_errors: true</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Backup Cleanup Block</span><span class="diff-line del">-  when: backup.rclone.enable and backup_cleanup_enabled and backup_success</span><span class="diff-line add">+  when: backup_rclone_enabled and backup_cleanup_enabled and backup_success</span><span class="diff-line context">   block:</span><span class="diff-line context">     - name: Determine number of existing backups</span><span class="diff-line context">       ansible.builtin.shell: &gt;</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-124">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/backup/tasks/restore_service.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -123,7 +123,7 @@</span><span class="diff-line context">           {{ files_upload.results | selectattr(&#x27;stdout&#x27;, &#x27;search&#x27;, &#x27;too large&#x27;) | map(attribute=&#x27;item&#x27;)</span><span class="diff-line context">           | map(&#x27;regex_replace&#x27;, &#x27;^/tmp/restore_service/|.enc$&#x27;, &#x27;&#x27;) | list | sort(case_sensitive=False) | join(&#x27;, &#x27;) }}</span><span class="diff-line context"> </span><span class="diff-line del">-    - name: Restore Service | Print error mesage when config file(s) were too large to upload</span><span class="diff-line add">+    - name: Restore Service | Print error message when config file(s) were too large to upload</span><span class="diff-line context">       ansible.builtin.debug:</span><span class="diff-line context">         msg: &quot;The following encrypted config file(s) were too large to upload to the Saltbox Restore Service: &#x27;{{ files_too_large_to_upload_list | trim }}&#x27;&quot;</span><span class="diff-line context">       when: (files_too_large_to_upload_list | trim | length &gt; 0)</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-125">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/backup/tasks/sanity_check.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -15,7 +15,7 @@</span><span class="diff-line context"> # Age in hours</span><span class="diff-line context"> - name: &quot;Get age of &#x27;backup.lock&#x27; file&quot;</span><span class="diff-line context">   ansible.builtin.set_fact:</span><span class="diff-line del">-    backup_lock_age: &quot;{{ ((ansible_date_time.epoch | float - backup_lock.stat.mtime) / 3600) | int }}&quot;</span><span class="diff-line add">+    backup_lock_age: &quot;{{ ((ansible_facts[&#x27;date_time&#x27;][&#x27;epoch&#x27;] | float - backup_lock.stat.mtime) / 3600) | int }}&quot;</span><span class="diff-line context">   when: backup_lock.stat.exists</span><span class="diff-line context"> </span><span class="diff-line context"> # Delete if older than 2 hours.</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-126">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/backup/tasks/snapshot.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -10,22 +10,22 @@</span><span class="diff-line context"> - name: &quot;Snapshot | Determine &#x27;/&#x27; filesystem type&quot;</span><span class="diff-line context">   ansible.builtin.set_fact:</span><span class="diff-line context">     root_fstype: &quot;{{ item.fstype }}&quot;</span><span class="diff-line del">-  when: backup.misc.snapshot and (item.mount == &#x27;/&#x27;)</span><span class="diff-line add">+  when: backup_snapshot_enabled and (item.mount == &#x27;/&#x27;)</span><span class="diff-line context">   with_items:</span><span class="diff-line del">-    - &quot;{{ ansible_mounts }}&quot;</span><span class="diff-line add">+    - &quot;{{ ansible_facts[&#x27;mounts&#x27;] }}&quot;</span><span class="diff-line context"> </span><span class="diff-line del">-- name: &quot;Snapshot | Determine &#x27;/opt&#x27; filesystem type&quot;</span><span class="diff-line add">+- name: &quot;Snapshot | Determine &#x27;{{ server_appdata_path }}&#x27; filesystem type&quot;</span><span class="diff-line context">   ansible.builtin.set_fact:</span><span class="diff-line context">     opt_fstype: &quot;{{ item.fstype }}&quot;</span><span class="diff-line del">-  when: backup.misc.snapshot and (item.mount == &#x27;/opt&#x27;)</span><span class="diff-line add">+  when: backup_snapshot_enabled and (item.mount == server_appdata_path)</span><span class="diff-line context">   with_items:</span><span class="diff-line del">-    - &quot;{{ ansible_mounts }}&quot;</span><span class="diff-line add">+    - &quot;{{ ansible_facts[&#x27;mounts&#x27;] }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # BTRFS</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Snapshot | BTRFS specific tasks</span><span class="diff-line context">   when:</span><span class="diff-line del">-    - backup.misc.snapshot</span><span class="diff-line add">+    - backup_snapshot_enabled</span><span class="diff-line context">     - ((root_fstype is defined) and (root_fstype == &#x27;btrfs&#x27;)) or ((opt_fstype is defined) and (opt_fstype == &#x27;btrfs&#x27;))</span><span class="diff-line context">   block:</span><span class="diff-line context">     - name: &quot;Snapshot | Set general BTRFS variables&quot;</span><span class="diff-line hunk">@@ -37,14 +37,14 @@</span><span class="diff-line context">       ansible.builtin.set_fact:</span><span class="diff-line context">         backup_snapshot_source_path: &quot;/&quot;</span><span class="diff-line context">         backup_snapshot_destination_path: &quot;/btrfs/snapshots/root&quot;</span><span class="diff-line del">-        backup_opt_path: &quot;/btrfs/snapshots/root/opt/&quot;</span><span class="diff-line add">+        backup_opt_path: &quot;/btrfs/snapshots/root{{ server_appdata_path }}/&quot;</span><span class="diff-line context">       when: (root_fstype is defined) and (root_fstype == &#x27;btrfs&#x27;)</span><span class="diff-line context"> </span><span class="diff-line del">-    - name: &quot;Snapshot | Set &#x27;/opt&#x27; BTRFS variables&quot;</span><span class="diff-line add">+    - name: &quot;Snapshot | Set &#x27;{{ server_appdata_path }}&#x27; BTRFS variables&quot;</span><span class="diff-line context">       ansible.builtin.set_fact:</span><span class="diff-line del">-        backup_snapshot_source_path: &quot;/opt&quot;</span><span class="diff-line del">-        backup_snapshot_destination_path: &quot;/opt/snapshots/opt&quot;</span><span class="diff-line del">-        backup_opt_path: &quot;/opt/snapshots/opt/&quot;</span><span class="diff-line add">+        backup_snapshot_source_path: &quot;{{ server_appdata_path }}&quot;</span><span class="diff-line add">+        backup_snapshot_destination_path: &quot;{{ server_appdata_path }}/snapshots/opt&quot;</span><span class="diff-line add">+        backup_opt_path: &quot;{{ server_appdata_path }}/snapshots/opt/&quot;</span><span class="diff-line context">       when: (opt_fstype is defined) and (opt_fstype == &#x27;btrfs&#x27;)</span><span class="diff-line context"> </span><span class="diff-line context">     - name: Snapshot | Check if BTRFS snapshot is mounted</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-127">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/backup2/tasks/main.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -7,6 +7,11 @@</span><span class="diff-line context"> #                   GNU General Public License v3.0                     #</span><span class="diff-line context"> #########################################################################</span><span class="diff-line context"> ---</span><span class="diff-line add">+- name: Import cloudplow role variables</span><span class="diff-line add">+  ansible.builtin.include_tasks: &quot;{{ resources_tasks_path }}/variables/import_role_vars.yml&quot;</span><span class="diff-line add">+  vars:</span><span class="diff-line add">+    import_role_name: cloudplow</span><span class="diff-line add">+</span><span class="diff-line context"> - name: Backup</span><span class="diff-line context">   block:</span><span class="diff-line context">     - name: &quot;Set &#x27;backup2_success&#x27; variable&quot;</span><span class="diff-line hunk">@@ -14,10 +19,10 @@</span><span class="diff-line context">         backup2_success: false</span><span class="diff-line context"> </span><span class="diff-line context">     - name: Sanity Check</span><span class="diff-line del">-      ansible.builtin.import_tasks: &quot;sanity_check.yml&quot;</span><span class="diff-line add">+      ansible.builtin.include_tasks: &quot;sanity_check.yml&quot;</span><span class="diff-line context"> </span><span class="diff-line context">     - name: Variables</span><span class="diff-line del">-      ansible.builtin.import_tasks: &quot;variables.yml&quot;</span><span class="diff-line add">+      ansible.builtin.include_tasks: &quot;variables.yml&quot;</span><span class="diff-line context">       tags:</span><span class="diff-line context">         - set-backup2</span><span class="diff-line context">         - unset-backup2</span><span class="diff-line hunk">@@ -25,8 +30,8 @@</span><span class="diff-line context">         - saltbox-restore-service2</span><span class="diff-line context"> </span><span class="diff-line context">     - name: Cron</span><span class="diff-line del">-      ansible.builtin.import_tasks: &quot;cron.yml&quot;</span><span class="diff-line del">-      when: ([&#x27;set-backup2&#x27;, &#x27;unset-backup2&#x27;] | intersect(ansible_run_tags)) and not (&#x27;backup2&#x27; in ansible_run_tags)</span><span class="diff-line add">+      ansible.builtin.include_tasks: &quot;cron.yml&quot;</span><span class="diff-line add">+      when: (([&#x27;set-backup2&#x27;, &#x27;unset-backup2&#x27;] | intersect(ansible_run_tags)) | length &gt; 0) and not (&#x27;backup2&#x27; in ansible_run_tags)</span><span class="diff-line context">       tags:</span><span class="diff-line context">         - set-backup2</span><span class="diff-line context">         - unset-backup2</span><span class="diff-line hunk">@@ -40,7 +45,7 @@</span><span class="diff-line context">         start_time: &quot;{{ start_time_lookup.stdout }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context">     - name: Snapshot</span><span class="diff-line del">-      ansible.builtin.import_tasks: &quot;snapshot.yml&quot;</span><span class="diff-line add">+      ansible.builtin.include_tasks: &quot;snapshot.yml&quot;</span><span class="diff-line context"> </span><span class="diff-line context">     - name: &quot;Notify | Saltbox Backup: Started Saltbox backup task&quot;</span><span class="diff-line context">       ansible.builtin.include_role:</span><span class="diff-line hunk">@@ -97,8 +102,8 @@</span><span class="diff-line context">       with_items:</span><span class="diff-line context">         - &quot;/home/{{ user.name }}/logs&quot;</span><span class="diff-line context">         - &quot;{{ backup.local.destination }}&quot;</span><span class="diff-line del">-        - &quot;/opt/systemd-backup&quot;</span><span class="diff-line del">-        - &quot;/opt/crontab-backup&quot;</span><span class="diff-line add">+        - &quot;{{ server_appdata_path }}/systemd-backup&quot;</span><span class="diff-line add">+        - &quot;{{ server_appdata_path }}/crontab-backup&quot;</span><span class="diff-line context"> </span><span class="diff-line context">     # Backup config files</span><span class="diff-line context">     - name: &quot;Copy files to &#x27;{{ backup.local.destination }}&#x27;&quot;</span><span class="diff-line hunk">@@ -144,13 +149,13 @@</span><span class="diff-line context">           else (playbook_dir + &#x27;/roles/backup2/files/backup_excludes_list.txt&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context">     - name: saltbox Restore Service</span><span class="diff-line del">-      ansible.builtin.import_tasks: &quot;restore_service.yml&quot;</span><span class="diff-line add">+      ansible.builtin.include_tasks: &quot;restore_service.yml&quot;</span><span class="diff-line context">       when: restore_service_enabled</span><span class="diff-line context">       tags:</span><span class="diff-line context">         - restore-service2</span><span class="diff-line context">         - saltbox-restore-service2</span><span class="diff-line context"> </span><span class="diff-line del">-    - name: &quot;Synchronize &#x27;/etc/systemd/system&#x27; to &#x27;/opt/systemd-backup&#x27; for inclusion in backup&quot;</span><span class="diff-line add">+    - name: &quot;Synchronize &#x27;/etc/systemd/system&#x27; to &#x27;{{ server_appdata_path }}/systemd-backup&#x27; for inclusion in backup&quot;</span><span class="diff-line context">       ansible.builtin.shell: |</span><span class="diff-line context">         /usr/bin/rsync \</span><span class="diff-line context">           --delay-updates \</span><span class="diff-line hunk">@@ -163,13 +168,13 @@</span><span class="diff-line context">           --exclude=&#x27;saltbox_managed_*&#x27; \</span><span class="diff-line context">           --include=&#x27;*.service&#x27; \</span><span class="diff-line context">           --include=&#x27;*.mount&#x27; \</span><span class="diff-line del">-          /etc/systemd/system/* /opt/systemd-backup/</span><span class="diff-line add">+          /etc/systemd/system/* {{ server_appdata_path }}/systemd-backup/</span><span class="diff-line context">       args:</span><span class="diff-line context">         executable: /bin/bash</span><span class="diff-line context">       ignore_errors: true</span><span class="diff-line context"> </span><span class="diff-line del">-    - name: &quot;Copying crontabs to &#x27;/opt/crontab-backup&#x27; for inclusion in backup&quot;</span><span class="diff-line del">-      ansible.builtin.shell: &quot;cp -f /var/spool/cron/crontabs/* /opt/crontab-backup&quot;</span><span class="diff-line add">+    - name: &quot;Copying crontabs to &#x27;{{ server_appdata_path }}/crontab-backup&#x27; for inclusion in backup&quot;</span><span class="diff-line add">+      ansible.builtin.shell: &quot;cp -f /var/spool/cron/crontabs/* {{ server_appdata_path }}/crontab-backup&quot;</span><span class="diff-line context">       ignore_errors: true</span><span class="diff-line context"> </span><span class="diff-line context">     - name: &quot;Reset permissions of folders&quot;</span><span class="diff-line hunk">@@ -181,61 +186,84 @@</span><span class="diff-line context">         mode: &quot;0775&quot;</span><span class="diff-line context">         recurse: true</span><span class="diff-line context">       with_items:</span><span class="diff-line del">-        - &quot;/opt/systemd-backup&quot;</span><span class="diff-line del">-        - &quot;/opt/crontab-backup&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-    # Stop Containers</span><span class="diff-line del">-</span><span class="diff-line del">-    - name: &quot;Gather list of running Docker containers&quot;</span><span class="diff-line del">-      ansible.builtin.shell: &quot;docker ps --format &#x27;{{ &#x27;{{&#x27; }} .Names{{ &#x27;}}&#x27; }}&#x27; --filter label=com.github.saltbox.saltbox_managed=true | xargs echo -n&quot;</span><span class="diff-line del">-      register: docker_containers</span><span class="diff-line del">-      ignore_errors: true</span><span class="diff-line del">-</span><span class="diff-line del">-    - name: Set &#x27;docker_containers&#x27; variable</span><span class="diff-line del">-      ansible.builtin.set_fact:</span><span class="diff-line del">-        docker_containers: &quot;{{ docker_containers.stdout if (docker_containers is success) else &#x27;&#x27; }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-    - name: Docker container tasks</span><span class="diff-line del">-      when: (docker_containers | trim | length &gt; 0)</span><span class="diff-line del">-      block:</span><span class="diff-line del">-        - name: Convert Docker containers string into a list</span><span class="diff-line add">+        - &quot;{{ server_appdata_path }}/systemd-backup&quot;</span><span class="diff-line add">+        - &quot;{{ server_appdata_path }}/crontab-backup&quot;</span><span class="diff-line add">+</span><span class="diff-line add">+    - name: Populate Service Facts</span><span class="diff-line add">+      ansible.builtin.service_facts:</span><span class="diff-line add">+</span><span class="diff-line add">+    - name: Set docker_service_running</span><span class="diff-line add">+      ansible.builtin.set_fact:</span><span class="diff-line add">+        docker_service_running: &quot;{{ (ansible_facts[&#x27;services&#x27;][&#x27;docker.service&#x27;] is defined) and (ansible_facts[&#x27;services&#x27;][&#x27;docker.service&#x27;][&#x27;state&#x27;] == &#x27;running&#x27;) }}&quot;</span><span class="diff-line add">+</span><span class="diff-line add">+    - name: Stop Docker Container Tasks</span><span class="diff-line add">+      when: docker_service_running</span><span class="diff-line add">+      block:</span><span class="diff-line add">+        - name: &quot;Gather Docker container information&quot;</span><span class="diff-line add">+          community.docker.docker_host_info:</span><span class="diff-line add">+            containers: true</span><span class="diff-line add">+            containers_filters:</span><span class="diff-line add">+              label:</span><span class="diff-line add">+                - &quot;com.github.saltbox.saltbox_managed=true&quot;</span><span class="diff-line add">+              status:</span><span class="diff-line add">+                - &quot;running&quot;</span><span class="diff-line add">+          register: docker_info</span><span class="diff-line add">+</span><span class="diff-line add">+        - name: Extract and process container names</span><span class="diff-line context">           ansible.builtin.set_fact:</span><span class="diff-line del">-            docker_containers: &quot;{{ docker_containers.split() | reject(&#x27;in&#x27;, gluetun_instances | default([&#x27;gluetun&#x27;])) | sort }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-        - name: Filter out ignored apps from Docker containers list</span><span class="diff-line add">+            docker_containers: &quot;{{ docker_info.containers | map(attribute=&#x27;Names&#x27;) | map(&#x27;first&#x27;) | map(&#x27;regex_replace&#x27;, &#x27;^/&#x27;, &#x27;&#x27;) | reject(&#x27;in&#x27;, gluetun_instances | default([&#x27;gluetun&#x27;])) | sort }}&quot;</span><span class="diff-line add">+          when:</span><span class="diff-line add">+            - (docker_info is success)</span><span class="diff-line add">+            - (docker_info.containers is defined)</span><span class="diff-line add">+            - (docker_info.containers | length &gt; 0)</span><span class="diff-line add">+</span><span class="diff-line add">+        - name: Set empty list if no containers found</span><span class="diff-line context">           ansible.builtin.set_fact:</span><span class="diff-line del">-            docker_containers: &quot;{{ docker_containers | difference(reverse_proxy_apps + torrent_apps + backup_ignore_containers) }}&quot;</span><span class="diff-line del">-            ignore_containers: &quot;{{ reverse_proxy_apps + torrent_apps + backup_ignore_containers }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-        - name: Convert Docker containers list back to string</span><span class="diff-line del">-          ansible.builtin.set_fact:</span><span class="diff-line del">-            docker_containers_string: &quot;{{ docker_containers | join(&#x27; &#x27;) }}&quot;</span><span class="diff-line del">-            ignore_query_string: &gt;-</span><span class="diff-line del">-              {% if docker_containers | length &gt; 0 and ignore_containers | length &gt; 0 %}</span><span class="diff-line del">-                {%- set ignore_params = [] -%}</span><span class="diff-line del">-                {% for container in ignore_containers %}</span><span class="diff-line del">-                  {%- set _ = ignore_params.append(&#x27;ignore=&#x27; ~ container) -%}</span><span class="diff-line del">-                {%- endfor -%}</span><span class="diff-line del">-                {{ ignore_params | join(&#x27;&amp;&#x27;) }}</span><span class="diff-line del">-              {%- else -%}</span><span class="diff-line del">-              {% endif %}</span><span class="diff-line del">-</span><span class="diff-line del">-        - name: Stop Saltbox Docker containers</span><span class="diff-line del">-          ansible.builtin.include_tasks: &quot;{{ resources_tasks_path }}/docker/stop_saltbox_docker_containers.yml&quot;</span><span class="diff-line del">-          vars:</span><span class="diff-line del">-            _query_var: &quot;{{ &#x27;?&#x27; + ignore_query_string if (ignore_query_string | length &gt; 0) else &#x27;&#x27; }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-        - name: &quot;Stop all running Docker containers&quot;</span><span class="diff-line del">-          ansible.builtin.shell: &quot;docker stop {{ docker_containers_string }}&quot;</span><span class="diff-line del">-          ignore_errors: true</span><span class="diff-line del">-          when: (docker_containers_string | trim | length &gt; 0)</span><span class="diff-line del">-</span><span class="diff-line del">-        - name: &quot;Notify | Saltbox Backup: Stopped Docker containers&quot;</span><span class="diff-line del">-          ansible.builtin.include_role:</span><span class="diff-line del">-            name: notify</span><span class="diff-line del">-          vars:</span><span class="diff-line del">-            message: &quot;{{ backup_instance }} Backup: Stopped Docker containers.&quot;</span><span class="diff-line del">-          when: backup_notify_stop_docker_containers</span><span class="diff-line add">+            docker_containers: []</span><span class="diff-line add">+          when: (docker_info is not success) or (docker_info.containers is not defined) or (docker_info.containers | length == 0)</span><span class="diff-line add">+</span><span class="diff-line add">+        - name: Docker container tasks</span><span class="diff-line add">+          when: (docker_containers | length &gt; 0)</span><span class="diff-line add">+          block:</span><span class="diff-line add">+            - name: Build list of containers to ignore</span><span class="diff-line add">+              ansible.builtin.set_fact:</span><span class="diff-line add">+                ignore_containers: &quot;{{ reverse_proxy_apps + torrent_apps + backup2_ignore_containers }}&quot;</span><span class="diff-line add">+</span><span class="diff-line add">+            - name: Filter out ignored apps from Docker containers list</span><span class="diff-line add">+              ansible.builtin.set_fact:</span><span class="diff-line add">+                docker_containers: &quot;{{ docker_containers | difference(ignore_containers) }}&quot;</span><span class="diff-line add">+</span><span class="diff-line add">+            - name: Convert Docker containers list back to string</span><span class="diff-line add">+              ansible.builtin.set_fact:</span><span class="diff-line add">+                docker_containers_string: &quot;{{ docker_containers | join(&#x27; &#x27;) }}&quot;</span><span class="diff-line add">+                ignore_query_string: &gt;-</span><span class="diff-line add">+                  {% if docker_containers | length &gt; 0 and ignore_containers | length &gt; 0 %}</span><span class="diff-line add">+                    {%- set ignore_params = [] -%}</span><span class="diff-line add">+                    {% for container in ignore_containers %}</span><span class="diff-line add">+                      {%- set _ = ignore_params.append(&#x27;ignore=&#x27; ~ container) -%}</span><span class="diff-line add">+                    {%- endfor -%}</span><span class="diff-line add">+                    {{ ignore_params | join(&#x27;&amp;&#x27;) }}</span><span class="diff-line add">+                  {%- else -%}</span><span class="diff-line add">+                  {% endif %}</span><span class="diff-line add">+</span><span class="diff-line add">+            - name: Stop Saltbox Docker containers</span><span class="diff-line add">+              ansible.builtin.include_tasks: &quot;{{ resources_tasks_path }}/docker/stop_saltbox_docker_containers.yml&quot;</span><span class="diff-line add">+              vars:</span><span class="diff-line add">+                _query_var: &quot;{{ &#x27;?&#x27; + ignore_query_string</span><span class="diff-line add">+                            if (ignore_query_string | length &gt; 0)</span><span class="diff-line add">+                            else &#x27;&#x27; }}&quot;</span><span class="diff-line add">+</span><span class="diff-line add">+            - name: &quot;Stop all running Docker containers&quot;</span><span class="diff-line add">+              ansible.builtin.shell: &quot;docker stop {{ docker_containers_string }}&quot;</span><span class="diff-line add">+              ignore_errors: true</span><span class="diff-line add">+              when: (docker_containers_string | trim | length &gt; 0)</span><span class="diff-line add">+</span><span class="diff-line add">+            - name: &quot;Notify | Saltbox Backup: Stopped Docker containers&quot;</span><span class="diff-line add">+              ansible.builtin.include_role:</span><span class="diff-line add">+                name: notify</span><span class="diff-line add">+              vars:</span><span class="diff-line add">+                message: &quot;{{ backup_instance }} Backup: Stopped Docker containers.&quot;</span><span class="diff-line add">+              when: backup_notify_stop_docker_containers</span><span class="diff-line context"> </span><span class="diff-line context">     # Custom User Files</span><span class="diff-line context"> </span><span class="diff-line hunk">@@ -252,16 +280,11 @@</span><span class="diff-line context">       ignore_errors: true</span><span class="diff-line context">       when: (backup2_user_defined_files | length &gt; 0)</span><span class="diff-line context"> </span><span class="diff-line del">-    # Services</span><span class="diff-line del">-</span><span class="diff-line del">-    - name: Populate Service Facts</span><span class="diff-line del">-      ansible.builtin.service_facts:</span><span class="diff-line del">-</span><span class="diff-line del">-      # Stop Cloudplow</span><span class="diff-line add">+    # Stop Cloudplow</span><span class="diff-line context"> </span><span class="diff-line context">     - name: Check if &#x27;cloudplow.service&#x27; exists</span><span class="diff-line context">       ansible.builtin.stat:</span><span class="diff-line del">-        path: &quot;/etc/systemd/system/cloudplow.service&quot;</span><span class="diff-line add">+        path: &quot;/etc/systemd/system/{{ cloudplow_service_name }}.service&quot;</span><span class="diff-line context">       register: cloudplow_service</span><span class="diff-line context"> </span><span class="diff-line context">     - name: Stop &#x27;cloudplow&#x27; service block</span><span class="diff-line hunk">@@ -269,18 +292,18 @@</span><span class="diff-line context">       block:</span><span class="diff-line context">         - name: Get &#x27;cloudplow&#x27; service state</span><span class="diff-line context">           ansible.builtin.set_fact:</span><span class="diff-line del">-            cloudplow_service_running: &quot;{{ (services[&#x27;cloudplow.service&#x27;] is defined) and (services[&#x27;cloudplow.service&#x27;][&#x27;state&#x27;] == &#x27;running&#x27;) }}&quot;</span><span class="diff-line add">+            cloudplow_service_running: &quot;{{ (ansible_facts[&#x27;services&#x27;][cloudplow_service_name + &#x27;.service&#x27;] is defined) and (ansible_facts[&#x27;services&#x27;][cloudplow_service_name + &#x27;.service&#x27;][&#x27;state&#x27;] == &#x27;running&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context">         - name: Stop &#x27;cloudplow&#x27; service</span><span class="diff-line context">           ansible.builtin.systemd_service:</span><span class="diff-line del">-            name: cloudplow</span><span class="diff-line add">+            name: &quot;{{ cloudplow_service_name }}&quot;</span><span class="diff-line context">             state: stopped</span><span class="diff-line context">           when: cloudplow_service_running</span><span class="diff-line context"> </span><span class="diff-line context">     # Create snapshot</span><span class="diff-line context"> </span><span class="diff-line context">     - name: Create Snapshot</span><span class="diff-line del">-      when: use_snapshot</span><span class="diff-line add">+      when: docker_service_running and use_snapshot</span><span class="diff-line context">       block:</span><span class="diff-line context">         - name: &quot;Snapshot | Wait for 5 seconds before creating snapshot&quot;</span><span class="diff-line context">           ansible.builtin.wait_for:</span><span class="diff-line hunk">@@ -353,7 +376,7 @@</span><span class="diff-line context">       become_user: &quot;{{ user.name }}&quot;</span><span class="diff-line context">       register: rclone_timestamp</span><span class="diff-line context">       ignore_errors: true</span><span class="diff-line del">-      when: backup.rclone.enable</span><span class="diff-line add">+      when: backup_rclone_enabled</span><span class="diff-line context"> </span><span class="diff-line context">     - name: Define Archive List</span><span class="diff-line context">       ansible.builtin.set_fact:</span><span class="diff-line hunk">@@ -384,7 +407,7 @@</span><span class="diff-line context">       register: rclone_move</span><span class="diff-line context">       failed_when: rclone_move.rc &gt; 3</span><span class="diff-line context">       ignore_errors: true</span><span class="diff-line del">-      when: backup.rclone.enable and (rclone_timestamp is defined) and (&#x27;Failed&#x27; not in rclone_timestamp.stderr)</span><span class="diff-line add">+      when: backup_rclone_enabled and (rclone_timestamp is defined) and (&#x27;Failed&#x27; not in rclone_timestamp.stderr)</span><span class="diff-line context">       loop: &quot;{{ backup_archive_list + (backup2_user_defined_files | map(&#x27;basename&#x27;) | list) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context">     - name: &quot;Use rclone to upload backup to &#x27;{{ backup.rclone.destination }}&#x27;&quot;</span><span class="diff-line hunk">@@ -393,7 +416,7 @@</span><span class="diff-line context">       environment: &quot;{{ backup2_rclone_env }}&quot;</span><span class="diff-line context">       become: true</span><span class="diff-line context">       become_user: &quot;{{ user.name }}&quot;</span><span class="diff-line del">-      when: backup.rclone.enable</span><span class="diff-line add">+      when: backup_rclone_enabled</span><span class="diff-line context"> </span><span class="diff-line context">     - name: &quot;Wait for 5 seconds before uploading&quot;</span><span class="diff-line context">       ansible.builtin.wait_for:</span><span class="diff-line hunk">@@ -412,14 +435,14 @@</span><span class="diff-line context">       environment: &quot;{{ backup2_rclone_env }}&quot;</span><span class="diff-line context">       become: true</span><span class="diff-line context">       become_user: &quot;{{ user.name }}&quot;</span><span class="diff-line del">-      when: backup.rclone.enable</span><span class="diff-line add">+      when: backup_rclone_enabled</span><span class="diff-line context"> </span><span class="diff-line context">     - name: &quot;Run items asynchronously in batches of {{ backup2_async_batch_size }} items&quot;</span><span class="diff-line context">       ansible.builtin.include_tasks: upload.yml</span><span class="diff-line context">       vars:</span><span class="diff-line context">         folders: &quot;{{ item }}&quot;</span><span class="diff-line context">       loop: &quot;{{ opt_folders | batch(backup2_async_batch_size | int) | list }}&quot;</span><span class="diff-line del">-      when: backup.rclone.enable</span><span class="diff-line add">+      when: backup_rclone_enabled</span><span class="diff-line context"> </span><span class="diff-line context">     - name: Cleanup sync cache # noqa args[module]</span><span class="diff-line context">       ansible.builtin.async_status:</span><span class="diff-line hunk">@@ -436,7 +459,7 @@</span><span class="diff-line context">         name: notify</span><span class="diff-line context">       vars:</span><span class="diff-line context">         message: &quot;{{ backup_instance }} Backup: Rclone uploaded backup to &#x27;{{ backup.rclone.destination }}&#x27;.&quot;</span><span class="diff-line del">-      when: backup.rclone.enable and backup_notify_rclone_complete</span><span class="diff-line add">+      when: backup_rclone_enabled and backup_notify_rclone_complete</span><span class="diff-line context"> </span><span class="diff-line context">     - name: Snapshot | Cleanup Tasks</span><span class="diff-line context">       when: use_snapshot and (snapshot_type == &#x27;btrfs&#x27;)</span><span class="diff-line hunk">@@ -464,7 +487,7 @@</span><span class="diff-line context">     # Start Docker containers when snapshot is not enabled</span><span class="diff-line context"> </span><span class="diff-line context">     - name: Start Docker Containers</span><span class="diff-line del">-      when: (not use_snapshot)</span><span class="diff-line add">+      when: docker_service_running and (not use_snapshot)</span><span class="diff-line context">       block:</span><span class="diff-line context">         - name: &quot;Wait for 5 seconds before starting Docker containers&quot;</span><span class="diff-line context">           ansible.builtin.wait_for:</span><span class="diff-line hunk">@@ -524,7 +547,7 @@</span><span class="diff-line context"> </span><span class="diff-line context">     - name: &quot;Start &#x27;cloudplow&#x27; service&quot;</span><span class="diff-line context">       ansible.builtin.systemd_service:</span><span class="diff-line del">-        name: cloudplow</span><span class="diff-line add">+        name: &quot;{{ cloudplow_service_name }}&quot;</span><span class="diff-line context">         state: started</span><span class="diff-line context">       when: (cloudplow_service is defined) and (cloudplow_service.stat.exists) and (cloudplow_service_running)</span><span class="diff-line context"> </span><span class="diff-line hunk">@@ -561,7 +584,7 @@</span><span class="diff-line context">               when: (snapshot_deletion is failed)</span><span class="diff-line context"> </span><span class="diff-line context">     - name: Start Docker Containers</span><span class="diff-line del">-      when: (not use_snapshot)</span><span class="diff-line add">+      when: docker_service_running and (not use_snapshot)</span><span class="diff-line context">       block:</span><span class="diff-line context">         - name: &quot;Wait for 5 seconds before starting Docker containers&quot;</span><span class="diff-line context">           ansible.builtin.wait_for:</span><span class="diff-line hunk">@@ -578,7 +601,7 @@</span><span class="diff-line context"> </span><span class="diff-line context">     - name: &quot;Start &#x27;cloudplow&#x27; service&quot;</span><span class="diff-line context">       ansible.builtin.systemd_service:</span><span class="diff-line del">-        name: cloudplow</span><span class="diff-line add">+        name: &quot;{{ cloudplow_service_name }}&quot;</span><span class="diff-line context">         state: started</span><span class="diff-line context">       when: (cloudplow_service is defined) and cloudplow_service.stat.exists and cloudplow_service_running</span><span class="diff-line context"> </span><span class="diff-line hunk">@@ -602,7 +625,7 @@</span><span class="diff-line context">       ansible.builtin.shell: &quot;chown -R {{ user.name }}:{{ user.name }} &#x27;/home/{{ user.name }}/logs/&#x27;&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Backup Cleanup Block</span><span class="diff-line del">-  when: backup.rclone.enable and backup2_cleanup_enabled and backup2_success</span><span class="diff-line add">+  when: backup_rclone_enabled and backup2_cleanup_enabled and backup2_success</span><span class="diff-line context">   block:</span><span class="diff-line context">     - name: Determine number of existing backups</span><span class="diff-line context">       ansible.builtin.shell: &gt;</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-128">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/backup2/tasks/restore_service.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -10,7 +10,7 @@</span><span class="diff-line context"> - name: Restore Service | Install &#x27;curl&#x27;</span><span class="diff-line context">   ansible.builtin.apt:</span><span class="diff-line context">     name: curl</span><span class="diff-line del">-    state: present</span><span class="diff-line add">+    state: latest</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Restore Service | Set variables</span><span class="diff-line context">   ansible.builtin.set_fact:</span><span class="diff-line hunk">@@ -123,7 +123,7 @@</span><span class="diff-line context">           {{ files_upload.results | selectattr(&#x27;stdout&#x27;, &#x27;search&#x27;, &#x27;too large&#x27;) | map(attribute=&#x27;item&#x27;)</span><span class="diff-line context">           | map(&#x27;regex_replace&#x27;, &#x27;^/tmp/restore_service/|.enc$&#x27;, &#x27;&#x27;) | list | sort(case_sensitive=False) | join(&#x27;, &#x27;) }}</span><span class="diff-line context"> </span><span class="diff-line del">-    - name: Restore Service | Print error mesage when config file(s) were too large to upload</span><span class="diff-line add">+    - name: Restore Service | Print error message when config file(s) were too large to upload</span><span class="diff-line context">       ansible.builtin.debug:</span><span class="diff-line context">         msg: &quot;The following encrypted config file(s) were too large to upload to the Saltbox Restore Service: &#x27;{{ files_too_large_to_upload_list | trim }}&#x27;&quot;</span><span class="diff-line context">       when: (files_too_large_to_upload_list | trim | length &gt; 0)</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-129">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/backup2/tasks/sanity_check.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -15,7 +15,7 @@</span><span class="diff-line context"> # Age in hours</span><span class="diff-line context"> - name: &quot;Get age of &#x27;backup.lock&#x27; file&quot;</span><span class="diff-line context">   ansible.builtin.set_fact:</span><span class="diff-line del">-    backup_lock_age: &quot;{{ ((ansible_date_time.epoch | float - backup_lock.stat.mtime) / 3600) | int }}&quot;</span><span class="diff-line add">+    backup_lock_age: &quot;{{ ((ansible_facts[&#x27;date_time&#x27;][&#x27;epoch&#x27;] | float - backup_lock.stat.mtime) / 3600) | int }}&quot;</span><span class="diff-line context">   when: backup_lock.stat.exists</span><span class="diff-line context"> </span><span class="diff-line context"> # Delete if older than 2 hours.</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-130">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/backup2/tasks/snapshot.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -10,22 +10,22 @@</span><span class="diff-line context"> - name: &quot;Snapshot | Determine &#x27;/&#x27; filesystem type&quot;</span><span class="diff-line context">   ansible.builtin.set_fact:</span><span class="diff-line context">     root_fstype: &quot;{{ item.fstype }}&quot;</span><span class="diff-line del">-  when: backup.misc.snapshot and (item.mount == &#x27;/&#x27;)</span><span class="diff-line add">+  when: backup_snapshot_enabled and (item.mount == &#x27;/&#x27;)</span><span class="diff-line context">   with_items:</span><span class="diff-line del">-    - &quot;{{ ansible_mounts }}&quot;</span><span class="diff-line add">+    - &quot;{{ ansible_facts[&#x27;mounts&#x27;] }}&quot;</span><span class="diff-line context"> </span><span class="diff-line del">-- name: &quot;Snapshot | Determine &#x27;/opt&#x27; filesystem type&quot;</span><span class="diff-line add">+- name: &quot;Snapshot | Determine &#x27;{{ server_appdata_path }}&#x27; filesystem type&quot;</span><span class="diff-line context">   ansible.builtin.set_fact:</span><span class="diff-line context">     opt_fstype: &quot;{{ item.fstype }}&quot;</span><span class="diff-line del">-  when: backup.misc.snapshot and (item.mount == &#x27;/opt&#x27;)</span><span class="diff-line add">+  when: backup_snapshot_enabled and (item.mount == server_appdata_path)</span><span class="diff-line context">   with_items:</span><span class="diff-line del">-    - &quot;{{ ansible_mounts }}&quot;</span><span class="diff-line add">+    - &quot;{{ ansible_facts[&#x27;mounts&#x27;] }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # BTRFS</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Snapshot | BTRFS specific tasks</span><span class="diff-line context">   when:</span><span class="diff-line del">-    - backup.misc.snapshot</span><span class="diff-line add">+    - backup_snapshot_enabled</span><span class="diff-line context">     - ((root_fstype is defined) and (root_fstype == &#x27;btrfs&#x27;)) or ((opt_fstype is defined) and (opt_fstype == &#x27;btrfs&#x27;))</span><span class="diff-line context">   block:</span><span class="diff-line context">     - name: &quot;Snapshot | Set general BTRFS variables&quot;</span><span class="diff-line hunk">@@ -37,14 +37,14 @@</span><span class="diff-line context">       ansible.builtin.set_fact:</span><span class="diff-line context">         backup_snapshot_source_path: &quot;/&quot;</span><span class="diff-line context">         backup_snapshot_destination_path: &quot;/btrfs/snapshots/root&quot;</span><span class="diff-line del">-        backup_opt_path: &quot;/btrfs/snapshots/root/opt/&quot;</span><span class="diff-line add">+        backup_opt_path: &quot;/btrfs/snapshots/root{{ server_appdata_path }}/&quot;</span><span class="diff-line context">       when: (root_fstype is defined) and (root_fstype == &#x27;btrfs&#x27;)</span><span class="diff-line context"> </span><span class="diff-line del">-    - name: &quot;Snapshot | Set &#x27;/opt&#x27; BTRFS variables&quot;</span><span class="diff-line add">+    - name: &quot;Snapshot | Set &#x27;{{ server_appdata_path }}&#x27; BTRFS variables&quot;</span><span class="diff-line context">       ansible.builtin.set_fact:</span><span class="diff-line del">-        backup_snapshot_source_path: &quot;/opt&quot;</span><span class="diff-line del">-        backup_snapshot_destination_path: &quot;/opt/snapshots/opt&quot;</span><span class="diff-line del">-        backup_opt_path: &quot;/opt/snapshots/opt/&quot;</span><span class="diff-line add">+        backup_snapshot_source_path: &quot;{{ server_appdata_path }}&quot;</span><span class="diff-line add">+        backup_snapshot_destination_path: &quot;{{ server_appdata_path }}/snapshots/opt&quot;</span><span class="diff-line add">+        backup_opt_path: &quot;{{ server_appdata_path }}/snapshots/opt/&quot;</span><span class="diff-line context">       when: (opt_fstype is defined) and (opt_fstype == &#x27;btrfs&#x27;)</span><span class="diff-line context"> </span><span class="diff-line context">     - name: Snapshot | Check if BTRFS snapshot is mounted</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-131">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/backup2/tasks/upload.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -11,7 +11,7 @@</span><span class="diff-line context">       {{ &quot;--user-agent=&#x27;&quot; + backup2_user_agent + &quot;&#x27;&quot; if (backup2_user_agent | length &gt; 0) else &quot;&quot; }} \</span><span class="diff-line context">       {{ lookup(&#x27;vars&#x27;, &#x27;backup2_&#x27; + backup.rclone.template + &#x27;_template&#x27;, default=&#x27;&#x27;) }} \</span><span class="diff-line context">       --stats=30s \</span><span class="diff-line del">-      {{ &#x27;--bind=&#x27; + ansible_default_ipv4.address if mounts.ipv4_only else &#x27;&#x27; }} \</span><span class="diff-line add">+      {{ &#x27;--bind=&#x27; + ansible_facts[&#x27;default_ipv4&#x27;][&#x27;address&#x27;] if rclone_mounts_ipv4_only else &#x27;&#x27; }} \</span><span class="diff-line context">       --bwlimit={{ backup2_rclone_upload_speed_limit }} \</span><span class="diff-line context">       -vv \</span><span class="diff-line context">       --log-file=&#x27;{{ playbook_dir }}/backup_rclone.log&#x27; \</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-132">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/bazarr/defaults/main.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -17,158 +17,115 @@</span><span class="diff-line context"> # Paths</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-bazarr_paths_folder: &quot;{{ bazarr_name }}&quot;</span><span class="diff-line del">-bazarr_paths_location: &quot;{{ server_appdata_path }}/{{ bazarr_paths_folder }}&quot;</span><span class="diff-line del">-bazarr_paths_folders_list:</span><span class="diff-line del">-  - &quot;{{ bazarr_paths_location }}&quot;</span><span class="diff-line add">+bazarr_role_paths_folder: &quot;{{ bazarr_name }}&quot;</span><span class="diff-line add">+bazarr_role_paths_location: &quot;{{ server_appdata_path }}/{{ bazarr_role_paths_folder }}&quot;</span><span class="diff-line add">+bazarr_role_paths_folders_list:</span><span class="diff-line add">+  - &quot;{{ bazarr_role_paths_location }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # Web</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-bazarr_web_subdomain: &quot;{{ bazarr_name }}&quot;</span><span class="diff-line del">-bazarr_web_domain: &quot;{{ user.domain }}&quot;</span><span class="diff-line del">-bazarr_web_port: &quot;6767&quot;</span><span class="diff-line del">-bazarr_web_url: &quot;{{ &#x27;https://&#x27; + (lookup(&#x27;vars&#x27;, bazarr_name + &#x27;_web_subdomain&#x27;, default=bazarr_web_subdomain) + &#x27;.&#x27; + lookup(&#x27;vars&#x27;, bazarr_name + &#x27;_web_domain&#x27;, default=bazarr_web_domain)</span><span class="diff-line del">-                 if (lookup(&#x27;vars&#x27;, bazarr_name + &#x27;_web_subdomain&#x27;, default=bazarr_web_subdomain) | length &gt; 0)</span><span class="diff-line del">-                 else lookup(&#x27;vars&#x27;, bazarr_name + &#x27;_web_domain&#x27;, default=bazarr_web_domain)) }}&quot;</span><span class="diff-line add">+bazarr_role_web_subdomain: &quot;{{ bazarr_name }}&quot;</span><span class="diff-line add">+bazarr_role_web_domain: &quot;{{ user.domain }}&quot;</span><span class="diff-line add">+bazarr_role_web_port: &quot;6767&quot;</span><span class="diff-line add">+bazarr_role_web_url: &quot;{{ &#x27;https://&#x27; + (lookup(&#x27;role_var&#x27;, &#x27;_web_subdomain&#x27;, role=&#x27;bazarr&#x27;) + &#x27;.&#x27; + lookup(&#x27;role_var&#x27;, &#x27;_web_domain&#x27;, role=&#x27;bazarr&#x27;)</span><span class="diff-line add">+                      if (lookup(&#x27;role_var&#x27;, &#x27;_web_subdomain&#x27;, role=&#x27;bazarr&#x27;) | length &gt; 0)</span><span class="diff-line add">+                      else lookup(&#x27;role_var&#x27;, &#x27;_web_domain&#x27;, role=&#x27;bazarr&#x27;)) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # DNS</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-bazarr_dns_record: &quot;{{ lookup(&#x27;vars&#x27;, bazarr_name + &#x27;_web_subdomain&#x27;, default=bazarr_web_subdomain) }}&quot;</span><span class="diff-line del">-bazarr_dns_zone: &quot;{{ lookup(&#x27;vars&#x27;, bazarr_name + &#x27;_web_domain&#x27;, default=bazarr_web_domain) }}&quot;</span><span class="diff-line del">-bazarr_dns_proxy: &quot;{{ dns.proxied }}&quot;</span><span class="diff-line add">+bazarr_role_dns_record: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_web_subdomain&#x27;, role=&#x27;bazarr&#x27;) }}&quot;</span><span class="diff-line add">+bazarr_role_dns_zone: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_web_domain&#x27;, role=&#x27;bazarr&#x27;) }}&quot;</span><span class="diff-line add">+bazarr_role_dns_proxy: &quot;{{ dns_proxied }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # Traefik</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-bazarr_traefik_sso_middleware: &quot;{{ traefik_default_sso_middleware }}&quot;</span><span class="diff-line del">-bazarr_traefik_middleware_default: &quot;{{ traefik_default_middleware</span><span class="diff-line del">-                                       + (&#x27;,themepark-&#x27; + lookup(&#x27;vars&#x27;, bazarr_name + &#x27;_name&#x27;, default=bazarr_name)</span><span class="diff-line del">-                                         if (bazarr_themepark_enabled and global_themepark_plugin_enabled)</span><span class="diff-line del">-                                         else &#x27;&#x27;) }}&quot;</span><span class="diff-line del">-bazarr_traefik_middleware_custom: &quot;&quot;</span><span class="diff-line del">-bazarr_traefik_certresolver: &quot;{{ traefik_default_certresolver }}&quot;</span><span class="diff-line del">-bazarr_traefik_enabled: true</span><span class="diff-line del">-bazarr_traefik_api_enabled: true</span><span class="diff-line del">-bazarr_traefik_api_endpoint: &quot;PathPrefix(`/api`)&quot;</span><span class="diff-line add">+bazarr_role_traefik_sso_middleware: &quot;{{ traefik_default_sso_middleware }}&quot;</span><span class="diff-line add">+bazarr_role_traefik_middleware_default: &quot;{{ traefik_default_middleware</span><span class="diff-line add">+                                            + (&#x27;,themepark-&#x27; + bazarr_name</span><span class="diff-line add">+                                              if (lookup(&#x27;role_var&#x27;, &#x27;_themepark_enabled&#x27;, role=&#x27;bazarr&#x27;) and global_themepark_plugin_enabled)</span><span class="diff-line add">+                                              else &#x27;&#x27;) }}&quot;</span><span class="diff-line add">+bazarr_role_traefik_middleware_custom: &quot;&quot;</span><span class="diff-line add">+bazarr_role_traefik_certresolver: &quot;{{ traefik_default_certresolver }}&quot;</span><span class="diff-line add">+bazarr_role_traefik_enabled: true</span><span class="diff-line add">+bazarr_role_traefik_api_enabled: true</span><span class="diff-line add">+bazarr_role_traefik_api_endpoint: &quot;PathPrefix(`/api`)&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line del">-# THEME</span><span class="diff-line add">+# Theme</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line context"> # Options can be found at https://github.com/themepark-dev/theme.park</span><span class="diff-line del">-bazarr_themepark_enabled: false</span><span class="diff-line del">-bazarr_themepark_app: &quot;bazarr&quot;</span><span class="diff-line del">-bazarr_themepark_theme: &quot;{{ global_themepark_theme }}&quot;</span><span class="diff-line del">-bazarr_themepark_domain: &quot;{{ global_themepark_domain }}&quot;</span><span class="diff-line del">-bazarr_themepark_addons: []</span><span class="diff-line add">+bazarr_role_themepark_enabled: false</span><span class="diff-line add">+bazarr_role_themepark_app: &quot;bazarr&quot;</span><span class="diff-line add">+bazarr_role_themepark_theme: &quot;{{ global_themepark_theme }}&quot;</span><span class="diff-line add">+bazarr_role_themepark_domain: &quot;{{ global_themepark_domain }}&quot;</span><span class="diff-line add">+bazarr_role_themepark_addons: []</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # Docker</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line context"> # Container</span><span class="diff-line del">-bazarr_docker_container: &quot;{{ bazarr_name }}&quot;</span><span class="diff-line add">+bazarr_role_docker_container: &quot;{{ bazarr_name }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Image</span><span class="diff-line del">-bazarr_docker_image_pull: true</span><span class="diff-line del">-bazarr_docker_image_repo: &quot;ghcr.io/hotio/bazarr&quot;</span><span class="diff-line del">-bazarr_docker_image_tag: &quot;latest&quot;</span><span class="diff-line del">-bazarr_docker_image: &quot;{{ lookup(&#x27;vars&#x27;, bazarr_name + &#x27;_docker_image_repo&#x27;, default=bazarr_docker_image_repo)</span><span class="diff-line del">-                         + &#x27;:&#x27; + lookup(&#x27;vars&#x27;, bazarr_name + &#x27;_docker_image_tag&#x27;, default=bazarr_docker_image_tag) }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Ports</span><span class="diff-line del">-bazarr_docker_ports_defaults: []</span><span class="diff-line del">-bazarr_docker_ports_custom: []</span><span class="diff-line del">-bazarr_docker_ports: &quot;{{ lookup(&#x27;vars&#x27;, bazarr_name + &#x27;_docker_ports_defaults&#x27;, default=bazarr_docker_ports_defaults)</span><span class="diff-line del">-                         + lookup(&#x27;vars&#x27;, bazarr_name + &#x27;_docker_ports_custom&#x27;, default=bazarr_docker_ports_custom) }}&quot;</span><span class="diff-line add">+bazarr_role_docker_image_pull: true</span><span class="diff-line add">+bazarr_role_docker_image_repo: &quot;ghcr.io/hotio/bazarr&quot;</span><span class="diff-line add">+bazarr_role_docker_image_tag: &quot;latest&quot;</span><span class="diff-line add">+bazarr_role_docker_image: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_image_repo&#x27;, role=&#x27;bazarr&#x27;) }}:{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_image_tag&#x27;, role=&#x27;bazarr&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Envs</span><span class="diff-line del">-bazarr_docker_envs_default:</span><span class="diff-line add">+bazarr_role_docker_envs_default:</span><span class="diff-line context">   PUID: &quot;{{ uid }}&quot;</span><span class="diff-line context">   PGID: &quot;{{ gid }}&quot;</span><span class="diff-line context">   UMASK: &quot;002&quot;</span><span class="diff-line context">   TZ: &quot;{{ tz }}&quot;</span><span class="diff-line del">-bazarr_docker_envs_custom: {}</span><span class="diff-line del">-bazarr_docker_envs: &quot;{{ lookup(&#x27;vars&#x27;, bazarr_name + &#x27;_docker_envs_default&#x27;, default=bazarr_docker_envs_default)</span><span class="diff-line del">-                        | combine(lookup(&#x27;vars&#x27;, bazarr_name + &#x27;_docker_envs_custom&#x27;, default=bazarr_docker_envs_custom)) }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Commands</span><span class="diff-line del">-bazarr_docker_commands_default: []</span><span class="diff-line del">-bazarr_docker_commands_custom: []</span><span class="diff-line del">-bazarr_docker_commands: &quot;{{ lookup(&#x27;vars&#x27;, bazarr_name + &#x27;_docker_commands_default&#x27;, default=bazarr_docker_commands_default)</span><span class="diff-line del">-                            + lookup(&#x27;vars&#x27;, bazarr_name + &#x27;_docker_commands_custom&#x27;, default=bazarr_docker_commands_custom) }}&quot;</span><span class="diff-line add">+bazarr_role_docker_envs_custom: {}</span><span class="diff-line add">+bazarr_role_docker_envs: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_envs_default&#x27;, role=&#x27;bazarr&#x27;)</span><span class="diff-line add">+                             | combine(lookup(&#x27;role_var&#x27;, &#x27;_docker_envs_custom&#x27;, role=&#x27;bazarr&#x27;)) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Volumes</span><span class="diff-line del">-bazarr_docker_volumes_default:</span><span class="diff-line del">-  - &quot;{{ bazarr_paths_location }}:/config&quot;</span><span class="diff-line del">-  - &quot;/opt/scripts:/scripts&quot;</span><span class="diff-line del">-bazarr_docker_volumes_legacy:</span><span class="diff-line add">+bazarr_role_docker_volumes_default:</span><span class="diff-line add">+  - &quot;{{ bazarr_role_paths_location }}:/config&quot;</span><span class="diff-line add">+  - &quot;{{ server_appdata_path }}/scripts:/scripts&quot;</span><span class="diff-line add">+bazarr_role_docker_volumes_legacy:</span><span class="diff-line context">   - &quot;/mnt/unionfs/Media/Movies:/movies&quot;</span><span class="diff-line context">   - &quot;/mnt/unionfs/Media/TV:/tv&quot;</span><span class="diff-line del">-bazarr_docker_volumes_custom: []</span><span class="diff-line del">-bazarr_docker_volumes: &quot;{{ lookup(&#x27;vars&#x27;, bazarr_name + &#x27;_docker_volumes_default&#x27;, default=bazarr_docker_volumes_default)</span><span class="diff-line del">-                           + lookup(&#x27;vars&#x27;, bazarr_name + &#x27;_docker_volumes_custom&#x27;, default=bazarr_docker_volumes_custom)</span><span class="diff-line del">-                           + (lookup(&#x27;vars&#x27;, bazarr_name + &#x27;_docker_volumes_legacy&#x27;, default=bazarr_docker_volumes_legacy)</span><span class="diff-line del">-                             if docker_legacy_volume</span><span class="diff-line del">-                             else []) }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Devices</span><span class="diff-line del">-bazarr_docker_devices_default: []</span><span class="diff-line del">-bazarr_docker_devices_custom: []</span><span class="diff-line del">-bazarr_docker_devices: &quot;{{ lookup(&#x27;vars&#x27;, bazarr_name + &#x27;_docker_devices_default&#x27;, default=bazarr_docker_devices_default)</span><span class="diff-line del">-                           + lookup(&#x27;vars&#x27;, bazarr_name + &#x27;_docker_devices_custom&#x27;, default=bazarr_docker_devices_custom) }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Hosts</span><span class="diff-line del">-bazarr_docker_hosts_default: {}</span><span class="diff-line del">-bazarr_docker_hosts_custom: {}</span><span class="diff-line del">-bazarr_docker_hosts: &quot;{{ docker_hosts_common</span><span class="diff-line del">-                         | combine(lookup(&#x27;vars&#x27;, bazarr_name + &#x27;_docker_hosts_default&#x27;, default=bazarr_docker_hosts_default))</span><span class="diff-line del">-                         | combine(lookup(&#x27;vars&#x27;, bazarr_name + &#x27;_docker_hosts_custom&#x27;, default=bazarr_docker_hosts_custom)) }}&quot;</span><span class="diff-line add">+bazarr_role_docker_volumes_custom: []</span><span class="diff-line add">+bazarr_role_docker_volumes: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_volumes_default&#x27;, role=&#x27;bazarr&#x27;)</span><span class="diff-line add">+                                + lookup(&#x27;role_var&#x27;, &#x27;_docker_volumes_custom&#x27;, role=&#x27;bazarr&#x27;)</span><span class="diff-line add">+                                + (lookup(&#x27;role_var&#x27;, &#x27;_docker_volumes_legacy&#x27;, role=&#x27;bazarr&#x27;)</span><span class="diff-line add">+                                  if docker_legacy_volume</span><span class="diff-line add">+                                  else []) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Labels</span><span class="diff-line del">-bazarr_docker_labels_default: {}</span><span class="diff-line del">-bazarr_docker_labels_custom: {}</span><span class="diff-line del">-bazarr_docker_labels: &quot;{{ docker_labels_common</span><span class="diff-line del">-                          | combine(lookup(&#x27;vars&#x27;, bazarr_name + &#x27;_docker_labels_default&#x27;, default=bazarr_docker_labels_default))</span><span class="diff-line del">-                          | combine((traefik_themepark_labels</span><span class="diff-line del">-                                    if (bazarr_themepark_enabled and global_themepark_plugin_enabled)</span><span class="diff-line del">-                                    else {}),</span><span class="diff-line del">-                                    lookup(&#x27;vars&#x27;, bazarr_name + &#x27;_docker_labels_custom&#x27;, default=bazarr_docker_labels_custom)) }}&quot;</span><span class="diff-line add">+bazarr_role_docker_labels_default: {}</span><span class="diff-line add">+bazarr_role_docker_labels_custom: {}</span><span class="diff-line add">+bazarr_role_docker_labels: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_labels_default&#x27;, role=&#x27;bazarr&#x27;)</span><span class="diff-line add">+                               | combine((traefik_themepark_labels</span><span class="diff-line add">+                                         if (lookup(&#x27;role_var&#x27;, &#x27;_themepark_enabled&#x27;, role=&#x27;bazarr&#x27;) and global_themepark_plugin_enabled)</span><span class="diff-line add">+                                         else {}),</span><span class="diff-line add">+                                         lookup(&#x27;role_var&#x27;, &#x27;_docker_labels_custom&#x27;, role=&#x27;bazarr&#x27;)) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Hostname</span><span class="diff-line del">-bazarr_docker_hostname: &quot;{{ bazarr_name }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Network Mode</span><span class="diff-line del">-bazarr_docker_network_mode_default: &quot;{{ docker_networks_name_common }}&quot;</span><span class="diff-line del">-bazarr_docker_network_mode: &quot;{{ lookup(&#x27;vars&#x27;, bazarr_name + &#x27;_docker_network_mode_default&#x27;, default=bazarr_docker_network_mode_default) }}&quot;</span><span class="diff-line add">+bazarr_role_docker_hostname: &quot;{{ bazarr_name }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Networks</span><span class="diff-line del">-bazarr_docker_networks_alias: &quot;{{ bazarr_name }}&quot;</span><span class="diff-line del">-bazarr_docker_networks_default: []</span><span class="diff-line del">-bazarr_docker_networks_custom: []</span><span class="diff-line del">-bazarr_docker_networks: &quot;{{ docker_networks_common</span><span class="diff-line del">-                            + lookup(&#x27;vars&#x27;, bazarr_name + &#x27;_docker_networks_default&#x27;, default=bazarr_docker_networks_default)</span><span class="diff-line del">-                            + lookup(&#x27;vars&#x27;, bazarr_name + &#x27;_docker_networks_custom&#x27;, default=bazarr_docker_networks_custom) }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Capabilities</span><span class="diff-line del">-bazarr_docker_capabilities_default: []</span><span class="diff-line del">-bazarr_docker_capabilities_custom: []</span><span class="diff-line del">-bazarr_docker_capabilities: &quot;{{ lookup(&#x27;vars&#x27;, bazarr_name + &#x27;_docker_capabilities_default&#x27;, default=bazarr_docker_capabilities_default)</span><span class="diff-line del">-                                + lookup(&#x27;vars&#x27;, bazarr_name + &#x27;_docker_capabilities_custom&#x27;, default=bazarr_docker_capabilities_custom) }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Security Opts</span><span class="diff-line del">-bazarr_docker_security_opts_default: []</span><span class="diff-line del">-bazarr_docker_security_opts_custom: []</span><span class="diff-line del">-bazarr_docker_security_opts: &quot;{{ lookup(&#x27;vars&#x27;, bazarr_name + &#x27;_docker_security_opts_default&#x27;, default=bazarr_docker_security_opts_default)</span><span class="diff-line del">-                                 + lookup(&#x27;vars&#x27;, bazarr_name + &#x27;_docker_security_opts_custom&#x27;, default=bazarr_docker_security_opts_custom) }}&quot;</span><span class="diff-line add">+bazarr_role_docker_networks_alias: &quot;{{ bazarr_name }}&quot;</span><span class="diff-line add">+bazarr_role_docker_networks_default: []</span><span class="diff-line add">+bazarr_role_docker_networks_custom: []</span><span class="diff-line add">+bazarr_role_docker_networks: &quot;{{ docker_networks_common</span><span class="diff-line add">+                                 + lookup(&#x27;role_var&#x27;, &#x27;_docker_networks_default&#x27;, role=&#x27;bazarr&#x27;)</span><span class="diff-line add">+                                 + lookup(&#x27;role_var&#x27;, &#x27;_docker_networks_custom&#x27;, role=&#x27;bazarr&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Restart Policy</span><span class="diff-line del">-bazarr_docker_restart_policy: unless-stopped</span><span class="diff-line add">+bazarr_role_docker_restart_policy: unless-stopped</span><span class="diff-line context"> </span><span class="diff-line context"> # State</span><span class="diff-line del">-bazarr_docker_state: started</span><span class="diff-line add">+bazarr_role_docker_state: started</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-133">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/bazarr/tasks/main2.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -10,9 +10,9 @@</span><span class="diff-line context"> - name: Add DNS record</span><span class="diff-line context">   ansible.builtin.include_tasks: &quot;{{ resources_tasks_path }}/dns/tasker.yml&quot;</span><span class="diff-line context">   vars:</span><span class="diff-line del">-    dns_record: &quot;{{ lookup(&#x27;vars&#x27;, role_name + &#x27;_dns_record&#x27;) }}&quot;</span><span class="diff-line del">-    dns_zone: &quot;{{ lookup(&#x27;vars&#x27;, role_name + &#x27;_dns_zone&#x27;) }}&quot;</span><span class="diff-line del">-    dns_proxy: &quot;{{ lookup(&#x27;vars&#x27;, role_name + &#x27;_dns_proxy&#x27;) }}&quot;</span><span class="diff-line add">+    dns_record: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_dns_record&#x27;) }}&quot;</span><span class="diff-line add">+    dns_zone: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_dns_zone&#x27;) }}&quot;</span><span class="diff-line add">+    dns_proxy: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_dns_proxy&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Remove existing Docker container</span><span class="diff-line context">   ansible.builtin.include_tasks: &quot;{{ resources_tasks_path }}/docker/remove_docker_container.yml&quot;</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-134">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/btop/tasks/main.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -50,7 +50,7 @@</span><span class="diff-line context">   ansible.builtin.shell: &quot;bash /tmp/btop/btop/install.sh&quot;</span><span class="diff-line context">   args:</span><span class="diff-line context">     chdir: &quot;/tmp/btop/btop&quot;</span><span class="diff-line del">-  become: yes</span><span class="diff-line add">+  become: true</span><span class="diff-line context">   become_user: &quot;{{ user.name }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: &quot;btop | Remove temp folder&quot;</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-135">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/btrfsmaintenance/tasks/main.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -12,14 +12,14 @@</span><span class="diff-line context">     root_fstype: &quot;{{ item.fstype }}&quot;</span><span class="diff-line context">   when: (item.mount == &#x27;/&#x27;)</span><span class="diff-line context">   with_items:</span><span class="diff-line del">-    - &quot;{{ ansible_mounts }}&quot;</span><span class="diff-line add">+    - &quot;{{ ansible_facts[&#x27;mounts&#x27;] }}&quot;</span><span class="diff-line context"> </span><span class="diff-line del">-- name: &quot;Determine &#x27;/opt&#x27; filesystem type&quot;</span><span class="diff-line add">+- name: &quot;Determine &#x27;{{ server_appdata_path }}&#x27; filesystem type&quot;</span><span class="diff-line context">   ansible.builtin.set_fact:</span><span class="diff-line context">     opt_fstype: &quot;{{ item.fstype }}&quot;</span><span class="diff-line del">-  when: (item.mount == &#x27;/opt&#x27;)</span><span class="diff-line add">+  when: (item.mount == server_appdata_path)</span><span class="diff-line context">   with_items:</span><span class="diff-line del">-    - &quot;{{ ansible_mounts }}&quot;</span><span class="diff-line add">+    - &quot;{{ ansible_facts[&#x27;mounts&#x27;] }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: &quot;Setup btrfsmaintenance scripts&quot;</span><span class="diff-line context">   when: ((root_fstype is defined) and (root_fstype == &#x27;btrfs&#x27;)) or ((opt_fstype is defined) and (opt_fstype == &#x27;btrfs&#x27;))</span><span class="diff-line hunk">@@ -27,7 +27,7 @@</span><span class="diff-line context">     - name: &quot;Install apt package&quot;</span><span class="diff-line context">       ansible.builtin.apt:</span><span class="diff-line context">         name: &quot;btrfsmaintenance&quot;</span><span class="diff-line del">-        state: present</span><span class="diff-line add">+        state: latest</span><span class="diff-line context"> </span><span class="diff-line context">     - name: &quot;Change mountpoints to &#x27;auto&#x27;&quot;</span><span class="diff-line context">       ansible.builtin.lineinfile:</span><span class="diff-line hunk">@@ -55,5 +55,5 @@</span><span class="diff-line context"> # Check for no btrfs and exit - not working</span><span class="diff-line context"> - name: &quot;Exit if no btrfs partitions found&quot;</span><span class="diff-line context">   ansible.builtin.debug:</span><span class="diff-line del">-    msg: &quot;No btrfs partition found on / or /opt - exiting&quot;</span><span class="diff-line add">+    msg: &quot;No btrfs partition found on / or {{ server_appdata_path }} - exiting&quot;</span><span class="diff-line context">   when: ((root_fstype is defined) and (root_fstype != &#x27;btrfs&#x27;)) and ((opt_fstype is defined) and (opt_fstype != &#x27;btrfs&#x27;))</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-136">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/cadvisor/defaults/main.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -16,123 +16,80 @@</span><span class="diff-line context"> # Web</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-cadvisor_web_subdomain: &quot;{{ cadvisor_name }}&quot;</span><span class="diff-line del">-cadvisor_web_domain: &quot;{{ user.domain }}&quot;</span><span class="diff-line del">-cadvisor_web_port: &quot;8080&quot;</span><span class="diff-line del">-cadvisor_web_url: &quot;{{ &#x27;https://&#x27; + (lookup(&#x27;vars&#x27;, cadvisor_name + &#x27;_web_subdomain&#x27;, default=cadvisor_web_subdomain) + &#x27;.&#x27; + lookup(&#x27;vars&#x27;, cadvisor_name + &#x27;_web_domain&#x27;, default=cadvisor_web_domain)</span><span class="diff-line del">-                   if (lookup(&#x27;vars&#x27;, cadvisor_name + &#x27;_web_subdomain&#x27;, default=cadvisor_web_subdomain) | length &gt; 0)</span><span class="diff-line del">-                   else lookup(&#x27;vars&#x27;, cadvisor_name + &#x27;_web_domain&#x27;, default=cadvisor_web_domain)) }}&quot;</span><span class="diff-line add">+cadvisor_role_web_subdomain: &quot;{{ cadvisor_name }}&quot;</span><span class="diff-line add">+cadvisor_role_web_domain: &quot;{{ user.domain }}&quot;</span><span class="diff-line add">+cadvisor_role_web_port: &quot;8080&quot;</span><span class="diff-line add">+cadvisor_role_web_url: &quot;{{ &#x27;https://&#x27; + (lookup(&#x27;role_var&#x27;, &#x27;_web_subdomain&#x27;, role=&#x27;cadvisor&#x27;) + &#x27;.&#x27; + lookup(&#x27;role_var&#x27;, &#x27;_web_domain&#x27;, role=&#x27;cadvisor&#x27;)</span><span class="diff-line add">+                        if (lookup(&#x27;role_var&#x27;, &#x27;_web_subdomain&#x27;, role=&#x27;cadvisor&#x27;) | length &gt; 0)</span><span class="diff-line add">+                        else lookup(&#x27;role_var&#x27;, &#x27;_web_domain&#x27;, role=&#x27;cadvisor&#x27;)) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # DNS</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-cadvisor_dns_record: &quot;{{ lookup(&#x27;vars&#x27;, cadvisor_name + &#x27;_web_subdomain&#x27;, default=cadvisor_web_subdomain) }}&quot;</span><span class="diff-line del">-cadvisor_dns_zone: &quot;{{ lookup(&#x27;vars&#x27;, cadvisor_name + &#x27;_web_domain&#x27;, default=cadvisor_web_domain) }}&quot;</span><span class="diff-line del">-cadvisor_dns_proxy: &quot;{{ dns.proxied }}&quot;</span><span class="diff-line add">+cadvisor_role_dns_record: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_web_subdomain&#x27;, role=&#x27;cadvisor&#x27;) }}&quot;</span><span class="diff-line add">+cadvisor_role_dns_zone: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_web_domain&#x27;, role=&#x27;cadvisor&#x27;) }}&quot;</span><span class="diff-line add">+cadvisor_role_dns_proxy: &quot;{{ dns_proxied }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # Traefik</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-cadvisor_traefik_sso_middleware: &quot;{{ traefik_default_sso_middleware }}&quot;</span><span class="diff-line del">-cadvisor_traefik_middleware_default: &quot;{{ traefik_default_middleware }}&quot;</span><span class="diff-line del">-cadvisor_traefik_middleware_custom: &quot;&quot;</span><span class="diff-line del">-cadvisor_traefik_certresolver: &quot;{{ traefik_default_certresolver }}&quot;</span><span class="diff-line del">-cadvisor_traefik_enabled: true</span><span class="diff-line del">-cadvisor_traefik_api_enabled: false</span><span class="diff-line del">-cadvisor_traefik_api_endpoint: &quot;&quot;</span><span class="diff-line add">+cadvisor_role_traefik_sso_middleware: &quot;{{ traefik_default_sso_middleware }}&quot;</span><span class="diff-line add">+cadvisor_role_traefik_middleware_default: &quot;{{ traefik_default_middleware }}&quot;</span><span class="diff-line add">+cadvisor_role_traefik_middleware_custom: &quot;&quot;</span><span class="diff-line add">+cadvisor_role_traefik_certresolver: &quot;{{ traefik_default_certresolver }}&quot;</span><span class="diff-line add">+cadvisor_role_traefik_enabled: true</span><span class="diff-line add">+cadvisor_role_traefik_api_enabled: false</span><span class="diff-line add">+cadvisor_role_traefik_api_endpoint: &quot;&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # Docker</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line context"> # Container</span><span class="diff-line del">-cadvisor_docker_container: &quot;{{ cadvisor_name }}&quot;</span><span class="diff-line add">+cadvisor_role_docker_container: &quot;{{ cadvisor_name }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Image</span><span class="diff-line del">-cadvisor_docker_image_pull: true</span><span class="diff-line del">-cadvisor_docker_image_tag: &quot;latest&quot;</span><span class="diff-line del">-cadvisor_docker_image: &quot;gcr.io/cadvisor/cadvisor:{{ cadvisor_docker_image_tag }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Ports</span><span class="diff-line del">-cadvisor_docker_ports_defaults: []</span><span class="diff-line del">-cadvisor_docker_ports_custom: []</span><span class="diff-line del">-cadvisor_docker_ports: &quot;{{ cadvisor_docker_ports_defaults</span><span class="diff-line del">-                           + cadvisor_docker_ports_custom }}&quot;</span><span class="diff-line add">+cadvisor_role_docker_image_pull: true</span><span class="diff-line add">+cadvisor_role_docker_image_repo: &quot;gcr.io/cadvisor/cadvisor&quot;</span><span class="diff-line add">+cadvisor_role_docker_image_tag: &quot;latest&quot;</span><span class="diff-line add">+cadvisor_role_docker_image: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_image_repo&#x27;, role=&#x27;cadvisor&#x27;) }}:{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_image_tag&#x27;, role=&#x27;cadvisor&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Envs</span><span class="diff-line del">-cadvisor_docker_envs_default:</span><span class="diff-line add">+cadvisor_role_docker_envs_default:</span><span class="diff-line context">   TZ: &quot;{{ tz }}&quot;</span><span class="diff-line del">-cadvisor_docker_envs_custom: {}</span><span class="diff-line del">-cadvisor_docker_envs: &quot;{{ cadvisor_docker_envs_default</span><span class="diff-line del">-                          | combine(cadvisor_docker_envs_custom) }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Commands</span><span class="diff-line del">-cadvisor_docker_commands_default: []</span><span class="diff-line del">-cadvisor_docker_commands_custom: []</span><span class="diff-line del">-cadvisor_docker_commands: &quot;{{ cadvisor_docker_commands_default</span><span class="diff-line del">-                              + cadvisor_docker_commands_custom }}&quot;</span><span class="diff-line add">+cadvisor_role_docker_envs_custom: {}</span><span class="diff-line add">+cadvisor_role_docker_envs: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_envs_default&#x27;, role=&#x27;cadvisor&#x27;)</span><span class="diff-line add">+                               | combine(lookup(&#x27;role_var&#x27;, &#x27;_docker_envs_custom&#x27;, role=&#x27;cadvisor&#x27;)) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Volumes</span><span class="diff-line del">-cadvisor_docker_volumes_default:</span><span class="diff-line add">+cadvisor_role_docker_volumes_default:</span><span class="diff-line context">   - &quot;/:/rootfs:ro&quot;</span><span class="diff-line context">   - &quot;/var/run:/var/run:ro&quot;</span><span class="diff-line context">   - &quot;/sys:/sys:ro&quot;</span><span class="diff-line context">   - &quot;/var/lib/docker/:/var/lib/docker:ro&quot;</span><span class="diff-line context">   - &quot;/dev/disk/:/dev/disk:ro&quot;</span><span class="diff-line del">-cadvisor_docker_volumes_custom: []</span><span class="diff-line del">-cadvisor_docker_volumes: &quot;{{ cadvisor_docker_volumes_default</span><span class="diff-line del">-                             + cadvisor_docker_volumes_custom }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Devices</span><span class="diff-line del">-cadvisor_docker_devices_default: []</span><span class="diff-line del">-cadvisor_docker_devices_custom: []</span><span class="diff-line del">-cadvisor_docker_devices: &quot;{{ cadvisor_docker_devices_default</span><span class="diff-line del">-                             + cadvisor_docker_devices_custom }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Hosts</span><span class="diff-line del">-cadvisor_docker_hosts_default: {}</span><span class="diff-line del">-cadvisor_docker_hosts_custom: {}</span><span class="diff-line del">-cadvisor_docker_hosts: &quot;{{ docker_hosts_common</span><span class="diff-line del">-                           | combine(cadvisor_docker_hosts_default)</span><span class="diff-line del">-                           | combine(cadvisor_docker_hosts_custom) }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Labels</span><span class="diff-line del">-cadvisor_docker_labels_default: {}</span><span class="diff-line del">-cadvisor_docker_labels_custom: {}</span><span class="diff-line del">-cadvisor_docker_labels: &quot;{{ docker_labels_common</span><span class="diff-line del">-                            | combine(cadvisor_docker_labels_default)</span><span class="diff-line del">-                            | combine(cadvisor_docker_labels_custom) }}&quot;</span><span class="diff-line add">+cadvisor_role_docker_volumes_custom: []</span><span class="diff-line add">+cadvisor_role_docker_volumes: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_volumes_default&#x27;, role=&#x27;cadvisor&#x27;)</span><span class="diff-line add">+                                  + lookup(&#x27;role_var&#x27;, &#x27;_docker_volumes_custom&#x27;, role=&#x27;cadvisor&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Hostname</span><span class="diff-line del">-cadvisor_docker_hostname: &quot;{{ cadvisor_name }}&quot;</span><span class="diff-line add">+cadvisor_role_docker_hostname: &quot;{{ cadvisor_name }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Networks</span><span class="diff-line del">-cadvisor_docker_networks_alias: &quot;{{ cadvisor_name }}&quot;</span><span class="diff-line del">-cadvisor_docker_networks_default: []</span><span class="diff-line del">-cadvisor_docker_networks_custom: []</span><span class="diff-line del">-cadvisor_docker_networks: &quot;{{ docker_networks_common</span><span class="diff-line del">-                              + cadvisor_docker_networks_default</span><span class="diff-line del">-                              + cadvisor_docker_networks_custom }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Capabilities</span><span class="diff-line del">-cadvisor_docker_capabilities_default: []</span><span class="diff-line del">-cadvisor_docker_capabilities_custom: []</span><span class="diff-line del">-cadvisor_docker_capabilities: &quot;{{ cadvisor_docker_capabilities_default</span><span class="diff-line del">-                                  + cadvisor_docker_capabilities_custom }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Security Opts</span><span class="diff-line del">-cadvisor_docker_security_opts_default: []</span><span class="diff-line del">-cadvisor_docker_security_opts_custom: []</span><span class="diff-line del">-cadvisor_docker_security_opts: &quot;{{ cadvisor_docker_security_opts_default</span><span class="diff-line del">-                                   + cadvisor_docker_security_opts_custom }}&quot;</span><span class="diff-line add">+cadvisor_role_docker_networks_alias: &quot;{{ cadvisor_name }}&quot;</span><span class="diff-line add">+cadvisor_role_docker_networks_default: []</span><span class="diff-line add">+cadvisor_role_docker_networks_custom: []</span><span class="diff-line add">+cadvisor_role_docker_networks: &quot;{{ docker_networks_common</span><span class="diff-line add">+                                   + lookup(&#x27;role_var&#x27;, &#x27;_docker_networks_default&#x27;, role=&#x27;cadvisor&#x27;)</span><span class="diff-line add">+                                   + lookup(&#x27;role_var&#x27;, &#x27;_docker_networks_custom&#x27;, role=&#x27;cadvisor&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Restart Policy</span><span class="diff-line del">-cadvisor_docker_restart_policy: unless-stopped</span><span class="diff-line add">+cadvisor_role_docker_restart_policy: unless-stopped</span><span class="diff-line context"> </span><span class="diff-line context"> # State</span><span class="diff-line del">-cadvisor_docker_state: started</span><span class="diff-line add">+cadvisor_role_docker_state: started</span><span class="diff-line context"> </span><span class="diff-line context"> # Privileged</span><span class="diff-line del">-cadvisor_docker_privileged: true</span><span class="diff-line add">+cadvisor_role_docker_privileged: true</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-137">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/cadvisor/tasks/main.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -9,9 +9,9 @@</span><span class="diff-line context"> - name: Add DNS record</span><span class="diff-line context">   ansible.builtin.include_tasks: &quot;{{ resources_tasks_path }}/dns/tasker.yml&quot;</span><span class="diff-line context">   vars:</span><span class="diff-line del">-    dns_record: &quot;{{ lookup(&#x27;vars&#x27;, role_name + &#x27;_dns_record&#x27;) }}&quot;</span><span class="diff-line del">-    dns_zone: &quot;{{ lookup(&#x27;vars&#x27;, role_name + &#x27;_dns_zone&#x27;) }}&quot;</span><span class="diff-line del">-    dns_proxy: &quot;{{ lookup(&#x27;vars&#x27;, role_name + &#x27;_dns_proxy&#x27;) }}&quot;</span><span class="diff-line add">+    dns_record: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_dns_record&#x27;) }}&quot;</span><span class="diff-line add">+    dns_zone: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_dns_zone&#x27;) }}&quot;</span><span class="diff-line add">+    dns_proxy: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_dns_proxy&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Remove existing Docker container</span><span class="diff-line context">   ansible.builtin.include_tasks: &quot;{{ resources_tasks_path }}/docker/remove_docker_container.yml&quot;</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-138">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/cloudflare/tasks/main.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -8,14 +8,14 @@</span><span class="diff-line context"> #########################################################################</span><span class="diff-line context"> ---</span><span class="diff-line context"> - name: Variables Task</span><span class="diff-line del">-  ansible.builtin.import_tasks: &quot;subtasks/variables.yml&quot;</span><span class="diff-line add">+  ansible.builtin.include_tasks: &quot;subtasks/variables.yml&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Saltbox Subdomains Task</span><span class="diff-line del">-  ansible.builtin.import_tasks: &quot;subtasks/subdomains.yml&quot;</span><span class="diff-line add">+  ansible.builtin.include_tasks: &quot;subtasks/subdomains.yml&quot;</span><span class="diff-line context">   when: (saltbox_type | length &gt; 0) and not skip_dns</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Purge Cache Task</span><span class="diff-line del">-  ansible.builtin.import_tasks: &quot;subtasks/purge_cache.yml&quot;</span><span class="diff-line add">+  ansible.builtin.include_tasks: &quot;subtasks/purge_cache.yml&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Configuration Rules Task</span><span class="diff-line del">-  ansible.builtin.import_tasks: &quot;subtasks/configuration_rules.yml&quot;</span><span class="diff-line add">+  ansible.builtin.include_tasks: &quot;subtasks/configuration_rules.yml&quot;</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-139">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/cloudflare/tasks/subtasks/configuration_rules.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -130,11 +130,11 @@</span><span class="diff-line context">   when: ruleset_exists and not rule_exists</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Configuration Rules | Remove Configuration Rule Task</span><span class="diff-line del">-  ansible.builtin.import_tasks: &quot;configuration_rules/remove_configuration_rule.yml&quot;</span><span class="diff-line add">+  ansible.builtin.include_tasks: &quot;configuration_rules/remove_configuration_rule.yml&quot;</span><span class="diff-line context">   when: ruleset_exists and rule_exists</span><span class="diff-line context"> </span><span class="diff-line context"> # Create new CF Configuration Rule for Lets Encrypt</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Configuration Rules | Add Configuration Rule Task</span><span class="diff-line del">-  ansible.builtin.import_tasks: &quot;configuration_rules/add_configuration_rule.yml&quot;</span><span class="diff-line add">+  ansible.builtin.include_tasks: &quot;configuration_rules/add_configuration_rule.yml&quot;</span><span class="diff-line context">   when: ruleset_exists and rule_exists</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-140">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/cloudflare/tasks/subtasks/configuration_rules/add_configuration_rule.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -28,5 +28,5 @@</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Configuration Rules | Print result of Cloudflare Configuration Rule Creation</span><span class="diff-line context">   ansible.builtin.debug:</span><span class="diff-line del">-    msg: &quot;Successfully created Let&#x27;s Encrypt Cloudflare configuration rule for &#x27;{{ fld.stdout }}&#x27;&quot;</span><span class="diff-line add">+    msg: &quot;Successfully created Let&#x27;s Encrypt Cloudflare configuration rule for &#x27;{{ domain_parsed.fld }}&#x27;&quot;</span><span class="diff-line context">   when: cf_configuration_rule_creation.json.success is defined and cf_configuration_rule_creation.json.success</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-141">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/cloudflare/tasks/subtasks/purge_cache.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -7,7 +7,7 @@</span><span class="diff-line context"> #                   GNU General Public License v3.0                     #</span><span class="diff-line context"> #########################################################################</span><span class="diff-line context"> ---</span><span class="diff-line del">-- name: Purge Cache | Purge Cloudflare Cache for &#x27;{{ fld.stdout }}&#x27;</span><span class="diff-line add">+- name: Purge Cache | Purge Cloudflare Cache for &#x27;{{ domain_parsed.fld }}&#x27;</span><span class="diff-line context">   ansible.builtin.uri:</span><span class="diff-line context">     url: &#x27;https://api.cloudflare.com/client/v4/zones/{{ cloudflare_zone }}/purge_cache&#x27;</span><span class="diff-line context">     method: &#x27;POST&#x27;</span><span class="diff-line hunk">@@ -23,4 +23,4 @@</span><span class="diff-line context">   ansible.builtin.debug:</span><span class="diff-line context">     msg: &quot;{{ ((cf_purge.json.success is defined) and (cf_purge.json.success))</span><span class="diff-line context">              | ternary(&#x27;Successfully&#x27;, &#x27;Unsuccessfully&#x27;) }}</span><span class="diff-line del">-             purged Cloudflare cache for &#x27;{{ fld.stdout }}&#x27;&quot;</span><span class="diff-line add">+             purged Cloudflare cache for &#x27;{{ domain_parsed.fld }}&#x27;&quot;</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-142">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/cloudflare/tasks/subtasks/subdomains.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -8,10 +8,10 @@</span><span class="diff-line context"> #########################################################################</span><span class="diff-line context"> ---</span><span class="diff-line context"> ## Add &#x27;saltbox_type&#x27; subdomain</span><span class="diff-line del">-- name: &quot;Cloudflare | Subdomains | Add &#x27;{{ saltbox_type }}&#x27; subdomain to &#x27;{{ fld.stdout }}&#x27;&quot;</span><span class="diff-line del">-  ansible.builtin.import_tasks: &quot;subdomains/add_subdomain.yml&quot;</span><span class="diff-line add">+- name: &quot;Cloudflare | Subdomains | Add &#x27;{{ saltbox_type }}&#x27; subdomain to &#x27;{{ domain_parsed.fld }}&#x27;&quot;</span><span class="diff-line add">+  ansible.builtin.include_tasks: &quot;subdomains/add_subdomain.yml&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ## Remove &#x27;saltbox&#x27; subdomain for Mediabox/Feederbox setups.</span><span class="diff-line del">-- name: &quot;Cloudflare | Subdomains | Remove &#x27;saltbox&#x27; subdomain from &#x27;{{ fld.stdout }}&#x27;&quot;</span><span class="diff-line del">-  ansible.builtin.import_tasks: &quot;subdomains/remove_subdomain.yml&quot;</span><span class="diff-line add">+- name: &quot;Cloudflare | Subdomains | Remove &#x27;saltbox&#x27; subdomain from &#x27;{{ domain_parsed.fld }}&#x27;&quot;</span><span class="diff-line add">+  ansible.builtin.include_tasks: &quot;subdomains/remove_subdomain.yml&quot;</span><span class="diff-line context">   when: saltbox_type is regex(&#x27;mediabox|feederbox&#x27;)</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-143">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/cloudflare/tasks/subtasks/subdomains/add_subdomain.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -7,28 +7,28 @@</span><span class="diff-line context"> #                   GNU General Public License v3.0                     #</span><span class="diff-line context"> #########################################################################</span><span class="diff-line context"> ---</span><span class="diff-line del">-- name: &quot;Subdomains | Add Subdomain | Cloudflare: DNS Record for &#x27;{{ saltbox_type }}&#x27; set to &#x27;{{ ip_address_public }}&#x27; was added. Proxy: {{ dns.proxied | default(&#x27;no&#x27;) }}&quot;</span><span class="diff-line add">+- name: &quot;Subdomains | Add Subdomain | Cloudflare: DNS Record for &#x27;{{ saltbox_type }}&#x27; set to &#x27;{{ ip_address_public }}&#x27; was added. Proxy: {{ dns_proxied | default(&#x27;no&#x27;) }}&quot;</span><span class="diff-line context">   community.general.cloudflare_dns:</span><span class="diff-line context">     account_api_token: &quot;{{ cloudflare.api }}&quot;</span><span class="diff-line context">     account_email: &quot;{{ cloudflare.email }}&quot;</span><span class="diff-line del">-    zone: &quot;{{ fld.stdout }}&quot;</span><span class="diff-line add">+    zone: &quot;{{ domain_parsed.fld }}&quot;</span><span class="diff-line context">     state: present</span><span class="diff-line context">     solo: true</span><span class="diff-line del">-    proxied: &quot;{{ dns.proxied | default(&#x27;no&#x27;) }}&quot;</span><span class="diff-line add">+    proxied: &quot;{{ dns_proxied | default(&#x27;no&#x27;) }}&quot;</span><span class="diff-line context">     type: A</span><span class="diff-line context">     value: &quot;{{ ip_address_public }}&quot;</span><span class="diff-line context">     record: &quot;{{ saltbox_type }}&quot;</span><span class="diff-line del">-  when: dns.ipv4</span><span class="diff-line add">+  when: dns_ipv4_enabled</span><span class="diff-line context"> </span><span class="diff-line del">-- name: &quot;Subdomains | Add Subdomain | Cloudflare: DNS Record for &#x27;{{ saltbox_type }}&#x27; set to &#x27;{{ ipv6_address_public }}&#x27; was added. Proxy: {{ dns.proxied | default(&#x27;no&#x27;) }}&quot;</span><span class="diff-line add">+- name: &quot;Subdomains | Add Subdomain | Cloudflare: DNS Record for &#x27;{{ saltbox_type }}&#x27; set to &#x27;{{ ipv6_address_public }}&#x27; was added. Proxy: {{ dns_proxied | default(&#x27;no&#x27;) }}&quot;</span><span class="diff-line context">   community.general.cloudflare_dns:</span><span class="diff-line context">     account_api_token: &quot;{{ cloudflare.api }}&quot;</span><span class="diff-line context">     account_email: &quot;{{ cloudflare.email }}&quot;</span><span class="diff-line del">-    zone: &quot;{{ fld.stdout }}&quot;</span><span class="diff-line add">+    zone: &quot;{{ domain_parsed.fld }}&quot;</span><span class="diff-line context">     state: present</span><span class="diff-line context">     solo: true</span><span class="diff-line del">-    proxied: &quot;{{ dns.proxied | default(&#x27;no&#x27;) }}&quot;</span><span class="diff-line add">+    proxied: &quot;{{ dns_proxied | default(&#x27;no&#x27;) }}&quot;</span><span class="diff-line context">     type: AAAA</span><span class="diff-line context">     value: &quot;{{ ipv6_address_public }}&quot;</span><span class="diff-line context">     record: &quot;{{ saltbox_type }}&quot;</span><span class="diff-line del">-  when: dns.ipv6</span><span class="diff-line add">+  when: dns_ipv6_enabled</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-144">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/cloudflare/tasks/subtasks/subdomains/remove_subdomain.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -7,22 +7,22 @@</span><span class="diff-line context"> #                   GNU General Public License v3.0                     #</span><span class="diff-line context"> #########################################################################</span><span class="diff-line context"> ---</span><span class="diff-line del">-- name: &quot;Subdomains | Remove Subdomain | Cloudflare: Remove &#x27;saltbox&#x27; A record from &#x27;{{ fld.stdout }}&#x27;&quot;</span><span class="diff-line add">+- name: &quot;Subdomains | Remove Subdomain | Cloudflare: Remove &#x27;saltbox&#x27; A record from &#x27;{{ domain_parsed.fld }}&#x27;&quot;</span><span class="diff-line context">   community.general.cloudflare_dns:</span><span class="diff-line context">     account_api_token: &quot;{{ cloudflare.api }}&quot;</span><span class="diff-line context">     account_email: &quot;{{ cloudflare.email }}&quot;</span><span class="diff-line del">-    zone: &quot;{{ fld.stdout }}&quot;</span><span class="diff-line add">+    zone: &quot;{{ domain_parsed.fld }}&quot;</span><span class="diff-line context">     state: absent</span><span class="diff-line context">     type: A</span><span class="diff-line context">     record: &quot;saltbox&quot;</span><span class="diff-line del">-  when: dns.ipv4</span><span class="diff-line add">+  when: dns_ipv4_enabled</span><span class="diff-line context"> </span><span class="diff-line del">-- name: &quot;Subdomains | Remove Subdomain | Cloudflare: Remove &#x27;saltbox&#x27; AAAA record from &#x27;{{ fld.stdout }}&#x27;&quot;</span><span class="diff-line add">+- name: &quot;Subdomains | Remove Subdomain | Cloudflare: Remove &#x27;saltbox&#x27; AAAA record from &#x27;{{ domain_parsed.fld }}&#x27;&quot;</span><span class="diff-line context">   community.general.cloudflare_dns:</span><span class="diff-line context">     account_api_token: &quot;{{ cloudflare.api }}&quot;</span><span class="diff-line context">     account_email: &quot;{{ cloudflare.email }}&quot;</span><span class="diff-line del">-    zone: &quot;{{ fld.stdout }}&quot;</span><span class="diff-line add">+    zone: &quot;{{ domain_parsed.fld }}&quot;</span><span class="diff-line context">     state: absent</span><span class="diff-line context">     type: AAAA</span><span class="diff-line context">     record: &quot;saltbox&quot;</span><span class="diff-line del">-  when: dns.ipv6</span><span class="diff-line add">+  when: dns_ipv6_enabled</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-145">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/cloudflare/tasks/subtasks/variables.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -15,13 +15,13 @@</span><span class="diff-line context">       else &#x27;&#x27; }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Get FLD</span><span class="diff-line del">-  ansible.builtin.shell: |</span><span class="diff-line del">-    {{ saltbox_python }} -c &quot;from tld import get_tld; res = get_tld(\&quot;http://{{ dns_zone | default(user.domain) }}\&quot;, as_object=True); print(res.fld)&quot;</span><span class="diff-line del">-  register: fld</span><span class="diff-line add">+  tld_parse:</span><span class="diff-line add">+    url: &quot;{{ dns_zone | default(user.domain) }}&quot;</span><span class="diff-line add">+  register: domain_parsed</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Variables | Fetch Cloudflare Zones</span><span class="diff-line context">   ansible.builtin.uri:</span><span class="diff-line del">-    url: &#x27;https://api.cloudflare.com/client/v4/zones?name={{ fld.stdout }}&#x27;</span><span class="diff-line add">+    url: &#x27;https://api.cloudflare.com/client/v4/zones?name={{ domain_parsed.fld }}&#x27;</span><span class="diff-line context">     method: &#x27;GET&#x27;</span><span class="diff-line context">     headers:</span><span class="diff-line context">       Content-Type: &quot;application/json&quot;</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-146">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/cloudflare/tasks/subtasks/zone.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -8,9 +8,9 @@</span><span class="diff-line context"> #########################################################################</span><span class="diff-line context"> ---</span><span class="diff-line context"> - name: Get FLD</span><span class="diff-line del">-  ansible.builtin.shell: |</span><span class="diff-line del">-    {{ saltbox_python }} -c &quot;from tld import get_tld; res = get_tld(\&quot;http://{{ user.domain }}\&quot;, as_object=True); print(res.fld)&quot;</span><span class="diff-line del">-  register: fld</span><span class="diff-line add">+  tld_parse:</span><span class="diff-line add">+    url: &quot;{{ user.domain }}&quot;</span><span class="diff-line add">+  register: domain_parsed</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Get zones</span><span class="diff-line context">   ansible.builtin.uri:</span><span class="diff-line hunk">@@ -22,7 +22,7 @@</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Get zone ID</span><span class="diff-line context">   ansible.builtin.set_fact:</span><span class="diff-line del">-    zone_id: &quot;{{ get_zones_result.json.result | selectattr(&#x27;name&#x27;, &#x27;equalto&#x27;, fld.stdout) | map(attribute=&#x27;id&#x27;) | first }}&quot;</span><span class="diff-line add">+    zone_id: &quot;{{ get_zones_result.json.result | selectattr(&#x27;name&#x27;, &#x27;equalto&#x27;, domain_parsed.fld) | map(attribute=&#x27;id&#x27;) | first }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Get zone records</span><span class="diff-line context">   ansible.builtin.uri:</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-147">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/cloudplow/defaults/main.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -30,19 +30,13 @@</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line context"> cloudplow_folder: &quot;{{ cloudplow_name }}&quot;</span><span class="diff-line del">-</span><span class="diff-line context"> cloudplow_path: &quot;{{ server_appdata_path }}/{{ cloudplow_folder }}&quot;</span><span class="diff-line del">-</span><span class="diff-line context"> cloudplow_venv_path: &quot;{{ cloudplow_path }}/venv&quot;</span><span class="diff-line del">-</span><span class="diff-line context"> cloudplow_python_path: &quot;{{ cloudplow_venv_path }}/bin/python3&quot;</span><span class="diff-line context"> cloudplow_python_version: &quot;3.8&quot;</span><span class="diff-line context"> cloudplow_script_path: &quot;{{ cloudplow_path }}/cloudplow.py&quot;</span><span class="diff-line del">-</span><span class="diff-line context"> cloudplow_requirements_path: &quot;{{ cloudplow_path }}/requirements.txt&quot;</span><span class="diff-line del">-</span><span class="diff-line context"> cloudplow_config_path: &quot;{{ cloudplow_path }}/config.json&quot;</span><span class="diff-line del">-</span><span class="diff-line context"> cloudplow_alias_path: &quot;/usr/local/bin/{{ cloudplow_name }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line hunk">@@ -50,11 +44,8 @@</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line context"> cloudplow_git_repo_url: &quot;https://github.com/l3uddz/cloudplow.git&quot;</span><span class="diff-line del">-</span><span class="diff-line context"> cloudplow_git_repo_dest: &quot;{{ cloudplow_path }}&quot;</span><span class="diff-line del">-</span><span class="diff-line context"> cloudplow_git_repo_branch_primary: &quot;master&quot;</span><span class="diff-line del">-</span><span class="diff-line context"> cloudplow_git_repo_branch_secondary: &quot;develop&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line hunk">@@ -69,9 +60,7 @@</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line context"> rclone_config_path: &quot;/home/{{ user.name }}/.config/rclone/rclone.conf&quot;</span><span class="diff-line del">-</span><span class="diff-line context"> rclone_binary_path: &quot;/usr/bin/rclone&quot;</span><span class="diff-line del">-</span><span class="diff-line context"> cloudplow_rclone_google_template: |-</span><span class="diff-line context">   &quot;--user-agent&quot;: &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/74.0.3729.131 Safari/537.36&quot;,</span><span class="diff-line context">   &quot;--checkers&quot;: 16,</span><span class="diff-line hunk">@@ -83,7 +72,6 @@</span><span class="diff-line context">   &quot;--retries&quot;: 1,</span><span class="diff-line context">   &quot;--low-level-retries&quot;: 2,</span><span class="diff-line context">   &quot;--drive-stop-on-upload-limit&quot;: null</span><span class="diff-line del">-</span><span class="diff-line context"> cloudplow_rclone_dropbox_template: |-</span><span class="diff-line context">   &quot;--user-agent&quot;: &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/74.0.3729.131 Safari/537.36&quot;,</span><span class="diff-line context">   &quot;--checkers&quot;: 16,</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-148">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/cloudplow/tasks/main.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -11,14 +11,6 @@</span><span class="diff-line context">   ansible.builtin.include_tasks: &quot;{{ resources_tasks_path }}/systemd/delete_service.yml&quot;</span><span class="diff-line context">   vars:</span><span class="diff-line context">     _service_name: &quot;{{ cloudplow_service_name_old }}&quot;</span><span class="diff-line del">-  tags:</span><span class="diff-line del">-    - &quot;cloudplow-disable&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-- name: Import Disable Task</span><span class="diff-line del">-  ansible.builtin.import_tasks: &quot;subtasks/disable.yml&quot;</span><span class="diff-line del">-  when: (&#x27;cloudplow-disable&#x27; in ansible_run_tags)</span><span class="diff-line del">-  tags:</span><span class="diff-line del">-    - &quot;cloudplow-disable&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Reset Cloudplow directory</span><span class="diff-line context">   ansible.builtin.file:</span><span class="diff-line hunk">@@ -53,6 +45,11 @@</span><span class="diff-line context"> </span><span class="diff-line context">     - name: Clone project git repo</span><span class="diff-line context">       ansible.builtin.include_tasks: &quot;{{ resources_tasks_path }}/git/clone_git_repo.yml&quot;</span><span class="diff-line add">+      vars:</span><span class="diff-line add">+        git_repo_url: &quot;{{ cloudplow_git_repo_url }}&quot;</span><span class="diff-line add">+        git_repo_dest: &quot;{{ cloudplow_git_repo_dest }}&quot;</span><span class="diff-line add">+        git_repo_branch_primary: &quot;{{ cloudplow_git_repo_branch_primary }}&quot;</span><span class="diff-line add">+        git_repo_branch_secondary: &quot;{{ cloudplow_git_repo_branch_secondary }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context">     - name: &quot;Execute Python role&quot;</span><span class="diff-line context">       ansible.builtin.include_role:</span><span class="diff-line hunk">@@ -108,7 +105,7 @@</span><span class="diff-line context">         force: true</span><span class="diff-line context"> </span><span class="diff-line context">     - name: Import Settings Task</span><span class="diff-line del">-      ansible.builtin.import_tasks: &quot;subtasks/settings.yml&quot;</span><span class="diff-line add">+      ansible.builtin.include_tasks: &quot;subtasks/settings.yml&quot;</span><span class="diff-line context"> </span><span class="diff-line context">     - name: Import &#x27;{{ cloudplow_service_name }}.service&#x27;</span><span class="diff-line context">       ansible.builtin.template:</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-149">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/cloudplow/tasks/subtasks/settings.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -18,12 +18,12 @@</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Settings | Check if SABnzbd is installed</span><span class="diff-line context">   ansible.builtin.stat:</span><span class="diff-line del">-    path: &quot;{{ sabnzbd_paths_config_location }}&quot;</span><span class="diff-line add">+    path: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_config_location&#x27;, role=&#x27;sabnzbd&#x27;) }}&quot;</span><span class="diff-line context">   register: stat_sabnzbd</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Settings | Lookup SABnzbd API Key</span><span class="diff-line context">   ansible.builtin.set_fact:</span><span class="diff-line del">-    sabnzbd_apikey: &quot;{{ lookup(&#x27;file&#x27;, sabnzbd_paths_config_location) | regex_search(&#x27;^api_key *= *.*&#x27;, multiline=True) | regex_replace(&#x27;.*= *(.*)$&#x27;, &#x27;\\1&#x27;) }}&quot;</span><span class="diff-line add">+    sabnzbd_apikey: &quot;{{ lookup(&#x27;file&#x27;, lookup(&#x27;role_var&#x27;, &#x27;_paths_config_location&#x27;, role=&#x27;sabnzbd&#x27;)) | regex_search(&#x27;^api_key *= *.*&#x27;, multiline=True) | regex_replace(&#x27;.*= *(.*)$&#x27;, &#x27;\\1&#x27;) }}&quot;</span><span class="diff-line context">   when: stat_sabnzbd.stat.exists</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Settings | Check if &#x27;config.json&#x27; exists</span><span class="diff-line hunk">@@ -63,7 +63,7 @@</span><span class="diff-line context">   block:</span><span class="diff-line context">     - name: Settings | Install required packages</span><span class="diff-line context">       ansible.builtin.apt:</span><span class="diff-line del">-        state: present</span><span class="diff-line add">+        state: latest</span><span class="diff-line context">         name:</span><span class="diff-line context">           - jq</span><span class="diff-line context">           - moreutils</span><span class="diff-line hunk">@@ -76,13 +76,13 @@</span><span class="diff-line context"> </span><span class="diff-line context">     - name: Settings | Update NZBGet credentials in &#x27;config.json&#x27;</span><span class="diff-line context">       ansible.builtin.shell: |</span><span class="diff-line del">-        jq &#x27;.nzbget.url = &quot;{{ nzbget_web_local_url_web_login }}&quot;&#x27; {{ cloudplow_config_path }} | sponge {{ cloudplow_config_path }}</span><span class="diff-line add">+        jq &#x27;.nzbget.url = &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_web_local_url_web_login&#x27;, role=&#x27;nzbget&#x27;) }}&quot;&#x27; {{ cloudplow_config_path }} | sponge {{ cloudplow_config_path }}</span><span class="diff-line context">       become: true</span><span class="diff-line context">       become_user: &quot;{{ user.name }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context">     - name: Settings | Update SABnzbd URL in &#x27;config.json&#x27;</span><span class="diff-line context">       ansible.builtin.shell: |</span><span class="diff-line del">-        jq &#x27;.sabnzbd.url = &quot;{{ sabnzbd_web_local_url }}&quot;&#x27; {{ cloudplow_config_path }} | sponge {{ cloudplow_config_path }}</span><span class="diff-line add">+        jq &#x27;.sabnzbd.url = &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_web_local_url&#x27;, role=&#x27;sabnzbd&#x27;) }}&quot;&#x27; {{ cloudplow_config_path }} | sponge {{ cloudplow_config_path }}</span><span class="diff-line context">       become: true</span><span class="diff-line context">       become_user: &quot;{{ user.name }}&quot;</span><span class="diff-line context"> </span><span class="diff-line hunk">@@ -95,7 +95,7 @@</span><span class="diff-line context"> </span><span class="diff-line context">     - name: Settings | Update Plex URL in &#x27;config.json&#x27;</span><span class="diff-line context">       ansible.builtin.shell: |</span><span class="diff-line del">-        jq &#x27;.plex.url = &quot;{{ plex_web_url }}&quot;&#x27; {{ cloudplow_config_path }} | sponge {{ cloudplow_config_path }}</span><span class="diff-line add">+        jq &#x27;.plex.url = &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_web_url&#x27;, role=&#x27;plex&#x27;) }}&quot;&#x27; {{ cloudplow_config_path }} | sponge {{ cloudplow_config_path }}</span><span class="diff-line context">       become: true</span><span class="diff-line context">       become_user: &quot;{{ user.name }}&quot;</span><span class="diff-line context"> </span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-150">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/cloudplow/templates/config.json.j2</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -8,7 +8,7 @@</span><span class="diff-line context">   &quot;notifications&quot;: {},</span><span class="diff-line context">   &quot;nzbget&quot;: {</span><span class="diff-line context">     &quot;enabled&quot;: false,</span><span class="diff-line del">-    &quot;url&quot;: &quot;{{ nzbget_web_local_url_web_login }}&quot;</span><span class="diff-line add">+    &quot;url&quot;: &quot;{{ nzbget_role_web_local_url_web_login }}&quot;</span><span class="diff-line context">   },</span><span class="diff-line context">   &quot;plex&quot;: {</span><span class="diff-line context">     &quot;enabled&quot;: false,</span><span class="diff-line hunk">@@ -28,7 +28,7 @@</span><span class="diff-line context">       &quot;url&quot;: &quot;http://localhost:7949&quot;</span><span class="diff-line context">     },</span><span class="diff-line context">     &quot;token&quot;: &quot;{{ plex_auth_token | default(&#x27;&#x27;) }}&quot;,</span><span class="diff-line del">-    &quot;url&quot;: &quot;{{ plex_web_url }}&quot;</span><span class="diff-line add">+    &quot;url&quot;: &quot;{{ plex_role_web_url }}&quot;</span><span class="diff-line context">   },</span><span class="diff-line context">   &quot;remotes&quot;: {</span><span class="diff-line context"> {% for item in cloudplow_remotes %}</span><span class="diff-line hunk">@@ -57,16 +57,16 @@</span><span class="diff-line context">       },</span><span class="diff-line context">       &quot;remove_empty_dir_depth&quot;: 2,</span><span class="diff-line context">       &quot;sync_remote&quot;: &quot;{{ (item | filter_rclone_remote_with_path)</span><span class="diff-line del">-                          + lookup(&#x27;vars&#x27;, &#x27;cloudplow_remote_&#x27; + (item | filter_rclone_remote_name) + &#x27;_folder&#x27;, default=cloudplow_remote_default_folder)</span><span class="diff-line del">-                          if (item.settings.template != &#x27;nfs&#x27;)</span><span class="diff-line del">-                          else (&#x27;/mnt/remote/&#x27; + (item | filter_rclone_remote_name))</span><span class="diff-line del">-                          + lookup(&#x27;vars&#x27;, &#x27;cloudplow_remote_&#x27; + (item | filter_rclone_remote_name) + &#x27;_folder&#x27;, default=cloudplow_remote_default_folder) }}&quot;,</span><span class="diff-line add">+                         + lookup(&#x27;vars&#x27;, &#x27;cloudplow_remote_&#x27; + (item | filter_rclone_remote_name) + &#x27;_folder&#x27;, default=cloudplow_remote_default_folder)</span><span class="diff-line add">+                      if (item.settings.template != &#x27;nfs&#x27;)</span><span class="diff-line add">+                      else (&#x27;/mnt/remote/&#x27; + (item | filter_rclone_remote_name))</span><span class="diff-line add">+                           + lookup(&#x27;vars&#x27;, &#x27;cloudplow_remote_&#x27; + (item | filter_rclone_remote_name) + &#x27;_folder&#x27;, default=cloudplow_remote_default_folder) }}&quot;,</span><span class="diff-line context">       &quot;upload_folder&quot;: &quot;{{ item.settings.upload_from }}&quot;,</span><span class="diff-line context">       &quot;upload_remote&quot;: &quot;{{ (item | filter_rclone_remote_with_path)</span><span class="diff-line del">-                            + lookup(&#x27;vars&#x27;, &#x27;cloudplow_remote_&#x27; + (item | filter_rclone_remote_name) + &#x27;_folder&#x27;, default=cloudplow_remote_default_folder)</span><span class="diff-line del">-                            if (item.settings.template != &#x27;nfs&#x27;)</span><span class="diff-line del">-                            else (&#x27;/mnt/remote/&#x27; + (item | filter_rclone_remote_name))</span><span class="diff-line del">-                            + lookup(&#x27;vars&#x27;, &#x27;cloudplow_remote_&#x27; + (item | filter_rclone_remote_name) + &#x27;_folder&#x27;, default=cloudplow_remote_default_folder) }}&quot;</span><span class="diff-line add">+                           + lookup(&#x27;vars&#x27;, &#x27;cloudplow_remote_&#x27; + (item | filter_rclone_remote_name) + &#x27;_folder&#x27;, default=cloudplow_remote_default_folder)</span><span class="diff-line add">+                        if (item.settings.template != &#x27;nfs&#x27;)</span><span class="diff-line add">+                        else (&#x27;/mnt/remote/&#x27; + (item | filter_rclone_remote_name))</span><span class="diff-line add">+                             + lookup(&#x27;vars&#x27;, &#x27;cloudplow_remote_&#x27; + (item | filter_rclone_remote_name) + &#x27;_folder&#x27;, default=cloudplow_remote_default_folder) }}&quot;</span><span class="diff-line context">     {% if loop.index == loop.length %}}{% else %}},{{ &#x27;\n&#x27; }}{% endif %}</span><span class="diff-line context"> {% endfor %}</span><span class="diff-line context"> </span><span class="diff-line hunk">@@ -74,7 +74,7 @@</span><span class="diff-line context">   &quot;sabnzbd&quot;: {</span><span class="diff-line context">     &quot;apikey&quot;: &quot;{{ sabnzbd_apikey | default(&#x27;&#x27;) }}&quot;,</span><span class="diff-line context">     &quot;enabled&quot;: false,</span><span class="diff-line del">-    &quot;url&quot;: &quot;{{ sabnzbd_web_local_url }}&quot;</span><span class="diff-line add">+    &quot;url&quot;: &quot;{{ sabnzbd_role_web_local_url }}&quot;</span><span class="diff-line context">   },</span><span class="diff-line context">   &quot;syncer&quot;: {},</span><span class="diff-line context">   &quot;uploader&quot;: {</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-151">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/common/tasks/main.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -10,8 +10,8 @@</span><span class="diff-line context"> - name: BTRFS Tasks</span><span class="diff-line context">   ansible.builtin.include_tasks: &quot;btrfs.yml&quot;</span><span class="diff-line context">   loop:</span><span class="diff-line del">-    - /opt</span><span class="diff-line del">-    - /mnt/local</span><span class="diff-line add">+    - &quot;{{ server_appdata_path }}&quot;</span><span class="diff-line add">+    - &quot;{{ server_local_folder_path }}&quot;</span><span class="diff-line context">   loop_control:</span><span class="diff-line context">     loop_var: outer_item</span><span class="diff-line context"> </span><span class="diff-line hunk">@@ -27,11 +27,11 @@</span><span class="diff-line context">     - /home/{{ user.name }}/logs</span><span class="diff-line context">     - /home/{{ user.name }}/.config</span><span class="diff-line context">     - /home/{{ user.name }}/.config/pip</span><span class="diff-line del">-    - /opt</span><span class="diff-line del">-    - /opt/saltbox</span><span class="diff-line add">+    - &quot;{{ server_appdata_path }}&quot;</span><span class="diff-line add">+    - &quot;{{ server_appdata_path }}/saltbox&quot;</span><span class="diff-line context">     - /mnt</span><span class="diff-line del">-    - /mnt/local</span><span class="diff-line del">-    - /mnt/local/Media</span><span class="diff-line add">+    - &quot;{{ server_local_folder_path }}&quot;</span><span class="diff-line add">+    - &quot;{{ server_local_folder_path }}/Media&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Create common Media directories</span><span class="diff-line context">   ansible.builtin.file:</span><span class="diff-line hunk">@@ -42,9 +42,9 @@</span><span class="diff-line context">     mode: &quot;0775&quot;</span><span class="diff-line context">   when: common_create_media_subfolders</span><span class="diff-line context">   with_items:</span><span class="diff-line del">-    - /mnt/local/Media/Movies</span><span class="diff-line del">-    - /mnt/local/Media/Music</span><span class="diff-line del">-    - /mnt/local/Media/TV</span><span class="diff-line add">+    - &quot;{{ server_local_folder_path }}/Media/Movies&quot;</span><span class="diff-line add">+    - &quot;{{ server_local_folder_path }}/Media/Music&quot;</span><span class="diff-line add">+    - &quot;{{ server_local_folder_path }}/Media/TV&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Check if &#x27;localhost.yml&#x27; exists</span><span class="diff-line context">   ansible.builtin.stat:</span><span class="diff-line hunk">@@ -62,7 +62,7 @@</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Install required packages</span><span class="diff-line context">   ansible.builtin.apt:</span><span class="diff-line del">-    state: present</span><span class="diff-line add">+    state: latest</span><span class="diff-line context">     name:</span><span class="diff-line context">       - apt-transport-https</span><span class="diff-line context">       - ca-certificates</span><span class="diff-line hunk">@@ -70,7 +70,7 @@</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Install common packages</span><span class="diff-line context">   ansible.builtin.apt:</span><span class="diff-line del">-    state: present</span><span class="diff-line add">+    state: latest</span><span class="diff-line context">     name:</span><span class="diff-line context">       - &quot;nano&quot;</span><span class="diff-line context">       - &quot;zip&quot;</span><span class="diff-line hunk">@@ -102,25 +102,26 @@</span><span class="diff-line context">       - &quot;moreutils&quot;</span><span class="diff-line context">       - &quot;unrar&quot;</span><span class="diff-line context">       - &quot;python3-virtualenv&quot;</span><span class="diff-line add">+      - &quot;bash-completion&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Install extra packages</span><span class="diff-line context">   ansible.builtin.apt:</span><span class="diff-line del">-    state: present</span><span class="diff-line add">+    state: latest</span><span class="diff-line context">     name:</span><span class="diff-line context">       - &quot;run-one&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Fetch PCI Info</span><span class="diff-line context">   ansible.builtin.shell: &quot;lspci -v -s $(lspci | grep -E &#x27;.*VGA.*Intel.*&#x27; | cut -d&#x27; &#x27; -f 1) 2&gt;/dev/null || :&quot;</span><span class="diff-line context">   register: lscpi_resp</span><span class="diff-line del">-  when: gpu.intel</span><span class="diff-line add">+  when: use_intel</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Install &#x27;intel-gpu-tools&#x27;</span><span class="diff-line context">   ansible.builtin.apt:</span><span class="diff-line del">-    state: present</span><span class="diff-line add">+    state: latest</span><span class="diff-line context">     name:</span><span class="diff-line context">       - &quot;intel-gpu-tools&quot;</span><span class="diff-line context">   when:</span><span class="diff-line del">-    - gpu.intel</span><span class="diff-line add">+    - use_intel</span><span class="diff-line context">     - (&#x27;i915&#x27; in lscpi_resp.stdout)</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Check to see if &#x27;unrar&#x27; installed</span><span class="diff-line hunk">@@ -131,7 +132,7 @@</span><span class="diff-line context"> - name: Install &#x27;unrar-free&#x27; if &#x27;unrar&#x27; was not installed</span><span class="diff-line context">   ansible.builtin.apt:</span><span class="diff-line context">     name: unrar-free</span><span class="diff-line del">-    state: present</span><span class="diff-line add">+    state: latest</span><span class="diff-line context">   when: (not unrar_binary.stat.exists)</span><span class="diff-line context"> </span><span class="diff-line context"> - name: &quot;Import &#x27;pip.conf&#x27;&quot;</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-152">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/crowdsec/tasks/main.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -40,7 +40,7 @@</span><span class="diff-line context">   ansible.builtin.dpkg_selections:</span><span class="diff-line context">     name: &quot;crowdsec&quot;</span><span class="diff-line context">     selection: install</span><span class="diff-line del">-  when: (&#x27;crowdsec&#x27; in ansible_facts.packages)</span><span class="diff-line add">+  when: (&#x27;crowdsec&#x27; in ansible_facts[&#x27;packages&#x27;])</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Install crowdsec</span><span class="diff-line context">   ansible.builtin.apt:</span><span class="diff-line hunk">@@ -56,7 +56,7 @@</span><span class="diff-line context">   ansible.builtin.dpkg_selections:</span><span class="diff-line context">     name: &quot;crowdsec-firewall-bouncer-iptables&quot;</span><span class="diff-line context">     selection: install</span><span class="diff-line del">-  when: (&#x27;crowdsec-firewall-bouncer-iptables&#x27; in ansible_facts.packages)</span><span class="diff-line add">+  when: (&#x27;crowdsec-firewall-bouncer-iptables&#x27; in ansible_facts[&#x27;packages&#x27;])</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Manage iptables bouncer install</span><span class="diff-line context">   ansible.builtin.apt:</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-153">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/crowdsec/templates/acquis.yaml.j2</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -10,7 +10,7 @@</span><span class="diff-line context">   type: syslog</span><span class="diff-line context"> ---</span><span class="diff-line context"> filenames:</span><span class="diff-line del">-  - /opt/traefik/*.log</span><span class="diff-line add">+  - {{ server_appdata_path }}/traefik/*.log</span><span class="diff-line context"> labels:</span><span class="diff-line context">   type: traefik</span><span class="diff-line context"> ---</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-154">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/custom/tasks/main.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -18,11 +18,11 @@</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Custom | Install custom deb packages</span><span class="diff-line context">   ansible.builtin.apt:</span><span class="diff-line del">-    state: present</span><span class="diff-line add">+    state: latest</span><span class="diff-line context">     deb: &quot;{{ item }}&quot;</span><span class="diff-line context">   loop: &quot;{{ custom_deb }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Install custom pip modules</span><span class="diff-line context">   ansible.builtin.shell: &quot;pip install {{ item }}&quot;</span><span class="diff-line context">   loop: &quot;{{ custom_pip }}&quot;</span><span class="diff-line del">-  when: ansible_distribution_version is version(&#x27;22.04&#x27;, &#x27;&lt;=&#x27;)</span><span class="diff-line add">+  when: ansible_facts[&#x27;distribution_version&#x27;] is version(&#x27;22.04&#x27;, &#x27;&lt;=&#x27;)</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-155">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/ddclient/tasks/main.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -15,7 +15,7 @@</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Create ddclient directories</span><span class="diff-line context">   ansible.builtin.file:</span><span class="diff-line del">-    path: &quot;/opt/ddclient&quot;</span><span class="diff-line add">+    path: &quot;{{ server_appdata_path }}/ddclient&quot;</span><span class="diff-line context">     state: directory</span><span class="diff-line context">     owner: &quot;{{ user.name }}&quot;</span><span class="diff-line context">     group: &quot;{{ user.name }}&quot;</span><span class="diff-line hunk">@@ -45,7 +45,7 @@</span><span class="diff-line context"> - name: Import &#x27;ddclient.conf&#x27;</span><span class="diff-line context">   ansible.builtin.template:</span><span class="diff-line context">     src: &quot;ddclient.conf.j2&quot;</span><span class="diff-line del">-    dest: &quot;/opt/ddclient/ddclient.conf&quot;</span><span class="diff-line add">+    dest: &quot;{{ server_appdata_path }}/ddclient/ddclient.conf&quot;</span><span class="diff-line context">     owner: &quot;{{ user.name }}&quot;</span><span class="diff-line context">     group: &quot;{{ user.name }}&quot;</span><span class="diff-line context">     mode: &quot;0664&quot;</span><span class="diff-line hunk">@@ -61,7 +61,7 @@</span><span class="diff-line context">       PUID: &quot;{{ uid }}&quot;</span><span class="diff-line context">       PGID: &quot;{{ gid }}&quot;</span><span class="diff-line context">     volumes:</span><span class="diff-line del">-      - &quot;/opt/ddclient:/config&quot;</span><span class="diff-line add">+      - &quot;{{ server_appdata_path }}/ddclient:/config&quot;</span><span class="diff-line context">     labels:</span><span class="diff-line context">       &quot;com.github.saltbox.saltbox_managed&quot;: &quot;true&quot;</span><span class="diff-line context">     networks:</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-156">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/ddns/defaults/main.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -18,116 +18,69 @@</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line context"> # Comma separated FQDN&#x27;s that you want the container to manage</span><span class="diff-line del">-ddns_custom_urls: &quot;&quot;</span><span class="diff-line del">-ddns_delay: &quot;60&quot;</span><span class="diff-line add">+ddns_role_custom_urls: &quot;&quot;</span><span class="diff-line add">+ddns_role_delay: &quot;60&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # Docker</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line context"> # Container</span><span class="diff-line del">-ddns_docker_container: &quot;{{ ddns_name }}&quot;</span><span class="diff-line add">+ddns_role_docker_container: &quot;{{ ddns_name }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Image</span><span class="diff-line del">-ddns_docker_image_pull: true</span><span class="diff-line del">-ddns_docker_image_tag: &quot;latest&quot;</span><span class="diff-line del">-ddns_docker_image: &quot;saltydk/dns:{{ ddns_docker_image_tag }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Ports</span><span class="diff-line del">-ddns_docker_ports_defaults: []</span><span class="diff-line del">-ddns_docker_ports_custom: []</span><span class="diff-line del">-ddns_docker_ports: &quot;{{ ddns_docker_ports_defaults</span><span class="diff-line del">-                       + ddns_docker_ports_custom }}&quot;</span><span class="diff-line add">+ddns_role_docker_image_pull: true</span><span class="diff-line add">+ddns_role_docker_image_repo: &quot;saltydk/dns&quot;</span><span class="diff-line add">+ddns_role_docker_image_tag: &quot;latest&quot;</span><span class="diff-line add">+ddns_role_docker_image: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_image_repo&#x27;, role=&#x27;ddns&#x27;) }}:{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_image_tag&#x27;, role=&#x27;ddns&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Envs</span><span class="diff-line del">-ddns_docker_envs_default:</span><span class="diff-line add">+ddns_role_docker_envs_default:</span><span class="diff-line context">   TZ: &quot;{{ tz }}&quot;</span><span class="diff-line context">   CLOUDFLARE_API_KEY: &quot;{{ cloudflare.api }}&quot;</span><span class="diff-line context">   CLOUDFLARE_EMAIL: &quot;{{ cloudflare.email }}&quot;</span><span class="diff-line del">-  CLOUDFLARE_PROXY_DEFAULT: &quot;{{ dns.proxied | string }}&quot;</span><span class="diff-line add">+  CLOUDFLARE_PROXY_DEFAULT: &quot;{{ dns_proxied | string }}&quot;</span><span class="diff-line context">   TRAEFIK_API_URL: &quot;http://traefik:8080&quot;</span><span class="diff-line context">   TRAEFIK_ENTRYPOINTS: &quot;websecure,web&quot;</span><span class="diff-line del">-  CUSTOM_URLS: &quot;{{ ddns_custom_urls if (ddns_custom_urls | length &gt; 0) else omit }}&quot;</span><span class="diff-line del">-  IP_VERSION: &quot;{{ &#x27;both&#x27; if (dns.ipv4 and dns.ipv6) else (&#x27;4&#x27; if dns.ipv4 else &#x27;6&#x27;) }}&quot;</span><span class="diff-line del">-  DELAY: &quot;{{ ddns_delay }}&quot;</span><span class="diff-line del">-ddns_docker_envs_custom: {}</span><span class="diff-line del">-ddns_docker_envs: &quot;{{ ddns_docker_envs_default</span><span class="diff-line del">-                      | combine(ddns_docker_envs_custom) }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Commands</span><span class="diff-line del">-ddns_docker_volumes_global: false</span><span class="diff-line del">-ddns_docker_commands_default: []</span><span class="diff-line del">-ddns_docker_commands_custom: []</span><span class="diff-line del">-ddns_docker_commands: &quot;{{ ddns_docker_commands_default</span><span class="diff-line del">-                          + ddns_docker_commands_custom }}&quot;</span><span class="diff-line add">+  CUSTOM_URLS: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_custom_urls&#x27;, role=&#x27;ddns&#x27;) if (lookup(&#x27;role_var&#x27;, &#x27;_custom_urls&#x27;, role=&#x27;ddns&#x27;) | length &gt; 0) else omit }}&quot;</span><span class="diff-line add">+  IP_VERSION: &quot;{{ &#x27;both&#x27; if (dns_ipv4_enabled and dns_ipv6_enabled) else (&#x27;4&#x27; if dns_ipv4_enabled else &#x27;6&#x27;) }}&quot;</span><span class="diff-line add">+  DELAY: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_delay&#x27;, role=&#x27;ddns&#x27;) }}&quot;</span><span class="diff-line add">+ddns_role_docker_envs_custom: {}</span><span class="diff-line add">+ddns_role_docker_envs: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_envs_default&#x27;, role=&#x27;ddns&#x27;)</span><span class="diff-line add">+                           | combine(lookup(&#x27;role_var&#x27;, &#x27;_docker_envs_custom&#x27;, role=&#x27;ddns&#x27;)) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Volumes</span><span class="diff-line del">-ddns_docker_volumes_default: []</span><span class="diff-line del">-ddns_docker_volumes_custom: []</span><span class="diff-line del">-ddns_docker_volumes: &quot;{{ ddns_docker_volumes_default</span><span class="diff-line del">-                         + ddns_docker_volumes_custom }}&quot;</span><span class="diff-line add">+ddns_role_docker_volumes_global: false</span><span class="diff-line context"> </span><span class="diff-line context"> # Mounts</span><span class="diff-line del">-ddns_docker_mounts_default:</span><span class="diff-line add">+ddns_role_docker_mounts_default:</span><span class="diff-line context">   - target: /tmp</span><span class="diff-line context">     type: tmpfs</span><span class="diff-line del">-ddns_docker_mounts_custom: []</span><span class="diff-line del">-ddns_docker_mounts: &quot;{{ lookup(&#x27;vars&#x27;, ddns_name + &#x27;_docker_mounts_default&#x27;, default=ddns_docker_mounts_default)</span><span class="diff-line del">-                        + lookup(&#x27;vars&#x27;, ddns_name + &#x27;_docker_mounts_custom&#x27;, default=ddns_docker_mounts_custom) }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Devices</span><span class="diff-line del">-ddns_docker_devices_default: []</span><span class="diff-line del">-ddns_docker_devices_custom: []</span><span class="diff-line del">-ddns_docker_devices: &quot;{{ ddns_docker_devices_default</span><span class="diff-line del">-                         + ddns_docker_devices_custom }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Hosts</span><span class="diff-line del">-ddns_docker_hosts_default: {}</span><span class="diff-line del">-ddns_docker_hosts_custom: {}</span><span class="diff-line del">-ddns_docker_hosts: &quot;{{ docker_hosts_common</span><span class="diff-line del">-                       | combine(ddns_docker_hosts_default)</span><span class="diff-line del">-                       | combine(ddns_docker_hosts_custom) }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Labels</span><span class="diff-line del">-ddns_docker_labels_default: {}</span><span class="diff-line del">-ddns_docker_labels_custom: {}</span><span class="diff-line del">-ddns_docker_labels: &quot;{{ docker_labels_common</span><span class="diff-line del">-                        | combine(ddns_docker_labels_default)</span><span class="diff-line del">-                        | combine(ddns_docker_labels_custom) }}&quot;</span><span class="diff-line add">+ddns_role_docker_mounts_custom: []</span><span class="diff-line add">+ddns_role_docker_mounts: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_mounts_default&#x27;, role=&#x27;ddns&#x27;)</span><span class="diff-line add">+                             + lookup(&#x27;role_var&#x27;, &#x27;_docker_mounts_custom&#x27;, role=&#x27;ddns&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Hostname</span><span class="diff-line del">-ddns_docker_hostname: &quot;{{ ddns_name }}&quot;</span><span class="diff-line add">+ddns_role_docker_hostname: &quot;{{ ddns_name }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Networks</span><span class="diff-line del">-ddns_docker_networks_alias: &quot;{{ ddns_name }}&quot;</span><span class="diff-line del">-ddns_docker_networks_default: []</span><span class="diff-line del">-ddns_docker_networks_custom: []</span><span class="diff-line del">-ddns_docker_networks: &quot;{{ docker_networks_common</span><span class="diff-line del">-                          + ddns_docker_networks_default</span><span class="diff-line del">-                          + ddns_docker_networks_custom }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Capabilities</span><span class="diff-line del">-ddns_docker_capabilities_default: []</span><span class="diff-line del">-ddns_docker_capabilities_custom: []</span><span class="diff-line del">-ddns_docker_capabilities: &quot;{{ ddns_docker_capabilities_default</span><span class="diff-line del">-                              + ddns_docker_capabilities_custom }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Security Opts</span><span class="diff-line del">-ddns_docker_security_opts_default: []</span><span class="diff-line del">-ddns_docker_security_opts_custom: []</span><span class="diff-line del">-ddns_docker_security_opts: &quot;{{ ddns_docker_security_opts_default</span><span class="diff-line del">-                               + ddns_docker_security_opts_custom }}&quot;</span><span class="diff-line add">+ddns_role_docker_networks_alias: &quot;{{ ddns_name }}&quot;</span><span class="diff-line add">+ddns_role_docker_networks_default: []</span><span class="diff-line add">+ddns_role_docker_networks_custom: []</span><span class="diff-line add">+ddns_role_docker_networks: &quot;{{ docker_networks_common</span><span class="diff-line add">+                               + lookup(&#x27;role_var&#x27;, &#x27;_docker_networks_default&#x27;, role=&#x27;ddns&#x27;)</span><span class="diff-line add">+                               + lookup(&#x27;role_var&#x27;, &#x27;_docker_networks_custom&#x27;, role=&#x27;ddns&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Restart Policy</span><span class="diff-line del">-ddns_docker_restart_policy: unless-stopped</span><span class="diff-line add">+ddns_role_docker_restart_policy: unless-stopped</span><span class="diff-line context"> </span><span class="diff-line context"> # State</span><span class="diff-line del">-ddns_docker_state: started</span><span class="diff-line add">+ddns_role_docker_state: started</span><span class="diff-line context"> </span><span class="diff-line context"> # Init</span><span class="diff-line del">-ddns_docker_init: true</span><span class="diff-line add">+ddns_role_docker_init: true</span><span class="diff-line context"> </span><span class="diff-line context"> # Dependencies</span><span class="diff-line del">-ddns_depends_on: &quot;traefik&quot;</span><span class="diff-line del">-ddns_depends_on_delay: &quot;10&quot;</span><span class="diff-line del">-ddns_depends_on_healthchecks: &quot;false&quot;</span><span class="diff-line add">+ddns_role_depends_on: &quot;traefik&quot;</span><span class="diff-line add">+ddns_role_depends_on_delay: &quot;10&quot;</span><span class="diff-line add">+ddns_role_depends_on_healthchecks: &quot;false&quot;</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-157">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/ddns/tasks/main.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -12,7 +12,7 @@</span><span class="diff-line context">     msg:</span><span class="diff-line context">       - &quot;IPv4 or IPv6 DNS management has to be enabled.&quot;</span><span class="diff-line context">       - &quot;Check your &#x27;adv_settings.yml&#x27; config.&quot;</span><span class="diff-line del">-  when: not (dns.ipv4 or dns.ipv6)</span><span class="diff-line add">+  when: not (dns_ipv4_enabled or dns_ipv6_enabled)</span><span class="diff-line context"> </span><span class="diff-line context"> - name: &quot;Fail if not using Cloudflare&quot;</span><span class="diff-line context">   ansible.builtin.fail:</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-158">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/deluge/defaults/main.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -17,168 +17,131 @@</span><span class="diff-line context"> # Paths</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-deluge_paths_folder: &quot;{{ deluge_name }}&quot;</span><span class="diff-line del">-deluge_paths_location: &quot;{{ server_appdata_path }}/{{ deluge_paths_folder }}&quot;</span><span class="diff-line del">-deluge_paths_conf: &quot;{{ deluge_paths_location }}/core.conf&quot;</span><span class="diff-line del">-deluge_paths_downloads_location: &quot;{{ downloads_torrents_path }}/{{ deluge_paths_folder }}&quot;</span><span class="diff-line del">-deluge_paths_folders_list:</span><span class="diff-line del">-  - &quot;{{ deluge_paths_location }}&quot;</span><span class="diff-line del">-  - &quot;{{ deluge_paths_downloads_location }}&quot;</span><span class="diff-line del">-  - &quot;{{ deluge_paths_downloads_location }}/completed&quot;</span><span class="diff-line del">-  - &quot;{{ deluge_paths_downloads_location }}/incoming&quot;</span><span class="diff-line del">-  - &quot;{{ deluge_paths_downloads_location }}/watched&quot;</span><span class="diff-line del">-  - &quot;{{ deluge_paths_downloads_location }}/torrents&quot;</span><span class="diff-line add">+deluge_role_paths_folder: &quot;{{ deluge_name }}&quot;</span><span class="diff-line add">+deluge_role_paths_location: &quot;{{ server_appdata_path }}/{{ deluge_role_paths_folder }}&quot;</span><span class="diff-line add">+deluge_role_paths_conf: &quot;{{ deluge_role_paths_location }}/core.conf&quot;</span><span class="diff-line add">+deluge_role_paths_downloads_location: &quot;{{ downloads_torrents_path }}/{{ deluge_role_paths_folder }}&quot;</span><span class="diff-line add">+deluge_role_paths_folders_list:</span><span class="diff-line add">+  - &quot;{{ deluge_role_paths_location }}&quot;</span><span class="diff-line add">+  - &quot;{{ deluge_role_paths_downloads_location }}&quot;</span><span class="diff-line add">+  - &quot;{{ deluge_role_paths_downloads_location }}/completed&quot;</span><span class="diff-line add">+  - &quot;{{ deluge_role_paths_downloads_location }}/incoming&quot;</span><span class="diff-line add">+  - &quot;{{ deluge_role_paths_downloads_location }}/watched&quot;</span><span class="diff-line add">+  - &quot;{{ deluge_role_paths_downloads_location }}/torrents&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # Web</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-deluge_web_subdomain: &quot;{{ deluge_name }}&quot;</span><span class="diff-line del">-deluge_web_domain: &quot;{{ user.domain }}&quot;</span><span class="diff-line del">-deluge_web_port: &quot;8112&quot;</span><span class="diff-line del">-deluge_web_url: &quot;{{ &#x27;https://&#x27; + (deluge_web_subdomain + &#x27;.&#x27; + deluge_web_domain</span><span class="diff-line del">-                 if (deluge_web_subdomain | length &gt; 0)</span><span class="diff-line del">-                 else deluge_web_domain) }}&quot;</span><span class="diff-line add">+deluge_role_web_subdomain: &quot;{{ deluge_name }}&quot;</span><span class="diff-line add">+deluge_role_web_domain: &quot;{{ user.domain }}&quot;</span><span class="diff-line add">+deluge_role_web_port: &quot;8112&quot;</span><span class="diff-line add">+deluge_role_web_url: &quot;{{ &#x27;https://&#x27; + (lookup(&#x27;role_var&#x27;, &#x27;_web_subdomain&#x27;, role=&#x27;deluge&#x27;) + &#x27;.&#x27; + lookup(&#x27;role_var&#x27;, &#x27;_web_domain&#x27;, role=&#x27;deluge&#x27;)</span><span class="diff-line add">+                      if (lookup(&#x27;role_var&#x27;, &#x27;_web_subdomain&#x27;, role=&#x27;deluge&#x27;) | length &gt; 0)</span><span class="diff-line add">+                      else lookup(&#x27;role_var&#x27;, &#x27;_web_domain&#x27;, role=&#x27;deluge&#x27;)) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # DNS</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-deluge_dns_record: &quot;{{ lookup(&#x27;vars&#x27;, deluge_name + &#x27;_web_subdomain&#x27;, default=deluge_web_subdomain) }}&quot;</span><span class="diff-line del">-deluge_dns_zone: &quot;{{ lookup(&#x27;vars&#x27;, deluge_name + &#x27;_web_domain&#x27;, default=deluge_web_domain) }}&quot;</span><span class="diff-line del">-deluge_dns_proxy: &quot;{{ dns.proxied }}&quot;</span><span class="diff-line add">+deluge_role_dns_record: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_web_subdomain&#x27;, role=&#x27;deluge&#x27;) }}&quot;</span><span class="diff-line add">+deluge_role_dns_zone: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_web_domain&#x27;, role=&#x27;deluge&#x27;) }}&quot;</span><span class="diff-line add">+deluge_role_dns_proxy: &quot;{{ dns_proxied }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # Traefik</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-deluge_traefik_sso_middleware: &quot;&quot;</span><span class="diff-line del">-deluge_traefik_middleware_default: &quot;{{ traefik_default_middleware</span><span class="diff-line del">-                                       + (&#x27;,themepark-&#x27; + lookup(&#x27;vars&#x27;, deluge_name + &#x27;_name&#x27;, default=deluge_name)</span><span class="diff-line del">-                                         if (deluge_themepark_enabled and global_themepark_plugin_enabled)</span><span class="diff-line del">-                                         else &#x27;&#x27;) }}&quot;</span><span class="diff-line del">-deluge_traefik_middleware_custom: &quot;&quot;</span><span class="diff-line del">-deluge_traefik_certresolver: &quot;{{ traefik_default_certresolver }}&quot;</span><span class="diff-line del">-deluge_traefik_enabled: true</span><span class="diff-line del">-deluge_traefik_api_enabled: false</span><span class="diff-line del">-deluge_traefik_api_endpoint: &quot;&quot;</span><span class="diff-line add">+deluge_role_traefik_sso_middleware: &quot;&quot;</span><span class="diff-line add">+deluge_role_traefik_middleware_default: &quot;{{ traefik_default_middleware</span><span class="diff-line add">+                                            + (&#x27;,themepark-&#x27; + deluge_name</span><span class="diff-line add">+                                              if (lookup(&#x27;role_var&#x27;, &#x27;_themepark_enabled&#x27;, role=&#x27;deluge&#x27;) and global_themepark_plugin_enabled)</span><span class="diff-line add">+                                              else &#x27;&#x27;) }}&quot;</span><span class="diff-line add">+deluge_role_traefik_middleware_custom: &quot;&quot;</span><span class="diff-line add">+deluge_role_traefik_certresolver: &quot;{{ traefik_default_certresolver }}&quot;</span><span class="diff-line add">+deluge_role_traefik_enabled: true</span><span class="diff-line add">+deluge_role_traefik_api_enabled: false</span><span class="diff-line add">+deluge_role_traefik_api_endpoint: &quot;&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line del">-# THEME</span><span class="diff-line add">+# Theme</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line context"> # Options can be found at https://github.com/themepark-dev/theme.park</span><span class="diff-line del">-deluge_themepark_enabled: false</span><span class="diff-line del">-deluge_themepark_app: &quot;deluge&quot;</span><span class="diff-line del">-deluge_themepark_theme: &quot;{{ global_themepark_theme }}&quot;</span><span class="diff-line del">-deluge_themepark_domain: &quot;{{ global_themepark_domain }}&quot;</span><span class="diff-line del">-deluge_themepark_addons: []</span><span class="diff-line add">+deluge_role_themepark_enabled: false</span><span class="diff-line add">+deluge_role_themepark_app: &quot;deluge&quot;</span><span class="diff-line add">+deluge_role_themepark_theme: &quot;{{ global_themepark_theme }}&quot;</span><span class="diff-line add">+deluge_role_themepark_domain: &quot;{{ global_themepark_domain }}&quot;</span><span class="diff-line add">+deluge_role_themepark_addons: []</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # Docker</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line context"> # Container</span><span class="diff-line del">-deluge_docker_container: &quot;{{ deluge_name }}&quot;</span><span class="diff-line add">+deluge_role_docker_container: &quot;{{ deluge_name }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Image</span><span class="diff-line del">-deluge_docker_image_pull: true</span><span class="diff-line del">-deluge_docker_image_repo: &quot;lscr.io/linuxserver/deluge&quot;</span><span class="diff-line del">-deluge_docker_image_tag: &quot;latest&quot;</span><span class="diff-line del">-deluge_docker_image: &quot;{{ lookup(&#x27;vars&#x27;, deluge_name + &#x27;_docker_image_repo&#x27;, default=deluge_docker_image_repo)</span><span class="diff-line del">-                         + &#x27;:&#x27; + lookup(&#x27;vars&#x27;, deluge_name + &#x27;_docker_image_tag&#x27;, default=deluge_docker_image_tag) }}&quot;</span><span class="diff-line add">+deluge_role_docker_image_pull: true</span><span class="diff-line add">+deluge_role_docker_image_repo: &quot;lscr.io/linuxserver/deluge&quot;</span><span class="diff-line add">+deluge_role_docker_image_tag: &quot;latest&quot;</span><span class="diff-line add">+deluge_role_docker_image: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_image_repo&#x27;, role=&#x27;deluge&#x27;) }}:{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_image_tag&#x27;, role=&#x27;deluge&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Ports</span><span class="diff-line del">-deluge_docker_ports_58112: &quot;{{ port_lookup_58112.meta.port</span><span class="diff-line del">-                            if (port_lookup_58112.meta.port is defined) and (port_lookup_58112.meta.port | trim | length &gt; 0)</span><span class="diff-line del">-                            else &#x27;58112&#x27; }}&quot;</span><span class="diff-line add">+deluge_role_docker_ports_58112: &quot;{{ port_lookup_58112.meta.port</span><span class="diff-line add">+                                 if (port_lookup_58112.meta.port is defined) and (port_lookup_58112.meta.port | trim | length &gt; 0)</span><span class="diff-line add">+                                 else &#x27;58112&#x27; }}&quot;</span><span class="diff-line context"> </span><span class="diff-line del">-deluge_docker_ports_defaults:</span><span class="diff-line del">-  - &quot;{{ deluge_docker_ports_58112 }}:{{ deluge_docker_ports_58112 }}&quot;</span><span class="diff-line del">-  - &quot;{{ deluge_docker_ports_58112 }}:{{ deluge_docker_ports_58112 }}/udp&quot;</span><span class="diff-line del">-deluge_docker_ports_custom: []</span><span class="diff-line del">-deluge_docker_ports: &quot;{{ deluge_docker_ports_defaults</span><span class="diff-line del">-                         + deluge_docker_ports_custom }}&quot;</span><span class="diff-line add">+deluge_role_docker_ports_default:</span><span class="diff-line add">+  - &quot;{{ deluge_role_docker_ports_58112 }}:{{ deluge_role_docker_ports_58112 }}&quot;</span><span class="diff-line add">+  - &quot;{{ deluge_role_docker_ports_58112 }}:{{ deluge_role_docker_ports_58112 }}/udp&quot;</span><span class="diff-line add">+deluge_role_docker_ports_custom: []</span><span class="diff-line add">+deluge_role_docker_ports: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_ports_default&#x27;, role=&#x27;deluge&#x27;)</span><span class="diff-line add">+                              + lookup(&#x27;role_var&#x27;, &#x27;_docker_ports_custom&#x27;, role=&#x27;deluge&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Envs</span><span class="diff-line del">-deluge_docker_envs_default:</span><span class="diff-line add">+deluge_role_docker_envs_default:</span><span class="diff-line context">   PUID: &quot;{{ uid }}&quot;</span><span class="diff-line context">   PGID: &quot;{{ gid }}&quot;</span><span class="diff-line context">   TZ: &quot;{{ tz }}&quot;</span><span class="diff-line context">   UMASK: &quot;002&quot;</span><span class="diff-line del">-deluge_docker_envs_custom: {}</span><span class="diff-line del">-deluge_docker_envs: &quot;{{ lookup(&#x27;vars&#x27;, deluge_name + &#x27;_docker_envs_default&#x27;, default=deluge_docker_envs_default)</span><span class="diff-line del">-                        | combine(lookup(&#x27;vars&#x27;, deluge_name + &#x27;_docker_envs_custom&#x27;, default=deluge_docker_envs_custom)) }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Commands</span><span class="diff-line del">-deluge_docker_commands_default: []</span><span class="diff-line del">-deluge_docker_commands_custom: []</span><span class="diff-line del">-deluge_docker_commands: &quot;{{ lookup(&#x27;vars&#x27;, deluge_name + &#x27;_docker_commands_default&#x27;, default=deluge_docker_commands_default)</span><span class="diff-line del">-                            + lookup(&#x27;vars&#x27;, deluge_name + &#x27;_docker_commands_custom&#x27;, default=deluge_docker_commands_custom) }}&quot;</span><span class="diff-line add">+deluge_role_docker_envs_custom: {}</span><span class="diff-line add">+deluge_role_docker_envs: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_envs_default&#x27;, role=&#x27;deluge&#x27;)</span><span class="diff-line add">+                             | combine(lookup(&#x27;role_var&#x27;, &#x27;_docker_envs_custom&#x27;, role=&#x27;deluge&#x27;)) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Volumes</span><span class="diff-line del">-deluge_docker_volumes_default:</span><span class="diff-line del">-  - &quot;{{ deluge_paths_location }}:/config&quot;</span><span class="diff-line add">+deluge_role_docker_volumes_default:</span><span class="diff-line add">+  - &quot;{{ deluge_role_paths_location }}:/config&quot;</span><span class="diff-line context">   - &quot;{{ server_appdata_path }}/scripts:/scripts&quot;</span><span class="diff-line del">-deluge_docker_volumes_custom: []</span><span class="diff-line del">-deluge_docker_volumes: &quot;{{ lookup(&#x27;vars&#x27;, deluge_name + &#x27;_docker_volumes_default&#x27;, default=deluge_docker_volumes_default)</span><span class="diff-line del">-                           + lookup(&#x27;vars&#x27;, deluge_name + &#x27;_docker_volumes_custom&#x27;, default=deluge_docker_volumes_custom) }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Devices</span><span class="diff-line del">-deluge_docker_devices_default: []</span><span class="diff-line del">-deluge_docker_devices_custom: []</span><span class="diff-line del">-deluge_docker_devices: &quot;{{ lookup(&#x27;vars&#x27;, deluge_name + &#x27;_docker_devices_default&#x27;, default=deluge_docker_devices_default)</span><span class="diff-line del">-                           + lookup(&#x27;vars&#x27;, deluge_name + &#x27;_docker_devices_custom&#x27;, default=deluge_docker_devices_custom) }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Hosts</span><span class="diff-line del">-deluge_docker_hosts_default: {}</span><span class="diff-line del">-deluge_docker_hosts_custom: {}</span><span class="diff-line del">-deluge_docker_hosts: &quot;{{ docker_hosts_common</span><span class="diff-line del">-                         | combine(lookup(&#x27;vars&#x27;, deluge_name + &#x27;_docker_hosts_default&#x27;, default=deluge_docker_hosts_default))</span><span class="diff-line del">-                         | combine(lookup(&#x27;vars&#x27;, deluge_name + &#x27;_docker_hosts_custom&#x27;, default=deluge_docker_hosts_custom)) }}&quot;</span><span class="diff-line add">+deluge_role_docker_volumes_custom: []</span><span class="diff-line add">+deluge_role_docker_volumes: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_volumes_default&#x27;, role=&#x27;deluge&#x27;)</span><span class="diff-line add">+                                + lookup(&#x27;role_var&#x27;, &#x27;_docker_volumes_custom&#x27;, role=&#x27;deluge&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Labels</span><span class="diff-line del">-deluge_docker_labels_default: {}</span><span class="diff-line del">-deluge_docker_labels_custom: {}</span><span class="diff-line del">-deluge_docker_labels: &quot;{{ docker_labels_common</span><span class="diff-line del">-                          | combine(lookup(&#x27;vars&#x27;, deluge_name + &#x27;_docker_labels_default&#x27;, default=deluge_docker_labels_default))</span><span class="diff-line del">-                          | combine((traefik_themepark_labels</span><span class="diff-line del">-                                    if (deluge_themepark_enabled and global_themepark_plugin_enabled)</span><span class="diff-line del">-                                    else {}),</span><span class="diff-line del">-                                    lookup(&#x27;vars&#x27;, deluge_name + &#x27;_docker_labels_custom&#x27;, default=deluge_docker_labels_custom)) }}&quot;</span><span class="diff-line add">+deluge_role_docker_labels_default: {}</span><span class="diff-line add">+deluge_role_docker_labels_custom: {}</span><span class="diff-line add">+deluge_role_docker_labels: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_labels_default&#x27;, role=&#x27;deluge&#x27;)</span><span class="diff-line add">+                               | combine((traefik_themepark_labels</span><span class="diff-line add">+                                         if (lookup(&#x27;role_var&#x27;, &#x27;_themepark_enabled&#x27;, role=&#x27;deluge&#x27;) and global_themepark_plugin_enabled)</span><span class="diff-line add">+                                         else {}),</span><span class="diff-line add">+                                         lookup(&#x27;role_var&#x27;, &#x27;_docker_labels_custom&#x27;, role=&#x27;deluge&#x27;)) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Hostname</span><span class="diff-line del">-deluge_docker_hostname: &quot;{{ deluge_name }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Network Mode</span><span class="diff-line del">-deluge_docker_network_mode_default: &quot;{{ docker_networks_name_common }}&quot;</span><span class="diff-line del">-deluge_docker_network_mode: &quot;{{ lookup(&#x27;vars&#x27;, deluge_name + &#x27;_docker_network_mode_default&#x27;, default=deluge_docker_network_mode_default) }}&quot;</span><span class="diff-line add">+deluge_role_docker_hostname: &quot;{{ deluge_name }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Networks</span><span class="diff-line del">-deluge_docker_networks_alias: &quot;{{ deluge_name }}&quot;</span><span class="diff-line del">-deluge_docker_networks_default: []</span><span class="diff-line del">-deluge_docker_networks_custom: []</span><span class="diff-line del">-deluge_docker_networks: &quot;{{ docker_networks_common</span><span class="diff-line del">-                            + lookup(&#x27;vars&#x27;, deluge_name + &#x27;_docker_networks_default&#x27;, default=deluge_docker_networks_default)</span><span class="diff-line del">-                            + lookup(&#x27;vars&#x27;, deluge_name + &#x27;_docker_networks_custom&#x27;, default=deluge_docker_networks_custom) }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Capabilities</span><span class="diff-line del">-deluge_docker_capabilities_default: []</span><span class="diff-line del">-deluge_docker_capabilities_custom: []</span><span class="diff-line del">-deluge_docker_capabilities: &quot;{{ lookup(&#x27;vars&#x27;, deluge_name + &#x27;_docker_capabilities_default&#x27;, default=deluge_docker_capabilities_default)</span><span class="diff-line del">-                                + lookup(&#x27;vars&#x27;, deluge_name + &#x27;_docker_capabilities_custom&#x27;, default=deluge_docker_capabilities_custom) }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Security Opts</span><span class="diff-line del">-deluge_docker_security_opts_default: []</span><span class="diff-line del">-deluge_docker_security_opts_custom: []</span><span class="diff-line del">-deluge_docker_security_opts: &quot;{{ lookup(&#x27;vars&#x27;, deluge_name + &#x27;_docker_security_opts_default&#x27;, default=deluge_docker_security_opts_default)</span><span class="diff-line del">-                                 + lookup(&#x27;vars&#x27;, deluge_name + &#x27;_docker_security_opts_custom&#x27;, default=deluge_docker_security_opts_custom) }}&quot;</span><span class="diff-line add">+deluge_role_docker_networks_alias: &quot;{{ deluge_name }}&quot;</span><span class="diff-line add">+deluge_role_docker_networks_default: []</span><span class="diff-line add">+deluge_role_docker_networks_custom: []</span><span class="diff-line add">+deluge_role_docker_networks: &quot;{{ docker_networks_common</span><span class="diff-line add">+                                 + lookup(&#x27;role_var&#x27;, &#x27;_docker_networks_default&#x27;, role=&#x27;deluge&#x27;)</span><span class="diff-line add">+                                 + lookup(&#x27;role_var&#x27;, &#x27;_docker_networks_custom&#x27;, role=&#x27;deluge&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Restart Policy</span><span class="diff-line del">-deluge_docker_restart_policy: unless-stopped</span><span class="diff-line add">+deluge_role_docker_restart_policy: unless-stopped</span><span class="diff-line context"> </span><span class="diff-line context"> # Stop Timeout</span><span class="diff-line del">-deluge_docker_stop_timeout: 900</span><span class="diff-line add">+deluge_role_docker_stop_timeout: 900</span><span class="diff-line context"> </span><span class="diff-line context"> # State</span><span class="diff-line del">-deluge_docker_state: started</span><span class="diff-line add">+deluge_role_docker_state: started</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-159">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/deluge/tasks/main2.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -10,9 +10,9 @@</span><span class="diff-line context"> - name: Add DNS record</span><span class="diff-line context">   ansible.builtin.include_tasks: &quot;{{ resources_tasks_path }}/dns/tasker.yml&quot;</span><span class="diff-line context">   vars:</span><span class="diff-line del">-    dns_record: &quot;{{ lookup(&#x27;vars&#x27;, role_name + &#x27;_dns_record&#x27;) }}&quot;</span><span class="diff-line del">-    dns_zone: &quot;{{ lookup(&#x27;vars&#x27;, role_name + &#x27;_dns_zone&#x27;) }}&quot;</span><span class="diff-line del">-    dns_proxy: &quot;{{ lookup(&#x27;vars&#x27;, role_name + &#x27;_dns_proxy&#x27;) }}&quot;</span><span class="diff-line add">+    dns_record: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_dns_record&#x27;) }}&quot;</span><span class="diff-line add">+    dns_zone: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_dns_zone&#x27;) }}&quot;</span><span class="diff-line add">+    dns_proxy: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_dns_proxy&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Remove existing Docker container</span><span class="diff-line context">   ansible.builtin.include_tasks: &quot;{{ resources_tasks_path }}/docker/remove_docker_container.yml&quot;</span><span class="diff-line hunk">@@ -21,10 +21,10 @@</span><span class="diff-line context">   ansible.builtin.include_tasks: &quot;{{ resources_tasks_path }}/directories/create_directories.yml&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Pre-Install Tasks</span><span class="diff-line del">-  ansible.builtin.import_tasks: &quot;subtasks/pre-install/main.yml&quot;</span><span class="diff-line add">+  ansible.builtin.include_tasks: &quot;subtasks/pre-install/main.yml&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Create Docker container</span><span class="diff-line context">   ansible.builtin.include_tasks: &quot;{{ resources_tasks_path }}/docker/create_docker_container.yml&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Post-Install Tasks</span><span class="diff-line del">-  ansible.builtin.import_tasks: &quot;subtasks/post-install/main.yml&quot;</span><span class="diff-line add">+  ansible.builtin.include_tasks: &quot;subtasks/post-install/main.yml&quot;</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-160">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/deluge/tasks/subtasks/post-install/main.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -9,7 +9,7 @@</span><span class="diff-line context"> ---</span><span class="diff-line context"> - name: Post-Install | Wait for config to be created</span><span class="diff-line context">   ansible.builtin.wait_for:</span><span class="diff-line del">-    path: &quot;{{ deluge_paths_conf }}&quot;</span><span class="diff-line add">+    path: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_conf&#x27;, role=&#x27;deluge&#x27;) }}&quot;</span><span class="diff-line context">     state: present</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Post-Install | Wait for 10 seconds</span><span class="diff-line hunk">@@ -20,7 +20,7 @@</span><span class="diff-line context">   ansible.builtin.include_tasks: &quot;{{ resources_tasks_path }}/docker/stop_docker_container.yml&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Post-Install | Settings Task</span><span class="diff-line del">-  ansible.builtin.import_tasks: &quot;settings/main.yml&quot;</span><span class="diff-line add">+  ansible.builtin.include_tasks: &quot;settings/main.yml&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Post-Install | Start container</span><span class="diff-line context">   ansible.builtin.include_tasks: &quot;{{ resources_tasks_path }}/docker/start_docker_container.yml&quot;</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-161">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/deluge/tasks/subtasks/post-install/settings/main.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -9,25 +9,25 @@</span><span class="diff-line context"> ---</span><span class="diff-line context"> - name: Post-Install | Settings | Update &#x27;core.conf&#x27; | Set listen ports</span><span class="diff-line context">   ansible.builtin.replace:</span><span class="diff-line del">-    path: &quot;{{ deluge_paths_conf }}&quot;</span><span class="diff-line add">+    path: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_conf&#x27;, role=&#x27;deluge&#x27;) }}&quot;</span><span class="diff-line context">     regexp: &#x27;&quot;listen_ports&quot;: (\[[\d|\W]+\]),&#x27;</span><span class="diff-line del">-    replace: &#x27;&quot;listen_ports&quot;: [{{ deluge_docker_ports_58112 }},{{ deluge_docker_ports_58112 }}],&#x27;</span><span class="diff-line add">+    replace: &#x27;&quot;listen_ports&quot;: [{{ lookup(&quot;role_var&quot;, &quot;_docker_ports_58112&quot;, role=&quot;deluge&quot;) }},{{ lookup(&quot;role_var&quot;, &quot;_docker_ports_58112&quot;, role=&quot;deluge&quot;) }}],&#x27;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Post-Install | Settings | Update &#x27;core.conf&#x27; | Set listen random port to null</span><span class="diff-line context">   ansible.builtin.replace:</span><span class="diff-line del">-    path: &quot;{{ deluge_paths_conf }}&quot;</span><span class="diff-line add">+    path: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_conf&#x27;, role=&#x27;deluge&#x27;) }}&quot;</span><span class="diff-line context">     regexp: &#x27;&quot;listen_random_port&quot;: ([\d|\W]+),&#x27;</span><span class="diff-line context">     replace: &#x27;&quot;listen_random_port&quot;: null,&#x27;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Post-Install | Settings | Update &#x27;core.conf&#x27; | Disable random incoming port</span><span class="diff-line context">   ansible.builtin.replace:</span><span class="diff-line del">-    path: &quot;{{ deluge_paths_conf }}&quot;</span><span class="diff-line add">+    path: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_conf&#x27;, role=&#x27;deluge&#x27;) }}&quot;</span><span class="diff-line context">     regexp: &#x27;&quot;random_port&quot;: ([\w]+),&#x27;</span><span class="diff-line context">     replace: &#x27;&quot;random_port&quot;: false,&#x27;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Post-Install | Settings | Update &#x27;core.conf&#x27; | Enable random outgoing ports</span><span class="diff-line context">   ansible.builtin.replace:</span><span class="diff-line del">-    path: &quot;{{ deluge_paths_conf }}&quot;</span><span class="diff-line add">+    path: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_conf&#x27;, role=&#x27;deluge&#x27;) }}&quot;</span><span class="diff-line context">     regexp: &#x27;&quot;random_outgoing_ports&quot;: ([\w]+),&#x27;</span><span class="diff-line context">     replace: &#x27;&quot;random_outgoing_ports&quot;: true,&#x27;</span><span class="diff-line context"> </span><span class="diff-line hunk">@@ -36,7 +36,7 @@</span><span class="diff-line context">   block:</span><span class="diff-line context">     - name: Post-Install | Settings | Update &#x27;core.conf&#x27; | Disable Network Extras</span><span class="diff-line context">       ansible.builtin.replace:</span><span class="diff-line del">-        path: &quot;{{ deluge_paths_conf }}&quot;</span><span class="diff-line add">+        path: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_conf&#x27;, role=&#x27;deluge&#x27;) }}&quot;</span><span class="diff-line context">         regexp: &#x27;&quot;{{ item }}&quot;: ([\w]+){{ &quot;,&quot; if item != &quot;utpex&quot; else &quot;&quot; }}&#x27;</span><span class="diff-line context">         replace: &#x27;&quot;{{ item }}&quot;: false{{ &quot;,&quot; if item != &quot;utpex&quot; else &quot;&quot; }}&#x27;</span><span class="diff-line context">       loop:</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-162">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/deluge/tasks/subtasks/pre-install/main.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -17,5 +17,5 @@</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Pre-Install | Check if existing config file exists</span><span class="diff-line context">   ansible.builtin.stat:</span><span class="diff-line del">-    path: &quot;{{ deluge_paths_conf }}&quot;</span><span class="diff-line add">+    path: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_conf&#x27;, role=&#x27;deluge&#x27;) }}&quot;</span><span class="diff-line context">   register: deluge_paths_conf_stat</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-163">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/diag/defaults/main.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -7,17 +7,14 @@</span><span class="diff-line context"> #                   GNU General Public License v3.0                     #</span><span class="diff-line context"> #########################################################################</span><span class="diff-line context"> ---</span><span class="diff-line del">-diagnose_cloudflare_script_path: &quot;/srv/git/saltbox/roles/diag/files/cloudflare_ssl.py&quot;</span><span class="diff-line del">-</span><span class="diff-line context"> diagnose_vars:</span><span class="diff-line context">   - &quot;Saltbox repo branch: {{ git_branch.stdout if (git_branch is defined and git_branch.stdout is defined) else &#x27;Failed retrieving&#x27; }}&quot;</span><span class="diff-line context">   - &quot;Saltbox repo commit: {{ git_version.stdout if (git_version is defined and git_version.stdout is defined) else &#x27;Failed retrieving&#x27; }}&quot;</span><span class="diff-line context">   - &quot;Saltbox upstream commit: {{ git_origin_version.stdout if (git_origin_version is defined and git_origin_version.stdout is defined) else &#x27;Failed retrieving&#x27; }}&quot;</span><span class="diff-line context">   - &quot;cloudflare_is_enabled: {{ cloudflare_is_enabled | lower }}&quot;</span><span class="diff-line del">-  - &quot;{{ &#x27;Cloudflare venv deployed: &#x27; + (diagnose_cloudflare_venv.stat.exists | string | lower) if (cloudflare_is_enabled and (dns.ipv4 or dns.ipv6)) else &#x27;&#x27; }}&quot;</span><span class="diff-line del">-  - &quot;{{ &#x27;Cloudflare IPv4 automation: &#x27; + (dns.ipv4 | string | lower) if cloudflare_is_enabled else &#x27;&#x27; }}&quot;</span><span class="diff-line del">-  - &quot;{{ &#x27;Cloudflare IPv6 automation: &#x27; + (dns.ipv6 | string | lower) if cloudflare_is_enabled else &#x27;&#x27; }}&quot;</span><span class="diff-line del">-  - &quot;{{ &#x27;Cloudflare SSL Mode: &#x27; + cloudflare_ssl.stdout if (cloudflare_is_enabled and cloudflare_ssl is defined and cloudflare_ssl.stdout is defined) else &#x27;&#x27; }}&quot;</span><span class="diff-line add">+  - &quot;{{ &#x27;Cloudflare IPv4 automation: &#x27; + (dns_ipv4_enabled | string | lower) if cloudflare_is_enabled else &#x27;&#x27; }}&quot;</span><span class="diff-line add">+  - &quot;{{ &#x27;Cloudflare IPv6 automation: &#x27; + (dns_ipv6_enabled | string | lower) if cloudflare_is_enabled else &#x27;&#x27; }}&quot;</span><span class="diff-line add">+  - &quot;{{ &#x27;Cloudflare SSL Mode: &#x27; + cloudflare_ssl.ssl_mode if (cloudflare_is_enabled and cloudflare_ssl is defined and cloudflare_ssl.ssl_mode is defined) else &#x27;&#x27; }}&quot;</span><span class="diff-line context">   - &quot;plex_account_is_enabled: {{ plex_account_is_enabled | lower }}&quot;</span><span class="diff-line context">   - &quot;rclone_remote_is_defined: {{ rclone_remote_is_defined | lower }}&quot;</span><span class="diff-line context">   - &quot;use_cloudplow: {{ use_cloudplow | lower }}&quot;</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-164">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/diag/tasks/main.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -10,36 +10,12 @@</span><span class="diff-line context"> - name: Cloudflare API lookup</span><span class="diff-line context">   when: cloudflare_is_enabled</span><span class="diff-line context">   block:</span><span class="diff-line del">-    - name: Check if Cloudflare venv exists</span><span class="diff-line del">-      ansible.builtin.stat:</span><span class="diff-line del">-        path: &quot;/srv/cloudflare-helper/venv/bin/python3&quot;</span><span class="diff-line del">-      register: diagnose_cloudflare_venv</span><span class="diff-line del">-</span><span class="diff-line del">-    - name: Include Cloudflare Setup venv role default vars</span><span class="diff-line del">-      ansible.builtin.include_vars: &quot;{{ resources_path }}/roles/dns/defaults/main.yml&quot;</span><span class="diff-line del">-      when: not diagnose_cloudflare_venv.stat.exists</span><span class="diff-line del">-</span><span class="diff-line del">-    - name: Setup Cloudflare venv</span><span class="diff-line del">-      ansible.builtin.include_tasks: &quot;{{ resources_path }}/roles/dns/tasks/cloudflare/subtasks/setup.yml&quot;</span><span class="diff-line del">-      when: not diagnose_cloudflare_venv.stat.exists</span><span class="diff-line del">-      vars:</span><span class="diff-line del">-        cloudflare_files:</span><span class="diff-line del">-          - &quot;{{ resources_path }}/roles/dns/files/fetch_cloudflare_records.py&quot;</span><span class="diff-line del">-          - &quot;{{ resources_path }}/roles/dns/files/requirements.txt&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-    - name: Get FLD</span><span class="diff-line del">-      ansible.builtin.shell: |</span><span class="diff-line del">-        {{ saltbox_python }} -c &quot;from tld import get_tld; res = get_tld(\&quot;http://{{ user.domain }}\&quot;, as_object=True); print(res.fld)&quot;</span><span class="diff-line del">-      register: diagnose_fld</span><span class="diff-line del">-</span><span class="diff-line del">-    - name: Fetch Record information</span><span class="diff-line del">-      ansible.builtin.shell: &quot;/srv/cloudflare-helper/venv/bin/python3 {{ diagnose_cloudflare_script_path }} --auth_key &#x27;{{ cloudflare.api }}&#x27; --auth_email &#x27;{{ cloudflare.email }}&#x27; --zone_name &#x27;{{ diagnose_fld.stdout }}&#x27;&quot;</span><span class="diff-line add">+    - name: Get Cloudflare SSL/TLS mode</span><span class="diff-line add">+      cloudflare_ssl:</span><span class="diff-line add">+        auth_email: &quot;{{ cloudflare.email }}&quot;</span><span class="diff-line add">+        auth_key: &quot;{{ cloudflare.api }}&quot;</span><span class="diff-line add">+        domain: &quot;{{ user.domain }}&quot;</span><span class="diff-line context">       register: cloudflare_ssl</span><span class="diff-line del">-</span><span class="diff-line del">-    - name: Print Failure Output</span><span class="diff-line del">-      ansible.builtin.fail:</span><span class="diff-line del">-        msg: &quot;{{ cloudflare_ssl.stderr }}&quot;</span><span class="diff-line del">-      when: cloudflare_ssl.rc != 0</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Gather mount information</span><span class="diff-line context">   ansible.builtin.setup:</span><span class="diff-line hunk">@@ -49,7 +25,7 @@</span><span class="diff-line context"> - name: Filter mount information</span><span class="diff-line context">   ansible.builtin.set_fact:</span><span class="diff-line context">     host_mounts: &quot;{{ host_mounts | default({}) | combine({item.mount: item.fstype}) }}&quot;</span><span class="diff-line del">-  loop: &quot;{{ ansible_mounts }}&quot;</span><span class="diff-line add">+  loop: &quot;{{ ansible_facts[&#x27;mounts&#x27;] }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: &quot;Diagnose variables&quot;</span><span class="diff-line context">   ansible.builtin.debug:</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-165">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/diun/defaults/main.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -17,100 +17,63 @@</span><span class="diff-line context"> # Paths</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-diun_paths_folder: &quot;{{ diun_name }}&quot;</span><span class="diff-line del">-diun_paths_location: &quot;{{ server_appdata_path }}/{{ diun_paths_folder }}&quot;</span><span class="diff-line del">-diun_paths_folders_list:</span><span class="diff-line del">-  - &quot;{{ diun_paths_location }}&quot;</span><span class="diff-line del">-  - &quot;{{ diun_paths_location }}/data&quot;</span><span class="diff-line add">+diun_role_paths_folder: &quot;{{ diun_name }}&quot;</span><span class="diff-line add">+diun_role_paths_location: &quot;{{ server_appdata_path }}/{{ diun_role_paths_folder }}&quot;</span><span class="diff-line add">+diun_role_paths_folders_list:</span><span class="diff-line add">+  - &quot;{{ diun_role_paths_location }}&quot;</span><span class="diff-line add">+  - &quot;{{ diun_role_paths_location }}/data&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # Docker</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line context"> # Container</span><span class="diff-line del">-diun_docker_container: &quot;{{ diun_name }}&quot;</span><span class="diff-line add">+diun_role_docker_container: &quot;{{ diun_name }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Image</span><span class="diff-line del">-diun_docker_image_pull: true</span><span class="diff-line del">-diun_docker_image_tag: &quot;latest&quot;</span><span class="diff-line del">-diun_docker_image: &quot;crazymax/diun:{{ diun_docker_image_tag }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Ports</span><span class="diff-line del">-diun_docker_ports_defaults: []</span><span class="diff-line del">-diun_docker_ports_custom: []</span><span class="diff-line del">-diun_docker_ports: &quot;{{ diun_docker_ports_defaults</span><span class="diff-line del">-                       + diun_docker_ports_custom }}&quot;</span><span class="diff-line add">+diun_role_docker_image_pull: true</span><span class="diff-line add">+diun_role_docker_image_repo: &quot;crazymax/diun&quot;</span><span class="diff-line add">+diun_role_docker_image_tag: &quot;latest&quot;</span><span class="diff-line add">+diun_role_docker_image: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_image_repo&#x27;, role=&#x27;diun&#x27;) }}:{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_image_tag&#x27;, role=&#x27;diun&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Envs</span><span class="diff-line del">-diun_docker_envs_default:</span><span class="diff-line add">+diun_role_docker_envs_default:</span><span class="diff-line context">   TZ: &quot;{{ tz }}&quot;</span><span class="diff-line context">   LOG_LEVEL: &quot;info&quot;</span><span class="diff-line context">   LOG_JSON: &quot;false&quot;</span><span class="diff-line del">-diun_docker_envs_custom: {}</span><span class="diff-line del">-diun_docker_envs: &quot;{{ diun_docker_envs_default</span><span class="diff-line del">-                      | combine(diun_docker_envs_custom) }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Commands</span><span class="diff-line del">-diun_docker_commands_default: []</span><span class="diff-line del">-diun_docker_commands_custom: []</span><span class="diff-line del">-diun_docker_commands: &quot;{{ diun_docker_commands_default</span><span class="diff-line del">-                          + diun_docker_commands_custom }}&quot;</span><span class="diff-line add">+diun_role_docker_envs_custom: {}</span><span class="diff-line add">+diun_role_docker_envs: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_envs_default&#x27;, role=&#x27;diun&#x27;)</span><span class="diff-line add">+                           | combine(lookup(&#x27;role_var&#x27;, &#x27;_docker_envs_custom&#x27;, role=&#x27;diun&#x27;)) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Volumes</span><span class="diff-line del">-diun_docker_volumes_default:</span><span class="diff-line del">-  - &quot;{{ diun_paths_location }}/data:/data&quot;</span><span class="diff-line del">-  - &quot;{{ diun_paths_location }}/diun.yml:/diun.yml:ro&quot;</span><span class="diff-line add">+diun_role_docker_volumes_default:</span><span class="diff-line add">+  - &quot;{{ diun_role_paths_location }}/data:/data&quot;</span><span class="diff-line add">+  - &quot;{{ diun_role_paths_location }}/diun.yml:/diun.yml:ro&quot;</span><span class="diff-line context">   - &quot;/var/run/docker.sock:/var/run/docker.sock&quot;</span><span class="diff-line del">-diun_docker_volumes_custom: []</span><span class="diff-line del">-diun_docker_volumes: &quot;{{ diun_docker_volumes_default</span><span class="diff-line del">-                         + diun_docker_volumes_custom }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Devices</span><span class="diff-line del">-diun_docker_devices_default: []</span><span class="diff-line del">-diun_docker_devices_custom: []</span><span class="diff-line del">-diun_docker_devices: &quot;{{ diun_docker_devices_default</span><span class="diff-line del">-                         + diun_docker_devices_custom }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Hosts</span><span class="diff-line del">-diun_docker_hosts_default: {}</span><span class="diff-line del">-diun_docker_hosts_custom: {}</span><span class="diff-line del">-diun_docker_hosts: &quot;{{ docker_hosts_common</span><span class="diff-line del">-                       | combine(diun_docker_hosts_default)</span><span class="diff-line del">-                       | combine(diun_docker_hosts_custom) }}&quot;</span><span class="diff-line add">+diun_role_docker_volumes_custom: []</span><span class="diff-line add">+diun_role_docker_volumes: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_volumes_default&#x27;, role=&#x27;diun&#x27;)</span><span class="diff-line add">+                              + lookup(&#x27;role_var&#x27;, &#x27;_docker_volumes_custom&#x27;, role=&#x27;diun&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Labels</span><span class="diff-line del">-diun_docker_labels_default:</span><span class="diff-line add">+diun_role_docker_labels_default:</span><span class="diff-line context">   diun.enable: &quot;true&quot;</span><span class="diff-line del">-diun_docker_labels_custom: {}</span><span class="diff-line del">-diun_docker_labels: &quot;{{ docker_labels_common</span><span class="diff-line del">-                        | combine(diun_docker_labels_default)</span><span class="diff-line del">-                        | combine(diun_docker_labels_custom) }}&quot;</span><span class="diff-line add">+diun_role_docker_labels_custom: {}</span><span class="diff-line add">+diun_role_docker_labels: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_labels_default&#x27;, role=&#x27;diun&#x27;)</span><span class="diff-line add">+                             | combine(lookup(&#x27;role_var&#x27;, &#x27;_docker_labels_custom&#x27;, role=&#x27;diun&#x27;)) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Hostname</span><span class="diff-line del">-diun_docker_hostname: &quot;{{ diun_name }}&quot;</span><span class="diff-line add">+diun_role_docker_hostname: &quot;{{ diun_name }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Networks</span><span class="diff-line del">-diun_docker_networks_alias: &quot;{{ diun_name }}&quot;</span><span class="diff-line del">-diun_docker_networks_default: []</span><span class="diff-line del">-diun_docker_networks_custom: []</span><span class="diff-line del">-diun_docker_networks: &quot;{{ docker_networks_common</span><span class="diff-line del">-                          + diun_docker_networks_default</span><span class="diff-line del">-                          + diun_docker_networks_custom }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Capabilities</span><span class="diff-line del">-diun_docker_capabilities_default: []</span><span class="diff-line del">-diun_docker_capabilities_custom: []</span><span class="diff-line del">-diun_docker_capabilities: &quot;{{ diun_docker_capabilities_default</span><span class="diff-line del">-                              + diun_docker_capabilities_custom }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Security Opts</span><span class="diff-line del">-diun_docker_security_opts_default: []</span><span class="diff-line del">-diun_docker_security_opts_custom: []</span><span class="diff-line del">-diun_docker_security_opts: &quot;{{ diun_docker_security_opts_default</span><span class="diff-line del">-                               + diun_docker_security_opts_custom }}&quot;</span><span class="diff-line add">+diun_role_docker_networks_alias: &quot;{{ diun_name }}&quot;</span><span class="diff-line add">+diun_role_docker_networks_default: []</span><span class="diff-line add">+diun_role_docker_networks_custom: []</span><span class="diff-line add">+diun_role_docker_networks: &quot;{{ docker_networks_common</span><span class="diff-line add">+                               + lookup(&#x27;role_var&#x27;, &#x27;_docker_networks_default&#x27;, role=&#x27;diun&#x27;)</span><span class="diff-line add">+                               + lookup(&#x27;role_var&#x27;, &#x27;_docker_networks_custom&#x27;, role=&#x27;diun&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Restart Policy</span><span class="diff-line del">-diun_docker_restart_policy: unless-stopped</span><span class="diff-line add">+diun_role_docker_restart_policy: unless-stopped</span><span class="diff-line context"> </span><span class="diff-line context"> # State</span><span class="diff-line del">-diun_docker_state: started</span><span class="diff-line add">+diun_role_docker_state: started</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-166">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/diun/tasks/main.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -16,7 +16,7 @@</span><span class="diff-line context"> - name: Import default config</span><span class="diff-line context">   ansible.builtin.copy:</span><span class="diff-line context">     src: &quot;diun.yml&quot;</span><span class="diff-line del">-    dest: &quot;{{ diun_paths_location }}/diun.yml&quot;</span><span class="diff-line add">+    dest: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_location&#x27;, role=&#x27;diun&#x27;) }}/diun.yml&quot;</span><span class="diff-line context">     owner: &quot;{{ user.name }}&quot;</span><span class="diff-line context">     group: &quot;{{ user.name }}&quot;</span><span class="diff-line context">     mode: &quot;0664&quot;</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-167">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/docker/defaults/main.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -22,9 +22,19 @@</span><span class="diff-line context"> # docker_config_custom:</span><span class="diff-line context"> #   debug: &quot;true&quot;</span><span class="diff-line context"> docker_config_custom: {}</span><span class="diff-line add">+</span><span class="diff-line add">+# CPU and Memory defaults</span><span class="diff-line add">+docker_cpus_default: &quot;&quot;</span><span class="diff-line add">+docker_memory_default: &quot;&quot;</span><span class="diff-line add">+</span><span class="diff-line context"> # Skip Container startup during core, saltbox, mediabox or feederbox</span><span class="diff-line context"> # If the kernel has been updated and a reboot will happen</span><span class="diff-line context"> docker_skip_start_during_meta_tag: &quot;{{ saltbox_auto_reboot }}&quot;</span><span class="diff-line add">+</span><span class="diff-line add">+# Toggles pruning of dangling images after container creation.</span><span class="diff-line add">+docker_create_image_prune: true</span><span class="diff-line add">+docker_create_image_prune_delay: true</span><span class="diff-line add">+docker_create_image_prune_delay_timeout: 10</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # Lookup</span><span class="diff-line hunk">@@ -37,7 +47,6 @@</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line context"> docker_apt_key_id: 0EBFCD88</span><span class="diff-line del">-</span><span class="diff-line context"> docker_apt_key_url: https://download.docker.com/linux/ubuntu/gpg</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line hunk">@@ -45,9 +54,7 @@</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line context"> docker_apt_repo_version: stable</span><span class="diff-line del">-</span><span class="diff-line del">-docker_apt_repo_url: &quot;deb [arch=amd64 signed-by=/etc/apt/keyrings/docker.asc] https://download.docker.com/linux/{{ ansible_distribution | lower }} {{ ansible_distribution_release }} {{ docker_apt_repo_version }}&quot;  # noqa line-length</span><span class="diff-line del">-</span><span class="diff-line add">+docker_apt_repo_url: &quot;deb [arch=amd64 signed-by=/etc/apt/keyrings/docker.asc] https://download.docker.com/linux/{{ ansible_facts[&#x27;distribution&#x27;] | lower }} {{ ansible_facts[&#x27;distribution_release&#x27;] | lower }} {{ docker_apt_repo_version }}&quot;  # noqa line-length</span><span class="diff-line context"> docker_apt_repo_filename: docker</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line hunk">@@ -62,79 +69,51 @@</span><span class="diff-line context"> docker_version: &quot;28&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Docker CE</span><span class="diff-line del">-</span><span class="diff-line context"> docker_ce_name: &quot;Docker CE&quot;</span><span class="diff-line del">-docker_ce_package: &quot;docker-ce={{ docker_ce_resolved_version | default(&#x27;&#x27;) }}&quot;</span><span class="diff-line add">+docker_ce_package: &quot;docker-ce={{ docker_ce_resolved_version }}&quot;</span><span class="diff-line context"> docker_ce_filepath: &quot;/usr/bin/dockerd&quot;</span><span class="diff-line del">-</span><span class="diff-line context"> docker_ce_dpkg: &quot;docker-ce&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Docker CE CLI</span><span class="diff-line del">-</span><span class="diff-line context"> docker_ce_cli_name: &quot;Docker CE CLI&quot;</span><span class="diff-line del">-docker_ce_cli_package: &quot;docker-ce-cli={{ docker_ce_cli_resolved_version | default(&#x27;&#x27;) }}&quot;</span><span class="diff-line add">+docker_ce_cli_package: &quot;docker-ce-cli={{ docker_ce_cli_resolved_version }}&quot;</span><span class="diff-line context"> docker_ce_cli_filepath: &quot;/usr/bin/docker&quot;</span><span class="diff-line del">-</span><span class="diff-line context"> docker_ce_cli_dpkg: &quot;docker-ce-cli&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Containerd</span><span class="diff-line del">-</span><span class="diff-line context"> containerd_io_name: &quot;Containerd&quot;</span><span class="diff-line del">-</span><span class="diff-line context"> containerd_io_package: &quot;containerd.io&quot;</span><span class="diff-line del">-</span><span class="diff-line context"> containerd_io_filepath: &quot;/usr/bin/containerd&quot;</span><span class="diff-line del">-</span><span class="diff-line context"> containerd_io_dpkg: &quot;containerd.io&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Docker Compose</span><span class="diff-line del">-</span><span class="diff-line context"> compose_cli_name: &quot;Docker Compose&quot;</span><span class="diff-line del">-</span><span class="diff-line context"> compose_cli_package: &quot;docker-compose-plugin&quot;</span><span class="diff-line del">-</span><span class="diff-line context"> compose_cli_filepath: &quot;docker compose&quot;</span><span class="diff-line del">-</span><span class="diff-line context"> compose_cli_dpkg: &quot;docker-compose-plugin&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Docker Rootless Extras</span><span class="diff-line del">-</span><span class="diff-line context"> docker_rootless_name: &quot;Docker Rootless Extras&quot;</span><span class="diff-line del">-</span><span class="diff-line context"> docker_rootless_package: &quot;docker-ce-rootless-extras&quot;</span><span class="diff-line del">-</span><span class="diff-line context"> docker_rootless_filepath: &quot;/usr/bin/rootlesskit&quot;</span><span class="diff-line del">-</span><span class="diff-line context"> docker_rootless_dpkg: &quot;docker-ce-rootless-extras&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Misc</span><span class="diff-line del">-docker_package_state: &quot;present&quot;</span><span class="diff-line context"> put_docker_dpkg_into_hold: true</span><span class="diff-line del">-</span><span class="diff-line context"> docker_filesystem_path: &quot;/media/docker-volume.img&quot;</span><span class="diff-line del">-</span><span class="diff-line context"> docker_filesystem_size: &quot;20G&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-docker_ipv6: &quot;{{ dns.ipv6 | bool }}&quot;</span><span class="diff-line add">+docker_ipv6: &quot;{{ dns_ipv6_enabled }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Service</span><span class="diff-line del">-</span><span class="diff-line context"> docker_service_after: &quot;{{ mergerfs_service_name }}&quot;</span><span class="diff-line del">-</span><span class="diff-line context"> docker_service_sleep: &quot;{{ 0</span><span class="diff-line context">                        if continuous_integration or (not use_remote)</span><span class="diff-line context">                        else 120 }}&quot;</span><span class="diff-line del">-</span><span class="diff-line context"> docker_service_force: true</span><span class="diff-line del">-</span><span class="diff-line context"> docker_service_check: &quot;{{ docker_binary.stat.exists and (docker_service_running or ((remote_docker_service_running is defined) and remote_docker_service_running) or ((unionfs_docker_service_running is defined) and unionfs_docker_service_running)) }}&quot;</span><span class="diff-line del">-</span><span class="diff-line context"> docker_service_check_mounts: &quot;{{ docker_binary.stat.exists and (((remote_docker_service_running is defined) and remote_docker_service_running) or ((unionfs_docker_service_running is defined) and unionfs_docker_service_running)) }}&quot;</span><span class="diff-line del">-</span><span class="diff-line context"> docker_update_hosts_service_runtime_max: &quot;3600s&quot;</span><span class="diff-line del">-</span><span class="diff-line context"> docker_daemon_storage_driver: &quot;{{ (&#x27;zfs&#x27; in var_lib_file_system.stdout) | ternary(&#x27;zfs&#x27;, &#x27;overlay2&#x27;) }}&quot;</span><span class="diff-line del">-</span><span class="diff-line context"> docker_daemon_template_force: true</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line hunk">@@ -147,11 +126,40 @@</span><span class="diff-line context"> # Docker Controller</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-docker_controller_python_version: &quot;3.10&quot;</span><span class="diff-line add">+docker_controller_binary_path: &quot;/usr/local/bin/sdc&quot;</span><span class="diff-line add">+</span><span class="diff-line add">+docker_controller_releases_url: &quot;{{ svm }}https://api.github.com/repos/saltyorg/sdc/releases/latest&quot;</span><span class="diff-line add">+</span><span class="diff-line add">+docker_controller_releases_download_url: https://github.com/saltyorg/sdc/releases/download</span><span class="diff-line add">+</span><span class="diff-line add">+docker_controller_release_lookup_command: |</span><span class="diff-line add">+  curl -s {{ docker_controller_releases_url }} \</span><span class="diff-line add">+    | jq -r &quot;.assets[] | select(.name == \&quot;sdc_linux_amd64\&quot;) \</span><span class="diff-line add">+    | .browser_download_url&quot;</span><span class="diff-line add">+</span><span class="diff-line add">+# Legacy</span><span class="diff-line context"> docker_controller_venv_path: &quot;/srv/docker-controller/venv&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # Docker DNS</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-docker_dns_python_version: &quot;3.10&quot;</span><span class="diff-line add">+docker_dns_binary_path: &quot;/usr/local/bin/sdhm&quot;</span><span class="diff-line add">+</span><span class="diff-line add">+docker_dns_releases_url: &quot;{{ svm }}https://api.github.com/repos/saltyorg/sdhm/releases/latest&quot;</span><span class="diff-line add">+</span><span class="diff-line add">+docker_dns_releases_download_url: https://github.com/saltyorg/sdhm/releases/download</span><span class="diff-line add">+</span><span class="diff-line add">+docker_dns_release_lookup_command: |</span><span class="diff-line add">+  curl -s {{ docker_dns_releases_url }} \</span><span class="diff-line add">+    | jq -r &quot;.assets[] | select(.name == \&quot;sdhm_linux_amd64\&quot;) \</span><span class="diff-line add">+    | .browser_download_url&quot;</span><span class="diff-line add">+</span><span class="diff-line add">+docker_dns_ports_8090: &quot;{{ port_lookup_8090.meta.port</span><span class="diff-line add">+                        if (port_lookup_8090.meta.port is defined) and (port_lookup_8090.meta.port | trim | length &gt; 0)</span><span class="diff-line add">+                        else &#x27;8090&#x27; }}&quot;</span><span class="diff-line add">+</span><span class="diff-line add">+docker_dns_networks:</span><span class="diff-line add">+  - &quot;saltbox&quot;</span><span class="diff-line add">+</span><span class="diff-line add">+docker_dns_periodic_validation: &quot;5m&quot;</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-168">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/docker/tasks/main.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -30,8 +30,8 @@</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Get Docker service state</span><span class="diff-line context">   ansible.builtin.set_fact:</span><span class="diff-line del">-    docker_service_running: &quot;{{ (services[&#x27;docker.service&#x27;] is defined) and (services[&#x27;docker.service&#x27;][&#x27;state&#x27;] == &#x27;running&#x27;) }}&quot;</span><span class="diff-line del">-    docker_controller_service_running: &quot;{{ (services[&#x27;saltbox_managed_docker_controller.service&#x27;] is defined) and (services[&#x27;saltbox_managed_docker_controller.service&#x27;][&#x27;state&#x27;] == &#x27;running&#x27;) }}&quot;</span><span class="diff-line add">+    docker_service_running: &quot;{{ (ansible_facts[&#x27;services&#x27;][&#x27;docker.service&#x27;] is defined) and (ansible_facts[&#x27;services&#x27;][&#x27;docker.service&#x27;][&#x27;state&#x27;] == &#x27;running&#x27;) }}&quot;</span><span class="diff-line add">+    docker_controller_service_running: &quot;{{ (ansible_facts[&#x27;services&#x27;][&#x27;saltbox_managed_docker_controller.service&#x27;] is defined) and (ansible_facts[&#x27;services&#x27;][&#x27;saltbox_managed_docker_controller.service&#x27;][&#x27;state&#x27;] == &#x27;running&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Tasks for when Docker exists and is running</span><span class="diff-line context">   when: docker_service_check</span><span class="diff-line hunk">@@ -90,10 +90,10 @@</span><span class="diff-line context"> </span><span class="diff-line context">   rescue:</span><span class="diff-line context">     - name: Install missing modules package</span><span class="diff-line del">-      ansible.builtin.shell: &quot;apt-get install --reinstall linux-modules-{{ ansible_kernel }}&quot;</span><span class="diff-line add">+      ansible.builtin.shell: &quot;apt-get install --reinstall linux-modules-{{ ansible_facts[&#x27;kernel&#x27;] }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: &quot;Import Daemon Tasks&quot;</span><span class="diff-line del">-  ansible.builtin.import_tasks: &quot;subtasks/daemon.yml&quot;</span><span class="diff-line add">+  ansible.builtin.include_tasks: &quot;subtasks/daemon.yml&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: &quot;Import Docker Binary tasks&quot;</span><span class="diff-line context">   ansible.builtin.include_tasks: &quot;subtasks/binary/binary.yml&quot;</span><span class="diff-line hunk">@@ -103,7 +103,7 @@</span><span class="diff-line context">   when: (&#x27;btrfs&#x27; in var_lib_file_system.stdout)</span><span class="diff-line context"> </span><span class="diff-line context"> - name: &quot;Import Nvidia tasks&quot;</span><span class="diff-line del">-  ansible.builtin.import_tasks: &quot;subtasks/nvidia.yml&quot;</span><span class="diff-line add">+  ansible.builtin.include_tasks: &quot;subtasks/nvidia.yml&quot;</span><span class="diff-line context">   when: use_nvidia</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Block Docker Controller</span><span class="diff-line hunk">@@ -132,7 +132,7 @@</span><span class="diff-line context">     timeout: &quot;60&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: &quot;Import Controller tasks&quot;</span><span class="diff-line del">-  ansible.builtin.import_tasks: &quot;subtasks/controller.yml&quot;</span><span class="diff-line add">+  ansible.builtin.include_tasks: &quot;subtasks/controller.yml&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Gather list of running Docker containers (before Network Tasks)</span><span class="diff-line context">   ansible.builtin.shell: &quot;docker ps --format &#x27;{{ &#x27;{{&#x27; }} .Names{{ &#x27;}}&#x27; }}&#x27; | sort | xargs echo -n&quot;</span><span class="diff-line hunk">@@ -149,10 +149,10 @@</span><span class="diff-line context">   when: (docker_running_containers_before_network_tasks_ps.stdout | trim | length &gt; 0)</span><span class="diff-line context"> </span><span class="diff-line context"> - name: &quot;Import Docker Network tasks&quot;</span><span class="diff-line del">-  ansible.builtin.import_tasks: &quot;subtasks/network.yml&quot;</span><span class="diff-line add">+  ansible.builtin.include_tasks: &quot;subtasks/network.yml&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: &quot;Import Docker Housekeeping tasks&quot;</span><span class="diff-line del">-  ansible.builtin.import_tasks: &quot;subtasks/housekeeping.yml&quot;</span><span class="diff-line add">+  ansible.builtin.include_tasks: &quot;subtasks/housekeeping.yml&quot;</span><span class="diff-line context">   tags: docker-housekeeping</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Check if system needs to reboot</span><span class="diff-line hunk">@@ -195,15 +195,15 @@</span><span class="diff-line context">       ignore_errors: true</span><span class="diff-line context"> </span><span class="diff-line context"> - name: &quot;Import Docker Hub tasks&quot;</span><span class="diff-line del">-  ansible.builtin.import_tasks: &quot;subtasks/dockerhub.yml&quot;</span><span class="diff-line add">+  ansible.builtin.include_tasks: &quot;subtasks/dockerhub.yml&quot;</span><span class="diff-line context">   tags: dockerhub</span><span class="diff-line context">   when: dockerhub_is_enabled</span><span class="diff-line context"> </span><span class="diff-line context"> - name: &quot;Import DNS tasks&quot;</span><span class="diff-line del">-  ansible.builtin.import_tasks: &quot;subtasks/dns.yml&quot;</span><span class="diff-line add">+  ansible.builtin.include_tasks: &quot;subtasks/dns.yml&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: &quot;Import Compose tasks&quot;</span><span class="diff-line del">-  ansible.builtin.import_tasks: &quot;subtasks/compose.yml&quot;</span><span class="diff-line add">+  ansible.builtin.include_tasks: &quot;subtasks/compose.yml&quot;</span><span class="diff-line context">   tags: docker-compose</span><span class="diff-line context"> </span><span class="diff-line context"> - name: &quot;Install ctop&quot;</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-169">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/docker/tasks/subtasks/binary/binary.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -10,7 +10,7 @@</span><span class="diff-line context"> - name: Binary | Identify apt source files</span><span class="diff-line context">   ansible.builtin.find:</span><span class="diff-line context">     paths: /etc/apt/sources.list.d/</span><span class="diff-line del">-    recurse: no</span><span class="diff-line add">+    recurse: false</span><span class="diff-line context">   register: apt_source_files</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Binary | Check if file contains &#x27;download.docker.com&#x27;</span><span class="diff-line hunk">@@ -28,7 +28,7 @@</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Binary | Update APT package index</span><span class="diff-line context">   ansible.builtin.apt:</span><span class="diff-line del">-    update_cache: yes</span><span class="diff-line add">+    update_cache: true</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Binary | Ensure &#x27;/etc/apt/keyrings&#x27; exists</span><span class="diff-line context">   ansible.builtin.file:</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-170">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/docker/tasks/subtasks/binary/binary2.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -7,32 +7,32 @@</span><span class="diff-line context"> #                   GNU General Public License v3.0                     #</span><span class="diff-line context"> #########################################################################</span><span class="diff-line context"> ---</span><span class="diff-line del">-- name: Binary | Release &#x27;{{ vars[item ~ &#x27;_dpkg&#x27;] }}&#x27; from hold</span><span class="diff-line add">+- name: Binary | Release &#x27;{{ lookup(&#x27;vars&#x27;, item ~ &#x27;_dpkg&#x27;) }}&#x27; from hold</span><span class="diff-line context">   ansible.builtin.dpkg_selections:</span><span class="diff-line del">-    name: &quot;{{ vars[item ~ &#x27;_dpkg&#x27;] }}&quot;</span><span class="diff-line add">+    name: &quot;{{ lookup(&#x27;vars&#x27;, item ~ &#x27;_dpkg&#x27;) }}&quot;</span><span class="diff-line context">     selection: install</span><span class="diff-line del">-  when: (vars[item ~ &#x27;_dpkg&#x27;] in ansible_facts.packages)</span><span class="diff-line add">+  when: (lookup(&#x27;vars&#x27;, item ~ &#x27;_dpkg&#x27;) in ansible_facts[&#x27;packages&#x27;])</span><span class="diff-line context"> </span><span class="diff-line del">-- name: Binary | Install &#x27;{{ lookup(&#x27;vars&#x27;, item + &#x27;_package&#x27;) }}&#x27; # noqa args[module]</span><span class="diff-line add">+- name: Binary | Install &#x27;{{ lookup(&#x27;vars&#x27;, item + &#x27;_package&#x27;) }}&#x27;</span><span class="diff-line context">   ansible.builtin.apt:</span><span class="diff-line context">     name: &quot;{{ lookup(&#x27;vars&#x27;, item + &#x27;_package&#x27;) }}&quot;</span><span class="diff-line del">-    state: &quot;{{ docker_package_state if (item == &#x27;docker_ce&#x27; or item == &#x27;docker_ce_cli&#x27;) else &#x27;latest&#x27; }}&quot;</span><span class="diff-line add">+    state: &quot;{{ &#x27;present&#x27; if (item == &#x27;docker_ce&#x27; or item == &#x27;docker_ce_cli&#x27;) else &#x27;latest&#x27; }}&quot;</span><span class="diff-line context">     update_cache: true</span><span class="diff-line context">     allow_downgrade: true</span><span class="diff-line context"> </span><span class="diff-line del">-- name: Binary | Put &#x27;{{ vars[item ~ &#x27;_dpkg&#x27;] }}&#x27; into hold</span><span class="diff-line add">+- name: Binary | Put &#x27;{{ lookup(&#x27;vars&#x27;, item ~ &#x27;_dpkg&#x27;) }}&#x27; into hold</span><span class="diff-line context">   ansible.builtin.dpkg_selections:</span><span class="diff-line del">-    name: &quot;{{ vars[item ~ &#x27;_dpkg&#x27;] }}&quot;</span><span class="diff-line add">+    name: &quot;{{ lookup(&#x27;vars&#x27;, item ~ &#x27;_dpkg&#x27;) }}&quot;</span><span class="diff-line context">     selection: hold</span><span class="diff-line context">   when: put_docker_dpkg_into_hold</span><span class="diff-line context"> </span><span class="diff-line del">-- name: Binary | Get &#x27;{{ vars[item ~ &#x27;_name&#x27;] }}&#x27; version</span><span class="diff-line del">-  ansible.builtin.shell: &quot;{{ vars[item ~ &#x27;_filepath&#x27;] }} &#x27;{{ &#x27;version&#x27; if item == &#x27;compose_cli&#x27; else &#x27;--version&#x27; }}&#x27; | head -n 1 | awk &#x27;{ print {{ &#x27;$4&#x27; if item == &#x27;compose_cli&#x27; else &#x27;$3&#x27; }} }&#x27; | sed &#x27;s/,$//&#x27; | sed &#x27;s/v//&#x27;&quot;</span><span class="diff-line add">+- name: Binary | Get &#x27;{{ lookup(&#x27;vars&#x27;, item ~ &#x27;_name&#x27;) }}&#x27; version</span><span class="diff-line add">+  ansible.builtin.shell: &quot;{{ lookup(&#x27;vars&#x27;, item ~ &#x27;_filepath&#x27;) }} &#x27;{{ &#x27;version&#x27; if item == &#x27;compose_cli&#x27; else &#x27;--version&#x27; }}&#x27; | head -n 1 | awk &#x27;{ print {{ &#x27;$4&#x27; if item == &#x27;compose_cli&#x27; else &#x27;$3&#x27; }} }&#x27; | sed &#x27;s/,$//&#x27; | sed &#x27;s/v//&#x27;&quot;</span><span class="diff-line context">   register: binary_version</span><span class="diff-line context">   ignore_errors: true</span><span class="diff-line context">   changed_when: false</span><span class="diff-line context"> </span><span class="diff-line del">-- name: Binary | Display &#x27;{{ vars[item ~ &#x27;_name&#x27;] }}&#x27; version</span><span class="diff-line add">+- name: Binary | Display &#x27;{{ lookup(&#x27;vars&#x27;, item ~ &#x27;_name&#x27;) }}&#x27; version</span><span class="diff-line context">   ansible.builtin.debug:</span><span class="diff-line del">-    msg: &quot;{{ vars[item ~ &#x27;_name&#x27;] }} version {{ binary_version.stdout }} installed.&quot;</span><span class="diff-line add">+    msg: &quot;{{ lookup(&#x27;vars&#x27;, item ~ &#x27;_name&#x27;) }} version {{ binary_version.stdout }} installed.&quot;</span><span class="diff-line context">   when: binary_version is defined</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-171">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/docker/tasks/subtasks/btrfs/pseudo_file_system.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -11,7 +11,7 @@</span><span class="diff-line context"> </span><span class="diff-line context"> - name: &quot;BTRFS | Psuedo-File-System | Determine if &#x27;/var/lib/docker&#x27; is mounted&quot;</span><span class="diff-line context">   ansible.builtin.set_fact:</span><span class="diff-line del">-    var_lib_docker_mount_exists: &quot;{{ true if (ansible_mounts | json_query(&#x27;[?mount == `/var/lib/docker`]&#x27;)) else false }}&quot;</span><span class="diff-line add">+    var_lib_docker_mount_exists: &quot;{{ true if (ansible_facts[&#x27;mounts&#x27;] | json_query(&#x27;[?mount == `/var/lib/docker`]&#x27;)) else false }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: BTRFS | Psuedo-File-System | Tasks when &#x27;/var/lib/docker&#x27; is not mounted</span><span class="diff-line context">   when: (not var_lib_docker_mount_exists)</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-172">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/docker/tasks/subtasks/controller.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -7,55 +7,39 @@</span><span class="diff-line context"> #                   GNU General Public License v3.0                     #</span><span class="diff-line context"> #########################################################################</span><span class="diff-line context"> ---</span><span class="diff-line del">-- name: Controller | Execute Python role</span><span class="diff-line del">-  ansible.builtin.include_role:</span><span class="diff-line del">-    name: &quot;python&quot;</span><span class="diff-line del">-  vars:</span><span class="diff-line del">-    python_version: &quot;{{ docker_controller_python_version }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-- name: &quot;Controller | Lookup Python {{ docker_controller_python_version }} installation&quot;</span><span class="diff-line del">-  ansible.builtin.command: &quot;{{ python_bin }} python find {{ docker_controller_python_version }} --managed-python&quot;</span><span class="diff-line del">-  register: docker_controller_python_install_path_lookup</span><span class="diff-line del">-  changed_when: false</span><span class="diff-line del">-  environment: &quot;{{ python_environment }}&quot;</span><span class="diff-line del">-  become: true</span><span class="diff-line del">-  become_user: &quot;{{ user.name }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-- name: Controller | Set Python version</span><span class="diff-line del">-  ansible.builtin.set_fact:</span><span class="diff-line del">-    docker_controller_python_install_path: &quot;{{ docker_controller_python_install_path_lookup.stdout }}&quot;</span><span class="diff-line del">-</span><span class="diff-line context"> - name: Controller | Delete venv folder</span><span class="diff-line context">   ansible.builtin.file:</span><span class="diff-line context">     path: &quot;{{ docker_controller_venv_path }}&quot;</span><span class="diff-line context">     state: absent</span><span class="diff-line context"> </span><span class="diff-line del">-- name: Controller | Create venv</span><span class="diff-line del">-  ansible.builtin.command:</span><span class="diff-line del">-    cmd: &quot;{{ docker_controller_python_install_path }} -m venv {{ docker_controller_venv_path }}&quot;</span><span class="diff-line add">+- name: Controller | Get URL for latest sdc release</span><span class="diff-line add">+  ansible.builtin.shell: &quot;{{ docker_controller_release_lookup_command }}&quot;</span><span class="diff-line context">   args:</span><span class="diff-line del">-    creates: &quot;{{ docker_controller_venv_path }}&quot;</span><span class="diff-line del">-  become: true</span><span class="diff-line del">-  become_user: &quot;{{ user.name }}&quot;</span><span class="diff-line add">+    executable: /bin/bash</span><span class="diff-line add">+  register: docker_controller_download_url</span><span class="diff-line context"> </span><span class="diff-line del">-- name: Controller | Install pip requirements</span><span class="diff-line del">-  ansible.builtin.pip:</span><span class="diff-line del">-    requirements: &quot;/srv/git/saltbox/requirements/requirements-docker-controller.txt&quot;</span><span class="diff-line del">-    virtualenv: &quot;{{ docker_controller_venv_path }}&quot;</span><span class="diff-line del">-    virtualenv_command: &quot;{{ docker_controller_venv_path }}/bin/python3 -m pip&quot;</span><span class="diff-line del">-  become: true</span><span class="diff-line del">-  become_user: &quot;{{ user.name }}&quot;</span><span class="diff-line add">+- name: Controller | Download sdc</span><span class="diff-line add">+  ansible.builtin.get_url:</span><span class="diff-line add">+    url: &quot;{{ docker_controller_download_url.stdout }}&quot;</span><span class="diff-line add">+    dest: &quot;{{ docker_controller_binary_path }}&quot;</span><span class="diff-line add">+    owner: &quot;root&quot;</span><span class="diff-line add">+    group: &quot;root&quot;</span><span class="diff-line add">+    mode: &quot;0755&quot;</span><span class="diff-line add">+  register: x</span><span class="diff-line add">+  until: &quot;x is not failed&quot;</span><span class="diff-line add">+  retries: &quot;{{ ansible_retry_count</span><span class="diff-line add">+            if (not continuous_integration)</span><span class="diff-line add">+            else ansible_retry_count_ci }}&quot;</span><span class="diff-line add">+  delay: 10</span><span class="diff-line context"> </span><span class="diff-line del">-- name: Controller | Find pip3 path</span><span class="diff-line del">-  ansible.builtin.find:</span><span class="diff-line del">-    paths: &quot;/srv/docker-controller/venv&quot;</span><span class="diff-line del">-    recurse: yes</span><span class="diff-line del">-    patterns: &#x27;uvicorn&#x27;</span><span class="diff-line del">-  register: docker_controller_venv_files</span><span class="diff-line add">+- name: Controller | Get sdc binary version</span><span class="diff-line add">+  ansible.builtin.shell: &quot;{{ docker_controller_binary_path }} --version | awk &#x27;{ print $3 }&#x27;&quot;</span><span class="diff-line add">+  register: sdc_binary_version</span><span class="diff-line add">+  changed_when: false</span><span class="diff-line context"> </span><span class="diff-line del">-- name: Controller | Path</span><span class="diff-line del">-  ansible.builtin.set_fact:</span><span class="diff-line del">-    docker_controller_uvicorn_path: &quot;{{ docker_controller_venv_files.files[0].path }}&quot;</span><span class="diff-line add">+- name: Controller | Display sdc binary version</span><span class="diff-line add">+  ansible.builtin.debug:</span><span class="diff-line add">+    msg: &quot;sdc {{ sdc_binary_version.stdout }} installed.&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Controller | Import &#x27;saltbox_managed_docker_controller.service&#x27;</span><span class="diff-line context">   ansible.builtin.template:</span><span class="diff-line hunk">@@ -75,7 +59,7 @@</span><span class="diff-line context">   ansible.builtin.uri:</span><span class="diff-line context">     url: &quot;{{ docker_controller_url }}/ping&quot;</span><span class="diff-line context">     method: GET</span><span class="diff-line del">-    return_content: yes</span><span class="diff-line add">+    return_content: true</span><span class="diff-line context">     status_code: 200</span><span class="diff-line context">   register: result</span><span class="diff-line context">   retries: 120</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-173">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/docker/tasks/subtasks/dns.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -12,36 +12,48 @@</span><span class="diff-line context">     name: docker-update-hosts</span><span class="diff-line context">     state: stopped</span><span class="diff-line context">     enabled: false</span><span class="diff-line del">-  when: (services[&#x27;docker-update-hosts.service&#x27;] is defined)</span><span class="diff-line add">+  when: (ansible_facts[&#x27;services&#x27;][&#x27;docker-update-hosts.service&#x27;] is defined)</span><span class="diff-line context"> </span><span class="diff-line context"> - name: &quot;DNS | Remove docker-update-hosts.service&quot;</span><span class="diff-line context">   ansible.builtin.file:</span><span class="diff-line context">     path: /etc/systemd/system/docker-update-hosts.service</span><span class="diff-line context">     state: absent</span><span class="diff-line context"> </span><span class="diff-line del">-- name: &quot;DNS | Delete &#x27;docker-update-hosts&#x27;&quot;</span><span class="diff-line del">-  ansible.builtin.file:</span><span class="diff-line del">-    path: &quot;/usr/local/bin/docker-update-hosts&quot;</span><span class="diff-line del">-    state: absent</span><span class="diff-line add">+- name: &quot;DNS | Get URL for latest sdhm release&quot;</span><span class="diff-line add">+  ansible.builtin.shell: &quot;{{ docker_dns_release_lookup_command }}&quot;</span><span class="diff-line add">+  args:</span><span class="diff-line add">+    executable: /bin/bash</span><span class="diff-line add">+  register: docker_dns_download_url</span><span class="diff-line context"> </span><span class="diff-line del">-- name: &quot;DNS | Execute Python role&quot;</span><span class="diff-line del">-  ansible.builtin.include_role:</span><span class="diff-line del">-    name: &quot;python&quot;</span><span class="diff-line del">-  vars:</span><span class="diff-line del">-    python_version: &quot;{{ docker_dns_python_version }}&quot;</span><span class="diff-line del">-  when: (docker_dns_python_version != docker_controller_python_version)</span><span class="diff-line add">+- name: &quot;DNS | Download sdhm&quot;</span><span class="diff-line add">+  ansible.builtin.get_url:</span><span class="diff-line add">+    url: &quot;{{ docker_dns_download_url.stdout }}&quot;</span><span class="diff-line add">+    dest: &quot;{{ docker_dns_binary_path }}&quot;</span><span class="diff-line add">+    owner: &quot;root&quot;</span><span class="diff-line add">+    group: &quot;root&quot;</span><span class="diff-line add">+    mode: &quot;0755&quot;</span><span class="diff-line add">+  register: x</span><span class="diff-line add">+  until: &quot;x is not failed&quot;</span><span class="diff-line add">+  retries: &quot;{{ ansible_retry_count</span><span class="diff-line add">+            if (not continuous_integration)</span><span class="diff-line add">+            else ansible_retry_count_ci }}&quot;</span><span class="diff-line add">+  delay: 10</span><span class="diff-line context"> </span><span class="diff-line del">-- name: &quot;DNS | Lookup Python {{ docker_dns_python_version }} installation&quot;</span><span class="diff-line del">-  ansible.builtin.command: &quot;{{ python_bin }} python find {{ docker_dns_python_version }} --managed-python&quot;</span><span class="diff-line del">-  register: docker_dns_python_install_path_lookup</span><span class="diff-line add">+- name: &quot;DNS | Get sdhm binary version&quot;</span><span class="diff-line add">+  ansible.builtin.shell: &quot;{{ docker_dns_binary_path }} --version | awk &#x27;{ print $3 }&#x27;&quot;</span><span class="diff-line add">+  register: sdhm_binary_version</span><span class="diff-line context">   changed_when: false</span><span class="diff-line del">-  environment: &quot;{{ python_environment }}&quot;</span><span class="diff-line del">-  become: true</span><span class="diff-line del">-  become_user: &quot;{{ user.name }}&quot;</span><span class="diff-line context"> </span><span class="diff-line del">-- name: &quot;DNS | Set Python version&quot;</span><span class="diff-line del">-  ansible.builtin.set_fact:</span><span class="diff-line del">-    docker_dns_python_install_path: &quot;{{ docker_dns_python_install_path_lookup.stdout }}&quot;</span><span class="diff-line add">+- name: &quot;DNS | Display sdhm binary version&quot;</span><span class="diff-line add">+  ansible.builtin.debug:</span><span class="diff-line add">+    msg: &quot;sdhm {{ sdhm_binary_version.stdout }} installed.&quot;</span><span class="diff-line add">+</span><span class="diff-line add">+- name: &quot;DNS | Get next available port within the range of &#x27;8090-8180&#x27;&quot;</span><span class="diff-line add">+  find_open_port:</span><span class="diff-line add">+    low_bound: &quot;8090&quot;</span><span class="diff-line add">+    high_bound: &quot;8180&quot;</span><span class="diff-line add">+    protocol: both</span><span class="diff-line add">+  register: port_lookup_8090</span><span class="diff-line context"> </span><span class="diff-line context"> - name: &quot;DNS | Import &#x27;saltbox_managed_docker_update_hosts.service&#x27;&quot;</span><span class="diff-line context">   ansible.builtin.template:</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-174">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/docker/templates/docker-controller-helper.service.j2</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -15,7 +15,7 @@</span><span class="diff-line context"> After=docker.service saltbox_managed_docker_controller.service</span><span class="diff-line context"> </span><span class="diff-line context"> [Service]</span><span class="diff-line del">-ExecStart=/srv/ansible/venv/bin/python3 /srv/git/saltbox/scripts/saltbox_docker_controller_helper.py</span><span class="diff-line add">+ExecStart={{ docker_controller_binary_path }} helper --controller-url &quot;http://127.0.0.1:3377&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> [Install]</span><span class="diff-line context"> WantedBy=multi-user.target</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-175">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/docker/templates/docker-controller.service.j2</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -14,8 +14,7 @@</span><span class="diff-line context"> </span><span class="diff-line context"> [Service]</span><span class="diff-line context"> Type=simple</span><span class="diff-line del">-WorkingDirectory=/srv/git/saltbox/scripts</span><span class="diff-line del">-ExecStart={{ docker_controller_uvicorn_path }} saltbox_docker_controller:app --host 127.0.0.1 --port 3377</span><span class="diff-line add">+ExecStart={{ docker_controller_binary_path }} server --host 127.0.0.1 --port 3377</span><span class="diff-line context"> Restart=on-failure</span><span class="diff-line context"> RestartSec=5s</span><span class="diff-line context"> </span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-176">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/docker/templates/docker-update-hosts.service.j2</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -9,12 +9,15 @@</span><span class="diff-line context"> #########################################################################</span><span class="diff-line context"> </span><span class="diff-line context"> [Unit]</span><span class="diff-line del">-Description=Saltbox Docker Hosts DNS Resolution Helper</span><span class="diff-line del">-BindsTo=docker.service</span><span class="diff-line add">+Description=Saltbox Docker Hosts Manager</span><span class="diff-line context"> After=docker.service</span><span class="diff-line add">+Requires=docker.service</span><span class="diff-line context"> </span><span class="diff-line context"> [Service]</span><span class="diff-line del">-ExecStart={{ docker_dns_python_install_path }} /srv/git/saltbox/roles/docker/files/docker-update-hosts.py {{ docker_update_hosts_service_runtime_max }}</span><span class="diff-line add">+Type=simple</span><span class="diff-line add">+ExecStart={{ docker_dns_binary_path }} --networks {{ docker_dns_networks | join(&#x27;,&#x27;) }} --interval {{ docker_dns_periodic_validation }} --health-port {{ docker_dns_ports_8090 }}</span><span class="diff-line add">+Restart=always</span><span class="diff-line add">+RestartSec=10</span><span class="diff-line context"> </span><span class="diff-line context"> [Install]</span><span class="diff-line context"> WantedBy=multi-user.target</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-177">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/docker_socket_proxy/defaults/main.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -18,96 +18,53 @@</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line context"> # Container</span><span class="diff-line del">-docker_socket_proxy_docker_container: &quot;{{ docker_socket_proxy_name }}&quot;</span><span class="diff-line add">+docker_socket_proxy_role_docker_container: &quot;{{ docker_socket_proxy_name }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Image</span><span class="diff-line del">-docker_socket_proxy_docker_image_pull: true</span><span class="diff-line del">-docker_socket_proxy_docker_image_tag: &quot;latest&quot;</span><span class="diff-line del">-docker_socket_proxy_docker_image: &quot;lscr.io/linuxserver/socket-proxy:{{ docker_socket_proxy_docker_image_tag }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Ports</span><span class="diff-line del">-docker_socket_proxy_docker_ports_defaults: []</span><span class="diff-line del">-docker_socket_proxy_docker_ports_custom: []</span><span class="diff-line del">-docker_socket_proxy_docker_ports: &quot;{{ docker_socket_proxy_docker_ports_defaults</span><span class="diff-line del">-                                      + docker_socket_proxy_docker_ports_custom }}&quot;</span><span class="diff-line add">+docker_socket_proxy_role_docker_image_pull: true</span><span class="diff-line add">+docker_socket_proxy_role_docker_image_repo: &quot;lscr.io/linuxserver/socket-proxy&quot;</span><span class="diff-line add">+docker_socket_proxy_role_docker_image_tag: &quot;latest&quot;</span><span class="diff-line add">+docker_socket_proxy_role_docker_image: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_image_repo&#x27;, role=&#x27;docker_socket_proxy&#x27;) }}:{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_image_tag&#x27;, role=&#x27;docker_socket_proxy&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Envs</span><span class="diff-line del">-docker_socket_proxy_docker_envs_default:</span><span class="diff-line add">+docker_socket_proxy_role_docker_envs_default:</span><span class="diff-line context">   TZ: &quot;{{ tz }}&quot;</span><span class="diff-line del">-  DISABLE_IPV6: &quot;{{ &#x27;0&#x27; if dns.ipv6 else &#x27;1&#x27; }}&quot;</span><span class="diff-line del">-docker_socket_proxy_docker_envs_custom: {}</span><span class="diff-line del">-docker_socket_proxy_docker_envs: &quot;{{ docker_socket_proxy_docker_envs_default</span><span class="diff-line del">-                                     | combine(docker_socket_proxy_docker_envs_custom) }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Commands</span><span class="diff-line del">-docker_socket_proxy_docker_commands_default: []</span><span class="diff-line del">-docker_socket_proxy_docker_commands_custom: []</span><span class="diff-line del">-docker_socket_proxy_docker_commands: &quot;{{ docker_socket_proxy_docker_commands_default</span><span class="diff-line del">-                                         + docker_socket_proxy_docker_commands_custom }}&quot;</span><span class="diff-line add">+  DISABLE_IPV6: &quot;{{ &#x27;0&#x27; if dns_ipv6_enabled else &#x27;1&#x27; }}&quot;</span><span class="diff-line add">+docker_socket_proxy_role_docker_envs_custom: {}</span><span class="diff-line add">+docker_socket_proxy_role_docker_envs: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_envs_default&#x27;, role=&#x27;docker_socket_proxy&#x27;)</span><span class="diff-line add">+                                          | combine(lookup(&#x27;role_var&#x27;, &#x27;_docker_envs_custom&#x27;, role=&#x27;docker_socket_proxy&#x27;)) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Volumes</span><span class="diff-line del">-docker_socket_proxy_docker_volumes_default:</span><span class="diff-line del">-  - &quot;/var/run/docker.sock:/var/run/docker.sock:ro&quot;</span><span class="diff-line del">-docker_socket_proxy_docker_volumes_custom: []</span><span class="diff-line del">-docker_socket_proxy_docker_volumes: &quot;{{ docker_socket_proxy_docker_volumes_default</span><span class="diff-line del">-                                        + docker_socket_proxy_docker_volumes_custom }}&quot;</span><span class="diff-line add">+docker_socket_proxy_role_docker_volumes_default:</span><span class="diff-line add">+  - &quot;/var/run/docker.sock:/var/run/docker.sock&quot;</span><span class="diff-line add">+docker_socket_proxy_role_docker_volumes_custom: []</span><span class="diff-line add">+docker_socket_proxy_role_docker_volumes: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_volumes_default&#x27;, role=&#x27;docker_socket_proxy&#x27;)</span><span class="diff-line add">+                                             + lookup(&#x27;role_var&#x27;, &#x27;_docker_volumes_custom&#x27;, role=&#x27;docker_socket_proxy&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Mounts</span><span class="diff-line del">-docker_socket_proxy_docker_mounts_default:</span><span class="diff-line add">+docker_socket_proxy_role_docker_mounts_default:</span><span class="diff-line context">   - target: /run</span><span class="diff-line context">     type: tmpfs</span><span class="diff-line del">-docker_socket_proxy_docker_mounts_custom: []</span><span class="diff-line del">-docker_socket_proxy_docker_mounts: &quot;{{ docker_socket_proxy_docker_mounts_default</span><span class="diff-line del">-                                       + docker_socket_proxy_docker_mounts_custom }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Devices</span><span class="diff-line del">-docker_socket_proxy_docker_devices_default: []</span><span class="diff-line del">-docker_socket_proxy_docker_devices_custom: []</span><span class="diff-line del">-docker_socket_proxy_docker_devices: &quot;{{ docker_socket_proxy_docker_devices_default</span><span class="diff-line del">-                                        + docker_socket_proxy_docker_devices_custom }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Hosts</span><span class="diff-line del">-docker_socket_proxy_docker_hosts_default: {}</span><span class="diff-line del">-docker_socket_proxy_docker_hosts_custom: {}</span><span class="diff-line del">-docker_socket_proxy_docker_hosts: &quot;{{ docker_hosts_common</span><span class="diff-line del">-                                      | combine(docker_socket_proxy_docker_hosts_default)</span><span class="diff-line del">-                                      | combine(docker_socket_proxy_docker_hosts_custom) }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Labels</span><span class="diff-line del">-docker_socket_proxy_docker_labels_default: {}</span><span class="diff-line del">-docker_socket_proxy_docker_labels_custom: {}</span><span class="diff-line del">-docker_socket_proxy_docker_labels: &quot;{{ docker_labels_common</span><span class="diff-line del">-                                       | combine(docker_socket_proxy_docker_labels_default)</span><span class="diff-line del">-                                       | combine(docker_socket_proxy_docker_labels_custom) }}&quot;</span><span class="diff-line add">+docker_socket_proxy_role_docker_mounts_custom: []</span><span class="diff-line add">+docker_socket_proxy_role_docker_mounts: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_mounts_default&#x27;, role=&#x27;docker_socket_proxy&#x27;)</span><span class="diff-line add">+                                            + lookup(&#x27;role_var&#x27;, &#x27;_docker_mounts_custom&#x27;, role=&#x27;docker_socket_proxy&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Hostname</span><span class="diff-line del">-docker_socket_proxy_docker_hostname: &quot;{{ docker_socket_proxy_name }}&quot;</span><span class="diff-line add">+docker_socket_proxy_role_docker_hostname: &quot;{{ docker_socket_proxy_name }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Networks</span><span class="diff-line del">-docker_socket_proxy_docker_networks_alias: &quot;{{ docker_socket_proxy_name }}&quot;</span><span class="diff-line del">-docker_socket_proxy_docker_networks_default: []</span><span class="diff-line del">-docker_socket_proxy_docker_networks_custom: []</span><span class="diff-line del">-docker_socket_proxy_docker_networks: &quot;{{ docker_networks_common</span><span class="diff-line del">-                                         + docker_socket_proxy_docker_networks_default</span><span class="diff-line del">-                                         + docker_socket_proxy_docker_networks_custom }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Capabilities</span><span class="diff-line del">-docker_socket_proxy_docker_capabilities_default: []</span><span class="diff-line del">-docker_socket_proxy_docker_capabilities_custom: []</span><span class="diff-line del">-docker_socket_proxy_docker_capabilities: &quot;{{ docker_socket_proxy_docker_capabilities_default</span><span class="diff-line del">-                                             + docker_socket_proxy_docker_capabilities_custom }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Security Opts</span><span class="diff-line del">-docker_socket_proxy_docker_security_opts_default: []</span><span class="diff-line del">-docker_socket_proxy_docker_security_opts_custom: []</span><span class="diff-line del">-docker_socket_proxy_docker_security_opts: &quot;{{ docker_socket_proxy_docker_security_opts_default</span><span class="diff-line del">-                                              + docker_socket_proxy_docker_security_opts_custom }}&quot;</span><span class="diff-line add">+docker_socket_proxy_role_docker_networks_alias: &quot;{{ docker_socket_proxy_name }}&quot;</span><span class="diff-line add">+docker_socket_proxy_role_docker_networks_default: []</span><span class="diff-line add">+docker_socket_proxy_role_docker_networks_custom: []</span><span class="diff-line add">+docker_socket_proxy_role_docker_networks: &quot;{{ docker_networks_common</span><span class="diff-line add">+                                              + lookup(&#x27;role_var&#x27;, &#x27;_docker_networks_default&#x27;, role=&#x27;docker_socket_proxy&#x27;)</span><span class="diff-line add">+                                              + lookup(&#x27;role_var&#x27;, &#x27;_docker_networks_custom&#x27;, role=&#x27;docker_socket_proxy&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Restart Policy</span><span class="diff-line del">-docker_socket_proxy_docker_restart_policy: unless-stopped</span><span class="diff-line add">+docker_socket_proxy_role_docker_restart_policy: unless-stopped</span><span class="diff-line context"> </span><span class="diff-line context"> # State</span><span class="diff-line del">-docker_socket_proxy_docker_state: started</span><span class="diff-line add">+docker_socket_proxy_role_docker_state: started</span><span class="diff-line context"> </span><span class="diff-line context"> # Read Only Filesystem</span><span class="diff-line del">-docker_socket_proxy_docker_read_only: true</span><span class="diff-line add">+docker_socket_proxy_role_docker_read_only: true</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-178">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/docker_socket_proxy/tasks/main.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -1,8 +1,7 @@</span><span class="diff-line context"> #########################################################################</span><span class="diff-line del">-# Title:            Sandbox: docker_socket_proxy                        #</span><span class="diff-line add">+# Title:            Saltbox: docker_socket_proxy                        #</span><span class="diff-line context"> # Author(s):        salty, JigSawFr                                     #</span><span class="diff-line del">-# URL:              https://github.com/saltyorg/Sandbox                 #</span><span class="diff-line del">-# URL:              https://github.com/Tecnativa/docker-socket-proxy    #</span><span class="diff-line add">+# URL:              https://github.com/saltyorg/Saltbox                 #</span><span class="diff-line context"> # --                                                                    #</span><span class="diff-line context"> #########################################################################</span><span class="diff-line context"> #                   GNU General Public License v3.0                     #</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-179">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/dozzle/defaults/main.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -7,6 +7,12 @@</span><span class="diff-line context"> #                   GNU General Public License v3.0                      #</span><span class="diff-line context"> ##########################################################################</span><span class="diff-line context"> ---</span><span class="diff-line add">+################################</span><span class="diff-line add">+# Basics</span><span class="diff-line add">+################################</span><span class="diff-line add">+</span><span class="diff-line add">+dozzle_name: dozzle</span><span class="diff-line add">+</span><span class="diff-line context"> ################################</span><span class="diff-line context"> # Docker Socket Proxy</span><span class="diff-line context"> ################################</span><span class="diff-line hunk">@@ -19,169 +25,129 @@</span><span class="diff-line context"> # Settings</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-dozzle_additional_hosts: &quot;&quot;</span><span class="diff-line del">-dozzle_agent_hosts: &quot;&quot;</span><span class="diff-line del">-dozzle_agent_mode: false</span><span class="diff-line del">-</span><span class="diff-line del">-################################</span><span class="diff-line del">-# Basics</span><span class="diff-line del">-################################</span><span class="diff-line del">-</span><span class="diff-line del">-dozzle_name: dozzle</span><span class="diff-line add">+dozzle_role_additional_hosts: &quot;&quot;</span><span class="diff-line add">+dozzle_role_agent_hosts: &quot;&quot;</span><span class="diff-line add">+dozzle_role_agent_mode: false</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # Paths</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-dozzle_paths_folder: &quot;{{ dozzle_name }}&quot;</span><span class="diff-line del">-dozzle_paths_location: &quot;{{ server_appdata_path }}/{{ dozzle_paths_folder }}&quot;</span><span class="diff-line del">-dozzle_paths_folders_list:</span><span class="diff-line del">-  - &quot;{{ dozzle_paths_location }}&quot;</span><span class="diff-line add">+dozzle_role_paths_folder: &quot;{{ dozzle_name }}&quot;</span><span class="diff-line add">+dozzle_role_paths_location: &quot;{{ server_appdata_path }}/{{ dozzle_role_paths_folder }}&quot;</span><span class="diff-line add">+dozzle_role_paths_folders_list:</span><span class="diff-line add">+  - &quot;{{ dozzle_role_paths_location }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # Web</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-dozzle_web_subdomain: &quot;{{ dozzle_name }}&quot;</span><span class="diff-line del">-dozzle_web_domain: &quot;{{ user.domain }}&quot;</span><span class="diff-line del">-dozzle_web_port: &quot;8080&quot;</span><span class="diff-line del">-dozzle_web_url: &quot;{{ &#x27;https://&#x27; + (dozzle_web_subdomain + &#x27;.&#x27; + dozzle_web_domain</span><span class="diff-line del">-                 if (dozzle_web_subdomain | length &gt; 0)</span><span class="diff-line del">-                 else dozzle_web_domain) }}&quot;</span><span class="diff-line add">+dozzle_role_web_subdomain: &quot;{{ dozzle_name }}&quot;</span><span class="diff-line add">+dozzle_role_web_domain: &quot;{{ user.domain }}&quot;</span><span class="diff-line add">+dozzle_role_web_port: &quot;8080&quot;</span><span class="diff-line add">+dozzle_role_web_url: &quot;{{ &#x27;https://&#x27; + (lookup(&#x27;role_var&#x27;, &#x27;_web_subdomain&#x27;, role=&#x27;dozzle&#x27;) + &#x27;.&#x27; + lookup(&#x27;role_var&#x27;, &#x27;_web_domain&#x27;, role=&#x27;dozzle&#x27;)</span><span class="diff-line add">+                      if (lookup(&#x27;role_var&#x27;, &#x27;_web_subdomain&#x27;, role=&#x27;dozzle&#x27;) | length &gt; 0)</span><span class="diff-line add">+                      else lookup(&#x27;role_var&#x27;, &#x27;_web_domain&#x27;, role=&#x27;dozzle&#x27;)) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # DNS</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-dozzle_dns_record: &quot;{{ dozzle_web_subdomain }}&quot;</span><span class="diff-line del">-dozzle_dns_zone: &quot;{{ dozzle_web_domain }}&quot;</span><span class="diff-line del">-dozzle_dns_proxy: &quot;{{ dns.proxied }}&quot;</span><span class="diff-line add">+dozzle_role_dns_record: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_web_subdomain&#x27;, role=&#x27;dozzle&#x27;) }}&quot;</span><span class="diff-line add">+dozzle_role_dns_zone: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_web_domain&#x27;, role=&#x27;dozzle&#x27;) }}&quot;</span><span class="diff-line add">+dozzle_role_dns_proxy: &quot;{{ dns_proxied }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # Traefik</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-dozzle_traefik_sso_middleware: &quot;{{ traefik_default_sso_middleware }}&quot;</span><span class="diff-line del">-dozzle_traefik_middleware_default: &quot;{{ traefik_default_middleware</span><span class="diff-line del">-                                       + (&#x27;,dropsecurityheaders@file,themepark-&#x27; + lookup(&#x27;vars&#x27;, dozzle_name + &#x27;_name&#x27;, default=dozzle_name)</span><span class="diff-line del">-                                         if (dozzle_themepark_enabled and global_themepark_plugin_enabled)</span><span class="diff-line del">-                                         else &#x27;&#x27;) }}&quot;</span><span class="diff-line del">-dozzle_traefik_middleware_custom: &quot;&quot;</span><span class="diff-line del">-dozzle_traefik_certresolver: &quot;{{ traefik_default_certresolver }}&quot;</span><span class="diff-line del">-dozzle_traefik_enabled: true</span><span class="diff-line del">-dozzle_traefik_api_enabled: false</span><span class="diff-line del">-dozzle_traefik_api_endpoint: &quot;&quot;</span><span class="diff-line add">+dozzle_role_traefik_sso_middleware: &quot;{{ traefik_default_sso_middleware }}&quot;</span><span class="diff-line add">+dozzle_role_traefik_middleware_default: &quot;{{ traefik_default_middleware</span><span class="diff-line add">+                                            + (&#x27;,dropsecurityheaders@file,themepark-&#x27; + dozzle_name</span><span class="diff-line add">+                                              if (lookup(&#x27;role_var&#x27;, &#x27;_themepark_enabled&#x27;, role=&#x27;dozzle&#x27;) and global_themepark_plugin_enabled)</span><span class="diff-line add">+                                              else &#x27;&#x27;) }}&quot;</span><span class="diff-line add">+dozzle_role_traefik_middleware_custom: &quot;&quot;</span><span class="diff-line add">+dozzle_role_traefik_certresolver: &quot;{{ traefik_default_certresolver }}&quot;</span><span class="diff-line add">+dozzle_role_traefik_enabled: true</span><span class="diff-line add">+dozzle_role_traefik_api_enabled: false</span><span class="diff-line add">+dozzle_role_traefik_api_endpoint: &quot;&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line del">-# THEME</span><span class="diff-line add">+# Theme</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line context"> # Options can be found at https://github.com/themepark-dev/theme.park</span><span class="diff-line del">-dozzle_themepark_enabled: false</span><span class="diff-line del">-dozzle_themepark_app: &quot;dozzle&quot;</span><span class="diff-line del">-dozzle_themepark_theme: &quot;{{ global_themepark_theme }}&quot;</span><span class="diff-line del">-dozzle_themepark_domain: &quot;{{ global_themepark_domain }}&quot;</span><span class="diff-line del">-dozzle_themepark_addons: []</span><span class="diff-line add">+dozzle_role_themepark_enabled: false</span><span class="diff-line add">+dozzle_role_themepark_app: &quot;dozzle&quot;</span><span class="diff-line add">+dozzle_role_themepark_theme: &quot;{{ global_themepark_theme }}&quot;</span><span class="diff-line add">+dozzle_role_themepark_domain: &quot;{{ global_themepark_domain }}&quot;</span><span class="diff-line add">+dozzle_role_themepark_addons: []</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # Docker</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line context"> # Container</span><span class="diff-line del">-dozzle_docker_container: &quot;{{ dozzle_name }}&quot;</span><span class="diff-line add">+dozzle_role_docker_container: &quot;{{ dozzle_name }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Image</span><span class="diff-line del">-dozzle_docker_image_pull: true</span><span class="diff-line del">-dozzle_docker_image_tag: &quot;latest&quot;</span><span class="diff-line del">-dozzle_docker_image: &quot;amir20/dozzle:{{ dozzle_docker_image_tag }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Ports</span><span class="diff-line del">-dozzle_docker_ports_defaults: []</span><span class="diff-line del">-dozzle_docker_ports_custom: []</span><span class="diff-line del">-dozzle_docker_ports: &quot;{{ dozzle_docker_ports_defaults</span><span class="diff-line del">-                         + dozzle_docker_ports_custom }}&quot;</span><span class="diff-line add">+dozzle_role_docker_image_pull: true</span><span class="diff-line add">+dozzle_role_docker_image_repo: &quot;amir20/dozzle&quot;</span><span class="diff-line add">+dozzle_role_docker_image_tag: &quot;latest&quot;</span><span class="diff-line add">+dozzle_role_docker_image: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_image_repo&#x27;, role=&#x27;dozzle&#x27;) }}:{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_image_tag&#x27;, role=&#x27;dozzle&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Envs</span><span class="diff-line del">-dozzle_docker_envs_default:</span><span class="diff-line del">-  DOZZLE_AUTH_PROVIDER: &quot;{{ &#x27;forward-proxy&#x27; if (dozzle_traefik_sso_middleware | length &gt; 0) else omit }}&quot;</span><span class="diff-line del">-  DOZZLE_REMOTE_AGENT: &quot;{{ dozzle_agent_hosts if (dozzle_additional_hosts | length &gt; 0) else omit }}&quot;</span><span class="diff-line del">-  DOZZLE_REMOTE_HOST: &quot;{{ &#x27;tcp://&#x27; + dozzle_name + &#x27;-docker-socket-proxy:2375|&#x27; + traefik_host + &#x27;,&#x27; + dozzle_additional_hosts</span><span class="diff-line del">-                       if (dozzle_additional_hosts | length &gt; 0)</span><span class="diff-line add">+dozzle_role_docker_envs_default:</span><span class="diff-line add">+  DOZZLE_AUTH_PROVIDER: &quot;{{ &#x27;forward-proxy&#x27; if (lookup(&#x27;role_var&#x27;, &#x27;_traefik_sso_middleware&#x27;, role=&#x27;dozzle&#x27;) | length &gt; 0) else omit }}&quot;</span><span class="diff-line add">+  DOZZLE_REMOTE_AGENT: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_agent_hosts&#x27;, role=&#x27;dozzle&#x27;) if (lookup(&#x27;role_var&#x27;, &#x27;_additional_hosts&#x27;, role=&#x27;dozzle&#x27;) | length &gt; 0) else omit }}&quot;</span><span class="diff-line add">+  DOZZLE_REMOTE_HOST: &quot;{{ &#x27;tcp://&#x27; + dozzle_name + &#x27;-docker-socket-proxy:2375|&#x27; + traefik_host + &#x27;,&#x27; + lookup(&#x27;role_var&#x27;, &#x27;_additional_hosts&#x27;, role=&#x27;dozzle&#x27;)</span><span class="diff-line add">+                       if (lookup(&#x27;role_var&#x27;, &#x27;_additional_hosts&#x27;, role=&#x27;dozzle&#x27;) | length &gt; 0)</span><span class="diff-line context">                        else &#x27;tcp://&#x27; + dozzle_name + &#x27;-docker-socket-proxy:2375|&#x27; + traefik_host }}&quot;</span><span class="diff-line del">-dozzle_docker_envs_custom: {}</span><span class="diff-line del">-dozzle_docker_envs: &quot;{{ dozzle_docker_envs_default</span><span class="diff-line del">-                        | combine(dozzle_docker_envs_custom) }}&quot;</span><span class="diff-line add">+  DOZZLE_AUTH_HEADER_USER: &quot;{{ &#x27;X-authentik-username&#x27; if &#x27;authentik&#x27; in lookup(&#x27;role_var&#x27;, &#x27;_traefik_sso_middleware&#x27;, role=&#x27;dozzle&#x27;) else omit }}&quot;</span><span class="diff-line add">+  DOZZLE_AUTH_HEADER_EMAIL: &quot;{{ &#x27;X-authentik-email&#x27; if &#x27;authentik&#x27; in lookup(&#x27;role_var&#x27;, &#x27;_traefik_sso_middleware&#x27;, role=&#x27;dozzle&#x27;) else omit }}&quot;</span><span class="diff-line add">+  DOZZLE_AUTH_HEADER_NAME: &quot;{{ &#x27;X-authentik-name&#x27; if &#x27;authentik&#x27; in lookup(&#x27;role_var&#x27;, &#x27;_traefik_sso_middleware&#x27;, role=&#x27;dozzle&#x27;) else omit }}&quot;</span><span class="diff-line add">+dozzle_role_docker_envs_custom: {}</span><span class="diff-line add">+dozzle_role_docker_envs: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_envs_default&#x27;, role=&#x27;dozzle&#x27;)</span><span class="diff-line add">+                             | combine(lookup(&#x27;role_var&#x27;, &#x27;_docker_envs_custom&#x27;, role=&#x27;dozzle&#x27;)) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Commands</span><span class="diff-line del">-dozzle_docker_commands_agent: &quot;agent&quot;</span><span class="diff-line del">-dozzle_docker_commands_default: []</span><span class="diff-line del">-dozzle_docker_commands_custom: []</span><span class="diff-line del">-dozzle_docker_commands: &quot;{{ dozzle_docker_commands_agent</span><span class="diff-line del">-                            + dozzle_docker_commands_default</span><span class="diff-line del">-                            + dozzle_docker_commands_custom</span><span class="diff-line del">-                         if (dozzle_agent_mode)</span><span class="diff-line del">-                         else dozzle_docker_commands_default</span><span class="diff-line del">-                              + dozzle_docker_commands_custom }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Volumes</span><span class="diff-line del">-dozzle_docker_volumes_default: []</span><span class="diff-line del">-dozzle_docker_volumes_custom: []</span><span class="diff-line del">-dozzle_docker_volumes: &quot;{{ dozzle_docker_volumes_default</span><span class="diff-line del">-                           + dozzle_docker_volumes_custom }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Devices</span><span class="diff-line del">-dozzle_docker_devices_default: []</span><span class="diff-line del">-dozzle_docker_devices_custom: []</span><span class="diff-line del">-dozzle_docker_devices: &quot;{{ dozzle_docker_devices_default</span><span class="diff-line del">-                           + dozzle_docker_devices_custom }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Hosts</span><span class="diff-line del">-dozzle_docker_hosts_default: {}</span><span class="diff-line del">-dozzle_docker_hosts_custom: {}</span><span class="diff-line del">-dozzle_docker_hosts: &quot;{{ docker_hosts_common</span><span class="diff-line del">-                         | combine(dozzle_docker_hosts_default)</span><span class="diff-line del">-                         | combine(dozzle_docker_hosts_custom) }}&quot;</span><span class="diff-line add">+dozzle_role_docker_commands_agent: &quot;agent&quot;</span><span class="diff-line add">+dozzle_role_docker_commands_default: []</span><span class="diff-line add">+dozzle_role_docker_commands_custom: []</span><span class="diff-line add">+dozzle_role_docker_commands: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_commands_agent&#x27;, role=&#x27;dozzle&#x27;)</span><span class="diff-line add">+                                 + lookup(&#x27;role_var&#x27;, &#x27;_docker_commands_default&#x27;, role=&#x27;dozzle&#x27;)</span><span class="diff-line add">+                                 + lookup(&#x27;role_var&#x27;, &#x27;_docker_commands_custom&#x27;, role=&#x27;dozzle&#x27;)</span><span class="diff-line add">+                              if lookup(&#x27;role_var&#x27;, &#x27;_agent_mode&#x27;, role=&#x27;dozzle&#x27;)</span><span class="diff-line add">+                              else lookup(&#x27;role_var&#x27;, &#x27;_docker_commands_default&#x27;, role=&#x27;dozzle&#x27;)</span><span class="diff-line add">+                                   + lookup(&#x27;role_var&#x27;, &#x27;_docker_commands_custom&#x27;, role=&#x27;dozzle&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Labels</span><span class="diff-line del">-dozzle_docker_labels_default: {}</span><span class="diff-line del">-dozzle_docker_labels_custom: {}</span><span class="diff-line del">-dozzle_docker_labels: &quot;{{ docker_labels_common</span><span class="diff-line del">-                          | combine(dozzle_docker_labels_default)</span><span class="diff-line del">-                          | combine((traefik_themepark_labels</span><span class="diff-line del">-                                    if (dozzle_themepark_enabled and global_themepark_plugin_enabled)</span><span class="diff-line del">-                                    else {}),</span><span class="diff-line del">-                                    dozzle_docker_labels_custom) }}&quot;</span><span class="diff-line add">+dozzle_role_docker_labels_default: {}</span><span class="diff-line add">+dozzle_role_docker_labels_custom: {}</span><span class="diff-line add">+dozzle_role_docker_labels: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_labels_default&#x27;, role=&#x27;dozzle&#x27;)</span><span class="diff-line add">+                               | combine((traefik_themepark_labels</span><span class="diff-line add">+                                         if (lookup(&#x27;role_var&#x27;, &#x27;_themepark_enabled&#x27;, role=&#x27;dozzle&#x27;) and global_themepark_plugin_enabled)</span><span class="diff-line add">+                                         else {}),</span><span class="diff-line add">+                                         lookup(&#x27;role_var&#x27;, &#x27;_docker_labels_custom&#x27;, role=&#x27;dozzle&#x27;)) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Hostname</span><span class="diff-line del">-dozzle_docker_hostname: &quot;{{ dozzle_name }}&quot;</span><span class="diff-line add">+dozzle_role_docker_hostname: &quot;{{ dozzle_name }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Networks</span><span class="diff-line del">-dozzle_docker_networks_alias: &quot;{{ dozzle_name }}&quot;</span><span class="diff-line del">-dozzle_docker_networks_default: []</span><span class="diff-line del">-dozzle_docker_networks_custom: []</span><span class="diff-line del">-dozzle_docker_networks: &quot;{{ docker_networks_common</span><span class="diff-line del">-                            + dozzle_docker_networks_default</span><span class="diff-line del">-                            + dozzle_docker_networks_custom }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Capabilities</span><span class="diff-line del">-dozzle_docker_capabilities_default: []</span><span class="diff-line del">-dozzle_docker_capabilities_custom: []</span><span class="diff-line del">-dozzle_docker_capabilities: &quot;{{ dozzle_docker_capabilities_default</span><span class="diff-line del">-                                + dozzle_docker_capabilities_custom }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Security Opts</span><span class="diff-line del">-dozzle_docker_security_opts_default: []</span><span class="diff-line del">-dozzle_docker_security_opts_custom: []</span><span class="diff-line del">-dozzle_docker_security_opts: &quot;{{ dozzle_docker_security_opts_default</span><span class="diff-line del">-                                  + dozzle_docker_security_opts_custom }}&quot;</span><span class="diff-line add">+dozzle_role_docker_networks_alias: &quot;{{ dozzle_name }}&quot;</span><span class="diff-line add">+dozzle_role_docker_networks_default: []</span><span class="diff-line add">+dozzle_role_docker_networks_custom: []</span><span class="diff-line add">+dozzle_role_docker_networks: &quot;{{ docker_networks_common</span><span class="diff-line add">+                                 + lookup(&#x27;role_var&#x27;, &#x27;_docker_networks_default&#x27;, role=&#x27;dozzle&#x27;)</span><span class="diff-line add">+                                 + lookup(&#x27;role_var&#x27;, &#x27;_docker_networks_custom&#x27;, role=&#x27;dozzle&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Restart Policy</span><span class="diff-line del">-dozzle_docker_restart_policy: unless-stopped</span><span class="diff-line add">+dozzle_role_docker_restart_policy: unless-stopped</span><span class="diff-line context"> </span><span class="diff-line context"> # State</span><span class="diff-line del">-dozzle_docker_state: started</span><span class="diff-line add">+dozzle_role_docker_state: started</span><span class="diff-line context"> </span><span class="diff-line context"> # Dependencies</span><span class="diff-line del">-dozzle_depends_on: &quot;{{ dozzle_name }}-docker-socket-proxy&quot;</span><span class="diff-line del">-dozzle_depends_on_delay: &quot;0&quot;</span><span class="diff-line del">-dozzle_depends_on_healthchecks: &quot;false&quot;</span><span class="diff-line add">+dozzle_role_depends_on: &quot;{{ dozzle_name }}-docker-socket-proxy&quot;</span><span class="diff-line add">+dozzle_role_depends_on_delay: &quot;0&quot;</span><span class="diff-line add">+dozzle_role_depends_on_healthchecks: &quot;false&quot;</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-180">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/dozzle/tasks/main.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -12,14 +12,14 @@</span><span class="diff-line context">     name: docker_socket_proxy</span><span class="diff-line context">   vars:</span><span class="diff-line context">     docker_socket_proxy_name: &quot;{{ dozzle_name }}-docker-socket-proxy&quot;</span><span class="diff-line del">-    docker_socket_proxy_docker_envs_custom: &quot;{{ dozzle_docker_socket_proxy_envs }}&quot;</span><span class="diff-line add">+    docker_socket_proxy_role_docker_envs_custom: &quot;{{ dozzle_docker_socket_proxy_envs }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Add DNS record</span><span class="diff-line context">   ansible.builtin.include_tasks: &quot;{{ resources_tasks_path }}/dns/tasker.yml&quot;</span><span class="diff-line context">   vars:</span><span class="diff-line del">-    dns_record: &quot;{{ lookup(&#x27;vars&#x27;, role_name + &#x27;_dns_record&#x27;) }}&quot;</span><span class="diff-line del">-    dns_zone: &quot;{{ lookup(&#x27;vars&#x27;, role_name + &#x27;_dns_zone&#x27;) }}&quot;</span><span class="diff-line del">-    dns_proxy: &quot;{{ lookup(&#x27;vars&#x27;, role_name + &#x27;_dns_proxy&#x27;) }}&quot;</span><span class="diff-line add">+    dns_record: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_dns_record&#x27;) }}&quot;</span><span class="diff-line add">+    dns_zone: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_dns_zone&#x27;) }}&quot;</span><span class="diff-line add">+    dns_proxy: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_dns_proxy&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Remove existing Docker container</span><span class="diff-line context">   ansible.builtin.include_tasks: &quot;{{ resources_tasks_path }}/docker/remove_docker_container.yml&quot;</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-181">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/emby/defaults/main.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -17,197 +17,154 @@</span><span class="diff-line context"> # Settings</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-emby_config_cache_size: 1024</span><span class="diff-line add">+emby_role_config_cache_size: 1024</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # Paths</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-emby_paths_folder: &quot;{{ emby_name }}&quot;</span><span class="diff-line del">-emby_paths_location: &quot;{{ server_appdata_path }}/{{ emby_paths_folder }}&quot;</span><span class="diff-line del">-emby_paths_transcodes_location: &quot;{{ transcodes_path }}/{{ emby_paths_folder }}&quot;</span><span class="diff-line del">-emby_paths_folders_list:</span><span class="diff-line del">-  - &quot;{{ emby_paths_location }}&quot;</span><span class="diff-line del">-  - &quot;{{ emby_paths_location }}/config&quot;</span><span class="diff-line del">-  - &quot;{{ emby_paths_location }}/config/users&quot;</span><span class="diff-line del">-  - &quot;{{ emby_paths_transcodes_location }}&quot;</span><span class="diff-line del">-emby_paths_config_location: &quot;{{ emby_paths_location }}/config/system.xml&quot;</span><span class="diff-line del">-emby_paths_dlna_xml_location: &quot;{{ emby_paths_location }}/config/dlna.xml&quot;</span><span class="diff-line add">+emby_role_paths_folder: &quot;{{ emby_name }}&quot;</span><span class="diff-line add">+emby_role_paths_location: &quot;{{ server_appdata_path }}/{{ emby_role_paths_folder }}&quot;</span><span class="diff-line add">+emby_role_paths_transcodes_location: &quot;{{ transcodes_path }}/{{ emby_role_paths_folder }}&quot;</span><span class="diff-line add">+emby_role_paths_folders_list:</span><span class="diff-line add">+  - &quot;{{ emby_role_paths_location }}&quot;</span><span class="diff-line add">+  - &quot;{{ emby_role_paths_location }}/config&quot;</span><span class="diff-line add">+  - &quot;{{ emby_role_paths_location }}/config/users&quot;</span><span class="diff-line add">+  - &quot;{{ emby_role_paths_transcodes_location }}&quot;</span><span class="diff-line add">+emby_role_paths_config_location: &quot;{{ emby_role_paths_location }}/config/system.xml&quot;</span><span class="diff-line add">+emby_role_paths_dlna_xml_location: &quot;{{ emby_role_paths_location }}/config/dlna.xml&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # Web</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-emby_web_subdomain: &quot;{{ emby_name }}&quot;</span><span class="diff-line del">-emby_web_domain: &quot;{{ user.domain }}&quot;</span><span class="diff-line del">-emby_web_port: &quot;8096&quot;</span><span class="diff-line del">-emby_web_url: &quot;{{ &#x27;https://&#x27; + (lookup(&#x27;vars&#x27;, emby_name + &#x27;_web_subdomain&#x27;, default=emby_web_subdomain) + &#x27;.&#x27; + lookup(&#x27;vars&#x27;, emby_name + &#x27;_web_domain&#x27;, default=emby_web_domain)</span><span class="diff-line del">-               if (lookup(&#x27;vars&#x27;, emby_name + &#x27;_web_subdomain&#x27;, default=emby_web_subdomain) | length &gt; 0)</span><span class="diff-line del">-               else lookup(&#x27;vars&#x27;, emby_name + &#x27;_web_domain&#x27;, default=emby_web_domain)) }}&quot;</span><span class="diff-line add">+emby_role_web_subdomain: &quot;{{ emby_name }}&quot;</span><span class="diff-line add">+emby_role_web_domain: &quot;{{ user.domain }}&quot;</span><span class="diff-line add">+emby_role_web_port: &quot;8096&quot;</span><span class="diff-line add">+emby_role_web_url: &quot;{{ &#x27;https://&#x27; + (lookup(&#x27;role_var&#x27;, &#x27;_web_subdomain&#x27;, role=&#x27;emby&#x27;) + &#x27;.&#x27; + lookup(&#x27;role_var&#x27;, &#x27;_web_domain&#x27;, role=&#x27;emby&#x27;)</span><span class="diff-line add">+                    if (lookup(&#x27;role_var&#x27;, &#x27;_web_subdomain&#x27;, role=&#x27;emby&#x27;) | length &gt; 0)</span><span class="diff-line add">+                    else lookup(&#x27;role_var&#x27;, &#x27;_web_domain&#x27;, role=&#x27;emby&#x27;)) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # DNS</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-emby_dns_record: &quot;{{ lookup(&#x27;vars&#x27;, emby_name + &#x27;_web_subdomain&#x27;, default=emby_web_subdomain) }}&quot;</span><span class="diff-line del">-emby_dns_zone: &quot;{{ lookup(&#x27;vars&#x27;, emby_name + &#x27;_web_domain&#x27;, default=emby_web_domain) }}&quot;</span><span class="diff-line del">-emby_dns_proxy: &quot;{{ dns.proxied }}&quot;</span><span class="diff-line add">+emby_role_dns_record: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_web_subdomain&#x27;, role=&#x27;emby&#x27;) }}&quot;</span><span class="diff-line add">+emby_role_dns_zone: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_web_domain&#x27;, role=&#x27;emby&#x27;) }}&quot;</span><span class="diff-line add">+emby_role_dns_proxy: &quot;{{ dns_proxied }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # Traefik</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-emby_traefik_sso_middleware: &quot;&quot;</span><span class="diff-line del">-emby_traefik_middleware_default: &quot;{{ traefik_default_middleware</span><span class="diff-line del">-                                     + (&#x27;,themepark-&#x27; + lookup(&#x27;vars&#x27;, emby_name + &#x27;_name&#x27;, default=emby_name)</span><span class="diff-line del">-                                       if (emby_themepark_enabled and global_themepark_plugin_enabled)</span><span class="diff-line del">-                                       else &#x27;&#x27;) }}&quot;</span><span class="diff-line del">-emby_traefik_middleware_custom: &quot;&quot;</span><span class="diff-line del">-emby_traefik_certresolver: &quot;{{ traefik_default_certresolver }}&quot;</span><span class="diff-line del">-emby_traefik_enabled: true</span><span class="diff-line del">-emby_traefik_gzip_enabled: false</span><span class="diff-line del">-emby_traefik_api_enabled: false</span><span class="diff-line del">-emby_traefik_api_endpoint: &quot;&quot;</span><span class="diff-line add">+emby_role_traefik_sso_middleware: &quot;&quot;</span><span class="diff-line add">+emby_role_traefik_middleware_default: &quot;{{ traefik_default_middleware</span><span class="diff-line add">+                                          + (&#x27;,themepark-&#x27; + emby_name</span><span class="diff-line add">+                                            if (lookup(&#x27;role_var&#x27;, &#x27;_themepark_enabled&#x27;, role=&#x27;emby&#x27;) and global_themepark_plugin_enabled)</span><span class="diff-line add">+                                            else &#x27;&#x27;) }}&quot;</span><span class="diff-line add">+emby_role_traefik_middleware_custom: &quot;&quot;</span><span class="diff-line add">+emby_role_traefik_certresolver: &quot;{{ traefik_default_certresolver }}&quot;</span><span class="diff-line add">+emby_role_traefik_enabled: true</span><span class="diff-line add">+emby_role_traefik_gzip_enabled: false</span><span class="diff-line add">+emby_role_traefik_api_enabled: false</span><span class="diff-line add">+emby_role_traefik_api_endpoint: &quot;&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line del">-# THEME</span><span class="diff-line add">+# Theme</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line context"> # Options can be found at https://github.com/themepark-dev/theme.park</span><span class="diff-line del">-emby_themepark_enabled: false</span><span class="diff-line del">-emby_themepark_app: &quot;emby&quot;</span><span class="diff-line del">-emby_themepark_theme: &quot;{{ global_themepark_theme }}&quot;</span><span class="diff-line del">-emby_themepark_domain: &quot;{{ global_themepark_domain }}&quot;</span><span class="diff-line del">-emby_themepark_addons: []</span><span class="diff-line add">+emby_role_themepark_enabled: false</span><span class="diff-line add">+emby_role_themepark_app: &quot;emby&quot;</span><span class="diff-line add">+emby_role_themepark_theme: &quot;{{ global_themepark_theme }}&quot;</span><span class="diff-line add">+emby_role_themepark_domain: &quot;{{ global_themepark_domain }}&quot;</span><span class="diff-line add">+emby_role_themepark_addons: []</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # Config</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-emby_config_settings_default:</span><span class="diff-line add">+emby_role_config_settings_default:</span><span class="diff-line context">   - { xpath: &#x27;IsBehindProxy&#x27;, value: &#x27;true&#x27; }</span><span class="diff-line del">-  - { xpath: &#x27;WanDdns&#x27;, value: &#x27;{{ lookup(&quot;vars&quot;, emby_name + &quot;_web_subdomain&quot;, default=emby_web_subdomain) }}.{{ lookup(&quot;vars&quot;, emby_name + &quot;_web_domain&quot;, default=emby_web_domain) }}&#x27; }</span><span class="diff-line add">+  - { xpath: &#x27;WanDdns&#x27;, value: &#x27;{{ lookup(&quot;role_var&quot;, &quot;_web_subdomain&quot;, role=&quot;emby&quot;) }}.{{ lookup(&quot;role_var&quot;, &quot;_web_domain&quot;, role=&quot;emby&quot;) }}&#x27; }</span><span class="diff-line context">   - { xpath: &#x27;PublicPort&#x27;, value: &#x27;80&#x27; }</span><span class="diff-line context">   - { xpath: &#x27;PublicHttpsPort&#x27;, value: &#x27;443&#x27; }</span><span class="diff-line context">   - { xpath: &#x27;EnableHttps&#x27;, value: &#x27;true&#x27; }</span><span class="diff-line context">   - { xpath: &#x27;RequireHttps&#x27;, value: &#x27;false&#x27; }</span><span class="diff-line context">   - { xpath: &#x27;EnableUPnP&#x27;, value: &#x27;false&#x27; }</span><span class="diff-line del">-  - { xpath: &#x27;DatabaseCacheSizeMB&#x27;, value: &#x27;{{ lookup(&quot;vars&quot;, emby_name + &quot;_config_cache_size&quot;, default=emby_config_cache_size) }}&#x27; }</span><span class="diff-line add">+  - { xpath: &#x27;DatabaseCacheSizeMB&#x27;, value: &#x27;{{ lookup(&quot;role_var&quot;, &quot;_config_cache_size&quot;, role=&quot;emby&quot;) | string }}&#x27; }</span><span class="diff-line context"> </span><span class="diff-line del">-emby_config_settings_custom: []</span><span class="diff-line add">+emby_role_config_settings_custom: []</span><span class="diff-line context"> </span><span class="diff-line del">-emby_config_settings_list: &quot;{{ lookup(&#x27;vars&#x27;, emby_name + &#x27;_config_settings_default&#x27;, default=emby_config_settings_default) + lookup(&#x27;vars&#x27;, emby_name + &#x27;_config_settings_custom&#x27;, default=emby_config_settings_custom) }}&quot;</span><span class="diff-line add">+emby_role_config_settings_list: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_config_settings_default&#x27;, role=&#x27;emby&#x27;) + lookup(&#x27;role_var&#x27;, &#x27;_config_settings_custom&#x27;, role=&#x27;emby&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # Docker</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line context"> # Container</span><span class="diff-line del">-emby_docker_container: &quot;{{ emby_name }}&quot;</span><span class="diff-line add">+emby_role_docker_container: &quot;{{ emby_name }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Image</span><span class="diff-line del">-emby_docker_image_pull: true</span><span class="diff-line del">-emby_docker_image_repo: &quot;lscr.io/linuxserver/emby&quot;</span><span class="diff-line del">-emby_docker_image_tag: &quot;latest&quot;</span><span class="diff-line del">-emby_docker_image: &quot;{{ lookup(&#x27;vars&#x27;, emby_name + &#x27;_docker_image_repo&#x27;, default=emby_docker_image_repo)</span><span class="diff-line del">-                       + &#x27;:&#x27; + lookup(&#x27;vars&#x27;, emby_name + &#x27;_docker_image_tag&#x27;, default=emby_docker_image_tag) }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Ports</span><span class="diff-line del">-emby_docker_ports_defaults: []</span><span class="diff-line del">-emby_docker_ports_custom: []</span><span class="diff-line del">-emby_docker_ports: &quot;{{ lookup(&#x27;vars&#x27;, emby_name + &#x27;_docker_ports_defaults&#x27;, default=emby_docker_ports_defaults)</span><span class="diff-line del">-                       + lookup(&#x27;vars&#x27;, emby_name + &#x27;_docker_ports_custom&#x27;, default=emby_docker_ports_custom) }}&quot;</span><span class="diff-line add">+emby_role_docker_image_pull: true</span><span class="diff-line add">+emby_role_docker_image_repo: &quot;lscr.io/linuxserver/emby&quot;</span><span class="diff-line add">+emby_role_docker_image_tag: &quot;latest&quot;</span><span class="diff-line add">+emby_role_docker_image: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_image_repo&#x27;, role=&#x27;emby&#x27;) }}:{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_image_tag&#x27;, role=&#x27;emby&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Envs</span><span class="diff-line del">-emby_docker_envs_default:</span><span class="diff-line add">+emby_role_docker_envs_default:</span><span class="diff-line context">   PUID: &quot;{{ uid }}&quot;</span><span class="diff-line context">   PGID: &quot;{{ gid }}&quot;</span><span class="diff-line context">   TZ: &quot;{{ tz }}&quot;</span><span class="diff-line del">-emby_docker_envs_custom: {}</span><span class="diff-line del">-emby_docker_envs: &quot;{{ lookup(&#x27;vars&#x27;, emby_name + &#x27;_docker_envs_default&#x27;, default=emby_docker_envs_default)</span><span class="diff-line del">-                      | combine(lookup(&#x27;vars&#x27;, emby_name + &#x27;_docker_envs_custom&#x27;, default=emby_docker_envs_custom)) }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Commands</span><span class="diff-line del">-emby_docker_commands_default: []</span><span class="diff-line del">-emby_docker_commands_custom: []</span><span class="diff-line del">-emby_docker_commands: &quot;{{ lookup(&#x27;vars&#x27;, emby_name + &#x27;_docker_commands_default&#x27;, default=emby_docker_commands_default)</span><span class="diff-line del">-                          + lookup(&#x27;vars&#x27;, emby_name + &#x27;_docker_commands_custom&#x27;, default=emby_docker_commands_custom) }}&quot;</span><span class="diff-line add">+emby_role_docker_envs_custom: {}</span><span class="diff-line add">+emby_role_docker_envs: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_envs_default&#x27;, role=&#x27;emby&#x27;)</span><span class="diff-line add">+                           | combine(lookup(&#x27;role_var&#x27;, &#x27;_docker_envs_custom&#x27;, role=&#x27;emby&#x27;)) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Volumes</span><span class="diff-line del">-emby_docker_volumes_default:</span><span class="diff-line del">-  - &quot;{{ emby_paths_location }}:/config&quot;</span><span class="diff-line add">+emby_role_docker_volumes_default:</span><span class="diff-line add">+  - &quot;{{ emby_role_paths_location }}:/config&quot;</span><span class="diff-line context">   - &quot;{{ server_appdata_path }}/scripts:/scripts&quot;</span><span class="diff-line context">   - &quot;/dev/shm:/dev/shm&quot;</span><span class="diff-line del">-  - &quot;{{ emby_paths_transcodes_location }}:/transcode&quot;</span><span class="diff-line del">-emby_docker_volumes_legacy:</span><span class="diff-line add">+  - &quot;{{ emby_role_paths_transcodes_location }}:/transcode&quot;</span><span class="diff-line add">+emby_role_docker_volumes_legacy:</span><span class="diff-line context">   - &quot;/mnt/unionfs/Media:/data&quot;</span><span class="diff-line del">-emby_docker_volumes_custom: []</span><span class="diff-line del">-emby_docker_volumes: &quot;{{ lookup(&#x27;vars&#x27;, emby_name + &#x27;_docker_volumes_default&#x27;, default=emby_docker_volumes_default)</span><span class="diff-line del">-                         + lookup(&#x27;vars&#x27;, emby_name + &#x27;_docker_volumes_custom&#x27;, default=emby_docker_volumes_custom)</span><span class="diff-line del">-                         + (lookup(&#x27;vars&#x27;, emby_name + &#x27;_docker_volumes_legacy&#x27;, default=emby_docker_volumes_legacy)</span><span class="diff-line del">-                           if docker_legacy_volume</span><span class="diff-line del">-                           else []) }}&quot;</span><span class="diff-line add">+emby_role_docker_volumes_custom: []</span><span class="diff-line add">+emby_role_docker_volumes: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_volumes_default&#x27;, role=&#x27;emby&#x27;)</span><span class="diff-line add">+                              + lookup(&#x27;role_var&#x27;, &#x27;_docker_volumes_custom&#x27;, role=&#x27;emby&#x27;)</span><span class="diff-line add">+                              + (lookup(&#x27;role_var&#x27;, &#x27;_docker_volumes_legacy&#x27;, role=&#x27;emby&#x27;)</span><span class="diff-line add">+                                if docker_legacy_volume</span><span class="diff-line add">+                                else []) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Mounts</span><span class="diff-line del">-emby_docker_mounts_default:</span><span class="diff-line add">+emby_role_docker_mounts_default:</span><span class="diff-line context">   - target: /tmp</span><span class="diff-line context">     type: tmpfs</span><span class="diff-line del">-emby_docker_mounts_custom: []</span><span class="diff-line del">-emby_docker_mounts: &quot;{{ lookup(&#x27;vars&#x27;, emby_name + &#x27;_docker_mounts_default&#x27;, default=emby_docker_mounts_default)</span><span class="diff-line del">-                        + lookup(&#x27;vars&#x27;, emby_name + &#x27;_docker_mounts_custom&#x27;, default=emby_docker_mounts_custom) }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Devices</span><span class="diff-line del">-emby_docker_devices_default: []</span><span class="diff-line del">-emby_docker_devices_custom: []</span><span class="diff-line del">-emby_docker_devices: &quot;{{ lookup(&#x27;vars&#x27;, emby_name + &#x27;_docker_devices_default&#x27;, default=emby_docker_devices_default)</span><span class="diff-line del">-                         + lookup(&#x27;vars&#x27;, emby_name + &#x27;_docker_devices_custom&#x27;, default=emby_docker_devices_custom) }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Hosts</span><span class="diff-line del">-emby_docker_hosts_default: {}</span><span class="diff-line del">-emby_docker_hosts_custom: {}</span><span class="diff-line del">-emby_docker_hosts: &quot;{{ docker_hosts_common</span><span class="diff-line del">-                       | combine(lookup(&#x27;vars&#x27;, emby_name + &#x27;_docker_hosts_default&#x27;, default=emby_docker_hosts_default))</span><span class="diff-line del">-                       | combine(lookup(&#x27;vars&#x27;, emby_name + &#x27;_docker_hosts_custom&#x27;, default=emby_docker_hosts_custom)) }}&quot;</span><span class="diff-line add">+emby_role_docker_mounts_custom: []</span><span class="diff-line add">+emby_role_docker_mounts: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_mounts_default&#x27;, role=&#x27;emby&#x27;)</span><span class="diff-line add">+                             + lookup(&#x27;role_var&#x27;, &#x27;_docker_mounts_custom&#x27;, role=&#x27;emby&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Labels</span><span class="diff-line del">-emby_docker_labels_default: {}</span><span class="diff-line del">-emby_docker_labels_custom: {}</span><span class="diff-line del">-emby_docker_labels: &quot;{{ docker_labels_common</span><span class="diff-line del">-                        | combine(lookup(&#x27;vars&#x27;, emby_name + &#x27;_docker_labels_default&#x27;, default=emby_docker_labels_default))</span><span class="diff-line del">-                        | combine((traefik_themepark_labels</span><span class="diff-line del">-                                  if (emby_themepark_enabled and global_themepark_plugin_enabled)</span><span class="diff-line del">-                                  else {}),</span><span class="diff-line del">-                                  lookup(&#x27;vars&#x27;, emby_name + &#x27;_docker_labels_custom&#x27;, default=emby_docker_labels_custom)) }}&quot;</span><span class="diff-line add">+emby_role_docker_labels_default: {}</span><span class="diff-line add">+emby_role_docker_labels_custom: {}</span><span class="diff-line add">+emby_role_docker_labels: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_labels_default&#x27;, role=&#x27;emby&#x27;)</span><span class="diff-line add">+                             | combine((traefik_themepark_labels</span><span class="diff-line add">+                                       if (lookup(&#x27;role_var&#x27;, &#x27;_themepark_enabled&#x27;, role=&#x27;emby&#x27;) and global_themepark_plugin_enabled)</span><span class="diff-line add">+                                       else {}),</span><span class="diff-line add">+                                       lookup(&#x27;role_var&#x27;, &#x27;_docker_labels_custom&#x27;, role=&#x27;emby&#x27;)) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Hostname</span><span class="diff-line del">-emby_docker_hostname: &quot;{{ emby_name }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Network Mode</span><span class="diff-line del">-emby_docker_network_mode_default: &quot;{{ docker_networks_name_common }}&quot;</span><span class="diff-line del">-emby_docker_network_mode: &quot;{{ lookup(&#x27;vars&#x27;, emby_name + &#x27;_docker_network_mode_default&#x27;, default=emby_docker_network_mode_default) }}&quot;</span><span class="diff-line add">+emby_role_docker_hostname: &quot;{{ emby_name }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Networks</span><span class="diff-line del">-emby_docker_networks_alias: &quot;{{ emby_name }}&quot;</span><span class="diff-line del">-emby_docker_networks_default: []</span><span class="diff-line del">-emby_docker_networks_custom: []</span><span class="diff-line del">-emby_docker_networks: &quot;{{ docker_networks_common</span><span class="diff-line del">-                          + lookup(&#x27;vars&#x27;, emby_name + &#x27;_docker_networks_default&#x27;, default=emby_docker_networks_default)</span><span class="diff-line del">-                          + lookup(&#x27;vars&#x27;, emby_name + &#x27;_docker_networks_custom&#x27;, default=emby_docker_networks_custom) }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Capabilities</span><span class="diff-line del">-emby_docker_capabilities_default: []</span><span class="diff-line del">-emby_docker_capabilities_custom: []</span><span class="diff-line del">-emby_docker_capabilities: &quot;{{ lookup(&#x27;vars&#x27;, emby_name + &#x27;_docker_capabilities_default&#x27;, default=emby_docker_capabilities_default)</span><span class="diff-line del">-                              + lookup(&#x27;vars&#x27;, emby_name + &#x27;_docker_capabilities_custom&#x27;, default=emby_docker_capabilities_custom) }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Security Opts</span><span class="diff-line del">-emby_docker_security_opts_default: []</span><span class="diff-line del">-emby_docker_security_opts_custom: []</span><span class="diff-line del">-emby_docker_security_opts: &quot;{{ lookup(&#x27;vars&#x27;, emby_name + &#x27;_docker_security_opts_default&#x27;, default=emby_docker_security_opts_default)</span><span class="diff-line del">-                               + lookup(&#x27;vars&#x27;, emby_name + &#x27;_docker_security_opts_custom&#x27;, default=emby_docker_security_opts_custom) }}&quot;</span><span class="diff-line add">+emby_role_docker_networks_alias: &quot;{{ emby_name }}&quot;</span><span class="diff-line add">+emby_role_docker_networks_default: []</span><span class="diff-line add">+emby_role_docker_networks_custom: []</span><span class="diff-line add">+emby_role_docker_networks: &quot;{{ docker_networks_common</span><span class="diff-line add">+                               + lookup(&#x27;role_var&#x27;, &#x27;_docker_networks_default&#x27;, role=&#x27;emby&#x27;)</span><span class="diff-line add">+                               + lookup(&#x27;role_var&#x27;, &#x27;_docker_networks_custom&#x27;, role=&#x27;emby&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Restart Policy</span><span class="diff-line del">-emby_docker_restart_policy: unless-stopped</span><span class="diff-line add">+emby_role_docker_restart_policy: unless-stopped</span><span class="diff-line context"> </span><span class="diff-line context"> # State</span><span class="diff-line del">-emby_docker_state: started</span><span class="diff-line add">+emby_role_docker_state: started</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-182">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/emby/tasks/main2.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -10,9 +10,9 @@</span><span class="diff-line context"> - name: Add DNS record</span><span class="diff-line context">   ansible.builtin.include_tasks: &quot;{{ resources_tasks_path }}/dns/tasker.yml&quot;</span><span class="diff-line context">   vars:</span><span class="diff-line del">-    dns_record: &quot;{{ lookup(&#x27;vars&#x27;, role_name + &#x27;_dns_record&#x27;) }}&quot;</span><span class="diff-line del">-    dns_zone: &quot;{{ lookup(&#x27;vars&#x27;, role_name + &#x27;_dns_zone&#x27;) }}&quot;</span><span class="diff-line del">-    dns_proxy: &quot;{{ lookup(&#x27;vars&#x27;, role_name + &#x27;_dns_proxy&#x27;) }}&quot;</span><span class="diff-line add">+    dns_record: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_dns_record&#x27;) }}&quot;</span><span class="diff-line add">+    dns_zone: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_dns_zone&#x27;) }}&quot;</span><span class="diff-line add">+    dns_proxy: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_dns_proxy&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Remove existing Docker container</span><span class="diff-line context">   ansible.builtin.include_tasks: &quot;{{ resources_tasks_path }}/docker/remove_docker_container.yml&quot;</span><span class="diff-line hunk">@@ -22,10 +22,10 @@</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Docker Devices Task</span><span class="diff-line context">   ansible.builtin.include_tasks: &quot;{{ resources_tasks_path }}/docker/set_docker_devices_variable.yml&quot;</span><span class="diff-line del">-  when: gpu.intel or use_nvidia</span><span class="diff-line add">+  when: use_intel or use_nvidia</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Create Docker container</span><span class="diff-line context">   ansible.builtin.include_tasks: &quot;{{ resources_tasks_path }}/docker/create_docker_container.yml&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Post-Install Tasks</span><span class="diff-line del">-  ansible.builtin.import_tasks: &quot;subtasks/post-install.yml&quot;</span><span class="diff-line add">+  ansible.builtin.include_tasks: &quot;subtasks/post-install.yml&quot;</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-183">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/emby/tasks/subtasks/post-install.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -13,7 +13,7 @@</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Post-Install | Ensure transcodes folder has the correct permissions</span><span class="diff-line context">   ansible.builtin.file:</span><span class="diff-line del">-    path: &quot;{{ emby_paths_transcodes_location }}&quot;</span><span class="diff-line add">+    path: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_transcodes_location&#x27;, role=&#x27;emby&#x27;) }}&quot;</span><span class="diff-line context">     owner: &quot;{{ user.name }}&quot;</span><span class="diff-line context">     group: &quot;{{ user.name }}&quot;</span><span class="diff-line context">     mode: &quot;0775&quot;</span><span class="diff-line hunk">@@ -22,11 +22,11 @@</span><span class="diff-line context"> - name: Post-Install | Import &#x27;dlna.xml&#x27;</span><span class="diff-line context">   ansible.builtin.copy:</span><span class="diff-line context">     src: &quot;dlna.xml&quot;</span><span class="diff-line del">-    dest: &quot;{{ emby_paths_dlna_xml_location }}&quot;</span><span class="diff-line add">+    dest: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_dlna_xml_location&#x27;, role=&#x27;emby&#x27;) }}&quot;</span><span class="diff-line context">     owner: &quot;{{ user.name }}&quot;</span><span class="diff-line context">     group: &quot;{{ user.name }}&quot;</span><span class="diff-line context">     mode: &quot;0664&quot;</span><span class="diff-line context">     force: false</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Post-Install | Settings Tasks</span><span class="diff-line del">-  ansible.builtin.import_tasks: &quot;settings.yml&quot;</span><span class="diff-line add">+  ansible.builtin.include_tasks: &quot;subtasks/settings.yml&quot;</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-184">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/emby/tasks/subtasks/settings.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -9,7 +9,7 @@</span><span class="diff-line context"> ---</span><span class="diff-line context"> - name: Post-Install | Wait for config file to be created</span><span class="diff-line context">   ansible.builtin.wait_for:</span><span class="diff-line del">-    path: &quot;{{ emby_paths_config_location }}&quot;</span><span class="diff-line add">+    path: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_config_location&#x27;, role=&#x27;emby&#x27;) }}&quot;</span><span class="diff-line context">     state: present</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Settings | Stop Docker container</span><span class="diff-line hunk">@@ -17,12 +17,12 @@</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Settings | Update config file</span><span class="diff-line context">   community.general.xml:</span><span class="diff-line del">-    path: &quot;{{ emby_paths_config_location }}&quot;</span><span class="diff-line add">+    path: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_config_location&#x27;, role=&#x27;emby&#x27;) }}&quot;</span><span class="diff-line context">     xpath: &quot;/ServerConfiguration/{{ item.xpath }}&quot;</span><span class="diff-line context">     value: &quot;{{ item.value }}&quot;</span><span class="diff-line context">   become: true</span><span class="diff-line context">   become_user: &quot;{{ user.name }}&quot;</span><span class="diff-line del">-  loop: &quot;{{ emby_config_settings_list }}&quot;</span><span class="diff-line add">+  loop: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_config_settings_list&#x27;, role=&#x27;emby&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Settings | Start Docker container</span><span class="diff-line context">   ansible.builtin.include_tasks: &quot;{{ resources_tasks_path }}/docker/start_docker_container.yml&quot;</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-185">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/error_pages/defaults/main.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -18,61 +18,37 @@</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line context"> # Template options listed here https://github.com/tarampampam/error-pages</span><span class="diff-line del">-error_pages_template: &quot;l7&quot;</span><span class="diff-line add">+error_pages_role_template: &quot;l7&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # Docker</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line context"> # Container</span><span class="diff-line del">-error_pages_docker_container: &quot;{{ error_pages_name }}&quot;</span><span class="diff-line add">+error_pages_role_docker_container: &quot;{{ error_pages_name }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Image</span><span class="diff-line del">-error_pages_docker_image_pull: true</span><span class="diff-line del">-error_pages_docker_image_tag: &quot;latest&quot;</span><span class="diff-line del">-error_pages_docker_image: &quot;tarampampam/error-pages:{{ error_pages_docker_image_tag }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Ports</span><span class="diff-line del">-error_pages_docker_ports_defaults: []</span><span class="diff-line del">-error_pages_docker_ports_custom: []</span><span class="diff-line del">-error_pages_docker_ports: &quot;{{ error_pages_docker_ports_defaults</span><span class="diff-line del">-                              + error_pages_docker_ports_custom }}&quot;</span><span class="diff-line add">+error_pages_role_docker_image_pull: true</span><span class="diff-line add">+error_pages_role_docker_image_repo: &quot;tarampampam/error-pages&quot;</span><span class="diff-line add">+error_pages_role_docker_image_tag: &quot;latest&quot;</span><span class="diff-line add">+error_pages_role_docker_image: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_image_repo&#x27;, role=&#x27;error_pages&#x27;) }}:{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_image_tag&#x27;, role=&#x27;error_pages&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Envs</span><span class="diff-line del">-error_pages_docker_envs_default:</span><span class="diff-line del">-  TEMPLATE_NAME: &quot;{{ error_pages_template }}&quot;</span><span class="diff-line del">-error_pages_docker_envs_custom: {}</span><span class="diff-line del">-error_pages_docker_envs: &quot;{{ error_pages_docker_envs_default</span><span class="diff-line del">-                             | combine(error_pages_docker_envs_custom) }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Commands</span><span class="diff-line del">-error_pages_docker_commands_default: []</span><span class="diff-line del">-error_pages_docker_commands_custom: []</span><span class="diff-line del">-error_pages_docker_commands: &quot;{{ error_pages_docker_commands_default</span><span class="diff-line del">-                                 + error_pages_docker_commands_custom }}&quot;</span><span class="diff-line add">+error_pages_role_docker_envs_default:</span><span class="diff-line add">+  TEMPLATE_NAME: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_template&#x27;, role=&#x27;error_pages&#x27;) }}&quot;</span><span class="diff-line add">+error_pages_role_docker_envs_custom: {}</span><span class="diff-line add">+error_pages_role_docker_envs: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_envs_default&#x27;, role=&#x27;error_pages&#x27;)</span><span class="diff-line add">+                                  | combine(lookup(&#x27;role_var&#x27;, &#x27;_docker_envs_custom&#x27;, role=&#x27;error_pages&#x27;)) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Volumes</span><span class="diff-line del">-error_pages_docker_volumes_default:</span><span class="diff-line del">-  - &quot;/opt/error-pages:/opt/html&quot;</span><span class="diff-line del">-error_pages_docker_volumes_custom: []</span><span class="diff-line del">-error_pages_docker_volumes: &quot;{{ error_pages_docker_volumes_default</span><span class="diff-line del">-                                + error_pages_docker_volumes_custom }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Devices</span><span class="diff-line del">-error_pages_docker_devices_default: []</span><span class="diff-line del">-error_pages_docker_devices_custom: []</span><span class="diff-line del">-error_pages_docker_devices: &quot;{{ error_pages_docker_devices_default</span><span class="diff-line del">-                                + error_pages_docker_devices_custom }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Hosts</span><span class="diff-line del">-error_pages_docker_hosts_default: {}</span><span class="diff-line del">-error_pages_docker_hosts_custom: {}</span><span class="diff-line del">-error_pages_docker_hosts: &quot;{{ docker_hosts_common</span><span class="diff-line del">-                              | combine(error_pages_docker_hosts_default)</span><span class="diff-line del">-                              | combine(error_pages_docker_hosts_custom) }}&quot;</span><span class="diff-line add">+error_pages_role_docker_volumes_default:</span><span class="diff-line add">+  - &quot;{{ server_appdata_path }}/error-pages:/opt/html&quot;</span><span class="diff-line add">+error_pages_role_docker_volumes_custom: []</span><span class="diff-line add">+error_pages_role_docker_volumes: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_volumes_default&#x27;, role=&#x27;error_pages&#x27;)</span><span class="diff-line add">+                                     + lookup(&#x27;role_var&#x27;, &#x27;_docker_volumes_custom&#x27;, role=&#x27;error_pages&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Labels</span><span class="diff-line del">-error_pages_docker_labels_default:</span><span class="diff-line add">+error_pages_role_docker_labels_default:</span><span class="diff-line context">   traefik.enable: &quot;true&quot;</span><span class="diff-line context">   traefik.http.routers.error-pages-router.rule: &quot;PathPrefix(`/`)&quot;</span><span class="diff-line context">   traefik.http.routers.error-pages-router.priority: &quot;5&quot;</span><span class="diff-line hunk">@@ -82,36 +58,23 @@</span><span class="diff-line context">   traefik.http.middlewares.error-pages-middleware.errors.service: &quot;error-pages-service&quot;</span><span class="diff-line context">   traefik.http.middlewares.error-pages-middleware.errors.query: &quot;/{status}.html&quot;</span><span class="diff-line context">   traefik.http.services.error-pages-service.loadbalancer.server.port: &quot;8080&quot;</span><span class="diff-line del">-error_pages_docker_labels_custom: {}</span><span class="diff-line del">-error_pages_docker_labels: &quot;{{ docker_labels_common</span><span class="diff-line del">-                               | combine(error_pages_docker_labels_default)</span><span class="diff-line del">-                               | combine(error_pages_docker_labels_custom) }}&quot;</span><span class="diff-line add">+error_pages_role_docker_labels_custom: {}</span><span class="diff-line add">+error_pages_role_docker_labels: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_labels_default&#x27;, role=&#x27;error_pages&#x27;)</span><span class="diff-line add">+                                    | combine(lookup(&#x27;role_var&#x27;, &#x27;_docker_labels_custom&#x27;, role=&#x27;error_pages&#x27;)) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Hostname</span><span class="diff-line del">-error_pages_docker_hostname: &quot;{{ error_pages_name }}&quot;</span><span class="diff-line add">+error_pages_role_docker_hostname: &quot;{{ error_pages_name }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Networks</span><span class="diff-line del">-error_pages_docker_networks_alias: &quot;{{ error_pages_name }}&quot;</span><span class="diff-line del">-error_pages_docker_networks_default: []</span><span class="diff-line del">-error_pages_docker_networks_custom: []</span><span class="diff-line del">-error_pages_docker_networks: &quot;{{ docker_networks_common</span><span class="diff-line del">-                                 + error_pages_docker_networks_default</span><span class="diff-line del">-                                 + error_pages_docker_networks_custom }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Capabilities</span><span class="diff-line del">-error_pages_docker_capabilities_default: []</span><span class="diff-line del">-error_pages_docker_capabilities_custom: []</span><span class="diff-line del">-error_pages_docker_capabilities: &quot;{{ error_pages_docker_capabilities_default</span><span class="diff-line del">-                                     + error_pages_docker_capabilities_custom }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Security Opts</span><span class="diff-line del">-error_pages_docker_security_opts_default: []</span><span class="diff-line del">-error_pages_docker_security_opts_custom: []</span><span class="diff-line del">-error_pages_docker_security_opts: &quot;{{ error_pages_docker_security_opts_default</span><span class="diff-line del">-                                      + error_pages_docker_security_opts_custom }}&quot;</span><span class="diff-line add">+error_pages_role_docker_networks_alias: &quot;{{ error_pages_name }}&quot;</span><span class="diff-line add">+error_pages_role_docker_networks_default: []</span><span class="diff-line add">+error_pages_role_docker_networks_custom: []</span><span class="diff-line add">+error_pages_role_docker_networks: &quot;{{ docker_networks_common</span><span class="diff-line add">+                                      + lookup(&#x27;role_var&#x27;, &#x27;_docker_networks_default&#x27;, role=&#x27;error_pages&#x27;)</span><span class="diff-line add">+                                      + lookup(&#x27;role_var&#x27;, &#x27;_docker_networks_custom&#x27;, role=&#x27;error_pages&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Restart Policy</span><span class="diff-line del">-error_pages_docker_restart_policy: unless-stopped</span><span class="diff-line add">+error_pages_role_docker_restart_policy: unless-stopped</span><span class="diff-line context"> </span><span class="diff-line context"> # State</span><span class="diff-line del">-error_pages_docker_state: started</span><span class="diff-line add">+error_pages_role_docker_state: started</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-186">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/error_pages/tasks/main.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -9,13 +9,13 @@</span><span class="diff-line context"> ---</span><span class="diff-line context"> - name: Check if legacy folder exists</span><span class="diff-line context">   ansible.builtin.stat:</span><span class="diff-line del">-    path: &quot;/opt/error_pages&quot;</span><span class="diff-line add">+    path: &quot;{{ server_appdata_path }}/error_pages&quot;</span><span class="diff-line context">   register: error_pages_legacy_folder</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Migrate error pages directory</span><span class="diff-line context">   migrate_folder:</span><span class="diff-line del">-    legacy_path: /opt/error_pages</span><span class="diff-line del">-    new_path: /opt/error-pages</span><span class="diff-line add">+    legacy_path: &quot;{{ server_appdata_path }}/error_pages&quot;</span><span class="diff-line add">+    new_path: &quot;{{ server_appdata_path }}/error-pages&quot;</span><span class="diff-line context">     owner: &quot;{{ user.name }}&quot;</span><span class="diff-line context">     group: &quot;{{ user.name }}&quot;</span><span class="diff-line context">     mode: &#x27;0775&#x27;</span><span class="diff-line hunk">@@ -24,12 +24,12 @@</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Check if folder already exists</span><span class="diff-line context">   ansible.builtin.stat:</span><span class="diff-line del">-    path: &quot;/opt/error-pages&quot;</span><span class="diff-line add">+    path: &quot;{{ server_appdata_path }}/error-pages&quot;</span><span class="diff-line context">   register: error_pages_folder</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Create directory</span><span class="diff-line context">   ansible.builtin.file:</span><span class="diff-line del">-    path: &quot;/opt/error-pages&quot;</span><span class="diff-line add">+    path: &quot;{{ server_appdata_path }}/error-pages&quot;</span><span class="diff-line context">     state: directory</span><span class="diff-line context">     owner: &quot;{{ user.name }}&quot;</span><span class="diff-line context">     group: &quot;{{ user.name }}&quot;</span><span class="diff-line hunk">@@ -43,12 +43,12 @@</span><span class="diff-line context">     user: &quot;{{ uid }}:{{ gid }}&quot;</span><span class="diff-line context">     command: &quot;build --config-file ./error-pages.yml /out&quot;</span><span class="diff-line context">     volumes:</span><span class="diff-line del">-      - &quot;/opt/error-pages:/out:rw&quot;</span><span class="diff-line add">+      - &quot;{{ server_appdata_path }}/error-pages:/out:rw&quot;</span><span class="diff-line context">     networks:</span><span class="diff-line context">       - name: saltbox</span><span class="diff-line context">     container_default_behavior: compatibility</span><span class="diff-line context">     tls_hostname: localhost</span><span class="diff-line del">-    auto_remove: yes</span><span class="diff-line add">+    auto_remove: true</span><span class="diff-line context">     state: started</span><span class="diff-line context">     pull: true</span><span class="diff-line context">   when: (not error_pages_folder.stat.exists)</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-187">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/glances/tasks/main.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -17,13 +17,6 @@</span><span class="diff-line context">     glances_python: &quot;3.12&quot;</span><span class="diff-line context">     glances_path: &quot;/srv/glances&quot;</span><span class="diff-line context">     glances_venv_path: &quot;/srv/glances/venv&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-- name: &quot;Execute Python role&quot;</span><span class="diff-line del">-  ansible.builtin.include_role:</span><span class="diff-line del">-    name: &quot;python&quot;</span><span class="diff-line del">-  vars:</span><span class="diff-line del">-    python_version: &quot;3.10&quot;</span><span class="diff-line del">-  when: ansible_distribution_version is version(&#x27;22.04&#x27;, &#x27;!=&#x27;)</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Delete venv folder</span><span class="diff-line context">   ansible.builtin.file:</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-188">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/gluetun/defaults/main.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -1,10 +1,10 @@</span><span class="diff-line context"> ##########################################################################</span><span class="diff-line del">-# Title:            Sandbox: Gluetun | Default Variables                 #</span><span class="diff-line del">-# Author(s):        owine                                                #</span><span class="diff-line del">-# URL:              https://github.com/saltyorg/Sandbox                  #</span><span class="diff-line del">-# --                                                                     #</span><span class="diff-line add">+# Title:         Saltbox: Gluetun | Default Variables                    #</span><span class="diff-line add">+# Author(s):     owine                                                  #</span><span class="diff-line add">+# URL:           https://github.com/saltyorg/Saltbox                    #</span><span class="diff-line add">+# --                                                                    #</span><span class="diff-line context"> ##########################################################################</span><span class="diff-line del">-#                   GNU General Public License v3.0                      #</span><span class="diff-line add">+#                   GNU General Public License v3.0                     #</span><span class="diff-line context"> ##########################################################################</span><span class="diff-line context"> ---</span><span class="diff-line context"> ################################</span><span class="diff-line hunk">@@ -16,162 +16,130 @@</span><span class="diff-line context"> ################################</span><span class="diff-line context"> # Settings</span><span class="diff-line context"> ################################</span><span class="diff-line add">+</span><span class="diff-line context"> # These variables map to the appropriate Docker ENVs</span><span class="diff-line context"> # Review the gluetun wiki (https://github.com/qdm12/gluetun/wiki)</span><span class="diff-line del">-gluetun_vpn_service_provider: &quot;&quot;</span><span class="diff-line del">-gluetun_vpn_type: &quot;&quot;</span><span class="diff-line del">-gluetun_openvpn_custom_config: &quot;&quot;</span><span class="diff-line del">-gluetun_openvpn_endpoint_ip: &quot;&quot;</span><span class="diff-line del">-gluetun_openvpn_endpoint_port: &quot;&quot;</span><span class="diff-line del">-gluetun_openvpn_user: &quot;&quot;</span><span class="diff-line del">-gluetun_openvpn_password: &quot;&quot;</span><span class="diff-line del">-gluetun_openvpn_key_passphrase: &quot;&quot;</span><span class="diff-line del">-gluetun_vpn_endpoint_ip: &quot;&quot;</span><span class="diff-line del">-gluetun_vpn_endpoint_port: &quot;&quot;</span><span class="diff-line del">-gluetun_wireguard_endpoint_ip: &quot;&quot;</span><span class="diff-line del">-gluetun_wireguard_endpoint_port: &quot;&quot;</span><span class="diff-line del">-gluetun_wireguard_mtu: &quot;&quot;</span><span class="diff-line del">-gluetun_wireguard_public_key: &quot;&quot;</span><span class="diff-line del">-gluetun_wireguard_private_key: &quot;&quot;</span><span class="diff-line del">-gluetun_wireguard_preshared_key: &quot;&quot;</span><span class="diff-line del">-gluetun_wireguard_addresses: &quot;&quot;</span><span class="diff-line del">-gluetun_server_countries: &quot;&quot;</span><span class="diff-line del">-gluetun_server_cities: &quot;&quot;</span><span class="diff-line del">-gluetun_server_hostnames: &quot;&quot;</span><span class="diff-line del">-gluetun_server_names: &quot;&quot;</span><span class="diff-line del">-gluetun_server_regions: &quot;&quot;</span><span class="diff-line del">-gluetun_firewall_vpn_input_ports: &quot;&quot;</span><span class="diff-line del">-gluetun_firewall_input_ports: &quot;&quot;</span><span class="diff-line del">-gluetun_firewall_outbound_subnets: &quot;&quot;</span><span class="diff-line del">-gluetun_docker_resolver: true</span><span class="diff-line add">+gluetun_role_vpn_service_provider: &quot;&quot;</span><span class="diff-line add">+gluetun_role_vpn_type: &quot;&quot;</span><span class="diff-line add">+gluetun_role_openvpn_custom_config: &quot;&quot;</span><span class="diff-line add">+gluetun_role_openvpn_endpoint_ip: &quot;&quot;</span><span class="diff-line add">+gluetun_role_openvpn_endpoint_port: &quot;&quot;</span><span class="diff-line add">+gluetun_role_openvpn_user: &quot;&quot;</span><span class="diff-line add">+gluetun_role_openvpn_password: &quot;&quot;</span><span class="diff-line add">+gluetun_role_openvpn_key_passphrase: &quot;&quot;</span><span class="diff-line add">+gluetun_role_vpn_endpoint_ip: &quot;&quot;</span><span class="diff-line add">+gluetun_role_vpn_endpoint_port: &quot;&quot;</span><span class="diff-line add">+gluetun_role_wireguard_endpoint_ip: &quot;&quot;</span><span class="diff-line add">+gluetun_role_wireguard_endpoint_port: &quot;&quot;</span><span class="diff-line add">+gluetun_role_wireguard_mtu: &quot;&quot;</span><span class="diff-line add">+gluetun_role_wireguard_public_key: &quot;&quot;</span><span class="diff-line add">+gluetun_role_wireguard_private_key: &quot;&quot;</span><span class="diff-line add">+gluetun_role_wireguard_preshared_key: &quot;&quot;</span><span class="diff-line add">+gluetun_role_wireguard_addresses: &quot;&quot;</span><span class="diff-line add">+gluetun_role_server_countries: &quot;&quot;</span><span class="diff-line add">+gluetun_role_server_cities: &quot;&quot;</span><span class="diff-line add">+gluetun_role_server_hostnames: &quot;&quot;</span><span class="diff-line add">+gluetun_role_server_names: &quot;&quot;</span><span class="diff-line add">+gluetun_role_server_regions: &quot;&quot;</span><span class="diff-line add">+gluetun_role_firewall_vpn_input_ports: &quot;&quot;</span><span class="diff-line add">+gluetun_role_firewall_input_ports: &quot;&quot;</span><span class="diff-line add">+gluetun_role_firewall_outbound_subnets: &quot;&quot;</span><span class="diff-line add">+gluetun_role_docker_resolver: true</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # Paths</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-gluetun_paths_folder: &quot;{{ gluetun_name }}&quot;</span><span class="diff-line del">-gluetun_paths_location: &quot;{{ server_appdata_path }}/{{ gluetun_paths_folder }}&quot;</span><span class="diff-line del">-gluetun_paths_folders_list:</span><span class="diff-line del">-  - &quot;{{ gluetun_paths_location }}&quot;</span><span class="diff-line add">+gluetun_role_paths_folder: &quot;{{ gluetun_name }}&quot;</span><span class="diff-line add">+gluetun_role_paths_location: &quot;{{ server_appdata_path }}/{{ gluetun_role_paths_folder }}&quot;</span><span class="diff-line add">+gluetun_role_paths_folders_list:</span><span class="diff-line add">+  - &quot;{{ gluetun_role_paths_location }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # Docker</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line context"> # Container</span><span class="diff-line del">-gluetun_docker_container: &quot;{{ gluetun_name }}&quot;</span><span class="diff-line add">+gluetun_role_docker_container: &quot;{{ gluetun_name }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Image</span><span class="diff-line del">-gluetun_docker_image_pull: true</span><span class="diff-line del">-gluetun_docker_image_repo: &quot;qmcgaw/gluetun&quot;</span><span class="diff-line del">-gluetun_docker_image_tag: &quot;v3&quot;</span><span class="diff-line del">-gluetun_docker_image: &quot;{{ lookup(&#x27;vars&#x27;, gluetun_name + &#x27;_docker_image_repo&#x27;, default=gluetun_docker_image_repo)</span><span class="diff-line del">-                          + &#x27;:&#x27; + lookup(&#x27;vars&#x27;, gluetun_name + &#x27;_docker_image_tag&#x27;, default=gluetun_docker_image_tag) }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Ports</span><span class="diff-line del">-gluetun_docker_ports_defaults: []</span><span class="diff-line del">-gluetun_docker_ports_custom: []</span><span class="diff-line del">-gluetun_docker_ports: &quot;{{ lookup(&#x27;vars&#x27;, gluetun_name + &#x27;_docker_ports_defaults&#x27;, default=gluetun_docker_ports_defaults)</span><span class="diff-line del">-                          + lookup(&#x27;vars&#x27;, gluetun_name + &#x27;_docker_ports_custom&#x27;, default=gluetun_docker_ports_custom) }}&quot;</span><span class="diff-line add">+gluetun_role_docker_image_pull: true</span><span class="diff-line add">+gluetun_role_docker_image_repo: &quot;qmcgaw/gluetun&quot;</span><span class="diff-line add">+gluetun_role_docker_image_tag: &quot;v3&quot;</span><span class="diff-line add">+gluetun_role_docker_image: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_image_repo&#x27;, role=&#x27;gluetun&#x27;) }}:{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_image_tag&#x27;, role=&#x27;gluetun&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Envs</span><span class="diff-line del">-gluetun_docker_envs_default:</span><span class="diff-line del">-  DNS_KEEP_NAMESERVER: &quot;{{ &#x27;on&#x27; if lookup(&#x27;vars&#x27;, gluetun_name + &#x27;_docker_resolver&#x27;, default=gluetun_docker_resolver) else &#x27;off&#x27; }}&quot;</span><span class="diff-line del">-  FIREWALL_INPUT_PORTS: &quot;{{ lookup(&#x27;vars&#x27;, gluetun_name + &#x27;_firewall_input_ports&#x27;, default=&#x27;&#x27;) if (lookup(&#x27;vars&#x27;, gluetun_name + &#x27;_firewall_input_ports&#x27;, default=&#x27;&#x27;) | length &gt; 0) else omit }}&quot;</span><span class="diff-line del">-  FIREWALL_OUTBOUND_SUBNETS: &quot;{{ lookup(&#x27;vars&#x27;, gluetun_name + &#x27;_firewall_outbound_subnets&#x27;, default=&#x27;&#x27;) if (lookup(&#x27;vars&#x27;, gluetun_name + &#x27;_firewall_outbound_subnets&#x27;, default=&#x27;&#x27;) | length &gt; 0) else omit }}&quot;</span><span class="diff-line del">-  FIREWALL_VPN_INPUT_PORTS: &quot;{{ lookup(&#x27;vars&#x27;, gluetun_name + &#x27;_firewall_vpn_input_ports&#x27;, default=&#x27;&#x27;) if (lookup(&#x27;vars&#x27;, gluetun_name + &#x27;_firewall_vpn_input_ports&#x27;, default=&#x27;&#x27;) | length &gt; 0) else omit }}&quot;</span><span class="diff-line add">+gluetun_role_docker_envs_default:</span><span class="diff-line add">+  DNS_KEEP_NAMESERVER: &quot;{{ &#x27;on&#x27; if lookup(&#x27;role_var&#x27;, &#x27;_docker_resolver&#x27;, role=&#x27;gluetun&#x27;) else &#x27;off&#x27; }}&quot;</span><span class="diff-line add">+  FIREWALL_INPUT_PORTS: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_firewall_input_ports&#x27;, role=&#x27;gluetun&#x27;) if (lookup(&#x27;role_var&#x27;, &#x27;_firewall_input_ports&#x27;, role=&#x27;gluetun&#x27;) | length &gt; 0) else omit }}&quot;</span><span class="diff-line add">+  FIREWALL_OUTBOUND_SUBNETS: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_firewall_outbound_subnets&#x27;, role=&#x27;gluetun&#x27;) if (lookup(&#x27;role_var&#x27;, &#x27;_firewall_outbound_subnets&#x27;, role=&#x27;gluetun&#x27;) | length &gt; 0) else omit }}&quot;</span><span class="diff-line add">+  FIREWALL_VPN_INPUT_PORTS: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_firewall_vpn_input_ports&#x27;, role=&#x27;gluetun&#x27;) if (lookup(&#x27;role_var&#x27;, &#x27;_firewall_vpn_input_ports&#x27;, role=&#x27;gluetun&#x27;) | length &gt; 0) else omit }}&quot;</span><span class="diff-line context">   HTTPPROXY: &quot;on&quot;</span><span class="diff-line context">   HTTPPROXY_STEALTH: &quot;on&quot;</span><span class="diff-line del">-  OPENVPN_CUSTOM_CONFIG: &quot;{{ lookup(&#x27;vars&#x27;, gluetun_name + &#x27;_openvpn_custom_config&#x27;, default=&#x27;&#x27;) if (lookup(&#x27;vars&#x27;, gluetun_name + &#x27;_openvpn_custom_config&#x27;, default=&#x27;&#x27;) | length &gt; 0) else omit }}&quot;</span><span class="diff-line del">-  OPENVPN_ENDPOINT_IP: &quot;{{ lookup(&#x27;vars&#x27;, gluetun_name + &#x27;_openvpn_endpoint_ip&#x27;, default=&#x27;&#x27;) if (lookup(&#x27;vars&#x27;, gluetun_name + &#x27;_openvpn_endpoint_ip&#x27;, default=&#x27;&#x27;) | length &gt; 0) else omit }}&quot;</span><span class="diff-line del">-  OPENVPN_ENDPOINT_PORT: &quot;{{ lookup(&#x27;vars&#x27;, gluetun_name + &#x27;_openvpn_endpoint_port&#x27;, default=&#x27;&#x27;) if (lookup(&#x27;vars&#x27;, gluetun_name + &#x27;_openvpn_endpoint_port&#x27;, default=&#x27;&#x27;) | length &gt; 0) else omit }}&quot;</span><span class="diff-line del">-  OPENVPN_KEY_PASSPHRASE: &quot;{{ lookup(&#x27;vars&#x27;, gluetun_name + &#x27;_openvpn_key_passphrase&#x27;, default=&#x27;&#x27;) if (lookup(&#x27;vars&#x27;, gluetun_name + &#x27;_openvpn_key_passphrase&#x27;, default=&#x27;&#x27;) | length &gt; 0) else omit }}&quot;</span><span class="diff-line del">-  OPENVPN_PASSWORD: &quot;{{ lookup(&#x27;vars&#x27;, gluetun_name + &#x27;_openvpn_password&#x27;, default=&#x27;&#x27;) if (lookup(&#x27;vars&#x27;, gluetun_name + &#x27;_openvpn_password&#x27;, default=&#x27;&#x27;) | length &gt; 0) else omit }}&quot;</span><span class="diff-line del">-  OPENVPN_USER: &quot;{{ lookup(&#x27;vars&#x27;, gluetun_name + &#x27;_openvpn_user&#x27;, default=&#x27;&#x27;) if (lookup(&#x27;vars&#x27;, gluetun_name + &#x27;_openvpn_user&#x27;, default=&#x27;&#x27;) | length &gt; 0) else omit }}&quot;</span><span class="diff-line add">+  OPENVPN_CUSTOM_CONFIG: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_openvpn_custom_config&#x27;, role=&#x27;gluetun&#x27;) if (lookup(&#x27;role_var&#x27;, &#x27;_openvpn_custom_config&#x27;, role=&#x27;gluetun&#x27;) | length &gt; 0) else omit }}&quot;</span><span class="diff-line add">+  OPENVPN_ENDPOINT_IP: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_openvpn_endpoint_ip&#x27;, role=&#x27;gluetun&#x27;) if (lookup(&#x27;role_var&#x27;, &#x27;_openvpn_endpoint_ip&#x27;, role=&#x27;gluetun&#x27;) | length &gt; 0) else omit }}&quot;</span><span class="diff-line add">+  OPENVPN_ENDPOINT_PORT: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_openvpn_endpoint_port&#x27;, role=&#x27;gluetun&#x27;) if (lookup(&#x27;role_var&#x27;, &#x27;_openvpn_endpoint_port&#x27;, role=&#x27;gluetun&#x27;) | length &gt; 0) else omit }}&quot;</span><span class="diff-line add">+  OPENVPN_KEY_PASSPHRASE: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_openvpn_key_passphrase&#x27;, role=&#x27;gluetun&#x27;) if (lookup(&#x27;role_var&#x27;, &#x27;_openvpn_key_passphrase&#x27;, role=&#x27;gluetun&#x27;) | length &gt; 0) else omit }}&quot;</span><span class="diff-line add">+  OPENVPN_PASSWORD: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_openvpn_password&#x27;, role=&#x27;gluetun&#x27;) if (lookup(&#x27;role_var&#x27;, &#x27;_openvpn_password&#x27;, role=&#x27;gluetun&#x27;) | length &gt; 0) else omit }}&quot;</span><span class="diff-line add">+  OPENVPN_USER: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_openvpn_user&#x27;, role=&#x27;gluetun&#x27;) if (lookup(&#x27;role_var&#x27;, &#x27;_openvpn_user&#x27;, role=&#x27;gluetun&#x27;) | length &gt; 0) else omit }}&quot;</span><span class="diff-line context">   PGID: &quot;{{ gid }}&quot;</span><span class="diff-line context">   PUID: &quot;{{ uid }}&quot;</span><span class="diff-line del">-  SERVER_CITIES: &quot;{{ lookup(&#x27;vars&#x27;, gluetun_name + &#x27;_server_cities&#x27;, default=&#x27;&#x27;) if (lookup(&#x27;vars&#x27;, gluetun_name + &#x27;_server_cities&#x27;, default=&#x27;&#x27;) | length &gt; 0) else omit }}&quot;</span><span class="diff-line del">-  SERVER_COUNTRIES: &quot;{{ lookup(&#x27;vars&#x27;, gluetun_name + &#x27;_server_countries&#x27;, default=&#x27;&#x27;) if (lookup(&#x27;vars&#x27;, gluetun_name + &#x27;_server_countries&#x27;, default=&#x27;&#x27;) | length &gt; 0) else omit }}&quot;</span><span class="diff-line del">-  SERVER_HOSTNAMES: &quot;{{ lookup(&#x27;vars&#x27;, gluetun_name + &#x27;_server_hostnames&#x27;, default=&#x27;&#x27;) if (lookup(&#x27;vars&#x27;, gluetun_name + &#x27;_server_hostnames&#x27;, default=&#x27;&#x27;) | length &gt; 0) else omit }}&quot;</span><span class="diff-line del">-  SERVER_NAMES: &quot;{{ lookup(&#x27;vars&#x27;, gluetun_name + &#x27;_server_names&#x27;, default=&#x27;&#x27;) if (lookup(&#x27;vars&#x27;, gluetun_name + &#x27;_server_names&#x27;, default=&#x27;&#x27;) | length &gt; 0) else omit }}&quot;</span><span class="diff-line del">-  SERVER_REGIONS: &quot;{{ lookup(&#x27;vars&#x27;, gluetun_name + &#x27;_server_regions&#x27;, default=&#x27;&#x27;) if (lookup(&#x27;vars&#x27;, gluetun_name + &#x27;_server_regions&#x27;, default=&#x27;&#x27;) | length &gt; 0) else omit }}&quot;</span><span class="diff-line add">+  SERVER_CITIES: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_server_cities&#x27;, role=&#x27;gluetun&#x27;) if (lookup(&#x27;role_var&#x27;, &#x27;_server_cities&#x27;, role=&#x27;gluetun&#x27;) | length &gt; 0) else omit }}&quot;</span><span class="diff-line add">+  SERVER_COUNTRIES: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_server_countries&#x27;, role=&#x27;gluetun&#x27;) if (lookup(&#x27;role_var&#x27;, &#x27;_server_countries&#x27;, role=&#x27;gluetun&#x27;) | length &gt; 0) else omit }}&quot;</span><span class="diff-line add">+  SERVER_HOSTNAMES: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_server_hostnames&#x27;, role=&#x27;gluetun&#x27;) if (lookup(&#x27;role_var&#x27;, &#x27;_server_hostnames&#x27;, role=&#x27;gluetun&#x27;) | length &gt; 0) else omit }}&quot;</span><span class="diff-line add">+  SERVER_NAMES: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_server_names&#x27;, role=&#x27;gluetun&#x27;) if (lookup(&#x27;role_var&#x27;, &#x27;_server_names&#x27;, role=&#x27;gluetun&#x27;) | length &gt; 0) else omit }}&quot;</span><span class="diff-line add">+  SERVER_REGIONS: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_server_regions&#x27;, role=&#x27;gluetun&#x27;) if (lookup(&#x27;role_var&#x27;, &#x27;_server_regions&#x27;, role=&#x27;gluetun&#x27;) | length &gt; 0) else omit }}&quot;</span><span class="diff-line context">   TZ: &quot;{{ tz }}&quot;</span><span class="diff-line del">-  VPN_ENDPOINT_IP: &quot;{{ lookup(&#x27;vars&#x27;, gluetun_name + &#x27;_vpn_endpoint_ip&#x27;, default=&#x27;&#x27;) if (lookup(&#x27;vars&#x27;, gluetun_name + &#x27;_vpn_endpoint_ip&#x27;, default=&#x27;&#x27;) | length &gt; 0) else omit }}&quot;</span><span class="diff-line del">-  VPN_ENDPOINT_PORT: &quot;{{ lookup(&#x27;vars&#x27;, gluetun_name + &#x27;_vpn_endpoint_port&#x27;, default=&#x27;&#x27;) if (lookup(&#x27;vars&#x27;, gluetun_name + &#x27;_vpn_endpoint_port&#x27;, default=&#x27;&#x27;) | length &gt; 0) else omit }}&quot;</span><span class="diff-line del">-  VPN_SERVICE_PROVIDER: &quot;{{ lookup(&#x27;vars&#x27;, gluetun_name + &#x27;_vpn_service_provider&#x27;, default=&#x27;&#x27;) if (lookup(&#x27;vars&#x27;, gluetun_name + &#x27;_vpn_service_provider&#x27;, default=&#x27;&#x27;) | length &gt; 0) else omit }}&quot;</span><span class="diff-line del">-  VPN_TYPE: &quot;{{ lookup(&#x27;vars&#x27;, gluetun_name + &#x27;_vpn_type&#x27;, default=&#x27;&#x27;) if (lookup(&#x27;vars&#x27;, gluetun_name + &#x27;_vpn_type&#x27;, default=&#x27;&#x27;) | length &gt; 0) else omit }}&quot;</span><span class="diff-line del">-  WIREGUARD_ADDRESSES: &quot;{{ lookup(&#x27;vars&#x27;, gluetun_name + &#x27;_wireguard_addresses&#x27;, default=&#x27;&#x27;) if (lookup(&#x27;vars&#x27;, gluetun_name + &#x27;_wireguard_addresses&#x27;, default=&#x27;&#x27;) | length &gt; 0) else omit }}&quot;</span><span class="diff-line del">-  WIREGUARD_ENDPOINT_IP: &quot;{{ lookup(&#x27;vars&#x27;, gluetun_name + &#x27;_wireguard_endpoint_ip&#x27;, default=&#x27;&#x27;) if (lookup(&#x27;vars&#x27;, gluetun_name + &#x27;_wireguard_endpoint_ip&#x27;, default=&#x27;&#x27;) | length &gt; 0) else omit }}&quot;</span><span class="diff-line del">-  WIREGUARD_ENDPOINT_PORT: &quot;{{ lookup(&#x27;vars&#x27;, gluetun_name + &#x27;_wireguard_endpoint_port&#x27;, default=&#x27;&#x27;) if (lookup(&#x27;vars&#x27;, gluetun_name + &#x27;_wireguard_endpoint_port&#x27;, default=&#x27;&#x27;) | length &gt; 0) else omit }}&quot;</span><span class="diff-line del">-  WIREGUARD_MTU: &quot;{{ lookup(&#x27;vars&#x27;, gluetun_name + &#x27;_wireguard_mtu&#x27;, default=&#x27;&#x27;) if (lookup(&#x27;vars&#x27;, gluetun_name + &#x27;_wireguard_mtu&#x27;, default=&#x27;&#x27;) | length &gt; 0) else omit }}&quot;</span><span class="diff-line del">-  WIREGUARD_PRESHARED_KEY: &quot;{{ lookup(&#x27;vars&#x27;, gluetun_name + &#x27;_wireguard_preshared_key&#x27;, default=&#x27;&#x27;) if (lookup(&#x27;vars&#x27;, gluetun_name + &#x27;_wireguard_preshared_key&#x27;, default=&#x27;&#x27;) | length &gt; 0) else omit }}&quot;</span><span class="diff-line del">-  WIREGUARD_PRIVATE_KEY: &quot;{{ lookup(&#x27;vars&#x27;, gluetun_name + &#x27;_wireguard_private_key&#x27;, default=&#x27;&#x27;) if (lookup(&#x27;vars&#x27;, gluetun_name + &#x27;_wireguard_private_key&#x27;, default=&#x27;&#x27;) | length &gt; 0) else omit }}&quot;</span><span class="diff-line del">-  WIREGUARD_PUBLIC_KEY: &quot;{{ lookup(&#x27;vars&#x27;, gluetun_name + &#x27;_wireguard_public_key&#x27;, default=&#x27;&#x27;) if (lookup(&#x27;vars&#x27;, gluetun_name + &#x27;_wireguard_public_key&#x27;, default=&#x27;&#x27;) | length &gt; 0) else omit }}&quot;</span><span class="diff-line del">-gluetun_docker_envs_custom: {}</span><span class="diff-line del">-gluetun_docker_envs: &quot;{{ lookup(&#x27;vars&#x27;, gluetun_name + &#x27;_docker_envs_default&#x27;, default=gluetun_docker_envs_default)</span><span class="diff-line del">-                         | combine(lookup(&#x27;vars&#x27;, gluetun_name + &#x27;_docker_envs_custom&#x27;, default=gluetun_docker_envs_custom)) }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Commands</span><span class="diff-line del">-gluetun_docker_commands_default: []</span><span class="diff-line del">-gluetun_docker_commands_custom: []</span><span class="diff-line del">-gluetun_docker_commands: &quot;{{ lookup(&#x27;vars&#x27;, gluetun_name + &#x27;_docker_commands_default&#x27;, default=gluetun_docker_commands_default)</span><span class="diff-line del">-                             + lookup(&#x27;vars&#x27;, gluetun_name + &#x27;_docker_commands_custom&#x27;, default=gluetun_docker_commands_custom) }}&quot;</span><span class="diff-line add">+  VPN_ENDPOINT_IP: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_vpn_endpoint_ip&#x27;, role=&#x27;gluetun&#x27;) if (lookup(&#x27;role_var&#x27;, &#x27;_vpn_endpoint_ip&#x27;, role=&#x27;gluetun&#x27;) | length &gt; 0) else omit }}&quot;</span><span class="diff-line add">+  VPN_ENDPOINT_PORT: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_vpn_endpoint_port&#x27;, role=&#x27;gluetun&#x27;) if (lookup(&#x27;role_var&#x27;, &#x27;_vpn_endpoint_port&#x27;, role=&#x27;gluetun&#x27;) | length &gt; 0) else omit }}&quot;</span><span class="diff-line add">+  VPN_SERVICE_PROVIDER: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_vpn_service_provider&#x27;, role=&#x27;gluetun&#x27;) if (lookup(&#x27;role_var&#x27;, &#x27;_vpn_service_provider&#x27;, role=&#x27;gluetun&#x27;) | length &gt; 0) else omit }}&quot;</span><span class="diff-line add">+  VPN_TYPE: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_vpn_type&#x27;, role=&#x27;gluetun&#x27;) if (lookup(&#x27;role_var&#x27;, &#x27;_vpn_type&#x27;, role=&#x27;gluetun&#x27;) | length &gt; 0) else omit }}&quot;</span><span class="diff-line add">+  WIREGUARD_ADDRESSES: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_wireguard_addresses&#x27;, role=&#x27;gluetun&#x27;) if (lookup(&#x27;role_var&#x27;, &#x27;_wireguard_addresses&#x27;, role=&#x27;gluetun&#x27;) | length &gt; 0) else omit }}&quot;</span><span class="diff-line add">+  WIREGUARD_ENDPOINT_IP: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_wireguard_endpoint_ip&#x27;, role=&#x27;gluetun&#x27;) if (lookup(&#x27;role_var&#x27;, &#x27;_wireguard_endpoint_ip&#x27;, role=&#x27;gluetun&#x27;) | length &gt; 0) else omit }}&quot;</span><span class="diff-line add">+  WIREGUARD_ENDPOINT_PORT: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_wireguard_endpoint_port&#x27;, role=&#x27;gluetun&#x27;) if (lookup(&#x27;role_var&#x27;, &#x27;_wireguard_endpoint_port&#x27;, role=&#x27;gluetun&#x27;) | length &gt; 0) else omit }}&quot;</span><span class="diff-line add">+  WIREGUARD_MTU: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_wireguard_mtu&#x27;, role=&#x27;gluetun&#x27;) if (lookup(&#x27;role_var&#x27;, &#x27;_wireguard_mtu&#x27;, role=&#x27;gluetun&#x27;) | length &gt; 0) else omit }}&quot;</span><span class="diff-line add">+  WIREGUARD_PRESHARED_KEY: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_wireguard_preshared_key&#x27;, role=&#x27;gluetun&#x27;) if (lookup(&#x27;role_var&#x27;, &#x27;_wireguard_preshared_key&#x27;, role=&#x27;gluetun&#x27;) | length &gt; 0) else omit }}&quot;</span><span class="diff-line add">+  WIREGUARD_PRIVATE_KEY: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_wireguard_private_key&#x27;, role=&#x27;gluetun&#x27;) if (lookup(&#x27;role_var&#x27;, &#x27;_wireguard_private_key&#x27;, role=&#x27;gluetun&#x27;) | length &gt; 0) else omit }}&quot;</span><span class="diff-line add">+  WIREGUARD_PUBLIC_KEY: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_wireguard_public_key&#x27;, role=&#x27;gluetun&#x27;) if (lookup(&#x27;role_var&#x27;, &#x27;_wireguard_public_key&#x27;, role=&#x27;gluetun&#x27;) | length &gt; 0) else omit }}&quot;</span><span class="diff-line add">+gluetun_role_docker_envs_custom: {}</span><span class="diff-line add">+gluetun_role_docker_envs: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_envs_default&#x27;, role=&#x27;gluetun&#x27;)</span><span class="diff-line add">+                              | combine(lookup(&#x27;role_var&#x27;, &#x27;_docker_envs_custom&#x27;, role=&#x27;gluetun&#x27;)) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Volumes</span><span class="diff-line del">-gluetun_docker_volumes_global: false</span><span class="diff-line del">-gluetun_docker_volumes_default:</span><span class="diff-line del">-  - &quot;{{ gluetun_paths_location }}:/gluetun&quot;</span><span class="diff-line del">-gluetun_docker_volumes_custom: []</span><span class="diff-line del">-gluetun_docker_volumes: &quot;{{ lookup(&#x27;vars&#x27;, gluetun_name + &#x27;_docker_volumes_default&#x27;, default=gluetun_docker_volumes_default)</span><span class="diff-line del">-                            + lookup(&#x27;vars&#x27;, gluetun_name + &#x27;_docker_volumes_custom&#x27;, default=gluetun_docker_volumes_custom) }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Devices</span><span class="diff-line del">-gluetun_docker_devices_default: []</span><span class="diff-line del">-gluetun_docker_devices_custom: []</span><span class="diff-line del">-gluetun_docker_devices: &quot;{{ lookup(&#x27;vars&#x27;, gluetun_name + &#x27;_docker_devices_default&#x27;, default=gluetun_docker_devices_default)</span><span class="diff-line del">-                            + lookup(&#x27;vars&#x27;, gluetun_name + &#x27;_docker_devices_custom&#x27;, default=gluetun_docker_devices_custom) }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Hosts</span><span class="diff-line del">-gluetun_docker_hosts_default: {}</span><span class="diff-line del">-gluetun_docker_hosts_custom: {}</span><span class="diff-line del">-gluetun_docker_hosts: &quot;{{ docker_hosts_common</span><span class="diff-line del">-                          | combine(lookup(&#x27;vars&#x27;, gluetun_name + &#x27;_docker_hosts_default&#x27;, default=gluetun_docker_hosts_default))</span><span class="diff-line del">-                          | combine(lookup(&#x27;vars&#x27;, gluetun_name + &#x27;_docker_hosts_custom&#x27;, default=gluetun_docker_hosts_custom)) }}&quot;</span><span class="diff-line add">+gluetun_role_docker_volumes_global: false</span><span class="diff-line add">+gluetun_role_docker_volumes_default:</span><span class="diff-line add">+  - &quot;{{ gluetun_role_paths_location }}:/gluetun&quot;</span><span class="diff-line add">+gluetun_role_docker_volumes_custom: []</span><span class="diff-line add">+gluetun_role_docker_volumes: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_volumes_default&#x27;, role=&#x27;gluetun&#x27;)</span><span class="diff-line add">+                                 + lookup(&#x27;role_var&#x27;, &#x27;_docker_volumes_custom&#x27;, role=&#x27;gluetun&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Labels</span><span class="diff-line del">-gluetun_docker_labels_default:</span><span class="diff-line add">+gluetun_role_docker_labels_default:</span><span class="diff-line context">   com.centurylinklabs.watchtower.enable: &quot;false&quot;</span><span class="diff-line del">-gluetun_docker_labels_custom: {}</span><span class="diff-line del">-gluetun_docker_labels: &quot;{{ docker_labels_common</span><span class="diff-line del">-                           | combine(lookup(&#x27;vars&#x27;, gluetun_name + &#x27;_docker_labels_default&#x27;, default=gluetun_docker_labels_default))</span><span class="diff-line del">-                           | combine(lookup(&#x27;vars&#x27;, gluetun_name + &#x27;_docker_labels_custom&#x27;, default=gluetun_docker_labels_custom)) }}&quot;</span><span class="diff-line add">+gluetun_role_docker_labels_custom: {}</span><span class="diff-line add">+gluetun_role_docker_labels: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_labels_default&#x27;, role=&#x27;gluetun&#x27;)</span><span class="diff-line add">+                                | combine(lookup(&#x27;role_var&#x27;, &#x27;_docker_labels_custom&#x27;, role=&#x27;gluetun&#x27;)) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Hostname</span><span class="diff-line del">-gluetun_docker_hostname: &quot;{{ gluetun_name }}&quot;</span><span class="diff-line add">+gluetun_role_docker_hostname: &quot;{{ gluetun_name }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Networks</span><span class="diff-line del">-gluetun_docker_networks_alias: &quot;{{ gluetun_name }}&quot;</span><span class="diff-line del">-gluetun_docker_networks_default: []</span><span class="diff-line del">-gluetun_docker_networks_custom: []</span><span class="diff-line del">-gluetun_docker_networks: &quot;{{ docker_networks_common</span><span class="diff-line del">-                             + lookup(&#x27;vars&#x27;, gluetun_name + &#x27;_docker_networks_default&#x27;, default=gluetun_docker_networks_default)</span><span class="diff-line del">-                             + lookup(&#x27;vars&#x27;, gluetun_name + &#x27;_docker_networks_custom&#x27;, default=gluetun_docker_networks_custom) }}&quot;</span><span class="diff-line add">+gluetun_role_docker_networks_alias: &quot;{{ gluetun_name }}&quot;</span><span class="diff-line add">+gluetun_role_docker_networks_default: []</span><span class="diff-line add">+gluetun_role_docker_networks_custom: []</span><span class="diff-line add">+gluetun_role_docker_networks: &quot;{{ docker_networks_common</span><span class="diff-line add">+                                  + lookup(&#x27;role_var&#x27;, &#x27;_docker_networks_default&#x27;, role=&#x27;gluetun&#x27;)</span><span class="diff-line add">+                                  + lookup(&#x27;role_var&#x27;, &#x27;_docker_networks_custom&#x27;, role=&#x27;gluetun&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Capabilities</span><span class="diff-line del">-gluetun_docker_capabilities_default:</span><span class="diff-line add">+gluetun_role_docker_capabilities_default:</span><span class="diff-line context">   - NET_ADMIN</span><span class="diff-line del">-gluetun_docker_capabilities_custom: []</span><span class="diff-line del">-gluetun_docker_capabilities: &quot;{{ lookup(&#x27;vars&#x27;, gluetun_name + &#x27;_docker_capabilities_default&#x27;, default=gluetun_docker_capabilities_default)</span><span class="diff-line del">-                                 + lookup(&#x27;vars&#x27;, gluetun_name + &#x27;_docker_capabilities_custom&#x27;, default=gluetun_docker_capabilities_custom) }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Security Opts</span><span class="diff-line del">-gluetun_docker_security_opts_default: []</span><span class="diff-line del">-gluetun_docker_security_opts_custom: []</span><span class="diff-line del">-gluetun_docker_security_opts: &quot;{{ lookup(&#x27;vars&#x27;, gluetun_name + &#x27;_docker_security_opts_default&#x27;, default=gluetun_docker_security_opts_default)</span><span class="diff-line del">-                                  + lookup(&#x27;vars&#x27;, gluetun_name + &#x27;_docker_security_opts_custom&#x27;, default=gluetun_docker_security_opts_custom) }}&quot;</span><span class="diff-line add">+gluetun_role_docker_capabilities_custom: []</span><span class="diff-line add">+gluetun_role_docker_capabilities: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_capabilities_default&#x27;, role=&#x27;gluetun&#x27;)</span><span class="diff-line add">+                                      + lookup(&#x27;role_var&#x27;, &#x27;_docker_capabilities_custom&#x27;, role=&#x27;gluetun&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Restart Policy</span><span class="diff-line del">-gluetun_docker_restart_policy: unless-stopped</span><span class="diff-line add">+gluetun_role_docker_restart_policy: unless-stopped</span><span class="diff-line context"> </span><span class="diff-line context"> # State</span><span class="diff-line del">-gluetun_docker_state: started</span><span class="diff-line add">+gluetun_role_docker_state: started</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-189">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/gluetun/tasks/main.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -1,7 +1,7 @@</span><span class="diff-line context"> ##########################################################################</span><span class="diff-line del">-# Title:            Sandbox: Gluetun                                     #</span><span class="diff-line add">+# Title:            Saltbox: Gluetun                                     #</span><span class="diff-line context"> # Author(s):        owine                                                #</span><span class="diff-line del">-# URL:              https://github.com/saltyorg/Sandbox                  #</span><span class="diff-line add">+# URL:              https://github.com/saltyorg/Saltbox                  #</span><span class="diff-line context"> # --                                                                     #</span><span class="diff-line context"> ##########################################################################</span><span class="diff-line context"> #                   GNU General Public License v3.0                      #</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-190">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/gluetun/tasks/main2.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -1,7 +1,7 @@</span><span class="diff-line context"> ##########################################################################</span><span class="diff-line del">-# Title:            Sandbox: Gluetun                                     #</span><span class="diff-line add">+# Title:            Saltbox: Gluetun                                     #</span><span class="diff-line context"> # Author(s):        owine                                                #</span><span class="diff-line del">-# URL:              https://github.com/saltyorg/Sandbox                  #</span><span class="diff-line add">+# URL:              https://github.com/saltyorg/Saltbox                  #</span><span class="diff-line context"> # --                                                                     #</span><span class="diff-line context"> ##########################################################################</span><span class="diff-line context"> #                   GNU General Public License v3.0                      #</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-191">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/grafana/defaults/main.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -1,9 +1,9 @@</span><span class="diff-line context"> #########################################################################</span><span class="diff-line del">-# Title:            Saltbox: Grafana Role | Default Variables           #</span><span class="diff-line del">-# Author(s):        desimaniac, salty                                   #</span><span class="diff-line del">-# URL:              https://github.com/saltyorg/Saltbox                 #</span><span class="diff-line add">+# Title:            Saltbox: Grafana | Default Variables               #</span><span class="diff-line add">+# Author(s):        desimaniac, salty                                  #</span><span class="diff-line add">+# URL:              https://github.com/saltyorg/Saltbox                #</span><span class="diff-line context"> #########################################################################</span><span class="diff-line del">-#                   GNU General Public License v3.0                     #</span><span class="diff-line add">+#                   GNU General Public License v3.0                    #</span><span class="diff-line context"> #########################################################################</span><span class="diff-line context"> ---</span><span class="diff-line context"> ################################</span><span class="diff-line hunk">@@ -13,144 +13,101 @@</span><span class="diff-line context"> grafana_name: grafana</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line add">+# Settings</span><span class="diff-line add">+################################</span><span class="diff-line add">+</span><span class="diff-line add">+# Comma separated list of plugins</span><span class="diff-line add">+grafana_role_plugins: &quot;&quot;</span><span class="diff-line add">+</span><span class="diff-line add">+################################</span><span class="diff-line context"> # Paths</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-grafana_paths_folder: &quot;{{ grafana_name }}&quot;</span><span class="diff-line del">-grafana_paths_location: &quot;{{ server_appdata_path }}/{{ grafana_paths_folder }}&quot;</span><span class="diff-line del">-grafana_paths_folders_list:</span><span class="diff-line del">-  - &quot;{{ grafana_paths_location }}&quot;</span><span class="diff-line add">+grafana_role_paths_folder: &quot;{{ grafana_name }}&quot;</span><span class="diff-line add">+grafana_role_paths_location: &quot;{{ server_appdata_path }}/{{ grafana_role_paths_folder }}&quot;</span><span class="diff-line add">+grafana_role_paths_folders_list:</span><span class="diff-line add">+  - &quot;{{ grafana_role_paths_location }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # Web</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-grafana_web_subdomain: &quot;{{ grafana_name }}&quot;</span><span class="diff-line del">-grafana_web_domain: &quot;{{ user.domain }}&quot;</span><span class="diff-line del">-grafana_web_port: &quot;3000&quot;</span><span class="diff-line del">-grafana_web_url: &quot;{{ &#x27;https://&#x27; + (grafana_web_subdomain + &#x27;.&#x27; + grafana_web_domain</span><span class="diff-line del">-                  if (grafana_web_subdomain | length &gt; 0)</span><span class="diff-line del">-                  else grafana_web_domain) }}&quot;</span><span class="diff-line add">+grafana_role_web_subdomain: &quot;{{ grafana_name }}&quot;</span><span class="diff-line add">+grafana_role_web_domain: &quot;{{ user.domain }}&quot;</span><span class="diff-line add">+grafana_role_web_port: &quot;3000&quot;</span><span class="diff-line add">+grafana_role_web_url: &quot;{{ &#x27;https://&#x27; + (lookup(&#x27;role_var&#x27;, &#x27;_web_subdomain&#x27;, role=&#x27;grafana&#x27;) + &#x27;.&#x27; + lookup(&#x27;role_var&#x27;, &#x27;_web_domain&#x27;, role=&#x27;grafana&#x27;)</span><span class="diff-line add">+                       if (lookup(&#x27;role_var&#x27;, &#x27;_web_subdomain&#x27;, role=&#x27;grafana&#x27;) | length &gt; 0)</span><span class="diff-line add">+                       else lookup(&#x27;role_var&#x27;, &#x27;_web_domain&#x27;, role=&#x27;grafana&#x27;)) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # DNS</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-grafana_dns_record: &quot;{{ grafana_web_subdomain }}&quot;</span><span class="diff-line del">-grafana_dns_zone: &quot;{{ grafana_web_domain }}&quot;</span><span class="diff-line del">-grafana_dns_proxy: &quot;{{ dns.proxied }}&quot;</span><span class="diff-line add">+grafana_role_dns_record: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_web_subdomain&#x27;, role=&#x27;grafana&#x27;) }}&quot;</span><span class="diff-line add">+grafana_role_dns_zone: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_web_domain&#x27;, role=&#x27;grafana&#x27;) }}&quot;</span><span class="diff-line add">+grafana_role_dns_proxy: &quot;{{ dns_proxied }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # Traefik</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-grafana_traefik_sso_middleware: &quot;&quot;</span><span class="diff-line del">-grafana_traefik_middleware_default: &quot;{{ traefik_default_middleware }}&quot;</span><span class="diff-line del">-grafana_traefik_middleware_custom: &quot;&quot;</span><span class="diff-line del">-grafana_traefik_certresolver: &quot;{{ traefik_default_certresolver }}&quot;</span><span class="diff-line del">-grafana_traefik_enabled: true</span><span class="diff-line del">-grafana_traefik_api_enabled: false</span><span class="diff-line del">-grafana_traefik_api_endpoint: &quot;&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-################################</span><span class="diff-line del">-# Plugins</span><span class="diff-line del">-################################</span><span class="diff-line del">-</span><span class="diff-line del">-# Comma separated list of plugins</span><span class="diff-line del">-grafana_plugins: &quot;&quot;</span><span class="diff-line add">+grafana_role_traefik_sso_middleware: &quot;&quot;</span><span class="diff-line add">+grafana_role_traefik_middleware_default: &quot;{{ traefik_default_middleware }}&quot;</span><span class="diff-line add">+grafana_role_traefik_middleware_custom: &quot;&quot;</span><span class="diff-line add">+grafana_role_traefik_certresolver: &quot;{{ traefik_default_certresolver }}&quot;</span><span class="diff-line add">+grafana_role_traefik_enabled: true</span><span class="diff-line add">+grafana_role_traefik_api_enabled: false</span><span class="diff-line add">+grafana_role_traefik_api_endpoint: &quot;&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # Docker</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line context"> # Container</span><span class="diff-line del">-grafana_docker_container: &quot;{{ grafana_name }}&quot;</span><span class="diff-line add">+grafana_role_docker_container: &quot;{{ grafana_name }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Image</span><span class="diff-line del">-grafana_docker_image_pull: true</span><span class="diff-line del">-grafana_docker_image_tag: &quot;latest&quot;</span><span class="diff-line del">-grafana_docker_image: &quot;grafana/grafana:{{ grafana_docker_image_tag }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Ports</span><span class="diff-line del">-grafana_docker_ports_defaults: []</span><span class="diff-line del">-grafana_docker_ports_custom: []</span><span class="diff-line del">-grafana_docker_ports: &quot;{{ grafana_docker_ports_defaults</span><span class="diff-line del">-                          + grafana_docker_ports_custom }}&quot;</span><span class="diff-line add">+grafana_role_docker_image_pull: true</span><span class="diff-line add">+grafana_role_docker_image_repo: &quot;grafana/grafana&quot;</span><span class="diff-line add">+grafana_role_docker_image_tag: &quot;latest&quot;</span><span class="diff-line add">+grafana_role_docker_image: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_image_repo&#x27;, role=&#x27;grafana&#x27;) }}:{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_image_tag&#x27;, role=&#x27;grafana&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Envs</span><span class="diff-line del">-grafana_docker_envs_default:</span><span class="diff-line add">+grafana_role_docker_envs_default:</span><span class="diff-line context">   PUID: &quot;{{ uid }}&quot;</span><span class="diff-line context">   PGID: &quot;{{ gid }}&quot;</span><span class="diff-line context">   TZ: &quot;{{ tz }}&quot;</span><span class="diff-line del">-  GF_SERVER_ROOT_URL: &quot;https://grafana.{{ user.domain }}&quot;</span><span class="diff-line add">+  GF_SERVER_ROOT_URL: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_web_url&#x27;, role=&#x27;grafana&#x27;) }}&quot;</span><span class="diff-line context">   GF_SECURITY_ADMIN_USER: &quot;{{ user.name }}&quot;</span><span class="diff-line context">   GF_SECURITY_ADMIN_PASSWORD: &quot;{{ user.pass }}&quot;</span><span class="diff-line del">-  GF_INSTALL_PLUGINS: &quot;{{ grafana_plugins }}&quot;</span><span class="diff-line del">-grafana_docker_envs_custom: {}</span><span class="diff-line del">-grafana_docker_envs: &quot;{{ grafana_docker_envs_default</span><span class="diff-line del">-                          | combine(grafana_docker_envs_custom) }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Commands</span><span class="diff-line del">-grafana_docker_commands_default: []</span><span class="diff-line del">-grafana_docker_commands_custom: []</span><span class="diff-line del">-grafana_docker_commands: &quot;{{ grafana_docker_commands_default</span><span class="diff-line del">-                              + grafana_docker_commands_custom }}&quot;</span><span class="diff-line add">+  GF_INSTALL_PLUGINS: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_plugins&#x27;, role=&#x27;grafana&#x27;) }}&quot;</span><span class="diff-line add">+grafana_role_docker_envs_custom: {}</span><span class="diff-line add">+grafana_role_docker_envs: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_envs_default&#x27;, role=&#x27;grafana&#x27;)</span><span class="diff-line add">+                              | combine(lookup(&#x27;role_var&#x27;, &#x27;_docker_envs_custom&#x27;, role=&#x27;grafana&#x27;)) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Volumes</span><span class="diff-line del">-grafana_docker_volumes_default:</span><span class="diff-line del">-  - &quot;{{ grafana_paths_location }}:/var/lib/grafana&quot;</span><span class="diff-line del">-grafana_docker_volumes_custom: []</span><span class="diff-line del">-grafana_docker_volumes: &quot;{{ grafana_docker_volumes_default</span><span class="diff-line del">-                            + grafana_docker_volumes_custom }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Devices</span><span class="diff-line del">-grafana_docker_devices_default: []</span><span class="diff-line del">-grafana_docker_devices_custom: []</span><span class="diff-line del">-grafana_docker_devices: &quot;{{ grafana_docker_devices_default</span><span class="diff-line del">-                            + grafana_docker_devices_custom }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Hosts</span><span class="diff-line del">-grafana_docker_hosts_default: {}</span><span class="diff-line del">-grafana_docker_hosts_custom: {}</span><span class="diff-line del">-grafana_docker_hosts: &quot;{{ docker_hosts_common</span><span class="diff-line del">-                          | combine(grafana_docker_hosts_default)</span><span class="diff-line del">-                          | combine(grafana_docker_hosts_custom) }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Labels</span><span class="diff-line del">-grafana_docker_labels_default: {}</span><span class="diff-line del">-grafana_docker_labels_custom: {}</span><span class="diff-line del">-grafana_docker_labels: &quot;{{ docker_labels_common</span><span class="diff-line del">-                            | combine(grafana_docker_labels_default)</span><span class="diff-line del">-                            | combine(grafana_docker_labels_custom) }}&quot;</span><span class="diff-line add">+grafana_role_docker_volumes_default:</span><span class="diff-line add">+  - &quot;{{ grafana_role_paths_location }}:/var/lib/grafana&quot;</span><span class="diff-line add">+grafana_role_docker_volumes_custom: []</span><span class="diff-line add">+grafana_role_docker_volumes: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_volumes_default&#x27;, role=&#x27;grafana&#x27;)</span><span class="diff-line add">+                                 + lookup(&#x27;role_var&#x27;, &#x27;_docker_volumes_custom&#x27;, role=&#x27;grafana&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Hostname</span><span class="diff-line del">-grafana_docker_hostname: &quot;{{ grafana_name }}&quot;</span><span class="diff-line add">+grafana_role_docker_hostname: &quot;{{ grafana_name }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Networks</span><span class="diff-line del">-grafana_docker_networks_alias: &quot;{{ grafana_name }}&quot;</span><span class="diff-line del">-grafana_docker_networks_default: []</span><span class="diff-line del">-grafana_docker_networks_custom: []</span><span class="diff-line del">-grafana_docker_networks: &quot;{{ docker_networks_common</span><span class="diff-line del">-                              + grafana_docker_networks_default</span><span class="diff-line del">-                              + grafana_docker_networks_custom }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Capabilities</span><span class="diff-line del">-grafana_docker_capabilities_default: []</span><span class="diff-line del">-grafana_docker_capabilities_custom: []</span><span class="diff-line del">-grafana_docker_capabilities: &quot;{{ grafana_docker_capabilities_default</span><span class="diff-line del">-                                  + grafana_docker_capabilities_custom }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Security Opts</span><span class="diff-line del">-grafana_docker_security_opts_default: []</span><span class="diff-line del">-grafana_docker_security_opts_custom: []</span><span class="diff-line del">-grafana_docker_security_opts: &quot;{{ grafana_docker_security_opts_default</span><span class="diff-line del">-                                  + grafana_docker_security_opts_custom }}&quot;</span><span class="diff-line add">+grafana_role_docker_networks_alias: &quot;{{ grafana_name }}&quot;</span><span class="diff-line add">+grafana_role_docker_networks_default: []</span><span class="diff-line add">+grafana_role_docker_networks_custom: []</span><span class="diff-line add">+grafana_role_docker_networks: &quot;{{ docker_networks_common</span><span class="diff-line add">+                                  + lookup(&#x27;role_var&#x27;, &#x27;_docker_networks_default&#x27;, role=&#x27;grafana&#x27;)</span><span class="diff-line add">+                                  + lookup(&#x27;role_var&#x27;, &#x27;_docker_networks_custom&#x27;, role=&#x27;grafana&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Restart Policy</span><span class="diff-line del">-grafana_docker_restart_policy: unless-stopped</span><span class="diff-line add">+grafana_role_docker_restart_policy: unless-stopped</span><span class="diff-line context"> </span><span class="diff-line context"> # State</span><span class="diff-line del">-grafana_docker_state: started</span><span class="diff-line add">+grafana_role_docker_state: started</span><span class="diff-line context"> </span><span class="diff-line context"> # User</span><span class="diff-line del">-grafana_docker_user: &quot;{{ uid }}:{{ gid }}&quot;</span><span class="diff-line add">+grafana_role_docker_user: &quot;{{ uid }}:{{ gid }}&quot;</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-192">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/grafana/tasks/main.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -9,9 +9,9 @@</span><span class="diff-line context"> - name: Add DNS record</span><span class="diff-line context">   ansible.builtin.include_tasks: &quot;{{ resources_tasks_path }}/dns/tasker.yml&quot;</span><span class="diff-line context">   vars:</span><span class="diff-line del">-    dns_record: &quot;{{ lookup(&#x27;vars&#x27;, role_name + &#x27;_dns_record&#x27;) }}&quot;</span><span class="diff-line del">-    dns_zone: &quot;{{ lookup(&#x27;vars&#x27;, role_name + &#x27;_dns_zone&#x27;) }}&quot;</span><span class="diff-line del">-    dns_proxy: &quot;{{ lookup(&#x27;vars&#x27;, role_name + &#x27;_dns_proxy&#x27;) }}&quot;</span><span class="diff-line add">+    dns_record: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_dns_record&#x27;) }}&quot;</span><span class="diff-line add">+    dns_zone: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_dns_zone&#x27;) }}&quot;</span><span class="diff-line add">+    dns_proxy: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_dns_proxy&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Remove existing Docker container</span><span class="diff-line context">   ansible.builtin.include_tasks: &quot;{{ resources_tasks_path }}/docker/remove_docker_container.yml&quot;</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-193">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/hetzner/tasks/main.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -8,7 +8,7 @@</span><span class="diff-line context"> #########################################################################</span><span class="diff-line context"> ---</span><span class="diff-line context"> - name: &quot;Hetzner Tasks&quot;</span><span class="diff-line del">-  ansible.builtin.import_tasks: &quot;subtasks/hetzner.yml&quot;</span><span class="diff-line add">+  ansible.builtin.include_tasks: &quot;subtasks/hetzner.yml&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: &quot;Restart Tasks&quot;</span><span class="diff-line context">   ansible.builtin.include_tasks: &quot;subtasks/restart.yml&quot;</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-194">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/hetzner/tasks/subtasks/hetzner.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -10,7 +10,7 @@</span><span class="diff-line context"> - name: Hetzner | Install &#x27;pciutils&#x27;</span><span class="diff-line context">   ansible.builtin.apt:</span><span class="diff-line context">     name: pciutils</span><span class="diff-line del">-    state: present</span><span class="diff-line add">+    state: latest</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Hetzner | Fetch PCI info</span><span class="diff-line context">   ansible.builtin.shell: &quot;lspci -v -s $(lspci | grep -E &#x27;.*VGA.*Intel.*&#x27; | cut -d&#x27; &#x27; -f 1) 2&gt;/dev/null || :&quot;</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-195">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/hetzner_nfs/tasks/hetzner_nfs_mount.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -15,7 +15,7 @@</span><span class="diff-line context">     owner: &quot;{{ user.name }}&quot;</span><span class="diff-line context">     group: &quot;{{ user.name }}&quot;</span><span class="diff-line context">   with_items:</span><span class="diff-line del">-    - /opt/hetzner_nfs</span><span class="diff-line add">+    - &quot;{{ server_appdata_path }}/hetzner_nfs&quot;</span><span class="diff-line context">     - /mnt/feeder</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Import &#x27;hosts.deny&#x27; file</span><span class="diff-line hunk">@@ -38,7 +38,7 @@</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Install nfs requirements</span><span class="diff-line context">   ansible.builtin.apt:</span><span class="diff-line del">-    state: present</span><span class="diff-line add">+    state: latest</span><span class="diff-line context">     name:</span><span class="diff-line context">       - rpcbind</span><span class="diff-line context">       - nfs-common</span><span class="diff-line hunk">@@ -46,7 +46,7 @@</span><span class="diff-line context"> - name: Import &#x27;init_vlan.sh&#x27; file</span><span class="diff-line context">   ansible.builtin.template:</span><span class="diff-line context">     src: client/init_vlan.sh.j2</span><span class="diff-line del">-    dest: /opt/hetzner_nfs/init_vlan.sh</span><span class="diff-line add">+    dest: &quot;{{ server_appdata_path }}/hetzner_nfs/init_vlan.sh&quot;</span><span class="diff-line context">     owner: &#x27;{{ user.name }}&#x27;</span><span class="diff-line context">     group: &#x27;{{ user.name }}&#x27;</span><span class="diff-line context">     mode: &quot;0775&quot;</span><span class="diff-line hunk">@@ -82,7 +82,7 @@</span><span class="diff-line context">     regexp: &#x27;(^After\=network-online\.target).*&#x27;</span><span class="diff-line context">     line: &#x27;\1 init_vlan.service&#x27;</span><span class="diff-line context">     state: present</span><span class="diff-line del">-    backrefs: yes</span><span class="diff-line add">+    backrefs: true</span><span class="diff-line context">   when: mergerfs_service.stat.exists</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Replace &#x27;/mnt/local&#x27; with &#x27;/mnt/feeder&#x27; in &#x27;{{ mergerfs_service_name }}&#x27;</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-196">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/hetzner_nfs/tasks/hetzner_nfs_server.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -15,7 +15,7 @@</span><span class="diff-line context">     owner: &quot;{{ user.name }}&quot;</span><span class="diff-line context">     group: &quot;{{ user.name }}&quot;</span><span class="diff-line context">   with_items:</span><span class="diff-line del">-    - /opt/hetzner_nfs</span><span class="diff-line add">+    - &quot;{{ server_appdata_path }}/hetzner_nfs&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Import &#x27;hosts.deny&#x27; file</span><span class="diff-line context">   ansible.builtin.template:</span><span class="diff-line hunk">@@ -28,7 +28,7 @@</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Install nfs server</span><span class="diff-line context">   ansible.builtin.apt:</span><span class="diff-line del">-    state: present</span><span class="diff-line add">+    state: latest</span><span class="diff-line context">     name:</span><span class="diff-line context">       - rpcbind</span><span class="diff-line context">       - nfs-kernel-server</span><span class="diff-line hunk">@@ -48,7 +48,7 @@</span><span class="diff-line context"> - name: Import &#x27;init_vlan.sh&#x27; file</span><span class="diff-line context">   ansible.builtin.template:</span><span class="diff-line context">     src: server/init_vlan.sh.j2</span><span class="diff-line del">-    dest: /opt/hetzner_nfs/init_vlan.sh</span><span class="diff-line add">+    dest: &quot;{{ server_appdata_path }}/hetzner_nfs/init_vlan.sh&quot;</span><span class="diff-line context">     owner: &#x27;{{ user.name }}&#x27;</span><span class="diff-line context">     group: &#x27;{{ user.name }}&#x27;</span><span class="diff-line context">     mode: &quot;0775&quot;</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-197">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/hetzner_nfs/tasks/hetzner_nfs_server_uninstall.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -35,7 +35,7 @@</span><span class="diff-line context">     - &quot;/etc/systemd/system/nfs_vlan.service&quot;</span><span class="diff-line context">     - &quot;/etc/exports&quot;</span><span class="diff-line context">     - &quot;/etc/hosts.deny&quot;</span><span class="diff-line del">-    - &quot;/opt/hetzner_nfs&quot;</span><span class="diff-line add">+    - &quot;{{ server_appdata_path }}/hetzner_nfs&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Reboot message</span><span class="diff-line context">   ansible.builtin.debug:</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-198">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/hetzner_nfs/tasks/hetzner_nfs_unmount.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -35,7 +35,7 @@</span><span class="diff-line context">     - &quot;/etc/systemd/system/nfs_vlan.service&quot;</span><span class="diff-line context">     - &quot;/etc/hosts.allow&quot;</span><span class="diff-line context">     - &quot;/etc/hosts.deny&quot;</span><span class="diff-line del">-    - &quot;/opt/hetzner_nfs&quot;</span><span class="diff-line add">+    - &quot;{{ server_appdata_path }}/hetzner_nfs&quot;</span><span class="diff-line context">     - &quot;/mnt/feeder&quot;</span><span class="diff-line context"> </span><span class="diff-line context">   # mergerfs edits</span><span class="diff-line hunk">@@ -46,7 +46,7 @@</span><span class="diff-line context">     regexp: &#x27;(^After\=.*)\sinit_vlan\.service\s(.*)&#x27;</span><span class="diff-line context">     line: &#x27;\1 \2&#x27;</span><span class="diff-line context">     state: present</span><span class="diff-line del">-    backrefs: yes</span><span class="diff-line add">+    backrefs: true</span><span class="diff-line context">   when: mergerfs_service.stat.exists</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Replace &#x27;/mnt/feeder&#x27; with &#x27;/mnt/local&#x27; in &#x27;{{ mergerfs_service_name }}&#x27;</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-199">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/hetzner_nfs/tasks/services_stop.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -18,7 +18,7 @@</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Get &#x27;docker.service&#x27; state</span><span class="diff-line context">   ansible.builtin.set_fact:</span><span class="diff-line del">-    docker_service_running: &quot;{{ (services[&#x27;docker.service&#x27;] is defined) and (services[&#x27;docker.service&#x27;][&#x27;state&#x27;] == &#x27;running&#x27;) }}&quot;</span><span class="diff-line add">+    docker_service_running: &quot;{{ (ansible_facts[&#x27;services&#x27;][&#x27;docker.service&#x27;] is defined) and (ansible_facts[&#x27;services&#x27;][&#x27;docker.service&#x27;][&#x27;state&#x27;] == &#x27;running&#x27;) }}&quot;</span><span class="diff-line context">   when: docker_binary.stat.exists</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Gather list of running Docker containers</span><span class="diff-line hunk">@@ -52,7 +52,7 @@</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Get &#x27;{{ mergerfs_service_name }}&#x27; state</span><span class="diff-line context">   ansible.builtin.set_fact:</span><span class="diff-line del">-    mergerfs_service_running: &quot;{{ (services[mergerfs_service_name] is defined) and (services[mergerfs_service_name][&#x27;state&#x27;] == &#x27;running&#x27;) }}&quot;</span><span class="diff-line add">+    mergerfs_service_running: &quot;{{ (ansible_facts[&#x27;services&#x27;][mergerfs_service_name] is defined) and (ansible_facts[&#x27;services&#x27;][mergerfs_service_name][&#x27;state&#x27;] == &#x27;running&#x27;) }}&quot;</span><span class="diff-line context">   when: mergerfs_service.stat.exists</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Stop existing &#x27;{{ mergerfs_service_name }}&#x27;</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-200">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/hetzner_nfs/templates/client/init_vlan.sh.j2</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -1,7 +1,7 @@</span><span class="diff-line context"> #!/bin/bash</span><span class="diff-line del">-sudo ip link add link {{ ansible_default_ipv4.interface }} name {{ ansible_default_ipv4.interface }}.{{ hetzner_nfs.vlan_id }} type vlan id {{ hetzner_nfs.vlan_id }}</span><span class="diff-line del">-sudo ip link set {{ ansible_default_ipv4.interface }}.{{ hetzner_nfs.vlan_id }} mtu 1400</span><span class="diff-line del">-sudo ip link set dev {{ ansible_default_ipv4.interface }}.{{ hetzner_nfs.vlan_id }} up</span><span class="diff-line del">-sudo ip addr add 192.168.100.{{ hetzner_nfs.mount_client }}/24 brd 192.168.100.255 dev {{ ansible_default_ipv4.interface }}.{{ hetzner_nfs.vlan_id }}</span><span class="diff-line add">+sudo ip link add link {{ ansible_facts[&#x27;default_ipv4&#x27;][&#x27;interface&#x27;] }} name {{ ansible_facts[&#x27;default_ipv4&#x27;][&#x27;interface&#x27;] }}.{{ hetzner_nfs.vlan_id }} type vlan id {{ hetzner_nfs.vlan_id }}</span><span class="diff-line add">+sudo ip link set {{ ansible_facts[&#x27;default_ipv4&#x27;][&#x27;interface&#x27;] }}.{{ hetzner_nfs.vlan_id }} mtu 1400</span><span class="diff-line add">+sudo ip link set dev {{ ansible_facts[&#x27;default_ipv4&#x27;][&#x27;interface&#x27;] }}.{{ hetzner_nfs.vlan_id }} up</span><span class="diff-line add">+sudo ip addr add 192.168.100.{{ hetzner_nfs.mount_client }}/24 brd 192.168.100.255 dev {{ ansible_facts[&#x27;default_ipv4&#x27;][&#x27;interface&#x27;] }}.{{ hetzner_nfs.vlan_id }}</span><span class="diff-line context"> sudo umount /mnt/feeder</span><span class="diff-line context"> sudo mount 192.168.100.2:/mnt/local /mnt/feeder</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-201">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/hetzner_nfs/templates/client/nfs_vlan.service.j2</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -6,7 +6,7 @@</span><span class="diff-line context"> After=network.target network-online.target</span><span class="diff-line context"> </span><span class="diff-line context"> [Service]</span><span class="diff-line del">-ExecStart=/opt/hetzner_nfs/init_vlan.sh</span><span class="diff-line add">+ExecStart={{ server_appdata_path }}/hetzner_nfs/init_vlan.sh</span><span class="diff-line context"> </span><span class="diff-line context"> [Install]</span><span class="diff-line context"> WantedBy=multi-user.target</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-202">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/hetzner_nfs/templates/server/init_vlan.sh.j2</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -1,5 +1,5 @@</span><span class="diff-line context"> #!/bin/bash</span><span class="diff-line del">-sudo ip link add link {{ ansible_default_ipv4.interface }} name {{ ansible_default_ipv4.interface }}.{{ hetzner_nfs.vlan_id }} type vlan id {{ hetzner_nfs.vlan_id }}</span><span class="diff-line del">-sudo ip link set {{ ansible_default_ipv4.interface }}.{{ hetzner_nfs.vlan_id }} mtu 1400</span><span class="diff-line del">-sudo ip link set dev {{ ansible_default_ipv4.interface }}.{{ hetzner_nfs.vlan_id }} up</span><span class="diff-line del">-sudo ip addr add 192.168.100.{{ hetzner_nfs.server }}/24 brd 192.168.100.255 dev {{ ansible_default_ipv4.interface }}.{{ hetzner_nfs.vlan_id }}</span><span class="diff-line add">+sudo ip link add link {{ ansible_facts[&#x27;default_ipv4&#x27;][&#x27;interface&#x27;] }} name {{ ansible_facts[&#x27;default_ipv4&#x27;][&#x27;interface&#x27;] }}.{{ hetzner_nfs.vlan_id }} type vlan id {{ hetzner_nfs.vlan_id }}</span><span class="diff-line add">+sudo ip link set {{ ansible_facts[&#x27;default_ipv4&#x27;][&#x27;interface&#x27;] }}.{{ hetzner_nfs.vlan_id }} mtu 1400</span><span class="diff-line add">+sudo ip link set dev {{ ansible_facts[&#x27;default_ipv4&#x27;][&#x27;interface&#x27;] }}.{{ hetzner_nfs.vlan_id }} up</span><span class="diff-line add">+sudo ip addr add 192.168.100.{{ hetzner_nfs.server }}/24 brd 192.168.100.255 dev {{ ansible_facts[&#x27;default_ipv4&#x27;][&#x27;interface&#x27;] }}.{{ hetzner_nfs.vlan_id }}</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-203">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/hetzner_nfs/templates/server/nfs_vlan.service.j2</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -6,7 +6,7 @@</span><span class="diff-line context"> After=network.target network-online.target</span><span class="diff-line context"> </span><span class="diff-line context"> [Service]</span><span class="diff-line del">-ExecStart=/opt/hetzner_nfs/init_vlan.sh</span><span class="diff-line add">+ExecStart={{ server_appdata_path }}/hetzner_nfs/init_vlan.sh</span><span class="diff-line context"> </span><span class="diff-line context"> [Install]</span><span class="diff-line context"> WantedBy=multi-user.target</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-204">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/hetzner_vlan/tasks/main.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -9,7 +9,7 @@</span><span class="diff-line context"> ---</span><span class="diff-line context"> - name: Setup Netplan VLAN</span><span class="diff-line context">   ansible.builtin.shell: |</span><span class="diff-line del">-    yyq -i &#x27;.network.vlans += {&quot;{{ ansible_default_ipv4.interface }}.{{ hetzner_vlan.vlan_id }}&quot;: {&quot;id&quot;: {{ hetzner_vlan.vlan_id }}, &quot;link&quot;: &quot;{{ ansible_default_ipv4.interface }}&quot;, &quot;mtu&quot;: 1400, &quot;addresses&quot;: [&quot;192.168.100.{{ hetzner_vlan.client_number }}/24&quot;]}}&#x27; /etc/netplan/01-netcfg.yaml</span><span class="diff-line add">+    yyq -i &#x27;.network.vlans += {&quot;{{ ansible_facts[&#x27;default_ipv4&#x27;][&#x27;interface&#x27;] }}.{{ hetzner_vlan.vlan_id }}&quot;: {&quot;id&quot;: {{ hetzner_vlan.vlan_id }}, &quot;link&quot;: &quot;{{ ansible_facts[&#x27;default_ipv4&#x27;][&#x27;interface&#x27;] }}&quot;, &quot;mtu&quot;: 1400, &quot;addresses&quot;: [&quot;192.168.100.{{ hetzner_vlan.client_number }}/24&quot;]}}&#x27; /etc/netplan/01-netcfg.yaml</span><span class="diff-line context">   when: (&#x27;hetzner-vlan-deploy&#x27; in ansible_run_tags)</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Remove Netplan VLAN</span><span class="diff-line hunk">@@ -22,5 +22,5 @@</span><span class="diff-line context">   when: hetzner_vlan_netplan_apply</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Remove VLAN link</span><span class="diff-line del">-  ansible.builtin.shell: ip link delete {{ ansible_default_ipv4.interface }}.{{ hetzner_vlan.vlan_id }}</span><span class="diff-line add">+  ansible.builtin.shell: ip link delete {{ ansible_facts[&#x27;default_ipv4&#x27;][&#x27;interface&#x27;] }}.{{ hetzner_vlan.vlan_id }}</span><span class="diff-line context">   when: (&#x27;hetzner-vlan-remove&#x27; in ansible_run_tags) and hetzner_vlan_netplan_apply</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-205">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/jackett/defaults/main.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -17,145 +17,108 @@</span><span class="diff-line context"> # Paths</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-jackett_paths_folder: &quot;{{ jackett_name }}&quot;</span><span class="diff-line del">-jackett_paths_location: &quot;{{ server_appdata_path }}/{{ jackett_paths_folder }}&quot;</span><span class="diff-line del">-jackett_paths_folders_list:</span><span class="diff-line del">-  - &quot;{{ jackett_paths_location }}&quot;</span><span class="diff-line add">+jackett_role_paths_folder: &quot;{{ jackett_name }}&quot;</span><span class="diff-line add">+jackett_role_paths_location: &quot;{{ server_appdata_path }}/{{ jackett_role_paths_folder }}&quot;</span><span class="diff-line add">+jackett_role_paths_folders_list:</span><span class="diff-line add">+  - &quot;{{ jackett_role_paths_location }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # Web</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-jackett_web_subdomain: &quot;{{ jackett_name }}&quot;</span><span class="diff-line del">-jackett_web_domain: &quot;{{ user.domain }}&quot;</span><span class="diff-line del">-jackett_web_port: &quot;9117&quot;</span><span class="diff-line del">-jackett_web_url: &quot;{{ &#x27;https://&#x27; + (jackett_web_subdomain + &#x27;.&#x27; + jackett_web_domain</span><span class="diff-line del">-                  if (jackett_web_subdomain | length &gt; 0)</span><span class="diff-line del">-                  else jackett_web_domain) }}&quot;</span><span class="diff-line add">+jackett_role_web_subdomain: &quot;{{ jackett_name }}&quot;</span><span class="diff-line add">+jackett_role_web_domain: &quot;{{ user.domain }}&quot;</span><span class="diff-line add">+jackett_role_web_port: &quot;9117&quot;</span><span class="diff-line add">+jackett_role_web_url: &quot;{{ &#x27;https://&#x27; + (lookup(&#x27;role_var&#x27;, &#x27;_web_subdomain&#x27;, role=&#x27;jackett&#x27;) + &#x27;.&#x27; + lookup(&#x27;role_var&#x27;, &#x27;_web_domain&#x27;, role=&#x27;jackett&#x27;)</span><span class="diff-line add">+                       if (lookup(&#x27;role_var&#x27;, &#x27;_web_subdomain&#x27;, role=&#x27;jackett&#x27;) | length &gt; 0)</span><span class="diff-line add">+                       else lookup(&#x27;role_var&#x27;, &#x27;_web_domain&#x27;, role=&#x27;jackett&#x27;)) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # DNS</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-jackett_dns_record: &quot;{{ jackett_web_subdomain }}&quot;</span><span class="diff-line del">-jackett_dns_zone: &quot;{{ jackett_web_domain }}&quot;</span><span class="diff-line del">-jackett_dns_proxy: &quot;{{ dns.proxied }}&quot;</span><span class="diff-line add">+jackett_role_dns_record: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_web_subdomain&#x27;, role=&#x27;jackett&#x27;) }}&quot;</span><span class="diff-line add">+jackett_role_dns_zone: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_web_domain&#x27;, role=&#x27;jackett&#x27;) }}&quot;</span><span class="diff-line add">+jackett_role_dns_proxy: &quot;{{ dns_proxied }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # Traefik</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-jackett_traefik_sso_middleware: &quot;{{ traefik_default_sso_middleware }}&quot;</span><span class="diff-line del">-jackett_traefik_middleware_default: &quot;{{ traefik_default_middleware</span><span class="diff-line del">-                                        + (&#x27;,themepark-&#x27; + lookup(&#x27;vars&#x27;, jackett_name + &#x27;_name&#x27;, default=jackett_name)</span><span class="diff-line del">-                                          if (jackett_themepark_enabled and global_themepark_plugin_enabled)</span><span class="diff-line del">-                                          else &#x27;&#x27;) }}&quot;</span><span class="diff-line del">-jackett_traefik_middleware_custom: &quot;&quot;</span><span class="diff-line del">-jackett_traefik_certresolver: &quot;{{ traefik_default_certresolver }}&quot;</span><span class="diff-line del">-jackett_traefik_enabled: true</span><span class="diff-line del">-jackett_traefik_api_enabled: true</span><span class="diff-line del">-jackett_traefik_api_endpoint: &quot;PathPrefix(`/api`) || PathPrefix(`/dl`)&quot;</span><span class="diff-line add">+jackett_role_traefik_sso_middleware: &quot;{{ traefik_default_sso_middleware }}&quot;</span><span class="diff-line add">+jackett_role_traefik_middleware_default: &quot;{{ traefik_default_middleware</span><span class="diff-line add">+                                             + (&#x27;,themepark-&#x27; + jackett_name</span><span class="diff-line add">+                                               if (lookup(&#x27;role_var&#x27;, &#x27;_themepark_enabled&#x27;, role=&#x27;jackett&#x27;) and global_themepark_plugin_enabled)</span><span class="diff-line add">+                                               else &#x27;&#x27;) }}&quot;</span><span class="diff-line add">+jackett_role_traefik_middleware_custom: &quot;&quot;</span><span class="diff-line add">+jackett_role_traefik_certresolver: &quot;{{ traefik_default_certresolver }}&quot;</span><span class="diff-line add">+jackett_role_traefik_enabled: true</span><span class="diff-line add">+jackett_role_traefik_api_enabled: true</span><span class="diff-line add">+jackett_role_traefik_api_endpoint: &quot;PathPrefix(`/api`) || PathPrefix(`/dl`)&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line del">-# THEME</span><span class="diff-line add">+# Theme</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line context"> # Options can be found at https://github.com/themepark-dev/theme.park</span><span class="diff-line del">-jackett_themepark_enabled: false</span><span class="diff-line del">-jackett_themepark_app: &quot;jackett&quot;</span><span class="diff-line del">-jackett_themepark_theme: &quot;{{ global_themepark_theme }}&quot;</span><span class="diff-line del">-jackett_themepark_domain: &quot;{{ global_themepark_domain }}&quot;</span><span class="diff-line del">-jackett_themepark_addons: []</span><span class="diff-line add">+jackett_role_themepark_enabled: false</span><span class="diff-line add">+jackett_role_themepark_app: &quot;jackett&quot;</span><span class="diff-line add">+jackett_role_themepark_theme: &quot;{{ global_themepark_theme }}&quot;</span><span class="diff-line add">+jackett_role_themepark_domain: &quot;{{ global_themepark_domain }}&quot;</span><span class="diff-line add">+jackett_role_themepark_addons: []</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # Docker</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line context"> # Container</span><span class="diff-line del">-jackett_docker_container: &quot;{{ jackett_name }}&quot;</span><span class="diff-line add">+jackett_role_docker_container: &quot;{{ jackett_name }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Image</span><span class="diff-line del">-jackett_docker_image_pull: true</span><span class="diff-line del">-jackett_docker_image_tag: &quot;release&quot;</span><span class="diff-line del">-jackett_docker_image: &quot;ghcr.io/hotio/jackett:{{ jackett_docker_image_tag }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Ports</span><span class="diff-line del">-jackett_docker_ports_defaults: []</span><span class="diff-line del">-jackett_docker_ports_custom: []</span><span class="diff-line del">-jackett_docker_ports: &quot;{{ jackett_docker_ports_defaults</span><span class="diff-line del">-                          + jackett_docker_ports_custom }}&quot;</span><span class="diff-line add">+jackett_role_docker_image_pull: true</span><span class="diff-line add">+jackett_role_docker_image_repo: &quot;ghcr.io/hotio/jackett&quot;</span><span class="diff-line add">+jackett_role_docker_image_tag: &quot;release&quot;</span><span class="diff-line add">+jackett_role_docker_image: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_image_repo&#x27;, role=&#x27;jackett&#x27;) }}:{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_image_tag&#x27;, role=&#x27;jackett&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Envs</span><span class="diff-line del">-jackett_docker_envs_default:</span><span class="diff-line add">+jackett_role_docker_envs_default:</span><span class="diff-line context">   PUID: &quot;{{ uid }}&quot;</span><span class="diff-line context">   PGID: &quot;{{ gid }}&quot;</span><span class="diff-line context">   UMASK: &quot;002&quot;</span><span class="diff-line context">   TZ: &quot;{{ tz }}&quot;</span><span class="diff-line del">-jackett_docker_envs_custom: {}</span><span class="diff-line del">-jackett_docker_envs: &quot;{{ jackett_docker_envs_default</span><span class="diff-line del">-                         | combine(jackett_docker_envs_custom) }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Commands</span><span class="diff-line del">-jackett_docker_commands_default: []</span><span class="diff-line del">-jackett_docker_commands_custom: []</span><span class="diff-line del">-jackett_docker_commands: &quot;{{ jackett_docker_commands_default</span><span class="diff-line del">-                             + jackett_docker_commands_custom }}&quot;</span><span class="diff-line add">+jackett_role_docker_envs_custom: {}</span><span class="diff-line add">+jackett_role_docker_envs: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_envs_default&#x27;, role=&#x27;jackett&#x27;)</span><span class="diff-line add">+                              | combine(lookup(&#x27;role_var&#x27;, &#x27;_docker_envs_custom&#x27;, role=&#x27;jackett&#x27;)) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Volumes</span><span class="diff-line del">-jackett_docker_volumes_default:</span><span class="diff-line del">-  - &quot;{{ jackett_paths_location }}:/config&quot;</span><span class="diff-line del">-jackett_docker_volumes_custom: []</span><span class="diff-line del">-jackett_docker_volumes: &quot;{{ jackett_docker_volumes_default</span><span class="diff-line del">-                            + jackett_docker_volumes_custom }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Devices</span><span class="diff-line del">-jackett_docker_devices_default: []</span><span class="diff-line del">-jackett_docker_devices_custom: []</span><span class="diff-line del">-jackett_docker_devices: &quot;{{ jackett_docker_devices_default</span><span class="diff-line del">-                            + jackett_docker_devices_custom }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Hosts</span><span class="diff-line del">-jackett_docker_hosts_default: {}</span><span class="diff-line del">-jackett_docker_hosts_custom: {}</span><span class="diff-line del">-jackett_docker_hosts: &quot;{{ docker_hosts_common</span><span class="diff-line del">-                          | combine(jackett_docker_hosts_default)</span><span class="diff-line del">-                          | combine(jackett_docker_hosts_custom) }}&quot;</span><span class="diff-line add">+jackett_role_docker_volumes_default:</span><span class="diff-line add">+  - &quot;{{ jackett_role_paths_location }}:/config&quot;</span><span class="diff-line add">+jackett_role_docker_volumes_custom: []</span><span class="diff-line add">+jackett_role_docker_volumes: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_volumes_default&#x27;, role=&#x27;jackett&#x27;)</span><span class="diff-line add">+                                 + lookup(&#x27;role_var&#x27;, &#x27;_docker_volumes_custom&#x27;, role=&#x27;jackett&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Labels</span><span class="diff-line del">-jackett_docker_labels_default: {}</span><span class="diff-line del">-jackett_docker_labels_custom: {}</span><span class="diff-line del">-jackett_docker_labels: &quot;{{ docker_labels_common</span><span class="diff-line del">-                           | combine(lookup(&#x27;vars&#x27;, jackett_name + &#x27;_docker_labels_default&#x27;, default=jackett_docker_labels_default))</span><span class="diff-line del">-                           | combine((traefik_themepark_labels</span><span class="diff-line del">-                                     if (jackett_themepark_enabled and global_themepark_plugin_enabled)</span><span class="diff-line del">-                                     else {}),</span><span class="diff-line del">-                                     lookup(&#x27;vars&#x27;, jackett_name + &#x27;_docker_labels_custom&#x27;, default=jackett_docker_labels_custom)) }}&quot;</span><span class="diff-line add">+jackett_role_docker_labels_default: {}</span><span class="diff-line add">+jackett_role_docker_labels_custom: {}</span><span class="diff-line add">+jackett_role_docker_labels: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_labels_default&#x27;, role=&#x27;jackett&#x27;)</span><span class="diff-line add">+                                | combine((traefik_themepark_labels</span><span class="diff-line add">+                                          if (lookup(&#x27;role_var&#x27;, &#x27;_themepark_enabled&#x27;, role=&#x27;jackett&#x27;) and global_themepark_plugin_enabled)</span><span class="diff-line add">+                                          else {}),</span><span class="diff-line add">+                                          lookup(&#x27;role_var&#x27;, &#x27;_docker_labels_custom&#x27;, role=&#x27;jackett&#x27;)) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Hostname</span><span class="diff-line del">-jackett_docker_hostname: &quot;{{ jackett_name }}&quot;</span><span class="diff-line add">+jackett_role_docker_hostname: &quot;{{ jackett_name }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Networks</span><span class="diff-line del">-jackett_docker_networks_alias: &quot;{{ jackett_name }}&quot;</span><span class="diff-line del">-jackett_docker_networks_default: []</span><span class="diff-line del">-jackett_docker_networks_custom: []</span><span class="diff-line del">-jackett_docker_networks: &quot;{{ docker_networks_common</span><span class="diff-line del">-                             + jackett_docker_networks_default</span><span class="diff-line del">-                             + jackett_docker_networks_custom }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Capabilities</span><span class="diff-line del">-jackett_docker_capabilities_default: []</span><span class="diff-line del">-jackett_docker_capabilities_custom: []</span><span class="diff-line del">-jackett_docker_capabilities: &quot;{{ jackett_docker_capabilities_default</span><span class="diff-line del">-                                 + jackett_docker_capabilities_custom }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Security Opts</span><span class="diff-line del">-jackett_docker_security_opts_default: []</span><span class="diff-line del">-jackett_docker_security_opts_custom: []</span><span class="diff-line del">-jackett_docker_security_opts: &quot;{{ jackett_docker_security_opts_default</span><span class="diff-line del">-                                  + jackett_docker_security_opts_custom }}&quot;</span><span class="diff-line add">+jackett_role_docker_networks_alias: &quot;{{ jackett_name }}&quot;</span><span class="diff-line add">+jackett_role_docker_networks_default: []</span><span class="diff-line add">+jackett_role_docker_networks_custom: []</span><span class="diff-line add">+jackett_role_docker_networks: &quot;{{ docker_networks_common</span><span class="diff-line add">+                                  + lookup(&#x27;role_var&#x27;, &#x27;_docker_networks_default&#x27;, role=&#x27;jackett&#x27;)</span><span class="diff-line add">+                                  + lookup(&#x27;role_var&#x27;, &#x27;_docker_networks_custom&#x27;, role=&#x27;jackett&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Restart Policy</span><span class="diff-line del">-jackett_docker_restart_policy: unless-stopped</span><span class="diff-line add">+jackett_role_docker_restart_policy: unless-stopped</span><span class="diff-line context"> </span><span class="diff-line context"> # State</span><span class="diff-line del">-jackett_docker_state: started</span><span class="diff-line add">+jackett_role_docker_state: started</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-206">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/jackett/tasks/main.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -10,9 +10,9 @@</span><span class="diff-line context"> - name: Add DNS record</span><span class="diff-line context">   ansible.builtin.include_tasks: &quot;{{ resources_tasks_path }}/dns/tasker.yml&quot;</span><span class="diff-line context">   vars:</span><span class="diff-line del">-    dns_record: &quot;{{ lookup(&#x27;vars&#x27;, role_name + &#x27;_dns_record&#x27;) }}&quot;</span><span class="diff-line del">-    dns_zone: &quot;{{ lookup(&#x27;vars&#x27;, role_name + &#x27;_dns_zone&#x27;) }}&quot;</span><span class="diff-line del">-    dns_proxy: &quot;{{ lookup(&#x27;vars&#x27;, role_name + &#x27;_dns_proxy&#x27;) }}&quot;</span><span class="diff-line add">+    dns_record: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_dns_record&#x27;) }}&quot;</span><span class="diff-line add">+    dns_zone: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_dns_zone&#x27;) }}&quot;</span><span class="diff-line add">+    dns_proxy: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_dns_proxy&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Remove existing Docker container</span><span class="diff-line context">   ansible.builtin.include_tasks: &quot;{{ resources_tasks_path }}/docker/remove_docker_container.yml&quot;</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-207">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/jellyfin/defaults/main.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -1,10 +1,10 @@</span><span class="diff-line context"> #########################################################################</span><span class="diff-line del">-# Title:         Saltbox: Jellyfin                                      #</span><span class="diff-line del">-# Author(s):     kowalski, desimaniac, owine                            #</span><span class="diff-line del">-# URL:           https://github.com/saltyorg/Saltbox                    #</span><span class="diff-line del">-# --                                                                    #</span><span class="diff-line add">+# Title:         Saltbox: Jellyfin | Default Variables                  #</span><span class="diff-line add">+# Author(s):     kowalski, desimaniac, owine                           #</span><span class="diff-line add">+# URL:           https://github.com/saltyorg/Saltbox                   #</span><span class="diff-line add">+# --                                                                   #</span><span class="diff-line context"> #########################################################################</span><span class="diff-line del">-#                   GNU General Public License v3.0                     #</span><span class="diff-line add">+#                   GNU General Public License v3.0                    #</span><span class="diff-line context"> #########################################################################</span><span class="diff-line context"> ---</span><span class="diff-line context"> ################################</span><span class="diff-line hunk">@@ -17,184 +17,135 @@</span><span class="diff-line context"> # Paths</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-jellyfin_paths_folder: &quot;{{ jellyfin_name }}&quot;</span><span class="diff-line del">-jellyfin_paths_location: &quot;{{ server_appdata_path }}/{{ jellyfin_paths_folder }}&quot;</span><span class="diff-line del">-jellyfin_paths_transcodes_location: &quot;{{ transcodes_path }}/{{ jellyfin_paths_folder }}&quot;</span><span class="diff-line del">-jellyfin_paths_folders_list:</span><span class="diff-line del">-  - &quot;{{ jellyfin_paths_location }}&quot;</span><span class="diff-line del">-  - &quot;{{ jellyfin_paths_location }}/data&quot;</span><span class="diff-line del">-  - &quot;{{ jellyfin_paths_location }}/log&quot;</span><span class="diff-line del">-  - &quot;{{ jellyfin_paths_location }}/cache&quot;</span><span class="diff-line del">-  - &quot;{{ jellyfin_paths_transcodes_location }}&quot;</span><span class="diff-line del">-jellyfin_paths_dlna_location: &quot;{{ jellyfin_paths_location }}/dlna.xml&quot;</span><span class="diff-line del">-jellyfin_paths_sys_xml_location: &quot;{{ jellyfin_paths_location }}/system.xml&quot;</span><span class="diff-line del">-jellyfin_paths_net_xml_location: &quot;{{ jellyfin_paths_location }}/network.xml&quot;</span><span class="diff-line del">-jellyfin_paths_xml_loct_old: &quot;{{ jellyfin_paths_location }}/app/config/system.xml&quot;</span><span class="diff-line add">+jellyfin_role_paths_folder: &quot;{{ jellyfin_name }}&quot;</span><span class="diff-line add">+jellyfin_role_paths_location: &quot;{{ server_appdata_path }}/{{ jellyfin_role_paths_folder }}&quot;</span><span class="diff-line add">+jellyfin_role_paths_transcodes_location: &quot;{{ transcodes_path }}/{{ jellyfin_role_paths_folder }}&quot;</span><span class="diff-line add">+jellyfin_role_paths_folders_list:</span><span class="diff-line add">+  - &quot;{{ jellyfin_role_paths_location }}&quot;</span><span class="diff-line add">+  - &quot;{{ jellyfin_role_paths_location }}/data&quot;</span><span class="diff-line add">+  - &quot;{{ jellyfin_role_paths_location }}/log&quot;</span><span class="diff-line add">+  - &quot;{{ jellyfin_role_paths_location }}/cache&quot;</span><span class="diff-line add">+  - &quot;{{ jellyfin_role_paths_transcodes_location }}&quot;</span><span class="diff-line add">+jellyfin_role_paths_dlna_location: &quot;{{ jellyfin_role_paths_location }}/dlna.xml&quot;</span><span class="diff-line add">+jellyfin_role_paths_sys_xml_location: &quot;{{ jellyfin_role_paths_location }}/system.xml&quot;</span><span class="diff-line add">+jellyfin_role_paths_net_xml_location: &quot;{{ jellyfin_role_paths_location }}/network.xml&quot;</span><span class="diff-line add">+jellyfin_role_paths_xml_location_old: &quot;{{ jellyfin_role_paths_location }}/app/config/system.xml&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # Web</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-jellyfin_web_subdomain: &quot;{{ jellyfin_name }}&quot;</span><span class="diff-line del">-jellyfin_web_domain: &quot;{{ user.domain }}&quot;</span><span class="diff-line del">-jellyfin_web_port: &quot;8096&quot;</span><span class="diff-line del">-jellyfin_web_url: &quot;{{ &#x27;https://&#x27; + (lookup(&#x27;vars&#x27;, jellyfin_name + &#x27;_web_subdomain&#x27;, default=jellyfin_web_subdomain) + &#x27;.&#x27; + lookup(&#x27;vars&#x27;, jellyfin_name + &#x27;_web_domain&#x27;, default=jellyfin_web_domain)</span><span class="diff-line del">-                   if (lookup(&#x27;vars&#x27;, jellyfin_name + &#x27;_web_subdomain&#x27;, default=jellyfin_web_subdomain) | length &gt; 0)</span><span class="diff-line del">-                   else lookup(&#x27;vars&#x27;, jellyfin_name + &#x27;_web_domain&#x27;, default=jellyfin_web_domain)) }}&quot;</span><span class="diff-line add">+jellyfin_role_web_subdomain: &quot;{{ jellyfin_name }}&quot;</span><span class="diff-line add">+jellyfin_role_web_domain: &quot;{{ user.domain }}&quot;</span><span class="diff-line add">+jellyfin_role_web_port: &quot;8096&quot;</span><span class="diff-line add">+jellyfin_role_web_url: &quot;{{ &#x27;https://&#x27; + (lookup(&#x27;role_var&#x27;, &#x27;_web_subdomain&#x27;, role=&#x27;jellyfin&#x27;) + &#x27;.&#x27; + lookup(&#x27;role_var&#x27;, &#x27;_web_domain&#x27;, role=&#x27;jellyfin&#x27;)</span><span class="diff-line add">+                        if (lookup(&#x27;role_var&#x27;, &#x27;_web_subdomain&#x27;, role=&#x27;jellyfin&#x27;) | length &gt; 0)</span><span class="diff-line add">+                        else lookup(&#x27;role_var&#x27;, &#x27;_web_domain&#x27;, role=&#x27;jellyfin&#x27;)) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # DNS</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-jellyfin_dns_record: &quot;{{ lookup(&#x27;vars&#x27;, jellyfin_name + &#x27;_web_subdomain&#x27;, default=jellyfin_web_subdomain) }}&quot;</span><span class="diff-line del">-jellyfin_dns_zone: &quot;{{ lookup(&#x27;vars&#x27;, jellyfin_name + &#x27;_web_domain&#x27;, default=jellyfin_web_domain) }}&quot;</span><span class="diff-line del">-jellyfin_dns_proxy: &quot;{{ dns.proxied }}&quot;</span><span class="diff-line add">+jellyfin_role_dns_record: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_web_subdomain&#x27;, role=&#x27;jellyfin&#x27;) }}&quot;</span><span class="diff-line add">+jellyfin_role_dns_zone: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_web_domain&#x27;, role=&#x27;jellyfin&#x27;) }}&quot;</span><span class="diff-line add">+jellyfin_role_dns_proxy: &quot;{{ dns_proxied }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # Traefik</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-jellyfin_traefik_sso_middleware: &quot;&quot;</span><span class="diff-line del">-jellyfin_traefik_middleware_default: &quot;{{ traefik_default_middleware }}&quot;</span><span class="diff-line del">-jellyfin_traefik_middleware_custom: &quot;&quot;</span><span class="diff-line del">-jellyfin_traefik_certresolver: &quot;{{ traefik_default_certresolver }}&quot;</span><span class="diff-line del">-jellyfin_traefik_enabled: true</span><span class="diff-line del">-jellyfin_traefik_api_enabled: false</span><span class="diff-line del">-jellyfin_traefik_api_endpoint: &quot;&quot;</span><span class="diff-line del">-jellyfin_traefik_gzip_enabled: false</span><span class="diff-line add">+jellyfin_role_traefik_sso_middleware: &quot;&quot;</span><span class="diff-line add">+jellyfin_role_traefik_middleware_default: &quot;{{ traefik_default_middleware }}&quot;</span><span class="diff-line add">+jellyfin_role_traefik_middleware_custom: &quot;&quot;</span><span class="diff-line add">+jellyfin_role_traefik_certresolver: &quot;{{ traefik_default_certresolver }}&quot;</span><span class="diff-line add">+jellyfin_role_traefik_enabled: true</span><span class="diff-line add">+jellyfin_role_traefik_api_enabled: false</span><span class="diff-line add">+jellyfin_role_traefik_api_endpoint: &quot;&quot;</span><span class="diff-line add">+jellyfin_role_traefik_gzip_enabled: false</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # Config</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line context"> # System</span><span class="diff-line del">-jellyfin_system_settings_default:</span><span class="diff-line add">+jellyfin_role_system_settings_default:</span><span class="diff-line context">   - { xpath: &#x27;PublicPort&#x27;, value: &#x27;80&#x27; }</span><span class="diff-line context">   - { xpath: &#x27;PublicHttpsPort&#x27;, value: &#x27;443&#x27; }</span><span class="diff-line context">   - { xpath: &#x27;EnableFolderView&#x27;, value: &#x27;true&#x27; }</span><span class="diff-line context">   - { xpath: &#x27;QuickConnectAvailable&#x27;, value: &#x27;true&#x27; }</span><span class="diff-line context">   - { xpath: &#x27;EnableRemoteAccess&#x27;, value: &#x27;true&#x27; }</span><span class="diff-line context">   - { xpath: &#x27;ServerName&#x27;, value: &#x27;saltbox&#x27; }</span><span class="diff-line del">-jellyfin_system_settings_custom: []</span><span class="diff-line del">-jellyfin_system_settings_list: &quot;{{ lookup(&#x27;vars&#x27;, jellyfin_name + &#x27;_system_settings_default&#x27;, default=jellyfin_system_settings_default) + lookup(&#x27;vars&#x27;, jellyfin_name + &#x27;_system_settings_custom&#x27;, default=jellyfin_system_settings_custom) }}&quot;</span><span class="diff-line add">+jellyfin_role_system_settings_custom: []</span><span class="diff-line add">+jellyfin_role_system_settings_list: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_system_settings_default&#x27;, role=&#x27;jellyfin&#x27;) + lookup(&#x27;role_var&#x27;, &#x27;_system_settings_custom&#x27;, role=&#x27;jellyfin&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Network</span><span class="diff-line del">-jellyfin_network_settings_default:</span><span class="diff-line add">+jellyfin_role_network_settings_default:</span><span class="diff-line context">   - { xpath: &#x27;KnownProxies&#x27;, value: &#x27;traefik&#x27; }</span><span class="diff-line context">   - { xpath: &#x27;PublicPort&#x27;, value: &#x27;80&#x27; }</span><span class="diff-line context">   - { xpath: &#x27;PublicHttpsPort&#x27;, value: &#x27;443&#x27; }</span><span class="diff-line del">-  - { xpath: &#x27;PublishedServerUriBySubnet/string&#x27;, value: &#x27;external={{ jellyfin_web_url }}:443&#x27; }</span><span class="diff-line del">-jellyfin_network_settings_custom: []</span><span class="diff-line del">-jellyfin_network_settings_list: &quot;{{ lookup(&#x27;vars&#x27;, jellyfin_name + &#x27;_network_settings_default&#x27;, default=jellyfin_network_settings_default) + lookup(&#x27;vars&#x27;, jellyfin_name + &#x27;_network_settings_custom&#x27;, default=jellyfin_network_settings_custom) }}&quot;</span><span class="diff-line add">+  - { xpath: &#x27;PublishedServerUriBySubnet/string&#x27;, value: &#x27;external={{ lookup(&quot;role_var&quot;, &quot;_web_url&quot;, role=&quot;jellyfin&quot;) }}:443&#x27; }</span><span class="diff-line add">+jellyfin_role_network_settings_custom: []</span><span class="diff-line add">+jellyfin_role_network_settings_list: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_network_settings_default&#x27;, role=&#x27;jellyfin&#x27;) + lookup(&#x27;role_var&#x27;, &#x27;_network_settings_custom&#x27;, role=&#x27;jellyfin&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # Docker</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line context"> # Container</span><span class="diff-line del">-jellyfin_docker_container: &quot;{{ jellyfin_name }}&quot;</span><span class="diff-line add">+jellyfin_role_docker_container: &quot;{{ jellyfin_name }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Image</span><span class="diff-line del">-jellyfin_docker_image_pull: true</span><span class="diff-line del">-jellyfin_docker_image_repo: &quot;ghcr.io/hotio/jellyfin&quot;</span><span class="diff-line del">-jellyfin_docker_image_tag: &quot;release&quot;</span><span class="diff-line del">-jellyfin_docker_image: &quot;{{ lookup(&#x27;vars&#x27;, jellyfin_name + &#x27;_docker_image_repo&#x27;, default=jellyfin_docker_image_repo)</span><span class="diff-line del">-                           + &#x27;:&#x27; + lookup(&#x27;vars&#x27;, jellyfin_name + &#x27;_docker_image_tag&#x27;, default=jellyfin_docker_image_tag) }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Ports</span><span class="diff-line del">-jellyfin_docker_ports_defaults: []</span><span class="diff-line del">-jellyfin_docker_ports_custom: []</span><span class="diff-line del">-jellyfin_docker_ports: &quot;{{ lookup(&#x27;vars&#x27;, jellyfin_name + &#x27;_docker_ports_defaults&#x27;, default=jellyfin_docker_ports_defaults)</span><span class="diff-line del">-                           + lookup(&#x27;vars&#x27;, jellyfin_name + &#x27;_docker_ports_custom&#x27;, default=jellyfin_docker_ports_custom) }}&quot;</span><span class="diff-line add">+jellyfin_role_docker_image_pull: true</span><span class="diff-line add">+jellyfin_role_docker_image_repo: &quot;ghcr.io/hotio/jellyfin&quot;</span><span class="diff-line add">+jellyfin_role_docker_image_tag: &quot;release&quot;</span><span class="diff-line add">+jellyfin_role_docker_image: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_image_repo&#x27;, role=&#x27;jellyfin&#x27;) }}:{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_image_tag&#x27;, role=&#x27;jellyfin&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Envs</span><span class="diff-line del">-jellyfin_docker_envs_default:</span><span class="diff-line add">+jellyfin_role_docker_envs_default:</span><span class="diff-line context">   PUID: &quot;{{ uid }}&quot;</span><span class="diff-line context">   PGID: &quot;{{ gid }}&quot;</span><span class="diff-line context">   TZ: &quot;{{ tz }}&quot;</span><span class="diff-line context">   DOTNET_USE_POLLING_FILE_WATCHER: &quot;1&quot;</span><span class="diff-line del">-jellyfin_docker_envs_custom: {}</span><span class="diff-line del">-jellyfin_docker_envs: &quot;{{ lookup(&#x27;vars&#x27;, jellyfin_name + &#x27;_docker_envs_default&#x27;, default=jellyfin_docker_envs_default)</span><span class="diff-line del">-                          | combine(lookup(&#x27;vars&#x27;, jellyfin_name + &#x27;_docker_envs_custom&#x27;, default=jellyfin_docker_envs_custom)) }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Commands</span><span class="diff-line del">-jellyfin_docker_commands_default: []</span><span class="diff-line del">-jellyfin_docker_commands_custom: []</span><span class="diff-line del">-jellyfin_docker_commands: &quot;{{ lookup(&#x27;vars&#x27;, jellyfin_name + &#x27;_docker_commands_default&#x27;, default=jellyfin_docker_commands_default)</span><span class="diff-line del">-                              + lookup(&#x27;vars&#x27;, jellyfin_name + &#x27;_docker_commands_custom&#x27;, default=jellyfin_docker_commands_custom) }}&quot;</span><span class="diff-line add">+jellyfin_role_docker_envs_custom: {}</span><span class="diff-line add">+jellyfin_role_docker_envs: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_envs_default&#x27;, role=&#x27;jellyfin&#x27;)</span><span class="diff-line add">+                               | combine(lookup(&#x27;role_var&#x27;, &#x27;_docker_envs_custom&#x27;, role=&#x27;jellyfin&#x27;)) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Volumes</span><span class="diff-line del">-jellyfin_docker_volumes_default:</span><span class="diff-line del">-  - &quot;{{ jellyfin_paths_location }}:/config:rw&quot;</span><span class="diff-line add">+jellyfin_role_docker_volumes_default:</span><span class="diff-line add">+  - &quot;{{ jellyfin_role_paths_location }}:/config:rw&quot;</span><span class="diff-line context">   - &quot;{{ server_appdata_path }}/scripts:/scripts&quot;</span><span class="diff-line context">   - &quot;/dev/shm:/dev/shm&quot;</span><span class="diff-line del">-  - &quot;{{ jellyfin_paths_transcodes_location }}:/transcode&quot;</span><span class="diff-line del">-jellyfin_docker_volumes_legacy:</span><span class="diff-line add">+  - &quot;{{ jellyfin_role_paths_transcodes_location }}:/transcode&quot;</span><span class="diff-line add">+jellyfin_role_docker_volumes_legacy:</span><span class="diff-line context">   - &quot;/mnt/unionfs/Media:/data&quot;</span><span class="diff-line del">-jellyfin_docker_volumes_custom: []</span><span class="diff-line del">-jellyfin_docker_volumes: &quot;{{ lookup(&#x27;vars&#x27;, jellyfin_name + &#x27;_docker_volumes_default&#x27;, default=jellyfin_docker_volumes_default)</span><span class="diff-line del">-                             + lookup(&#x27;vars&#x27;, jellyfin_name + &#x27;_docker_volumes_custom&#x27;, default=jellyfin_docker_volumes_custom)</span><span class="diff-line del">-                             + (lookup(&#x27;vars&#x27;, jellyfin_name + &#x27;_docker_volumes_legacy&#x27;, default=jellyfin_docker_volumes_legacy)</span><span class="diff-line del">-                               if docker_legacy_volume</span><span class="diff-line del">-                               else []) }}&quot;</span><span class="diff-line add">+jellyfin_role_docker_volumes_custom: []</span><span class="diff-line add">+jellyfin_role_docker_volumes: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_volumes_default&#x27;, role=&#x27;jellyfin&#x27;)</span><span class="diff-line add">+                                  + lookup(&#x27;role_var&#x27;, &#x27;_docker_volumes_custom&#x27;, role=&#x27;jellyfin&#x27;)</span><span class="diff-line add">+                                  + (lookup(&#x27;role_var&#x27;, &#x27;_docker_volumes_legacy&#x27;, role=&#x27;jellyfin&#x27;)</span><span class="diff-line add">+                                    if docker_legacy_volume</span><span class="diff-line add">+                                    else []) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Mounts</span><span class="diff-line del">-jellyfin_docker_mounts_default:</span><span class="diff-line add">+jellyfin_role_docker_mounts_default:</span><span class="diff-line context">   - target: /tmp</span><span class="diff-line context">     type: tmpfs</span><span class="diff-line del">-jellyfin_docker_mounts_custom: []</span><span class="diff-line del">-jellyfin_docker_mounts: &quot;{{ lookup(&#x27;vars&#x27;, jellyfin_name + &#x27;_docker_mounts_default&#x27;, default=jellyfin_docker_mounts_default)</span><span class="diff-line del">-                            + lookup(&#x27;vars&#x27;, jellyfin_name + &#x27;_docker_mounts_custom&#x27;, default=jellyfin_docker_mounts_custom) }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Devices</span><span class="diff-line del">-jellyfin_docker_devices_default: []</span><span class="diff-line del">-jellyfin_docker_devices_custom: []</span><span class="diff-line del">-jellyfin_docker_devices: &quot;{{ lookup(&#x27;vars&#x27;, jellyfin_name + &#x27;_docker_devices_default&#x27;, default=jellyfin_docker_devices_default)</span><span class="diff-line del">-                             + lookup(&#x27;vars&#x27;, jellyfin_name + &#x27;_docker_devices_custom&#x27;, default=jellyfin_docker_devices_custom) }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Hosts</span><span class="diff-line del">-jellyfin_docker_hosts_default: {}</span><span class="diff-line del">-jellyfin_docker_hosts_custom: {}</span><span class="diff-line del">-jellyfin_docker_hosts: &quot;{{ docker_hosts_common</span><span class="diff-line del">-                           | combine(lookup(&#x27;vars&#x27;, jellyfin_name + &#x27;_docker_hosts_default&#x27;, default=jellyfin_docker_hosts_default))</span><span class="diff-line del">-                           | combine(lookup(&#x27;vars&#x27;, jellyfin_name + &#x27;_docker_hosts_custom&#x27;, default=jellyfin_docker_hosts_custom)) }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Labels</span><span class="diff-line del">-jellyfin_docker_labels_default: {}</span><span class="diff-line del">-jellyfin_docker_labels_custom: {}</span><span class="diff-line del">-jellyfin_docker_labels: &quot;{{ docker_labels_common</span><span class="diff-line del">-                            | combine(lookup(&#x27;vars&#x27;, jellyfin_name + &#x27;_docker_labels_default&#x27;, default=jellyfin_docker_labels_default))</span><span class="diff-line del">-                            | combine(lookup(&#x27;vars&#x27;, jellyfin_name + &#x27;_docker_labels_custom&#x27;, default=jellyfin_docker_labels_custom)) }}&quot;</span><span class="diff-line add">+jellyfin_role_docker_mounts_custom: []</span><span class="diff-line add">+jellyfin_role_docker_mounts: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_mounts_default&#x27;, role=&#x27;jellyfin&#x27;)</span><span class="diff-line add">+                                 + lookup(&#x27;role_var&#x27;, &#x27;_docker_mounts_custom&#x27;, role=&#x27;jellyfin&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Hostname</span><span class="diff-line del">-jellyfin_docker_hostname: &quot;{{ jellyfin_name }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Network Mode</span><span class="diff-line del">-jellyfin_docker_network_mode_default: &quot;{{ docker_networks_name_common }}&quot;</span><span class="diff-line del">-jellyfin_docker_network_mode: &quot;{{ lookup(&#x27;vars&#x27;, jellyfin_name + &#x27;_docker_network_mode_default&#x27;, default=jellyfin_docker_network_mode_default) }}&quot;</span><span class="diff-line add">+jellyfin_role_docker_hostname: &quot;{{ jellyfin_name }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Networks</span><span class="diff-line del">-jellyfin_docker_networks_alias: &quot;{{ jellyfin_name }}&quot;</span><span class="diff-line del">-jellyfin_docker_networks_default: []</span><span class="diff-line del">-jellyfin_docker_networks_custom: []</span><span class="diff-line del">-jellyfin_docker_networks: &quot;{{ docker_networks_common</span><span class="diff-line del">-                              + lookup(&#x27;vars&#x27;, jellyfin_name + &#x27;_docker_networks_default&#x27;, default=jellyfin_docker_networks_default)</span><span class="diff-line del">-                              + lookup(&#x27;vars&#x27;, jellyfin_name + &#x27;_docker_networks_custom&#x27;, default=jellyfin_docker_networks_custom) }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Capabilities</span><span class="diff-line del">-jellyfin_docker_capabilities_default: []</span><span class="diff-line del">-jellyfin_docker_capabilities_custom: []</span><span class="diff-line del">-jellyfin_docker_capabilities: &quot;{{ lookup(&#x27;vars&#x27;, jellyfin_name + &#x27;_docker_capabilities_default&#x27;, default=jellyfin_docker_capabilities_default)</span><span class="diff-line del">-                                  + lookup(&#x27;vars&#x27;, jellyfin_name + &#x27;_docker_capabilities_custom&#x27;, default=jellyfin_docker_capabilities_custom) }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Security Opts</span><span class="diff-line del">-jellyfin_docker_security_opts_default: []</span><span class="diff-line del">-jellyfin_docker_security_opts_custom: []</span><span class="diff-line del">-jellyfin_docker_security_opts: &quot;{{ lookup(&#x27;vars&#x27;, jellyfin_name + &#x27;_docker_security_opts_default&#x27;, default=jellyfin_docker_security_opts_default)</span><span class="diff-line del">-                                   + lookup(&#x27;vars&#x27;, jellyfin_name + &#x27;_docker_security_opts_custom&#x27;, default=jellyfin_docker_security_opts_custom) }}&quot;</span><span class="diff-line add">+jellyfin_role_docker_networks_alias: &quot;{{ jellyfin_name }}&quot;</span><span class="diff-line add">+jellyfin_role_docker_networks_default: []</span><span class="diff-line add">+jellyfin_role_docker_networks_custom: []</span><span class="diff-line add">+jellyfin_role_docker_networks: &quot;{{ docker_networks_common</span><span class="diff-line add">+                                   + lookup(&#x27;role_var&#x27;, &#x27;_docker_networks_default&#x27;, role=&#x27;jellyfin&#x27;)</span><span class="diff-line add">+                                   + lookup(&#x27;role_var&#x27;, &#x27;_docker_networks_custom&#x27;, role=&#x27;jellyfin&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Restart Policy</span><span class="diff-line del">-jellyfin_docker_restart_policy: unless-stopped</span><span class="diff-line add">+jellyfin_role_docker_restart_policy: unless-stopped</span><span class="diff-line context"> </span><span class="diff-line context"> # State</span><span class="diff-line del">-jellyfin_docker_state: started</span><span class="diff-line add">+jellyfin_role_docker_state: started</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-208">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/jellyfin/tasks/main2.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -9,9 +9,9 @@</span><span class="diff-line context"> - name: Add DNS record</span><span class="diff-line context">   ansible.builtin.include_tasks: &quot;{{ resources_tasks_path }}/dns/tasker.yml&quot;</span><span class="diff-line context">   vars:</span><span class="diff-line del">-    dns_record: &quot;{{ lookup(&#x27;vars&#x27;, role_name + &#x27;_dns_record&#x27;) }}&quot;</span><span class="diff-line del">-    dns_zone: &quot;{{ lookup(&#x27;vars&#x27;, role_name + &#x27;_dns_zone&#x27;) }}&quot;</span><span class="diff-line del">-    dns_proxy: &quot;{{ lookup(&#x27;vars&#x27;, role_name + &#x27;_dns_proxy&#x27;) }}&quot;</span><span class="diff-line add">+    dns_record: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_dns_record&#x27;) }}&quot;</span><span class="diff-line add">+    dns_zone: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_dns_zone&#x27;) }}&quot;</span><span class="diff-line add">+    dns_proxy: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_dns_proxy&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Remove existing Docker container</span><span class="diff-line context">   ansible.builtin.include_tasks: &quot;{{ resources_tasks_path }}/docker/remove_docker_container.yml&quot;</span><span class="diff-line hunk">@@ -21,17 +21,17 @@</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Docker Devices Task</span><span class="diff-line context">   ansible.builtin.include_tasks: &quot;{{ resources_tasks_path }}/docker/set_docker_devices_variable.yml&quot;</span><span class="diff-line del">-  when: gpu.intel or use_nvidia</span><span class="diff-line add">+  when: use_intel or use_nvidia</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Import preinstall task</span><span class="diff-line del">-  ansible.builtin.import_tasks: &quot;subtasks/preinstall.yml&quot;</span><span class="diff-line add">+  ansible.builtin.include_tasks: &quot;subtasks/preinstall.yml&quot;</span><span class="diff-line context">   when: (not continuous_integration)</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Create Docker container</span><span class="diff-line context">   ansible.builtin.include_tasks: &quot;{{ resources_tasks_path }}/docker/create_docker_container.yml&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Import postinstall task</span><span class="diff-line del">-  ansible.builtin.import_tasks: &quot;subtasks/postinstall.yml&quot;</span><span class="diff-line add">+  ansible.builtin.include_tasks: &quot;subtasks/postinstall.yml&quot;</span><span class="diff-line context">   when:</span><span class="diff-line context">     - (not continuous_integration)</span><span class="diff-line context">     - (not jellyfin_existing_install.stat.exists)</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-209">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/jellyfin/tasks/subtasks/postinstall.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -12,7 +12,7 @@</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Post-Install | Ensure transcodes folder has the correct permissions</span><span class="diff-line context">   ansible.builtin.file:</span><span class="diff-line del">-    path: &quot;{{ jellyfin_paths_transcodes_location }}&quot;</span><span class="diff-line add">+    path: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_transcodes_location&#x27;, role=&#x27;jellyfin&#x27;) }}&quot;</span><span class="diff-line context">     owner: &quot;{{ user.name }}&quot;</span><span class="diff-line context">     group: &quot;{{ user.name }}&quot;</span><span class="diff-line context">     mode: &quot;0775&quot;</span><span class="diff-line hunk">@@ -20,12 +20,12 @@</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Post-Install | Ensure config folder has the correct permissions</span><span class="diff-line context">   ansible.builtin.file:</span><span class="diff-line del">-    path: &quot;{{ jellyfin_paths_location }}&quot;</span><span class="diff-line add">+    path: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_location&#x27;, role=&#x27;jellyfin&#x27;) }}&quot;</span><span class="diff-line context">     owner: &quot;{{ user.name }}&quot;</span><span class="diff-line context">     group: &quot;{{ user.name }}&quot;</span><span class="diff-line context">     mode: &quot;0775&quot;</span><span class="diff-line context">     recurse: true</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Post-Install | Settings Tasks</span><span class="diff-line del">-  ansible.builtin.import_tasks: &quot;settings.yml&quot;</span><span class="diff-line add">+  ansible.builtin.include_tasks: &quot;subtasks/settings.yml&quot;</span><span class="diff-line context">   when: (not jellyfin_existing_install.stat.exists)</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-210">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/jellyfin/tasks/subtasks/preinstall.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -11,26 +11,26 @@</span><span class="diff-line context"> # Migrate old non hotio setup</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-- name: Preinstall MIGRATE | Check if `{{ jellyfin_paths_xml_loct_old | basename }}` exists</span><span class="diff-line add">+- name: Preinstall | Check if `{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_xml_location_old&#x27;, role=&#x27;jellyfin&#x27;) | basename }}` exists</span><span class="diff-line context">   ansible.builtin.stat:</span><span class="diff-line del">-    path: &quot;{{ jellyfin_paths_xml_loct_old }}&quot;</span><span class="diff-line add">+    path: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_xml_location_old&#x27;, role=&#x27;jellyfin&#x27;) }}&quot;</span><span class="diff-line context">   register: jellyfin_xml_old</span><span class="diff-line context"> </span><span class="diff-line del">-- name: Preinstall MIGRATE | New `{{ jellyfin_paths_xml_loct_old | basename }}` tasks</span><span class="diff-line add">+- name: Preinstall | New `{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_xml_location_old&#x27;, role=&#x27;jellyfin&#x27;) | basename }}` tasks</span><span class="diff-line context">   when: jellyfin_xml_old.stat.exists</span><span class="diff-line context">   block:</span><span class="diff-line del">-    - name: Preinstall MIGRATE | Import `{{ jellyfin_paths_xml_loct_old | basename }}` if it exists</span><span class="diff-line add">+    - name: Preinstall | Import `{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_xml_location_old&#x27;, role=&#x27;jellyfin&#x27;) | basename }}` if it exists</span><span class="diff-line context">       ansible.builtin.copy:</span><span class="diff-line del">-        src: &quot;{{ jellyfin_paths_xml_loct_old }}&quot;</span><span class="diff-line del">-        dest: &quot;{{ jellyfin_paths_sys_xml_location }}&quot;</span><span class="diff-line add">+        src: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_xml_location_old&#x27;, role=&#x27;jellyfin&#x27;) }}&quot;</span><span class="diff-line add">+        dest: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_sys_xml_location&#x27;, role=&#x27;jellyfin&#x27;) }}&quot;</span><span class="diff-line context">         owner: &quot;{{ user.name }}&quot;</span><span class="diff-line context">         group: &quot;{{ user.name }}&quot;</span><span class="diff-line context">         mode: &quot;0664&quot;</span><span class="diff-line context">         force: false</span><span class="diff-line context"> </span><span class="diff-line del">-    - name: Preinstall MIGRATE | Remove old `{{ jellyfin_paths_xml_loct_old | basename }}` if it exists&quot;</span><span class="diff-line add">+    - name: Preinstall | Remove old `{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_xml_location_old&#x27;, role=&#x27;jellyfin&#x27;) | basename }}` if it exists&quot;</span><span class="diff-line context">       ansible.builtin.file:</span><span class="diff-line del">-        path: &quot;{{ jellyfin_paths_xml_loct_old }}&quot;</span><span class="diff-line add">+        path: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_xml_location_old&#x27;, role=&#x27;jellyfin&#x27;) }}&quot;</span><span class="diff-line context">         state: absent</span><span class="diff-line context"> </span><span class="diff-line context"> # Low priority as migrate should not be needed.</span><span class="diff-line hunk">@@ -41,46 +41,46 @@</span><span class="diff-line context"> # Register | STATS &#x27;n&#x27; FACTS</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-- name: Preinstall STAT | Check if `{{ jellyfin_paths_sys_xml_location | basename }}` exists</span><span class="diff-line add">+- name: Preinstall | Check if `{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_sys_xml_location&#x27;, role=&#x27;jellyfin&#x27;) | basename }}` exists</span><span class="diff-line context">   ansible.builtin.stat:</span><span class="diff-line del">-    path: &quot;{{ jellyfin_paths_sys_xml_location }}&quot;</span><span class="diff-line add">+    path: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_sys_xml_location&#x27;, role=&#x27;jellyfin&#x27;) }}&quot;</span><span class="diff-line context">   register: jellyfin_sys_xml</span><span class="diff-line context"> </span><span class="diff-line del">-- name: Preinstall STAT | Check also if `{{ jellyfin_paths_sys_xml_location | basename }}` exists</span><span class="diff-line add">+- name: Preinstall | Check also if `{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_sys_xml_location&#x27;, role=&#x27;jellyfin&#x27;) | basename }}` exists</span><span class="diff-line context">   ansible.builtin.stat:</span><span class="diff-line del">-    path: &quot;{{ jellyfin_paths_sys_xml_location }}&quot;</span><span class="diff-line add">+    path: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_sys_xml_location&#x27;, role=&#x27;jellyfin&#x27;) }}&quot;</span><span class="diff-line context">   register: jellyfin_existing_install</span><span class="diff-line context"> </span><span class="diff-line del">-- name: Preinstall STAT | Check if `{{ jellyfin_paths_net_xml_location | basename }}` exists</span><span class="diff-line add">+- name: Preinstall | Check if `{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_net_xml_location&#x27;, role=&#x27;jellyfin&#x27;) | basename }}` exists</span><span class="diff-line context">   ansible.builtin.stat:</span><span class="diff-line del">-    path: &quot;{{ jellyfin_paths_net_xml_location }}&quot;</span><span class="diff-line add">+    path: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_net_xml_location&#x27;, role=&#x27;jellyfin&#x27;) }}&quot;</span><span class="diff-line context">   register: network_xml</span><span class="diff-line context"> </span><span class="diff-line del">-- name: Preinstall STAT | Check if `{{ jellyfin_paths_dlna_location | basename }}` exists</span><span class="diff-line add">+- name: Preinstall | Check if `{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_dlna_location&#x27;, role=&#x27;jellyfin&#x27;) | basename }}` exists</span><span class="diff-line context">   ansible.builtin.stat:</span><span class="diff-line del">-    path: &quot;{{ jellyfin_paths_dlna_location }}&quot;</span><span class="diff-line add">+    path: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_dlna_location&#x27;, role=&#x27;jellyfin&#x27;) }}&quot;</span><span class="diff-line context">   register: jellyfin_dlna</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # Block DLNA network spam</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-- name: Import &#x27;dlna.xml&#x27; config</span><span class="diff-line add">+- name: Preinstall | Import &#x27;dlna.xml&#x27; config</span><span class="diff-line context">   ansible.builtin.copy:</span><span class="diff-line context">     src: &quot;dlna.xml&quot;</span><span class="diff-line del">-    dest: &quot;{{ jellyfin_paths_dlna_location }}&quot;</span><span class="diff-line add">+    dest: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_dlna_location&#x27;, role=&#x27;jellyfin&#x27;) }}&quot;</span><span class="diff-line context">     owner: &quot;{{ user.name }}&quot;</span><span class="diff-line context">     group: &quot;{{ user.name }}&quot;</span><span class="diff-line context">     mode: &quot;0664&quot;</span><span class="diff-line context">     force: false</span><span class="diff-line context">   when: (not jellyfin_dlna.stat.exists)</span><span class="diff-line context"> </span><span class="diff-line del">-- name: Settings | Update &#x27;network.xml&#x27; file</span><span class="diff-line add">+- name: Preinstall | Update &#x27;network.xml&#x27; file</span><span class="diff-line context">   community.general.xml:</span><span class="diff-line del">-    path: &quot;{{ jellyfin_paths_net_xml_location }}&quot;</span><span class="diff-line add">+    path: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_net_xml_location&#x27;, role=&#x27;jellyfin&#x27;) }}&quot;</span><span class="diff-line context">     xpath: &quot;/NetworkConfiguration/{{ item.xpath }}&quot;</span><span class="diff-line context">     value: &quot;{{ item.value }}&quot;</span><span class="diff-line context">   become: true</span><span class="diff-line context">   become_user: &quot;{{ user.name }}&quot;</span><span class="diff-line del">-  loop: &quot;{{ jellyfin_network_settings_list }}&quot;</span><span class="diff-line add">+  loop: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_network_settings_list&#x27;, role=&#x27;jellyfin&#x27;) }}&quot;</span><span class="diff-line context">   when: network_xml.stat.exists</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-211">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/jellyfin/tasks/subtasks/settings.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -6,43 +6,43 @@</span><span class="diff-line context"> #                   GNU General Public License v3.0                     #</span><span class="diff-line context"> #########################################################################</span><span class="diff-line context"> ---</span><span class="diff-line del">-- name: Restart Docker container</span><span class="diff-line add">+- name: Settings | Restart Docker container</span><span class="diff-line context">   ansible.builtin.include_tasks: &quot;{{ resources_tasks_path }}/docker/restart_docker_container.yml&quot;</span><span class="diff-line context"> </span><span class="diff-line del">-- name: Post-Install | Wait for &#x27;system.xml&#x27; file to be created</span><span class="diff-line add">+- name: Settings | Wait for &#x27;system.xml&#x27; file to be created</span><span class="diff-line context">   ansible.builtin.wait_for:</span><span class="diff-line del">-    path: &quot;{{ jellyfin_paths_sys_xml_location }}&quot;</span><span class="diff-line add">+    path: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_sys_xml_location&#x27;, role=&#x27;jellyfin&#x27;) }}&quot;</span><span class="diff-line context">     state: present</span><span class="diff-line context"> </span><span class="diff-line del">-- name: &quot;Post-Install | Prompt user to complete the wizard&quot;</span><span class="diff-line add">+- name: &quot;Settings | Prompt user to complete the wizard&quot;</span><span class="diff-line context">   ansible.builtin.pause:</span><span class="diff-line del">-    prompt: &quot;Please open {{ jellyfin_web_url }}/web/index.html#!/wizardstart.html. Hit enter after having finished the wizard&quot;</span><span class="diff-line add">+    prompt: &quot;Please open {{ lookup(&#x27;role_var&#x27;, &#x27;_web_url&#x27;, role=&#x27;jellyfin&#x27;) }}/web/index.html#!/wizardstart.html. Hit enter after having finished the wizard&quot;</span><span class="diff-line context"> </span><span class="diff-line del">-- name: Post-Install | Wait for &#x27;network.xml&#x27; file to be created</span><span class="diff-line add">+- name: Settings | Wait for &#x27;network.xml&#x27; file to be created</span><span class="diff-line context">   ansible.builtin.wait_for:</span><span class="diff-line del">-    path: &quot;{{ jellyfin_paths_net_xml_location }}&quot;</span><span class="diff-line add">+    path: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_net_xml_location&#x27;, role=&#x27;jellyfin&#x27;) }}&quot;</span><span class="diff-line context">     state: present</span><span class="diff-line context"> </span><span class="diff-line del">-- name: Stop Docker container</span><span class="diff-line add">+- name: Settings | Stop Docker container</span><span class="diff-line context">   ansible.builtin.include_tasks: &quot;{{ resources_tasks_path }}/docker/stop_docker_container.yml&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Settings | Update &#x27;system.xml&#x27; file</span><span class="diff-line context">   community.general.xml:</span><span class="diff-line del">-    path: &quot;{{ jellyfin_paths_sys_xml_location }}&quot;</span><span class="diff-line add">+    path: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_sys_xml_location&#x27;, role=&#x27;jellyfin&#x27;) }}&quot;</span><span class="diff-line context">     xpath: &quot;/ServerConfiguration/{{ item.xpath }}&quot;</span><span class="diff-line context">     value: &quot;{{ item.value }}&quot;</span><span class="diff-line context">   become: true</span><span class="diff-line context">   become_user: &quot;{{ user.name }}&quot;</span><span class="diff-line del">-  loop: &quot;{{ jellyfin_system_settings_list }}&quot;</span><span class="diff-line add">+  loop: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_system_settings_list&#x27;, role=&#x27;jellyfin&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Settings | Update &#x27;network.xml&#x27; file</span><span class="diff-line context">   community.general.xml:</span><span class="diff-line del">-    path: &quot;{{ jellyfin_paths_net_xml_location }}&quot;</span><span class="diff-line add">+    path: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_net_xml_location&#x27;, role=&#x27;jellyfin&#x27;) }}&quot;</span><span class="diff-line context">     xpath: &quot;/NetworkConfiguration/{{ item.xpath }}&quot;</span><span class="diff-line context">     value: &quot;{{ item.value }}&quot;</span><span class="diff-line context">   become: true</span><span class="diff-line context">   become_user: &quot;{{ user.name }}&quot;</span><span class="diff-line del">-  loop: &quot;{{ jellyfin_network_settings_list }}&quot;</span><span class="diff-line add">+  loop: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_network_settings_list&#x27;, role=&#x27;jellyfin&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line del">-- name: Start Docker container</span><span class="diff-line add">+- name: Settings | Start Docker container</span><span class="diff-line context">   ansible.builtin.include_tasks: &quot;{{ resources_tasks_path }}/docker/start_docker_container.yml&quot;</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-212">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/kernel/tasks/main.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -18,9 +18,9 @@</span><span class="diff-line context"> - name: Ubuntu 20.04 HWE Update Tasks</span><span class="diff-line context">   ansible.builtin.include_tasks: &quot;subtasks/03_update_focal.yml&quot;</span><span class="diff-line context">   when:</span><span class="diff-line del">-    - (ansible_distribution == &#x27;Ubuntu&#x27;)</span><span class="diff-line del">-    - (ansible_distribution_version is version(&#x27;20.04&#x27;, &#x27;==&#x27;))</span><span class="diff-line del">-    - (ansible_kernel is version(&#x27;5.8&#x27;, &#x27;&lt;&#x27;))</span><span class="diff-line add">+    - (ansible_facts[&#x27;distribution&#x27;] == &#x27;Ubuntu&#x27;)</span><span class="diff-line add">+    - (ansible_facts[&#x27;distribution_version&#x27;] is version(&#x27;20.04&#x27;, &#x27;==&#x27;))</span><span class="diff-line add">+    - (ansible_facts[&#x27;kernel&#x27;] is version(&#x27;5.8&#x27;, &#x27;&lt;&#x27;))</span><span class="diff-line context">     - (not continuous_integration)</span><span class="diff-line context">     - kernel_install_hwe</span><span class="diff-line context"> </span><span class="diff-line hunk">@@ -28,9 +28,9 @@</span><span class="diff-line context"> - name: Ubuntu 22.04 Update Tasks</span><span class="diff-line context">   ansible.builtin.include_tasks: &quot;subtasks/04_update_jammy.yml&quot;</span><span class="diff-line context">   when:</span><span class="diff-line del">-    - (ansible_distribution == &#x27;Ubuntu&#x27;)</span><span class="diff-line del">-    - (ansible_distribution_version is version(&#x27;22.04&#x27;, &#x27;==&#x27;))</span><span class="diff-line del">-    - (ansible_kernel is version(&#x27;5.19&#x27;, &#x27;&lt;&#x27;))</span><span class="diff-line add">+    - (ansible_facts[&#x27;distribution&#x27;] == &#x27;Ubuntu&#x27;)</span><span class="diff-line add">+    - (ansible_facts[&#x27;distribution_version&#x27;] is version(&#x27;22.04&#x27;, &#x27;==&#x27;))</span><span class="diff-line add">+    - (ansible_facts[&#x27;kernel&#x27;] is version(&#x27;5.19&#x27;, &#x27;&lt;&#x27;))</span><span class="diff-line context">     - (not continuous_integration)</span><span class="diff-line context">     - kernel_install_hwe</span><span class="diff-line context"> </span><span class="diff-line hunk">@@ -38,9 +38,9 @@</span><span class="diff-line context"> - name: Ubuntu 24.04 Update Tasks</span><span class="diff-line context">   ansible.builtin.include_tasks: &quot;subtasks/05_update_noble.yml&quot;</span><span class="diff-line context">   when:</span><span class="diff-line del">-    - (ansible_distribution == &#x27;Ubuntu&#x27;)</span><span class="diff-line del">-    - (ansible_distribution_version is version(&#x27;24.04&#x27;, &#x27;==&#x27;))</span><span class="diff-line del">-    - (ansible_kernel is version(&#x27;6.11&#x27;, &#x27;&lt;&#x27;))</span><span class="diff-line add">+    - (ansible_facts[&#x27;distribution&#x27;] == &#x27;Ubuntu&#x27;)</span><span class="diff-line add">+    - (ansible_facts[&#x27;distribution_version&#x27;] is version(&#x27;24.04&#x27;, &#x27;==&#x27;))</span><span class="diff-line add">+    - (ansible_facts[&#x27;kernel&#x27;] is version(&#x27;6.11&#x27;, &#x27;&lt;&#x27;))</span><span class="diff-line context">     - (not continuous_integration)</span><span class="diff-line context">     - kernel_install_hwe</span><span class="diff-line context"> </span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-213">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/kernel/tasks/subtasks/02_cron.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -10,7 +10,7 @@</span><span class="diff-line context"> - name: Cron | Install cron</span><span class="diff-line context">   ansible.builtin.apt:</span><span class="diff-line context">     name: cron</span><span class="diff-line del">-    state: present</span><span class="diff-line add">+    state: latest</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Cron | Purge old kernels on reboot</span><span class="diff-line context">   ansible.builtin.cron:</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-214">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/kernel/tasks/subtasks/03_update_focal.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -10,6 +10,7 @@</span><span class="diff-line context"> - name: Update | Update linux kernel</span><span class="diff-line context">   ansible.builtin.apt:</span><span class="diff-line context">     name: &quot;{{ kernel_update_apt_package }}&quot;</span><span class="diff-line add">+    install_recommends: true</span><span class="diff-line context">     update_cache: true</span><span class="diff-line context">     state: latest</span><span class="diff-line context">   register: r</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-215">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/kernel/tasks/subtasks/04_update_jammy.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -10,6 +10,7 @@</span><span class="diff-line context"> - name: Update | Update linux kernel</span><span class="diff-line context">   ansible.builtin.apt:</span><span class="diff-line context">     name: &quot;{{ kernel_update_apt_package_22 }}&quot;</span><span class="diff-line add">+    install_recommends: true</span><span class="diff-line context">     update_cache: true</span><span class="diff-line context">     state: latest</span><span class="diff-line context">   register: r</span><span class="diff-line hunk">@@ -19,8 +20,8 @@</span><span class="diff-line context">     name:</span><span class="diff-line context">       - gcc-12</span><span class="diff-line context">       - g++-12</span><span class="diff-line del">-    state: present</span><span class="diff-line del">-    update_cache: yes</span><span class="diff-line add">+    state: latest</span><span class="diff-line add">+    update_cache: true</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Update | Set gcc-12 and g++-12 as the default compilers</span><span class="diff-line context">   ansible.builtin.shell: update-alternatives --install /usr/bin/gcc gcc /usr/bin/gcc-12 12 --slave /usr/bin/g++ g++ /usr/bin/g++-12</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-216">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/kernel/tasks/subtasks/05_update_noble.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -10,6 +10,7 @@</span><span class="diff-line context"> - name: Update | Update linux kernel</span><span class="diff-line context">   ansible.builtin.apt:</span><span class="diff-line context">     name: &quot;{{ kernel_update_apt_package_24 }}&quot;</span><span class="diff-line add">+    install_recommends: true</span><span class="diff-line context">     update_cache: true</span><span class="diff-line context">     state: latest</span><span class="diff-line context">   register: r</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-217">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/lidarr/defaults/main.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -17,167 +17,121 @@</span><span class="diff-line context"> # Settings</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-lidarr_external_auth: true</span><span class="diff-line add">+lidarr_role_external_auth: true</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # Paths</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-lidarr_paths_folder: &quot;{{ lidarr_name }}&quot;</span><span class="diff-line del">-lidarr_paths_location: &quot;{{ server_appdata_path }}/{{ lidarr_paths_folder }}&quot;</span><span class="diff-line del">-lidarr_paths_folders_list:</span><span class="diff-line del">-  - &quot;{{ lidarr_paths_location }}&quot;</span><span class="diff-line del">-lidarr_paths_config_location: &quot;{{ lidarr_paths_location }}/config.xml&quot;</span><span class="diff-line add">+lidarr_role_paths_folder: &quot;{{ lidarr_name }}&quot;</span><span class="diff-line add">+lidarr_role_paths_location: &quot;{{ server_appdata_path }}/{{ lidarr_role_paths_folder }}&quot;</span><span class="diff-line add">+lidarr_role_paths_folders_list:</span><span class="diff-line add">+  - &quot;{{ lidarr_role_paths_location }}&quot;</span><span class="diff-line add">+lidarr_role_paths_config_location: &quot;{{ lidarr_role_paths_location }}/config.xml&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # Web</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-lidarr_web_subdomain: &quot;{{ lidarr_name }}&quot;</span><span class="diff-line del">-lidarr_web_domain: &quot;{{ user.domain }}&quot;</span><span class="diff-line del">-lidarr_web_port: &quot;8686&quot;</span><span class="diff-line del">-lidarr_web_url: &quot;{{ &#x27;https://&#x27; + (lookup(&#x27;vars&#x27;, lidarr_name + &#x27;_web_subdomain&#x27;, default=lidarr_web_subdomain) + &#x27;.&#x27; + lookup(&#x27;vars&#x27;, lidarr_name + &#x27;_web_domain&#x27;, default=lidarr_web_domain)</span><span class="diff-line del">-                 if (lookup(&#x27;vars&#x27;, lidarr_name + &#x27;_web_subdomain&#x27;, default=lidarr_web_subdomain) | length &gt; 0)</span><span class="diff-line del">-                 else lookup(&#x27;vars&#x27;, lidarr_name + &#x27;_web_domain&#x27;, default=lidarr_web_domain)) }}&quot;</span><span class="diff-line add">+lidarr_role_web_subdomain: &quot;{{ lidarr_name }}&quot;</span><span class="diff-line add">+lidarr_role_web_domain: &quot;{{ user.domain }}&quot;</span><span class="diff-line add">+lidarr_role_web_port: &quot;8686&quot;</span><span class="diff-line add">+lidarr_role_web_url: &quot;{{ &#x27;https://&#x27; + (lookup(&#x27;role_var&#x27;, &#x27;_web_subdomain&#x27;, role=&#x27;lidarr&#x27;) + &#x27;.&#x27; + lookup(&#x27;role_var&#x27;, &#x27;_web_domain&#x27;, role=&#x27;lidarr&#x27;)</span><span class="diff-line add">+                      if (lookup(&#x27;role_var&#x27;, &#x27;_web_subdomain&#x27;, role=&#x27;lidarr&#x27;) | length &gt; 0)</span><span class="diff-line add">+                      else lookup(&#x27;role_var&#x27;, &#x27;_web_domain&#x27;, role=&#x27;lidarr&#x27;)) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # DNS</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-lidarr_dns_record: &quot;{{ lookup(&#x27;vars&#x27;, lidarr_name + &#x27;_web_subdomain&#x27;, default=lidarr_web_subdomain) }}&quot;</span><span class="diff-line del">-lidarr_dns_zone: &quot;{{ lookup(&#x27;vars&#x27;, lidarr_name + &#x27;_web_domain&#x27;, default=lidarr_web_domain) }}&quot;</span><span class="diff-line del">-lidarr_dns_proxy: &quot;{{ dns.proxied }}&quot;</span><span class="diff-line add">+lidarr_role_dns_record: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_web_subdomain&#x27;, role=&#x27;lidarr&#x27;) }}&quot;</span><span class="diff-line add">+lidarr_role_dns_zone: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_web_domain&#x27;, role=&#x27;lidarr&#x27;) }}&quot;</span><span class="diff-line add">+lidarr_role_dns_proxy: &quot;{{ dns_proxied }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # Traefik</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-lidarr_traefik_sso_middleware: &quot;{{ traefik_default_sso_middleware }}&quot;</span><span class="diff-line del">-lidarr_traefik_middleware_default: &quot;{{ traefik_default_middleware</span><span class="diff-line del">-                                       + (&#x27;,themepark-&#x27; + lookup(&#x27;vars&#x27;, lidarr_name + &#x27;_name&#x27;, default=lidarr_name)</span><span class="diff-line del">-                                         if (lidarr_themepark_enabled and global_themepark_plugin_enabled)</span><span class="diff-line del">-                                         else &#x27;&#x27;) }}&quot;</span><span class="diff-line del">-lidarr_traefik_middleware_custom: &quot;&quot;</span><span class="diff-line del">-lidarr_traefik_certresolver: &quot;{{ traefik_default_certresolver }}&quot;</span><span class="diff-line del">-lidarr_traefik_enabled: true</span><span class="diff-line del">-lidarr_traefik_api_enabled: true</span><span class="diff-line del">-lidarr_traefik_api_endpoint: &quot;PathPrefix(`/api`) || PathPrefix(`/feed`) || PathPrefix(`/ping`)&quot;</span><span class="diff-line add">+lidarr_role_traefik_sso_middleware: &quot;{{ traefik_default_sso_middleware }}&quot;</span><span class="diff-line add">+lidarr_role_traefik_middleware_default: &quot;{{ traefik_default_middleware</span><span class="diff-line add">+                                            + (&#x27;,themepark-&#x27; + lidarr_name</span><span class="diff-line add">+                                              if (lookup(&#x27;role_var&#x27;, &#x27;_themepark_enabled&#x27;, role=&#x27;lidarr&#x27;) and global_themepark_plugin_enabled)</span><span class="diff-line add">+                                              else &#x27;&#x27;) }}&quot;</span><span class="diff-line add">+lidarr_role_traefik_middleware_custom: &quot;&quot;</span><span class="diff-line add">+lidarr_role_traefik_certresolver: &quot;{{ traefik_default_certresolver }}&quot;</span><span class="diff-line add">+lidarr_role_traefik_enabled: true</span><span class="diff-line add">+lidarr_role_traefik_api_enabled: true</span><span class="diff-line add">+lidarr_role_traefik_api_endpoint: &quot;PathPrefix(`/api`) || PathPrefix(`/feed`) || PathPrefix(`/ping`)&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line del">-# API</span><span class="diff-line del">-################################</span><span class="diff-line del">-</span><span class="diff-line del">-# default to blank</span><span class="diff-line del">-lidarr_api_key:</span><span class="diff-line del">-</span><span class="diff-line del">-################################</span><span class="diff-line del">-# THEME</span><span class="diff-line add">+# Theme</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line context"> # Options can be found at https://github.com/themepark-dev/theme.park</span><span class="diff-line del">-lidarr_themepark_enabled: false</span><span class="diff-line del">-lidarr_themepark_app: &quot;lidarr&quot;</span><span class="diff-line del">-lidarr_themepark_theme: &quot;{{ global_themepark_theme }}&quot;</span><span class="diff-line del">-lidarr_themepark_domain: &quot;{{ global_themepark_domain }}&quot;</span><span class="diff-line del">-lidarr_themepark_addons: []</span><span class="diff-line add">+lidarr_role_themepark_enabled: false</span><span class="diff-line add">+lidarr_role_themepark_app: &quot;lidarr&quot;</span><span class="diff-line add">+lidarr_role_themepark_theme: &quot;{{ global_themepark_theme }}&quot;</span><span class="diff-line add">+lidarr_role_themepark_domain: &quot;{{ global_themepark_domain }}&quot;</span><span class="diff-line add">+lidarr_role_themepark_addons: []</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # Docker</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line context"> # Container</span><span class="diff-line del">-lidarr_docker_container: &quot;{{ lidarr_name }}&quot;</span><span class="diff-line add">+lidarr_role_docker_container: &quot;{{ lidarr_name }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Image</span><span class="diff-line del">-lidarr_docker_image_pull: true</span><span class="diff-line del">-lidarr_docker_image_repo: &quot;ghcr.io/hotio/lidarr&quot;</span><span class="diff-line del">-lidarr_docker_image_tag: &quot;release&quot;</span><span class="diff-line del">-lidarr_docker_image: &quot;{{ lookup(&#x27;vars&#x27;, lidarr_name + &#x27;_docker_image_repo&#x27;, default=lidarr_docker_image_repo)</span><span class="diff-line del">-                         + &#x27;:&#x27; + lookup(&#x27;vars&#x27;, lidarr_name + &#x27;_docker_image_tag&#x27;, default=lidarr_docker_image_tag) }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Ports</span><span class="diff-line del">-lidarr_docker_ports_defaults: []</span><span class="diff-line del">-lidarr_docker_ports_custom: []</span><span class="diff-line del">-lidarr_docker_ports: &quot;{{ lookup(&#x27;vars&#x27;, lidarr_name + &#x27;_docker_ports_defaults&#x27;, default=lidarr_docker_ports_defaults)</span><span class="diff-line del">-                         + lookup(&#x27;vars&#x27;, lidarr_name + &#x27;_docker_ports_custom&#x27;, default=lidarr_docker_ports_custom) }}&quot;</span><span class="diff-line add">+lidarr_role_docker_image_pull: true</span><span class="diff-line add">+lidarr_role_docker_image_repo: &quot;ghcr.io/hotio/lidarr&quot;</span><span class="diff-line add">+lidarr_role_docker_image_tag: &quot;release&quot;</span><span class="diff-line add">+lidarr_role_docker_image: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_image_repo&#x27;, role=&#x27;lidarr&#x27;) }}:{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_image_tag&#x27;, role=&#x27;lidarr&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Envs</span><span class="diff-line del">-lidarr_docker_envs_default:</span><span class="diff-line add">+lidarr_role_docker_envs_default:</span><span class="diff-line context">   PUID: &quot;{{ uid }}&quot;</span><span class="diff-line context">   PGID: &quot;{{ gid }}&quot;</span><span class="diff-line context">   UMASK: &quot;002&quot;</span><span class="diff-line context">   TZ: &quot;{{ tz }}&quot;</span><span class="diff-line del">-lidarr_docker_envs_custom: {}</span><span class="diff-line del">-lidarr_docker_envs: &quot;{{ lookup(&#x27;vars&#x27;, lidarr_name + &#x27;_docker_envs_default&#x27;, default=lidarr_docker_envs_default)</span><span class="diff-line del">-                        | combine(lookup(&#x27;vars&#x27;, lidarr_name + &#x27;_docker_envs_custom&#x27;, default=lidarr_docker_envs_custom)) }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Commands</span><span class="diff-line del">-lidarr_docker_commands_default: []</span><span class="diff-line del">-lidarr_docker_commands_custom: []</span><span class="diff-line del">-lidarr_docker_commands: &quot;{{ lookup(&#x27;vars&#x27;, lidarr_name + &#x27;_docker_commands_default&#x27;, default=lidarr_docker_commands_default)</span><span class="diff-line del">-                            + lookup(&#x27;vars&#x27;, lidarr_name + &#x27;_docker_commands_custom&#x27;, default=lidarr_docker_commands_custom) }}&quot;</span><span class="diff-line add">+lidarr_role_docker_envs_custom: {}</span><span class="diff-line add">+lidarr_role_docker_envs: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_envs_default&#x27;, role=&#x27;lidarr&#x27;)</span><span class="diff-line add">+                             | combine(lookup(&#x27;role_var&#x27;, &#x27;_docker_envs_custom&#x27;, role=&#x27;lidarr&#x27;)) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Volumes</span><span class="diff-line del">-lidarr_docker_volumes_default:</span><span class="diff-line del">-  - &quot;{{ lidarr_paths_location }}:/config&quot;</span><span class="diff-line add">+lidarr_role_docker_volumes_default:</span><span class="diff-line add">+  - &quot;{{ lidarr_role_paths_location }}:/config&quot;</span><span class="diff-line context">   - &quot;{{ server_appdata_path }}/scripts:/scripts&quot;</span><span class="diff-line add">+lidarr_role_docker_volumes_legacy:</span><span class="diff-line context">   - &quot;/mnt/unionfs/Media/Music:/music&quot;</span><span class="diff-line del">-lidarr_docker_volumes_custom: []</span><span class="diff-line del">-lidarr_docker_volumes: &quot;{{ lookup(&#x27;vars&#x27;, lidarr_name + &#x27;_docker_volumes_default&#x27;, default=lidarr_docker_volumes_default)</span><span class="diff-line del">-                           + lookup(&#x27;vars&#x27;, lidarr_name + &#x27;_docker_volumes_custom&#x27;, default=lidarr_docker_volumes_custom) }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Devices</span><span class="diff-line del">-lidarr_docker_devices_default: []</span><span class="diff-line del">-lidarr_docker_devices_custom: []</span><span class="diff-line del">-lidarr_docker_devices: &quot;{{ lookup(&#x27;vars&#x27;, lidarr_name + &#x27;_docker_devices_default&#x27;, default=lidarr_docker_devices_default)</span><span class="diff-line del">-                           + lookup(&#x27;vars&#x27;, lidarr_name + &#x27;_docker_devices_custom&#x27;, default=lidarr_docker_devices_custom) }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Hosts</span><span class="diff-line del">-lidarr_docker_hosts_default: {}</span><span class="diff-line del">-lidarr_docker_hosts_custom: {}</span><span class="diff-line del">-lidarr_docker_hosts: &quot;{{ docker_hosts_common</span><span class="diff-line del">-                         | combine(lookup(&#x27;vars&#x27;, lidarr_name + &#x27;_docker_hosts_default&#x27;, default=lidarr_docker_hosts_default))</span><span class="diff-line del">-                         | combine(lookup(&#x27;vars&#x27;, lidarr_name + &#x27;_docker_hosts_custom&#x27;, default=lidarr_docker_hosts_custom)) }}&quot;</span><span class="diff-line add">+lidarr_role_docker_volumes_custom: []</span><span class="diff-line add">+lidarr_role_docker_volumes: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_volumes_default&#x27;, role=&#x27;lidarr&#x27;)</span><span class="diff-line add">+                                + lookup(&#x27;role_var&#x27;, &#x27;_docker_volumes_custom&#x27;, role=&#x27;lidarr&#x27;)</span><span class="diff-line add">+                                + (lookup(&#x27;role_var&#x27;, &#x27;_docker_volumes_legacy&#x27;, role=&#x27;lidarr&#x27;)</span><span class="diff-line add">+                                  if docker_legacy_volume</span><span class="diff-line add">+                                  else []) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Labels</span><span class="diff-line del">-lidarr_docker_labels_default: {}</span><span class="diff-line del">-lidarr_docker_labels_custom: {}</span><span class="diff-line del">-lidarr_docker_labels: &quot;{{ docker_labels_common</span><span class="diff-line del">-                          | combine(lookup(&#x27;vars&#x27;, lidarr_name + &#x27;_docker_labels_default&#x27;, default=lidarr_docker_labels_default))</span><span class="diff-line del">-                          | combine((traefik_themepark_labels</span><span class="diff-line del">-                                    if (lidarr_themepark_enabled and global_themepark_plugin_enabled)</span><span class="diff-line del">-                                    else {}),</span><span class="diff-line del">-                                    lookup(&#x27;vars&#x27;, lidarr_name + &#x27;_docker_labels_custom&#x27;, default=lidarr_docker_labels_custom)) }}&quot;</span><span class="diff-line add">+lidarr_role_docker_labels_default: {}</span><span class="diff-line add">+lidarr_role_docker_labels_custom: {}</span><span class="diff-line add">+lidarr_role_docker_labels: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_labels_default&#x27;, role=&#x27;lidarr&#x27;)</span><span class="diff-line add">+                               | combine((traefik_themepark_labels</span><span class="diff-line add">+                                         if (lookup(&#x27;role_var&#x27;, &#x27;_themepark_enabled&#x27;, role=&#x27;lidarr&#x27;) and global_themepark_plugin_enabled)</span><span class="diff-line add">+                                         else {}),</span><span class="diff-line add">+                                         lookup(&#x27;role_var&#x27;, &#x27;_docker_labels_custom&#x27;, role=&#x27;lidarr&#x27;)) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Hostname</span><span class="diff-line del">-lidarr_docker_hostname: &quot;{{ lidarr_name }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Network Mode</span><span class="diff-line del">-lidarr_docker_network_mode_default: &quot;{{ docker_networks_name_common }}&quot;</span><span class="diff-line del">-lidarr_docker_network_mode: &quot;{{ lookup(&#x27;vars&#x27;, lidarr_name + &#x27;_docker_network_mode_default&#x27;, default=lidarr_docker_network_mode_default) }}&quot;</span><span class="diff-line add">+lidarr_role_docker_hostname: &quot;{{ lidarr_name }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Networks</span><span class="diff-line del">-lidarr_docker_networks_alias: &quot;{{ lidarr_name }}&quot;</span><span class="diff-line del">-lidarr_docker_networks_default: []</span><span class="diff-line del">-lidarr_docker_networks_custom: []</span><span class="diff-line del">-lidarr_docker_networks: &quot;{{ docker_networks_common</span><span class="diff-line del">-                            + lookup(&#x27;vars&#x27;, lidarr_name + &#x27;_docker_networks_default&#x27;, default=lidarr_docker_networks_default)</span><span class="diff-line del">-                            + lookup(&#x27;vars&#x27;, lidarr_name + &#x27;_docker_networks_custom&#x27;, default=lidarr_docker_networks_custom) }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Capabilities</span><span class="diff-line del">-lidarr_docker_capabilities_default: []</span><span class="diff-line del">-lidarr_docker_capabilities_custom: []</span><span class="diff-line del">-lidarr_docker_capabilities: &quot;{{ lookup(&#x27;vars&#x27;, lidarr_name + &#x27;_docker_capabilities_default&#x27;, default=lidarr_docker_capabilities_default)</span><span class="diff-line del">-                                + lookup(&#x27;vars&#x27;, lidarr_name + &#x27;_docker_capabilities_custom&#x27;, default=lidarr_docker_capabilities_custom) }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Security Opts</span><span class="diff-line del">-lidarr_docker_security_opts_default: []</span><span class="diff-line del">-lidarr_docker_security_opts_custom: []</span><span class="diff-line del">-lidarr_docker_security_opts: &quot;{{ lookup(&#x27;vars&#x27;, lidarr_name + &#x27;_docker_security_opts_default&#x27;, default=lidarr_docker_security_opts_default)</span><span class="diff-line del">-                                 + lookup(&#x27;vars&#x27;, lidarr_name + &#x27;_docker_security_opts_custom&#x27;, default=lidarr_docker_security_opts_custom) }}&quot;</span><span class="diff-line add">+lidarr_role_docker_networks_alias: &quot;{{ lidarr_name }}&quot;</span><span class="diff-line add">+lidarr_role_docker_networks_default: []</span><span class="diff-line add">+lidarr_role_docker_networks_custom: []</span><span class="diff-line add">+lidarr_role_docker_networks: &quot;{{ docker_networks_common</span><span class="diff-line add">+                                 + lookup(&#x27;role_var&#x27;, &#x27;_docker_networks_default&#x27;, role=&#x27;lidarr&#x27;)</span><span class="diff-line add">+                                 + lookup(&#x27;role_var&#x27;, &#x27;_docker_networks_custom&#x27;, role=&#x27;lidarr&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Restart Policy</span><span class="diff-line del">-lidarr_docker_restart_policy: unless-stopped</span><span class="diff-line add">+lidarr_role_docker_restart_policy: unless-stopped</span><span class="diff-line context"> </span><span class="diff-line context"> # State</span><span class="diff-line del">-lidarr_docker_state: started</span><span class="diff-line add">+lidarr_role_docker_state: started</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-218">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/lidarr/tasks/main2.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -10,9 +10,9 @@</span><span class="diff-line context"> - name: Add DNS record</span><span class="diff-line context">   ansible.builtin.include_tasks: &quot;{{ resources_tasks_path }}/dns/tasker.yml&quot;</span><span class="diff-line context">   vars:</span><span class="diff-line del">-    dns_record: &quot;{{ lookup(&#x27;vars&#x27;, role_name + &#x27;_dns_record&#x27;) }}&quot;</span><span class="diff-line del">-    dns_zone: &quot;{{ lookup(&#x27;vars&#x27;, role_name + &#x27;_dns_zone&#x27;) }}&quot;</span><span class="diff-line del">-    dns_proxy: &quot;{{ lookup(&#x27;vars&#x27;, role_name + &#x27;_dns_proxy&#x27;) }}&quot;</span><span class="diff-line add">+    dns_record: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_dns_record&#x27;) }}&quot;</span><span class="diff-line add">+    dns_zone: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_dns_zone&#x27;) }}&quot;</span><span class="diff-line add">+    dns_proxy: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_dns_proxy&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Remove existing Docker container</span><span class="diff-line context">   ansible.builtin.include_tasks: &quot;{{ resources_tasks_path }}/docker/remove_docker_container.yml&quot;</span><span class="diff-line hunk">@@ -24,5 +24,5 @@</span><span class="diff-line context">   ansible.builtin.include_tasks: &quot;{{ resources_tasks_path }}/docker/create_docker_container.yml&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: &quot;Tweak Settings when SSO is enabled&quot;</span><span class="diff-line del">-  ansible.builtin.import_tasks: &quot;subtasks/auth.yml&quot;</span><span class="diff-line del">-  when: (lookup(&#x27;vars&#x27;, lidarr_name + &#x27;_traefik_sso_middleware&#x27;, default=lidarr_traefik_sso_middleware) | length &gt; 0) and lookup(&#x27;vars&#x27;, lidarr_name + &#x27;_external_auth&#x27;, default=lidarr_external_auth)</span><span class="diff-line add">+  ansible.builtin.include_tasks: &quot;subtasks/auth.yml&quot;</span><span class="diff-line add">+  when: (lookup(&#x27;role_var&#x27;, &#x27;_traefik_sso_middleware&#x27;, role=&#x27;lidarr&#x27;) | length &gt; 0) and lookup(&#x27;role_var&#x27;, &#x27;_external_auth&#x27;, role=&#x27;lidarr&#x27;)</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-219">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/lidarr/tasks/subtasks/auth.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -9,7 +9,7 @@</span><span class="diff-line context"> ---</span><span class="diff-line context"> - name: Auth | Wait for &#x27;config.xml&#x27; to be created</span><span class="diff-line context">   ansible.builtin.wait_for:</span><span class="diff-line del">-    path: &quot;/opt/{{ lidarr_name }}/config.xml&quot;</span><span class="diff-line add">+    path: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_config_location&#x27;, role=&#x27;lidarr&#x27;) }}&quot;</span><span class="diff-line context">     state: present</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Auth | Wait for 10 seconds</span><span class="diff-line hunk">@@ -18,7 +18,7 @@</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Auth | Lookup AuthenticationMethod value</span><span class="diff-line context">   community.general.xml:</span><span class="diff-line del">-    path: &quot;/opt/{{ lidarr_name }}/config.xml&quot;</span><span class="diff-line add">+    path: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_config_location&#x27;, role=&#x27;lidarr&#x27;) }}&quot;</span><span class="diff-line context">     xpath: &quot;/Config/AuthenticationMethod&quot;</span><span class="diff-line context">     content: &quot;text&quot;</span><span class="diff-line context">   register: xmlresp</span><span class="diff-line hunk">@@ -28,7 +28,7 @@</span><span class="diff-line context">   block:</span><span class="diff-line context">     - name: Auth | Change the &#x27;AuthenticationMethod&#x27; attribute to &#x27;External&#x27;</span><span class="diff-line context">       community.general.xml:</span><span class="diff-line del">-        path: &quot;/opt/{{ lidarr_name }}/config.xml&quot;</span><span class="diff-line add">+        path: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_config_location&#x27;, role=&#x27;lidarr&#x27;) }}&quot;</span><span class="diff-line context">         xpath: &quot;/Config/AuthenticationMethod&quot;</span><span class="diff-line context">         value: &quot;External&quot;</span><span class="diff-line context"> </span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-220">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/lldap/defaults/main.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -18,150 +18,113 @@</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line context"> # Toggles if the configuration template uses SMTP or not.</span><span class="diff-line del">-lldap_smtp_enabled: false</span><span class="diff-line add">+lldap_role_smtp_enabled: false</span><span class="diff-line context"> # The SMTP server.</span><span class="diff-line del">-lldap_smtp_server: &quot;smtp.gmail.com&quot;</span><span class="diff-line add">+lldap_role_smtp_server: &quot;smtp.gmail.com&quot;</span><span class="diff-line context"> # The SMTP port.</span><span class="diff-line del">-lldap_smtp_port: &quot;587&quot;</span><span class="diff-line add">+lldap_role_smtp_port: &quot;587&quot;</span><span class="diff-line context"> # How the connection is encrypted, either &quot;NONE&quot; (no encryption), &quot;TLS&quot; or &quot;STARTTLS&quot;.</span><span class="diff-line del">-lldap_smtp_encryption: &quot;TLS&quot;</span><span class="diff-line add">+lldap_role_smtp_encryption: &quot;TLS&quot;</span><span class="diff-line context"> # The SMTP user, usually your email address.</span><span class="diff-line del">-lldap_smtp_user: &quot;sender@gmail.com&quot;</span><span class="diff-line add">+lldap_role_smtp_user: &quot;sender@gmail.com&quot;</span><span class="diff-line context"> # The SMTP password.</span><span class="diff-line del">-lldap_smtp_password: &quot;password&quot;</span><span class="diff-line add">+lldap_role_smtp_password: &quot;password&quot;</span><span class="diff-line context"> # is a free-form name, followed by an email between &lt;&gt;.</span><span class="diff-line del">-lldap_smtp_from: &quot;LLDAP Admin &lt;sender@gmail.com&gt;&quot;</span><span class="diff-line add">+lldap_role_smtp_from: &quot;LLDAP Admin &lt;sender@gmail.com&gt;&quot;</span><span class="diff-line context"> # The header field, optional: how the sender appears in the email.</span><span class="diff-line context"> # The first is a free-form name, followed by an email between &lt;&gt;.</span><span class="diff-line del">-lldap_smtp_reply_to: &quot;Do not reply &lt;noreply@localhost&gt;&quot;</span><span class="diff-line add">+lldap_role_smtp_reply_to: &quot;Do not reply &lt;noreply@localhost&gt;&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # Paths</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-lldap_paths_folder: &quot;{{ lldap_name }}&quot;</span><span class="diff-line del">-lldap_paths_location: &quot;{{ server_appdata_path }}/{{ lldap_paths_folder }}&quot;</span><span class="diff-line del">-lldap_paths_folders_list:</span><span class="diff-line del">-  - &quot;{{ lldap_paths_location }}&quot;</span><span class="diff-line add">+lldap_role_paths_folder: &quot;{{ lldap_name }}&quot;</span><span class="diff-line add">+lldap_role_paths_location: &quot;{{ server_appdata_path }}/{{ lldap_role_paths_folder }}&quot;</span><span class="diff-line add">+lldap_role_paths_folders_list:</span><span class="diff-line add">+  - &quot;{{ lldap_role_paths_location }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # Web</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-lldap_web_subdomain: &quot;lldap&quot;</span><span class="diff-line del">-lldap_web_domain: &quot;{{ user.domain }}&quot;</span><span class="diff-line del">-lldap_web_port: &quot;17170&quot;</span><span class="diff-line del">-lldap_web_url: &quot;{{ &#x27;https://&#x27; + (lldap_web_subdomain + &#x27;.&#x27; + lldap_web_domain</span><span class="diff-line del">-                if (lldap_web_subdomain | length &gt; 0)</span><span class="diff-line del">-                else lldap_web_domain) }}&quot;</span><span class="diff-line add">+lldap_role_web_subdomain: &quot;lldap&quot;</span><span class="diff-line add">+lldap_role_web_domain: &quot;{{ user.domain }}&quot;</span><span class="diff-line add">+lldap_role_web_port: &quot;17170&quot;</span><span class="diff-line add">+lldap_role_web_url: &quot;{{ &#x27;https://&#x27; + (lookup(&#x27;role_var&#x27;, &#x27;_web_subdomain&#x27;, role=&#x27;lldap&#x27;) + &#x27;.&#x27; + lookup(&#x27;role_var&#x27;, &#x27;_web_domain&#x27;, role=&#x27;lldap&#x27;)</span><span class="diff-line add">+                     if (lookup(&#x27;role_var&#x27;, &#x27;_web_subdomain&#x27;, role=&#x27;lldap&#x27;) | length &gt; 0)</span><span class="diff-line add">+                     else lookup(&#x27;role_var&#x27;, &#x27;_web_domain&#x27;, role=&#x27;lldap&#x27;)) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # DNS</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-lldap_dns_record: &quot;{{ lldap_web_subdomain }}&quot;</span><span class="diff-line del">-lldap_dns_zone: &quot;{{ lldap_web_domain }}&quot;</span><span class="diff-line del">-lldap_dns_proxy: &quot;{{ dns.proxied }}&quot;</span><span class="diff-line add">+lldap_role_dns_record: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_web_subdomain&#x27;, role=&#x27;lldap&#x27;) }}&quot;</span><span class="diff-line add">+lldap_role_dns_zone: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_web_domain&#x27;, role=&#x27;lldap&#x27;) }}&quot;</span><span class="diff-line add">+lldap_role_dns_proxy: &quot;{{ dns_proxied }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # Traefik</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-lldap_traefik_sso_middleware: &quot;{{ traefik_default_sso_middleware }}&quot;</span><span class="diff-line del">-lldap_traefik_middleware_default: &quot;{{ traefik_default_middleware }}&quot;</span><span class="diff-line del">-lldap_traefik_middleware_custom: &quot;&quot;</span><span class="diff-line del">-lldap_traefik_certresolver: &quot;{{ traefik_default_certresolver }}&quot;</span><span class="diff-line del">-lldap_traefik_enabled: true</span><span class="diff-line del">-lldap_traefik_api_enabled: false</span><span class="diff-line del">-lldap_traefik_api_endpoint: &quot;&quot;</span><span class="diff-line add">+lldap_role_traefik_sso_middleware: &quot;{{ traefik_default_sso_middleware }}&quot;</span><span class="diff-line add">+lldap_role_traefik_middleware_default: &quot;{{ traefik_default_middleware }}&quot;</span><span class="diff-line add">+lldap_role_traefik_middleware_custom: &quot;&quot;</span><span class="diff-line add">+lldap_role_traefik_certresolver: &quot;{{ traefik_default_certresolver }}&quot;</span><span class="diff-line add">+lldap_role_traefik_enabled: true</span><span class="diff-line add">+lldap_role_traefik_api_enabled: false</span><span class="diff-line add">+lldap_role_traefik_api_endpoint: &quot;&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # Docker</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line context"> # Container</span><span class="diff-line del">-lldap_docker_container: &quot;{{ lldap_name }}&quot;</span><span class="diff-line add">+lldap_role_docker_container: &quot;{{ lldap_name }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Image</span><span class="diff-line del">-lldap_docker_image_pull: true</span><span class="diff-line del">-lldap_docker_image_repo: &quot;nitnelave/lldap&quot;</span><span class="diff-line del">-lldap_docker_image_tag: &quot;stable&quot;</span><span class="diff-line del">-lldap_docker_image: &quot;{{ lldap_docker_image_repo</span><span class="diff-line del">-                        + &#x27;:&#x27; + lldap_docker_image_tag }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Ports</span><span class="diff-line del">-lldap_docker_ports_defaults: []</span><span class="diff-line del">-lldap_docker_ports_custom: []</span><span class="diff-line del">-lldap_docker_ports: &quot;{{ lldap_docker_ports_defaults</span><span class="diff-line del">-                        + lldap_docker_ports_custom }}&quot;</span><span class="diff-line add">+lldap_role_docker_image_pull: true</span><span class="diff-line add">+lldap_role_docker_image_repo: &quot;nitnelave/lldap&quot;</span><span class="diff-line add">+lldap_role_docker_image_tag: &quot;stable&quot;</span><span class="diff-line add">+lldap_role_docker_image: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_image_repo&#x27;, role=&#x27;lldap&#x27;) }}:{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_image_tag&#x27;, role=&#x27;lldap&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Envs</span><span class="diff-line del">-lldap_docker_envs_default:</span><span class="diff-line add">+lldap_role_docker_envs_default:</span><span class="diff-line context">   TZ: &quot;{{ tz }}&quot;</span><span class="diff-line context">   UID: &quot;{{ uid }}&quot;</span><span class="diff-line context">   GID: &quot;{{ gid }}&quot;</span><span class="diff-line del">-lldap_docker_envs_custom: {}</span><span class="diff-line del">-lldap_docker_envs: &quot;{{ lldap_docker_envs_default</span><span class="diff-line del">-                       | combine(lldap_docker_envs_custom) }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Commands</span><span class="diff-line del">-lldap_docker_commands_default: []</span><span class="diff-line del">-lldap_docker_commands_custom: []</span><span class="diff-line del">-lldap_docker_commands: &quot;{{ lldap_docker_commands_default</span><span class="diff-line del">-                           + lldap_docker_commands_custom }}&quot;</span><span class="diff-line add">+lldap_role_docker_envs_custom: {}</span><span class="diff-line add">+lldap_role_docker_envs: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_envs_default&#x27;, role=&#x27;lldap&#x27;)</span><span class="diff-line add">+                            | combine(lookup(&#x27;role_var&#x27;, &#x27;_docker_envs_custom&#x27;, role=&#x27;lldap&#x27;)) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Volumes</span><span class="diff-line del">-lldap_docker_volumes_default:</span><span class="diff-line del">-  - &quot;{{ lldap_paths_location }}:/data&quot;</span><span class="diff-line del">-lldap_docker_volumes_custom: []</span><span class="diff-line del">-lldap_docker_volumes: &quot;{{ lldap_docker_volumes_default</span><span class="diff-line del">-                          + lldap_docker_volumes_custom }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Devices</span><span class="diff-line del">-lldap_docker_devices_default: []</span><span class="diff-line del">-lldap_docker_devices_custom: []</span><span class="diff-line del">-lldap_docker_devices: &quot;{{ lldap_docker_devices_default</span><span class="diff-line del">-                          + lldap_docker_devices_custom }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Hosts</span><span class="diff-line del">-lldap_docker_hosts_default: {}</span><span class="diff-line del">-lldap_docker_hosts_custom: {}</span><span class="diff-line del">-lldap_docker_hosts: &quot;{{ docker_hosts_common</span><span class="diff-line del">-                        | combine(lldap_docker_hosts_default)</span><span class="diff-line del">-                        | combine(lldap_docker_hosts_custom) }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Labels</span><span class="diff-line del">-lldap_docker_labels_default: {}</span><span class="diff-line del">-lldap_docker_labels_custom: {}</span><span class="diff-line del">-lldap_docker_labels: &quot;{{ docker_labels_common</span><span class="diff-line del">-                         | combine(lldap_docker_labels_default)</span><span class="diff-line del">-                         | combine(lldap_docker_labels_custom) }}&quot;</span><span class="diff-line add">+lldap_role_docker_volumes_default:</span><span class="diff-line add">+  - &quot;{{ lldap_role_paths_location }}:/data&quot;</span><span class="diff-line add">+lldap_role_docker_volumes_custom: []</span><span class="diff-line add">+lldap_role_docker_volumes: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_volumes_default&#x27;, role=&#x27;lldap&#x27;)</span><span class="diff-line add">+                               + lookup(&#x27;role_var&#x27;, &#x27;_docker_volumes_custom&#x27;, role=&#x27;lldap&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Hostname</span><span class="diff-line del">-lldap_docker_hostname: &quot;{{ lldap_name }}&quot;</span><span class="diff-line add">+lldap_role_docker_hostname: &quot;{{ lldap_name }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Networks</span><span class="diff-line del">-lldap_docker_networks_alias: &quot;{{ lldap_name }}&quot;</span><span class="diff-line del">-lldap_docker_networks_default: []</span><span class="diff-line del">-lldap_docker_networks_custom: []</span><span class="diff-line del">-lldap_docker_networks: &quot;{{ docker_networks_common</span><span class="diff-line del">-                           + lldap_docker_networks_default</span><span class="diff-line del">-                           + lldap_docker_networks_custom }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Capabilities</span><span class="diff-line del">-lldap_docker_capabilities_default: []</span><span class="diff-line del">-lldap_docker_capabilities_custom: []</span><span class="diff-line del">-lldap_docker_capabilities: &quot;{{ lldap_docker_capabilities_default</span><span class="diff-line del">-                               + lldap_docker_capabilities_custom }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Security Opts</span><span class="diff-line del">-lldap_docker_security_opts_default: []</span><span class="diff-line del">-lldap_docker_security_opts_custom: []</span><span class="diff-line del">-lldap_docker_security_opts: &quot;{{ lldap_docker_security_opts_default</span><span class="diff-line del">-                                + lldap_docker_security_opts_custom }}&quot;</span><span class="diff-line add">+lldap_role_docker_networks_alias: &quot;{{ lldap_name }}&quot;</span><span class="diff-line add">+lldap_role_docker_networks_default: []</span><span class="diff-line add">+lldap_role_docker_networks_custom: []</span><span class="diff-line add">+lldap_role_docker_networks: &quot;{{ docker_networks_common</span><span class="diff-line add">+                                + lookup(&#x27;role_var&#x27;, &#x27;_docker_networks_default&#x27;, role=&#x27;lldap&#x27;)</span><span class="diff-line add">+                                + lookup(&#x27;role_var&#x27;, &#x27;_docker_networks_custom&#x27;, role=&#x27;lldap&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Restart Policy</span><span class="diff-line del">-lldap_docker_restart_policy: unless-stopped</span><span class="diff-line add">+lldap_role_docker_restart_policy: unless-stopped</span><span class="diff-line context"> </span><span class="diff-line context"> # State</span><span class="diff-line del">-lldap_docker_state: started</span><span class="diff-line add">+lldap_role_docker_state: started</span><span class="diff-line add">+</span><span class="diff-line add">+lldap_role_docker_healthcheck:</span><span class="diff-line add">+  test: [&quot;CMD&quot;, &quot;/app/lldap&quot;, &quot;healthcheck&quot;, &quot;--config-file&quot;, &quot;/data/lldap_config.toml&quot;]</span><span class="diff-line add">+  interval: 30s</span><span class="diff-line add">+  timeout: 30s</span><span class="diff-line add">+  retries: 3</span><span class="diff-line add">+  start_period: 30s</span><span class="diff-line add">+  start_interval: 1s</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-221">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/lldap/tasks/main.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -10,16 +10,16 @@</span><span class="diff-line context"> - name: Add DNS record</span><span class="diff-line context">   ansible.builtin.include_tasks: &quot;{{ resources_tasks_path }}/dns/tasker.yml&quot;</span><span class="diff-line context">   vars:</span><span class="diff-line del">-    dns_record: &quot;{{ lookup(&#x27;vars&#x27;, role_name + &#x27;_dns_record&#x27;) }}&quot;</span><span class="diff-line del">-    dns_zone: &quot;{{ lookup(&#x27;vars&#x27;, role_name + &#x27;_dns_zone&#x27;) }}&quot;</span><span class="diff-line del">-    dns_proxy: &quot;{{ lookup(&#x27;vars&#x27;, role_name + &#x27;_dns_proxy&#x27;) }}&quot;</span><span class="diff-line add">+    dns_record: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_dns_record&#x27;) }}&quot;</span><span class="diff-line add">+    dns_zone: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_dns_zone&#x27;) }}&quot;</span><span class="diff-line add">+    dns_proxy: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_dns_proxy&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Remove existing Docker container</span><span class="diff-line context">   ansible.builtin.include_tasks: &quot;{{ resources_tasks_path }}/docker/remove_docker_container.yml&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Reset lldap directory</span><span class="diff-line context">   ansible.builtin.file:</span><span class="diff-line del">-    path: &quot;{{ lldap_paths_location }}&quot;</span><span class="diff-line add">+    path: &quot;{{ lldap_role_paths_location }}&quot;</span><span class="diff-line context">     state: absent</span><span class="diff-line context">   when: (&#x27;lldap-reset&#x27; in ansible_run_tags)</span><span class="diff-line context"> </span><span class="diff-line hunk">@@ -28,13 +28,13 @@</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Check if &#x27;lldap_config.toml&#x27; exists</span><span class="diff-line context">   ansible.builtin.stat:</span><span class="diff-line del">-    path: &quot;{{ lldap_paths_location }}/lldap_config.toml&quot;</span><span class="diff-line add">+    path: &quot;{{ lldap_role_paths_location }}/lldap_config.toml&quot;</span><span class="diff-line context">   register: lldap_config_stat</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Import default &#x27;lldap_config.toml&#x27;</span><span class="diff-line context">   ansible.builtin.template:</span><span class="diff-line context">     src: lldap_config.toml.j2</span><span class="diff-line del">-    dest: &quot;{{ lldap_paths_location }}/lldap_config.toml&quot;</span><span class="diff-line add">+    dest: &quot;{{ lldap_role_paths_location }}/lldap_config.toml&quot;</span><span class="diff-line context">     owner: &quot;{{ user.name }}&quot;</span><span class="diff-line context">     group: &quot;{{ user.name }}&quot;</span><span class="diff-line context">     mode: &quot;0664&quot;</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-222">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/lldap/templates/lldap_config.toml.j2</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -27,7 +27,7 @@</span><span class="diff-line context"> http_port = 17170</span><span class="diff-line context"> </span><span class="diff-line context"> ## The public URL of the server, for password reset links.</span><span class="diff-line del">-http_url = &quot;{{ lldap_web_url }}&quot;</span><span class="diff-line add">+http_url = &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_web_url&#x27;, role=&#x27;lldap&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ## Random secret for JWT signature.</span><span class="diff-line context"> ## This secret should be random, and should be shared with application</span><span class="diff-line hunk">@@ -116,15 +116,15 @@</span><span class="diff-line context"> ## To set these options from environment variables, use the following format</span><span class="diff-line context"> ## (example with &quot;password&quot;): LLDAP_SMTP_OPTIONS__PASSWORD</span><span class="diff-line context"> [smtp_options]</span><span class="diff-line del">-{% if lldap_smtp_enabled %}</span><span class="diff-line add">+{% if lookup(&#x27;role_var&#x27;, &#x27;_smtp_enabled&#x27;, role=&#x27;lldap&#x27;) %}</span><span class="diff-line context"> enable_password_reset=true</span><span class="diff-line del">-server=&quot;{{ lldap_smtp_server }}&quot;</span><span class="diff-line del">-port={{ lldap_smtp_port }}</span><span class="diff-line del">-smtp_encryption=&quot;{{ lldap_smtp_encryption }}&quot;</span><span class="diff-line del">-user=&quot;{{ lldap_smtp_user }}&quot;</span><span class="diff-line del">-password=&quot;{{ lldap_smtp_password }}&quot;</span><span class="diff-line del">-from=&quot;{{ lldap_smtp_from }}&quot;</span><span class="diff-line del">-reply_to=&quot;{{ lldap_smtp_reply_to }}&quot;</span><span class="diff-line add">+server=&quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_smtp_server&#x27;, role=&#x27;lldap&#x27;) }}&quot;</span><span class="diff-line add">+port={{ lookup(&#x27;role_var&#x27;, &#x27;_smtp_port&#x27;, role=&#x27;lldap&#x27;) }}</span><span class="diff-line add">+smtp_encryption=&quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_smtp_encryption&#x27;, role=&#x27;lldap&#x27;) }}&quot;</span><span class="diff-line add">+user=&quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_smtp_user&#x27;, role=&#x27;lldap&#x27;) }}&quot;</span><span class="diff-line add">+password=&quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_smtp_password&#x27;, role=&#x27;lldap&#x27;) }}&quot;</span><span class="diff-line add">+from=&quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_smtp_from&#x27;, role=&#x27;lldap&#x27;) }}&quot;</span><span class="diff-line add">+reply_to=&quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_smtp_reply_to&#x27;, role=&#x27;lldap&#x27;) }}&quot;</span><span class="diff-line context"> {% else %}</span><span class="diff-line context"> ## Whether to enabled password reset via email, from LLDAP.</span><span class="diff-line context"> #enable_password_reset=true</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-223">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/mainline/tasks/main.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -14,7 +14,7 @@</span><span class="diff-line context"> - name: Identify apt source files</span><span class="diff-line context">   ansible.builtin.find:</span><span class="diff-line context">     paths: /etc/apt/sources.list.d/</span><span class="diff-line del">-    recurse: no</span><span class="diff-line add">+    recurse: false</span><span class="diff-line context">   register: apt_source_files</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Check if file contains &#x27;cappelikan&#x27;</span><span class="diff-line hunk">@@ -32,7 +32,7 @@</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Update APT package index</span><span class="diff-line context">   ansible.builtin.apt:</span><span class="diff-line del">-    update_cache: yes</span><span class="diff-line add">+    update_cache: true</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Ensure &#x27;/etc/apt/keyrings&#x27; exists</span><span class="diff-line context">   ansible.builtin.file:</span><span class="diff-line hunk">@@ -56,7 +56,7 @@</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Add cappelikan/ppa</span><span class="diff-line context">   ansible.builtin.apt_repository:</span><span class="diff-line del">-    repo: &quot;deb [arch=amd64 signed-by=/etc/apt/keyrings/cappelikan.asc] https://ppa.launchpadcontent.net/cappelikan/ppa/ubuntu {{ ansible_distribution_release }} main&quot;</span><span class="diff-line add">+    repo: &quot;deb [arch=amd64 signed-by=/etc/apt/keyrings/cappelikan.asc] https://ppa.launchpadcontent.net/cappelikan/ppa/ubuntu {{ ansible_facts[&#x27;distribution_release&#x27;] }} main&quot;</span><span class="diff-line context">     state: present</span><span class="diff-line context">     update_cache: true</span><span class="diff-line context">   register: result</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-224">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/mariadb/defaults/main.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -17,125 +17,76 @@</span><span class="diff-line context"> # Settings</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-mariadb_docker_env_password: &quot;password321&quot;</span><span class="diff-line del">-mariadb_docker_env_user: &quot;{{ user.name }}&quot;</span><span class="diff-line del">-mariadb_docker_env_db: &quot;saltbox&quot;</span><span class="diff-line add">+mariadb_role_docker_env_password: &quot;password321&quot;</span><span class="diff-line add">+mariadb_role_docker_env_user: &quot;{{ user.name }}&quot;</span><span class="diff-line add">+mariadb_role_docker_env_db: &quot;saltbox&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # Paths</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-mariadb_paths_folder: &quot;{{ mariadb_name }}&quot;</span><span class="diff-line del">-mariadb_paths_location: &quot;{{ server_appdata_path }}/{{ mariadb_paths_folder }}&quot;</span><span class="diff-line del">-mariadb_paths_folders_list:</span><span class="diff-line del">-  - &quot;{{ mariadb_paths_location }}&quot;</span><span class="diff-line add">+mariadb_role_paths_folder: &quot;{{ mariadb_name }}&quot;</span><span class="diff-line add">+mariadb_role_paths_location: &quot;{{ server_appdata_path }}/{{ mariadb_role_paths_folder }}&quot;</span><span class="diff-line add">+mariadb_role_paths_folders_list:</span><span class="diff-line add">+  - &quot;{{ mariadb_role_paths_location }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # Migration Settings</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-mariadb_docker_envs_mysql_root_password: password321</span><span class="diff-line del">-mariadb_docker_image_migration: &quot;lscr.io/linuxserver/mariadb:10.6.13&quot;</span><span class="diff-line del">-mariadb_docker_volumes_migration:</span><span class="diff-line del">-  - &quot;{{ mariadb_paths_location }}:/config&quot;</span><span class="diff-line add">+mariadb_role_docker_envs_mysql_root_password: password321</span><span class="diff-line add">+mariadb_role_docker_image_migration: &quot;lscr.io/linuxserver/mariadb:10.6.13&quot;</span><span class="diff-line add">+mariadb_role_docker_volumes_migration:</span><span class="diff-line add">+  - &quot;{{ mariadb_role_paths_location }}:/config&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # Docker</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line context"> # Container</span><span class="diff-line del">-mariadb_docker_container: &quot;{{ mariadb_name }}&quot;</span><span class="diff-line add">+mariadb_role_docker_container: &quot;{{ mariadb_name }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Image</span><span class="diff-line del">-mariadb_docker_image_pull: true</span><span class="diff-line del">-mariadb_docker_image_repo: &quot;mariadb&quot;</span><span class="diff-line del">-mariadb_docker_image_tag: &quot;10&quot;</span><span class="diff-line del">-mariadb_docker_image: &quot;{{ lookup(&#x27;vars&#x27;, mariadb_name + &#x27;_docker_image_repo&#x27;, default=mariadb_docker_image_repo)</span><span class="diff-line del">-                          + &#x27;:&#x27; + lookup(&#x27;vars&#x27;, mariadb_name + &#x27;_docker_image_tag&#x27;, default=mariadb_docker_image_tag) }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Ports</span><span class="diff-line del">-mariadb_docker_ports_defaults: []</span><span class="diff-line del">-mariadb_docker_ports_custom: []</span><span class="diff-line del">-mariadb_docker_ports: &quot;{{ lookup(&#x27;vars&#x27;, mariadb_name + &#x27;_docker_ports_default&#x27;, default=mariadb_docker_ports_defaults)</span><span class="diff-line del">-                          + lookup(&#x27;vars&#x27;, mariadb_name + &#x27;_docker_ports_custom&#x27;, default=mariadb_docker_ports_custom) }}&quot;</span><span class="diff-line add">+mariadb_role_docker_image_pull: true</span><span class="diff-line add">+mariadb_role_docker_image_repo: &quot;mariadb&quot;</span><span class="diff-line add">+mariadb_role_docker_image_tag: &quot;10&quot;</span><span class="diff-line add">+mariadb_role_docker_image: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_image_repo&#x27;, role=&#x27;mariadb&#x27;) }}:{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_image_tag&#x27;, role=&#x27;mariadb&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Envs</span><span class="diff-line del">-mariadb_docker_envs_default:</span><span class="diff-line add">+mariadb_role_docker_envs_default:</span><span class="diff-line context">   TZ: &quot;{{ tz }}&quot;</span><span class="diff-line del">-  MARIADB_ROOT_PASSWORD: &quot;{{ lookup(&#x27;vars&#x27;, mariadb_name + &#x27;_docker_env_password&#x27;, default=mariadb_docker_env_password) }}&quot;</span><span class="diff-line del">-  MARIADB_USER: &quot;{{ lookup(&#x27;vars&#x27;, mariadb_name + &#x27;_docker_env_user&#x27;, default=mariadb_docker_env_user) }}&quot;</span><span class="diff-line del">-  MARIADB_PASSWORD: &quot;{{ lookup(&#x27;vars&#x27;, mariadb_name + &#x27;_docker_env_password&#x27;, default=mariadb_docker_env_password) }}&quot;</span><span class="diff-line del">-  MARIADB_DATABASE: &quot;{{ lookup(&#x27;vars&#x27;, mariadb_name + &#x27;_docker_env_db&#x27;, default=mariadb_docker_env_db) }}&quot;</span><span class="diff-line add">+  MARIADB_ROOT_PASSWORD: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_env_password&#x27;, role=&#x27;mariadb&#x27;) }}&quot;</span><span class="diff-line add">+  MARIADB_USER: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_env_user&#x27;, role=&#x27;mariadb&#x27;) }}&quot;</span><span class="diff-line add">+  MARIADB_PASSWORD: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_env_password&#x27;, role=&#x27;mariadb&#x27;) }}&quot;</span><span class="diff-line add">+  MARIADB_DATABASE: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_env_db&#x27;, role=&#x27;mariadb&#x27;) }}&quot;</span><span class="diff-line context">   MARIADB_AUTO_UPGRADE: &quot;1&quot;</span><span class="diff-line del">-mariadb_docker_envs_custom: {}</span><span class="diff-line del">-mariadb_docker_envs: &quot;{{ lookup(&#x27;vars&#x27;, mariadb_name + &#x27;_docker_envs_default&#x27;, default=mariadb_docker_envs_default)</span><span class="diff-line del">-                         | combine(lookup(&#x27;vars&#x27;, mariadb_name + &#x27;_docker_envs_custom&#x27;, default=mariadb_docker_envs_custom)) }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Commands</span><span class="diff-line del">-mariadb_docker_commands_default: []</span><span class="diff-line del">-mariadb_docker_commands_custom: []</span><span class="diff-line del">-mariadb_docker_commands: &quot;{{ lookup(&#x27;vars&#x27;, mariadb_name + &#x27;_docker_commands_default&#x27;, default=mariadb_docker_commands_default)</span><span class="diff-line del">-                             + lookup(&#x27;vars&#x27;, mariadb_name + &#x27;_docker_commands_custom&#x27;, default=mariadb_docker_commands_custom) }}&quot;</span><span class="diff-line add">+mariadb_role_docker_envs_custom: {}</span><span class="diff-line add">+mariadb_role_docker_envs: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_envs_default&#x27;, role=&#x27;mariadb&#x27;)</span><span class="diff-line add">+                              | combine(lookup(&#x27;role_var&#x27;, &#x27;_docker_envs_custom&#x27;, role=&#x27;mariadb&#x27;)) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Volumes</span><span class="diff-line del">-mariadb_docker_volumes_default:</span><span class="diff-line del">-  - &quot;{{ mariadb_paths_location }}:/var/lib/mysql&quot;</span><span class="diff-line del">-mariadb_docker_volumes_custom: []</span><span class="diff-line del">-mariadb_docker_volumes: &quot;{{ lookup(&#x27;vars&#x27;, mariadb_name + &#x27;_docker_volumes_default&#x27;, default=mariadb_docker_volumes_default)</span><span class="diff-line del">-                            + lookup(&#x27;vars&#x27;, mariadb_name + &#x27;_docker_volumes_custom&#x27;, default=mariadb_docker_volumes_custom) }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Devices</span><span class="diff-line del">-mariadb_docker_devices_default: []</span><span class="diff-line del">-mariadb_docker_devices_custom: []</span><span class="diff-line del">-mariadb_docker_devices: &quot;{{ lookup(&#x27;vars&#x27;, mariadb_name + &#x27;_docker_devices_default&#x27;, default=mariadb_docker_devices_default)</span><span class="diff-line del">-                            + lookup(&#x27;vars&#x27;, mariadb_name + &#x27;_docker_devices_custom&#x27;, default=mariadb_docker_devices_custom) }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Hosts</span><span class="diff-line del">-mariadb_docker_hosts_default: {}</span><span class="diff-line del">-mariadb_docker_hosts_custom: {}</span><span class="diff-line del">-mariadb_docker_hosts: &quot;{{ docker_hosts_common</span><span class="diff-line del">-                          | combine(lookup(&#x27;vars&#x27;, mariadb_name + &#x27;_docker_hosts_default&#x27;, default=mariadb_docker_hosts_default))</span><span class="diff-line del">-                          | combine(lookup(&#x27;vars&#x27;, mariadb_name + &#x27;_docker_hosts_custom&#x27;, default=mariadb_docker_hosts_custom)) }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Labels</span><span class="diff-line del">-mariadb_docker_labels_default: {}</span><span class="diff-line del">-mariadb_docker_labels_custom: {}</span><span class="diff-line del">-mariadb_docker_labels: &quot;{{ docker_labels_common</span><span class="diff-line del">-                           | combine(lookup(&#x27;vars&#x27;, mariadb_name + &#x27;_docker_labels_default&#x27;, default=mariadb_docker_labels_default))</span><span class="diff-line del">-                           | combine(lookup(&#x27;vars&#x27;, mariadb_name + &#x27;_docker_labels_custom&#x27;, default=mariadb_docker_labels_custom)) }}&quot;</span><span class="diff-line add">+mariadb_role_docker_volumes_default:</span><span class="diff-line add">+  - &quot;{{ mariadb_role_paths_location }}:/var/lib/mysql&quot;</span><span class="diff-line add">+mariadb_role_docker_volumes_custom: []</span><span class="diff-line add">+mariadb_role_docker_volumes: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_volumes_default&#x27;, role=&#x27;mariadb&#x27;)</span><span class="diff-line add">+                                 + lookup(&#x27;role_var&#x27;, &#x27;_docker_volumes_custom&#x27;, role=&#x27;mariadb&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Hostname</span><span class="diff-line del">-mariadb_docker_hostname: &quot;{{ mariadb_name }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Network Mode</span><span class="diff-line del">-mariadb_docker_network_mode_default: &quot;{{ docker_networks_name_common }}&quot;</span><span class="diff-line del">-mariadb_docker_network_mode: &quot;{{ lookup(&#x27;vars&#x27;, mariadb_name + &#x27;_docker_network_mode_default&#x27;, default=mariadb_docker_network_mode_default) }}&quot;</span><span class="diff-line add">+mariadb_role_docker_hostname: &quot;{{ mariadb_name }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Networks</span><span class="diff-line del">-mariadb_docker_networks_alias: &quot;{{ mariadb_name }}&quot;</span><span class="diff-line del">-mariadb_docker_networks_default: []</span><span class="diff-line del">-mariadb_docker_networks_custom: []</span><span class="diff-line del">-mariadb_docker_networks: &quot;{{ docker_networks_common</span><span class="diff-line del">-                             + lookup(&#x27;vars&#x27;, mariadb_name + &#x27;_docker_networks_default&#x27;, default=mariadb_docker_networks_default)</span><span class="diff-line del">-                             + lookup(&#x27;vars&#x27;, mariadb_name + &#x27;_docker_networks_dcustom&#x27;, default=mariadb_docker_networks_custom) }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Capabilities</span><span class="diff-line del">-mariadb_docker_capabilities_default: []</span><span class="diff-line del">-mariadb_docker_capabilities_custom: []</span><span class="diff-line del">-mariadb_docker_capabilities: &quot;{{ lookup(&#x27;vars&#x27;, mariadb_name + &#x27;_docker_capabilities_default&#x27;, default=mariadb_docker_capabilities_default)</span><span class="diff-line del">-                                 + lookup(&#x27;vars&#x27;, mariadb_name + &#x27;_docker_capabilities_custom&#x27;, default=mariadb_docker_capabilities_custom) }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Security Opts</span><span class="diff-line del">-mariadb_docker_security_opts_default: []</span><span class="diff-line del">-mariadb_docker_security_opts_custom: []</span><span class="diff-line del">-mariadb_docker_security_opts: &quot;{{ lookup(&#x27;vars&#x27;, mariadb_name + &#x27;_docker_security_opts_default&#x27;, default=mariadb_docker_security_opts_default)</span><span class="diff-line del">-                                  + lookup(&#x27;vars&#x27;, mariadb_name + &#x27;_docker_security_opts_custom&#x27;, default=mariadb_docker_security_opts_custom) }}&quot;</span><span class="diff-line add">+mariadb_role_docker_networks_alias: &quot;{{ mariadb_name }}&quot;</span><span class="diff-line add">+mariadb_role_docker_networks_default: []</span><span class="diff-line add">+mariadb_role_docker_networks_custom: []</span><span class="diff-line add">+mariadb_role_docker_networks: &quot;{{ docker_networks_common</span><span class="diff-line add">+                                  + lookup(&#x27;role_var&#x27;, &#x27;_docker_networks_default&#x27;, role=&#x27;mariadb&#x27;)</span><span class="diff-line add">+                                  + lookup(&#x27;role_var&#x27;, &#x27;_docker_networks_custom&#x27;, role=&#x27;mariadb&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Restart Policy</span><span class="diff-line del">-mariadb_docker_restart_policy: unless-stopped</span><span class="diff-line add">+mariadb_role_docker_restart_policy: unless-stopped</span><span class="diff-line context"> </span><span class="diff-line context"> # State</span><span class="diff-line del">-mariadb_docker_state: started</span><span class="diff-line add">+mariadb_role_docker_state: started</span><span class="diff-line context"> </span><span class="diff-line context"> # User</span><span class="diff-line del">-mariadb_docker_user: &quot;{{ uid }}:{{ gid }}&quot;</span><span class="diff-line add">+mariadb_role_docker_user: &quot;{{ uid }}:{{ gid }}&quot;</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-225">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/mariadb/tasks/post-migration.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -9,7 +9,7 @@</span><span class="diff-line context"> ---</span><span class="diff-line context"> - name: Check for &#x27;dump.sql&#x27;</span><span class="diff-line context">   ansible.builtin.stat:</span><span class="diff-line del">-    path: &quot;/opt/mariadb_legacy/dump.sql&quot;</span><span class="diff-line add">+    path: &quot;{{ server_appdata_path }}/mariadb_legacy/dump.sql&quot;</span><span class="diff-line context">   register: dump</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Import databases</span><span class="diff-line hunk">@@ -21,7 +21,7 @@</span><span class="diff-line context"> </span><span class="diff-line context">     - name: Restore data from dump file</span><span class="diff-line context">       ansible.builtin.shell: |</span><span class="diff-line del">-        docker exec -i mariadb sh -c &#x27;exec mariadb -uroot -p&quot;$MARIADB_ROOT_PASSWORD&quot;&#x27; &lt; /opt/mariadb_legacy/dump.sql</span><span class="diff-line add">+        docker exec -i mariadb sh -c &#x27;exec mariadb -uroot -p&quot;$MARIADB_ROOT_PASSWORD&quot;&#x27; &lt; {{ server_appdata_path }}/mariadb_legacy/dump.sql</span><span class="diff-line context"> </span><span class="diff-line context">     - name: Force MariaDB upgrade</span><span class="diff-line context">       ansible.builtin.shell: |</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-226">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/mariadb/tasks/pre-migration.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -7,9 +7,9 @@</span><span class="diff-line context"> #                   GNU General Public License v3.0                     #</span><span class="diff-line context"> #########################################################################</span><span class="diff-line context"> ---</span><span class="diff-line del">-- name: Check for &#x27;/opt/mariadb/databases&#x27;</span><span class="diff-line add">+- name: Check for &#x27;{{ server_appdata_path }}/mariadb/databases&#x27;</span><span class="diff-line context">   ansible.builtin.stat:</span><span class="diff-line del">-    path: &quot;/opt/mariadb/databases&quot;</span><span class="diff-line add">+    path: &quot;{{ server_appdata_path }}/mariadb/databases&quot;</span><span class="diff-line context">   register: subfolder</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Dump and backup databases</span><span class="diff-line hunk">@@ -24,9 +24,9 @@</span><span class="diff-line context">           PUID: &quot;{{ uid }}&quot;</span><span class="diff-line context">           PGID: &quot;{{ gid }}&quot;</span><span class="diff-line context">           TZ: &quot;{{ tz }}&quot;</span><span class="diff-line del">-          MYSQL_ROOT_PASSWORD: &quot;{{ mariadb_docker_envs_mysql_root_password }}&quot;</span><span class="diff-line add">+          MYSQL_ROOT_PASSWORD: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_envs_mysql_root_password&#x27;, role=&#x27;mariadb&#x27;) }}&quot;</span><span class="diff-line context">         hostname: &quot;mariadb&quot;</span><span class="diff-line del">-        image: &quot;{{ mariadb_docker_image_migration }}&quot;</span><span class="diff-line add">+        image: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_image_migration&#x27;, role=&#x27;mariadb&#x27;) }}&quot;</span><span class="diff-line context">         log_driver: &quot;{{ (docker_log_driver != &#x27;default&#x27;) | ternary(docker_log_driver, lookup(&#x27;vars&#x27;, role_name + &#x27;_docker_log_driver&#x27;, default=omit)) }}&quot;</span><span class="diff-line context">         log_options: &quot;{{ (docker_log_options != &#x27;default&#x27;) | ternary(docker_log_options, lookup(&#x27;vars&#x27;, role_name + &#x27;_docker_log_options&#x27;, default=omit)) }}&quot;</span><span class="diff-line context">         name: &quot;mariadb&quot;</span><span class="diff-line hunk">@@ -37,7 +37,7 @@</span><span class="diff-line context">         restart_policy: &quot;{{ lookup(&#x27;vars&#x27;, role_name + &#x27;_docker_restart_policy&#x27;, default=&#x27;unless-stopped&#x27;) }}&quot;</span><span class="diff-line context">         state: started</span><span class="diff-line context">         stop_timeout: &quot;{{ lookup(&#x27;vars&#x27;, role_name + &#x27;_docker_stop_timeout&#x27;, default=&#x27;10&#x27;) }}&quot;</span><span class="diff-line del">-        volumes: &quot;{{ mariadb_docker_volumes_migration }}&quot;</span><span class="diff-line add">+        volumes: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_volumes_migration&#x27;, role=&#x27;mariadb&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context">     - name: Wait for 30 seconds</span><span class="diff-line context">       ansible.builtin.wait_for:</span><span class="diff-line hunk">@@ -45,7 +45,7 @@</span><span class="diff-line context"> </span><span class="diff-line context">     - name: Creating database dump</span><span class="diff-line context">       ansible.builtin.shell: |</span><span class="diff-line del">-        docker exec mariadb sh -c &#x27;exec mariadb-dump --all-databases -uroot -p&quot;$MYSQL_ROOT_PASSWORD&quot;&#x27; &gt; /opt/mariadb/dump.sql</span><span class="diff-line add">+        docker exec mariadb sh -c &#x27;exec mariadb-dump --all-databases -uroot -p&quot;$MYSQL_ROOT_PASSWORD&quot;&#x27; &gt; {{ server_appdata_path }}/mariadb/dump.sql</span><span class="diff-line context"> </span><span class="diff-line context">     - name: Wait for 5 seconds</span><span class="diff-line context">       ansible.builtin.wait_for:</span><span class="diff-line hunk">@@ -56,16 +56,16 @@</span><span class="diff-line context">       vars:</span><span class="diff-line context">         var_prefix: &quot;mariadb&quot;</span><span class="diff-line context"> </span><span class="diff-line del">-    - name: Relocate &#x27;/opt/mariadb&#x27; to &#x27;/opt/mariadb_legacy&#x27;</span><span class="diff-line del">-      ansible.builtin.shell: &quot;mv /opt/mariadb /opt/mariadb_legacy&quot;</span><span class="diff-line add">+    - name: Relocate &#x27;{{ server_appdata_path }}/mariadb&#x27; to &#x27;{{ server_appdata_path }}/mariadb_legacy&#x27;</span><span class="diff-line add">+      ansible.builtin.shell: &quot;mv {{ server_appdata_path }}/mariadb {{ server_appdata_path }}/mariadb_legacy&quot;</span><span class="diff-line context">       register: relocate</span><span class="diff-line context"> </span><span class="diff-line context">     - name: Wait for 5 seconds</span><span class="diff-line context">       ansible.builtin.wait_for:</span><span class="diff-line context">         timeout: 5</span><span class="diff-line context"> </span><span class="diff-line del">-    - name: Remove &#x27;/opt/mariadb/&#x27;</span><span class="diff-line add">+    - name: Remove &#x27;{{ server_appdata_path }}/mariadb/&#x27;</span><span class="diff-line context">       ansible.builtin.file:</span><span class="diff-line del">-        path: /opt/mariadb/</span><span class="diff-line add">+        path: &quot;{{ server_appdata_path }}/mariadb/&quot;</span><span class="diff-line context">         state: absent</span><span class="diff-line context">       when: relocate.rc == 0</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-227">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/mongodb/defaults/main.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -17,109 +17,58 @@</span><span class="diff-line context"> # Paths</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-mongodb_paths_folder: &quot;{{ mongodb_name }}&quot;</span><span class="diff-line del">-mongodb_paths_location: &quot;{{ server_appdata_path }}/{{ mongodb_paths_folder }}&quot;</span><span class="diff-line del">-mongodb_paths_folders_list:</span><span class="diff-line del">-  - &quot;{{ mongodb_paths_location }}&quot;</span><span class="diff-line del">-  - &quot;{{ mongodb_paths_location }}/config&quot;</span><span class="diff-line add">+mongodb_role_paths_folder: &quot;{{ mongodb_name }}&quot;</span><span class="diff-line add">+mongodb_role_paths_location: &quot;{{ server_appdata_path }}/{{ mongodb_role_paths_folder }}&quot;</span><span class="diff-line add">+mongodb_role_paths_folders_list:</span><span class="diff-line add">+  - &quot;{{ mongodb_role_paths_location }}&quot;</span><span class="diff-line add">+  - &quot;{{ mongodb_role_paths_location }}/config&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # Docker</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line context"> # Container</span><span class="diff-line del">-mongodb_docker_container: &quot;{{ mongodb_name }}&quot;</span><span class="diff-line add">+mongodb_role_docker_container: &quot;{{ mongodb_name }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Image</span><span class="diff-line del">-mongodb_docker_image_pull: true</span><span class="diff-line del">-mongodb_docker_image_tag: &quot;6&quot;</span><span class="diff-line del">-mongodb_docker_image_repo: &quot;mongo&quot;</span><span class="diff-line del">-mongodb_docker_image: &quot;{{ lookup(&#x27;vars&#x27;, mongodb_name + &#x27;_docker_image_repo&#x27;, default=mongodb_docker_image_repo)</span><span class="diff-line del">-                          + &#x27;:&#x27; + lookup(&#x27;vars&#x27;, mongodb_name + &#x27;_docker_image_tag&#x27;, default=mongodb_docker_image_tag) }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Ports</span><span class="diff-line del">-mongodb_docker_ports_defaults: []</span><span class="diff-line del">-mongodb_docker_ports_custom: []</span><span class="diff-line del">-mongodb_docker_ports: &quot;{{ lookup(&#x27;vars&#x27;, mongodb_name + &#x27;_docker_ports_default&#x27;, default=mongodb_docker_ports_defaults)</span><span class="diff-line del">-                          + lookup(&#x27;vars&#x27;, mongodb_name + &#x27;_docker_ports_custom&#x27;, default=mongodb_docker_ports_custom) }}&quot;</span><span class="diff-line add">+mongodb_role_docker_image_pull: true</span><span class="diff-line add">+mongodb_role_docker_image_repo: &quot;mongo&quot;</span><span class="diff-line add">+mongodb_role_docker_image_tag: &quot;6&quot;</span><span class="diff-line add">+mongodb_role_docker_image: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_image_repo&#x27;, role=&#x27;mongodb&#x27;) }}:{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_image_tag&#x27;, role=&#x27;mongodb&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Envs</span><span class="diff-line del">-mongodb_docker_envs_default:</span><span class="diff-line add">+mongodb_role_docker_envs_default:</span><span class="diff-line context">   MONGO_DATA_DIR: &quot;/data/db&quot;</span><span class="diff-line context">   MONGO_LOG_DIR: &quot;/dev/null&quot;</span><span class="diff-line context">   MONGO_URL: &quot;mongodb://{{ mongodb_name }}:27017/&quot;</span><span class="diff-line del">-mongodb_docker_envs_custom: {}</span><span class="diff-line del">-mongodb_docker_envs: &quot;{{ lookup(&#x27;vars&#x27;, mongodb_name + &#x27;_docker_envs_default&#x27;, default=mongodb_docker_envs_default)</span><span class="diff-line del">-                         | combine(lookup(&#x27;vars&#x27;, mongodb_name + &#x27;_docker_envs_custom&#x27;, default=mongodb_docker_envs_custom)) }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Commands</span><span class="diff-line del">-mongodb_docker_commands_default: []</span><span class="diff-line del">-mongodb_docker_commands_custom: []</span><span class="diff-line del">-mongodb_docker_commands: &quot;{{ lookup(&#x27;vars&#x27;, mongodb_name + &#x27;_docker_commands_default&#x27;, default=mongodb_docker_commands_default)</span><span class="diff-line del">-                             + lookup(&#x27;vars&#x27;, mongodb_name + &#x27;_docker_commands_custom&#x27;, default=mongodb_docker_commands_custom) }}&quot;</span><span class="diff-line add">+mongodb_role_docker_envs_custom: {}</span><span class="diff-line add">+mongodb_role_docker_envs: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_envs_default&#x27;, role=&#x27;mongodb&#x27;)</span><span class="diff-line add">+                              | combine(lookup(&#x27;role_var&#x27;, &#x27;_docker_envs_custom&#x27;, role=&#x27;mongodb&#x27;)) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Volumes</span><span class="diff-line del">-mongodb_docker_volumes_default:</span><span class="diff-line del">-  - &quot;{{ mongodb_paths_location }}:/data/db:rw&quot;</span><span class="diff-line del">-  - &quot;{{ mongodb_paths_location }}/config:/data/configdb&quot;</span><span class="diff-line del">-mongodb_docker_volumes_custom: []</span><span class="diff-line del">-mongodb_docker_volumes: &quot;{{ lookup(&#x27;vars&#x27;, mongodb_name + &#x27;_docker_volumes_default&#x27;, default=mongodb_docker_volumes_default)</span><span class="diff-line del">-                            + lookup(&#x27;vars&#x27;, mongodb_name + &#x27;_docker_volumes_custom&#x27;, default=mongodb_docker_volumes_custom) }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-</span><span class="diff-line del">-# Devices</span><span class="diff-line del">-mongodb_docker_devices_default: []</span><span class="diff-line del">-mongodb_docker_devices_custom: []</span><span class="diff-line del">-mongodb_docker_devices: &quot;{{ lookup(&#x27;vars&#x27;, mongodb_name + &#x27;_docker_devices_default&#x27;, default=mongodb_docker_devices_default)</span><span class="diff-line del">-                            + lookup(&#x27;vars&#x27;, mongodb_name + &#x27;_docker_devices_custom&#x27;, default=mongodb_docker_devices_custom) }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Hosts</span><span class="diff-line del">-mongodb_docker_hosts_default: {}</span><span class="diff-line del">-mongodb_docker_hosts_custom: {}</span><span class="diff-line del">-mongodb_docker_hosts: &quot;{{ docker_hosts_common</span><span class="diff-line del">-                           | combine(lookup(&#x27;vars&#x27;, mongodb_name + &#x27;_docker_hosts_default&#x27;, default=mongodb_docker_hosts_default))</span><span class="diff-line del">-                           | combine(lookup(&#x27;vars&#x27;, mongodb_name + &#x27;_docker_hosts_custom&#x27;, default=mongodb_docker_hosts_custom)) }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Labels</span><span class="diff-line del">-mongodb_docker_labels_default: {}</span><span class="diff-line del">-mongodb_docker_labels_custom: {}</span><span class="diff-line del">-mongodb_docker_labels: &quot;{{ docker_labels_common</span><span class="diff-line del">-                            | combine(lookup(&#x27;vars&#x27;, mongodb_name + &#x27;_docker_labels_default&#x27;, default=mongodb_docker_labels_default))</span><span class="diff-line del">-                            | combine(lookup(&#x27;vars&#x27;, mongodb_name + &#x27;_docker_labels_custom&#x27;, default=mongodb_docker_labels_custom)) }}&quot;</span><span class="diff-line add">+mongodb_role_docker_volumes_default:</span><span class="diff-line add">+  - &quot;{{ mongodb_role_paths_location }}:/data/db:rw&quot;</span><span class="diff-line add">+  - &quot;{{ mongodb_role_paths_location }}/config:/data/configdb&quot;</span><span class="diff-line add">+mongodb_role_docker_volumes_custom: []</span><span class="diff-line add">+mongodb_role_docker_volumes: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_volumes_default&#x27;, role=&#x27;mongodb&#x27;)</span><span class="diff-line add">+                                 + lookup(&#x27;role_var&#x27;, &#x27;_docker_volumes_custom&#x27;, role=&#x27;mongodb&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Hostname</span><span class="diff-line del">-mongodb_docker_hostname: &quot;{{ mongodb_name }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Network Mode</span><span class="diff-line del">-mongodb_docker_network_mode_default: &quot;{{ docker_networks_name_common }}&quot;</span><span class="diff-line del">-mongodb_docker_network_mode: &quot;{{ lookup(&#x27;vars&#x27;, mongodb_name + &#x27;_docker_network_mode_default&#x27;, default=mongodb_docker_network_mode_default) }}&quot;</span><span class="diff-line add">+mongodb_role_docker_hostname: &quot;{{ mongodb_name }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Networks</span><span class="diff-line del">-mongodb_docker_networks_alias: &quot;{{ mongodb_name }}&quot;</span><span class="diff-line del">-mongodb_docker_networks_default: []</span><span class="diff-line del">-mongodb_docker_networks_custom: []</span><span class="diff-line del">-mongodb_docker_networks: &quot;{{ docker_networks_common</span><span class="diff-line del">-                              + lookup(&#x27;vars&#x27;, mongodb_name + &#x27;_docker_networks_default&#x27;, default=mongodb_docker_networks_default)</span><span class="diff-line del">-                              + lookup(&#x27;vars&#x27;, mongodb_name + &#x27;_docker_networks_dcustom&#x27;, default=mongodb_docker_networks_custom) }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Capabilities</span><span class="diff-line del">-mongodb_docker_capabilities_default: []</span><span class="diff-line del">-mongodb_docker_capabilities_custom: []</span><span class="diff-line del">-mongodb_docker_capabilities: &quot;{{ lookup(&#x27;vars&#x27;, mongodb_name + &#x27;_docker_capabilities_default&#x27;, default=mongodb_docker_capabilities_default)</span><span class="diff-line del">-                                  + lookup(&#x27;vars&#x27;, mongodb_name + &#x27;_docker_capabilities_custom&#x27;, default=mongodb_docker_capabilities_custom) }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Security Opts</span><span class="diff-line del">-mongodb_docker_security_opts_default: []</span><span class="diff-line del">-mongodb_docker_security_opts_custom: []</span><span class="diff-line del">-mongodb_docker_security_opts: &quot;{{ lookup(&#x27;vars&#x27;, mongodb_name + &#x27;_docker_security_opts_default&#x27;, default=mongodb_docker_security_opts_default)</span><span class="diff-line del">-                                   + lookup(&#x27;vars&#x27;, mongodb_name + &#x27;_docker_security_opts_custom&#x27;, default=mongodb_docker_security_opts_custom) }}&quot;</span><span class="diff-line del">-</span><span class="diff-line add">+mongodb_role_docker_networks_alias: &quot;{{ mongodb_name }}&quot;</span><span class="diff-line add">+mongodb_role_docker_networks_default: []</span><span class="diff-line add">+mongodb_role_docker_networks_custom: []</span><span class="diff-line add">+mongodb_role_docker_networks: &quot;{{ docker_networks_common</span><span class="diff-line add">+                                  + lookup(&#x27;role_var&#x27;, &#x27;_docker_networks_default&#x27;, role=&#x27;mongodb&#x27;)</span><span class="diff-line add">+                                  + lookup(&#x27;role_var&#x27;, &#x27;_docker_networks_custom&#x27;, role=&#x27;mongodb&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Restart Policy</span><span class="diff-line del">-mongodb_docker_restart_policy: unless-stopped</span><span class="diff-line add">+mongodb_role_docker_restart_policy: unless-stopped</span><span class="diff-line context"> </span><span class="diff-line context"> # State</span><span class="diff-line del">-mongodb_docker_state: started</span><span class="diff-line add">+mongodb_role_docker_state: started</span><span class="diff-line context"> </span><span class="diff-line context"> # User</span><span class="diff-line del">-mongodb_docker_user: &quot;{{ uid }}:{{ gid }}&quot;</span><span class="diff-line add">+mongodb_role_docker_user: &quot;{{ uid }}:{{ gid }}&quot;</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-228">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/motd/defaults/main.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -14,3 +14,81 @@</span><span class="diff-line context"> motd_use_python: true</span><span class="diff-line context"> motd_cli_path: &quot;/usr/local/bin/sb&quot;</span><span class="diff-line context"> motd_cli_flags: &quot;--all --title &#x27;Saltbox&#x27; --font ivrit --type parchment&quot;</span><span class="diff-line add">+</span><span class="diff-line add">+################################</span><span class="diff-line add">+# Service Definitions</span><span class="diff-line add">+################################</span><span class="diff-line add">+</span><span class="diff-line add">+# Service types:</span><span class="diff-line add">+#   - multi_instance_apikey: Multiple instances with API key (sonarr, radarr, lidarr, readarr, overseerr)</span><span class="diff-line add">+#   - multi_instance_token: Multiple instances with token (plex)</span><span class="diff-line add">+#   - single_instance_apikey: Single instance with API key (sabnzbd)</span><span class="diff-line add">+#   - single_instance_userpass: Single instance with username/password (nzbget)</span><span class="diff-line add">+#   - multi_instance_userpass: Multiple instances with username/password (qbittorrent)</span><span class="diff-line add">+#   - disabled: Statically disabled services (jellyfin, emby, rtorrent)</span><span class="diff-line add">+</span><span class="diff-line add">+motd_services:</span><span class="diff-line add">+  - name: colors</span><span class="diff-line add">+    type: colors</span><span class="diff-line add">+  - name: emby</span><span class="diff-line add">+    type: multi_instance_token</span><span class="diff-line add">+    check_field: token</span><span class="diff-line add">+    output_field: token</span><span class="diff-line add">+  - name: jellyfin</span><span class="diff-line add">+    type: multi_instance_token</span><span class="diff-line add">+    check_field: token</span><span class="diff-line add">+    output_field: token</span><span class="diff-line add">+  - name: lidarr</span><span class="diff-line add">+    type: multi_instance_apikey</span><span class="diff-line add">+    check_field: api_key</span><span class="diff-line add">+    output_field: apikey</span><span class="diff-line add">+  - name: nzbget</span><span class="diff-line add">+    type: single_instance_userpass</span><span class="diff-line add">+    check_field: username</span><span class="diff-line add">+  - name: plex</span><span class="diff-line add">+    type: multi_instance_token</span><span class="diff-line add">+    check_field: token</span><span class="diff-line add">+    output_field: token</span><span class="diff-line add">+  - name: qbittorrent</span><span class="diff-line add">+    type: multi_instance_userpass_info</span><span class="diff-line add">+    check_field: username</span><span class="diff-line add">+  - name: radarr</span><span class="diff-line add">+    type: multi_instance_apikey</span><span class="diff-line add">+    check_field: api_key</span><span class="diff-line add">+    output_field: apikey</span><span class="diff-line add">+  - name: rutorrent</span><span class="diff-line add">+    type: multi_instance_userpass</span><span class="diff-line add">+    instances_var: rutorrent_instances</span><span class="diff-line add">+    url_suffix: &quot;/RPC2&quot;</span><span class="diff-line add">+  - name: sabnzbd</span><span class="diff-line add">+    type: single_instance_apikey</span><span class="diff-line add">+    check_field: api_key</span><span class="diff-line add">+    output_field: apikey</span><span class="diff-line add">+  - name: sonarr</span><span class="diff-line add">+    type: multi_instance_apikey</span><span class="diff-line add">+    check_field: api_key</span><span class="diff-line add">+    output_field: apikey</span><span class="diff-line add">+  - name: systemd</span><span class="diff-line add">+    type: systemd</span><span class="diff-line add">+</span><span class="diff-line add">+motd_colors:</span><span class="diff-line add">+  text:</span><span class="diff-line add">+    label: &quot;#FF79D0&quot;</span><span class="diff-line add">+    value: &quot;#12C78F&quot;</span><span class="diff-line add">+    app_name: &quot;#BF976F&quot;</span><span class="diff-line add">+  status:</span><span class="diff-line add">+    warning: &quot;#F5EF34&quot;</span><span class="diff-line add">+    success: &quot;#12C78F&quot;</span><span class="diff-line add">+    error: &quot;#EB4268&quot;</span><span class="diff-line add">+  progress_bar:</span><span class="diff-line add">+    low: &quot;#A8CC8C&quot;</span><span class="diff-line add">+    high: &quot;#DBAB79&quot;</span><span class="diff-line add">+    critical: &quot;#E88388&quot;</span><span class="diff-line add">+</span><span class="diff-line add">+motd_systemd:</span><span class="diff-line add">+  enabled: true</span><span class="diff-line add">+  additional_services: []</span><span class="diff-line add">+  display_names: {}</span><span class="diff-line add">+</span><span class="diff-line add">+motd_config_mapping:</span><span class="diff-line add">+  rutorrent: rtorrent</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-229">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/motd/tasks/cli_motd.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -18,7 +18,26 @@</span><span class="diff-line context">           - sonarr</span><span class="diff-line context">           - radarr</span><span class="diff-line context">           - lidarr</span><span class="diff-line del">-          - readarr</span><span class="diff-line add">+          - nzbget</span><span class="diff-line add">+          - sabnzbd</span><span class="diff-line add">+</span><span class="diff-line add">+    - name: Build emby_info dict</span><span class="diff-line add">+      ansible.builtin.include_tasks: subtasks/emby_info.yml</span><span class="diff-line add">+      vars:</span><span class="diff-line add">+        emby_name: &quot;{{ item }}&quot;</span><span class="diff-line add">+      loop: &quot;{{ emby_instances | default([&#x27;emby&#x27;]) }}&quot;</span><span class="diff-line add">+</span><span class="diff-line add">+    - name: Build jellyfin_info dict</span><span class="diff-line add">+      ansible.builtin.include_tasks: subtasks/jellyfin_info.yml</span><span class="diff-line add">+      vars:</span><span class="diff-line add">+        jellyfin_name: &quot;{{ item }}&quot;</span><span class="diff-line add">+      loop: &quot;{{ jellyfin_instances | default([&#x27;jellyfin&#x27;]) }}&quot;</span><span class="diff-line add">+</span><span class="diff-line add">+    - name: Build qbittorrent_info dict</span><span class="diff-line add">+      ansible.builtin.include_tasks: subtasks/qbittorrent_info.yml</span><span class="diff-line add">+      vars:</span><span class="diff-line add">+        qbittorrent_name: &quot;{{ item }}&quot;</span><span class="diff-line add">+      loop: &quot;{{ qbittorrent_instances | default([&#x27;qbittorrent&#x27;]) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context">     - name: Import &#x27;motd.yml&#x27; template</span><span class="diff-line context">       ansible.builtin.template:</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-230">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/motd/tasks/main.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -9,7 +9,7 @@</span><span class="diff-line context"> ---</span><span class="diff-line context"> - name: Install required packages</span><span class="diff-line context">   ansible.builtin.apt:</span><span class="diff-line del">-    state: present</span><span class="diff-line add">+    state: latest</span><span class="diff-line context">     name:</span><span class="diff-line context">       - lsb-release</span><span class="diff-line context">       - figlet</span><span class="diff-line hunk">@@ -19,11 +19,11 @@</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Install required packages</span><span class="diff-line context">   ansible.builtin.apt:</span><span class="diff-line del">-    state: present</span><span class="diff-line add">+    state: latest</span><span class="diff-line context">     name:</span><span class="diff-line context">       - update-motd</span><span class="diff-line context">       - update-notifier-common</span><span class="diff-line del">-  when: (ansible_distribution | lower == &#x27;ubuntu&#x27;)</span><span class="diff-line add">+  when: (ansible_facts[&#x27;distribution&#x27;] | lower == &#x27;ubuntu&#x27;)</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Remove existing motd</span><span class="diff-line context">   ansible.builtin.file:</span><span class="diff-line hunk">@@ -44,7 +44,7 @@</span><span class="diff-line context">     mode: &quot;0775&quot;</span><span class="diff-line context">     recurse: true</span><span class="diff-line context">   with_items:</span><span class="diff-line del">-    - /opt/motd</span><span class="diff-line add">+    - &quot;{{ server_appdata_path }}/motd&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Check if MOTD news service</span><span class="diff-line context">   ansible.builtin.stat:</span><span class="diff-line hunk">@@ -66,14 +66,14 @@</span><span class="diff-line context">   ansible.builtin.systemd_service:</span><span class="diff-line context">     name: motd-news.service</span><span class="diff-line context">     state: stopped</span><span class="diff-line del">-    enabled: no</span><span class="diff-line add">+    enabled: false</span><span class="diff-line context">     masked: true</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Disable MOTD news timer</span><span class="diff-line context">   ansible.builtin.systemd_service:</span><span class="diff-line context">     name: motd-news.timer</span><span class="diff-line context">     state: stopped</span><span class="diff-line del">-    enabled: no</span><span class="diff-line add">+    enabled: false</span><span class="diff-line context">     masked: true</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Create dynamic motd directory</span><span class="diff-line hunk">@@ -98,7 +98,7 @@</span><span class="diff-line context"> - name: Install &#x27;openssh-server&#x27;</span><span class="diff-line context">   ansible.builtin.apt:</span><span class="diff-line context">     name: openssh-server</span><span class="diff-line del">-    state: present</span><span class="diff-line add">+    state: latest</span><span class="diff-line context">   when: (not sshd_config.stat.exists)</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Wait for &#x27;/etc/ssh/sshd_config&#x27; to be created</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-231">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/motd/tasks/python_motd.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -10,7 +10,7 @@</span><span class="diff-line context"> - name: Clone Saltbox MOTD</span><span class="diff-line context">   ansible.builtin.git:</span><span class="diff-line context">     repo: https://github.com/saltyorg/motd.git</span><span class="diff-line del">-    dest: /opt/motd</span><span class="diff-line add">+    dest: &quot;{{ server_appdata_path }}/motd&quot;</span><span class="diff-line context">     clone: true</span><span class="diff-line context">     version: HEAD</span><span class="diff-line context">     force: true</span><span class="diff-line hunk">@@ -19,13 +19,13 @@</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Check if &#x27;config.json&#x27; exists</span><span class="diff-line context">   ansible.builtin.stat:</span><span class="diff-line del">-    path: &quot;/opt/motd/config.json&quot;</span><span class="diff-line add">+    path: &quot;{{ server_appdata_path }}/motd/config.json&quot;</span><span class="diff-line context">   register: motd_config</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Import default &#x27;config.json&#x27;</span><span class="diff-line context">   ansible.builtin.template:</span><span class="diff-line context">     src: config.json.j2</span><span class="diff-line del">-    dest: /opt/motd/config.json</span><span class="diff-line add">+    dest: &quot;{{ server_appdata_path }}/motd/config.json&quot;</span><span class="diff-line context">     owner: &quot;{{ user.name }}&quot;</span><span class="diff-line context">     group: &quot;{{ user.name }}&quot;</span><span class="diff-line context">     mode: &quot;0664&quot;</span><span class="diff-line hunk">@@ -36,29 +36,29 @@</span><span class="diff-line context">   when: motd_config.stat.exists</span><span class="diff-line context">   block:</span><span class="diff-line context">     - name: Check value of motd banner</span><span class="diff-line del">-      ansible.builtin.shell: &quot;jq &#x27;.motd.banner_title&#x27; /opt/motd/config.json&quot;</span><span class="diff-line add">+      ansible.builtin.shell: &quot;jq &#x27;.motd.banner_title&#x27; {{ server_appdata_path }}/motd/config.json&quot;</span><span class="diff-line context">       register: motd_banner</span><span class="diff-line context"> </span><span class="diff-line context">     - name: Migrate value of motd banner</span><span class="diff-line context">       ansible.builtin.shell: |</span><span class="diff-line del">-        jq &#x27;.motd.banner_title = &quot;Saltbox&quot;&#x27; /opt/motd/config.json | sponge /opt/motd/config.json</span><span class="diff-line add">+        jq &#x27;.motd.banner_title = &quot;Saltbox&quot;&#x27; {{ server_appdata_path }}/motd/config.json | sponge {{ server_appdata_path }}/motd/config.json</span><span class="diff-line context">       when: (&#x27;Cloudbox&#x27; in motd_banner.stdout)</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Config path migration</span><span class="diff-line context">   when: motd_config.stat.exists</span><span class="diff-line context">   block:</span><span class="diff-line context">     - name: Check value of disk path</span><span class="diff-line del">-      ansible.builtin.shell: &quot;jq &#x27;.disk.path&#x27; /opt/motd/config.json&quot;</span><span class="diff-line add">+      ansible.builtin.shell: &quot;jq &#x27;.disk.path&#x27; {{ server_appdata_path }}/motd/config.json&quot;</span><span class="diff-line context">       register: disk_path</span><span class="diff-line context"> </span><span class="diff-line context">     - name: Migrate value of disk path  # noqa jinja[spacing]</span><span class="diff-line context">       ansible.builtin.shell: |</span><span class="diff-line del">-        jq --arg disk / &#x27;. + {disk: {path: $disk}}&#x27; /opt/motd/config.json | sponge /opt/motd/config.json</span><span class="diff-line add">+        jq --arg disk / &#x27;. + {disk: {path: $disk}}&#x27; {{ server_appdata_path }}/motd/config.json | sponge {{ server_appdata_path }}/motd/config.json</span><span class="diff-line context">       when: (disk_path.stdout == &#x27;null&#x27;)</span><span class="diff-line context"> </span><span class="diff-line del">-- name: Touch &#x27;/opt/motd/activity.log&#x27; file</span><span class="diff-line add">+- name: Touch &#x27;{{ server_appdata_path }}/motd/activity.log&#x27; file</span><span class="diff-line context">   ansible.builtin.file:</span><span class="diff-line del">-    path: /opt/motd/activity.log</span><span class="diff-line add">+    path: &quot;{{ server_appdata_path }}/motd/activity.log&quot;</span><span class="diff-line context">     state: touch</span><span class="diff-line context">     owner: &quot;{{ user.name }}&quot;</span><span class="diff-line context">     group: &quot;{{ user.name }}&quot;</span><span class="diff-line hunk">@@ -66,14 +66,14 @@</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Set &#x27;saltbox-motd.py&#x27; as executable</span><span class="diff-line context">   ansible.builtin.file:</span><span class="diff-line del">-    path: /opt/motd/saltbox-motd.py</span><span class="diff-line add">+    path: &quot;{{ server_appdata_path }}/motd/saltbox-motd.py&quot;</span><span class="diff-line context">     owner: &quot;{{ user.name }}&quot;</span><span class="diff-line context">     group: &quot;{{ user.name }}&quot;</span><span class="diff-line context">     mode: a+x</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Import dynamic motd files</span><span class="diff-line context">   ansible.builtin.copy:</span><span class="diff-line del">-    src: /opt/motd/motd/</span><span class="diff-line add">+    src: &quot;{{ server_appdata_path }}/motd/motd/&quot;</span><span class="diff-line context">     dest: /etc/update-motd.d/</span><span class="diff-line context">     force: true</span><span class="diff-line context">     mode: &quot;0775&quot;</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-232">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/motd/templates/motd.yml.j2</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -1,33 +1,151 @@</span><span class="diff-line context"> ---</span><span class="diff-line del">-{% set services = [&#x27;lidarr&#x27;, &#x27;plex&#x27;, &#x27;radarr&#x27;, &#x27;readarr&#x27;, &#x27;sonarr&#x27;] %}</span><span class="diff-line del">-{% for service in services %}</span><span class="diff-line del">-{% set service_info_var = service + &#x27;_info&#x27; %}</span><span class="diff-line add">+{% for service in motd_services %}</span><span class="diff-line add">+{% set service_name = service.name %}</span><span class="diff-line add">+{% set service_info_var = service_name + &#x27;_info&#x27; %}</span><span class="diff-line context"> {% set installed_instances = [] %}</span><span class="diff-line del">-{% if vars[service_info_var] is defined %}</span><span class="diff-line del">-{% for instance_name, instance_data in vars[service_info_var].items() %}</span><span class="diff-line del">-{% if service == &#x27;plex&#x27; %}</span><span class="diff-line del">-{% if instance_data.token != &#x27;not installed&#x27; %}</span><span class="diff-line del">-{% set _ = installed_instances.append({&#x27;name&#x27;: instance_data.name, &#x27;url&#x27;: instance_data.url, &#x27;token&#x27;: instance_data.token}) %}</span><span class="diff-line del">-{% endif %}</span><span class="diff-line del">-{% else %}</span><span class="diff-line del">-{% if instance_data.api_key != &#x27;not installed&#x27; %}</span><span class="diff-line del">-{% set _ = installed_instances.append({&#x27;name&#x27;: instance_data.name, &#x27;url&#x27;: instance_data.url, &#x27;apikey&#x27;: instance_data.api_key}) %}</span><span class="diff-line del">-{% endif %}</span><span class="diff-line add">+{# Multi-instance services with API key or token #}</span><span class="diff-line add">+{% if service.type in [&#x27;multi_instance_apikey&#x27;, &#x27;multi_instance_token&#x27;] %}</span><span class="diff-line add">+{% set has_installed = [] %}</span><span class="diff-line add">+{% if lookup(&#x27;vars&#x27;, service_info_var, default=None) is not none %}</span><span class="diff-line add">+{% for instance_name, instance_data in lookup(&#x27;vars&#x27;, service_info_var).items() %}</span><span class="diff-line add">+{% set instance_entry = {&#x27;name&#x27;: instance_data.name, &#x27;url&#x27;: instance_data.url} %}</span><span class="diff-line add">+{% set _ = instance_entry.update({service.output_field: instance_data[service.check_field]}) %}</span><span class="diff-line add">+{% set _ = installed_instances.append(instance_entry) %}</span><span class="diff-line add">+{% if instance_data[service.check_field] != &#x27;not installed&#x27; %}</span><span class="diff-line add">+{% set _ = has_installed.append(true) %}</span><span class="diff-line context"> {% endif %}</span><span class="diff-line context"> {% endfor %}</span><span class="diff-line context"> {% endif %}</span><span class="diff-line context"> {% if installed_instances %}</span><span class="diff-line del">-{{ service }}:</span><span class="diff-line add">+{{ service_name }}:</span><span class="diff-line add">+  enabled: {{ (has_installed | length &gt; 0) | lower }}</span><span class="diff-line add">+  instances:</span><span class="diff-line context"> {% for instance in installed_instances %}</span><span class="diff-line del">-  - name: {{ instance.name }}</span><span class="diff-line del">-    url: {{ instance.url }}</span><span class="diff-line del">-{% if service == &#x27;plex&#x27; %}</span><span class="diff-line del">-    token: {{ instance.token }}</span><span class="diff-line add">+    - name: {{ instance.name }}</span><span class="diff-line add">+      url: {{ instance.url }}</span><span class="diff-line add">+      {{ service.output_field }}: {{ instance[service.output_field] if instance[service.output_field] != &#x27;not installed&#x27; else &#x27;your-&#x27; + service.output_field + &#x27;-here&#x27; }}</span><span class="diff-line add">+      enabled: true</span><span class="diff-line add">+{% endfor %}</span><span class="diff-line context"> {% else %}</span><span class="diff-line del">-    apikey: {{ instance.apikey }}</span><span class="diff-line add">+{{ service_name }}:</span><span class="diff-line add">+  enabled: false</span><span class="diff-line add">+  instances:</span><span class="diff-line add">+    - name: {{ service_name | capitalize }}</span><span class="diff-line add">+      url: http://localhost:8080</span><span class="diff-line add">+      {{ service.output_field }}: your-{{ service.output_field }}-here</span><span class="diff-line add">+      enabled: true</span><span class="diff-line add">+{% endif %}</span><span class="diff-line add">+{# Single-instance services with API key #}</span><span class="diff-line add">+{% elif service.type == &#x27;single_instance_apikey&#x27; %}</span><span class="diff-line add">+{% set service_info = lookup(&#x27;vars&#x27;, service_info_var, default=None) %}</span><span class="diff-line add">+{% if service_info is not none and service_info[service.check_field] != &#x27;not installed&#x27; %}</span><span class="diff-line add">+{{ service_name }}:</span><span class="diff-line add">+  enabled: true</span><span class="diff-line add">+  instances:</span><span class="diff-line add">+    - name: {{ service_info.name }}</span><span class="diff-line add">+      url: {{ service_info.url }}</span><span class="diff-line add">+      {{ service.output_field }}: {{ service_info[service.check_field] }}</span><span class="diff-line add">+      enabled: true</span><span class="diff-line add">+{% else %}</span><span class="diff-line add">+{{ service_name }}:</span><span class="diff-line add">+  enabled: false</span><span class="diff-line add">+  instances:</span><span class="diff-line add">+    - name: {{ service_name | capitalize }}</span><span class="diff-line add">+      url: http://localhost:8080</span><span class="diff-line add">+      {{ service.output_field }}: your-{{ service.output_field }}-here</span><span class="diff-line add">+      enabled: true</span><span class="diff-line add">+{% endif %}</span><span class="diff-line add">+{# Single-instance services with username/password #}</span><span class="diff-line add">+{% elif service.type == &#x27;single_instance_userpass&#x27; %}</span><span class="diff-line add">+{% set service_info = lookup(&#x27;vars&#x27;, service_info_var, default=None) %}</span><span class="diff-line add">+{% if service_info is not none and service_info[service.check_field] != &#x27;not installed&#x27; %}</span><span class="diff-line add">+{{ service_name }}:</span><span class="diff-line add">+  enabled: true</span><span class="diff-line add">+  instances:</span><span class="diff-line add">+    - name: {{ service_info.name }}</span><span class="diff-line add">+      url: {{ service_info.url }}</span><span class="diff-line add">+      user: {{ service_info.username }}</span><span class="diff-line add">+      password: {{ service_info.password }}</span><span class="diff-line add">+      enabled: true</span><span class="diff-line add">+{% else %}</span><span class="diff-line add">+{{ service_name }}:</span><span class="diff-line add">+  enabled: false</span><span class="diff-line add">+  instances:</span><span class="diff-line add">+    - name: {{ service_name | capitalize }}</span><span class="diff-line add">+      url: http://localhost:6789</span><span class="diff-line add">+      user: {{ service_name }}</span><span class="diff-line add">+      password: your-password-here</span><span class="diff-line add">+      enabled: true</span><span class="diff-line add">+{% endif %}</span><span class="diff-line add">+{# Multi-instance services with username/password using info dict (e.g., qbittorrent) #}</span><span class="diff-line add">+{% elif service.type == &#x27;multi_instance_userpass_info&#x27; %}</span><span class="diff-line add">+{% if lookup(&#x27;vars&#x27;, service_info_var, default=None) is not none %}</span><span class="diff-line add">+{% for instance_name, instance_data in lookup(&#x27;vars&#x27;, service_info_var).items() %}</span><span class="diff-line add">+{% if instance_data[service.check_field] != &#x27;not installed&#x27; %}</span><span class="diff-line add">+{% set instance_entry = {&#x27;name&#x27;: instance_data.name, &#x27;url&#x27;: instance_data.url, &#x27;username&#x27;: instance_data.username, &#x27;password&#x27;: instance_data.password} %}</span><span class="diff-line add">+{% set _ = installed_instances.append(instance_entry) %}</span><span class="diff-line context"> {% endif %}</span><span class="diff-line context"> {% endfor %}</span><span class="diff-line add">+{% endif %}</span><span class="diff-line add">+{% if installed_instances %}</span><span class="diff-line add">+{{ service_name }}:</span><span class="diff-line add">+  enabled: true</span><span class="diff-line add">+  instances:</span><span class="diff-line add">+{% for instance in installed_instances %}</span><span class="diff-line add">+    - name: {{ instance.name }}</span><span class="diff-line add">+      url: {{ instance.url }}</span><span class="diff-line add">+      user: {{ instance.username }}</span><span class="diff-line add">+      password: {{ instance.password }}</span><span class="diff-line add">+      enabled: true</span><span class="diff-line add">+{% endfor %}</span><span class="diff-line context"> {% else %}</span><span class="diff-line del">-{{ service }}: []</span><span class="diff-line add">+{{ service_name }}:</span><span class="diff-line add">+  enabled: false</span><span class="diff-line add">+  instances:</span><span class="diff-line add">+    - name: {{ service_name | capitalize }}</span><span class="diff-line add">+      url: http://localhost:8080</span><span class="diff-line add">+      user: your-username-here</span><span class="diff-line add">+      password: your-password-here</span><span class="diff-line add">+      enabled: true</span><span class="diff-line add">+{% endif %}</span><span class="diff-line add">+{# Multi-instance services with username/password using direct lookup (e.g., rutorrent) #}</span><span class="diff-line add">+{% elif service.type == &#x27;multi_instance_userpass&#x27; %}</span><span class="diff-line add">+{% set config_key = motd_config_mapping[service_name] | default(service_name) %}</span><span class="diff-line add">+{% set instances_list = lookup(&#x27;vars&#x27;, service.instances_var, default=[service_name]) %}</span><span class="diff-line add">+{% set url_suffix = service.url_suffix | default(&#x27;&#x27;) %}</span><span class="diff-line add">+{{ config_key }}:</span><span class="diff-line add">+  enabled: true</span><span class="diff-line add">+  instances:</span><span class="diff-line add">+{% for instance in instances_list %}</span><span class="diff-line add">+    - name: {{ instance }}</span><span class="diff-line add">+      url: {{ lookup(&#x27;role_var&#x27;, &#x27;_web_url&#x27;, role=instance) + url_suffix }}</span><span class="diff-line add">+      user: {{ user.name }}</span><span class="diff-line add">+      password: {{ user.pass }}</span><span class="diff-line add">+      enabled: true</span><span class="diff-line add">+{% endfor %}</span><span class="diff-line add">+{# Systemd service #}</span><span class="diff-line add">+{% elif service.type == &#x27;systemd&#x27; %}</span><span class="diff-line add">+{{ service_name }}:</span><span class="diff-line add">+  enabled: {{ motd_systemd.enabled | lower }}</span><span class="diff-line add">+  additional_services: {{ motd_systemd.additional_services | to_json }}</span><span class="diff-line add">+  display_names: {{ motd_systemd.display_names | to_json }}</span><span class="diff-line add">+{# Colors #}</span><span class="diff-line add">+{% elif service.type == &#x27;colors&#x27; %}</span><span class="diff-line add">+{{ service_name }}:</span><span class="diff-line add">+  text:</span><span class="diff-line add">+    label: &quot;{{ motd_colors.text.label }}&quot;</span><span class="diff-line add">+    value: &quot;{{ motd_colors.text.value }}&quot;</span><span class="diff-line add">+    app_name: &quot;{{ motd_colors.text.app_name }}&quot;</span><span class="diff-line add">+  status:</span><span class="diff-line add">+    warning: &quot;{{ motd_colors.status.warning }}&quot;</span><span class="diff-line add">+    success: &quot;{{ motd_colors.status.success }}&quot;</span><span class="diff-line add">+    error: &quot;{{ motd_colors.status.error }}&quot;</span><span class="diff-line add">+  progress_bar:</span><span class="diff-line add">+    low: &quot;{{ motd_colors.progress_bar.low }}&quot;</span><span class="diff-line add">+    high: &quot;{{ motd_colors.progress_bar.high }}&quot;</span><span class="diff-line add">+    critical: &quot;{{ motd_colors.progress_bar.critical }}&quot;</span><span class="diff-line add">+{% endif %}</span><span class="diff-line add">+{% if not loop.last %}</span><span class="diff-line add">+</span><span class="diff-line context"> {% endif %}</span><span class="diff-line context"> {% endfor %}</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-233">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/mount_templates/tasks/main.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -16,12 +16,12 @@</span><span class="diff-line context">     mode: &quot;0775&quot;</span><span class="diff-line context">     recurse: true</span><span class="diff-line context">   with_items:</span><span class="diff-line del">-    - /opt/mount-templates</span><span class="diff-line add">+    - &quot;{{ server_appdata_path }}/mount-templates&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Clone mount-templates repo &#x27;HEAD&#x27;</span><span class="diff-line context">   ansible.builtin.git:</span><span class="diff-line context">     repo: https://github.com/saltyorg/mount-templates.git</span><span class="diff-line del">-    dest: /opt/mount-templates</span><span class="diff-line add">+    dest: &quot;{{ server_appdata_path }}/mount-templates&quot;</span><span class="diff-line context">     clone: true</span><span class="diff-line context">     version: HEAD</span><span class="diff-line context">     force: true</span><span class="diff-line hunk">@@ -33,7 +33,7 @@</span><span class="diff-line context"> - name: Clone mount-templates repo &#x27;main&#x27;</span><span class="diff-line context">   ansible.builtin.git:</span><span class="diff-line context">     repo: https://github.com/saltyorg/mount-templates.git</span><span class="diff-line del">-    dest: /opt/mount-templates</span><span class="diff-line add">+    dest: &quot;{{ server_appdata_path }}/mount-templates&quot;</span><span class="diff-line context">     clone: true</span><span class="diff-line context">     version: main</span><span class="diff-line context">     force: true</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-234">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/netdata/defaults/main.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -17,100 +17,88 @@</span><span class="diff-line context"> # Settings</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-netdata_claim_token: &quot;&quot;</span><span class="diff-line del">-netdata_claim_url: &quot;&quot;</span><span class="diff-line del">-netdata_claim_room: &quot;&quot;</span><span class="diff-line add">+netdata_role_claim_token: &quot;&quot;</span><span class="diff-line add">+netdata_role_claim_url: &quot;&quot;</span><span class="diff-line add">+netdata_role_claim_room: &quot;&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # Docker Socket Proxy</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-netdata_docker_socket_proxy_envs:</span><span class="diff-line add">+netdata_role_docker_socket_proxy_envs:</span><span class="diff-line context">   CONTAINERS: &quot;1&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # Paths</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-netdata_paths_folder: &quot;{{ netdata_name }}&quot;</span><span class="diff-line del">-netdata_paths_location: &quot;{{ server_appdata_path }}/{{ netdata_paths_folder }}&quot;</span><span class="diff-line del">-netdata_paths_config_location: &quot;{{ netdata_paths_location }}/config&quot;</span><span class="diff-line del">-netdata_paths_config_file_location: &quot;{{ netdata_paths_location }}/config/netdata.conf&quot;</span><span class="diff-line del">-netdata_paths_folders_list:</span><span class="diff-line del">-  - &quot;{{ netdata_paths_location }}&quot;</span><span class="diff-line del">-  - &quot;{{ netdata_paths_location }}/config&quot;</span><span class="diff-line add">+netdata_role_paths_folder: &quot;{{ netdata_name }}&quot;</span><span class="diff-line add">+netdata_role_paths_location: &quot;{{ server_appdata_path }}/{{ netdata_role_paths_folder }}&quot;</span><span class="diff-line add">+netdata_role_paths_config_location: &quot;{{ netdata_role_paths_location }}/config&quot;</span><span class="diff-line add">+netdata_role_paths_config_file_location: &quot;{{ netdata_role_paths_location }}/config/netdata.conf&quot;</span><span class="diff-line add">+netdata_role_paths_folders_list:</span><span class="diff-line add">+  - &quot;{{ netdata_role_paths_location }}&quot;</span><span class="diff-line add">+  - &quot;{{ netdata_role_paths_location }}/config&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # Web</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-netdata_web_subdomain: &quot;{{ netdata_name }}&quot;</span><span class="diff-line del">-netdata_web_domain: &quot;{{ user.domain }}&quot;</span><span class="diff-line del">-netdata_web_port: &quot;19999&quot;</span><span class="diff-line del">-netdata_web_url: &quot;{{ &#x27;https://&#x27; + (netdata_web_subdomain + &#x27;.&#x27; + netdata_web_domain</span><span class="diff-line del">-                  if (netdata_web_subdomain | length &gt; 0)</span><span class="diff-line del">-                  else netdata_web_domain) }}&quot;</span><span class="diff-line add">+netdata_role_web_subdomain: &quot;{{ netdata_name }}&quot;</span><span class="diff-line add">+netdata_role_web_domain: &quot;{{ user.domain }}&quot;</span><span class="diff-line add">+netdata_role_web_port: &quot;19999&quot;</span><span class="diff-line add">+netdata_role_web_url: &quot;{{ &#x27;https://&#x27; + (lookup(&#x27;role_var&#x27;, &#x27;_web_subdomain&#x27;, role=&#x27;netdata&#x27;) + &#x27;.&#x27; + lookup(&#x27;role_var&#x27;, &#x27;_web_domain&#x27;, role=&#x27;netdata&#x27;)</span><span class="diff-line add">+                       if (lookup(&#x27;role_var&#x27;, &#x27;_web_subdomain&#x27;, role=&#x27;netdata&#x27;) | length &gt; 0)</span><span class="diff-line add">+                       else lookup(&#x27;role_var&#x27;, &#x27;_web_domain&#x27;, role=&#x27;netdata&#x27;)) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # DNS</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-netdata_dns_record: &quot;{{ netdata_web_subdomain }}&quot;</span><span class="diff-line del">-netdata_dns_zone: &quot;{{ netdata_web_domain }}&quot;</span><span class="diff-line del">-netdata_dns_proxy: &quot;{{ dns.proxied }}&quot;</span><span class="diff-line add">+netdata_role_dns_record: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_web_subdomain&#x27;, role=&#x27;netdata&#x27;) }}&quot;</span><span class="diff-line add">+netdata_role_dns_zone: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_web_domain&#x27;, role=&#x27;netdata&#x27;) }}&quot;</span><span class="diff-line add">+netdata_role_dns_proxy: &quot;{{ dns_proxied }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # Traefik</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-netdata_traefik_sso_middleware: &quot;{{ traefik_default_sso_middleware }}&quot;</span><span class="diff-line del">-netdata_traefik_middleware_default: &quot;{{ traefik_default_middleware }}&quot;</span><span class="diff-line del">-netdata_traefik_middleware_custom: &quot;&quot;</span><span class="diff-line del">-netdata_traefik_certresolver: &quot;{{ traefik_default_certresolver }}&quot;</span><span class="diff-line del">-netdata_traefik_enabled: true</span><span class="diff-line del">-netdata_traefik_api_enabled: false</span><span class="diff-line del">-netdata_traefik_api_endpoint: &quot;&quot;</span><span class="diff-line add">+netdata_role_traefik_sso_middleware: &quot;{{ traefik_default_sso_middleware }}&quot;</span><span class="diff-line add">+netdata_role_traefik_middleware_default: &quot;{{ traefik_default_middleware }}&quot;</span><span class="diff-line add">+netdata_role_traefik_middleware_custom: &quot;&quot;</span><span class="diff-line add">+netdata_role_traefik_certresolver: &quot;{{ traefik_default_certresolver }}&quot;</span><span class="diff-line add">+netdata_role_traefik_enabled: true</span><span class="diff-line add">+netdata_role_traefik_api_enabled: false</span><span class="diff-line add">+netdata_role_traefik_api_endpoint: &quot;&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # Docker</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line context"> # Container</span><span class="diff-line del">-netdata_docker_container: &quot;{{ netdata_name }}&quot;</span><span class="diff-line add">+netdata_role_docker_container: &quot;{{ netdata_name }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Image</span><span class="diff-line del">-netdata_docker_image_pull: true</span><span class="diff-line del">-netdata_docker_image_tag: &quot;latest&quot;</span><span class="diff-line del">-netdata_docker_image: &quot;netdata/netdata:{{ netdata_docker_image_tag }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Ports</span><span class="diff-line del">-netdata_docker_ports_defaults: []</span><span class="diff-line del">-netdata_docker_ports_custom: []</span><span class="diff-line del">-netdata_docker_ports: &quot;{{ netdata_docker_ports_defaults</span><span class="diff-line del">-                          + netdata_docker_ports_custom }}&quot;</span><span class="diff-line add">+netdata_role_docker_image_pull: true</span><span class="diff-line add">+netdata_role_docker_image_repo: &quot;netdata/netdata&quot;</span><span class="diff-line add">+netdata_role_docker_image_tag: &quot;latest&quot;</span><span class="diff-line add">+netdata_role_docker_image: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_image_repo&#x27;, role=&#x27;netdata&#x27;) }}:{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_image_tag&#x27;, role=&#x27;netdata&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Envs</span><span class="diff-line del">-netdata_docker_envs_default:</span><span class="diff-line add">+netdata_role_docker_envs_default:</span><span class="diff-line context">   PGID: &quot;{{ gid }}&quot;</span><span class="diff-line context">   TZ: &quot;{{ tz }}&quot;</span><span class="diff-line context">   DOCKER_HOST: &quot;{{ netdata_name }}-docker-socket-proxy:2375&quot;</span><span class="diff-line del">-  NETDATA_CLAIM_TOKEN: &quot;{{ netdata_claim_token }}&quot;</span><span class="diff-line del">-  NETDATA_CLAIM_URL: &quot;{{ netdata_claim_url }}&quot;</span><span class="diff-line del">-  NETDATA_CLAIM_ROOMS: &quot;{{ netdata_claim_room }}&quot;</span><span class="diff-line del">-netdata_docker_envs_custom: {}</span><span class="diff-line del">-netdata_docker_envs: &quot;{{ netdata_docker_envs_default</span><span class="diff-line del">-                         | combine(netdata_docker_envs_custom) }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Commands</span><span class="diff-line del">-netdata_docker_commands_default: []</span><span class="diff-line del">-netdata_docker_commands_custom: []</span><span class="diff-line del">-netdata_docker_commands: &quot;{{ netdata_docker_commands_default</span><span class="diff-line del">-                             + netdata_docker_commands_custom }}&quot;</span><span class="diff-line add">+  NETDATA_CLAIM_TOKEN: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_claim_token&#x27;, role=&#x27;netdata&#x27;) }}&quot;</span><span class="diff-line add">+  NETDATA_CLAIM_URL: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_claim_url&#x27;, role=&#x27;netdata&#x27;) }}&quot;</span><span class="diff-line add">+  NETDATA_CLAIM_ROOMS: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_claim_room&#x27;, role=&#x27;netdata&#x27;) }}&quot;</span><span class="diff-line add">+netdata_role_docker_envs_custom: {}</span><span class="diff-line add">+netdata_role_docker_envs: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_envs_default&#x27;, role=&#x27;netdata&#x27;)</span><span class="diff-line add">+                              | combine(lookup(&#x27;role_var&#x27;, &#x27;_docker_envs_custom&#x27;, role=&#x27;netdata&#x27;)) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Volumes</span><span class="diff-line del">-netdata_docker_volumes_global: false</span><span class="diff-line del">-netdata_docker_volumes_default:</span><span class="diff-line del">-  - &quot;{{ netdata_paths_location }}/config:/etc/netdata&quot;</span><span class="diff-line add">+netdata_role_docker_volumes_default:</span><span class="diff-line add">+  - &quot;{{ netdata_role_paths_location }}/config:/etc/netdata&quot;</span><span class="diff-line context">   - &quot;netdatalib:/var/lib/netdata&quot;</span><span class="diff-line context">   - &quot;netdatacache:/var/cache/netdata&quot;</span><span class="diff-line context">   - &quot;/etc/passwd:/host/etc/passwd:ro&quot;</span><span class="diff-line hunk">@@ -120,66 +108,52 @@</span><span class="diff-line context">   - &quot;/etc/os-release:/host/etc/os-release:ro&quot;</span><span class="diff-line context">   - &quot;/var/log:/host/var/log:ro&quot;</span><span class="diff-line context">   - &quot;/run/dbus:/run/dbus:ro&quot;</span><span class="diff-line del">-netdata_docker_volumes_custom: []</span><span class="diff-line del">-netdata_docker_volumes: &quot;{{ netdata_docker_volumes_default</span><span class="diff-line del">-                            + netdata_docker_volumes_custom }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Devices</span><span class="diff-line del">-netdata_docker_devices_default: []</span><span class="diff-line del">-netdata_docker_devices_custom: []</span><span class="diff-line del">-netdata_docker_devices: &quot;{{ netdata_docker_devices_default</span><span class="diff-line del">-                            + netdata_docker_devices_custom }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Hosts</span><span class="diff-line del">-netdata_docker_hosts_default: {}</span><span class="diff-line del">-netdata_docker_hosts_custom: {}</span><span class="diff-line del">-netdata_docker_hosts: &quot;{{ docker_hosts_common</span><span class="diff-line del">-                          | combine(netdata_docker_hosts_default)</span><span class="diff-line del">-                          | combine(netdata_docker_hosts_custom) }}&quot;</span><span class="diff-line add">+netdata_role_docker_volumes_custom: []</span><span class="diff-line add">+netdata_role_docker_volumes: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_volumes_default&#x27;, role=&#x27;netdata&#x27;)</span><span class="diff-line add">+                                 + lookup(&#x27;role_var&#x27;, &#x27;_docker_volumes_custom&#x27;, role=&#x27;netdata&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Labels</span><span class="diff-line del">-netdata_docker_labels_default: {}</span><span class="diff-line del">-netdata_docker_labels_custom: {}</span><span class="diff-line del">-netdata_docker_labels: &quot;{{ docker_labels_common</span><span class="diff-line del">-                           | combine(netdata_docker_labels_default)</span><span class="diff-line del">-                           | combine(netdata_docker_labels_custom) }}&quot;</span><span class="diff-line add">+netdata_role_docker_labels_default: {}</span><span class="diff-line add">+netdata_role_docker_labels_custom: {}</span><span class="diff-line add">+netdata_role_docker_labels: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_labels_default&#x27;, role=&#x27;netdata&#x27;)</span><span class="diff-line add">+                                | combine(lookup(&#x27;role_var&#x27;, &#x27;_docker_labels_custom&#x27;, role=&#x27;netdata&#x27;)) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Hostname</span><span class="diff-line del">-netdata_docker_hostname: &quot;{{ netdata_name }}&quot;</span><span class="diff-line add">+netdata_role_docker_hostname: &quot;{{ netdata_name }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Networks</span><span class="diff-line del">-netdata_docker_networks_alias: &quot;{{ netdata_name }}&quot;</span><span class="diff-line del">-netdata_docker_networks_default: []</span><span class="diff-line del">-netdata_docker_networks_custom: []</span><span class="diff-line del">-netdata_docker_networks: &quot;{{ docker_networks_common</span><span class="diff-line del">-                             + netdata_docker_networks_default</span><span class="diff-line del">-                             + netdata_docker_networks_custom }}&quot;</span><span class="diff-line add">+netdata_role_docker_networks_alias: &quot;{{ netdata_name }}&quot;</span><span class="diff-line add">+netdata_role_docker_networks_default: []</span><span class="diff-line add">+netdata_role_docker_networks_custom: []</span><span class="diff-line add">+netdata_role_docker_networks: &quot;{{ docker_networks_common</span><span class="diff-line add">+                                  + lookup(&#x27;role_var&#x27;, &#x27;_docker_networks_default&#x27;, role=&#x27;netdata&#x27;)</span><span class="diff-line add">+                                  + lookup(&#x27;role_var&#x27;, &#x27;_docker_networks_custom&#x27;, role=&#x27;netdata&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Capabilities</span><span class="diff-line del">-netdata_docker_capabilities_default:</span><span class="diff-line add">+netdata_role_docker_capabilities_default:</span><span class="diff-line context">   - SYS_PTRACE</span><span class="diff-line context">   - SYS_ADMIN</span><span class="diff-line del">-netdata_docker_capabilities_custom: []</span><span class="diff-line del">-netdata_docker_capabilities: &quot;{{ netdata_docker_capabilities_default</span><span class="diff-line del">-                                 + netdata_docker_capabilities_custom }}&quot;</span><span class="diff-line add">+netdata_role_docker_capabilities_custom: []</span><span class="diff-line add">+netdata_role_docker_capabilities: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_capabilities_default&#x27;, role=&#x27;netdata&#x27;)</span><span class="diff-line add">+                                      + lookup(&#x27;role_var&#x27;, &#x27;_docker_capabilities_custom&#x27;, role=&#x27;netdata&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Security Opts</span><span class="diff-line del">-netdata_docker_security_opts_default:</span><span class="diff-line add">+netdata_role_docker_security_opts_default:</span><span class="diff-line context">   - apparmor=unconfined</span><span class="diff-line del">-netdata_docker_security_opts_custom: []</span><span class="diff-line del">-netdata_docker_security_opts: &quot;{{ netdata_docker_security_opts_default</span><span class="diff-line del">-                                  + netdata_docker_security_opts_custom }}&quot;</span><span class="diff-line add">+netdata_role_docker_security_opts_custom: []</span><span class="diff-line add">+netdata_role_docker_security_opts: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_security_opts_default&#x27;, role=&#x27;netdata&#x27;)</span><span class="diff-line add">+                                       + lookup(&#x27;role_var&#x27;, &#x27;_docker_security_opts_custom&#x27;, role=&#x27;netdata&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Restart Policy</span><span class="diff-line del">-netdata_docker_restart_policy: unless-stopped</span><span class="diff-line add">+netdata_role_docker_restart_policy: unless-stopped</span><span class="diff-line context"> </span><span class="diff-line context"> # State</span><span class="diff-line del">-netdata_docker_state: started</span><span class="diff-line add">+netdata_role_docker_state: started</span><span class="diff-line context"> </span><span class="diff-line context"> # PID Mode</span><span class="diff-line del">-netdata_docker_pid_mode: &quot;host&quot;</span><span class="diff-line add">+netdata_role_docker_pid_mode: &quot;host&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Dependencies</span><span class="diff-line del">-netdata_depends_on: &quot;{{ netdata_name }}-docker-socket-proxy&quot;</span><span class="diff-line del">-netdata_depends_on_delay: &quot;0&quot;</span><span class="diff-line del">-netdata_depends_on_healthchecks: &quot;false&quot;</span><span class="diff-line add">+netdata_role_depends_on: &quot;{{ netdata_name }}-docker-socket-proxy&quot;</span><span class="diff-line add">+netdata_role_depends_on_delay: &quot;0&quot;</span><span class="diff-line add">+netdata_role_depends_on_healthchecks: &quot;false&quot;</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-235">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/netdata/tasks/main.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -12,28 +12,28 @@</span><span class="diff-line context">     name: docker_socket_proxy</span><span class="diff-line context">   vars:</span><span class="diff-line context">     docker_socket_proxy_name: &quot;{{ netdata_name }}-docker-socket-proxy&quot;</span><span class="diff-line del">-    docker_socket_proxy_docker_envs_custom: &quot;{{ netdata_docker_socket_proxy_envs }}&quot;</span><span class="diff-line add">+    docker_socket_proxy_role_docker_envs_custom: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_socket_proxy_envs&#x27;, role=&#x27;netdata&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Add DNS record</span><span class="diff-line context">   ansible.builtin.include_tasks: &quot;{{ resources_tasks_path }}/dns/tasker.yml&quot;</span><span class="diff-line context">   vars:</span><span class="diff-line del">-    dns_record: &quot;{{ lookup(&#x27;vars&#x27;, role_name + &#x27;_dns_record&#x27;) }}&quot;</span><span class="diff-line del">-    dns_zone: &quot;{{ lookup(&#x27;vars&#x27;, role_name + &#x27;_dns_zone&#x27;) }}&quot;</span><span class="diff-line del">-    dns_proxy: &quot;{{ lookup(&#x27;vars&#x27;, role_name + &#x27;_dns_proxy&#x27;) }}&quot;</span><span class="diff-line add">+    dns_record: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_dns_record&#x27;) }}&quot;</span><span class="diff-line add">+    dns_zone: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_dns_zone&#x27;) }}&quot;</span><span class="diff-line add">+    dns_proxy: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_dns_proxy&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Remove existing Docker container</span><span class="diff-line context">   ansible.builtin.include_tasks: &quot;{{ resources_tasks_path }}/docker/remove_docker_container.yml&quot;</span><span class="diff-line context"> </span><span class="diff-line del">-- name: Check if &#x27;{{ netdata_paths_config_file_location }}&#x27; exists</span><span class="diff-line add">+- name: Check if &#x27;{{ netdata_role_paths_config_file_location }}&#x27; exists</span><span class="diff-line context">   ansible.builtin.stat:</span><span class="diff-line del">-    path: &quot;{{ netdata_paths_config_file_location }}&quot;</span><span class="diff-line add">+    path: &quot;{{ netdata_role_paths_config_file_location }}&quot;</span><span class="diff-line context">   register: netdata_config</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Create directories</span><span class="diff-line context">   ansible.builtin.include_tasks: &quot;{{ resources_tasks_path }}/directories/create_directories.yml&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Settings Task</span><span class="diff-line del">-  ansible.builtin.import_tasks: &quot;subtasks/settings.yml&quot;</span><span class="diff-line add">+  ansible.builtin.include_tasks: &quot;subtasks/settings.yml&quot;</span><span class="diff-line context">   when: (not netdata_config.stat.exists)</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Create a volume</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-236">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/netdata/tasks/subtasks/settings.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -9,13 +9,13 @@</span><span class="diff-line context"> ---</span><span class="diff-line context"> - name: Settings | Copy Default Config if it doesn&#x27;t exist</span><span class="diff-line context">   ansible.builtin.shell: |</span><span class="diff-line del">-    docker run -d --name netdata_tmp &quot;{{ netdata_docker_image }}&quot;</span><span class="diff-line del">-    docker cp netdata_tmp:/etc/netdata/. &quot;{{ netdata_paths_config_location }}&quot;</span><span class="diff-line add">+    docker run -d --name netdata_tmp &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_image&#x27;, role=&#x27;netdata&#x27;) }}&quot;</span><span class="diff-line add">+    docker cp netdata_tmp:/etc/netdata/. &quot;{{ netdata_role_paths_location }}&quot;</span><span class="diff-line context">     docker rm -f netdata_tmp</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Chown directories</span><span class="diff-line context">   ansible.builtin.file:</span><span class="diff-line del">-    path: &quot;{{ netdata_paths_location }}&quot;</span><span class="diff-line add">+    path: &quot;{{ netdata_role_paths_location }}&quot;</span><span class="diff-line context">     state: directory</span><span class="diff-line context">     owner: &quot;{{ user.name }}&quot;</span><span class="diff-line context">     group: &quot;{{ user.name }}&quot;</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-237">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/nginx/defaults/main.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -17,133 +17,84 @@</span><span class="diff-line context"> # Paths</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-nginx_paths_folder: &quot;{{ nginx_name }}&quot;</span><span class="diff-line del">-nginx_paths_location: &quot;{{ server_appdata_path }}/{{ nginx_paths_folder }}&quot;</span><span class="diff-line del">-nginx_paths_folders_list:</span><span class="diff-line del">-  - &quot;{{ nginx_paths_location }}&quot;</span><span class="diff-line add">+nginx_role_paths_folder: &quot;{{ nginx_name }}&quot;</span><span class="diff-line add">+nginx_role_paths_location: &quot;{{ server_appdata_path }}/{{ nginx_role_paths_folder }}&quot;</span><span class="diff-line add">+nginx_role_paths_folders_list:</span><span class="diff-line add">+  - &quot;{{ nginx_role_paths_location }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # Web</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-nginx_web_subdomain: &quot;{{ nginx_name }}&quot;</span><span class="diff-line del">-nginx_web_domain: &quot;{{ user.domain }}&quot;</span><span class="diff-line del">-nginx_web_port: &quot;80&quot;</span><span class="diff-line del">-nginx_web_url: &quot;{{ &#x27;https://&#x27; + (lookup(&#x27;vars&#x27;, nginx_name + &#x27;_web_subdomain&#x27;, default=nginx_web_subdomain) + &#x27;.&#x27; + lookup(&#x27;vars&#x27;, nginx_name + &#x27;_web_domain&#x27;, default=nginx_web_domain)</span><span class="diff-line del">-                if (lookup(&#x27;vars&#x27;, nginx_name + &#x27;_web_subdomain&#x27;, default=nginx_web_subdomain) | length &gt; 0)</span><span class="diff-line del">-                else lookup(&#x27;vars&#x27;, nginx_name + &#x27;_web_domain&#x27;, default=nginx_web_domain)) }}&quot;</span><span class="diff-line add">+nginx_role_web_subdomain: &quot;{{ nginx_name }}&quot;</span><span class="diff-line add">+nginx_role_web_domain: &quot;{{ user.domain }}&quot;</span><span class="diff-line add">+nginx_role_web_port: &quot;80&quot;</span><span class="diff-line add">+nginx_role_web_url: &quot;{{ &#x27;https://&#x27; + (lookup(&#x27;role_var&#x27;, &#x27;_web_subdomain&#x27;, role=&#x27;nginx&#x27;) + &#x27;.&#x27; + lookup(&#x27;role_var&#x27;, &#x27;_web_domain&#x27;, role=&#x27;nginx&#x27;)</span><span class="diff-line add">+                     if (lookup(&#x27;role_var&#x27;, &#x27;_web_subdomain&#x27;, role=&#x27;nginx&#x27;) | length &gt; 0)</span><span class="diff-line add">+                     else lookup(&#x27;role_var&#x27;, &#x27;_web_domain&#x27;, role=&#x27;nginx&#x27;)) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # DNS</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-nginx_dns_record: &quot;{{ lookup(&#x27;vars&#x27;, nginx_name + &#x27;_web_subdomain&#x27;, default=nginx_web_subdomain) }}&quot;</span><span class="diff-line del">-nginx_dns_zone: &quot;{{ lookup(&#x27;vars&#x27;, nginx_name + &#x27;_web_domain&#x27;, default=nginx_web_domain) }}&quot;</span><span class="diff-line del">-nginx_dns_proxy: &quot;{{ dns.proxied }}&quot;</span><span class="diff-line add">+nginx_role_dns_record: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_web_subdomain&#x27;, role=&#x27;nginx&#x27;) }}&quot;</span><span class="diff-line add">+nginx_role_dns_zone: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_web_domain&#x27;, role=&#x27;nginx&#x27;) }}&quot;</span><span class="diff-line add">+nginx_role_dns_proxy: &quot;{{ dns_proxied }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # Traefik</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-nginx_traefik_sso_middleware: &quot;&quot;</span><span class="diff-line del">-nginx_traefik_middleware_default: &quot;{{ traefik_default_middleware }}&quot;</span><span class="diff-line del">-nginx_traefik_middleware_custom: &quot;&quot;</span><span class="diff-line del">-nginx_traefik_certresolver: &quot;{{ traefik_default_certresolver }}&quot;</span><span class="diff-line del">-nginx_traefik_enabled: true</span><span class="diff-line del">-nginx_traefik_api_enabled: false</span><span class="diff-line del">-nginx_traefik_api_endpoint: &quot;&quot;</span><span class="diff-line add">+nginx_role_traefik_sso_middleware: &quot;&quot;</span><span class="diff-line add">+nginx_role_traefik_middleware_default: &quot;{{ traefik_default_middleware }}&quot;</span><span class="diff-line add">+nginx_role_traefik_middleware_custom: &quot;&quot;</span><span class="diff-line add">+nginx_role_traefik_certresolver: &quot;{{ traefik_default_certresolver }}&quot;</span><span class="diff-line add">+nginx_role_traefik_enabled: true</span><span class="diff-line add">+nginx_role_traefik_api_enabled: false</span><span class="diff-line add">+nginx_role_traefik_api_endpoint: &quot;&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # Docker</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line context"> # Container</span><span class="diff-line del">-nginx_docker_container: &quot;{{ nginx_name }}&quot;</span><span class="diff-line add">+nginx_role_docker_container: &quot;{{ nginx_name }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Image</span><span class="diff-line del">-nginx_docker_image_pull: true</span><span class="diff-line del">-nginx_docker_image_repo: &quot;lscr.io/linuxserver/nginx&quot;</span><span class="diff-line del">-nginx_docker_image_tag: &quot;latest&quot;</span><span class="diff-line del">-nginx_docker_image: &quot;{{ lookup(&#x27;vars&#x27;, nginx_name + &#x27;_docker_image_repo&#x27;, default=nginx_docker_image_repo)</span><span class="diff-line del">-                        + &#x27;:&#x27; + lookup(&#x27;vars&#x27;, nginx_name + &#x27;_docker_image_tag&#x27;, default=nginx_docker_image_tag) }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Ports</span><span class="diff-line del">-nginx_docker_ports_defaults: []</span><span class="diff-line del">-nginx_docker_ports_custom: []</span><span class="diff-line del">-nginx_docker_ports: &quot;{{ lookup(&#x27;vars&#x27;, nginx_name + &#x27;_docker_ports_defaults&#x27;, default=nginx_docker_ports_defaults)</span><span class="diff-line del">-                        + lookup(&#x27;vars&#x27;, nginx_name + &#x27;_docker_ports_custom&#x27;, default=nginx_docker_ports_custom) }}&quot;</span><span class="diff-line add">+nginx_role_docker_image_pull: true</span><span class="diff-line add">+nginx_role_docker_image_repo: &quot;lscr.io/linuxserver/nginx&quot;</span><span class="diff-line add">+nginx_role_docker_image_tag: &quot;latest&quot;</span><span class="diff-line add">+nginx_role_docker_image: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_image_repo&#x27;, role=&#x27;nginx&#x27;) }}:{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_image_tag&#x27;, role=&#x27;nginx&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Envs</span><span class="diff-line del">-nginx_docker_envs_default:</span><span class="diff-line add">+nginx_role_docker_envs_default:</span><span class="diff-line context">   PUID: &quot;{{ uid }}&quot;</span><span class="diff-line context">   PGID: &quot;{{ gid }}&quot;</span><span class="diff-line context">   TZ: &quot;{{ tz }}&quot;</span><span class="diff-line del">-nginx_docker_envs_custom: {}</span><span class="diff-line del">-nginx_docker_envs: &quot;{{ lookup(&#x27;vars&#x27;, nginx_name + &#x27;_docker_envs_default&#x27;, default=nginx_docker_envs_default)</span><span class="diff-line del">-                       | combine(lookup(&#x27;vars&#x27;, nginx_name + &#x27;_docker_envs_custom&#x27;, default=nginx_docker_envs_custom)) }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Commands</span><span class="diff-line del">-nginx_docker_commands_default: []</span><span class="diff-line del">-nginx_docker_commands_custom: []</span><span class="diff-line del">-nginx_docker_commands: &quot;{{ lookup(&#x27;vars&#x27;, nginx_name + &#x27;_docker_commands_default&#x27;, default=nginx_docker_commands_default)</span><span class="diff-line del">-                           + lookup(&#x27;vars&#x27;, nginx_name + &#x27;_docker_commands_custom&#x27;, default=nginx_docker_commands_custom) }}&quot;</span><span class="diff-line add">+nginx_role_docker_envs_custom: {}</span><span class="diff-line add">+nginx_role_docker_envs: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_envs_default&#x27;, role=&#x27;nginx&#x27;)</span><span class="diff-line add">+                            | combine(lookup(&#x27;role_var&#x27;, &#x27;_docker_envs_custom&#x27;, role=&#x27;nginx&#x27;)) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Volumes</span><span class="diff-line del">-nginx_docker_volumes_default:</span><span class="diff-line del">-  - &quot;{{ nginx_paths_location }}:/config&quot;</span><span class="diff-line del">-nginx_docker_volumes_custom: []</span><span class="diff-line del">-nginx_docker_volumes: &quot;{{ lookup(&#x27;vars&#x27;, nginx_name + &#x27;_docker_volumes_default&#x27;, default=nginx_docker_volumes_default)</span><span class="diff-line del">-                          + lookup(&#x27;vars&#x27;, nginx_name + &#x27;_docker_volumes_custom&#x27;, default=nginx_docker_volumes_custom) }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Devices</span><span class="diff-line del">-nginx_docker_devices_default: []</span><span class="diff-line del">-nginx_docker_devices_custom: []</span><span class="diff-line del">-nginx_docker_devices: &quot;{{ lookup(&#x27;vars&#x27;, nginx_name + &#x27;_docker_devices_default&#x27;, default=nginx_docker_devices_default)</span><span class="diff-line del">-                          + lookup(&#x27;vars&#x27;, nginx_name + &#x27;_docker_devices_custom&#x27;, default=nginx_docker_devices_custom) }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Hosts</span><span class="diff-line del">-nginx_docker_hosts_default: {}</span><span class="diff-line del">-nginx_docker_hosts_custom: {}</span><span class="diff-line del">-nginx_docker_hosts: &quot;{{ docker_hosts_common</span><span class="diff-line del">-                        | combine(lookup(&#x27;vars&#x27;, nginx_name + &#x27;_docker_hosts_default&#x27;, default=nginx_docker_hosts_default))</span><span class="diff-line del">-                        | combine(lookup(&#x27;vars&#x27;, nginx_name + &#x27;_docker_hosts_custom&#x27;, default=nginx_docker_hosts_custom)) }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Labels</span><span class="diff-line del">-nginx_docker_labels_default: {}</span><span class="diff-line del">-nginx_docker_labels_custom: {}</span><span class="diff-line del">-nginx_docker_labels: &quot;{{ docker_labels_common</span><span class="diff-line del">-                         | combine(lookup(&#x27;vars&#x27;, nginx_name + &#x27;_docker_labels_default&#x27;, default=nginx_docker_labels_default))</span><span class="diff-line del">-                         | combine(lookup(&#x27;vars&#x27;, nginx_name + &#x27;_docker_labels_custom&#x27;, default=nginx_docker_labels_custom)) }}&quot;</span><span class="diff-line add">+nginx_role_docker_volumes_default:</span><span class="diff-line add">+  - &quot;{{ nginx_role_paths_location }}:/config&quot;</span><span class="diff-line add">+nginx_role_docker_volumes_custom: []</span><span class="diff-line add">+nginx_role_docker_volumes: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_volumes_default&#x27;, role=&#x27;nginx&#x27;)</span><span class="diff-line add">+                               + lookup(&#x27;role_var&#x27;, &#x27;_docker_volumes_custom&#x27;, role=&#x27;nginx&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Hostname</span><span class="diff-line del">-nginx_docker_hostname: &quot;{{ nginx_name }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Network Mode</span><span class="diff-line del">-nginx_docker_network_mode_default: &quot;{{ docker_networks_name_common }}&quot;</span><span class="diff-line del">-nginx_docker_network_mode: &quot;{{ lookup(&#x27;vars&#x27;, nginx_name + &#x27;_docker_network_mode_default&#x27;, default=nginx_docker_network_mode_default) }}&quot;</span><span class="diff-line add">+nginx_role_docker_hostname: &quot;{{ nginx_name }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Networks</span><span class="diff-line del">-nginx_docker_networks_alias: &quot;{{ nginx_name }}&quot;</span><span class="diff-line del">-nginx_docker_networks_default: []</span><span class="diff-line del">-nginx_docker_networks_custom: []</span><span class="diff-line del">-nginx_docker_networks: &quot;{{ docker_networks_common</span><span class="diff-line del">-                           + lookup(&#x27;vars&#x27;, nginx_name + &#x27;_docker_networks_default&#x27;, default=nginx_docker_networks_default)</span><span class="diff-line del">-                           + lookup(&#x27;vars&#x27;, nginx_name + &#x27;_docker_networks_custom&#x27;, default=nginx_docker_networks_custom) }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Capabilities</span><span class="diff-line del">-nginx_docker_capabilities_default: []</span><span class="diff-line del">-nginx_docker_capabilities_custom: []</span><span class="diff-line del">-nginx_docker_capabilities: &quot;{{ lookup(&#x27;vars&#x27;, nginx_name + &#x27;_docker_capabilities_default&#x27;, default=nginx_docker_capabilities_default)</span><span class="diff-line del">-                               + lookup(&#x27;vars&#x27;, nginx_name + &#x27;_docker_capabilities_custom&#x27;, default=nginx_docker_capabilities_custom) }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Security Opts</span><span class="diff-line del">-nginx_docker_security_opts_default: []</span><span class="diff-line del">-nginx_docker_security_opts_custom: []</span><span class="diff-line del">-nginx_docker_security_opts: &quot;{{ lookup(&#x27;vars&#x27;, nginx_name + &#x27;_docker_security_opts_default&#x27;, default=nginx_docker_security_opts_default)</span><span class="diff-line del">-                                + lookup(&#x27;vars&#x27;, nginx_name + &#x27;_docker_security_opts_custom&#x27;, default=nginx_docker_security_opts_custom) }}&quot;</span><span class="diff-line add">+nginx_role_docker_networks_alias: &quot;{{ nginx_name }}&quot;</span><span class="diff-line add">+nginx_role_docker_networks_default: []</span><span class="diff-line add">+nginx_role_docker_networks_custom: []</span><span class="diff-line add">+nginx_role_docker_networks: &quot;{{ docker_networks_common</span><span class="diff-line add">+                                + lookup(&#x27;role_var&#x27;, &#x27;_docker_networks_default&#x27;, role=&#x27;nginx&#x27;)</span><span class="diff-line add">+                                + lookup(&#x27;role_var&#x27;, &#x27;_docker_networks_custom&#x27;, role=&#x27;nginx&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Restart Policy</span><span class="diff-line del">-nginx_docker_restart_policy: unless-stopped</span><span class="diff-line add">+nginx_role_docker_restart_policy: unless-stopped</span><span class="diff-line context"> </span><span class="diff-line context"> # State</span><span class="diff-line del">-nginx_docker_state: started</span><span class="diff-line add">+nginx_role_docker_state: started</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-238">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/nginx/tasks/main2.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -11,9 +11,9 @@</span><span class="diff-line context"> - name: Add DNS record</span><span class="diff-line context">   ansible.builtin.include_tasks: &quot;{{ resources_tasks_path }}/dns/tasker.yml&quot;</span><span class="diff-line context">   vars:</span><span class="diff-line del">-    dns_record: &quot;{{ lookup(&#x27;vars&#x27;, role_name + &#x27;_dns_record&#x27;) }}&quot;</span><span class="diff-line del">-    dns_zone: &quot;{{ lookup(&#x27;vars&#x27;, role_name + &#x27;_dns_zone&#x27;) }}&quot;</span><span class="diff-line del">-    dns_proxy: &quot;{{ lookup(&#x27;vars&#x27;, role_name + &#x27;_dns_proxy&#x27;) }}&quot;</span><span class="diff-line add">+    dns_record: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_dns_record&#x27;) }}&quot;</span><span class="diff-line add">+    dns_zone: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_dns_zone&#x27;) }}&quot;</span><span class="diff-line add">+    dns_proxy: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_dns_proxy&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Remove existing Docker container</span><span class="diff-line context">   ansible.builtin.include_tasks: &quot;{{ resources_tasks_path }}/docker/remove_docker_container.yml&quot;</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-239">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/node_exporter/defaults/main.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -7,7 +7,7 @@</span><span class="diff-line context"> #                   GNU General Public License v3.0                      #</span><span class="diff-line context"> ##########################################################################</span><span class="diff-line context"> ---</span><span class="diff-line del">-node_exporter_path: &quot;/opt/node_exporter&quot;</span><span class="diff-line add">+node_exporter_path: &quot;{{ server_appdata_path }}/node_exporter&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> node_exporter_latest_releases_url: &quot;{{ svm }}https://api.github.com/repos/prometheus/node_exporter/releases/latest&quot;</span><span class="diff-line context"> </span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-240">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/notify/tasks/main.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -8,7 +8,7 @@</span><span class="diff-line context"> #########################################################################</span><span class="diff-line context"> ---</span><span class="diff-line context"> - name: Import Variables Task</span><span class="diff-line del">-  ansible.builtin.import_tasks: &quot;subtasks/variables.yml&quot;</span><span class="diff-line add">+  ansible.builtin.include_tasks: &quot;subtasks/variables.yml&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Sent Notification</span><span class="diff-line context">   ansible.builtin.include_tasks: &quot;subtasks/{{ item }}.yml&quot;</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-241">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/nvidia/defaults/main.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -15,7 +15,7 @@</span><span class="diff-line context"> nvidia_enabled: false</span><span class="diff-line context"> </span><span class="diff-line context"> # Fetches the latest supported driver version supported by the keylase patch when set to &quot;latest&quot;</span><span class="diff-line del">-# If set to &quot;ignore&quot; then driver installation will be ignored and only patching will run.</span><span class="diff-line add">+# If set to &quot;ignore&quot; then driver installation and patching will be skipped.</span><span class="diff-line context"> # Otherwise specify a valid driver like this (it being a quoted string is important):</span><span class="diff-line context"> # nvidia_driver_version: &quot;555.58.02&quot;</span><span class="diff-line context"> nvidia_driver_version: &quot;latest&quot;</span><span class="diff-line hunk">@@ -41,7 +41,7 @@</span><span class="diff-line context"> nvidia_patch_download_dest: &quot;/tmp/NVIDIA-patch.sh&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Harcoded in the patch script file</span><span class="diff-line del">-nvidia_patch_backup_file_location: &quot;/opt/nvidia/libnvidia-encode-backup&quot;</span><span class="diff-line add">+nvidia_patch_backup_file_location: &quot;{{ server_appdata_path }}/nvidia/libnvidia-encode-backup&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # Docker</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-242">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/nvidia/tasks/main.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -7,175 +7,178 @@</span><span class="diff-line context"> #                   GNU General Public License v3.0                     #</span><span class="diff-line context"> #########################################################################</span><span class="diff-line context"> ---</span><span class="diff-line del">-- name: Install mokutil</span><span class="diff-line del">-  ansible.builtin.apt:</span><span class="diff-line del">-    name: mokutil</span><span class="diff-line del">-    state: latest</span><span class="diff-line add">+- name: Nvidia Tasks</span><span class="diff-line add">+  when: (nvidia_driver_version | lower != &#x27;ignore&#x27;)</span><span class="diff-line add">+  block:</span><span class="diff-line add">+    - name: Install mokutil</span><span class="diff-line add">+      ansible.builtin.apt:</span><span class="diff-line add">+        name: mokutil</span><span class="diff-line add">+        state: latest</span><span class="diff-line context"> </span><span class="diff-line del">-- name: Check if Secure Boot is enabled</span><span class="diff-line del">-  ansible.builtin.shell: &quot;mokutil --sb-state | grep -q &#x27;SecureBoot enabled&#x27;&quot;</span><span class="diff-line del">-  register: secure_boot_enabled</span><span class="diff-line del">-  changed_when: false</span><span class="diff-line del">-  failed_when: false</span><span class="diff-line add">+    - name: Check if Secure Boot is enabled</span><span class="diff-line add">+      ansible.builtin.shell: &quot;mokutil --sb-state | grep -q &#x27;SecureBoot enabled&#x27;&quot;</span><span class="diff-line add">+      register: secure_boot_enabled</span><span class="diff-line add">+      changed_when: false</span><span class="diff-line add">+      failed_when: false</span><span class="diff-line context"> </span><span class="diff-line del">-- name: Fail if Secure Boot is enabled</span><span class="diff-line del">-  ansible.builtin.fail:</span><span class="diff-line del">-    msg: &quot;This role does not support SecureBoot enabled systems.&quot;</span><span class="diff-line del">-  when: secure_boot_enabled.rc == 0</span><span class="diff-line add">+    - name: Fail if Secure Boot is enabled</span><span class="diff-line add">+      ansible.builtin.fail:</span><span class="diff-line add">+        msg: &quot;This role does not support SecureBoot enabled systems.&quot;</span><span class="diff-line add">+      when: secure_boot_enabled.rc == 0</span><span class="diff-line context"> </span><span class="diff-line del">-- name: Install pkg-config</span><span class="diff-line del">-  ansible.builtin.apt:</span><span class="diff-line del">-    name: pkg-config</span><span class="diff-line del">-    state: latest</span><span class="diff-line add">+    - name: Install pkg-config</span><span class="diff-line add">+      ansible.builtin.apt:</span><span class="diff-line add">+        name: pkg-config</span><span class="diff-line add">+        state: latest</span><span class="diff-line context"> </span><span class="diff-line del">-- name: Fetch all Nvidia GPU IDs</span><span class="diff-line del">-  ansible.builtin.shell: lspci | grep -E &#x27;.*VGA.*NVIDIA|.*3D controller.*NVIDIA&#x27; | cut -d&#x27; &#x27; -f 1</span><span class="diff-line del">-  register: nvidia_gpu_ids</span><span class="diff-line del">-  changed_when: false</span><span class="diff-line add">+    - name: Fetch all Nvidia GPU IDs</span><span class="diff-line add">+      ansible.builtin.shell: lspci | grep -E &#x27;.*VGA.*NVIDIA|.*3D controller.*NVIDIA&#x27; | cut -d&#x27; &#x27; -f 1</span><span class="diff-line add">+      register: nvidia_gpu_ids</span><span class="diff-line add">+      changed_when: false</span><span class="diff-line context"> </span><span class="diff-line del">-- name: Check if any NVIDIA GPUs were found</span><span class="diff-line del">-  ansible.builtin.set_fact:</span><span class="diff-line del">-    nvidia_gpus_found: &quot;{{ nvidia_gpu_ids.stdout_lines | length &gt; 0 }}&quot;</span><span class="diff-line add">+    - name: Check if any NVIDIA GPUs were found</span><span class="diff-line add">+      ansible.builtin.set_fact:</span><span class="diff-line add">+        nvidia_gpus_found: &quot;{{ nvidia_gpu_ids.stdout_lines | length &gt; 0 }}&quot;</span><span class="diff-line context"> </span><span class="diff-line del">-- name: Fail if no NVIDIA GPU was detected</span><span class="diff-line del">-  ansible.builtin.fail:</span><span class="diff-line del">-    msg: &quot;No Nvidia GPUs could be detected.&quot;</span><span class="diff-line del">-  when: not nvidia_gpus_found</span><span class="diff-line add">+    - name: Fail if no NVIDIA GPU was detected</span><span class="diff-line add">+      ansible.builtin.fail:</span><span class="diff-line add">+        msg: &quot;No Nvidia GPUs could be detected.&quot;</span><span class="diff-line add">+      when: not nvidia_gpus_found</span><span class="diff-line context"> </span><span class="diff-line del">-- name: Nvidia Setup block</span><span class="diff-line del">-  when: nvidia_gpus_found</span><span class="diff-line del">-  block:</span><span class="diff-line del">-    - name: Fetch detailed info for all Nvidia GPUs</span><span class="diff-line del">-      ansible.builtin.shell: lspci -s {{ item }}</span><span class="diff-line del">-      register: nvidia_gpu_info</span><span class="diff-line del">-      changed_when: false</span><span class="diff-line del">-      with_items: &quot;{{ nvidia_gpu_ids.stdout_lines }}&quot;</span><span class="diff-line add">+    - name: Nvidia Setup block</span><span class="diff-line add">+      when: nvidia_gpus_found</span><span class="diff-line add">+      block:</span><span class="diff-line add">+        - name: Fetch detailed info for all Nvidia GPUs</span><span class="diff-line add">+          ansible.builtin.shell: lspci -s {{ item }}</span><span class="diff-line add">+          register: nvidia_gpu_info</span><span class="diff-line add">+          changed_when: false</span><span class="diff-line add">+          with_items: &quot;{{ nvidia_gpu_ids.stdout_lines }}&quot;</span><span class="diff-line context"> </span><span class="diff-line del">-    - name: Create a list of all GPU details</span><span class="diff-line del">-      ansible.builtin.set_fact:</span><span class="diff-line del">-        all_nvidia_gpus: &quot;{{ nvidia_gpu_info.results | map(attribute=&#x27;stdout&#x27;) | list }}&quot;</span><span class="diff-line add">+        - name: Create a list of all GPU details</span><span class="diff-line add">+          ansible.builtin.set_fact:</span><span class="diff-line add">+            all_nvidia_gpus: &quot;{{ nvidia_gpu_info.results | map(attribute=&#x27;stdout&#x27;) | list }}&quot;</span><span class="diff-line context"> </span><span class="diff-line del">-    - name: Check if any GeForce GPUs are present</span><span class="diff-line del">-      ansible.builtin.set_fact:</span><span class="diff-line del">-        geforce_gpu_present: &quot;{{ all_nvidia_gpus | select(&#x27;search&#x27;, &#x27;GeForce&#x27;) | list | length &gt; 0 }}&quot;</span><span class="diff-line add">+        - name: Check if any GeForce GPUs are present</span><span class="diff-line add">+          ansible.builtin.set_fact:</span><span class="diff-line add">+            geforce_gpu_present: &quot;{{ all_nvidia_gpus | select(&#x27;search&#x27;, &#x27;GeForce&#x27;) | list | length &gt; 0 }}&quot;</span><span class="diff-line context"> </span><span class="diff-line del">-    - name: Display detected NVIDIA GPUs</span><span class="diff-line del">-      ansible.builtin.debug:</span><span class="diff-line del">-        msg:</span><span class="diff-line del">-          - &quot;Detected {{ all_nvidia_gpus | length }} NVIDIA GPU(s):&quot;</span><span class="diff-line del">-          - &quot;{{ all_nvidia_gpus }}&quot;</span><span class="diff-line del">-          - &quot;GeForce GPU present: {{ geforce_gpu_present | default(false) }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-    - name: Fetch NVIDIA driver patch script</span><span class="diff-line del">-      ansible.builtin.uri:</span><span class="diff-line del">-        url: &quot;{{ nvidia_patch_download_url }}&quot;</span><span class="diff-line del">-        return_content: yes</span><span class="diff-line del">-      register: patch_script</span><span class="diff-line del">-</span><span class="diff-line del">-    - name: Extract supported driver versions</span><span class="diff-line del">-      ansible.builtin.set_fact:</span><span class="diff-line del">-        supported_versions: &gt;-</span><span class="diff-line del">-          {{ patch_script.content | regex_findall(&#x27;\[\&quot;([0-9.]+)\&quot;\]&#x27;) | map(&#x27;regex_replace&#x27;, &#x27;\&quot;&#x27;, &#x27;&#x27;) | unique | sort }}</span><span class="diff-line del">-</span><span class="diff-line del">-    - name: Latest supported version</span><span class="diff-line del">-      ansible.builtin.debug:</span><span class="diff-line del">-        msg: &quot;Latest supported version is {{ supported_versions[-1] }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-    - name: Define latest version</span><span class="diff-line del">-      ansible.builtin.set_fact:</span><span class="diff-line del">-        nvidia_driver_version: &quot;{{ supported_versions[-1] }}&quot;</span><span class="diff-line del">-      when: nvidia_driver_version == &quot;latest&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-    - name: Check for incompatible version (GeForce patching)</span><span class="diff-line del">-      ansible.builtin.fail:</span><span class="diff-line del">-        msg: &quot;Driver version: {{ nvidia_driver_version }} is not supported by the keylase patch.&quot;</span><span class="diff-line del">-      when: geforce_gpu_present and (nvidia_driver_version != &quot;latest&quot;) and nvidia_driver_version not in supported_versions</span><span class="diff-line del">-</span><span class="diff-line del">-    - name: Get nvidia-smi driver version</span><span class="diff-line del">-      ansible.builtin.shell: &quot;nvidia-smi --query-gpu=driver_version --format=csv,noheader&quot;</span><span class="diff-line del">-      register: nvidia_smi_output</span><span class="diff-line del">-      ignore_errors: yes</span><span class="diff-line del">-</span><span class="diff-line del">-    - name: Set &#x27;nvidia_installed_driver_version&#x27; variable</span><span class="diff-line del">-      ansible.builtin.set_fact:</span><span class="diff-line del">-        nvidia_installed_driver_version: &quot;{{ nvidia_smi_output.stdout_lines[0] | default(&#x27;&#x27;)</span><span class="diff-line del">-                                          if nvidia_smi_output.rc == 0</span><span class="diff-line del">-                                          else &#x27;&#x27; }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-    - name: Print driver state</span><span class="diff-line del">-      ansible.builtin.debug:</span><span class="diff-line del">-        msg:</span><span class="diff-line del">-          - &quot;Desired driver version: {{ nvidia_driver_version }}&quot;</span><span class="diff-line del">-          - &quot;Current driver version: {{ nvidia_installed_driver_version</span><span class="diff-line del">-                                     if (nvidia_installed_driver_version | length &gt; 0)</span><span class="diff-line del">-                                     else &#x27;not installed&#x27; }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-    - name: Nvidia Purge Drivers Tasks</span><span class="diff-line del">-      when: (&#x27;nvidia-purge&#x27; in ansible_run_tags) or ((nvidia_installed_driver_version != nvidia_driver_version) and (nvidia_installed_driver_version | length &gt; 0) and (&#x27;nvidia&#x27; in ansible_run_tags) and (nvidia_driver_version | lower != &#x27;ignore&#x27;))</span><span class="diff-line del">-      block:</span><span class="diff-line del">-        - name: Purge Nvidia APT packages</span><span class="diff-line del">-          ansible.builtin.shell: &quot;dpkg --force-depends -P $(dpkg -l | grep nvidia | awk &#x27;{print $2}&#x27;)&quot;</span><span class="diff-line del">-          register: dpkg_purge_output</span><span class="diff-line del">-          ignore_errors: yes</span><span class="diff-line del">-</span><span class="diff-line del">-        - name: Remove dependencies that are no longer required</span><span class="diff-line del">-          ansible.builtin.apt:</span><span class="diff-line del">-            autoremove: yes</span><span class="diff-line del">-</span><span class="diff-line del">-        - name: Success message</span><span class="diff-line add">+        - name: Display detected NVIDIA GPUs</span><span class="diff-line context">           ansible.builtin.debug:</span><span class="diff-line context">             msg:</span><span class="diff-line del">-              - &quot;Purged Nvidia drivers. System will now reboot.&quot;</span><span class="diff-line del">-              - &quot;You will need to re-run your previous tag after the system has rebooted.&quot;</span><span class="diff-line del">-          when: (dpkg_purge_output.stdout | length &gt; 0) and (dpkg_purge_output.rc == 0)</span><span class="diff-line add">+              - &quot;Detected {{ all_nvidia_gpus | length }} NVIDIA GPU(s):&quot;</span><span class="diff-line add">+              - &quot;{{ all_nvidia_gpus }}&quot;</span><span class="diff-line add">+              - &quot;GeForce GPU present: {{ geforce_gpu_present | default(false) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line del">-        - name: Prompt user before continuing</span><span class="diff-line del">-          ansible.builtin.pause:</span><span class="diff-line del">-            prompt: &quot;Read the instructions above and press enter when you have done so&quot;</span><span class="diff-line del">-          when: (dpkg_purge_output.stdout | length &gt; 0) and (dpkg_purge_output.rc == 0)</span><span class="diff-line add">+        - name: Fetch NVIDIA driver patch script</span><span class="diff-line add">+          ansible.builtin.uri:</span><span class="diff-line add">+            url: &quot;{{ nvidia_patch_download_url }}&quot;</span><span class="diff-line add">+            return_content: true</span><span class="diff-line add">+          register: patch_script</span><span class="diff-line context"> </span><span class="diff-line del">-        - name: Reboot</span><span class="diff-line del">-          ansible.builtin.shell: reboot</span><span class="diff-line del">-          when: (dpkg_purge_output.stdout | length &gt; 0) and (dpkg_purge_output.rc == 0)</span><span class="diff-line add">+        - name: Extract supported driver versions</span><span class="diff-line add">+          ansible.builtin.set_fact:</span><span class="diff-line add">+            supported_versions: &gt;-</span><span class="diff-line add">+              {{ patch_script.content | regex_findall(&#x27;\[\&quot;([0-9.]+)\&quot;\]&#x27;) | map(&#x27;regex_replace&#x27;, &#x27;\&quot;&#x27;, &#x27;&#x27;) | unique | sort }}</span><span class="diff-line context"> </span><span class="diff-line del">-    - name: Check if &#x27;blacklist-nouveau.conf&#x27; exists</span><span class="diff-line del">-      ansible.builtin.stat:</span><span class="diff-line del">-        path: &quot;{{ nvidia_kernel_blacklist_nouveau_conf_location }}&quot;</span><span class="diff-line del">-      register: blacklist_nouveau_conf</span><span class="diff-line add">+        - name: Latest supported version</span><span class="diff-line add">+          ansible.builtin.debug:</span><span class="diff-line add">+            msg: &quot;Latest supported version is {{ supported_versions[-1] }}&quot;</span><span class="diff-line context"> </span><span class="diff-line del">-    - name: &quot;Nvidia Kernel Task&quot;</span><span class="diff-line del">-      ansible.builtin.include_tasks: &quot;subtasks/kernel.yml&quot;</span><span class="diff-line del">-      when:</span><span class="diff-line del">-        - (not blacklist_nouveau_conf.stat.exists)</span><span class="diff-line del">-        - nvidia_kernel_blacklist_nouveau</span><span class="diff-line add">+        - name: Define latest version</span><span class="diff-line add">+          ansible.builtin.set_fact:</span><span class="diff-line add">+            nvidia_driver_version: &quot;{{ supported_versions[-1] }}&quot;</span><span class="diff-line add">+          when: nvidia_driver_version == &quot;latest&quot;</span><span class="diff-line context"> </span><span class="diff-line del">-    - name: Nvidia Driver Tasks</span><span class="diff-line del">-      when: ((nvidia_installed_driver_version != nvidia_driver_version) and (nvidia_driver_version | lower != &#x27;ignore&#x27;) and (&#x27;nvidia&#x27; in ansible_run_tags)) or (nvidia_installed_driver_version | length == 0)</span><span class="diff-line del">-      block:</span><span class="diff-line del">-        - name: &quot;Nvidia Driver Task&quot;</span><span class="diff-line del">-          ansible.builtin.include_tasks: &quot;subtasks/driver.yml&quot;</span><span class="diff-line add">+        - name: Check for incompatible version (GeForce patching)</span><span class="diff-line add">+          ansible.builtin.fail:</span><span class="diff-line add">+            msg: &quot;Driver version: {{ nvidia_driver_version }} is not supported by the keylase patch.&quot;</span><span class="diff-line add">+          when: geforce_gpu_present and (nvidia_driver_version != &quot;latest&quot;) and nvidia_driver_version not in supported_versions</span><span class="diff-line context"> </span><span class="diff-line del">-        - name: &quot;Cleanup Patch backup&quot;</span><span class="diff-line del">-          ansible.builtin.file:</span><span class="diff-line del">-            path: &quot;{{ nvidia_patch_backup_file_location }}&quot;</span><span class="diff-line del">-            state: absent</span><span class="diff-line add">+        - name: Get nvidia-smi driver version</span><span class="diff-line add">+          ansible.builtin.shell: &quot;nvidia-smi --query-gpu=driver_version --format=csv,noheader&quot;</span><span class="diff-line add">+          register: nvidia_smi_output</span><span class="diff-line add">+          ignore_errors: true</span><span class="diff-line context"> </span><span class="diff-line del">-    - name: Nvidia Driver Patch Tasks</span><span class="diff-line del">-      when: geforce_gpu_present</span><span class="diff-line del">-      block:</span><span class="diff-line del">-        - name: Check to see if patch backup files exist</span><span class="diff-line add">+        - name: Set &#x27;nvidia_installed_driver_version&#x27; variable</span><span class="diff-line add">+          ansible.builtin.set_fact:</span><span class="diff-line add">+            nvidia_installed_driver_version: &quot;{{ nvidia_smi_output.stdout_lines[0] | default(&#x27;&#x27;)</span><span class="diff-line add">+                                              if nvidia_smi_output.rc == 0</span><span class="diff-line add">+                                              else &#x27;&#x27; }}&quot;</span><span class="diff-line add">+</span><span class="diff-line add">+        - name: Print driver state</span><span class="diff-line add">+          ansible.builtin.debug:</span><span class="diff-line add">+            msg:</span><span class="diff-line add">+              - &quot;Desired driver version: {{ nvidia_driver_version }}&quot;</span><span class="diff-line add">+              - &quot;Current driver version: {{ nvidia_installed_driver_version</span><span class="diff-line add">+                                        if (nvidia_installed_driver_version | length &gt; 0)</span><span class="diff-line add">+                                        else &#x27;not installed&#x27; }}&quot;</span><span class="diff-line add">+</span><span class="diff-line add">+        - name: Nvidia Purge Drivers Tasks</span><span class="diff-line add">+          when: (&#x27;nvidia-purge&#x27; in ansible_run_tags) or ((nvidia_installed_driver_version != nvidia_driver_version) and (nvidia_installed_driver_version | length &gt; 0) and (&#x27;nvidia&#x27; in ansible_run_tags))</span><span class="diff-line add">+          block:</span><span class="diff-line add">+            - name: Purge Nvidia APT packages</span><span class="diff-line add">+              ansible.builtin.shell: &quot;dpkg --force-depends -P $(dpkg -l | grep nvidia | awk &#x27;{print $2}&#x27;)&quot;</span><span class="diff-line add">+              register: dpkg_purge_output</span><span class="diff-line add">+              ignore_errors: true</span><span class="diff-line add">+</span><span class="diff-line add">+            - name: Remove dependencies that are no longer required</span><span class="diff-line add">+              ansible.builtin.apt:</span><span class="diff-line add">+                autoremove: true</span><span class="diff-line add">+</span><span class="diff-line add">+            - name: Success message</span><span class="diff-line add">+              ansible.builtin.debug:</span><span class="diff-line add">+                msg:</span><span class="diff-line add">+                  - &quot;Purged Nvidia drivers. System will now reboot.&quot;</span><span class="diff-line add">+                  - &quot;You will need to re-run your previous tag after the system has rebooted.&quot;</span><span class="diff-line add">+              when: (dpkg_purge_output.stdout | length &gt; 0) and (dpkg_purge_output.rc == 0)</span><span class="diff-line add">+</span><span class="diff-line add">+            - name: Prompt user before continuing</span><span class="diff-line add">+              ansible.builtin.pause:</span><span class="diff-line add">+                prompt: &quot;Read the instructions above and press enter when you have done so&quot;</span><span class="diff-line add">+              when: (dpkg_purge_output.stdout | length &gt; 0) and (dpkg_purge_output.rc == 0)</span><span class="diff-line add">+</span><span class="diff-line add">+            - name: Reboot</span><span class="diff-line add">+              ansible.builtin.shell: reboot</span><span class="diff-line add">+              when: (dpkg_purge_output.stdout | length &gt; 0) and (dpkg_purge_output.rc == 0)</span><span class="diff-line add">+</span><span class="diff-line add">+        - name: Check if &#x27;blacklist-nouveau.conf&#x27; exists</span><span class="diff-line context">           ansible.builtin.stat:</span><span class="diff-line del">-            path: &quot;{{ nvidia_patch_backup_file_location }}&quot;</span><span class="diff-line del">-          register: nvidia_patch_backup_folder</span><span class="diff-line add">+            path: &quot;{{ nvidia_kernel_blacklist_nouveau_conf_location }}&quot;</span><span class="diff-line add">+          register: blacklist_nouveau_conf</span><span class="diff-line context"> </span><span class="diff-line del">-        - name: &quot;Nvidia Driver Patch Task&quot;</span><span class="diff-line del">-          ansible.builtin.include_tasks: &quot;subtasks/patch.yml&quot;</span><span class="diff-line del">-          when: (not nvidia_patch_backup_folder.stat.exists)</span><span class="diff-line add">+        - name: &quot;Nvidia Kernel Task&quot;</span><span class="diff-line add">+          ansible.builtin.include_tasks: &quot;subtasks/kernel.yml&quot;</span><span class="diff-line add">+          when:</span><span class="diff-line add">+            - (not blacklist_nouveau_conf.stat.exists)</span><span class="diff-line add">+            - nvidia_kernel_blacklist_nouveau</span><span class="diff-line context"> </span><span class="diff-line del">-    - name: &quot;Nvidia Nvtop Task&quot;</span><span class="diff-line del">-      ansible.builtin.include_tasks: &quot;subtasks/nvtop.yml&quot;</span><span class="diff-line add">+        - name: Nvidia Driver Tasks</span><span class="diff-line add">+          when: ((nvidia_installed_driver_version != nvidia_driver_version) and (&#x27;nvidia&#x27; in ansible_run_tags)) or (nvidia_installed_driver_version | length == 0)</span><span class="diff-line add">+          block:</span><span class="diff-line add">+            - name: &quot;Nvidia Driver Task&quot;</span><span class="diff-line add">+              ansible.builtin.include_tasks: &quot;subtasks/driver.yml&quot;</span><span class="diff-line context"> </span><span class="diff-line del">-    - name: &quot;Install Docker&quot;</span><span class="diff-line del">-      ansible.builtin.include_role:</span><span class="diff-line del">-        name: &quot;docker&quot;</span><span class="diff-line del">-      when: (&#x27;nvidia&#x27; in ansible_run_tags)</span><span class="diff-line add">+            - name: &quot;Cleanup Patch backup&quot;</span><span class="diff-line add">+              ansible.builtin.file:</span><span class="diff-line add">+                path: &quot;{{ nvidia_patch_backup_file_location }}&quot;</span><span class="diff-line add">+                state: absent</span><span class="diff-line add">+</span><span class="diff-line add">+        - name: Nvidia Driver Patch Tasks</span><span class="diff-line add">+          when: geforce_gpu_present</span><span class="diff-line add">+          block:</span><span class="diff-line add">+            - name: Check to see if patch backup files exist</span><span class="diff-line add">+              ansible.builtin.stat:</span><span class="diff-line add">+                path: &quot;{{ nvidia_patch_backup_file_location }}&quot;</span><span class="diff-line add">+              register: nvidia_patch_backup_folder</span><span class="diff-line add">+</span><span class="diff-line add">+            - name: &quot;Nvidia Driver Patch Task&quot;</span><span class="diff-line add">+              ansible.builtin.include_tasks: &quot;subtasks/patch.yml&quot;</span><span class="diff-line add">+              when: (not nvidia_patch_backup_folder.stat.exists)</span><span class="diff-line add">+</span><span class="diff-line add">+        - name: &quot;Nvidia Nvtop Task&quot;</span><span class="diff-line add">+          ansible.builtin.include_tasks: &quot;subtasks/nvtop.yml&quot;</span><span class="diff-line add">+</span><span class="diff-line add">+        - name: &quot;Install Docker&quot;</span><span class="diff-line add">+          ansible.builtin.include_role:</span><span class="diff-line add">+            name: &quot;docker&quot;</span><span class="diff-line add">+          when: (&#x27;nvidia&#x27; in ansible_run_tags)</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-243">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/nvidia/tasks/subtasks/driver.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -18,7 +18,7 @@</span><span class="diff-line context">     state: latest</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Driver | Install gcc12 if kernel is 6.5&gt;= on Jammy</span><span class="diff-line del">-  when: (ansible_kernel is version(&#x27;6.5&#x27;, &#x27;&gt;=&#x27;)) and (ansible_distribution_version is version(&#x27;22.04&#x27;, &#x27;==&#x27;))</span><span class="diff-line add">+  when: (ansible_facts[&#x27;kernel&#x27;] is version(&#x27;6.5&#x27;, &#x27;&gt;=&#x27;)) and (ansible_facts[&#x27;distribution_version&#x27;] is version(&#x27;22.04&#x27;, &#x27;==&#x27;))</span><span class="diff-line context">   block:</span><span class="diff-line context">     - name: Driver | Install GCC and G++</span><span class="diff-line context">       ansible.builtin.apt:</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-244">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/nvidia/tasks/subtasks/nvtop.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -21,7 +21,7 @@</span><span class="diff-line context">   retries: &quot;{{ ansible_retry_count if (not continuous_integration) else ansible_retry_count_ci }}&quot;</span><span class="diff-line context">   delay: 10</span><span class="diff-line context">   until: result is succeeded</span><span class="diff-line del">-  when: ansible_distribution_release in [&#x27;jammy&#x27;, &#x27;focal&#x27;]</span><span class="diff-line add">+  when: ansible_facts[&#x27;distribution_release&#x27;] in [&#x27;jammy&#x27;, &#x27;focal&#x27;]</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Nvidia | Remove old repository list</span><span class="diff-line context">   ansible.builtin.file:</span><span class="diff-line hunk">@@ -30,11 +30,11 @@</span><span class="diff-line context"> </span><span class="diff-line context"> - name: nvtop | Add flexiondotorg/nvtop repository</span><span class="diff-line context">   ansible.builtin.apt_repository:</span><span class="diff-line del">-    repo: &quot;deb [arch=amd64 signed-by=/etc/apt/keyrings/flexiondotorg.asc] https://ppa.launchpadcontent.net/flexiondotorg/nvtop/{{ ansible_distribution | lower }} {{ ansible_distribution_release }} main&quot;</span><span class="diff-line add">+    repo: &quot;deb [arch=amd64 signed-by=/etc/apt/keyrings/flexiondotorg.asc] https://ppa.launchpadcontent.net/flexiondotorg/nvtop/{{ ansible_facts[&#x27;distribution&#x27;] | lower }} {{ ansible_facts[&#x27;distribution_release&#x27;] }} main&quot;</span><span class="diff-line context">     filename: &quot;flexiondotorg&quot;</span><span class="diff-line context">     state: present</span><span class="diff-line context">     update_cache: true</span><span class="diff-line del">-  when: ansible_distribution_release in [&#x27;jammy&#x27;, &#x27;focal&#x27;]</span><span class="diff-line add">+  when: ansible_facts[&#x27;distribution_release&#x27;] in [&#x27;jammy&#x27;, &#x27;focal&#x27;]</span><span class="diff-line context"> </span><span class="diff-line context"> - name: nvtop | Install nvtop</span><span class="diff-line context">   ansible.builtin.apt:</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-245">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/nzbget/defaults/main.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -17,51 +17,55 @@</span><span class="diff-line context"> # Paths</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-nzbget_paths_folder: &quot;{{ nzbget_name }}&quot;</span><span class="diff-line del">-nzbget_paths_location: &quot;{{ server_appdata_path }}/{{ nzbget_paths_folder }}&quot;</span><span class="diff-line del">-nzbget_paths_downloads_location: &quot;{{ downloads_usenet_path }}/{{ nzbget_paths_folder }}&quot;</span><span class="diff-line del">-nzbget_paths_folders_list:</span><span class="diff-line del">-  - &quot;{{ nzbget_paths_location }}&quot;</span><span class="diff-line del">-  - &quot;{{ nzbget_paths_downloads_location }}&quot;</span><span class="diff-line del">-  - &quot;{{ nzbget_paths_downloads_location }}/completed&quot;</span><span class="diff-line del">-  - &quot;{{ nzbget_paths_downloads_location }}/completed/radarr&quot;</span><span class="diff-line del">-  - &quot;{{ nzbget_paths_downloads_location }}/completed/sonarr&quot;</span><span class="diff-line del">-  - &quot;{{ nzbget_paths_downloads_location }}/completed/lidarr&quot;</span><span class="diff-line del">-nzbget_paths_config_location: &quot;{{ nzbget_paths_location }}/nzbget.conf&quot;</span><span class="diff-line add">+nzbget_role_paths_folder: &quot;{{ nzbget_name }}&quot;</span><span class="diff-line add">+nzbget_role_paths_location: &quot;{{ server_appdata_path }}/{{ nzbget_role_paths_folder }}&quot;</span><span class="diff-line add">+nzbget_role_paths_downloads_location: &quot;{{ downloads_usenet_path }}/{{ nzbget_role_paths_folder }}&quot;</span><span class="diff-line add">+nzbget_role_paths_folders_list:</span><span class="diff-line add">+  - &quot;{{ nzbget_role_paths_location }}&quot;</span><span class="diff-line add">+  - &quot;{{ nzbget_role_paths_downloads_location }}&quot;</span><span class="diff-line add">+  - &quot;{{ nzbget_role_paths_downloads_location }}/completed&quot;</span><span class="diff-line add">+  - &quot;{{ nzbget_role_paths_downloads_location }}/completed/radarr&quot;</span><span class="diff-line add">+  - &quot;{{ nzbget_role_paths_downloads_location }}/completed/sonarr&quot;</span><span class="diff-line add">+  - &quot;{{ nzbget_role_paths_downloads_location }}/completed/lidarr&quot;</span><span class="diff-line add">+nzbget_role_paths_config_location: &quot;{{ nzbget_role_paths_location }}/nzbget.conf&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # Web</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-nzbget_web_subdomain: &quot;{{ nzbget_name }}&quot;</span><span class="diff-line del">-nzbget_web_domain: &quot;{{ user.domain }}&quot;</span><span class="diff-line del">-nzbget_web_port: &quot;6789&quot;</span><span class="diff-line del">-nzbget_web_login: &quot;{{ user.name }}:{{ user.pass }}&quot;</span><span class="diff-line del">-nzbget_web_url_with_login: &quot;{{ &#x27;https://&#x27; + nzbget_web_login + &#x27;@&#x27; + nzbget_web_subdomain + &#x27;.&#x27; + nzbget_web_domain }}&quot;</span><span class="diff-line del">-nzbget_web_local_url_web_login: &quot;{{ &#x27;http://&#x27; + nzbget_web_login + &#x27;@&#x27; + nzbget_name + &#x27;:&#x27; + nzbget_web_port }}&quot;</span><span class="diff-line add">+nzbget_role_web_subdomain: &quot;{{ nzbget_name }}&quot;</span><span class="diff-line add">+nzbget_role_web_domain: &quot;{{ user.domain }}&quot;</span><span class="diff-line add">+nzbget_role_web_port: &quot;6789&quot;</span><span class="diff-line add">+nzbget_role_web_url: &quot;{{ &#x27;https://&#x27; + (lookup(&#x27;role_var&#x27;, &#x27;_web_subdomain&#x27;, role=&#x27;nzbget&#x27;) + &#x27;.&#x27; + lookup(&#x27;role_var&#x27;, &#x27;_web_domain&#x27;, role=&#x27;nzbget&#x27;)</span><span class="diff-line add">+                      if (lookup(&#x27;role_var&#x27;, &#x27;_web_subdomain&#x27;, role=&#x27;nzbget&#x27;) | length &gt; 0)</span><span class="diff-line add">+                      else lookup(&#x27;role_var&#x27;, &#x27;_web_domain&#x27;, role=&#x27;nzbget&#x27;)) }}&quot;</span><span class="diff-line add">+nzbget_role_web_login: &quot;{{ user.name }}:{{ user.pass }}&quot;</span><span class="diff-line add">+nzbget_role_web_url_with_login: &quot;{{ &#x27;https://&#x27; + lookup(&#x27;role_var&#x27;, &#x27;_web_login&#x27;, role=&#x27;nzbget&#x27;) + &#x27;@&#x27; + lookup(&#x27;role_var&#x27;, &#x27;_web_subdomain&#x27;, role=&#x27;nzbget&#x27;) + &#x27;.&#x27; + lookup(&#x27;role_var&#x27;, &#x27;_web_domain&#x27;, role=&#x27;nzbget&#x27;) }}&quot;</span><span class="diff-line add">+nzbget_role_web_local_url: &quot;{{ &#x27;http://&#x27; + nzbget_name + &#x27;:&#x27; + lookup(&#x27;role_var&#x27;, &#x27;_web_port&#x27;, role=&#x27;nzbget&#x27;) }}&quot;</span><span class="diff-line add">+nzbget_role_web_local_url_web_login: &quot;{{ &#x27;http://&#x27; + lookup(&#x27;role_var&#x27;, &#x27;_web_login&#x27;, role=&#x27;nzbget&#x27;) + &#x27;@&#x27; + nzbget_name + &#x27;:&#x27; + lookup(&#x27;role_var&#x27;, &#x27;_web_port&#x27;, role=&#x27;nzbget&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # DNS</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-nzbget_dns_record: &quot;{{ nzbget_web_subdomain }}&quot;</span><span class="diff-line del">-nzbget_dns_zone: &quot;{{ nzbget_web_domain }}&quot;</span><span class="diff-line del">-nzbget_dns_proxy: &quot;{{ dns.proxied }}&quot;</span><span class="diff-line add">+nzbget_role_dns_record: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_web_subdomain&#x27;, role=&#x27;nzbget&#x27;) }}&quot;</span><span class="diff-line add">+nzbget_role_dns_zone: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_web_domain&#x27;, role=&#x27;nzbget&#x27;) }}&quot;</span><span class="diff-line add">+nzbget_role_dns_proxy: &quot;{{ dns_proxied }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # Traefik</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-nzbget_traefik_sso_middleware: &quot;{{ traefik_default_sso_middleware }}&quot;</span><span class="diff-line del">-nzbget_traefik_middleware_default: &quot;{{ traefik_default_middleware</span><span class="diff-line del">-                                        + (&#x27;,themepark-&#x27; + lookup(&#x27;vars&#x27;, nzbget_name + &#x27;_name&#x27;, default=nzbget_name)</span><span class="diff-line del">-                                          if (nzbget_themepark_enabled and global_themepark_plugin_enabled)</span><span class="diff-line del">-                                          else &#x27;&#x27;) }}&quot;</span><span class="diff-line del">-nzbget_traefik_middleware_custom: &quot;&quot;</span><span class="diff-line del">-nzbget_traefik_certresolver: &quot;{{ traefik_default_certresolver }}&quot;</span><span class="diff-line del">-nzbget_traefik_enabled: true</span><span class="diff-line del">-nzbget_traefik_api_enabled: true</span><span class="diff-line del">-nzbget_traefik_api_endpoint: &quot;PathRegexp(`^/[A-Za-z0-9]+:[A-Za-z0-9]+/(xml|json|jsonp)rpc`) || PathRegexp(`^/(xml|json|jsonp)rpc`)&quot;</span><span class="diff-line add">+nzbget_role_traefik_sso_middleware: &quot;{{ traefik_default_sso_middleware }}&quot;</span><span class="diff-line add">+nzbget_role_traefik_middleware_default: &quot;{{ traefik_default_middleware</span><span class="diff-line add">+                                            + (&#x27;,themepark-&#x27; + nzbget_name</span><span class="diff-line add">+                                              if (lookup(&#x27;role_var&#x27;, &#x27;_themepark_enabled&#x27;, role=&#x27;nzbget&#x27;) and global_themepark_plugin_enabled)</span><span class="diff-line add">+                                              else &#x27;&#x27;) }}&quot;</span><span class="diff-line add">+nzbget_role_traefik_middleware_custom: &quot;&quot;</span><span class="diff-line add">+nzbget_role_traefik_certresolver: &quot;{{ traefik_default_certresolver }}&quot;</span><span class="diff-line add">+nzbget_role_traefik_enabled: true</span><span class="diff-line add">+nzbget_role_traefik_api_enabled: true</span><span class="diff-line add">+nzbget_role_traefik_api_endpoint: &quot;PathRegexp(`^/[A-Za-z0-9]+:[A-Za-z0-9]+/(xml|json|jsonp)rpc`) || PathRegexp(`^/(xml|json|jsonp)rpc`)&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # Config</span><span class="diff-line hunk">@@ -69,7 +73,7 @@</span><span class="diff-line context"> </span><span class="diff-line context"> # New Installs</span><span class="diff-line context"> </span><span class="diff-line del">-nzbget_config_new_installs_settings_default:</span><span class="diff-line add">+nzbget_role_config_new_installs_settings_default:</span><span class="diff-line context">   # Authentication</span><span class="diff-line context">   - { regexp: &#x27;^ControlUsername\s?=.*&#x27;, line: &quot;ControlUsername={{ user.name }}&quot; }</span><span class="diff-line context">   - { regexp: &#x27;^ControlPassword\s?=.*&#x27;, line: &quot;ControlPassword={{ user.pass }}&quot; }</span><span class="diff-line hunk">@@ -119,13 +123,13 @@</span><span class="diff-line context">                                                               .duplicate1.rar, .srs, .info, .txt,</span><span class="diff-line context">                                                               .com, .md5, .png, .1, .url, .jpg,</span><span class="diff-line context">                                                               .xxx, .rev, .iso, .img, .ifo, .vob&#x27; }</span><span class="diff-line del">-nzbget_config_new_installs_settings_custom: []</span><span class="diff-line del">-nzbget_config_new_installs_settings_list: &quot;{{ nzbget_config_new_installs_settings_default</span><span class="diff-line del">-                                              + nzbget_config_new_installs_settings_custom }}&quot;</span><span class="diff-line add">+nzbget_role_config_new_installs_settings_custom: []</span><span class="diff-line add">+nzbget_role_config_new_installs_settings_list: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_config_new_installs_settings_default&#x27;, role=&#x27;nzbget&#x27;)</span><span class="diff-line add">+                                                   + lookup(&#x27;role_var&#x27;, &#x27;_config_new_installs_settings_custom&#x27;, role=&#x27;nzbget&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Existing Installs</span><span class="diff-line context"> </span><span class="diff-line del">-nzbget_config_existing_installs_settings_default:</span><span class="diff-line add">+nzbget_role_config_existing_installs_settings_default:</span><span class="diff-line context">   # Logging</span><span class="diff-line context">   - { regexp: &#x27;^WriteLog\s?=.*&#x27;, line: &#x27;WriteLog=rotate&#x27; }</span><span class="diff-line context">   - { regexp: &#x27;^RotateLog\s?=.*&#x27;, line: &#x27;RotateLog=3&#x27; }</span><span class="diff-line hunk">@@ -134,9 +138,9 @@</span><span class="diff-line context">   # Unpacking</span><span class="diff-line context">   - { regexp: &#x27;^UnrarCmd\s?=.*&#x27;, line: &#x27;UnrarCmd=ionice -c3 /usr/bin/unrar&#x27; }</span><span class="diff-line context">   - { regexp: &#x27;^SevenZipCmd\s?=.*&#x27;, line: &#x27;SevenZipCmd=ionice -c3 /usr/bin/7z&#x27; }</span><span class="diff-line del">-nzbget_config_existing_installs_settings_custom: []</span><span class="diff-line del">-nzbget_config_existing_installs_settings_list: &quot;{{ nzbget_config_existing_installs_settings_default</span><span class="diff-line del">-                                                   + nzbget_config_existing_installs_settings_custom }}&quot;</span><span class="diff-line add">+nzbget_role_config_existing_installs_settings_custom: []</span><span class="diff-line add">+nzbget_role_config_existing_installs_settings_list: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_config_existing_installs_settings_default&#x27;, role=&#x27;nzbget&#x27;)</span><span class="diff-line add">+                                                        + lookup(&#x27;role_var&#x27;, &#x27;_config_existing_installs_settings_custom&#x27;, role=&#x27;nzbget&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # Scripts</span><span class="diff-line hunk">@@ -144,136 +148,99 @@</span><span class="diff-line context"> </span><span class="diff-line context"> # Paths</span><span class="diff-line context"> # Default nzbget_scripts_paths_location = /opt/scripts/nzbget</span><span class="diff-line del">-nzbget_scripts_paths_location: &quot;{{ server_appdata_path }}/scripts/{{ nzbget_paths_folder }}&quot;</span><span class="diff-line del">-nzbget_scripts_paths_folders_list:</span><span class="diff-line del">-  - &quot;{{ nzbget_scripts_paths_location }}&quot;</span><span class="diff-line del">-  - &quot;{{ nzbget_scripts_paths_location }}/nzbgetpp&quot;</span><span class="diff-line del">-nzbget_scripts_paths_rarfile_py_location: &quot;{{ nzbget_scripts_paths_location }}/nzbgetpp/rarfile/rarfile.py&quot;</span><span class="diff-line add">+nzbget_role_scripts_paths_location: &quot;{{ server_appdata_path }}/scripts/{{ nzbget_role_paths_folder }}&quot;</span><span class="diff-line add">+nzbget_role_scripts_paths_folders_list:</span><span class="diff-line add">+  - &quot;{{ nzbget_role_scripts_paths_location }}&quot;</span><span class="diff-line add">+  - &quot;{{ nzbget_role_scripts_paths_location }}/nzbgetpp&quot;</span><span class="diff-line add">+nzbget_role_scripts_paths_rarfile_py_location: &quot;{{ nzbget_role_scripts_paths_location }}/nzbgetpp/rarfile/rarfile.py&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Repos Downloaded</span><span class="diff-line del">-nzbget_scripts_repos_default:</span><span class="diff-line add">+nzbget_role_scripts_repos_default:</span><span class="diff-line context">   - &#x27;https://github.com/Prinz23/nzbgetpp.git&#x27;</span><span class="diff-line del">-nzbget_scripts_repos_custom: []</span><span class="diff-line del">-nzbget_scripts_repos_list: &quot;{{ nzbget_scripts_repos_default + nzbget_scripts_repos_custom }}&quot;</span><span class="diff-line add">+nzbget_role_scripts_repos_custom: []</span><span class="diff-line add">+nzbget_role_scripts_repos_list: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_scripts_repos_default&#x27;, role=&#x27;nzbget&#x27;) + lookup(&#x27;role_var&#x27;, &#x27;_scripts_repos_custom&#x27;, role=&#x27;nzbget&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # URLs Downloaded</span><span class="diff-line del">-nzbget_scripts_direct_downloads_default:</span><span class="diff-line add">+nzbget_role_scripts_direct_downloads_default:</span><span class="diff-line context">   - &quot;https://raw.githubusercontent.com/clinton-hall/GetScripts/master/flatten.py&quot;</span><span class="diff-line context">   - &quot;https://raw.githubusercontent.com/clinton-hall/GetScripts/master/DeleteSamples.py&quot;</span><span class="diff-line context">   - &quot;https://raw.githubusercontent.com/Prinz23/nzbget-pp-reverse/master/reverse_name.py&quot;</span><span class="diff-line context">   - &quot;https://raw.githubusercontent.com/l3uddz/nzbgetScripts/master/HashRenamer.py&quot;</span><span class="diff-line del">-nzbget_scripts_direct_downloads_custom: []</span><span class="diff-line del">-nzbget_scripts_direct_downloads_list: &quot;{{ nzbget_scripts_direct_downloads_default</span><span class="diff-line del">-                                          + nzbget_scripts_direct_downloads_custom }}&quot;</span><span class="diff-line add">+nzbget_role_scripts_direct_downloads_custom: []</span><span class="diff-line add">+nzbget_role_scripts_direct_downloads_list: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_scripts_direct_downloads_default&#x27;, role=&#x27;nzbget&#x27;)</span><span class="diff-line add">+                                               + lookup(&#x27;role_var&#x27;, &#x27;_scripts_direct_downloads_custom&#x27;, role=&#x27;nzbget&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Locally Copied</span><span class="diff-line del">-nzbget_scripts_local_copy_default: []</span><span class="diff-line del">-nzbget_scripts_local_copy_custom: []</span><span class="diff-line del">-nzbget_scripts_local_copy_list: &quot;{{ nzbget_scripts_local_copy_default</span><span class="diff-line del">-                                    + nzbget_scripts_local_copy_custom }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-################################</span><span class="diff-line del">-# THEME</span><span class="diff-line add">+nzbget_role_scripts_local_copy_default: []</span><span class="diff-line add">+nzbget_role_scripts_local_copy_custom: []</span><span class="diff-line add">+nzbget_role_scripts_local_copy_list: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_scripts_local_copy_default&#x27;, role=&#x27;nzbget&#x27;)</span><span class="diff-line add">+                                         + lookup(&#x27;role_var&#x27;, &#x27;_scripts_local_copy_custom&#x27;, role=&#x27;nzbget&#x27;) }}&quot;</span><span class="diff-line add">+</span><span class="diff-line add">+################################</span><span class="diff-line add">+# Theme</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line context"> # Options can be found at https://github.com/themepark-dev/theme.park</span><span class="diff-line del">-nzbget_themepark_enabled: false</span><span class="diff-line del">-nzbget_themepark_app: &quot;nzbget&quot;</span><span class="diff-line del">-nzbget_themepark_theme: &quot;{{ global_themepark_theme }}&quot;</span><span class="diff-line del">-nzbget_themepark_domain: &quot;{{ global_themepark_domain }}&quot;</span><span class="diff-line del">-nzbget_themepark_addons: []</span><span class="diff-line add">+nzbget_role_themepark_enabled: false</span><span class="diff-line add">+nzbget_role_themepark_app: &quot;nzbget&quot;</span><span class="diff-line add">+nzbget_role_themepark_theme: &quot;{{ global_themepark_theme }}&quot;</span><span class="diff-line add">+nzbget_role_themepark_domain: &quot;{{ global_themepark_domain }}&quot;</span><span class="diff-line add">+nzbget_role_themepark_addons: []</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # Docker</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line context"> # Container</span><span class="diff-line del">-nzbget_docker_container: &quot;{{ nzbget_name }}&quot;</span><span class="diff-line add">+nzbget_role_docker_container: &quot;{{ nzbget_name }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Image</span><span class="diff-line del">-nzbget_docker_image_pull: true</span><span class="diff-line del">-nzbget_docker_image_tag: &quot;release&quot;</span><span class="diff-line del">-nzbget_docker_image: &quot;ghcr.io/hotio/nzbget:{{ nzbget_docker_image_tag }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Ports</span><span class="diff-line del">-nzbget_docker_ports_defaults: []</span><span class="diff-line del">-nzbget_docker_ports_custom: []</span><span class="diff-line del">-nzbget_docker_ports: &quot;{{ nzbget_docker_ports_defaults</span><span class="diff-line del">-                         + nzbget_docker_ports_custom }}&quot;</span><span class="diff-line add">+nzbget_role_docker_image_pull: true</span><span class="diff-line add">+nzbget_role_docker_image_repo: &quot;ghcr.io/hotio/nzbget&quot;</span><span class="diff-line add">+nzbget_role_docker_image_tag: &quot;release&quot;</span><span class="diff-line add">+nzbget_role_docker_image: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_image_repo&#x27;, role=&#x27;nzbget&#x27;) }}:{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_image_tag&#x27;, role=&#x27;nzbget&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Envs</span><span class="diff-line del">-nzbget_docker_envs_default:</span><span class="diff-line add">+nzbget_role_docker_envs_default:</span><span class="diff-line context">   PUID: &quot;{{ uid }}&quot;</span><span class="diff-line context">   PGID: &quot;{{ gid }}&quot;</span><span class="diff-line context">   UMASK: &quot;002&quot;</span><span class="diff-line context">   TZ: &quot;{{ tz }}&quot;</span><span class="diff-line context">   LC_ALL: &quot;C&quot;</span><span class="diff-line del">-nzbget_docker_envs_custom: {}</span><span class="diff-line del">-nzbget_docker_envs: &quot;{{ nzbget_docker_envs_default</span><span class="diff-line del">-                        | combine(nzbget_docker_envs_custom) }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Commands</span><span class="diff-line del">-nzbget_docker_commands_default: []</span><span class="diff-line del">-nzbget_docker_commands_custom: []</span><span class="diff-line del">-nzbget_docker_commands: &quot;{{ nzbget_docker_commands_default</span><span class="diff-line del">-                            + nzbget_docker_commands_custom }}&quot;</span><span class="diff-line add">+nzbget_role_docker_envs_custom: {}</span><span class="diff-line add">+nzbget_role_docker_envs: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_envs_default&#x27;, role=&#x27;nzbget&#x27;)</span><span class="diff-line add">+                             | combine(lookup(&#x27;role_var&#x27;, &#x27;_docker_envs_custom&#x27;, role=&#x27;nzbget&#x27;)) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Volumes</span><span class="diff-line del">-nzbget_docker_volumes_default:</span><span class="diff-line del">-  - &quot;{{ nzbget_paths_location }}:/config&quot;</span><span class="diff-line add">+nzbget_role_docker_volumes_default:</span><span class="diff-line add">+  - &quot;{{ nzbget_role_paths_location }}:/config&quot;</span><span class="diff-line context">   - &quot;{{ server_appdata_path }}/scripts:/scripts&quot;</span><span class="diff-line del">-nzbget_docker_volumes_custom: []</span><span class="diff-line del">-nzbget_docker_volumes: &quot;{{ nzbget_docker_volumes_default</span><span class="diff-line del">-                           + nzbget_docker_volumes_custom }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Devices</span><span class="diff-line del">-nzbget_docker_devices_default: []</span><span class="diff-line del">-nzbget_docker_devices_custom: []</span><span class="diff-line del">-nzbget_docker_devices: &quot;{{ nzbget_docker_devices_default</span><span class="diff-line del">-                           + nzbget_docker_devices_custom }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Hosts</span><span class="diff-line del">-nzbget_docker_hosts_default: {}</span><span class="diff-line del">-nzbget_docker_hosts_custom: {}</span><span class="diff-line del">-nzbget_docker_hosts: &quot;{{ docker_hosts_common</span><span class="diff-line del">-                         | combine(nzbget_docker_hosts_default)</span><span class="diff-line del">-                         | combine(nzbget_docker_hosts_custom) }}&quot;</span><span class="diff-line add">+nzbget_role_docker_volumes_custom: []</span><span class="diff-line add">+nzbget_role_docker_volumes: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_volumes_default&#x27;, role=&#x27;nzbget&#x27;)</span><span class="diff-line add">+                                + lookup(&#x27;role_var&#x27;, &#x27;_docker_volumes_custom&#x27;, role=&#x27;nzbget&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Labels</span><span class="diff-line del">-nzbget_docker_labels_default: {}</span><span class="diff-line del">-nzbget_docker_labels_custom: {}</span><span class="diff-line del">-nzbget_docker_labels: &quot;{{ docker_labels_common</span><span class="diff-line del">-                          | combine(lookup(&#x27;vars&#x27;, nzbget_name + &#x27;_docker_labels_default&#x27;, default=nzbget_docker_labels_default))</span><span class="diff-line del">-                          | combine((traefik_themepark_labels</span><span class="diff-line del">-                                    if (nzbget_themepark_enabled and global_themepark_plugin_enabled)</span><span class="diff-line del">-                                    else {}),</span><span class="diff-line del">-                                    lookup(&#x27;vars&#x27;, nzbget_name + &#x27;_docker_labels_custom&#x27;, default=nzbget_docker_labels_custom)) }}&quot;</span><span class="diff-line add">+nzbget_role_docker_labels_default: {}</span><span class="diff-line add">+nzbget_role_docker_labels_custom: {}</span><span class="diff-line add">+nzbget_role_docker_labels: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_labels_default&#x27;, role=&#x27;nzbget&#x27;)</span><span class="diff-line add">+                               | combine((traefik_themepark_labels</span><span class="diff-line add">+                                         if (lookup(&#x27;role_var&#x27;, &#x27;_themepark_enabled&#x27;, role=&#x27;nzbget&#x27;) and global_themepark_plugin_enabled)</span><span class="diff-line add">+                                         else {}),</span><span class="diff-line add">+                                         lookup(&#x27;role_var&#x27;, &#x27;_docker_labels_custom&#x27;, role=&#x27;nzbget&#x27;)) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Hostname</span><span class="diff-line del">-nzbget_docker_hostname: &quot;{{ nzbget_name }}&quot;</span><span class="diff-line add">+nzbget_role_docker_hostname: &quot;{{ nzbget_name }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Networks</span><span class="diff-line del">-nzbget_docker_networks_alias: &quot;{{ nzbget_name }}&quot;</span><span class="diff-line del">-nzbget_docker_networks_default: []</span><span class="diff-line del">-nzbget_docker_networks_custom: []</span><span class="diff-line del">-nzbget_docker_networks: &quot;{{ docker_networks_common</span><span class="diff-line del">-                            + nzbget_docker_networks_default</span><span class="diff-line del">-                            + nzbget_docker_networks_custom }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Capabilities</span><span class="diff-line del">-nzbget_docker_capabilities_default: []</span><span class="diff-line del">-nzbget_docker_capabilities_custom: []</span><span class="diff-line del">-nzbget_docker_capabilities: &quot;{{ nzbget_docker_capabilities_default</span><span class="diff-line del">-                                + nzbget_docker_capabilities_custom }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Security Opts</span><span class="diff-line del">-nzbget_docker_security_opts_default: []</span><span class="diff-line del">-nzbget_docker_security_opts_custom: []</span><span class="diff-line del">-nzbget_docker_security_opts: &quot;{{ nzbget_docker_security_opts_default</span><span class="diff-line del">-                                 + nzbget_docker_security_opts_custom }}&quot;</span><span class="diff-line add">+nzbget_role_docker_networks_alias: &quot;{{ nzbget_name }}&quot;</span><span class="diff-line add">+nzbget_role_docker_networks_default: []</span><span class="diff-line add">+nzbget_role_docker_networks_custom: []</span><span class="diff-line add">+nzbget_role_docker_networks: &quot;{{ docker_networks_common</span><span class="diff-line add">+                                 + lookup(&#x27;role_var&#x27;, &#x27;_docker_networks_default&#x27;, role=&#x27;nzbget&#x27;)</span><span class="diff-line add">+                                 + lookup(&#x27;role_var&#x27;, &#x27;_docker_networks_custom&#x27;, role=&#x27;nzbget&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Restart Policy</span><span class="diff-line del">-nzbget_docker_restart_policy: unless-stopped</span><span class="diff-line add">+nzbget_role_docker_restart_policy: unless-stopped</span><span class="diff-line context"> </span><span class="diff-line context"> # State</span><span class="diff-line del">-nzbget_docker_state: started</span><span class="diff-line add">+nzbget_role_docker_state: started</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-246">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/nzbget/tasks/main.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -11,9 +11,9 @@</span><span class="diff-line context"> - name: Add DNS record</span><span class="diff-line context">   ansible.builtin.include_tasks: &quot;{{ resources_tasks_path }}/dns/tasker.yml&quot;</span><span class="diff-line context">   vars:</span><span class="diff-line del">-    dns_record: &quot;{{ lookup(&#x27;vars&#x27;, role_name + &#x27;_dns_record&#x27;) }}&quot;</span><span class="diff-line del">-    dns_zone: &quot;{{ lookup(&#x27;vars&#x27;, role_name + &#x27;_dns_zone&#x27;) }}&quot;</span><span class="diff-line del">-    dns_proxy: &quot;{{ lookup(&#x27;vars&#x27;, role_name + &#x27;_dns_proxy&#x27;) }}&quot;</span><span class="diff-line add">+    dns_record: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_dns_record&#x27;) }}&quot;</span><span class="diff-line add">+    dns_zone: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_dns_zone&#x27;) }}&quot;</span><span class="diff-line add">+    dns_proxy: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_dns_proxy&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Remove existing Docker container</span><span class="diff-line context">   ansible.builtin.include_tasks: &quot;{{ resources_tasks_path }}/docker/remove_docker_container.yml&quot;</span><span class="diff-line hunk">@@ -23,12 +23,12 @@</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Check if existing config exists</span><span class="diff-line context">   ansible.builtin.stat:</span><span class="diff-line del">-    path: &quot;{{ nzbget_paths_config_location }}&quot;</span><span class="diff-line add">+    path: &quot;{{ nzbget_role_paths_config_location }}&quot;</span><span class="diff-line context">   register: nzbget_paths_config_location_stat</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Create Docker container</span><span class="diff-line context">   ansible.builtin.include_tasks: &quot;{{ resources_tasks_path }}/docker/create_docker_container.yml&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Post-Install Tasks</span><span class="diff-line del">-  ansible.builtin.import_tasks: &quot;subtasks/post-install/main.yml&quot;</span><span class="diff-line add">+  ansible.builtin.include_tasks: &quot;subtasks/post-install/main.yml&quot;</span><span class="diff-line context">   when: (not continuous_integration)</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-247">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/nzbget/tasks/subtasks/post-install/main.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -9,7 +9,7 @@</span><span class="diff-line context"> ---</span><span class="diff-line context"> - name: Post-Install | Wait for config file to be created</span><span class="diff-line context">   ansible.builtin.wait_for:</span><span class="diff-line del">-    path: &quot;{{ nzbget_paths_config_location }}&quot;</span><span class="diff-line add">+    path: &quot;{{ nzbget_role_paths_config_location }}&quot;</span><span class="diff-line context">     state: present</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Post-Install | Wait for 10 seconds</span><span class="diff-line hunk">@@ -19,15 +19,15 @@</span><span class="diff-line context"> - name: Post-Install | Stop container</span><span class="diff-line context">   ansible.builtin.include_tasks: &quot;{{ resources_tasks_path }}/docker/stop_docker_container.yml&quot;</span><span class="diff-line context">   vars:</span><span class="diff-line del">-    var_prefix: &quot;{{ nzbget_docker_container }}&quot;</span><span class="diff-line add">+    var_prefix: &quot;{{ nzbget_role_docker_container }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Post-Install | Scripts Task</span><span class="diff-line del">-  ansible.builtin.import_tasks: &quot;scripts/main.yml&quot;</span><span class="diff-line add">+  ansible.builtin.include_tasks: &quot;scripts/main.yml&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Post-Install | Settings Task</span><span class="diff-line del">-  ansible.builtin.import_tasks: &quot;settings/main.yml&quot;</span><span class="diff-line add">+  ansible.builtin.include_tasks: &quot;settings/main.yml&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Post-Install | Start container</span><span class="diff-line context">   ansible.builtin.include_tasks: &quot;{{ resources_tasks_path }}/docker/start_docker_container.yml&quot;</span><span class="diff-line context">   vars:</span><span class="diff-line del">-    var_prefix: &quot;{{ nzbget_docker_container }}&quot;</span><span class="diff-line add">+    var_prefix: &quot;{{ nzbget_role_docker_container }}&quot;</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-248">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/nzbget/tasks/subtasks/post-install/scripts/main.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -14,54 +14,48 @@</span><span class="diff-line context">     owner: &quot;{{ user.name }}&quot;</span><span class="diff-line context">     group: &quot;{{ user.name }}&quot;</span><span class="diff-line context">     mode: &quot;0775&quot;</span><span class="diff-line del">-  with_items: &quot;{{ nzbget_scripts_paths_folders_list }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Add Scripts</span><span class="diff-line add">+  with_items: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_scripts_paths_folders_list&#x27;, role=&#x27;nzbget&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Post-Install | Scripts | Download scripts repos</span><span class="diff-line context">   ansible.builtin.git:</span><span class="diff-line context">     repo: &quot;{{ item }}&quot;</span><span class="diff-line del">-    dest: &quot;{{ nzbget_scripts_paths_location }}/{{ (item | basename | splitext)[0] }}&quot;</span><span class="diff-line add">+    dest: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_scripts_paths_location&#x27;, role=&#x27;nzbget&#x27;) }}/{{ (item | basename | splitext)[0] }}&quot;</span><span class="diff-line context">     clone: true</span><span class="diff-line context">     version: HEAD</span><span class="diff-line context">     force: true</span><span class="diff-line context">   become: true</span><span class="diff-line context">   become_user: &quot;{{ user.name }}&quot;</span><span class="diff-line del">-  loop: &quot;{{ nzbget_scripts_repos_list }}&quot;</span><span class="diff-line del">-  ignore_errors: true</span><span class="diff-line add">+  loop: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_scripts_repos_list&#x27;, role=&#x27;nzbget&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Post-Install | Scripts | Download script URLs</span><span class="diff-line context">   ansible.builtin.get_url:</span><span class="diff-line context">     url: &quot;{{ item }}&quot;</span><span class="diff-line del">-    dest: &quot;{{ nzbget_scripts_paths_location }}&quot;</span><span class="diff-line add">+    dest: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_scripts_paths_location&#x27;, role=&#x27;nzbget&#x27;) }}&quot;</span><span class="diff-line context">     validate_certs: false</span><span class="diff-line context">     force: true</span><span class="diff-line context">     owner: &quot;{{ user.name }}&quot;</span><span class="diff-line context">     group: &quot;{{ user.name }}&quot;</span><span class="diff-line context">     mode: &quot;0775&quot;</span><span class="diff-line del">-  loop: &quot;{{ nzbget_scripts_direct_downloads_list }}&quot;</span><span class="diff-line del">-  ignore_errors: true</span><span class="diff-line add">+  loop: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_scripts_direct_downloads_list&#x27;, role=&#x27;nzbget&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Post-Install | Scripts | Import local scripts</span><span class="diff-line context">   ansible.builtin.copy:</span><span class="diff-line context">     src: &quot;{{ item }}&quot;</span><span class="diff-line del">-    dest: &quot;{{ nzbget_scripts_paths_location }}/{{ item }}&quot;</span><span class="diff-line add">+    dest: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_scripts_paths_location&#x27;, role=&#x27;nzbget&#x27;) }}/{{ item }}&quot;</span><span class="diff-line context">     owner: &quot;{{ user.name }}&quot;</span><span class="diff-line context">     group: &quot;{{ user.name }}&quot;</span><span class="diff-line context">     mode: &quot;0775&quot;</span><span class="diff-line context">     force: true</span><span class="diff-line del">-  loop: &quot;{{ nzbget_scripts_local_copy_list }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Customize Scripts</span><span class="diff-line add">+  loop: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_scripts_local_copy_list&#x27;, role=&#x27;nzbget&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Post-Install | Scripts | Check if &#x27;nzbgetpp/rarfile/rarfile.py&#x27; exists</span><span class="diff-line context">   ansible.builtin.stat:</span><span class="diff-line del">-    path: &quot;{{ nzbget_scripts_paths_rarfile_py_location }}&quot;</span><span class="diff-line add">+    path: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_scripts_paths_rarfile_py_location&#x27;, role=&#x27;nzbget&#x27;) }}&quot;</span><span class="diff-line context">   register: nzbget_scripts_rarfile_py_stat</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Post-Install | Scripts | Add unrar path to &#x27;nzbgetpp/rarfile/rarfile.py&#x27;</span><span class="diff-line context">   ansible.builtin.lineinfile:</span><span class="diff-line del">-    path: &quot;{{ nzbget_scripts_paths_rarfile_py_location }}&quot;</span><span class="diff-line add">+    path: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_scripts_paths_rarfile_py_location&#x27;, role=&#x27;nzbget&#x27;) }}&quot;</span><span class="diff-line context">     regexp: &#x27;^UNRAR_TOOL\s?=.*&#x27;</span><span class="diff-line context">     line: &#x27;UNRAR_TOOL = &quot;/usr/bin/unrar&quot;&#x27;</span><span class="diff-line context">     state: present</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-249">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/nzbget/tasks/subtasks/post-install/settings/main.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -9,23 +9,23 @@</span><span class="diff-line context"> ---</span><span class="diff-line context"> - name: Post-Install | Settings | Update settings For New Installs</span><span class="diff-line context">   ansible.builtin.lineinfile:</span><span class="diff-line del">-    path: &quot;{{ nzbget_paths_config_location }}&quot;</span><span class="diff-line add">+    path: &quot;{{ nzbget_role_paths_config_location }}&quot;</span><span class="diff-line context">     regexp: &#x27;{{ item.regexp }}&#x27;</span><span class="diff-line context">     line: &quot;{{ item.line }}&quot;</span><span class="diff-line context">     state: present</span><span class="diff-line context">     owner: &quot;{{ user.name }}&quot;</span><span class="diff-line context">     group: &quot;{{ user.name }}&quot;</span><span class="diff-line context">     mode: &quot;0664&quot;</span><span class="diff-line del">-  loop: &quot;{{ nzbget_config_new_installs_settings_list }}&quot;</span><span class="diff-line add">+  loop: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_config_new_installs_settings_list&#x27;, role=&#x27;nzbget&#x27;) }}&quot;</span><span class="diff-line context">   when: (not nzbget_paths_config_location_stat.stat.exists)</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Post-Install | Settings | Set settings For Existing Installs</span><span class="diff-line context">   ansible.builtin.lineinfile:</span><span class="diff-line del">-    path: &quot;{{ nzbget_paths_config_location }}&quot;</span><span class="diff-line add">+    path: &quot;{{ nzbget_role_paths_config_location }}&quot;</span><span class="diff-line context">     regexp: &#x27;{{ item.regexp }}&#x27;</span><span class="diff-line context">     line: &quot;{{ item.line }}&quot;</span><span class="diff-line context">     state: present</span><span class="diff-line context">     owner: &quot;{{ user.name }}&quot;</span><span class="diff-line context">     group: &quot;{{ user.name }}&quot;</span><span class="diff-line context">     mode: &quot;0664&quot;</span><span class="diff-line del">-  loop: &quot;{{ nzbget_config_existing_installs_settings_list }}&quot;</span><span class="diff-line add">+  loop: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_config_existing_installs_settings_list&#x27;, role=&#x27;nzbget&#x27;) }}&quot;</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-250">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/nzbhydra2/defaults/main.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -17,67 +17,67 @@</span><span class="diff-line context"> # Paths</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-nzbhydra2_paths_folder: &quot;{{ nzbhydra2_name }}&quot;</span><span class="diff-line del">-nzbhydra2_paths_location: &quot;{{ server_appdata_path }}/{{ nzbhydra2_paths_folder }}&quot;</span><span class="diff-line del">-nzbhydra2_paths_downloads_location: &quot;{{ downloads_usenet_path }}/{{ nzbhydra2_paths_folder }}&quot;</span><span class="diff-line del">-nzbhydra2_paths_folders_list:</span><span class="diff-line del">-  - &quot;{{ nzbhydra2_paths_location }}&quot;</span><span class="diff-line del">-nzbhydra2_paths_config_location: &quot;{{ nzbhydra2_paths_location }}/nzbhydra.yml&quot;</span><span class="diff-line add">+nzbhydra2_role_paths_folder: &quot;{{ nzbhydra2_name }}&quot;</span><span class="diff-line add">+nzbhydra2_role_paths_location: &quot;{{ server_appdata_path }}/{{ nzbhydra2_role_paths_folder }}&quot;</span><span class="diff-line add">+nzbhydra2_role_paths_downloads_location: &quot;{{ downloads_usenet_path }}/{{ nzbhydra2_role_paths_folder }}&quot;</span><span class="diff-line add">+nzbhydra2_role_paths_folders_list:</span><span class="diff-line add">+  - &quot;{{ nzbhydra2_role_paths_location }}&quot;</span><span class="diff-line add">+nzbhydra2_role_paths_config_location: &quot;{{ nzbhydra2_role_paths_location }}/nzbhydra.yml&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # Web</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-nzbhydra2_web_subdomain: &quot;{{ nzbhydra2_name }}&quot;</span><span class="diff-line del">-nzbhydra2_web_domain: &quot;{{ user.domain }}&quot;</span><span class="diff-line del">-nzbhydra2_web_port: &quot;5076&quot;</span><span class="diff-line del">-nzbhydra2_web_url: &quot;{{ &#x27;https://&#x27; + (nzbhydra2_web_subdomain + &#x27;.&#x27; + nzbhydra2_web_domain</span><span class="diff-line del">-                    if (nzbhydra2_web_subdomain | length &gt; 0)</span><span class="diff-line del">-                    else nzbhydra2_web_domain) }}&quot;</span><span class="diff-line add">+nzbhydra2_role_web_subdomain: &quot;{{ nzbhydra2_name }}&quot;</span><span class="diff-line add">+nzbhydra2_role_web_domain: &quot;{{ user.domain }}&quot;</span><span class="diff-line add">+nzbhydra2_role_web_port: &quot;5076&quot;</span><span class="diff-line add">+nzbhydra2_role_web_url: &quot;{{ &#x27;https://&#x27; + (lookup(&#x27;role_var&#x27;, &#x27;_web_subdomain&#x27;, role=&#x27;nzbhydra2&#x27;) + &#x27;.&#x27; + lookup(&#x27;role_var&#x27;, &#x27;_web_domain&#x27;, role=&#x27;nzbhydra2&#x27;)</span><span class="diff-line add">+                         if (lookup(&#x27;role_var&#x27;, &#x27;_web_subdomain&#x27;, role=&#x27;nzbhydra2&#x27;) | length &gt; 0)</span><span class="diff-line add">+                         else lookup(&#x27;role_var&#x27;, &#x27;_web_domain&#x27;, role=&#x27;nzbhydra2&#x27;)) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # DNS</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-nzbhydra2_dns_record: &quot;{{ nzbhydra2_web_subdomain }}&quot;</span><span class="diff-line del">-nzbhydra2_dns_zone: &quot;{{ nzbhydra2_web_domain }}&quot;</span><span class="diff-line del">-nzbhydra2_dns_proxy: &quot;{{ dns.proxied }}&quot;</span><span class="diff-line add">+nzbhydra2_role_dns_record: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_web_subdomain&#x27;, role=&#x27;nzbhydra2&#x27;) }}&quot;</span><span class="diff-line add">+nzbhydra2_role_dns_zone: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_web_domain&#x27;, role=&#x27;nzbhydra2&#x27;) }}&quot;</span><span class="diff-line add">+nzbhydra2_role_dns_proxy: &quot;{{ dns_proxied }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # Traefik</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-nzbhydra2_traefik_sso_middleware: &quot;{{ traefik_default_sso_middleware }}&quot;</span><span class="diff-line del">-nzbhydra2_traefik_middleware_default: &quot;{{ traefik_default_middleware</span><span class="diff-line del">-                                        + (&#x27;,themepark-&#x27; + lookup(&#x27;vars&#x27;, nzbhydra2_name + &#x27;_name&#x27;, default=nzbhydra2_name)</span><span class="diff-line del">-                                          if (nzbhydra2_themepark_enabled and global_themepark_plugin_enabled)</span><span class="diff-line del">-                                          else &#x27;&#x27;) }}&quot;</span><span class="diff-line del">-nzbhydra2_traefik_middleware_custom: &quot;&quot;</span><span class="diff-line del">-nzbhydra2_traefik_certresolver: &quot;{{ traefik_default_certresolver }}&quot;</span><span class="diff-line del">-nzbhydra2_traefik_enabled: true</span><span class="diff-line del">-nzbhydra2_traefik_api_enabled: true</span><span class="diff-line del">-nzbhydra2_traefik_api_endpoint: &quot;PathPrefix(`/api`) || PathPrefix(`/getnzb`) || PathPrefix(`/gettorrent`) || PathPrefix(`/rss`) || PathPrefix(`/torznab/api`)&quot;</span><span class="diff-line add">+nzbhydra2_role_traefik_sso_middleware: &quot;{{ traefik_default_sso_middleware }}&quot;</span><span class="diff-line add">+nzbhydra2_role_traefik_middleware_default: &quot;{{ traefik_default_middleware</span><span class="diff-line add">+                                               + (&#x27;,themepark-&#x27; + nzbhydra2_name</span><span class="diff-line add">+                                                 if (lookup(&#x27;role_var&#x27;, &#x27;_themepark_enabled&#x27;, role=&#x27;nzbhydra2&#x27;) and global_themepark_plugin_enabled)</span><span class="diff-line add">+                                                 else &#x27;&#x27;) }}&quot;</span><span class="diff-line add">+nzbhydra2_role_traefik_middleware_custom: &quot;&quot;</span><span class="diff-line add">+nzbhydra2_role_traefik_certresolver: &quot;{{ traefik_default_certresolver }}&quot;</span><span class="diff-line add">+nzbhydra2_role_traefik_enabled: true</span><span class="diff-line add">+nzbhydra2_role_traefik_api_enabled: true</span><span class="diff-line add">+nzbhydra2_role_traefik_api_endpoint: &quot;PathPrefix(`/api`) || PathPrefix(`/getnzb`) || PathPrefix(`/gettorrent`) || PathPrefix(`/rss`) || PathPrefix(`/torznab/api`)&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line del">-# THEME</span><span class="diff-line add">+# Theme</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line context"> # Options can be found at https://github.com/themepark-dev/theme.park</span><span class="diff-line del">-nzbhydra2_themepark_enabled: false</span><span class="diff-line del">-nzbhydra2_themepark_app: &quot;nzbhydra2&quot;</span><span class="diff-line del">-nzbhydra2_themepark_theme: &quot;{{ global_themepark_theme }}&quot;</span><span class="diff-line del">-nzbhydra2_themepark_domain: &quot;{{ global_themepark_domain }}&quot;</span><span class="diff-line del">-nzbhydra2_themepark_addons: []</span><span class="diff-line add">+nzbhydra2_role_themepark_enabled: false</span><span class="diff-line add">+nzbhydra2_role_themepark_app: &quot;nzbhydra2&quot;</span><span class="diff-line add">+nzbhydra2_role_themepark_theme: &quot;{{ global_themepark_theme }}&quot;</span><span class="diff-line add">+nzbhydra2_role_themepark_domain: &quot;{{ global_themepark_domain }}&quot;</span><span class="diff-line add">+nzbhydra2_role_themepark_addons: []</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # Config</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-nzbhydra2_config_settings_jvm_memory: &quot;{{ ((ansible_memory_mb.real.total / 1024)</span><span class="diff-line del">-                                           | round(0, &#x27;ceil&#x27;) | int &gt;= 8)</span><span class="diff-line del">-                                           | ternary(&#x27;512&#x27;, &#x27;256&#x27;) }}&quot;</span><span class="diff-line add">+nzbhydra2_role_config_settings_jvm_memory: &quot;{{ ((ansible_facts[&#x27;memory_mb&#x27;][&#x27;real&#x27;][&#x27;total&#x27;] / 1024)</span><span class="diff-line add">+                                               | round(0, &#x27;ceil&#x27;) | int &gt;= 8)</span><span class="diff-line add">+                                               | ternary(&#x27;512&#x27;, &#x27;256&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line del">-nzbhydra2_config_settings_default:</span><span class="diff-line add">+nzbhydra2_role_config_settings_default:</span><span class="diff-line context">   # NZBGet</span><span class="diff-line context">   - del(.downloading.downloaders)</span><span class="diff-line context">   - .downloading.downloaders[0].apiKey = &quot;{{ nzbhydra2_sabnzbd_api_lookup | default(&#x27;not-found&#x27;) }}&quot;</span><span class="diff-line hunk">@@ -88,107 +88,70 @@</span><span class="diff-line context">   - .downloading.downloaders[0].name = &quot;SABnzbd&quot; | .downloading.downloaders[0].name style=&quot;double&quot;</span><span class="diff-line context">   - .downloading.downloaders[0].nzbAddingType = &quot;UPLOAD&quot; | .downloading.downloaders[0].nzbAddingType style=&quot;double&quot;</span><span class="diff-line context">   - .downloading.downloaders[0].downloaderType = &quot;SABNZBD&quot; | .downloading.downloaders[0].downloaderType style=&quot;double&quot;</span><span class="diff-line del">-  - .downloading.downloaders[0].url = &quot;http://{{ sabnzbd_docker_networks_alias }}:{{ sabnzbd_web_port }}&quot; | .downloading.downloaders[0].url style=&quot;double&quot;</span><span class="diff-line add">+  - .downloading.downloaders[0].url = &quot;http://{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_networks_alias&#x27;, role=&#x27;sabnzbd&#x27;) }}:{{ lookup(&#x27;role_var&#x27;, &#x27;_web_port&#x27;, role=&#x27;sabnzbd&#x27;) }}&quot; | .downloading.downloaders[0].url style=&quot;double&quot;</span><span class="diff-line context">   - .downloading.downloaders[0].username = null</span><span class="diff-line context">   - .downloading.downloaders[0].password = null</span><span class="diff-line context">   - .downloading.downloaders[0].addPaused = false</span><span class="diff-line context">   # JVM Memory. If RAM &gt;= 8GB, set XMX to 512, else 256.</span><span class="diff-line del">-  - .main.xmx = {{ nzbhydra2_config_settings_jvm_memory }}</span><span class="diff-line add">+  - .main.xmx = {{ lookup(&#x27;role_var&#x27;, &#x27;_config_settings_jvm_memory&#x27;, role=&#x27;nzbhydra2&#x27;) }}</span><span class="diff-line context"> </span><span class="diff-line del">-nzbhydra2_config_settings_custom: []</span><span class="diff-line add">+nzbhydra2_role_config_settings_custom: []</span><span class="diff-line context"> </span><span class="diff-line del">-nzbhydra2_config_settings_list: &quot;{{ nzbhydra2_config_settings_default</span><span class="diff-line del">-                                    + nzbhydra2_config_settings_custom }}&quot;</span><span class="diff-line add">+nzbhydra2_role_config_settings_list: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_config_settings_default&#x27;, role=&#x27;nzbhydra2&#x27;)</span><span class="diff-line add">+                                         + lookup(&#x27;role_var&#x27;, &#x27;_config_settings_custom&#x27;, role=&#x27;nzbhydra2&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # Docker</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line context"> # Container</span><span class="diff-line del">-nzbhydra2_docker_container: &quot;{{ nzbhydra2_name }}&quot;</span><span class="diff-line add">+nzbhydra2_role_docker_container: &quot;{{ nzbhydra2_name }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Image</span><span class="diff-line del">-nzbhydra2_docker_image_pull: true</span><span class="diff-line del">-nzbhydra2_docker_image_tag: &quot;latest&quot;</span><span class="diff-line del">-nzbhydra2_docker_image: &quot;lscr.io/linuxserver/nzbhydra2:{{ nzbhydra2_docker_image_tag }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Ports</span><span class="diff-line del">-nzbhydra2_docker_ports_defaults: []</span><span class="diff-line del">-nzbhydra2_docker_ports_custom: []</span><span class="diff-line del">-nzbhydra2_docker_ports: &quot;{{ nzbhydra2_docker_ports_defaults</span><span class="diff-line del">-                            + nzbhydra2_docker_ports_custom }}&quot;</span><span class="diff-line add">+nzbhydra2_role_docker_image_pull: true</span><span class="diff-line add">+nzbhydra2_role_docker_image_repo: &quot;lscr.io/linuxserver/nzbhydra2&quot;</span><span class="diff-line add">+nzbhydra2_role_docker_image_tag: &quot;latest&quot;</span><span class="diff-line add">+nzbhydra2_role_docker_image: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_image_repo&#x27;, role=&#x27;nzbhydra2&#x27;) }}:{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_image_tag&#x27;, role=&#x27;nzbhydra2&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Envs</span><span class="diff-line del">-nzbhydra2_docker_envs_default:</span><span class="diff-line add">+nzbhydra2_role_docker_envs_default:</span><span class="diff-line context">   PUID: &quot;{{ uid }}&quot;</span><span class="diff-line context">   PGID: &quot;{{ gid }}&quot;</span><span class="diff-line context">   UMASK: &quot;002&quot;</span><span class="diff-line context">   TZ: &quot;{{ tz }}&quot;</span><span class="diff-line del">-nzbhydra2_docker_envs_custom: {}</span><span class="diff-line del">-nzbhydra2_docker_envs: &quot;{{ nzbhydra2_docker_envs_default</span><span class="diff-line del">-                           | combine(nzbhydra2_docker_envs_custom) }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Commands</span><span class="diff-line del">-nzbhydra2_docker_commands_default: []</span><span class="diff-line del">-nzbhydra2_docker_commands_custom: []</span><span class="diff-line del">-nzbhydra2_docker_commands: &quot;{{ nzbhydra2_docker_commands_default</span><span class="diff-line del">-                               + nzbhydra2_docker_commands_custom }}&quot;</span><span class="diff-line add">+nzbhydra2_role_docker_envs_custom: {}</span><span class="diff-line add">+nzbhydra2_role_docker_envs: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_envs_default&#x27;, role=&#x27;nzbhydra2&#x27;)</span><span class="diff-line add">+                                | combine(lookup(&#x27;role_var&#x27;, &#x27;_docker_envs_custom&#x27;, role=&#x27;nzbhydra2&#x27;)) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Volumes</span><span class="diff-line del">-nzbhydra2_docker_volumes_default:</span><span class="diff-line del">-  - &quot;{{ nzbhydra2_paths_location }}:/config&quot;</span><span class="diff-line del">-nzbhydra2_docker_volumes_custom: []</span><span class="diff-line del">-nzbhydra2_docker_volumes: &quot;{{ nzbhydra2_docker_volumes_default</span><span class="diff-line del">-                              + nzbhydra2_docker_volumes_custom }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Devices</span><span class="diff-line del">-nzbhydra2_docker_devices_default: []</span><span class="diff-line del">-nzbhydra2_docker_devices_custom: []</span><span class="diff-line del">-nzbhydra2_docker_devices: &quot;{{ nzbhydra2_docker_devices_default</span><span class="diff-line del">-                              + nzbhydra2_docker_devices_custom }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Hosts</span><span class="diff-line del">-nzbhydra2_docker_hosts_default: {}</span><span class="diff-line del">-nzbhydra2_docker_hosts_custom: {}</span><span class="diff-line del">-nzbhydra2_docker_hosts: &quot;{{ docker_hosts_common</span><span class="diff-line del">-                            | combine(nzbhydra2_docker_hosts_default)</span><span class="diff-line del">-                            | combine(nzbhydra2_docker_hosts_custom) }}&quot;</span><span class="diff-line add">+nzbhydra2_role_docker_volumes_default:</span><span class="diff-line add">+  - &quot;{{ nzbhydra2_role_paths_location }}:/config&quot;</span><span class="diff-line add">+nzbhydra2_role_docker_volumes_custom: []</span><span class="diff-line add">+nzbhydra2_role_docker_volumes: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_volumes_default&#x27;, role=&#x27;nzbhydra2&#x27;)</span><span class="diff-line add">+                                   + lookup(&#x27;role_var&#x27;, &#x27;_docker_volumes_custom&#x27;, role=&#x27;nzbhydra2&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Labels</span><span class="diff-line del">-nzbhydra2_docker_labels_default: {}</span><span class="diff-line del">-nzbhydra2_docker_labels_custom: {}</span><span class="diff-line del">-nzbhydra2_docker_labels: &quot;{{ docker_labels_common</span><span class="diff-line del">-                             | combine(lookup(&#x27;vars&#x27;, nzbhydra2_name + &#x27;_docker_labels_default&#x27;, default=nzbhydra2_docker_labels_default))</span><span class="diff-line del">-                             | combine((traefik_themepark_labels</span><span class="diff-line del">-                                       if (nzbhydra2_themepark_enabled and global_themepark_plugin_enabled)</span><span class="diff-line del">-                                       else {}),</span><span class="diff-line del">-                                       lookup(&#x27;vars&#x27;, nzbhydra2_name + &#x27;_docker_labels_custom&#x27;, default=nzbhydra2_docker_labels_custom)) }}&quot;</span><span class="diff-line add">+nzbhydra2_role_docker_labels_default: {}</span><span class="diff-line add">+nzbhydra2_role_docker_labels_custom: {}</span><span class="diff-line add">+nzbhydra2_role_docker_labels: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_labels_default&#x27;, role=&#x27;nzbhydra2&#x27;)</span><span class="diff-line add">+                                  | combine((traefik_themepark_labels</span><span class="diff-line add">+                                            if (lookup(&#x27;role_var&#x27;, &#x27;_themepark_enabled&#x27;, role=&#x27;nzbhydra2&#x27;) and global_themepark_plugin_enabled)</span><span class="diff-line add">+                                            else {}),</span><span class="diff-line add">+                                            lookup(&#x27;role_var&#x27;, &#x27;_docker_labels_custom&#x27;, role=&#x27;nzbhydra2&#x27;)) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Hostname</span><span class="diff-line del">-nzbhydra2_docker_hostname: &quot;{{ nzbhydra2_name }}&quot;</span><span class="diff-line add">+nzbhydra2_role_docker_hostname: &quot;{{ nzbhydra2_name }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Networks</span><span class="diff-line del">-nzbhydra2_docker_networks_alias: &quot;{{ nzbhydra2_name }}&quot;</span><span class="diff-line del">-nzbhydra2_docker_networks_default: []</span><span class="diff-line del">-nzbhydra2_docker_networks_custom: []</span><span class="diff-line del">-nzbhydra2_docker_networks: &quot;{{ docker_networks_common</span><span class="diff-line del">-                               + nzbhydra2_docker_networks_default</span><span class="diff-line del">-                               + nzbhydra2_docker_networks_custom }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Capabilities</span><span class="diff-line del">-nzbhydra2_docker_capabilities_default: []</span><span class="diff-line del">-nzbhydra2_docker_capabilities_custom: []</span><span class="diff-line del">-nzbhydra2_docker_capabilities: &quot;{{ nzbhydra2_docker_capabilities_default</span><span class="diff-line del">-                                   + nzbhydra2_docker_capabilities_custom }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Security Opts</span><span class="diff-line del">-nzbhydra2_docker_security_opts_default: []</span><span class="diff-line del">-nzbhydra2_docker_security_opts_custom: []</span><span class="diff-line del">-nzbhydra2_docker_security_opts: &quot;{{ nzbhydra2_docker_security_opts_default</span><span class="diff-line del">-                                    + nzbhydra2_docker_security_opts_custom }}&quot;</span><span class="diff-line add">+nzbhydra2_role_docker_networks_alias: &quot;{{ nzbhydra2_name }}&quot;</span><span class="diff-line add">+nzbhydra2_role_docker_networks_default: []</span><span class="diff-line add">+nzbhydra2_role_docker_networks_custom: []</span><span class="diff-line add">+nzbhydra2_role_docker_networks: &quot;{{ docker_networks_common</span><span class="diff-line add">+                                    + lookup(&#x27;role_var&#x27;, &#x27;_docker_networks_default&#x27;, role=&#x27;nzbhydra2&#x27;)</span><span class="diff-line add">+                                    + lookup(&#x27;role_var&#x27;, &#x27;_docker_networks_custom&#x27;, role=&#x27;nzbhydra2&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Restart Policy</span><span class="diff-line del">-nzbhydra2_docker_restart_policy: unless-stopped</span><span class="diff-line add">+nzbhydra2_role_docker_restart_policy: unless-stopped</span><span class="diff-line context"> </span><span class="diff-line context"> # State</span><span class="diff-line del">-nzbhydra2_docker_state: started</span><span class="diff-line add">+nzbhydra2_role_docker_state: started</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-251">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/nzbhydra2/tasks/main.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -10,9 +10,9 @@</span><span class="diff-line context"> - name: Add DNS record</span><span class="diff-line context">   ansible.builtin.include_tasks: &quot;{{ resources_tasks_path }}/dns/tasker.yml&quot;</span><span class="diff-line context">   vars:</span><span class="diff-line del">-    dns_record: &quot;{{ lookup(&#x27;vars&#x27;, role_name + &#x27;_dns_record&#x27;) }}&quot;</span><span class="diff-line del">-    dns_zone: &quot;{{ lookup(&#x27;vars&#x27;, role_name + &#x27;_dns_zone&#x27;) }}&quot;</span><span class="diff-line del">-    dns_proxy: &quot;{{ lookup(&#x27;vars&#x27;, role_name + &#x27;_dns_proxy&#x27;) }}&quot;</span><span class="diff-line add">+    dns_record: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_dns_record&#x27;) }}&quot;</span><span class="diff-line add">+    dns_zone: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_dns_zone&#x27;) }}&quot;</span><span class="diff-line add">+    dns_proxy: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_dns_proxy&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Remove existing Docker container</span><span class="diff-line context">   ansible.builtin.include_tasks: &quot;{{ resources_tasks_path }}/docker/remove_docker_container.yml&quot;</span><span class="diff-line hunk">@@ -22,12 +22,12 @@</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Check if existing config exists</span><span class="diff-line context">   ansible.builtin.stat:</span><span class="diff-line del">-    path: &quot;{{ nzbhydra2_paths_config_location }}&quot;</span><span class="diff-line add">+    path: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_config_location&#x27;, role=&#x27;nzbhydra2&#x27;) }}&quot;</span><span class="diff-line context">   register: nzbhydra2_yml_stat</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Create Docker container</span><span class="diff-line context">   ansible.builtin.include_tasks: &quot;{{ resources_tasks_path }}/docker/create_docker_container.yml&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Post-Install Tasks</span><span class="diff-line del">-  ansible.builtin.import_tasks: &quot;subtasks/post-install/main.yml&quot;</span><span class="diff-line add">+  ansible.builtin.include_tasks: &quot;subtasks/post-install/main.yml&quot;</span><span class="diff-line context">   when: (not continuous_integration)</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-252">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/nzbhydra2/tasks/subtasks/post-install/main.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -9,13 +9,13 @@</span><span class="diff-line context"> ---</span><span class="diff-line context"> - name: Post-Install | Check if SABnzbd config exists</span><span class="diff-line context">   ansible.builtin.stat:</span><span class="diff-line del">-    path: &quot;{{ sabnzbd_paths_config_location }}&quot;</span><span class="diff-line add">+    path: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_config_location&#x27;, role=&#x27;sabnzbd&#x27;) }}&quot;</span><span class="diff-line context">   register: nzbhydra2_sabnzbd_yml_stat</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Post-Install | SABnzbd tasks</span><span class="diff-line del">-  ansible.builtin.import_tasks: &quot;sabnzbd.yml&quot;</span><span class="diff-line add">+  ansible.builtin.include_tasks: &quot;sabnzbd.yml&quot;</span><span class="diff-line context">   when: (not nzbhydra2_yml_stat.stat.exists) and nzbhydra2_sabnzbd_yml_stat.stat.exists</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Post-Install | Settings Tweaks</span><span class="diff-line del">-  ansible.builtin.import_tasks: &quot;settings.yml&quot;</span><span class="diff-line add">+  ansible.builtin.include_tasks: &quot;settings.yml&quot;</span><span class="diff-line context">   when: (not nzbhydra2_yml_stat.stat.exists)</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-253">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/nzbhydra2/tasks/subtasks/post-install/sabnzbd.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -9,4 +9,4 @@</span><span class="diff-line context"> ---</span><span class="diff-line context"> - name: Find api_key value</span><span class="diff-line context">   ansible.builtin.set_fact:</span><span class="diff-line del">-    nzbhydra2_sabnzbd_api_lookup: &quot;{{ lookup(&#x27;file&#x27;, sabnzbd_paths_config_location) | regex_search(&#x27;^api_key *= *.*&#x27;, multiline=True) | regex_replace(&#x27;.*= *(.*)$&#x27;, &#x27;\\1&#x27;) }}&quot;</span><span class="diff-line add">+    nzbhydra2_sabnzbd_api_lookup: &quot;{{ lookup(&#x27;file&#x27;, lookup(&#x27;role_var&#x27;, &#x27;_paths_config_location&#x27;, role=&#x27;sabnzbd&#x27;)) | regex_search(&#x27;^api_key *= *.*&#x27;, multiline=True) | regex_replace(&#x27;.*= *(.*)$&#x27;, &#x27;\\1&#x27;) }}&quot;</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-254">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/nzbhydra2/tasks/subtasks/post-install/settings.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -9,7 +9,7 @@</span><span class="diff-line context"> ---</span><span class="diff-line context"> - name: Post-Install | Settings | Wait for config file to be created</span><span class="diff-line context">   ansible.builtin.wait_for:</span><span class="diff-line del">-    path: &quot;{{ nzbhydra2_paths_config_location }}&quot;</span><span class="diff-line add">+    path: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_config_location&#x27;, role=&#x27;nzbhydra2&#x27;) }}&quot;</span><span class="diff-line context">     state: present</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Wait 30 seconds</span><span class="diff-line hunk">@@ -21,10 +21,10 @@</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Post-Install | Settings | Update settings</span><span class="diff-line context">   ansible.builtin.shell: |</span><span class="diff-line del">-    yyq -i &#x27;{{ item }}&#x27; {{ nzbhydra2_paths_config_location }}</span><span class="diff-line add">+    yyq -i &#x27;{{ item }}&#x27; {{ lookup(&#x27;role_var&#x27;, &#x27;_paths_config_location&#x27;, role=&#x27;nzbhydra2&#x27;) }}</span><span class="diff-line context">   become: true</span><span class="diff-line context">   become_user: &quot;{{ user.name }}&quot;</span><span class="diff-line del">-  loop: &quot;{{ nzbhydra2_config_settings_list }}&quot;</span><span class="diff-line add">+  loop: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_config_settings_list&#x27;, role=&#x27;nzbhydra2&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Post-Install | Settings | Start container</span><span class="diff-line context">   ansible.builtin.include_tasks: &quot;{{ resources_tasks_path }}/docker/start_docker_container.yml&quot;</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-255">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/nzbthrottle/defaults/main.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -17,95 +17,52 @@</span><span class="diff-line context"> # Paths</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-nzbthrottle_paths_folder: &quot;{{ nzbthrottle_name }}&quot;</span><span class="diff-line del">-nzbthrottle_paths_location: &quot;{{ server_appdata_path }}/{{ nzbthrottle_paths_folder }}&quot;</span><span class="diff-line del">-nzbthrottle_paths_folders_list:</span><span class="diff-line del">-  - &quot;{{ nzbthrottle_paths_location }}&quot;</span><span class="diff-line del">-nzbthrottle_paths_config_location: &quot;{{ nzbthrottle_paths_location }}/config.json&quot;</span><span class="diff-line add">+nzbthrottle_role_paths_folder: &quot;{{ nzbthrottle_name }}&quot;</span><span class="diff-line add">+nzbthrottle_role_paths_location: &quot;{{ server_appdata_path }}/{{ nzbthrottle_role_paths_folder }}&quot;</span><span class="diff-line add">+nzbthrottle_role_paths_folders_list:</span><span class="diff-line add">+  - &quot;{{ nzbthrottle_role_paths_location }}&quot;</span><span class="diff-line add">+nzbthrottle_role_paths_config_location: &quot;{{ nzbthrottle_role_paths_location }}/config.json&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # Docker</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line context"> # Container</span><span class="diff-line del">-nzbthrottle_docker_container: &quot;{{ nzbthrottle_name }}&quot;</span><span class="diff-line add">+nzbthrottle_role_docker_container: &quot;{{ nzbthrottle_name }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Image</span><span class="diff-line del">-nzbthrottle_docker_image_pull: true</span><span class="diff-line del">-nzbthrottle_docker_image_tag: &quot;latest&quot;</span><span class="diff-line del">-nzbthrottle_docker_image: &quot;daghaian/nzbthrottle:{{ nzbthrottle_docker_image_tag }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Ports</span><span class="diff-line del">-nzbthrottle_docker_ports_defaults: []</span><span class="diff-line del">-nzbthrottle_docker_ports_custom: []</span><span class="diff-line del">-nzbthrottle_docker_ports: &quot;{{ nzbthrottle_docker_ports_defaults</span><span class="diff-line del">-                              + nzbthrottle_docker_ports_custom }}&quot;</span><span class="diff-line add">+nzbthrottle_role_docker_image_pull: true</span><span class="diff-line add">+nzbthrottle_role_docker_image_repo: &quot;daghaian/nzbthrottle&quot;</span><span class="diff-line add">+nzbthrottle_role_docker_image_tag: &quot;latest&quot;</span><span class="diff-line add">+nzbthrottle_role_docker_image: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_image_repo&#x27;, role=&#x27;nzbthrottle&#x27;) }}:{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_image_tag&#x27;, role=&#x27;nzbthrottle&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Envs</span><span class="diff-line del">-nzbthrottle_docker_envs_default:</span><span class="diff-line add">+nzbthrottle_role_docker_envs_default:</span><span class="diff-line context">   TZ: &quot;{{ tz }}&quot;</span><span class="diff-line del">-nzbthrottle_docker_envs_custom: {}</span><span class="diff-line del">-nzbthrottle_docker_envs: &quot;{{ nzbthrottle_docker_envs_default</span><span class="diff-line del">-                              | combine(nzbthrottle_docker_envs_custom) }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Commands</span><span class="diff-line del">-nzbthrottle_docker_commands_default: []</span><span class="diff-line del">-nzbthrottle_docker_commands_custom: []</span><span class="diff-line del">-nzbthrottle_docker_commands: &quot;{{ nzbthrottle_docker_commands_default</span><span class="diff-line del">-                                  + nzbthrottle_docker_commands_custom }}&quot;</span><span class="diff-line add">+nzbthrottle_role_docker_envs_custom: {}</span><span class="diff-line add">+nzbthrottle_role_docker_envs: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_envs_default&#x27;, role=&#x27;nzbthrottle&#x27;)</span><span class="diff-line add">+                                  | combine(lookup(&#x27;role_var&#x27;, &#x27;_docker_envs_custom&#x27;, role=&#x27;nzbthrottle&#x27;)) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Volumes</span><span class="diff-line del">-nzbthrottle_docker_volumes_default:</span><span class="diff-line del">-  - &quot;{{ nzbthrottle_paths_config_location }}:/nzbthrottle/config.json:ro&quot;</span><span class="diff-line del">-nzbthrottle_docker_volumes_custom: []</span><span class="diff-line del">-nzbthrottle_docker_volumes: &quot;{{ nzbthrottle_docker_volumes_default</span><span class="diff-line del">-                                + nzbthrottle_docker_volumes_custom }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Devices</span><span class="diff-line del">-nzbthrottle_docker_devices_default: []</span><span class="diff-line del">-nzbthrottle_docker_devices_custom: []</span><span class="diff-line del">-nzbthrottle_docker_devices: &quot;{{ nzbthrottle_docker_devices_default</span><span class="diff-line del">-                                + nzbthrottle_docker_devices_custom }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Hosts</span><span class="diff-line del">-nzbthrottle_docker_hosts_default: {}</span><span class="diff-line del">-nzbthrottle_docker_hosts_custom: {}</span><span class="diff-line del">-nzbthrottle_docker_hosts: &quot;{{ docker_hosts_common</span><span class="diff-line del">-                              | combine(nzbthrottle_docker_hosts_default)</span><span class="diff-line del">-                              | combine(nzbthrottle_docker_hosts_custom) }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Labels</span><span class="diff-line del">-nzbthrottle_docker_labels_default: {}</span><span class="diff-line del">-nzbthrottle_docker_labels_custom: {}</span><span class="diff-line del">-nzbthrottle_docker_labels: &quot;{{ docker_labels_common</span><span class="diff-line del">-                                | combine(nzbthrottle_docker_labels_default)</span><span class="diff-line del">-                                | combine(nzbthrottle_docker_labels_custom) }}&quot;</span><span class="diff-line add">+nzbthrottle_role_docker_volumes_default:</span><span class="diff-line add">+  - &quot;{{ nzbthrottle_role_paths_config_location }}:/nzbthrottle/config.json:ro&quot;</span><span class="diff-line add">+nzbthrottle_role_docker_volumes_custom: []</span><span class="diff-line add">+nzbthrottle_role_docker_volumes: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_volumes_default&#x27;, role=&#x27;nzbthrottle&#x27;)</span><span class="diff-line add">+                                     + lookup(&#x27;role_var&#x27;, &#x27;_docker_volumes_custom&#x27;, role=&#x27;nzbthrottle&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Hostname</span><span class="diff-line del">-nzbthrottle_docker_hostname: &quot;{{ nzbthrottle_name }}&quot;</span><span class="diff-line add">+nzbthrottle_role_docker_hostname: &quot;{{ nzbthrottle_name }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Networks</span><span class="diff-line del">-nzbthrottle_docker_networks_alias: &quot;{{ nzbthrottle_name }}&quot;</span><span class="diff-line del">-nzbthrottle_docker_networks_default: []</span><span class="diff-line del">-nzbthrottle_docker_networks_custom: []</span><span class="diff-line del">-nzbthrottle_docker_networks: &quot;{{ docker_networks_common</span><span class="diff-line del">-                                  + nzbthrottle_docker_networks_default</span><span class="diff-line del">-                                  + nzbthrottle_docker_networks_custom }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Capabilities</span><span class="diff-line del">-nzbthrottle_docker_capabilities_default: []</span><span class="diff-line del">-nzbthrottle_docker_capabilities_custom: []</span><span class="diff-line del">-nzbthrottle_docker_capabilities: &quot;{{ nzbthrottle_docker_capabilities_default</span><span class="diff-line del">-                                      + nzbthrottle_docker_capabilities_custom }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Security Opts</span><span class="diff-line del">-nzbthrottle_docker_security_opts_default: []</span><span class="diff-line del">-nzbthrottle_docker_security_opts_custom: []</span><span class="diff-line del">-nzbthrottle_docker_security_opts: &quot;{{ nzbthrottle_docker_security_opts_default</span><span class="diff-line del">-                                      + nzbthrottle_docker_security_opts_custom }}&quot;</span><span class="diff-line add">+nzbthrottle_role_docker_networks_alias: &quot;{{ nzbthrottle_name }}&quot;</span><span class="diff-line add">+nzbthrottle_role_docker_networks_default: []</span><span class="diff-line add">+nzbthrottle_role_docker_networks_custom: []</span><span class="diff-line add">+nzbthrottle_role_docker_networks: &quot;{{ docker_networks_common</span><span class="diff-line add">+                                      + lookup(&#x27;role_var&#x27;, &#x27;_docker_networks_default&#x27;, role=&#x27;nzbthrottle&#x27;)</span><span class="diff-line add">+                                      + lookup(&#x27;role_var&#x27;, &#x27;_docker_networks_custom&#x27;, role=&#x27;nzbthrottle&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Restart Policy</span><span class="diff-line del">-nzbthrottle_docker_restart_policy: unless-stopped</span><span class="diff-line add">+nzbthrottle_role_docker_restart_policy: unless-stopped</span><span class="diff-line context"> </span><span class="diff-line context"> # State</span><span class="diff-line del">-nzbthrottle_docker_state: started</span><span class="diff-line add">+nzbthrottle_role_docker_state: started</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-256">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/nzbthrottle/tasks/subtasks/pre-install.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -13,11 +13,11 @@</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Pre-Install | Check if config exists</span><span class="diff-line context">   ansible.builtin.stat:</span><span class="diff-line del">-    path: &quot;{{ nzbthrottle_paths_config_location }}&quot;</span><span class="diff-line del">-  register: nzbthrottle_paths_config_location_stat</span><span class="diff-line add">+    path: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_config_location&#x27;, role=&#x27;nzbthrottle&#x27;) }}&quot;</span><span class="diff-line add">+  register: nzbthrottle_role_paths_config_location_stat</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Pre-Install | New config tasks</span><span class="diff-line del">-  when: (not nzbthrottle_paths_config_location_stat.stat.exists)</span><span class="diff-line add">+  when: (not nzbthrottle_role_paths_config_location_stat.stat.exists)</span><span class="diff-line context">   block:</span><span class="diff-line context">     - name: Pre-Install | Import Plex Auth Token role</span><span class="diff-line context">       ansible.builtin.include_role:</span><span class="diff-line hunk">@@ -27,7 +27,7 @@</span><span class="diff-line context">     - name: Pre-Install | Import default config</span><span class="diff-line context">       ansible.builtin.template:</span><span class="diff-line context">         src: &#x27;config.json.j2&#x27;</span><span class="diff-line del">-        dest: &quot;{{ nzbthrottle_paths_config_location }}&quot;</span><span class="diff-line add">+        dest: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_config_location&#x27;, role=&#x27;nzbthrottle&#x27;) }}&quot;</span><span class="diff-line context">         owner: &quot;{{ user.name }}&quot;</span><span class="diff-line context">         group: &quot;{{ user.name }}&quot;</span><span class="diff-line context">         mode: &quot;0664&quot;</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-257">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/nzbthrottle/templates/config.json.j2</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -1,13 +1,13 @@</span><span class="diff-line context"> {</span><span class="diff-line context">   &quot;plex&quot;: {</span><span class="diff-line del">-    &quot;url&quot;: &quot;{{ plex_web_url }}&quot;,</span><span class="diff-line add">+    &quot;url&quot;: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_web_url&#x27;, role=&#x27;plex&#x27;) }}&quot;,</span><span class="diff-line context">     &quot;interval&quot;: 60,</span><span class="diff-line context">     &quot;token&quot;: &quot;{{ plex_auth_token | default(&#x27;&#x27;) }}&quot;</span><span class="diff-line context">   },</span><span class="diff-line context">   &quot;nzbget&quot;: {</span><span class="diff-line context">     &quot;username&quot;: &quot;{{ user.name }}&quot;,</span><span class="diff-line context">     &quot;password&quot;: &quot;{{ user.pass }}&quot;,</span><span class="diff-line del">-    &quot;url&quot;: &quot;http://nzbget:6789&quot;,</span><span class="diff-line add">+    &quot;url&quot;: &quot;http://{{ nzbget_name }}:6789&quot;,</span><span class="diff-line context">     &quot;speeds&quot;: {</span><span class="diff-line context">       &quot;1&quot;: 50000,</span><span class="diff-line context">       &quot;2&quot;: 40000,</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-258">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/organizr/defaults/main.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -18,135 +18,90 @@</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line context"> organizr_branch: &quot;v2-master&quot;</span><span class="diff-line del">-organizr_fpm: &quot;yes&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # Paths</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-organizr_paths_folder: &quot;{{ organizr_name }}&quot;</span><span class="diff-line del">-organizr_paths_location: &quot;{{ server_appdata_path }}/{{ organizr_paths_folder }}&quot;</span><span class="diff-line del">-organizr_paths_folders_list:</span><span class="diff-line del">-  - &quot;{{ organizr_paths_location }}&quot;</span><span class="diff-line add">+organizr_role_paths_folder: &quot;{{ organizr_name }}&quot;</span><span class="diff-line add">+organizr_role_paths_location: &quot;{{ server_appdata_path }}/{{ organizr_role_paths_folder }}&quot;</span><span class="diff-line add">+organizr_role_paths_folders_list:</span><span class="diff-line add">+  - &quot;{{ organizr_role_paths_location }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # Web</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-organizr_web_subdomain: &quot;{{ organizr_name }}&quot;</span><span class="diff-line del">-organizr_web_domain: &quot;{{ user.domain }}&quot;</span><span class="diff-line del">-organizr_web_port: &quot;80&quot;</span><span class="diff-line del">-organizr_web_url: &quot;{{ &#x27;https://&#x27; + (organizr_web_subdomain + &#x27;.&#x27; + organizr_web_domain</span><span class="diff-line del">-                   if (organizr_web_subdomain | length &gt; 0)</span><span class="diff-line del">-                   else organizr_web_domain) }}&quot;</span><span class="diff-line add">+organizr_role_web_subdomain: &quot;{{ organizr_name }}&quot;</span><span class="diff-line add">+organizr_role_web_domain: &quot;{{ user.domain }}&quot;</span><span class="diff-line add">+organizr_role_web_port: &quot;80&quot;</span><span class="diff-line add">+organizr_role_web_url: &quot;{{ &#x27;https://&#x27; + (lookup(&#x27;role_var&#x27;, &#x27;_web_subdomain&#x27;, role=&#x27;organizr&#x27;) + &#x27;.&#x27; + lookup(&#x27;role_var&#x27;, &#x27;_web_domain&#x27;, role=&#x27;organizr&#x27;)</span><span class="diff-line add">+                        if (lookup(&#x27;role_var&#x27;, &#x27;_web_subdomain&#x27;, role=&#x27;organizr&#x27;) | length &gt; 0)</span><span class="diff-line add">+                        else lookup(&#x27;role_var&#x27;, &#x27;_web_domain&#x27;, role=&#x27;organizr&#x27;)) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # DNS</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-organizr_dns_record: &quot;{{ organizr_web_subdomain }}&quot;</span><span class="diff-line del">-organizr_dns_zone: &quot;{{ organizr_web_domain }}&quot;</span><span class="diff-line del">-organizr_dns_proxy: &quot;{{ dns.proxied }}&quot;</span><span class="diff-line add">+organizr_role_dns_record: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_web_subdomain&#x27;, role=&#x27;organizr&#x27;) }}&quot;</span><span class="diff-line add">+organizr_role_dns_zone: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_web_domain&#x27;, role=&#x27;organizr&#x27;) }}&quot;</span><span class="diff-line add">+organizr_role_dns_proxy: &quot;{{ dns_proxied }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # Traefik</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-organizr_traefik_sso_middleware: &quot;&quot;</span><span class="diff-line del">-organizr_traefik_middleware_default: &quot;{{ traefik_default_middleware }}&quot;</span><span class="diff-line del">-organizr_traefik_middleware_custom: &quot;&quot;</span><span class="diff-line del">-organizr_traefik_certresolver: &quot;{{ traefik_default_certresolver }}&quot;</span><span class="diff-line del">-organizr_traefik_enabled: true</span><span class="diff-line del">-organizr_traefik_api_enabled: false</span><span class="diff-line del">-organizr_traefik_api_endpoint: &quot;&quot;</span><span class="diff-line add">+organizr_role_traefik_sso_middleware: &quot;&quot;</span><span class="diff-line add">+organizr_role_traefik_middleware_default: &quot;{{ traefik_default_middleware }}&quot;</span><span class="diff-line add">+organizr_role_traefik_middleware_custom: &quot;&quot;</span><span class="diff-line add">+organizr_role_traefik_certresolver: &quot;{{ traefik_default_certresolver }}&quot;</span><span class="diff-line add">+organizr_role_traefik_enabled: true</span><span class="diff-line add">+organizr_role_traefik_api_enabled: false</span><span class="diff-line add">+organizr_role_traefik_api_endpoint: &quot;&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # Docker</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line context"> # Container</span><span class="diff-line del">-organizr_docker_container: &quot;{{ organizr_name }}&quot;</span><span class="diff-line add">+organizr_role_docker_container: &quot;{{ organizr_name }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Image</span><span class="diff-line del">-organizr_docker_image_pull: true</span><span class="diff-line del">-organizr_docker_image_tag: &quot;latest&quot;</span><span class="diff-line del">-organizr_docker_image: &quot;organizr/organizr:{{ organizr_docker_image_tag }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Ports</span><span class="diff-line del">-organizr_docker_ports_defaults: []</span><span class="diff-line del">-organizr_docker_ports_custom: []</span><span class="diff-line del">-organizr_docker_ports: &quot;{{ organizr_docker_ports_defaults</span><span class="diff-line del">-                           + organizr_docker_ports_custom }}&quot;</span><span class="diff-line add">+organizr_role_docker_image_pull: true</span><span class="diff-line add">+organizr_role_docker_image_repo: &quot;organizr/organizr&quot;</span><span class="diff-line add">+organizr_role_docker_image_tag: &quot;latest&quot;</span><span class="diff-line add">+organizr_role_docker_image: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_image_repo&#x27;, role=&#x27;organizr&#x27;) }}:{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_image_tag&#x27;, role=&#x27;organizr&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Envs</span><span class="diff-line del">-organizr_docker_envs_default:</span><span class="diff-line add">+organizr_role_docker_envs_default:</span><span class="diff-line context">   PUID: &quot;{{ uid }}&quot;</span><span class="diff-line context">   PGID: &quot;{{ gid }}&quot;</span><span class="diff-line context">   TZ: &quot;{{ tz }}&quot;</span><span class="diff-line del">-  fpm: &quot;{{ organizr_fpm }}&quot;</span><span class="diff-line context">   branch: &quot;{{ organizr_branch }}&quot;</span><span class="diff-line del">-organizr_docker_envs_custom: {}</span><span class="diff-line del">-organizr_docker_envs: &quot;{{ organizr_docker_envs_default</span><span class="diff-line del">-                          | combine(organizr_docker_envs_custom) }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Commands</span><span class="diff-line del">-organizr_docker_commands_default: []</span><span class="diff-line del">-organizr_docker_commands_custom: []</span><span class="diff-line del">-organizr_docker_commands: &quot;{{ organizr_docker_commands_default</span><span class="diff-line del">-                              + organizr_docker_commands_custom }}&quot;</span><span class="diff-line add">+organizr_role_docker_envs_custom: {}</span><span class="diff-line add">+organizr_role_docker_envs: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_envs_default&#x27;, role=&#x27;organizr&#x27;)</span><span class="diff-line add">+                               | combine(lookup(&#x27;role_var&#x27;, &#x27;_docker_envs_custom&#x27;, role=&#x27;organizr&#x27;)) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Volumes</span><span class="diff-line del">-organizr_docker_volumes_default:</span><span class="diff-line del">-  - &quot;{{ organizr_paths_location }}:/config&quot;</span><span class="diff-line del">-organizr_docker_volumes_custom: []</span><span class="diff-line del">-organizr_docker_volumes: &quot;{{ organizr_docker_volumes_default</span><span class="diff-line del">-                             + organizr_docker_volumes_custom }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Devices</span><span class="diff-line del">-organizr_docker_devices_default: []</span><span class="diff-line del">-organizr_docker_devices_custom: []</span><span class="diff-line del">-organizr_docker_devices: &quot;{{ organizr_docker_devices_default</span><span class="diff-line del">-                             + organizr_docker_devices_custom }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Hosts</span><span class="diff-line del">-organizr_docker_hosts_default: {}</span><span class="diff-line del">-organizr_docker_hosts_custom: {}</span><span class="diff-line del">-organizr_docker_hosts: &quot;{{ docker_hosts_common</span><span class="diff-line del">-                           | combine(organizr_docker_hosts_default)</span><span class="diff-line del">-                           | combine(organizr_docker_hosts_custom) }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Labels</span><span class="diff-line del">-organizr_docker_labels_default: {}</span><span class="diff-line del">-organizr_docker_labels_custom: {}</span><span class="diff-line del">-organizr_docker_labels: &quot;{{ docker_labels_common</span><span class="diff-line del">-                            | combine(organizr_docker_labels_default)</span><span class="diff-line del">-                            | combine(organizr_docker_labels_custom) }}&quot;</span><span class="diff-line add">+organizr_role_docker_volumes_default:</span><span class="diff-line add">+  - &quot;{{ organizr_role_paths_location }}:/config&quot;</span><span class="diff-line add">+organizr_role_docker_volumes_custom: []</span><span class="diff-line add">+organizr_role_docker_volumes: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_volumes_default&#x27;, role=&#x27;organizr&#x27;)</span><span class="diff-line add">+                                  + lookup(&#x27;role_var&#x27;, &#x27;_docker_volumes_custom&#x27;, role=&#x27;organizr&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Hostname</span><span class="diff-line del">-organizr_docker_hostname: &quot;{{ organizr_name }}&quot;</span><span class="diff-line add">+organizr_role_docker_hostname: &quot;{{ organizr_name }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Networks</span><span class="diff-line del">-organizr_docker_networks_alias: &quot;{{ organizr_name }}&quot;</span><span class="diff-line del">-organizr_docker_networks_default: []</span><span class="diff-line del">-organizr_docker_networks_custom: []</span><span class="diff-line del">-organizr_docker_networks: &quot;{{ docker_networks_common</span><span class="diff-line del">-                              + organizr_docker_networks_default</span><span class="diff-line del">-                              + organizr_docker_networks_custom }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Capabilities</span><span class="diff-line del">-organizr_docker_capabilities_default: []</span><span class="diff-line del">-organizr_docker_capabilities_custom: []</span><span class="diff-line del">-organizr_docker_capabilities: &quot;{{ organizr_docker_capabilities_default</span><span class="diff-line del">-                                  + organizr_docker_capabilities_custom }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Security Opts</span><span class="diff-line del">-organizr_docker_security_opts_default: []</span><span class="diff-line del">-organizr_docker_security_opts_custom: []</span><span class="diff-line del">-organizr_docker_security_opts: &quot;{{ organizr_docker_security_opts_default</span><span class="diff-line del">-                                   + organizr_docker_security_opts_custom }}&quot;</span><span class="diff-line add">+organizr_role_docker_networks_alias: &quot;{{ organizr_name }}&quot;</span><span class="diff-line add">+organizr_role_docker_networks_default: []</span><span class="diff-line add">+organizr_role_docker_networks_custom: []</span><span class="diff-line add">+organizr_role_docker_networks: &quot;{{ docker_networks_common</span><span class="diff-line add">+                                   + lookup(&#x27;role_var&#x27;, &#x27;_docker_networks_default&#x27;, role=&#x27;organizr&#x27;)</span><span class="diff-line add">+                                   + lookup(&#x27;role_var&#x27;, &#x27;_docker_networks_custom&#x27;, role=&#x27;organizr&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Restart Policy</span><span class="diff-line del">-organizr_docker_restart_policy: unless-stopped</span><span class="diff-line add">+organizr_role_docker_restart_policy: unless-stopped</span><span class="diff-line context"> </span><span class="diff-line context"> # State</span><span class="diff-line del">-organizr_docker_state: started</span><span class="diff-line add">+organizr_role_docker_state: started</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-259">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/organizr/tasks/main.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -11,9 +11,9 @@</span><span class="diff-line context"> - name: Add DNS record</span><span class="diff-line context">   ansible.builtin.include_tasks: &quot;{{ resources_tasks_path }}/dns/tasker.yml&quot;</span><span class="diff-line context">   vars:</span><span class="diff-line del">-    dns_record: &quot;{{ lookup(&#x27;vars&#x27;, role_name + &#x27;_dns_record&#x27;) }}&quot;</span><span class="diff-line del">-    dns_zone: &quot;{{ lookup(&#x27;vars&#x27;, role_name + &#x27;_dns_zone&#x27;) }}&quot;</span><span class="diff-line del">-    dns_proxy: &quot;{{ lookup(&#x27;vars&#x27;, role_name + &#x27;_dns_proxy&#x27;) }}&quot;</span><span class="diff-line add">+    dns_record: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_dns_record&#x27;) }}&quot;</span><span class="diff-line add">+    dns_zone: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_dns_zone&#x27;) }}&quot;</span><span class="diff-line add">+    dns_proxy: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_dns_proxy&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Remove existing Docker container</span><span class="diff-line context">   ansible.builtin.include_tasks: &quot;{{ resources_tasks_path }}/docker/remove_docker_container.yml&quot;</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-260">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/overseerr/defaults/main.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -17,162 +17,119 @@</span><span class="diff-line context"> # Settings</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-overseerr_log_level: &quot;info&quot;</span><span class="diff-line add">+overseerr_role_log_level: &quot;info&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # Paths</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-overseerr_paths_folder: &quot;{{ overseerr_name }}&quot;</span><span class="diff-line del">-overseerr_paths_location: &quot;{{ server_appdata_path }}/{{ overseerr_paths_folder }}&quot;</span><span class="diff-line del">-overseerr_paths_cache: &quot;{{ overseerr_paths_location }}/cache&quot;</span><span class="diff-line del">-overseerr_paths_folders_list:</span><span class="diff-line del">-  - &quot;{{ overseerr_paths_location }}&quot;</span><span class="diff-line del">-  - &quot;{{ overseerr_paths_cache }}&quot;</span><span class="diff-line del">-overseerr_paths_config_location: &quot;{{ overseerr_paths_location }}/settings.json&quot;</span><span class="diff-line add">+overseerr_role_paths_folder: &quot;{{ overseerr_name }}&quot;</span><span class="diff-line add">+overseerr_role_paths_location: &quot;{{ server_appdata_path }}/{{ overseerr_role_paths_folder }}&quot;</span><span class="diff-line add">+overseerr_role_paths_cache: &quot;{{ overseerr_role_paths_location }}/cache&quot;</span><span class="diff-line add">+overseerr_role_paths_folders_list:</span><span class="diff-line add">+  - &quot;{{ overseerr_role_paths_location }}&quot;</span><span class="diff-line add">+  - &quot;{{ overseerr_role_paths_cache }}&quot;</span><span class="diff-line add">+overseerr_role_paths_config_location: &quot;{{ overseerr_role_paths_location }}/settings.json&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # Web</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-overseerr_web_subdomain: &quot;{{ overseerr_name }}&quot;</span><span class="diff-line del">-overseerr_web_domain: &quot;{{ user.domain }}&quot;</span><span class="diff-line del">-overseerr_web_port: &quot;5055&quot;</span><span class="diff-line del">-overseerr_web_url: &quot;{{ &#x27;https://&#x27; + (lookup(&#x27;vars&#x27;, overseerr_name + &#x27;_web_subdomain&#x27;, default=overseerr_web_subdomain) + &#x27;.&#x27; + lookup(&#x27;vars&#x27;, overseerr_name + &#x27;_web_domain&#x27;, default=overseerr_web_domain)</span><span class="diff-line del">-                    if (lookup(&#x27;vars&#x27;, overseerr_name + &#x27;_web_subdomain&#x27;, default=overseerr_web_subdomain) | length &gt; 0)</span><span class="diff-line del">-                    else lookup(&#x27;vars&#x27;, overseerr_name + &#x27;_web_domain&#x27;, default=overseerr_web_domain)) }}&quot;</span><span class="diff-line add">+overseerr_role_web_subdomain: &quot;{{ overseerr_name }}&quot;</span><span class="diff-line add">+overseerr_role_web_domain: &quot;{{ user.domain }}&quot;</span><span class="diff-line add">+overseerr_role_web_port: &quot;5055&quot;</span><span class="diff-line add">+overseerr_role_web_url: &quot;{{ &#x27;https://&#x27; + (lookup(&#x27;role_var&#x27;, &#x27;_web_subdomain&#x27;, role=&#x27;overseerr&#x27;) + &#x27;.&#x27; + lookup(&#x27;role_var&#x27;, &#x27;_web_domain&#x27;, role=&#x27;overseerr&#x27;)</span><span class="diff-line add">+                         if (lookup(&#x27;role_var&#x27;, &#x27;_web_subdomain&#x27;, role=&#x27;overseerr&#x27;) | length &gt; 0)</span><span class="diff-line add">+                         else lookup(&#x27;role_var&#x27;, &#x27;_web_domain&#x27;, role=&#x27;overseerr&#x27;)) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # DNS</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-overseerr_dns_record: &quot;{{ lookup(&#x27;vars&#x27;, overseerr_name + &#x27;_web_subdomain&#x27;, default=overseerr_web_subdomain) }}&quot;</span><span class="diff-line del">-overseerr_dns_zone: &quot;{{ lookup(&#x27;vars&#x27;, overseerr_name + &#x27;_web_domain&#x27;, default=overseerr_web_domain) }}&quot;</span><span class="diff-line del">-overseerr_dns_proxy: &quot;{{ dns.proxied }}&quot;</span><span class="diff-line add">+overseerr_role_dns_record: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_web_subdomain&#x27;, role=&#x27;overseerr&#x27;) }}&quot;</span><span class="diff-line add">+overseerr_role_dns_zone: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_web_domain&#x27;, role=&#x27;overseerr&#x27;) }}&quot;</span><span class="diff-line add">+overseerr_role_dns_proxy: &quot;{{ dns_proxied }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # Traefik</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-overseerr_traefik_sso_middleware: &quot;&quot;</span><span class="diff-line del">-overseerr_traefik_middleware_default: &quot;{{ traefik_default_middleware</span><span class="diff-line del">-                                          + (&#x27;,themepark-&#x27; + lookup(&#x27;vars&#x27;, overseerr_name + &#x27;_name&#x27;, default=overseerr_name)</span><span class="diff-line del">-                                            if (overseerr_themepark_enabled and global_themepark_plugin_enabled)</span><span class="diff-line del">-                                            else &#x27;&#x27;) }}&quot;</span><span class="diff-line del">-overseerr_traefik_middleware_custom: &quot;&quot;</span><span class="diff-line del">-overseerr_traefik_certresolver: &quot;{{ traefik_default_certresolver }}&quot;</span><span class="diff-line del">-overseerr_traefik_enabled: true</span><span class="diff-line del">-overseerr_traefik_api_enabled: false</span><span class="diff-line del">-overseerr_traefik_api_endpoint: &quot;&quot;</span><span class="diff-line add">+overseerr_role_traefik_sso_middleware: &quot;&quot;</span><span class="diff-line add">+overseerr_role_traefik_middleware_default: &quot;{{ traefik_default_middleware</span><span class="diff-line add">+                                               + (&#x27;,themepark-&#x27; + overseerr_name</span><span class="diff-line add">+                                                 if (lookup(&#x27;role_var&#x27;, &#x27;_themepark_enabled&#x27;, role=&#x27;overseerr&#x27;) and global_themepark_plugin_enabled)</span><span class="diff-line add">+                                                 else &#x27;&#x27;) }}&quot;</span><span class="diff-line add">+overseerr_role_traefik_middleware_custom: &quot;&quot;</span><span class="diff-line add">+overseerr_role_traefik_certresolver: &quot;{{ traefik_default_certresolver }}&quot;</span><span class="diff-line add">+overseerr_role_traefik_enabled: true</span><span class="diff-line add">+overseerr_role_traefik_api_enabled: false</span><span class="diff-line add">+overseerr_role_traefik_api_endpoint: &quot;&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line del">-# THEME</span><span class="diff-line add">+# Theme</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line context"> # Options can be found at https://github.com/themepark-dev/theme.park</span><span class="diff-line del">-overseerr_themepark_enabled: false</span><span class="diff-line del">-overseerr_themepark_app: &quot;overseerr&quot;</span><span class="diff-line del">-overseerr_themepark_theme: &quot;{{ global_themepark_theme }}&quot;</span><span class="diff-line del">-overseerr_themepark_domain: &quot;{{ global_themepark_domain }}&quot;</span><span class="diff-line del">-overseerr_themepark_addons: []</span><span class="diff-line add">+overseerr_role_themepark_enabled: false</span><span class="diff-line add">+overseerr_role_themepark_app: &quot;overseerr&quot;</span><span class="diff-line add">+overseerr_role_themepark_theme: &quot;{{ global_themepark_theme }}&quot;</span><span class="diff-line add">+overseerr_role_themepark_domain: &quot;{{ global_themepark_domain }}&quot;</span><span class="diff-line add">+overseerr_role_themepark_addons: []</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # Docker</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line context"> # Container</span><span class="diff-line del">-overseerr_docker_container: &quot;{{ overseerr_name }}&quot;</span><span class="diff-line add">+overseerr_role_docker_container: &quot;{{ overseerr_name }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Image</span><span class="diff-line del">-overseerr_docker_image_pull: true</span><span class="diff-line del">-overseerr_docker_image_repo: &quot;sctx/overseerr&quot;</span><span class="diff-line del">-overseerr_docker_image_tag: &quot;latest&quot;</span><span class="diff-line del">-overseerr_docker_image: &quot;{{ lookup(&#x27;vars&#x27;, overseerr_name + &#x27;_docker_image_repo&#x27;, default=overseerr_docker_image_repo)</span><span class="diff-line del">-                            + &#x27;:&#x27; + lookup(&#x27;vars&#x27;, overseerr_name + &#x27;_docker_image_tag&#x27;, default=overseerr_docker_image_tag) }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Ports</span><span class="diff-line del">-overseerr_docker_ports_defaults: []</span><span class="diff-line del">-overseerr_docker_ports_custom: []</span><span class="diff-line del">-overseerr_docker_ports: &quot;{{ lookup(&#x27;vars&#x27;, overseerr_name + &#x27;_docker_ports_defaults&#x27;, default=overseerr_docker_ports_defaults)</span><span class="diff-line del">-                            + lookup(&#x27;vars&#x27;, overseerr_name + &#x27;_docker_ports_custom&#x27;, default=overseerr_docker_ports_custom) }}&quot;</span><span class="diff-line add">+overseerr_role_docker_image_pull: true</span><span class="diff-line add">+overseerr_role_docker_image_repo: &quot;sctx/overseerr&quot;</span><span class="diff-line add">+overseerr_role_docker_image_tag: &quot;latest&quot;</span><span class="diff-line add">+overseerr_role_docker_image: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_image_repo&#x27;, role=&#x27;overseerr&#x27;) }}:{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_image_tag&#x27;, role=&#x27;overseerr&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Envs</span><span class="diff-line del">-overseerr_docker_envs_default:</span><span class="diff-line add">+overseerr_role_docker_envs_default:</span><span class="diff-line context">   UMASK: &quot;002&quot;</span><span class="diff-line context">   TZ: &quot;{{ tz }}&quot;</span><span class="diff-line del">-  LOG_LEVEL: &quot;{{ overseerr_log_level }}&quot;</span><span class="diff-line del">-overseerr_docker_envs_custom: {}</span><span class="diff-line del">-overseerr_docker_envs: &quot;{{ lookup(&#x27;vars&#x27;, overseerr_name + &#x27;_docker_envs_default&#x27;, default=overseerr_docker_envs_default)</span><span class="diff-line del">-                           | combine(lookup(&#x27;vars&#x27;, overseerr_name + &#x27;_docker_envs_custom&#x27;, default=overseerr_docker_envs_custom)) }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Commands</span><span class="diff-line del">-overseerr_docker_commands_default: []</span><span class="diff-line del">-overseerr_docker_commands_custom: []</span><span class="diff-line del">-overseerr_docker_commands: &quot;{{ lookup(&#x27;vars&#x27;, overseerr_name + &#x27;_docker_commands_default&#x27;, default=overseerr_docker_commands_default)</span><span class="diff-line del">-                               + lookup(&#x27;vars&#x27;, overseerr_name + &#x27;_docker_commands_custom&#x27;, default=overseerr_docker_commands_custom) }}&quot;</span><span class="diff-line add">+  LOG_LEVEL: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_log_level&#x27;, role=&#x27;overseerr&#x27;) }}&quot;</span><span class="diff-line add">+overseerr_role_docker_envs_custom: {}</span><span class="diff-line add">+overseerr_role_docker_envs: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_envs_default&#x27;, role=&#x27;overseerr&#x27;)</span><span class="diff-line add">+                                | combine(lookup(&#x27;role_var&#x27;, &#x27;_docker_envs_custom&#x27;, role=&#x27;overseerr&#x27;)) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Volumes</span><span class="diff-line del">-overseerr_docker_volumes_default:</span><span class="diff-line del">-  - &quot;{{ overseerr_paths_location }}:/app/config&quot;</span><span class="diff-line del">-overseerr_docker_volumes_custom: []</span><span class="diff-line del">-overseerr_docker_volumes: &quot;{{ lookup(&#x27;vars&#x27;, overseerr_name + &#x27;_docker_volumes_default&#x27;, default=overseerr_docker_volumes_default)</span><span class="diff-line del">-                              + lookup(&#x27;vars&#x27;, overseerr_name + &#x27;_docker_volumes_custom&#x27;, default=overseerr_docker_volumes_custom) }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Devices</span><span class="diff-line del">-overseerr_docker_devices_default: []</span><span class="diff-line del">-overseerr_docker_devices_custom: []</span><span class="diff-line del">-overseerr_docker_devices: &quot;{{ lookup(&#x27;vars&#x27;, overseerr_name + &#x27;_docker_devices_default&#x27;, default=overseerr_docker_devices_default)</span><span class="diff-line del">-                              + lookup(&#x27;vars&#x27;, overseerr_name + &#x27;_docker_devices_custom&#x27;, default=overseerr_docker_devices_custom) }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Hosts</span><span class="diff-line del">-overseerr_docker_hosts_default: {}</span><span class="diff-line del">-overseerr_docker_hosts_custom: {}</span><span class="diff-line del">-overseerr_docker_hosts: &quot;{{ docker_hosts_common</span><span class="diff-line del">-                            | combine(lookup(&#x27;vars&#x27;, overseerr_name + &#x27;_docker_hosts_default&#x27;, default=overseerr_docker_hosts_default))</span><span class="diff-line del">-                            | combine(lookup(&#x27;vars&#x27;, overseerr_name + &#x27;_docker_hosts_custom&#x27;, default=overseerr_docker_hosts_custom)) }}&quot;</span><span class="diff-line add">+overseerr_role_docker_volumes_default:</span><span class="diff-line add">+  - &quot;{{ overseerr_role_paths_location }}:/app/config&quot;</span><span class="diff-line add">+overseerr_role_docker_volumes_custom: []</span><span class="diff-line add">+overseerr_role_docker_volumes: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_volumes_default&#x27;, role=&#x27;overseerr&#x27;)</span><span class="diff-line add">+                                   + lookup(&#x27;role_var&#x27;, &#x27;_docker_volumes_custom&#x27;, role=&#x27;overseerr&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Labels</span><span class="diff-line del">-overseerr_docker_labels_default: {}</span><span class="diff-line del">-overseerr_docker_labels_custom: {}</span><span class="diff-line del">-overseerr_docker_labels: &quot;{{ docker_labels_common</span><span class="diff-line del">-                             | combine(lookup(&#x27;vars&#x27;, overseerr_name + &#x27;_docker_labels_default&#x27;, default=overseerr_docker_labels_default))</span><span class="diff-line del">-                             | combine((traefik_themepark_labels</span><span class="diff-line del">-                                       if (overseerr_themepark_enabled and global_themepark_plugin_enabled)</span><span class="diff-line del">-                                       else {}),</span><span class="diff-line del">-                                       lookup(&#x27;vars&#x27;, overseerr_name + &#x27;_docker_labels_custom&#x27;, default=overseerr_docker_labels_custom)) }}&quot;</span><span class="diff-line add">+overseerr_role_docker_labels_default: {}</span><span class="diff-line add">+overseerr_role_docker_labels_custom: {}</span><span class="diff-line add">+overseerr_role_docker_labels: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_labels_default&#x27;, role=&#x27;overseerr&#x27;)</span><span class="diff-line add">+                                  | combine((traefik_themepark_labels</span><span class="diff-line add">+                                            if (lookup(&#x27;role_var&#x27;, &#x27;_themepark_enabled&#x27;, role=&#x27;overseerr&#x27;) and global_themepark_plugin_enabled)</span><span class="diff-line add">+                                            else {}),</span><span class="diff-line add">+                                            lookup(&#x27;role_var&#x27;, &#x27;_docker_labels_custom&#x27;, role=&#x27;overseerr&#x27;)) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Hostname</span><span class="diff-line del">-overseerr_docker_hostname: &quot;{{ overseerr_name }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Network Mode</span><span class="diff-line del">-overseerr_docker_network_mode_default: &quot;{{ docker_networks_name_common }}&quot;</span><span class="diff-line del">-overseerr_docker_network_mode: &quot;{{ lookup(&#x27;vars&#x27;, overseerr_name + &#x27;_docker_network_mode_default&#x27;, default=overseerr_docker_network_mode_default) }}&quot;</span><span class="diff-line add">+overseerr_role_docker_hostname: &quot;{{ overseerr_name }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Networks</span><span class="diff-line del">-overseerr_docker_networks_alias: &quot;{{ overseerr_name }}&quot;</span><span class="diff-line del">-overseerr_docker_networks_default: []</span><span class="diff-line del">-overseerr_docker_networks_custom: []</span><span class="diff-line del">-overseerr_docker_networks: &quot;{{ docker_networks_common</span><span class="diff-line del">-                               + lookup(&#x27;vars&#x27;, overseerr_name + &#x27;_docker_networks_default&#x27;, default=overseerr_docker_networks_default)</span><span class="diff-line del">-                               + lookup(&#x27;vars&#x27;, overseerr_name + &#x27;_docker_networks_custom&#x27;, default=overseerr_docker_networks_custom) }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Capabilities</span><span class="diff-line del">-overseerr_docker_capabilities_default: []</span><span class="diff-line del">-overseerr_docker_capabilities_custom: []</span><span class="diff-line del">-overseerr_docker_capabilities: &quot;{{ lookup(&#x27;vars&#x27;, overseerr_name + &#x27;_docker_capabilities_default&#x27;, default=overseerr_docker_capabilities_default)</span><span class="diff-line del">-                                   + lookup(&#x27;vars&#x27;, overseerr_name + &#x27;_docker_capabilities_custom&#x27;, default=overseerr_docker_capabilities_custom) }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Security Opts</span><span class="diff-line del">-overseerr_docker_security_opts_default: []</span><span class="diff-line del">-overseerr_docker_security_opts_custom: []</span><span class="diff-line del">-overseerr_docker_security_opts: &quot;{{ lookup(&#x27;vars&#x27;, overseerr_name + &#x27;_docker_security_opts_default&#x27;, default=overseerr_docker_security_opts_default)</span><span class="diff-line del">-                                    + lookup(&#x27;vars&#x27;, overseerr_name + &#x27;_docker_security_opts_custom&#x27;, default=overseerr_docker_security_opts_custom) }}&quot;</span><span class="diff-line add">+overseerr_role_docker_networks_alias: &quot;{{ overseerr_name }}&quot;</span><span class="diff-line add">+overseerr_role_docker_networks_default: []</span><span class="diff-line add">+overseerr_role_docker_networks_custom: []</span><span class="diff-line add">+overseerr_role_docker_networks: &quot;{{ docker_networks_common</span><span class="diff-line add">+                                    + lookup(&#x27;role_var&#x27;, &#x27;_docker_networks_default&#x27;, role=&#x27;overseerr&#x27;)</span><span class="diff-line add">+                                    + lookup(&#x27;role_var&#x27;, &#x27;_docker_networks_custom&#x27;, role=&#x27;overseerr&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Restart Policy</span><span class="diff-line del">-overseerr_docker_restart_policy: unless-stopped</span><span class="diff-line add">+overseerr_role_docker_restart_policy: unless-stopped</span><span class="diff-line context"> </span><span class="diff-line context"> # State</span><span class="diff-line del">-overseerr_docker_state: started</span><span class="diff-line add">+overseerr_role_docker_state: started</span><span class="diff-line context"> </span><span class="diff-line context"> # User</span><span class="diff-line del">-overseerr_docker_user: &quot;{{ uid }}:{{ gid }}&quot;</span><span class="diff-line add">+overseerr_role_docker_user: &quot;{{ uid }}:{{ gid }}&quot;</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-261">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/overseerr/tasks/main2.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -10,9 +10,9 @@</span><span class="diff-line context"> - name: Add DNS record</span><span class="diff-line context">   ansible.builtin.include_tasks: &quot;{{ resources_tasks_path }}/dns/tasker.yml&quot;</span><span class="diff-line context">   vars:</span><span class="diff-line del">-    dns_record: &quot;{{ lookup(&#x27;vars&#x27;, role_name + &#x27;_dns_record&#x27;) }}&quot;</span><span class="diff-line del">-    dns_zone: &quot;{{ lookup(&#x27;vars&#x27;, role_name + &#x27;_dns_zone&#x27;) }}&quot;</span><span class="diff-line del">-    dns_proxy: &quot;{{ lookup(&#x27;vars&#x27;, role_name + &#x27;_dns_proxy&#x27;) }}&quot;</span><span class="diff-line add">+    dns_record: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_dns_record&#x27;) }}&quot;</span><span class="diff-line add">+    dns_zone: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_dns_zone&#x27;) }}&quot;</span><span class="diff-line add">+    dns_proxy: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_dns_proxy&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Remove existing Docker container</span><span class="diff-line context">   ansible.builtin.include_tasks: &quot;{{ resources_tasks_path }}/docker/remove_docker_container.yml&quot;</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-262">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/permissions/tasks/main.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -7,11 +7,11 @@</span><span class="diff-line context"> #                   GNU General Public License v3.0                     #</span><span class="diff-line context"> #########################################################################</span><span class="diff-line context"> ---</span><span class="diff-line del">-- name: Permissions | Recursively set permissions for &#x27;/mnt/local&#x27;</span><span class="diff-line del">-  ansible.builtin.shell: &quot;chown -R {{ user.name }}:{{ user.name }} /mnt/local&quot;</span><span class="diff-line add">+- name: Permissions | Recursively set permissions for &#x27;{{ server_local_folder_path }}&#x27;</span><span class="diff-line add">+  ansible.builtin.shell: &quot;chown -R {{ user.name }}:{{ user.name }} {{ server_local_folder_path }}&quot;</span><span class="diff-line context"> </span><span class="diff-line del">-- name: Permissions | Recursively set permissions for &#x27;/opt&#x27;</span><span class="diff-line del">-  ansible.builtin.shell: &quot;chown -R {{ user.name }}:{{ user.name }} /opt&quot;</span><span class="diff-line add">+- name: Permissions | Recursively set permissions for &#x27;{{ server_appdata_path }}&#x27;</span><span class="diff-line add">+  ansible.builtin.shell: &quot;chown -R {{ user.name }}:{{ user.name }} {{ server_appdata_path }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Permissions | Recursively set permissions for &#x27;/home/{{ user.name }}&#x27;</span><span class="diff-line context">   ansible.builtin.shell: &quot;chown -R {{ user.name }}:{{ user.name }} /home/{{ user.name }}&quot;</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-263">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/petio/defaults/main.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -17,139 +17,96 @@</span><span class="diff-line context"> # Settings</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-petio_mongodb_version: &quot;4.4&quot;</span><span class="diff-line add">+petio_role_mongodb_version: &quot;4.4&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # Paths</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-petio_paths_folder: &quot;{{ petio_name }}&quot;</span><span class="diff-line del">-petio_paths_location: &quot;{{ server_appdata_path }}/{{ petio_paths_folder }}&quot;</span><span class="diff-line del">-petio_paths_folders_list:</span><span class="diff-line del">-  - &quot;{{ petio_paths_location }}&quot;</span><span class="diff-line add">+petio_role_paths_folder: &quot;{{ petio_name }}&quot;</span><span class="diff-line add">+petio_role_paths_location: &quot;{{ server_appdata_path }}/{{ petio_role_paths_folder }}&quot;</span><span class="diff-line add">+petio_role_paths_folders_list:</span><span class="diff-line add">+  - &quot;{{ petio_role_paths_location }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # Web</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-petio_web_subdomain: &quot;{{ petio_name }}&quot;</span><span class="diff-line del">-petio_web_domain: &quot;{{ user.domain }}&quot;</span><span class="diff-line del">-petio_web_port: &quot;7777&quot;</span><span class="diff-line del">-petio_web_url: &quot;{{ &#x27;https://&#x27; + (petio_web_subdomain + &#x27;.&#x27; + petio_web_domain</span><span class="diff-line del">-                if (petio_web_subdomain | length &gt; 0)</span><span class="diff-line del">-                else petio_web_domain) }}&quot;</span><span class="diff-line add">+petio_role_web_subdomain: &quot;{{ petio_name }}&quot;</span><span class="diff-line add">+petio_role_web_domain: &quot;{{ user.domain }}&quot;</span><span class="diff-line add">+petio_role_web_port: &quot;7777&quot;</span><span class="diff-line add">+petio_role_web_url: &quot;{{ &#x27;https://&#x27; + (lookup(&#x27;role_var&#x27;, &#x27;_web_subdomain&#x27;, role=&#x27;petio&#x27;) + &#x27;.&#x27; + lookup(&#x27;role_var&#x27;, &#x27;_web_domain&#x27;, role=&#x27;petio&#x27;)</span><span class="diff-line add">+                     if (lookup(&#x27;role_var&#x27;, &#x27;_web_subdomain&#x27;, role=&#x27;petio&#x27;) | length &gt; 0)</span><span class="diff-line add">+                     else lookup(&#x27;role_var&#x27;, &#x27;_web_domain&#x27;, role=&#x27;petio&#x27;)) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # DNS</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-petio_dns_record: &quot;{{ petio_web_subdomain }}&quot;</span><span class="diff-line del">-petio_dns_zone: &quot;{{ petio_web_domain }}&quot;</span><span class="diff-line del">-petio_dns_proxy: &quot;{{ dns.proxied }}&quot;</span><span class="diff-line add">+petio_role_dns_record: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_web_subdomain&#x27;, role=&#x27;petio&#x27;) }}&quot;</span><span class="diff-line add">+petio_role_dns_zone: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_web_domain&#x27;, role=&#x27;petio&#x27;) }}&quot;</span><span class="diff-line add">+petio_role_dns_proxy: &quot;{{ dns_proxied }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # Traefik</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-petio_traefik_sso_middleware: &quot;&quot;</span><span class="diff-line del">-petio_traefik_middleware_default: &quot;{{ traefik_default_middleware }}&quot;</span><span class="diff-line del">-petio_traefik_middleware_custom: &quot;&quot;</span><span class="diff-line del">-petio_traefik_certresolver: &quot;{{ traefik_default_certresolver }}&quot;</span><span class="diff-line del">-petio_traefik_enabled: true</span><span class="diff-line del">-petio_traefik_api_enabled: false</span><span class="diff-line del">-petio_traefik_api_endpoint: &quot;&quot;</span><span class="diff-line add">+petio_role_traefik_sso_middleware: &quot;&quot;</span><span class="diff-line add">+petio_role_traefik_middleware_default: &quot;{{ traefik_default_middleware }}&quot;</span><span class="diff-line add">+petio_role_traefik_middleware_custom: &quot;&quot;</span><span class="diff-line add">+petio_role_traefik_certresolver: &quot;{{ traefik_default_certresolver }}&quot;</span><span class="diff-line add">+petio_role_traefik_enabled: true</span><span class="diff-line add">+petio_role_traefik_api_enabled: false</span><span class="diff-line add">+petio_role_traefik_api_endpoint: &quot;&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # Docker</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line context"> # Container</span><span class="diff-line del">-petio_docker_container: &quot;{{ petio_name }}&quot;</span><span class="diff-line add">+petio_role_docker_container: &quot;{{ petio_name }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Image</span><span class="diff-line del">-petio_docker_image_pull: true</span><span class="diff-line del">-petio_docker_image_tag: &quot;latest&quot;</span><span class="diff-line del">-petio_docker_image: &quot;ghcr.io/petio-team/petio:{{ petio_docker_image_tag }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Ports</span><span class="diff-line del">-petio_docker_ports_defaults: []</span><span class="diff-line del">-petio_docker_ports_custom: []</span><span class="diff-line del">-petio_docker_ports: &quot;{{ petio_docker_ports_defaults</span><span class="diff-line del">-                        + petio_docker_ports_custom }}&quot;</span><span class="diff-line add">+petio_role_docker_image_pull: true</span><span class="diff-line add">+petio_role_docker_image_repo: &quot;ghcr.io/petio-team/petio&quot;</span><span class="diff-line add">+petio_role_docker_image_tag: &quot;latest&quot;</span><span class="diff-line add">+petio_role_docker_image: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_image_repo&#x27;, role=&#x27;petio&#x27;) }}:{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_image_tag&#x27;, role=&#x27;petio&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Envs</span><span class="diff-line del">-petio_docker_envs_default:</span><span class="diff-line add">+petio_role_docker_envs_default:</span><span class="diff-line context">   TZ: &quot;{{ tz }}&quot;</span><span class="diff-line del">-petio_docker_envs_custom: {}</span><span class="diff-line del">-petio_docker_envs: &quot;{{ petio_docker_envs_default</span><span class="diff-line del">-                       | combine(petio_docker_envs_custom) }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Commands</span><span class="diff-line del">-petio_docker_commands_default: []</span><span class="diff-line del">-petio_docker_commands_custom: []</span><span class="diff-line del">-petio_docker_commands: &quot;{{ petio_docker_commands_default</span><span class="diff-line del">-                           + petio_docker_commands_custom }}&quot;</span><span class="diff-line add">+petio_role_docker_envs_custom: {}</span><span class="diff-line add">+petio_role_docker_envs: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_envs_default&#x27;, role=&#x27;petio&#x27;)</span><span class="diff-line add">+                            | combine(lookup(&#x27;role_var&#x27;, &#x27;_docker_envs_custom&#x27;, role=&#x27;petio&#x27;)) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Volumes</span><span class="diff-line del">-petio_docker_volumes_default:</span><span class="diff-line del">-  - &quot;{{ petio_paths_location }}:/app/api/config&quot;</span><span class="diff-line del">-petio_docker_volumes_custom: []</span><span class="diff-line del">-petio_docker_volumes: &quot;{{ petio_docker_volumes_default</span><span class="diff-line del">-                          + petio_docker_volumes_custom }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Devices</span><span class="diff-line del">-petio_docker_devices_default: []</span><span class="diff-line del">-petio_docker_devices_custom: []</span><span class="diff-line del">-petio_docker_devices: &quot;{{ petio_docker_devices_default</span><span class="diff-line del">-                          + petio_docker_devices_custom }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Hosts</span><span class="diff-line del">-petio_docker_hosts_default: {}</span><span class="diff-line del">-petio_docker_hosts_custom: {}</span><span class="diff-line del">-petio_docker_hosts: &quot;{{ docker_hosts_common</span><span class="diff-line del">-                        | combine(petio_docker_hosts_default)</span><span class="diff-line del">-                        | combine(petio_docker_hosts_custom) }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Labels</span><span class="diff-line del">-petio_docker_labels_default: {}</span><span class="diff-line del">-petio_docker_labels_custom: {}</span><span class="diff-line del">-petio_docker_labels: &quot;{{ docker_labels_common</span><span class="diff-line del">-                         | combine(petio_docker_labels_default)</span><span class="diff-line del">-                         | combine(petio_docker_labels_custom) }}&quot;</span><span class="diff-line add">+petio_role_docker_volumes_default:</span><span class="diff-line add">+  - &quot;{{ petio_role_paths_location }}:/app/api/config&quot;</span><span class="diff-line add">+petio_role_docker_volumes_custom: []</span><span class="diff-line add">+petio_role_docker_volumes: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_volumes_default&#x27;, role=&#x27;petio&#x27;)</span><span class="diff-line add">+                               + lookup(&#x27;role_var&#x27;, &#x27;_docker_volumes_custom&#x27;, role=&#x27;petio&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Hostname</span><span class="diff-line del">-petio_docker_hostname: &quot;{{ petio_name }}&quot;</span><span class="diff-line add">+petio_role_docker_hostname: &quot;{{ petio_name }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Networks</span><span class="diff-line del">-petio_docker_networks_alias: &quot;{{ petio_name }}&quot;</span><span class="diff-line del">-petio_docker_networks_default: []</span><span class="diff-line del">-petio_docker_networks_custom: []</span><span class="diff-line del">-petio_docker_networks: &quot;{{ docker_networks_common</span><span class="diff-line del">-                           + petio_docker_networks_default</span><span class="diff-line del">-                           + petio_docker_networks_custom }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Capabilities</span><span class="diff-line del">-petio_docker_capabilities_default: []</span><span class="diff-line del">-petio_docker_capabilities_custom: []</span><span class="diff-line del">-petio_docker_capabilities: &quot;{{ petio_docker_capabilities_default</span><span class="diff-line del">-                               + petio_docker_capabilities_custom }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Security Opts</span><span class="diff-line del">-petio_docker_security_opts_default: []</span><span class="diff-line del">-petio_docker_security_opts_custom: []</span><span class="diff-line del">-petio_docker_security_opts: &quot;{{ petio_docker_security_opts_default</span><span class="diff-line del">-                                + petio_docker_security_opts_custom }}&quot;</span><span class="diff-line add">+petio_role_docker_networks_alias: &quot;{{ petio_name }}&quot;</span><span class="diff-line add">+petio_role_docker_networks_default: []</span><span class="diff-line add">+petio_role_docker_networks_custom: []</span><span class="diff-line add">+petio_role_docker_networks: &quot;{{ docker_networks_common</span><span class="diff-line add">+                                + lookup(&#x27;role_var&#x27;, &#x27;_docker_networks_default&#x27;, role=&#x27;petio&#x27;)</span><span class="diff-line add">+                                + lookup(&#x27;role_var&#x27;, &#x27;_docker_networks_custom&#x27;, role=&#x27;petio&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Restart Policy</span><span class="diff-line del">-petio_docker_restart_policy: unless-stopped</span><span class="diff-line add">+petio_role_docker_restart_policy: unless-stopped</span><span class="diff-line context"> </span><span class="diff-line context"> # State</span><span class="diff-line del">-petio_docker_state: started</span><span class="diff-line add">+petio_role_docker_state: started</span><span class="diff-line context"> </span><span class="diff-line context"> # User</span><span class="diff-line del">-petio_docker_user: &quot;{{ uid }}:{{ gid }}&quot;</span><span class="diff-line add">+petio_role_docker_user: &quot;{{ uid }}:{{ gid }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Dependencies</span><span class="diff-line del">-petio_depends_on: &quot;{{ petio_name }}-mongo&quot;</span><span class="diff-line del">-petio_depends_on_delay: &quot;0&quot;</span><span class="diff-line del">-petio_depends_on_healthchecks: &quot;false&quot;</span><span class="diff-line add">+petio_role_depends_on: &quot;{{ petio_name }}-mongo&quot;</span><span class="diff-line add">+petio_role_depends_on_delay: &quot;0&quot;</span><span class="diff-line add">+petio_role_depends_on_healthchecks: &quot;false&quot;</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-264">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/petio/tasks/main.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -13,16 +13,16 @@</span><span class="diff-line context">   vars:</span><span class="diff-line context">     mongodb_instances: [&quot;{{ petio_name }}-mongo&quot;]</span><span class="diff-line context">     mongodb_docker_env_db: &quot;{{ petio_name }}&quot;</span><span class="diff-line del">-    mongodb_docker_image_tag: &quot;{{ petio_mongodb_version }}&quot;</span><span class="diff-line add">+    mongodb_docker_image_tag: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_mongodb_version&#x27;, role=&#x27;petio&#x27;) }}&quot;</span><span class="diff-line context">     mongodb_paths_folder: &quot;{{ petio_name }}&quot;</span><span class="diff-line del">-    mongodb_paths_location: &quot;{{ server_appdata_path }}/{{ mongodb_paths_folder }}/mongodb&quot;</span><span class="diff-line add">+    mongodb_paths_location: &quot;{{ server_appdata_path }}/{{ mongodb_role_paths_folder }}/mongodb&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Add DNS record</span><span class="diff-line context">   ansible.builtin.include_tasks: &quot;{{ resources_tasks_path }}/dns/tasker.yml&quot;</span><span class="diff-line context">   vars:</span><span class="diff-line del">-    dns_record: &quot;{{ lookup(&#x27;vars&#x27;, role_name + &#x27;_dns_record&#x27;) }}&quot;</span><span class="diff-line del">-    dns_zone: &quot;{{ lookup(&#x27;vars&#x27;, role_name + &#x27;_dns_zone&#x27;) }}&quot;</span><span class="diff-line del">-    dns_proxy: &quot;{{ lookup(&#x27;vars&#x27;, role_name + &#x27;_dns_proxy&#x27;) }}&quot;</span><span class="diff-line add">+    dns_record: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_dns_record&#x27;) }}&quot;</span><span class="diff-line add">+    dns_zone: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_dns_zone&#x27;) }}&quot;</span><span class="diff-line add">+    dns_proxy: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_dns_proxy&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Remove existing Docker container</span><span class="diff-line context">   ansible.builtin.include_tasks: &quot;{{ resources_tasks_path }}/docker/remove_docker_container.yml&quot;</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-265">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/plex/defaults/main.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -17,152 +17,138 @@</span><span class="diff-line context"> # Settings</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-plex_open_main_ports: false</span><span class="diff-line del">-plex_open_local_ports: false</span><span class="diff-line del">-plex_plugin_webtools: false</span><span class="diff-line del">-plex_plugin_sub_zero: false</span><span class="diff-line del">-plex_insecure: false</span><span class="diff-line del">-plex_lan_ip: &quot;&quot;</span><span class="diff-line add">+# Do not enable globally if deploying multiple instances</span><span class="diff-line add">+plex_role_open_main_ports: false</span><span class="diff-line add">+# Do not enable globally if deploying multiple instances</span><span class="diff-line add">+plex_role_open_local_ports: false</span><span class="diff-line add">+# Disables Traefik&#x27;s HTTP to HTTPS redirect for Plex</span><span class="diff-line add">+# Allows older clients with certificate issues to connect insecurely</span><span class="diff-line add">+plex_role_insecure: false</span><span class="diff-line add">+# Adds the IP specified here to the advertised URLs Plex broadcasts to clients</span><span class="diff-line add">+# Useful to avoid traffic going through your WAN when hairpin NAT is not available</span><span class="diff-line add">+plex_role_lan_ip: &quot;&quot;</span><span class="diff-line add">+# Example value &quot;http://gluetun:8888&quot;</span><span class="diff-line add">+plex_role_auth_token_proxy: &quot;&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # Proxy</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-# For instances this works the same as usual plex2_auth_token_proxy for an instance named plex2.</span><span class="diff-line del">-plex_auth_token_proxy: &quot;&quot;</span><span class="diff-line del">-</span><span class="diff-line add">+# Do not edit or override using the inventory</span><span class="diff-line context"> plex_proxy_dict:</span><span class="diff-line del">-  http_proxy: &quot;{{ plex_proxy_lookup if (plex_proxy_lookup | length &gt; 0) else &#x27;&#x27; }}&quot;</span><span class="diff-line del">-  https_proxy: &quot;{{ plex_proxy_lookup if (plex_proxy_lookup | length &gt; 0) else &#x27;&#x27; }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Do not edit or override using the inventory</span><span class="diff-line del">-plex_proxy_lookup: &quot;{{ lookup(&#x27;vars&#x27;, plex_name + &#x27;_auth_token_proxy&#x27;, default=plex_auth_token_proxy) }}&quot;</span><span class="diff-line del">-plex_network_modes: []</span><span class="diff-line add">+  http_proxy: &quot;{{ plex_role_proxy_lookup if (plex_role_proxy_lookup | length &gt; 0) else &#x27;&#x27; }}&quot;</span><span class="diff-line add">+  https_proxy: &quot;{{ plex_role_proxy_lookup if (plex_role_proxy_lookup | length &gt; 0) else &#x27;&#x27; }}&quot;</span><span class="diff-line add">+</span><span class="diff-line add">+# Do not edit or override using the inventory</span><span class="diff-line add">+plex_role_proxy_lookup: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_auth_token_proxy&#x27;, role=&#x27;plex&#x27;) }}&quot;</span><span class="diff-line add">+# Do not edit or override using the inventory</span><span class="diff-line add">+plex_role_network_modes: []</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # Paths</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-plex_paths_folder: &quot;{{ plex_name }}&quot;</span><span class="diff-line del">-plex_paths_location: &quot;{{ server_appdata_path }}/{{ plex_paths_folder }}&quot;</span><span class="diff-line del">-plex_paths_transcodes_location: &quot;{{ transcodes_path }}/{{ plex_paths_folder }}&quot;</span><span class="diff-line del">-plex_paths_folders_list:</span><span class="diff-line del">-  - &quot;{{ plex_paths_location }}&quot;</span><span class="diff-line del">-  - &quot;{{ plex_paths_location }}/Library&quot;</span><span class="diff-line del">-  - &quot;{{ plex_paths_location }}/Library/Application Support&quot;</span><span class="diff-line del">-  - &quot;{{ plex_paths_location }}/Library/Application Support/Plex Media Server&quot;</span><span class="diff-line del">-  - &quot;{{ plex_paths_location }}/Library/Application Support/Plex Media Server/Plug-ins&quot;</span><span class="diff-line del">-  - &quot;{{ plex_paths_location }}/Library/Logs&quot;</span><span class="diff-line del">-  - &quot;{{ plex_paths_location }}/Library/Logs/Plex Media Server&quot;</span><span class="diff-line del">-  - &quot;{{ plex_paths_transcodes_location }}&quot;</span><span class="diff-line del">-plex_paths_application_support_location: &quot;{{ plex_paths_location }}/Library/Application Support/Plex Media Server&quot;</span><span class="diff-line del">-plex_paths_config_location: &quot;{{ plex_paths_application_support_location }}/Preferences.xml&quot;</span><span class="diff-line del">-plex_paths_log_location: &quot;{{ plex_paths_application_support_location }}/Logs&quot;</span><span class="diff-line del">-plex_paths_plugins_location: &quot;{{ plex_paths_application_support_location }}/Plug-ins&quot;</span><span class="diff-line del">-plex_paths_plugin_support_location: &quot;{{ plex_paths_application_support_location }}/Plug-in Support&quot;</span><span class="diff-line del">-plex_paths_db_location: &quot;{{ plex_paths_plugin_support_location }}/Databases/com.plexapp.plugins.library.db&quot;</span><span class="diff-line del">-plex_paths_db_blobs_location: &quot;{{ plex_paths_plugin_support_location }}/Databases/com.plexapp.plugins.library.blobs.db&quot;</span><span class="diff-line add">+plex_role_paths_folder: &quot;{{ plex_name }}&quot;</span><span class="diff-line add">+plex_role_paths_location: &quot;{{ server_appdata_path }}/{{ plex_role_paths_folder }}&quot;</span><span class="diff-line add">+plex_role_paths_transcodes_location: &quot;{{ transcodes_path }}/{{ plex_role_paths_folder }}&quot;</span><span class="diff-line add">+plex_role_paths_folders_list:</span><span class="diff-line add">+  - &quot;{{ plex_role_paths_location }}&quot;</span><span class="diff-line add">+  - &quot;{{ plex_role_paths_location }}/Library&quot;</span><span class="diff-line add">+  - &quot;{{ plex_role_paths_location }}/Library/Application Support&quot;</span><span class="diff-line add">+  - &quot;{{ plex_role_paths_location }}/Library/Application Support/Plex Media Server&quot;</span><span class="diff-line add">+  - &quot;{{ plex_role_paths_location }}/Library/Application Support/Plex Media Server/Plug-ins&quot;</span><span class="diff-line add">+  - &quot;{{ plex_role_paths_location }}/Library/Logs&quot;</span><span class="diff-line add">+  - &quot;{{ plex_role_paths_location }}/Library/Logs/Plex Media Server&quot;</span><span class="diff-line add">+  - &quot;{{ plex_role_paths_transcodes_location }}&quot;</span><span class="diff-line add">+plex_role_paths_application_support_location: &quot;{{ plex_role_paths_location }}/Library/Application Support/Plex Media Server&quot;</span><span class="diff-line add">+plex_role_paths_config_location: &quot;{{ plex_role_paths_application_support_location }}/Preferences.xml&quot;</span><span class="diff-line add">+plex_role_paths_log_location: &quot;{{ plex_role_paths_application_support_location }}/Logs&quot;</span><span class="diff-line add">+plex_role_paths_plugins_location: &quot;{{ plex_role_paths_application_support_location }}/Plug-ins&quot;</span><span class="diff-line add">+plex_role_paths_plugin_support_location: &quot;{{ plex_role_paths_application_support_location }}/Plug-in Support&quot;</span><span class="diff-line add">+plex_role_paths_db_location: &quot;{{ plex_role_paths_plugin_support_location }}/Databases/com.plexapp.plugins.library.db&quot;</span><span class="diff-line add">+plex_role_paths_db_blobs_location: &quot;{{ plex_role_paths_plugin_support_location }}/Databases/com.plexapp.plugins.library.blobs.db&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # Web</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-plex_web_subdomain: &quot;{{ plex_name }}&quot;</span><span class="diff-line del">-plex_web_domain: &quot;{{ user.domain }}&quot;</span><span class="diff-line del">-plex_web_port: &quot;32400&quot;</span><span class="diff-line del">-plex_web_scheme: &quot;https&quot;</span><span class="diff-line del">-plex_web_http_port: &quot;32400&quot;</span><span class="diff-line del">-plex_web_http_scheme: &quot;http&quot;</span><span class="diff-line del">-plex_web_url: &quot;{{ &#x27;https://&#x27; + (lookup(&#x27;vars&#x27;, plex_name + &#x27;_web_subdomain&#x27;, default=plex_web_subdomain) + &#x27;.&#x27; + lookup(&#x27;vars&#x27;, plex_name + &#x27;_web_domain&#x27;, default=plex_web_domain)</span><span class="diff-line del">-               if (lookup(&#x27;vars&#x27;, plex_name + &#x27;_web_subdomain&#x27;, default=plex_web_subdomain) | length &gt; 0)</span><span class="diff-line del">-               else lookup(&#x27;vars&#x27;, plex_name + &#x27;_web_domain&#x27;, default=plex_web_domain)) }}&quot;</span><span class="diff-line del">-plex_webtools_web_subdomain: &quot;{{ plex_name }}-webtools&quot;</span><span class="diff-line del">-plex_webtools_web_domain: &quot;{{ plex_web_domain }}&quot;</span><span class="diff-line del">-plex_webtools_web_port: &quot;33400&quot;</span><span class="diff-line del">-plex_webtools_host: &quot;{{ lookup(&#x27;vars&#x27;, plex_name + &#x27;_webtools_web_subdomain&#x27;, default=plex_webtools_web_subdomain)</span><span class="diff-line del">-                        + &#x27;.&#x27; + lookup(&#x27;vars&#x27;, plex_name + &#x27;_webtools_web_domain&#x27;, default=plex_webtools_web_domain) }}&quot;</span><span class="diff-line del">-plex_web_insecure_url: &quot;{{ &#x27;http://&#x27; + (lookup(&#x27;vars&#x27;, plex_name + &#x27;_web_subdomain&#x27;, default=plex_web_subdomain) + &#x27;.&#x27; + lookup(&#x27;vars&#x27;, plex_name + &#x27;_web_domain&#x27;, default=plex_web_domain)</span><span class="diff-line del">-                        if (lookup(&#x27;vars&#x27;, plex_name + &#x27;_web_subdomain&#x27;, default=plex_web_subdomain) | length &gt; 0)</span><span class="diff-line del">-                        else lookup(&#x27;vars&#x27;, plex_name + &#x27;_web_domain&#x27;, default=plex_web_domain)) }}&quot;</span><span class="diff-line add">+plex_role_web_subdomain: &quot;{{ plex_name }}&quot;</span><span class="diff-line add">+plex_role_web_domain: &quot;{{ user.domain }}&quot;</span><span class="diff-line add">+plex_role_web_port: &quot;32400&quot;</span><span class="diff-line add">+# Do not edit or override using the inventory</span><span class="diff-line add">+plex_role_web_scheme: &quot;https&quot;</span><span class="diff-line add">+plex_role_web_http_port: &quot;32400&quot;</span><span class="diff-line add">+# Do not edit or override using the inventory</span><span class="diff-line add">+plex_role_web_http_scheme: &quot;http&quot;</span><span class="diff-line add">+plex_role_web_url: &quot;{{ &#x27;https://&#x27; + (lookup(&#x27;role_var&#x27;, &#x27;_web_subdomain&#x27;, role=&#x27;plex&#x27;) + &#x27;.&#x27; + lookup(&#x27;role_var&#x27;, &#x27;_web_domain&#x27;, role=&#x27;plex&#x27;)</span><span class="diff-line add">+                    if (lookup(&#x27;role_var&#x27;, &#x27;_web_subdomain&#x27;, role=&#x27;plex&#x27;) | length &gt; 0)</span><span class="diff-line add">+                    else lookup(&#x27;role_var&#x27;, &#x27;_web_domain&#x27;, role=&#x27;plex&#x27;)) }}&quot;</span><span class="diff-line add">+plex_role_web_insecure_url: &quot;{{ &#x27;http://&#x27; + (lookup(&#x27;role_var&#x27;, &#x27;_web_subdomain&#x27;, role=&#x27;plex&#x27;) + &#x27;.&#x27; + lookup(&#x27;role_var&#x27;, &#x27;_web_domain&#x27;, role=&#x27;plex&#x27;)</span><span class="diff-line add">+                             if (lookup(&#x27;role_var&#x27;, &#x27;_web_subdomain&#x27;, role=&#x27;plex&#x27;) | length &gt; 0)</span><span class="diff-line add">+                             else lookup(&#x27;role_var&#x27;, &#x27;_web_domain&#x27;, role=&#x27;plex&#x27;)) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # DNS</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-plex_dns_record: &quot;{{ lookup(&#x27;vars&#x27;, plex_name + &#x27;_web_subdomain&#x27;, default=plex_web_subdomain) }}&quot;</span><span class="diff-line del">-plex_dns_zone: &quot;{{ lookup(&#x27;vars&#x27;, plex_name + &#x27;_web_domain&#x27;, default=plex_web_domain) }}&quot;</span><span class="diff-line del">-plex_dns_proxy: &quot;{{ dns.proxied }}&quot;</span><span class="diff-line del">-plex_webtools_dns_record: &quot;{{ lookup(&#x27;vars&#x27;, plex_name + &#x27;_webtools_web_subdomain&#x27;, default=plex_webtools_web_subdomain) }}&quot;</span><span class="diff-line del">-plex_webtools_dns_zone: &quot;{{ lookup(&#x27;vars&#x27;, plex_name + &#x27;_webtools_web_domain&#x27;, default=plex_webtools_web_domain) }}&quot;</span><span class="diff-line del">-plex_webtools_dns_proxy: &quot;{{ dns.proxied }}&quot;</span><span class="diff-line add">+plex_role_dns_record: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_web_subdomain&#x27;, role=&#x27;plex&#x27;) }}&quot;</span><span class="diff-line add">+plex_role_dns_zone: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_web_domain&#x27;, role=&#x27;plex&#x27;) }}&quot;</span><span class="diff-line add">+plex_role_dns_proxy: &quot;{{ dns_proxied }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # Traefik</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-plex_traefik_sso_middleware: &quot;&quot;</span><span class="diff-line del">-plex_traefik_middleware_default: &quot;{{ traefik_default_middleware</span><span class="diff-line del">-                                     + (&#x27;,themepark-&#x27; + lookup(&#x27;vars&#x27;, plex_name + &#x27;_name&#x27;, default=plex_name)</span><span class="diff-line del">-                                       if (plex_themepark_enabled and global_themepark_plugin_enabled)</span><span class="diff-line del">-                                       else &#x27;&#x27;) }}&quot;</span><span class="diff-line del">-plex_traefik_middleware_custom: &quot;&quot;</span><span class="diff-line del">-plex_traefik_certresolver: &quot;{{ traefik_default_certresolver }}&quot;</span><span class="diff-line del">-plex_traefik_enabled: true</span><span class="diff-line del">-plex_traefik_api_enabled: false</span><span class="diff-line del">-plex_traefik_api_endpoint: &quot;&quot;</span><span class="diff-line del">-plex_traefik_error_pages_enabled: false</span><span class="diff-line del">-plex_traefik_gzip_enabled: false</span><span class="diff-line del">-</span><span class="diff-line del">-plex_traefik_middleware_http: &quot;{{ &#x27;globalHeaders@file&#x27;</span><span class="diff-line del">-                               if plex_insecure</span><span class="diff-line del">-                               else traefik_default_middleware_default_http }}&quot;</span><span class="diff-line del">-plex_web_serverstransport: &quot;skipverify@file&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-plex_webtools_traefik_sso_middleware: &quot;&quot;</span><span class="diff-line del">-plex_webtools_traefik_middleware_default: &quot;{{ traefik_default_middleware</span><span class="diff-line del">-                                              + (&#x27;,&#x27; + lookup(&#x27;vars&#x27;, plex_name + &#x27;_webtools_traefik_sso_middleware&#x27;, default=plex_webtools_traefik_sso_middleware)</span><span class="diff-line del">-                                                if (lookup(&#x27;vars&#x27;, plex_name + &#x27;_webtools_traefik_sso_middleware&#x27;, default=plex_webtools_traefik_sso_middleware) | length &gt; 0)</span><span class="diff-line del">-                                                else &#x27;&#x27;) }}&quot;</span><span class="diff-line del">-plex_webtools_traefik_middleware_custom: &quot;&quot;</span><span class="diff-line del">-plex_webtools_traefik_middleware: &quot;{{ plex_webtools_traefik_middleware_default</span><span class="diff-line del">-                                      + (&#x27;,&#x27; + plex_webtools_traefik_middleware_custom</span><span class="diff-line del">-                                        if (not plex_webtools_traefik_middleware_custom.startswith(&#x27;,&#x27;) and plex_webtools_traefik_middleware_custom | length &gt; 0)</span><span class="diff-line del">-                                        else plex_webtools_traefik_middleware_custom) }}&quot;</span><span class="diff-line del">-plex_webtools_traefik_certresolver: &quot;{{ traefik_default_certresolver }}&quot;</span><span class="diff-line del">-plex_webtools_traefik_router: &quot;{{ lookup(&#x27;vars&#x27;, plex_name + &#x27;_webtools_web_subdomain&#x27;, default=plex_webtools_web_subdomain) }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-################################</span><span class="diff-line del">-# THEME</span><span class="diff-line del">-################################</span><span class="diff-line del">-</span><span class="diff-line del">-# Options can be found at https://github.com/themepark-dev/theme.park</span><span class="diff-line del">-plex_themepark_enabled: false</span><span class="diff-line del">-plex_themepark_app: &quot;plex&quot;</span><span class="diff-line del">-plex_themepark_theme: &quot;{{ global_themepark_theme }}&quot;</span><span class="diff-line del">-plex_themepark_domain: &quot;{{ global_themepark_domain }}&quot;</span><span class="diff-line del">-plex_themepark_addons: []</span><span class="diff-line add">+plex_role_traefik_sso_middleware: &quot;&quot;</span><span class="diff-line add">+plex_role_traefik_middleware_default: &quot;{{ traefik_default_middleware</span><span class="diff-line add">+                                          + (&#x27;,themepark-&#x27; + plex_name</span><span class="diff-line add">+                                            if (lookup(&#x27;role_var&#x27;, &#x27;_themepark_enabled&#x27;, role=&#x27;plex&#x27;) and global_themepark_plugin_enabled)</span><span class="diff-line add">+                                            else &#x27;&#x27;) }}&quot;</span><span class="diff-line add">+plex_role_traefik_middleware_custom: &quot;&quot;</span><span class="diff-line add">+plex_role_traefik_certresolver: &quot;{{ traefik_default_certresolver }}&quot;</span><span class="diff-line add">+plex_role_traefik_enabled: true</span><span class="diff-line add">+plex_role_traefik_api_enabled: false</span><span class="diff-line add">+plex_role_traefik_api_endpoint: &quot;&quot;</span><span class="diff-line add">+plex_role_traefik_error_pages_enabled: false</span><span class="diff-line add">+plex_role_traefik_gzip_enabled: false</span><span class="diff-line add">+plex_role_traefik_middleware_http_insecure: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_insecure&#x27;, role=&#x27;plex&#x27;) | bool }}&quot;</span><span class="diff-line add">+plex_role_web_serverstransport: &quot;skipverify@file&quot;</span><span class="diff-line add">+</span><span class="diff-line add">+################################</span><span class="diff-line add">+# Theme</span><span class="diff-line add">+################################</span><span class="diff-line add">+</span><span class="diff-line add">+plex_role_themepark_enabled: false</span><span class="diff-line add">+# Do not edit or override using the inventory</span><span class="diff-line add">+plex_role_themepark_app: &quot;plex&quot;</span><span class="diff-line add">+# Options can be found at https://docs.theme-park.dev/themes/plex/</span><span class="diff-line add">+plex_role_themepark_theme: &quot;{{ global_themepark_theme }}&quot;</span><span class="diff-line add">+# Allows you to override the url where CSS files can be found</span><span class="diff-line add">+plex_role_themepark_domain: &quot;{{ global_themepark_domain }}&quot;</span><span class="diff-line add">+# Options can be found at https://docs.theme-park.dev/themes/addons/</span><span class="diff-line add">+plex_role_themepark_addons: []</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # Docker</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line context"> # Container</span><span class="diff-line del">-plex_docker_container: &quot;{{ plex_name }}&quot;</span><span class="diff-line add">+plex_role_docker_container: &quot;{{ plex_name }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Image</span><span class="diff-line del">-plex_docker_image_pull: true</span><span class="diff-line del">-plex_docker_image_repo: &quot;plexinc/pms-docker&quot;</span><span class="diff-line del">-plex_docker_image_tag: &quot;latest&quot;</span><span class="diff-line del">-plex_docker_image: &quot;{{ lookup(&#x27;vars&#x27;, plex_name + &#x27;_docker_image_repo&#x27;, default=plex_docker_image_repo)</span><span class="diff-line del">-                       + &#x27;:&#x27; + lookup(&#x27;vars&#x27;, plex_name + &#x27;_docker_image_tag&#x27;, default=plex_docker_image_tag) }}&quot;</span><span class="diff-line add">+plex_role_docker_image_pull: true</span><span class="diff-line add">+plex_role_docker_image_repo: &quot;plexinc/pms-docker&quot;</span><span class="diff-line add">+plex_role_docker_image_tag: &quot;latest&quot;</span><span class="diff-line add">+plex_role_docker_image: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_image_repo&#x27;, role=&#x27;plex&#x27;) }}:{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_image_tag&#x27;, role=&#x27;plex&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Ports</span><span class="diff-line del">-plex_docker_ports_32400: &quot;{{ port_lookup_32400.meta.port</span><span class="diff-line del">-                          if (port_lookup_32400.meta.port is defined) and (port_lookup_32400.meta.port | trim | length &gt; 0)</span><span class="diff-line del">-                          else &#x27;32400&#x27; }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-plex_docker_ports_defaults: []</span><span class="diff-line del">-plex_docker_ports_local:</span><span class="diff-line add">+plex_role_docker_ports_32400: &quot;{{ port_lookup_32400.meta.port</span><span class="diff-line add">+                               if (port_lookup_32400.meta.port is defined) and (port_lookup_32400.meta.port | trim | length &gt; 0)</span><span class="diff-line add">+                               else &#x27;32400&#x27; }}&quot;</span><span class="diff-line add">+</span><span class="diff-line add">+plex_role_docker_ports_default: []</span><span class="diff-line add">+# Skip docs</span><span class="diff-line add">+plex_role_docker_ports_local:</span><span class="diff-line context">   - &quot;1900:1900/udp&quot;</span><span class="diff-line context">   - &quot;5353:5353/udp&quot;</span><span class="diff-line context">   - &quot;8324:8324&quot;</span><span class="diff-line hunk">@@ -170,135 +156,89 @@</span><span class="diff-line context">   - &quot;32412:32412/udp&quot;</span><span class="diff-line context">   - &quot;32414:32414/udp&quot;</span><span class="diff-line context">   - &quot;32469:32469&quot;</span><span class="diff-line del">-plex_docker_ports_ui:</span><span class="diff-line del">-  - &quot;{{ plex_docker_ports_32400 }}:{{ lookup(&#x27;vars&#x27;, plex_name + &#x27;_web_port&#x27;, default=plex_web_port) }}&quot;</span><span class="diff-line del">-plex_docker_ports_custom: []</span><span class="diff-line del">-plex_docker_ports: &quot;{{ lookup(&#x27;vars&#x27;, plex_name + &#x27;_docker_ports_defaults&#x27;, default=plex_docker_ports_defaults)</span><span class="diff-line del">-                       + lookup(&#x27;vars&#x27;, plex_name + &#x27;_docker_ports_custom&#x27;, default=plex_docker_ports_custom)</span><span class="diff-line del">-                       + (plex_docker_ports_local</span><span class="diff-line del">-                         if (lookup(&#x27;vars&#x27;, plex_name + &#x27;_open_local_ports&#x27;, default=false))</span><span class="diff-line del">-                         else [])</span><span class="diff-line del">-                       + (lookup(&#x27;vars&#x27;, plex_name + &#x27;_docker_ports_ui&#x27;, default=plex_docker_ports_ui)</span><span class="diff-line del">-                         if plex_open_main_ports</span><span class="diff-line del">-                         else []) }}&quot;</span><span class="diff-line add">+# Skip docs</span><span class="diff-line add">+plex_role_docker_ports_ui:</span><span class="diff-line add">+  - &quot;{{ plex_role_docker_ports_32400 }}:{{ lookup(&#x27;vars&#x27;, plex_name + &#x27;_web_port&#x27;, default=plex_role_web_port) }}&quot;</span><span class="diff-line add">+plex_role_docker_ports_custom: []</span><span class="diff-line add">+plex_role_docker_ports: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_ports_default&#x27;, role=&#x27;plex&#x27;)</span><span class="diff-line add">+                            + lookup(&#x27;role_var&#x27;, &#x27;_docker_ports_custom&#x27;, role=&#x27;plex&#x27;)</span><span class="diff-line add">+                            + (plex_role_docker_ports_local</span><span class="diff-line add">+                              if (lookup(&#x27;role_var&#x27;, &#x27;_open_local_ports&#x27;, role=&#x27;plex&#x27;))</span><span class="diff-line add">+                              else [])</span><span class="diff-line add">+                            + (plex_role_docker_ports_ui</span><span class="diff-line add">+                              if lookup(&#x27;role_var&#x27;, &#x27;_open_main_ports&#x27;, role=&#x27;plex&#x27;)</span><span class="diff-line add">+                              else []) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Envs</span><span class="diff-line del">-plex_docker_envs_advertise_ip_url: &quot;{{ lookup(&#x27;vars&#x27;, plex_name + &#x27;_web_url&#x27;, default=plex_web_url) + &#x27;:443,&#x27; + lookup(&#x27;vars&#x27;, plex_name + &#x27;_web_insecure_url&#x27;, default=plex_web_insecure_url) + &#x27;:80&#x27;</span><span class="diff-line del">-                                    if plex_insecure</span><span class="diff-line del">-                                    else lookup(&#x27;vars&#x27;, plex_name + &#x27;_web_url&#x27;, default=plex_web_url) + &#x27;:443&#x27; }}&quot;</span><span class="diff-line del">-plex_docker_envs_advertise_ip: &quot;{{ &#x27;http://&#x27; + plex_lan_ip + &#x27;:32400,&#x27; + lookup(&#x27;vars&#x27;, plex_name + &#x27;_docker_envs_advertise_ip_url&#x27;, default=plex_docker_envs_advertise_ip_url)</span><span class="diff-line del">-                                if (plex_lan_ip | length &gt; 0) and plex_open_main_ports</span><span class="diff-line del">-                                else lookup(&#x27;vars&#x27;, plex_name + &#x27;_docker_envs_advertise_ip_url&#x27;, default=plex_docker_envs_advertise_ip_url) }}&quot;</span><span class="diff-line del">-plex_docker_envs_default:</span><span class="diff-line add">+plex_role_docker_envs_advertise_ip_url: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_web_url&#x27;, role=&#x27;plex&#x27;) + &#x27;:443,&#x27; + lookup(&#x27;role_var&#x27;, &#x27;_web_insecure_url&#x27;, role=&#x27;plex&#x27;) + &#x27;:80&#x27;</span><span class="diff-line add">+                                         if lookup(&#x27;role_var&#x27;, &#x27;_insecure&#x27;, role=&#x27;plex&#x27;)</span><span class="diff-line add">+                                         else lookup(&#x27;role_var&#x27;, &#x27;_web_url&#x27;, role=&#x27;plex&#x27;) + &#x27;:443&#x27; }}&quot;</span><span class="diff-line add">+plex_role_docker_envs_advertise_ip: &quot;{{ &#x27;http://&#x27; + lookup(&#x27;role_var&#x27;, &#x27;_lan_ip&#x27;, role=&#x27;plex&#x27;) + &#x27;:32400,&#x27; + lookup(&#x27;role_var&#x27;, &#x27;_docker_envs_advertise_ip_url&#x27;, role=&#x27;plex&#x27;)</span><span class="diff-line add">+                                     if (lookup(&#x27;role_var&#x27;, &#x27;_lan_ip&#x27;, role=&#x27;plex&#x27;) | length &gt; 0) and lookup(&#x27;role_var&#x27;, &#x27;_open_main_ports&#x27;, role=&#x27;plex&#x27;)</span><span class="diff-line add">+                                     else lookup(&#x27;role_var&#x27;, &#x27;_docker_envs_advertise_ip_url&#x27;, role=&#x27;plex&#x27;) }}&quot;</span><span class="diff-line add">+plex_role_docker_envs_default:</span><span class="diff-line context">   PLEX_UID: &quot;{{ uid }}&quot;</span><span class="diff-line context">   PLEX_GID: &quot;{{ gid }}&quot;</span><span class="diff-line context">   PLEX_CLAIM: &quot;{{ (plex_claim_code) | default(omit) }}&quot;</span><span class="diff-line context">   CHANGE_CONFIG_DIR_OWNERSHIP: &quot;false&quot;</span><span class="diff-line context">   TZ: &quot;{{ tz }}&quot;</span><span class="diff-line del">-  ADVERTISE_IP: &quot;{{ plex_docker_envs_advertise_ip }}&quot;</span><span class="diff-line del">-plex_docker_envs_custom: {}</span><span class="diff-line del">-plex_docker_envs: &quot;{{ lookup(&#x27;vars&#x27;, plex_name + &#x27;_docker_envs_default&#x27;, default=plex_docker_envs_default)</span><span class="diff-line del">-                      | combine(lookup(&#x27;vars&#x27;, plex_name + &#x27;_docker_envs_custom&#x27;, default=plex_docker_envs_custom)) }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Commands</span><span class="diff-line del">-plex_docker_commands_default: []</span><span class="diff-line del">-plex_docker_commands_custom: []</span><span class="diff-line del">-plex_docker_commands: &quot;{{ lookup(&#x27;vars&#x27;, plex_name + &#x27;_docker_commands_default&#x27;, default=plex_docker_commands_default)</span><span class="diff-line del">-                          + lookup(&#x27;vars&#x27;, plex_name + &#x27;_docker_commands_custom&#x27;, default=plex_docker_commands_custom) }}&quot;</span><span class="diff-line add">+  ADVERTISE_IP: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_envs_advertise_ip&#x27;, role=&#x27;plex&#x27;) }}&quot;</span><span class="diff-line add">+plex_role_docker_envs_custom: {}</span><span class="diff-line add">+plex_role_docker_envs: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_envs_default&#x27;, role=&#x27;plex&#x27;)</span><span class="diff-line add">+                           | combine(lookup(&#x27;role_var&#x27;, &#x27;_docker_envs_custom&#x27;, role=&#x27;plex&#x27;)) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Volumes</span><span class="diff-line del">-plex_docker_volumes_default:</span><span class="diff-line del">-  - &quot;{{ plex_paths_location }}:/config&quot;</span><span class="diff-line add">+plex_role_docker_volumes_default:</span><span class="diff-line add">+  - &quot;{{ plex_role_paths_location }}:/config&quot;</span><span class="diff-line context">   - &quot;{{ server_appdata_path }}/scripts:/scripts&quot;</span><span class="diff-line context">   - &quot;/dev/shm:/dev/shm&quot;</span><span class="diff-line del">-  - &quot;{{ plex_paths_transcodes_location }}:/transcode&quot;</span><span class="diff-line del">-plex_docker_volumes_legacy:</span><span class="diff-line add">+  - &quot;{{ plex_role_paths_transcodes_location }}:/transcode&quot;</span><span class="diff-line add">+plex_role_docker_volumes_legacy:</span><span class="diff-line context">   - &quot;/mnt/unionfs/Media:/data&quot;</span><span class="diff-line del">-plex_docker_volumes_custom: []</span><span class="diff-line del">-plex_docker_volumes: &quot;{{ lookup(&#x27;vars&#x27;, plex_name + &#x27;_docker_volumes_default&#x27;, default=plex_docker_volumes_default)</span><span class="diff-line del">-                         + lookup(&#x27;vars&#x27;, plex_name + &#x27;_docker_volumes_custom&#x27;, default=plex_docker_volumes_custom)</span><span class="diff-line del">-                         + (lookup(&#x27;vars&#x27;, plex_name + &#x27;_docker_volumes_legacy&#x27;, default=plex_docker_volumes_legacy)</span><span class="diff-line del">-                           if docker_legacy_volume</span><span class="diff-line del">-                           else []) }}&quot;</span><span class="diff-line add">+plex_role_docker_volumes_custom: []</span><span class="diff-line add">+plex_role_docker_volumes: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_volumes_default&#x27;, role=&#x27;plex&#x27;)</span><span class="diff-line add">+                              + lookup(&#x27;role_var&#x27;, &#x27;_docker_volumes_custom&#x27;, role=&#x27;plex&#x27;)</span><span class="diff-line add">+                              + (lookup(&#x27;role_var&#x27;, &#x27;_docker_volumes_legacy&#x27;, role=&#x27;plex&#x27;)</span><span class="diff-line add">+                                if docker_legacy_volume</span><span class="diff-line add">+                                else []) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Mounts</span><span class="diff-line del">-plex_docker_mounts_default:</span><span class="diff-line add">+plex_role_docker_mounts_default:</span><span class="diff-line context">   - target: /tmp</span><span class="diff-line context">     type: tmpfs</span><span class="diff-line del">-plex_docker_mounts_custom: []</span><span class="diff-line del">-plex_docker_mounts: &quot;{{ lookup(&#x27;vars&#x27;, plex_name + &#x27;_docker_mounts_default&#x27;, default=plex_docker_mounts_default)</span><span class="diff-line del">-                        + lookup(&#x27;vars&#x27;, plex_name + &#x27;_docker_mounts_custom&#x27;, default=plex_docker_mounts_custom) }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Devices</span><span class="diff-line del">-plex_docker_devices_default: []</span><span class="diff-line del">-plex_docker_devices_custom: []</span><span class="diff-line del">-plex_docker_devices: &quot;{{ lookup(&#x27;vars&#x27;, plex_name + &#x27;_docker_devices_default&#x27;, default=plex_docker_devices_default)</span><span class="diff-line del">-                         + lookup(&#x27;vars&#x27;, plex_name + &#x27;_docker_devices_custom&#x27;, default=plex_docker_devices_custom) }}&quot;</span><span class="diff-line add">+plex_role_docker_mounts_custom: []</span><span class="diff-line add">+plex_role_docker_mounts: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_mounts_default&#x27;, role=&#x27;plex&#x27;)</span><span class="diff-line add">+                             + lookup(&#x27;role_var&#x27;, &#x27;_docker_mounts_custom&#x27;, role=&#x27;plex&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Hosts</span><span class="diff-line del">-plex_docker_hosts_default:</span><span class="diff-line add">+plex_role_docker_hosts_default:</span><span class="diff-line context">   metric.plex.tv: &quot;{{ ip_address_localhost }}&quot;</span><span class="diff-line context">   metrics.plex.tv: &quot;{{ ip_address_localhost }}&quot;</span><span class="diff-line context">   analytics.plex.tv: &quot;{{ ip_address_localhost }}&quot;</span><span class="diff-line del">-plex_docker_hosts_custom: {}</span><span class="diff-line del">-plex_docker_hosts: &quot;{{ docker_hosts_common</span><span class="diff-line del">-                       | combine(lookup(&#x27;vars&#x27;, plex_name + &#x27;_docker_hosts_default&#x27;, default=plex_docker_hosts_default))</span><span class="diff-line del">-                       | combine(lookup(&#x27;vars&#x27;, plex_name + &#x27;_docker_hosts_custom&#x27;, default=plex_docker_hosts_custom)) }}&quot;</span><span class="diff-line add">+plex_role_docker_hosts_custom: {}</span><span class="diff-line add">+plex_role_docker_hosts: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_hosts_default&#x27;, role=&#x27;plex&#x27;)</span><span class="diff-line add">+                            | combine(lookup(&#x27;role_var&#x27;, &#x27;_docker_hosts_custom&#x27;, role=&#x27;plex&#x27;)) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Labels</span><span class="diff-line del">-plex_docker_labels_default:</span><span class="diff-line del">-  - &#x27;{ &quot;traefik.http.routers.{{ plex_webtools_traefik_router }}-http.entrypoints&quot;: &quot;web&quot; }&#x27;</span><span class="diff-line del">-  - &#x27;{ &quot;traefik.http.routers.{{ plex_webtools_traefik_router }}-http.service&quot;: &quot;{{ lookup(&quot;vars&quot;, plex_name + &quot;_webtools_web_subdomain&quot;, default=plex_webtools_web_subdomain) }}&quot; }&#x27;</span><span class="diff-line del">-  - &#x27;{ &quot;traefik.http.routers.{{ plex_webtools_traefik_router }}-http.rule&quot;: &quot;Host(`{{ plex_webtools_host }}`)&quot; }&#x27;</span><span class="diff-line del">-  - &#x27;{ &quot;traefik.http.routers.{{ plex_webtools_traefik_router }}-http.middlewares&quot;: &quot;{{ traefik_default_middleware_http }}&quot; }&#x27;</span><span class="diff-line del">-  - &#x27;{ &quot;traefik.http.routers.{{ plex_webtools_traefik_router }}-http.priority&quot;: &quot;20&quot; }&#x27;</span><span class="diff-line del">-  - &#x27;{ &quot;traefik.http.routers.{{ plex_webtools_traefik_router }}.entrypoints&quot;: &quot;websecure&quot; }&#x27;</span><span class="diff-line del">-  - &#x27;{ &quot;traefik.http.routers.{{ plex_webtools_traefik_router }}.service&quot;: &quot;{{ lookup(&quot;vars&quot;, plex_name + &quot;_webtools_web_subdomain&quot;, default=plex_webtools_web_subdomain) }}&quot; }&#x27;</span><span class="diff-line del">-  - &#x27;{ &quot;traefik.http.routers.{{ plex_webtools_traefik_router }}.rule&quot;: &quot;Host(`{{ plex_webtools_host }}`)&quot; }&#x27;</span><span class="diff-line del">-  - &#x27;{ &quot;traefik.http.routers.{{ plex_webtools_traefik_router }}.tls.options&quot;: &quot;securetls@file&quot; }&#x27;</span><span class="diff-line del">-  - &#x27;{ &quot;traefik.http.routers.{{ plex_webtools_traefik_router }}.tls.certresolver&quot;: &quot;{{ plex_webtools_traefik_certresolver }}&quot; }&#x27;</span><span class="diff-line del">-  - &#x27;{ &quot;traefik.http.routers.{{ plex_webtools_traefik_router }}.middlewares&quot;: &quot;{{ plex_webtools_traefik_middleware }}&quot; }&#x27;</span><span class="diff-line del">-  - &#x27;{ &quot;traefik.http.routers.{{ plex_webtools_traefik_router }}.priority&quot;: &quot;20&quot; }&#x27;</span><span class="diff-line del">-  - &#x27;{ &quot;traefik.http.services.{{ plex_webtools_traefik_router }}.loadbalancer.server.port&quot;: &quot;{{ plex_webtools_web_port }}&quot; }&#x27;</span><span class="diff-line del">-plex_docker_labels_custom: {}</span><span class="diff-line del">-plex_docker_labels: &quot;{{ docker_labels_common</span><span class="diff-line del">-                        | combine((lookup(&#x27;vars&#x27;, plex_name + &#x27;_docker_labels_default&#x27;, default=plex_docker_labels_default)</span><span class="diff-line del">-                                  if plex_plugin_webtools</span><span class="diff-line del">-                                  else {}),</span><span class="diff-line del">-                                  (traefik_themepark_labels</span><span class="diff-line del">-                                  if (plex_themepark_enabled and global_themepark_plugin_enabled)</span><span class="diff-line del">-                                  else {}),</span><span class="diff-line del">-                                  lookup(&#x27;vars&#x27;, plex_name + &#x27;_docker_labels_custom&#x27;, default=plex_docker_labels_custom)) }}&quot;</span><span class="diff-line add">+plex_role_docker_labels_custom: {}</span><span class="diff-line add">+plex_role_docker_labels: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_labels_custom&#x27;, role=&#x27;plex&#x27;)</span><span class="diff-line add">+                             | combine((traefik_themepark_labels</span><span class="diff-line add">+                                       if (lookup(&#x27;role_var&#x27;, &#x27;_themepark_enabled&#x27;, role=&#x27;plex&#x27;) and global_themepark_plugin_enabled)</span><span class="diff-line add">+                                       else {})) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Hostname</span><span class="diff-line del">-plex_docker_hostname: &quot;{{ plex_name }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Network Mode</span><span class="diff-line del">-plex_docker_network_mode_default: &quot;{{ docker_networks_name_common }}&quot;</span><span class="diff-line del">-plex_docker_network_mode: &quot;{{ lookup(&#x27;vars&#x27;, plex_name + &#x27;_docker_network_mode_default&#x27;, default=plex_docker_network_mode_default) }}&quot;</span><span class="diff-line add">+plex_role_docker_hostname: &quot;{{ plex_name }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Networks</span><span class="diff-line del">-plex_docker_networks_alias: &quot;{{ plex_name }}&quot;</span><span class="diff-line del">-plex_docker_networks_default: []</span><span class="diff-line del">-plex_docker_networks_custom: []</span><span class="diff-line del">-plex_docker_networks: &quot;{{ docker_networks_common</span><span class="diff-line del">-                          + lookup(&#x27;vars&#x27;, plex_name + &#x27;_docker_networks_default&#x27;, default=plex_docker_networks_default)</span><span class="diff-line del">-                          + lookup(&#x27;vars&#x27;, plex_name + &#x27;_docker_networks_custom&#x27;, default=plex_docker_networks_custom) }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Capabilities</span><span class="diff-line del">-plex_docker_capabilities_default: []</span><span class="diff-line del">-plex_docker_capabilities_custom: []</span><span class="diff-line del">-plex_docker_capabilities: &quot;{{ lookup(&#x27;vars&#x27;, plex_name + &#x27;_docker_capabilities_default&#x27;, default=plex_docker_capabilities_default)</span><span class="diff-line del">-                              + lookup(&#x27;vars&#x27;, plex_name + &#x27;_docker_capabilities_custom&#x27;, default=plex_docker_capabilities_custom) }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Security Opts</span><span class="diff-line del">-plex_docker_security_opts_default: []</span><span class="diff-line del">-plex_docker_security_opts_custom: []</span><span class="diff-line del">-plex_docker_security_opts: &quot;{{ lookup(&#x27;vars&#x27;, plex_name + &#x27;_docker_security_opts_default&#x27;, default=plex_docker_security_opts_default)</span><span class="diff-line del">-                               + lookup(&#x27;vars&#x27;, plex_name + &#x27;_docker_security_opts_custom&#x27;, default=plex_docker_security_opts_custom) }}&quot;</span><span class="diff-line add">+plex_role_docker_networks_alias: &quot;{{ plex_name }}&quot;</span><span class="diff-line add">+plex_role_docker_networks_default: []</span><span class="diff-line add">+plex_role_docker_networks_custom: []</span><span class="diff-line add">+plex_role_docker_networks: &quot;{{ docker_networks_common</span><span class="diff-line add">+                               + lookup(&#x27;role_var&#x27;, &#x27;_docker_networks_default&#x27;, role=&#x27;plex&#x27;)</span><span class="diff-line add">+                               + lookup(&#x27;role_var&#x27;, &#x27;_docker_networks_custom&#x27;, role=&#x27;plex&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Restart Policy</span><span class="diff-line del">-plex_docker_restart_policy: unless-stopped</span><span class="diff-line add">+plex_role_docker_restart_policy: unless-stopped</span><span class="diff-line context"> </span><span class="diff-line context"> # State</span><span class="diff-line del">-plex_docker_state: started</span><span class="diff-line add">+plex_role_docker_state: started</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-266">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/plex/tasks/main.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -7,19 +7,19 @@</span><span class="diff-line context"> #                   GNU General Public License v3.0                     #</span><span class="diff-line context"> #########################################################################</span><span class="diff-line context"> ---</span><span class="diff-line del">-- name: Filter Plex Network Modes</span><span class="diff-line add">+- name: Filter Plex Network Modes # noqa jinja[invalid]</span><span class="diff-line context">   ansible.builtin.set_fact:</span><span class="diff-line del">-    plex_network_modes: &quot;{{ plex_network_modes + [plex_lookup] }}&quot;</span><span class="diff-line add">+    plex_role_network_modes: &quot;{{ plex_role_network_modes + [plex_lookup] }}&quot;</span><span class="diff-line context">   vars:</span><span class="diff-line context">     plex_name: &quot;{{ item }}&quot;</span><span class="diff-line del">-    plex_lookup: &quot;{{ lookup(&#x27;vars&#x27;, item + &#x27;_docker_network_mode_default&#x27;, default=lookup(&#x27;vars&#x27;, item + &#x27;_docker_network_mode&#x27;, default=plex_docker_network_mode)) }}&quot;</span><span class="diff-line add">+    plex_lookup: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_network_mode&#x27;, role=&#x27;plex&#x27;) }}&quot;</span><span class="diff-line context">   loop: &quot;{{ plex_instances }}&quot;</span><span class="diff-line context">   when: (plex_instances | length &gt; 1) and (&#x27;container:&#x27; in plex_lookup)</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Fail if non-unique entries are present</span><span class="diff-line context">   ansible.builtin.fail:</span><span class="diff-line context">     msg: &quot;At least two of your Plex instances are using the same &#x27;container:&#x27; network_mode and this will not work due to port collision.&quot;</span><span class="diff-line del">-  when: (plex_instances | length &gt; 1) and (plex_network_modes | length) != (plex_network_modes | unique | length)</span><span class="diff-line add">+  when: (plex_instances | length &gt; 1) and (plex_role_network_modes | length) != (plex_role_network_modes | unique | length)</span><span class="diff-line context"> </span><span class="diff-line context"> - name: &quot;Execute Plex roles&quot;</span><span class="diff-line context">   ansible.builtin.include_tasks: main2.yml</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-267">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/plex/tasks/main2.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -7,20 +7,20 @@</span><span class="diff-line context"> #                   GNU General Public License v3.0                     #</span><span class="diff-line context"> #########################################################################</span><span class="diff-line context"> ---</span><span class="diff-line del">-- name: Add DNS record</span><span class="diff-line del">-  ansible.builtin.include_tasks: &quot;{{ resources_tasks_path }}/dns/tasker.yml&quot;</span><span class="diff-line del">-  vars:</span><span class="diff-line del">-    dns_record: &quot;{{ lookup(&#x27;vars&#x27;, role_name + &#x27;_dns_record&#x27;) }}&quot;</span><span class="diff-line del">-    dns_zone: &quot;{{ lookup(&#x27;vars&#x27;, role_name + &#x27;_dns_zone&#x27;) }}&quot;</span><span class="diff-line del">-    dns_proxy: &quot;{{ lookup(&#x27;vars&#x27;, role_name + &#x27;_dns_proxy&#x27;) }}&quot;</span><span class="diff-line add">+- name: Ensure that ports aren&#x27;t opened when using multiple instances</span><span class="diff-line add">+  ansible.builtin.assert:</span><span class="diff-line add">+    that:</span><span class="diff-line add">+      - not plex_role_open_main_ports</span><span class="diff-line add">+      - not plex_role_open_local_ports</span><span class="diff-line add">+    fail_msg: &quot;Port opening must be disabled when using multiple Plex instances&quot;</span><span class="diff-line add">+  when: (plex_instances | length &gt; 1)</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Add DNS record</span><span class="diff-line context">   ansible.builtin.include_tasks: &quot;{{ resources_tasks_path }}/dns/tasker.yml&quot;</span><span class="diff-line context">   vars:</span><span class="diff-line del">-    dns_record: &quot;{{ lookup(&#x27;vars&#x27;, role_name + &#x27;_webtools_dns_record&#x27;) }}&quot;</span><span class="diff-line del">-    dns_zone: &quot;{{ lookup(&#x27;vars&#x27;, role_name + &#x27;_webtools_dns_zone&#x27;) }}&quot;</span><span class="diff-line del">-    dns_proxy: &quot;{{ lookup(&#x27;vars&#x27;, role_name + &#x27;_webtools_dns_proxy&#x27;) }}&quot;</span><span class="diff-line del">-  when: plex_plugin_webtools</span><span class="diff-line add">+    dns_record: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_dns_record&#x27;) }}&quot;</span><span class="diff-line add">+    dns_zone: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_dns_zone&#x27;) }}&quot;</span><span class="diff-line add">+    dns_proxy: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_dns_proxy&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Remove existing Docker container</span><span class="diff-line context">   ansible.builtin.include_tasks: &quot;{{ resources_tasks_path }}/docker/remove_docker_container.yml&quot;</span><span class="diff-line hunk">@@ -33,8 +33,8 @@</span><span class="diff-line context">     path: &quot;{{ item }}&quot;</span><span class="diff-line context">     state: absent</span><span class="diff-line context">   with_items:</span><span class="diff-line del">-    - &quot;{{ plex_paths_location }}/98-themepark&quot;</span><span class="diff-line del">-    - &quot;{{ plex_paths_location }}/99-modify-binary&quot;</span><span class="diff-line add">+    - &quot;{{ plex_role_paths_location }}/98-themepark&quot;</span><span class="diff-line add">+    - &quot;{{ plex_role_paths_location }}/99-modify-binary&quot;</span><span class="diff-line context">     - &quot;{{ server_appdata_path }}/scripts/bbe&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Plex Reset Codecs tasks</span><span class="diff-line hunk">@@ -42,9 +42,9 @@</span><span class="diff-line context">   block:</span><span class="diff-line context">     - name: Get contents of Plex Codecs Folder</span><span class="diff-line context">       ansible.builtin.find:</span><span class="diff-line del">-        paths: &quot;{{ plex_paths_application_support_location }}/Codecs&quot;</span><span class="diff-line add">+        paths: &quot;{{ plex_role_paths_application_support_location }}/Codecs&quot;</span><span class="diff-line context">         file_type: directory</span><span class="diff-line del">-        recurse: no</span><span class="diff-line add">+        recurse: false</span><span class="diff-line context">       register: plex_codecs_removal</span><span class="diff-line context"> </span><span class="diff-line context">     - name: Delete Plex Codecs Folder</span><span class="diff-line hunk">@@ -54,16 +54,16 @@</span><span class="diff-line context">       with_items: &quot;{{ plex_codecs_removal.files }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Pre-Install Tasks</span><span class="diff-line del">-  ansible.builtin.import_tasks: &quot;subtasks/pre-install/main.yml&quot;</span><span class="diff-line add">+  ansible.builtin.include_tasks: &quot;subtasks/pre-install/main.yml&quot;</span><span class="diff-line context">   when: (not continuous_integration)</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Preferences Tasks</span><span class="diff-line del">-  ansible.builtin.import_tasks: &quot;subtasks/preferences/preferences.yml&quot;</span><span class="diff-line add">+  ansible.builtin.include_tasks: &quot;subtasks/preferences/preferences.yml&quot;</span><span class="diff-line context">   when: (not continuous_integration)</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Docker Devices Task</span><span class="diff-line context">   ansible.builtin.include_tasks: &quot;{{ resources_tasks_path }}/docker/set_docker_devices_variable.yml&quot;</span><span class="diff-line del">-  when: gpu.intel or use_nvidia</span><span class="diff-line add">+  when: use_intel or use_nvidia</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Create Docker container</span><span class="diff-line context">   ansible.builtin.include_tasks: &quot;{{ resources_tasks_path }}/docker/create_docker_container.yml&quot;</span><span class="diff-line hunk">@@ -71,4 +71,4 @@</span><span class="diff-line context"> - name: &quot;Execute Plex Extra Tasks role&quot;</span><span class="diff-line context">   ansible.builtin.include_role:</span><span class="diff-line context">     name: &quot;plex_extra_tasks&quot;</span><span class="diff-line del">-  when: (plex_plugin_sub_zero or plex_plugin_webtools) and (not continuous_integration)</span><span class="diff-line add">+  when: (not continuous_integration)</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-268">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/plex/tasks/subtasks/preferences/claim_server.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -15,7 +15,7 @@</span><span class="diff-line context">   ansible.builtin.uri:</span><span class="diff-line context">     url: https://plex.tv/api/claim/token.json</span><span class="diff-line context">     method: GET</span><span class="diff-line del">-    return_content: yes</span><span class="diff-line add">+    return_content: true</span><span class="diff-line context">     body:</span><span class="diff-line context">       X-Plex-Version: &quot;{{ plex_auth_token_version }}&quot;</span><span class="diff-line context">       X-Plex-Product: &quot;{{ plex_auth_token_product }}&quot;</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-269">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/plex/tasks/subtasks/preferences/preferences.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -7,32 +7,32 @@</span><span class="diff-line context"> #                   GNU General Public License v3.0                     #</span><span class="diff-line context"> #########################################################################</span><span class="diff-line context"> ---</span><span class="diff-line del">-- name: &quot;Preferences | Check if &#x27;{{ plex_paths_config_location | basename }}&#x27; exists&quot;</span><span class="diff-line add">+- name: &quot;Preferences | Check if &#x27;{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_config_location&#x27;, role=&#x27;plex&#x27;) | basename }}&#x27; exists&quot;</span><span class="diff-line context">   ansible.builtin.stat:</span><span class="diff-line del">-    path: &quot;{{ plex_paths_config_location }}&quot;</span><span class="diff-line add">+    path: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_config_location&#x27;, role=&#x27;plex&#x27;) }}&quot;</span><span class="diff-line context">   register: preferences_xml</span><span class="diff-line context"> </span><span class="diff-line del">-- name: &quot;Preferences | &#x27;{{ plex_paths_config_location | basename }}&#x27; Tasks&quot;</span><span class="diff-line add">+- name: &quot;Preferences | &#x27;{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_config_location&#x27;, role=&#x27;plex&#x27;) | basename }}&#x27; Tasks&quot;</span><span class="diff-line context">   when: preferences_xml.stat.exists</span><span class="diff-line context">   block:</span><span class="diff-line context">     - name: &quot;Preferences | Remove existing PlexOnlineToken from Preferences.xml&quot;</span><span class="diff-line context">       ansible.builtin.replace:</span><span class="diff-line del">-        path: &quot;{{ plex_paths_config_location }}&quot;</span><span class="diff-line add">+        path: &quot;{{ plex_role_paths_config_location }}&quot;</span><span class="diff-line context">         regexp: &#x27; PlexOnlineToken=&quot;[^&quot;]*&quot;&#x27;</span><span class="diff-line context">         replace: &#x27;&#x27;</span><span class="diff-line context">       when: (&#x27;plex-reclaim&#x27; in ansible_run_tags)</span><span class="diff-line context"> </span><span class="diff-line del">-    - name: Preferences | Get &#x27;{{ plex_paths_config_location | basename }}&#x27; XML data</span><span class="diff-line add">+    - name: Preferences | Get &#x27;{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_config_location&#x27;, role=&#x27;plex&#x27;) | basename }}&#x27; XML data</span><span class="diff-line context">       community.general.xml:</span><span class="diff-line del">-        path: &quot;{{ plex_paths_config_location }}&quot;</span><span class="diff-line add">+        path: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_config_location&#x27;, role=&#x27;plex&#x27;) }}&quot;</span><span class="diff-line context">         xpath: /Preferences</span><span class="diff-line context">         content: attribute</span><span class="diff-line context">       register: preferences_xml_resp</span><span class="diff-line context">       ignore_errors: true</span><span class="diff-line context"> </span><span class="diff-line del">-    - name: &quot;Preferences | Remove &#x27;{{ plex_paths_config_location | basename }}&#x27; if malformed&quot;</span><span class="diff-line add">+    - name: &quot;Preferences | Remove &#x27;{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_config_location&#x27;, role=&#x27;plex&#x27;) | basename }}&#x27; if malformed&quot;</span><span class="diff-line context">       ansible.builtin.file:</span><span class="diff-line del">-        path: &quot;{{ plex_paths_config_location }}&quot;</span><span class="diff-line add">+        path: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_config_location&#x27;, role=&#x27;plex&#x27;) }}&quot;</span><span class="diff-line context">         state: absent</span><span class="diff-line context">       when: (preferences_xml_resp is failed)</span><span class="diff-line context"> </span><span class="diff-line hunk">@@ -44,7 +44,7 @@</span><span class="diff-line context"> </span><span class="diff-line context">     - name: &quot;Preferences | Fix &#x27;TranscoderTempDirectory&#x27;&quot;</span><span class="diff-line context">       community.general.xml:</span><span class="diff-line del">-        path: &quot;{{ plex_paths_config_location }}&quot;</span><span class="diff-line add">+        path: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_config_location&#x27;, role=&#x27;plex&#x27;) }}&quot;</span><span class="diff-line context">         xpath: /Preferences</span><span class="diff-line context">         attribute: TranscoderTempDirectory</span><span class="diff-line context">         value: &quot;/transcode&quot;</span><span class="diff-line hunk">@@ -55,7 +55,7 @@</span><span class="diff-line context"> </span><span class="diff-line context">     - name: &quot;Preferences | Set &#x27;secureConnections&#x27; to preferred&quot;</span><span class="diff-line context">       community.general.xml:</span><span class="diff-line del">-        path: &quot;{{ plex_paths_config_location }}&quot;</span><span class="diff-line add">+        path: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_config_location&#x27;, role=&#x27;plex&#x27;) }}&quot;</span><span class="diff-line context">         xpath: /Preferences</span><span class="diff-line context">         attribute: secureConnections</span><span class="diff-line context">         value: &quot;1&quot;</span><span class="diff-line hunk">@@ -70,5 +70,5 @@</span><span class="diff-line context">           (preferences_xml_resp.matches[0].Preferences.PlexOnlineToken | trim | length &gt; 0) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Preferences | Claim {{ plex_name | title }} Server</span><span class="diff-line del">-  ansible.builtin.import_tasks: &quot;claim_server.yml&quot;</span><span class="diff-line add">+  ansible.builtin.include_tasks: &quot;claim_server.yml&quot;</span><span class="diff-line context">   when: (not preferences_xml.stat.exists) or (preferences_xml.stat.exists and (not plex_server_claimed))</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-270">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/plex_auth_token/defaults/main.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -15,5 +15,11 @@</span><span class="diff-line context"> plex_auth_token_product: &quot;Saltbox&quot;</span><span class="diff-line context"> plex_auth_token_platform: &quot;Linux&quot;</span><span class="diff-line context"> plex_auth_token_platform_version: &quot;1.0.0&quot;</span><span class="diff-line del">-plex_auth_token_device: &quot;Ubuntu {{ ansible_distribution_version }} - {{ ansible_kernel }}&quot;</span><span class="diff-line add">+plex_auth_token_device: &quot;Ubuntu {{ ansible_facts[&#x27;distribution_version&#x27;] }} - {{ ansible_facts[&#x27;kernel&#x27;] }}&quot;</span><span class="diff-line context"> plex_auth_token_device_name: &quot;Saltbox&quot;</span><span class="diff-line add">+</span><span class="diff-line add">+################################</span><span class="diff-line add">+# Lookups</span><span class="diff-line add">+################################</span><span class="diff-line add">+</span><span class="diff-line add">+plex_auth_token_ini_file: &quot;{{ server_appdata_path }}/saltbox/plex.ini&quot;</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-271">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/plex_auth_token/tasks/main.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -13,7 +13,7 @@</span><span class="diff-line context"> </span><span class="diff-line context"> - name: &quot;Auth Token | Create directories&quot;</span><span class="diff-line context">   ansible.builtin.file:</span><span class="diff-line del">-    path: &quot;/opt/saltbox&quot;</span><span class="diff-line add">+    path: &quot;{{ server_appdata_path }}/saltbox&quot;</span><span class="diff-line context">     state: directory</span><span class="diff-line context">     owner: &quot;{{ user.name }}&quot;</span><span class="diff-line context">     group: &quot;{{ user.name }}&quot;</span><span class="diff-line hunk">@@ -21,7 +21,7 @@</span><span class="diff-line context"> </span><span class="diff-line context"> - name: &quot;Auth Token | Check if PIN exists&quot;</span><span class="diff-line context">   ansible.builtin.stat:</span><span class="diff-line del">-    path: &quot;/opt/saltbox/plex.ini&quot;</span><span class="diff-line add">+    path: &quot;{{ plex_auth_token_ini_file }}&quot;</span><span class="diff-line context">   register: plex_ini</span><span class="diff-line context"> </span><span class="diff-line context"> - name: &quot;Auth Token | plex_auth_client_identifier&quot;</span><span class="diff-line hunk">@@ -29,7 +29,7 @@</span><span class="diff-line context">   block:</span><span class="diff-line context">     - name: &quot;Auth Token | Lookup plex_auth_client_identifier&quot;</span><span class="diff-line context">       ansible.builtin.set_fact:</span><span class="diff-line del">-        plex_auth_client_identifier: &quot;{{ lookup(&#x27;ini&#x27;, &#x27;client_identifier section=&#x27; + plex_name + &#x27; file=/opt/saltbox/plex.ini&#x27;) }}&quot;</span><span class="diff-line add">+        plex_auth_client_identifier: &quot;{{ lookup(&#x27;ini&#x27;, &#x27;client_identifier section=&#x27; + plex_name + &#x27; file=&#x27; + plex_auth_token_ini_file) }}&quot;</span><span class="diff-line context">         plex_auth_client_identifier_missing: false</span><span class="diff-line context"> </span><span class="diff-line context">   rescue:</span><span class="diff-line hunk">@@ -45,7 +45,7 @@</span><span class="diff-line context"> </span><span class="diff-line context"> - name: &quot;Auth Token | Set plex_auth_token variable if previously saved&quot;</span><span class="diff-line context">   ansible.builtin.set_fact:</span><span class="diff-line del">-    plex_auth_token: &quot;{{ lookup(&#x27;ini&#x27;, &#x27;token section=&#x27; + plex_name + &#x27; file=/opt/saltbox/plex.ini&#x27;) | regex_replace(&#x27;\n&#x27;, &#x27;&#x27;) }}&quot;</span><span class="diff-line add">+    plex_auth_token: &quot;{{ lookup(&#x27;ini&#x27;, &#x27;token section=&#x27; + plex_name + &#x27; file=&#x27; + plex_auth_token_ini_file) | regex_replace(&#x27;\n&#x27;, &#x27;&#x27;) }}&quot;</span><span class="diff-line context">   when: plex_ini.stat.exists and (not plex_auth_client_identifier_missing)</span><span class="diff-line context"> </span><span class="diff-line context"> - name: &quot;Auth Token | Set plex_no_token status&quot;</span><span class="diff-line hunk">@@ -56,15 +56,15 @@</span><span class="diff-line context">   ansible.builtin.include_tasks: &quot;{{ resources_tasks_path }}/docker/network_container_health_status.yml&quot;</span><span class="diff-line context">   vars:</span><span class="diff-line context">     _var_prefix: &quot;plex&quot;</span><span class="diff-line del">-  when: (plex_proxy_lookup | length &gt; 0)</span><span class="diff-line add">+  when: (plex_role_proxy_lookup | length &gt; 0)</span><span class="diff-line context"> </span><span class="diff-line context"> - name: &quot;Auth Token | Check if Token is valid&quot;</span><span class="diff-line context">   ansible.builtin.uri:</span><span class="diff-line context">     url: &quot;https://plex.tv/api/v2/user&quot;</span><span class="diff-line context">     method: GET</span><span class="diff-line del">-    return_content: yes</span><span class="diff-line add">+    return_content: true</span><span class="diff-line context">     body:</span><span class="diff-line del">-      X-Plex-Token: &quot;{{ lookup(&#x27;ini&#x27;, &#x27;token section=&#x27; + plex_name + &#x27; file=/opt/saltbox/plex.ini&#x27;) }}&quot;</span><span class="diff-line add">+      X-Plex-Token: &quot;{{ lookup(&#x27;ini&#x27;, &#x27;token section=&#x27; + plex_name + &#x27; file=&#x27; + plex_auth_token_ini_file) }}&quot;</span><span class="diff-line context">       X-Plex-Version: &quot;{{ plex_auth_token_version }}&quot;</span><span class="diff-line context">       X-Plex-Product: &quot;{{ plex_auth_token_product }}&quot;</span><span class="diff-line context">       X-Plex-Client-Identifier: &quot;{{ plex_auth_client_identifier }}&quot;</span><span class="diff-line hunk">@@ -87,7 +87,7 @@</span><span class="diff-line context">       ansible.builtin.uri:</span><span class="diff-line context">         url: &quot;https://plex.tv/api/v2/pins&quot;</span><span class="diff-line context">         method: POST</span><span class="diff-line del">-        return_content: yes</span><span class="diff-line add">+        return_content: true</span><span class="diff-line context">         body:</span><span class="diff-line context">           strong: &quot;true&quot;</span><span class="diff-line context">           X-Plex-Version: &quot;{{ plex_auth_token_version }}&quot;</span><span class="diff-line hunk">@@ -112,7 +112,7 @@</span><span class="diff-line context">       ansible.builtin.uri:</span><span class="diff-line context">         url: &quot;https://plex.tv/api/v2/pins/{{ plex_pin.json.id }}&quot;</span><span class="diff-line context">         method: GET</span><span class="diff-line del">-        return_content: yes</span><span class="diff-line add">+        return_content: true</span><span class="diff-line context">         body:</span><span class="diff-line context">           X-Plex-Client-Identifier: &quot;{{ plex_auth_client_identifier }}&quot;</span><span class="diff-line context">         body_format: form-urlencoded</span><span class="diff-line hunk">@@ -130,7 +130,7 @@</span><span class="diff-line context">       ansible.builtin.uri:</span><span class="diff-line context">         url: &quot;https://plex.tv/api/v2/user&quot;</span><span class="diff-line context">         method: GET</span><span class="diff-line del">-        return_content: yes</span><span class="diff-line add">+        return_content: true</span><span class="diff-line context">         body:</span><span class="diff-line context">           X-Plex-Token: &quot;{{ plex_auth_token }}&quot;</span><span class="diff-line context">           X-Plex-Version: &quot;{{ plex_auth_token_version }}&quot;</span><span class="diff-line hunk">@@ -161,6 +161,7 @@</span><span class="diff-line context">           token: &quot;{{ plex_auth_token }}&quot;</span><span class="diff-line context">         owner: &quot;{{ user.name }}&quot;</span><span class="diff-line context">         group: &quot;{{ user.name }}&quot;</span><span class="diff-line add">+        base_path: &quot;{{ server_appdata_path }}&quot;</span><span class="diff-line context">         overwrite: true</span><span class="diff-line context"> </span><span class="diff-line context"> - name: &quot;Auth Token | Display Plex Auth Token&quot;</span><span class="diff-line hunk">@@ -169,7 +170,7 @@</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Change permissions</span><span class="diff-line context">   ansible.builtin.file:</span><span class="diff-line del">-    path: /opt/saltbox</span><span class="diff-line add">+    path: &quot;{{ server_appdata_path }}/saltbox&quot;</span><span class="diff-line context">     owner: &quot;{{ user.name }}&quot;</span><span class="diff-line context">     group: &quot;{{ user.name }}&quot;</span><span class="diff-line context">     mode: &quot;0755&quot;</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-272">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/plex_db/defaults/main.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -7,10 +7,11 @@</span><span class="diff-line context"> #                   GNU General Public License v3.0                      #</span><span class="diff-line context"> ##########################################################################</span><span class="diff-line context"> ---</span><span class="diff-line add">+plex_db_integrity_check_only: false</span><span class="diff-line add">+plex_db_failed_integrity: false</span><span class="diff-line add">+plex_db_failed_optimization: false</span><span class="diff-line add">+</span><span class="diff-line add">+# Do not enable globally if deploying multiple instances</span><span class="diff-line context"> plex_db_files:</span><span class="diff-line context">   - &quot;com.plexapp.plugins.library.db&quot;</span><span class="diff-line context">   - &quot;com.plexapp.plugins.library.blobs.db&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-plex_db_integrity_check_only: false</span><span class="diff-line del">-plex_db_failed_integrity: false</span><span class="diff-line del">-plex_db_failed_optimization: false</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-273">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/plex_db/tasks/main.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -7,19 +7,19 @@</span><span class="diff-line context"> #                   GNU General Public License v3.0                      #</span><span class="diff-line context"> ##########################################################################</span><span class="diff-line context"> ---</span><span class="diff-line del">-- name: Delete old &#x27;/opt/plexsql&#x27;</span><span class="diff-line add">+- name: &quot;Delete old &#x27;{{ server_appdata_path }}/plexsql&#x27;&quot;</span><span class="diff-line context">   ansible.builtin.file:</span><span class="diff-line del">-    path: &quot;/opt/plexsql&quot;</span><span class="diff-line add">+    path: &quot;{{ server_appdata_path }}/plexsql&quot;</span><span class="diff-line context">     state: absent</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Copy Plex Binaries out</span><span class="diff-line del">-  ansible.builtin.shell: &quot;docker cp {{ plex_instances[0] }}:/usr/lib/plexmediaserver/ /opt/plexsql&quot;</span><span class="diff-line add">+  ansible.builtin.shell: &quot;docker cp {{ plex_instances[0] }}:/usr/lib/plexmediaserver/ {{ server_appdata_path }}/plexsql&quot;</span><span class="diff-line context"> </span><span class="diff-line del">-- name: Set &#x27;/opt/plexsql&#x27; ownership recursively</span><span class="diff-line add">+- name: Set &#x27;{{ server_appdata_path }}/plexsql&#x27; ownership recursively</span><span class="diff-line context">   ansible.builtin.file:</span><span class="diff-line del">-    path: &quot;/opt/plexsql&quot;</span><span class="diff-line add">+    path: &quot;{{ server_appdata_path }}/plexsql&quot;</span><span class="diff-line context">     state: directory</span><span class="diff-line del">-    recurse: yes</span><span class="diff-line add">+    recurse: true</span><span class="diff-line context">     owner: &quot;{{ user.name }}&quot;</span><span class="diff-line context">     group: &quot;{{ user.name }}&quot;</span><span class="diff-line context"> </span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-274">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/plex_db/tasks/main2.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -7,14 +7,14 @@</span><span class="diff-line context"> #                   GNU General Public License v3.0                      #</span><span class="diff-line context"> ##########################################################################</span><span class="diff-line context"> ---</span><span class="diff-line del">-- name: &quot;Check if &#x27;{{ plex_paths_db_location | basename }}&#x27; exists&quot;</span><span class="diff-line add">+- name: &quot;Check if &#x27;{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_db_location&#x27;, role=&#x27;plex&#x27;) | basename }}&#x27; exists&quot;</span><span class="diff-line context">   ansible.builtin.stat:</span><span class="diff-line del">-    path: &quot;{{ plex_paths_db_location }}&quot;</span><span class="diff-line add">+    path: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_db_location&#x27;, role=&#x27;plex&#x27;) }}&quot;</span><span class="diff-line context">   register: plex_db</span><span class="diff-line context"> </span><span class="diff-line del">-- name: &quot;Check if &#x27;{{ plex_paths_db_blobs_location | basename }}&#x27; exists&quot;</span><span class="diff-line add">+- name: &quot;Check if &#x27;{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_db_blobs_location&#x27;, role=&#x27;plex&#x27;) | basename }}&#x27; exists&quot;</span><span class="diff-line context">   ansible.builtin.stat:</span><span class="diff-line del">-    path: &quot;{{ plex_paths_db_blobs_location }}&quot;</span><span class="diff-line add">+    path: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_db_blobs_location&#x27;, role=&#x27;plex&#x27;) }}&quot;</span><span class="diff-line context">   register: plex_db_blobs</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Fail if database does not exist</span><span class="diff-line hunk">@@ -30,12 +30,12 @@</span><span class="diff-line context"> - name: Integrity check</span><span class="diff-line context">   block:</span><span class="diff-line context">     - name: Check if main database passes integrity_check</span><span class="diff-line del">-      ansible.builtin.shell: &quot;&#x27;/opt/plexsql/Plex SQLite&#x27; &#x27;{{ plex_paths_db_location }}&#x27; &#x27;PRAGMA integrity_check(1)&#x27;&quot;</span><span class="diff-line add">+      ansible.builtin.shell: &quot;&#x27;{{ server_appdata_path }}/plexsql/Plex SQLite&#x27; &#x27;{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_db_location&#x27;, role=&#x27;plex&#x27;) }}&#x27; &#x27;PRAGMA integrity_check(1)&#x27;&quot;</span><span class="diff-line context">       register: plex_db_integrity_check</span><span class="diff-line context">       failed_when: (plex_db_integrity_check.stdout != &#x27;ok&#x27;)</span><span class="diff-line context"> </span><span class="diff-line context">     - name: Check if blobs database passes integrity_check</span><span class="diff-line del">-      ansible.builtin.shell: &quot;&#x27;/opt/plexsql/Plex SQLite&#x27; &#x27;{{ plex_paths_db_blobs_location }}&#x27; &#x27;PRAGMA integrity_check(1)&#x27;&quot;</span><span class="diff-line add">+      ansible.builtin.shell: &quot;&#x27;{{ server_appdata_path }}/plexsql/Plex SQLite&#x27; &#x27;{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_db_blobs_location&#x27;, role=&#x27;plex&#x27;) }}&#x27; &#x27;PRAGMA integrity_check(1)&#x27;&quot;</span><span class="diff-line context">       register: plex_db_blobs_integrity_check</span><span class="diff-line context">       failed_when: (plex_db_blobs_integrity_check.stdout != &#x27;ok&#x27;)</span><span class="diff-line context"> </span><span class="diff-line hunk">@@ -44,7 +44,7 @@</span><span class="diff-line context">       ansible.builtin.set_fact:</span><span class="diff-line context">         plex_db_failed_integrity: true</span><span class="diff-line context"> </span><span class="diff-line del">-    - name: &quot;Notify | Plex instance &#x27;{{ plex_name }}&#x27; failed the integrity check.&quot;</span><span class="diff-line add">+    - name: &quot;Plex instance &#x27;{{ plex_name }}&#x27; failed the integrity check.&quot;</span><span class="diff-line context">       ansible.builtin.include_role:</span><span class="diff-line context">         name: notify</span><span class="diff-line context">       vars:</span><span class="diff-line hunk">@@ -62,26 +62,26 @@</span><span class="diff-line context">         mode: &quot;0775&quot;</span><span class="diff-line context"> </span><span class="diff-line context">     - name: Backup databases</span><span class="diff-line del">-      ansible.builtin.shell: &quot;cp &#x27;{{ plex_paths_plugin_support_location }}/Databases/{{ item }}&#x27; /tmp/{{ plex_name }}_backup/&quot;</span><span class="diff-line add">+      ansible.builtin.shell: &quot;cp &#x27;{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_plugin_support_location&#x27;, role=&#x27;plex&#x27;) }}/Databases/{{ item }}&#x27; /tmp/{{ plex_name }}_backup/&quot;</span><span class="diff-line context">       loop: &quot;{{ plex_db_files }}&quot;</span><span class="diff-line context"> </span><span class="diff-line del">-    - name: &quot;Vacuum &#x27;{{ plex_paths_db_location | basename }}&#x27; database&quot;</span><span class="diff-line del">-      ansible.builtin.shell: &quot;&#x27;/opt/plexsql/Plex SQLite&#x27; &#x27;{{ plex_paths_db_location }}&#x27; &#x27;VACUUM;&#x27;&quot;</span><span class="diff-line add">+    - name: &quot;Vacuum &#x27;{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_db_location&#x27;, role=&#x27;plex&#x27;) | basename }}&#x27; database&quot;</span><span class="diff-line add">+      ansible.builtin.shell: &quot;&#x27;{{ server_appdata_path }}/plexsql/Plex SQLite&#x27; &#x27;{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_db_location&#x27;, role=&#x27;plex&#x27;) }}&#x27; &#x27;VACUUM;&#x27;&quot;</span><span class="diff-line context">       register: plex_db_vacuum</span><span class="diff-line context">       failed_when: (plex_db_vacuum.rc != 0)</span><span class="diff-line context"> </span><span class="diff-line del">-    - name: &quot;Vacuum &#x27;{{ plex_paths_db_blobs_location | basename }}&#x27; database&quot;</span><span class="diff-line del">-      ansible.builtin.shell: &quot;&#x27;/opt/plexsql/Plex SQLite&#x27; &#x27;{{ plex_paths_db_blobs_location }}&#x27; &#x27;VACUUM;&#x27;&quot;</span><span class="diff-line add">+    - name: &quot;Vacuum &#x27;{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_db_blobs_location&#x27;, role=&#x27;plex&#x27;) | basename }}&#x27; database&quot;</span><span class="diff-line add">+      ansible.builtin.shell: &quot;&#x27;{{ server_appdata_path }}/plexsql/Plex SQLite&#x27; &#x27;{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_db_blobs_location&#x27;, role=&#x27;plex&#x27;) }}&#x27; &#x27;VACUUM;&#x27;&quot;</span><span class="diff-line context">       register: plex_db_blobs_vacuum</span><span class="diff-line context">       failed_when: (plex_db_blobs_vacuum.rc != 0)</span><span class="diff-line context"> </span><span class="diff-line del">-    - name: &quot;Reindex &#x27;{{ plex_paths_db_location | basename }}&#x27; database&quot;</span><span class="diff-line del">-      ansible.builtin.shell: &quot;&#x27;/opt/plexsql/Plex SQLite&#x27; &#x27;{{ plex_paths_db_location }}&#x27; &#x27;REINDEX;&#x27;&quot;</span><span class="diff-line add">+    - name: &quot;Reindex &#x27;{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_db_location&#x27;, role=&#x27;plex&#x27;) | basename }}&#x27; database&quot;</span><span class="diff-line add">+      ansible.builtin.shell: &quot;&#x27;{{ server_appdata_path }}/plexsql/Plex SQLite&#x27; &#x27;{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_db_location&#x27;, role=&#x27;plex&#x27;) }}&#x27; &#x27;REINDEX;&#x27;&quot;</span><span class="diff-line context">       register: plex_db_reindex</span><span class="diff-line context">       failed_when: (plex_db_reindex.rc != 0)</span><span class="diff-line context"> </span><span class="diff-line del">-    - name: &quot;Reindex &#x27;{{ plex_paths_db_blobs_location | basename }}&#x27; database&quot;</span><span class="diff-line del">-      ansible.builtin.shell: &quot;&#x27;/opt/plexsql/Plex SQLite&#x27; &#x27;{{ plex_paths_db_blobs_location }}&#x27; &#x27;REINDEX;&#x27;&quot;</span><span class="diff-line add">+    - name: &quot;Reindex &#x27;{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_db_blobs_location&#x27;, role=&#x27;plex&#x27;) | basename }}&#x27; database&quot;</span><span class="diff-line add">+      ansible.builtin.shell: &quot;&#x27;{{ server_appdata_path }}/plexsql/Plex SQLite&#x27; &#x27;{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_db_blobs_location&#x27;, role=&#x27;plex&#x27;) }}&#x27; &#x27;REINDEX;&#x27;&quot;</span><span class="diff-line context">       register: plex_db_blobs_reindex</span><span class="diff-line context">       failed_when: (plex_db_blobs_reindex.rc != 0)</span><span class="diff-line context"> </span><span class="diff-line hunk">@@ -90,7 +90,7 @@</span><span class="diff-line context">       ansible.builtin.set_fact:</span><span class="diff-line context">         plex_db_failed_optimization: true</span><span class="diff-line context"> </span><span class="diff-line del">-    - name: &quot;Notify | Plex instance &#x27;{{ plex_name }}&#x27; failed the optimization tasks.&quot;</span><span class="diff-line add">+    - name: &quot;Plex instance &#x27;{{ plex_name }}&#x27; failed the optimization tasks.&quot;</span><span class="diff-line context">       ansible.builtin.include_role:</span><span class="diff-line context">         name: notify</span><span class="diff-line context">       vars:</span><span class="diff-line hunk">@@ -98,7 +98,7 @@</span><span class="diff-line context"> </span><span class="diff-line context">     - name: Delete wal and shm files</span><span class="diff-line context">       ansible.builtin.file:</span><span class="diff-line del">-        path: &quot;{{ plex_paths_plugin_support_location }}/Databases/{{ item }}&quot;</span><span class="diff-line add">+        path: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_plugin_support_location&#x27;, role=&#x27;plex&#x27;) }}/Databases/{{ item }}&quot;</span><span class="diff-line context">         state: absent</span><span class="diff-line context">       loop:</span><span class="diff-line context">         - &quot;com.plexapp.plugins.library.db-wal&quot;</span><span class="diff-line hunk">@@ -107,7 +107,7 @@</span><span class="diff-line context">         - &quot;com.plexapp.plugins.library.blobs.db-shm&quot;</span><span class="diff-line context"> </span><span class="diff-line context">     - name: Restore database backup</span><span class="diff-line del">-      ansible.builtin.shell: &quot;cp -f &#x27;/tmp/{{ plex_name }}_backup/{{ item }}&#x27; &#x27;{{ plex_paths_plugin_support_location }}/Databases/{{ item }}&#x27;&quot;</span><span class="diff-line add">+      ansible.builtin.shell: &quot;cp -f &#x27;/tmp/{{ plex_name }}_backup/{{ item }}&#x27; &#x27;{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_plugin_support_location&#x27;, role=&#x27;plex&#x27;) }}/Databases/{{ item }}&#x27;&quot;</span><span class="diff-line context">       loop: &quot;{{ plex_db_files }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Start Docker container</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-275">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/plex_extra_tasks/defaults/main.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -8,5 +8,5 @@</span><span class="diff-line context"> #########################################################################</span><span class="diff-line context"> ---</span><span class="diff-line context"> plex_extra_tasks_hostname: &quot;{{ plex_name</span><span class="diff-line del">-                            if not (&#x27;container:&#x27; in lookup(&#x27;vars&#x27;, plex_name + &#x27;_docker_network_mode_default&#x27;, default=docker_networks_name_common))</span><span class="diff-line del">-                            else (lookup(&#x27;vars&#x27;, plex_name + &#x27;_docker_network_mode_default&#x27;, default=docker_networks_name_common).split(&#x27;:&#x27;)[1]) }}&quot;</span><span class="diff-line add">+                            if not (&#x27;container:&#x27; in lookup(&#x27;role_var&#x27;, &#x27;_docker_network_mode&#x27;, role=&#x27;plex&#x27;, default=docker_networks_name_common))</span><span class="diff-line add">+                            else (lookup(&#x27;role_var&#x27;, &#x27;_docker_network_mode&#x27;, role=&#x27;plex&#x27;, default=docker_networks_name_common).split(&#x27;:&#x27;)[1]) }}&quot;</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-276">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/plex_extra_tasks/tasks/main.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -17,5 +17,5 @@</span><span class="diff-line context">     docker_installed_containers_list: &quot;{{ (docker_installed_containers_list.stdout).split() }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: &quot;Continue when Plex Docker container exists&quot;</span><span class="diff-line del">-  ansible.builtin.import_tasks: &quot;main2.yml&quot;</span><span class="diff-line del">-  when: (plex_docker_container in docker_installed_containers_list)</span><span class="diff-line add">+  ansible.builtin.include_tasks: &quot;main2.yml&quot;</span><span class="diff-line add">+  when: (lookup(&#x27;role_var&#x27;, &#x27;_docker_container&#x27;, role=&#x27;plex&#x27;) in docker_installed_containers_list)</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-277">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/plex_extra_tasks/tasks/main2.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -7,18 +7,18 @@</span><span class="diff-line context"> #                   GNU General Public License v3.0                     #</span><span class="diff-line context"> #########################################################################</span><span class="diff-line context"> ---</span><span class="diff-line del">-- name: Wait for &#x27;{{ plex_paths_config_location | basename }}&#x27; to be created</span><span class="diff-line add">+- name: Wait for &#x27;{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_config_location&#x27;, role=&#x27;plex&#x27;) | basename }}&#x27; to be created</span><span class="diff-line context">   ansible.builtin.wait_for:</span><span class="diff-line del">-    path: &quot;{{ plex_paths_config_location }}&quot;</span><span class="diff-line add">+    path: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_config_location&#x27;, role=&#x27;plex&#x27;) }}&quot;</span><span class="diff-line context">     state: present</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Wait for {{ plex_name | title }} DB to be created</span><span class="diff-line context">   ansible.builtin.wait_for:</span><span class="diff-line del">-    path: &quot;{{ plex_paths_db_location }}&quot;</span><span class="diff-line add">+    path: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_db_location&#x27;, role=&#x27;plex&#x27;) }}&quot;</span><span class="diff-line context">     state: present</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Wait for {{ plex_name | title }} executable to be created</span><span class="diff-line del">-  ansible.builtin.shell: docker exec {{ plex_docker_container }} bash -c &quot;ls &#x27;/usr/lib/plexmediaserver/Plex Media Server&#x27;&quot;</span><span class="diff-line add">+  ansible.builtin.shell: docker exec {{ lookup(&#x27;role_var&#x27;, &#x27;_docker_container&#x27;, role=&#x27;plex&#x27;) }} bash -c &quot;ls &#x27;/usr/lib/plexmediaserver/Plex Media Server&#x27;&quot;</span><span class="diff-line context">   register: pms_check</span><span class="diff-line context">   until: pms_check.stderr.find(&quot;No such file or directory&quot;) == -1</span><span class="diff-line context">   retries: 600</span><span class="diff-line hunk">@@ -42,17 +42,17 @@</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Ensure transcodes folder has the correct permissions</span><span class="diff-line context">   ansible.builtin.file:</span><span class="diff-line del">-    path: &quot;{{ plex_paths_transcodes_location }}&quot;</span><span class="diff-line add">+    path: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_transcodes_location&#x27;, role=&#x27;plex&#x27;) }}&quot;</span><span class="diff-line context">     owner: &quot;{{ user.name }}&quot;</span><span class="diff-line context">     group: &quot;{{ user.name }}&quot;</span><span class="diff-line context">     mode: &quot;0775&quot;</span><span class="diff-line context">     recurse: true</span><span class="diff-line context"> </span><span class="diff-line del">-- name: Find external port binding for &#x27;{{ plex_docker_container }}&#x27; docker port &#x27;{{ plex_web_port }}&#x27;</span><span class="diff-line del">-  when: plex_open_main_ports</span><span class="diff-line add">+- name: Find external port binding for &#x27;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_container&#x27;, role=&#x27;plex&#x27;) }}&#x27; docker port &#x27;{{ lookup(&#x27;role_var&#x27;, &#x27;_web_port&#x27;, role=&#x27;plex&#x27;) }}&#x27;</span><span class="diff-line add">+  when: lookup(&#x27;role_var&#x27;, &#x27;_open_main_ports&#x27;, role=&#x27;plex&#x27;)</span><span class="diff-line context">   block:</span><span class="diff-line del">-    - name: Lookup host port mapped to &#x27;{{ plex_docker_container }}&#x27; docker port &#x27;{{ plex_web_port }}&#x27;</span><span class="diff-line del">-      ansible.builtin.shell: docker port {{ plex_docker_container }} {{ plex_web_port }} 2&gt; /dev/null | sed &#x27;s/[0-9.]*://&#x27;</span><span class="diff-line add">+    - name: Lookup host port mapped to &#x27;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_container&#x27;, role=&#x27;plex&#x27;) }}&#x27; docker port &#x27;{{ lookup(&#x27;role_var&#x27;, &#x27;_web_port&#x27;, role=&#x27;plex&#x27;) }}&#x27;</span><span class="diff-line add">+      ansible.builtin.shell: docker port {{ lookup(&#x27;role_var&#x27;, &#x27;_docker_container&#x27;, role=&#x27;plex&#x27;) }} {{ lookup(&#x27;role_var&#x27;, &#x27;_web_port&#x27;, role=&#x27;plex&#x27;) }} 2&gt; /dev/null | sed &#x27;s/[0-9.]*://&#x27;</span><span class="diff-line context">       register: plex_docker_port_lookup_cmd</span><span class="diff-line context">       changed_when: false</span><span class="diff-line context"> </span><span class="diff-line hunk">@@ -60,21 +60,21 @@</span><span class="diff-line context">       ansible.builtin.set_fact:</span><span class="diff-line context">         plex_docker_port_lookup: &quot;{{ (plex_docker_port_lookup_cmd.stdout | trim)</span><span class="diff-line context">                                   if (plex_docker_port_lookup_cmd.stdout | trim | length &gt; 0)</span><span class="diff-line del">-                                  else plex_web_port }}&quot;</span><span class="diff-line add">+                                  else lookup(&#x27;role_var&#x27;, &#x27;_web_port&#x27;, role=&#x27;plex&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line del">-- name: Update port in &#x27;{{ plex_paths_config_location | basename }}&#x27;</span><span class="diff-line add">+- name: Update port in &#x27;{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_config_location&#x27;, role=&#x27;plex&#x27;) | basename }}&#x27;</span><span class="diff-line context">   community.general.xml:</span><span class="diff-line del">-    path: &quot;{{ plex_paths_config_location }}&quot;</span><span class="diff-line add">+    path: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_config_location&#x27;, role=&#x27;plex&#x27;) }}&quot;</span><span class="diff-line context">     xpath: /Preferences</span><span class="diff-line context">     attribute: ManualPortMappingPort</span><span class="diff-line del">-    value: &quot;{{ plex_docker_port_lookup | default(plex_web_port) }}&quot;</span><span class="diff-line add">+    value: &quot;{{ plex_docker_port_lookup | default(lookup(&#x27;role_var&#x27;, &#x27;_web_port&#x27;, role=&#x27;plex&#x27;)) }}&quot;</span><span class="diff-line context">     state: present</span><span class="diff-line context">   become: true</span><span class="diff-line context">   become_user: &quot;{{ user.name }}&quot;</span><span class="diff-line context"> </span><span class="diff-line del">-- name: Disable Remote Access in &#x27;{{ plex_paths_config_location | basename }}&#x27;</span><span class="diff-line add">+- name: Disable Remote Access in &#x27;{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_config_location&#x27;, role=&#x27;plex&#x27;) | basename }}&#x27;</span><span class="diff-line context">   community.general.xml:</span><span class="diff-line del">-    path: &quot;{{ plex_paths_config_location }}&quot;</span><span class="diff-line add">+    path: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_config_location&#x27;, role=&#x27;plex&#x27;) }}&quot;</span><span class="diff-line context">     xpath: /Preferences</span><span class="diff-line context">     attribute: PublishServerOnPlexOnlineKey</span><span class="diff-line context">     value: &quot;0&quot;</span><span class="diff-line hunk">@@ -82,9 +82,9 @@</span><span class="diff-line context">   become: true</span><span class="diff-line context">   become_user: &quot;{{ user.name }}&quot;</span><span class="diff-line context"> </span><span class="diff-line del">-- name: Disable Relay in &#x27;{{ plex_paths_config_location | basename }}&#x27;</span><span class="diff-line add">+- name: Disable Relay in &#x27;{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_config_location&#x27;, role=&#x27;plex&#x27;) | basename }}&#x27;</span><span class="diff-line context">   community.general.xml:</span><span class="diff-line del">-    path: &quot;{{ plex_paths_config_location }}&quot;</span><span class="diff-line add">+    path: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_config_location&#x27;, role=&#x27;plex&#x27;) }}&quot;</span><span class="diff-line context">     xpath: /Preferences</span><span class="diff-line context">     attribute: RelayEnabled</span><span class="diff-line context">     value: &quot;0&quot;</span><span class="diff-line hunk">@@ -92,22 +92,12 @@</span><span class="diff-line context">   become: true</span><span class="diff-line context">   become_user: &quot;{{ user.name }}&quot;</span><span class="diff-line context"> </span><span class="diff-line del">-- name: Reset permissions of &#x27;{{ plex_paths_config_location | basename }}&#x27;</span><span class="diff-line add">+- name: Reset permissions of &#x27;{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_config_location&#x27;, role=&#x27;plex&#x27;) | basename }}&#x27;</span><span class="diff-line context">   ansible.builtin.file:</span><span class="diff-line del">-    path: &quot;{{ plex_paths_config_location }}&quot;</span><span class="diff-line add">+    path: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_config_location&#x27;, role=&#x27;plex&#x27;) }}&quot;</span><span class="diff-line context">     owner: &quot;{{ user.name }}&quot;</span><span class="diff-line context">     group: &quot;{{ user.name }}&quot;</span><span class="diff-line context">     mode: &quot;0644&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-- name: &quot;Install Sub-Zero Plugin&quot;</span><span class="diff-line del">-  ansible.builtin.include_role:</span><span class="diff-line del">-    name: sub_zero</span><span class="diff-line del">-  when: plex_plugin_sub_zero</span><span class="diff-line del">-</span><span class="diff-line del">-- name: &quot;Install WebTools Plugin&quot;</span><span class="diff-line del">-  ansible.builtin.include_role:</span><span class="diff-line del">-    name: webtools</span><span class="diff-line del">-  when: plex_plugin_webtools</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Start Docker Container</span><span class="diff-line context">   ansible.builtin.include_tasks: &quot;{{ resources_tasks_path }}/docker/start_docker_container.yml&quot;</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-278">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/plex_fix_futures/tasks/main2.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -15,6 +15,7 @@</span><span class="diff-line context">       token: &quot;&quot;</span><span class="diff-line context">     owner: &quot;{{ user.name }}&quot;</span><span class="diff-line context">     group: &quot;{{ user.name }}&quot;</span><span class="diff-line add">+    base_path: &quot;{{ server_appdata_path }}&quot;</span><span class="diff-line context">   register: plex_instance_token</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Plex API Block</span><span class="diff-line hunk">@@ -22,7 +23,7 @@</span><span class="diff-line context">   block:</span><span class="diff-line context">     - name: Get items that have a date set in the future</span><span class="diff-line context">       ansible.builtin.shell: |</span><span class="diff-line del">-        curl -s &#x27;{{ plex_web_url }}/library/all?X-Plex-Token={{ plex_instance_token.facts.token }}&#x27; -H &#x27;Accept: application/json&#x27; | jq -c --arg now &#x27;{{ ansible_date_time.epoch }}&#x27; &#x27;.MediaContainer.Metadata[] | select(.addedAt &gt; ($now|tonumber)) | {id: .ratingKey, addedAt: .addedAt, updatedAt: .updatedAt, title: .title, librarySectionID: .librarySectionID, type: .type}&#x27;</span><span class="diff-line add">+        curl -s &#x27;{{ lookup(&#x27;role_var&#x27;, &#x27;_web_url&#x27;, role=&#x27;plex&#x27;) }}/library/all?X-Plex-Token={{ plex_instance_token.facts.token }}&#x27; -H &#x27;Accept: application/json&#x27; | jq -c --arg now &#x27;{{ ansible_facts[&#x27;date_time&#x27;][&#x27;epoch&#x27;] }}&#x27; &#x27;.MediaContainer.Metadata[] | select(.addedAt &gt; ($now|tonumber)) | {id: .ratingKey, addedAt: .addedAt, updatedAt: .updatedAt, title: .title, librarySectionID: .librarySectionID, type: .type}&#x27;</span><span class="diff-line context">       register: plex_future_items_request</span><span class="diff-line context"> </span><span class="diff-line context">     - name: Convert request output into a list of dictionaries</span><span class="diff-line hunk">@@ -36,7 +37,7 @@</span><span class="diff-line context"> </span><span class="diff-line context">     - name: Fix future dates</span><span class="diff-line context">       ansible.builtin.shell: |</span><span class="diff-line del">-        curl -X PUT &#x27;{{ plex_web_url }}/library/sections/{{ item.librarySectionID }}/all?type={{ item.type_id }}&amp;id={{ item.id }}&amp;addedAt.value={{ item.updatedAt }}&amp;X-Plex-Token={{ plex_instance_token.facts.token }}&#x27;</span><span class="diff-line add">+        curl -X PUT &#x27;{{ lookup(&#x27;role_var&#x27;, &#x27;_web_url&#x27;, role=&#x27;plex&#x27;) }}/library/sections/{{ item.librarySectionID }}/all?type={{ item.type_id }}&amp;id={{ item.id }}&amp;addedAt.value={{ item.updatedAt }}&amp;X-Plex-Token={{ plex_instance_token.facts.token }}&#x27;</span><span class="diff-line context">       loop: &quot;{{ plex_future_items_typed }}&quot;</span><span class="diff-line context">       register: plex_future_items_task</span><span class="diff-line context">       when: plex_future_items_typed is defined</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-279">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/portainer/defaults/main.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -17,151 +17,109 @@</span><span class="diff-line context"> # Settings</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-portainer_business_edition: false</span><span class="diff-line add">+portainer_role_business_edition: false</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # Paths</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-portainer_paths_folder: &quot;{{ portainer_name }}&quot;</span><span class="diff-line del">-portainer_paths_location: &quot;{{ server_appdata_path }}/{{ portainer_paths_folder }}&quot;</span><span class="diff-line del">-portainer_paths_folders_list:</span><span class="diff-line del">-  - &quot;{{ portainer_paths_location }}&quot;</span><span class="diff-line add">+portainer_role_paths_folder: &quot;{{ portainer_name }}&quot;</span><span class="diff-line add">+portainer_role_paths_location: &quot;{{ server_appdata_path }}/{{ portainer_role_paths_folder }}&quot;</span><span class="diff-line add">+portainer_role_paths_folders_list:</span><span class="diff-line add">+  - &quot;{{ portainer_role_paths_location }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # Web</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-portainer_web_subdomain: &quot;{{ portainer_name }}&quot;</span><span class="diff-line del">-portainer_web_domain: &quot;{{ user.domain }}&quot;</span><span class="diff-line del">-portainer_web_port: &quot;9000&quot;</span><span class="diff-line del">-portainer_web_url: &quot;{{ &#x27;https://&#x27; + (portainer_web_subdomain + &#x27;.&#x27; + portainer_web_domain</span><span class="diff-line del">-                    if (portainer_web_subdomain | length &gt; 0)</span><span class="diff-line del">-                    else portainer_web_domain) }}&quot;</span><span class="diff-line add">+portainer_role_web_subdomain: &quot;{{ portainer_name }}&quot;</span><span class="diff-line add">+portainer_role_web_domain: &quot;{{ user.domain }}&quot;</span><span class="diff-line add">+portainer_role_web_port: &quot;9000&quot;</span><span class="diff-line add">+portainer_role_web_url: &quot;{{ &#x27;https://&#x27; + (lookup(&#x27;role_var&#x27;, &#x27;_web_subdomain&#x27;, role=&#x27;portainer&#x27;) + &#x27;.&#x27; + lookup(&#x27;role_var&#x27;, &#x27;_web_domain&#x27;, role=&#x27;portainer&#x27;)</span><span class="diff-line add">+                         if (lookup(&#x27;role_var&#x27;, &#x27;_web_subdomain&#x27;, role=&#x27;portainer&#x27;) | length &gt; 0)</span><span class="diff-line add">+                         else lookup(&#x27;role_var&#x27;, &#x27;_web_domain&#x27;, role=&#x27;portainer&#x27;)) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # DNS</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-portainer_dns_record: &quot;{{ portainer_web_subdomain }}&quot;</span><span class="diff-line del">-portainer_dns_zone: &quot;{{ portainer_web_domain }}&quot;</span><span class="diff-line del">-portainer_dns_proxy: &quot;{{ dns.proxied }}&quot;</span><span class="diff-line add">+portainer_role_dns_record: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_web_subdomain&#x27;, role=&#x27;portainer&#x27;) }}&quot;</span><span class="diff-line add">+portainer_role_dns_zone: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_web_domain&#x27;, role=&#x27;portainer&#x27;) }}&quot;</span><span class="diff-line add">+portainer_role_dns_proxy: &quot;{{ dns_proxied }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # Traefik</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-portainer_traefik_sso_middleware: &quot;{{ traefik_default_sso_middleware }}&quot;</span><span class="diff-line del">-portainer_traefik_middleware_default: &quot;{{ traefik_default_middleware</span><span class="diff-line del">-                                          + (&#x27;,themepark-&#x27; + lookup(&#x27;vars&#x27;, portainer_name + &#x27;_name&#x27;, default=portainer_name)</span><span class="diff-line del">-                                            if (portainer_themepark_enabled and global_themepark_plugin_enabled)</span><span class="diff-line del">-                                            else &#x27;&#x27;) }}&quot;</span><span class="diff-line del">-portainer_traefik_middleware_custom: &quot;&quot;</span><span class="diff-line del">-portainer_traefik_certresolver: &quot;{{ traefik_default_certresolver }}&quot;</span><span class="diff-line del">-portainer_traefik_enabled: true</span><span class="diff-line del">-portainer_traefik_api_enabled: true</span><span class="diff-line del">-portainer_traefik_api_endpoint: &quot;PathPrefix(`/api`)&quot;</span><span class="diff-line add">+portainer_role_traefik_sso_middleware: &quot;{{ traefik_default_sso_middleware }}&quot;</span><span class="diff-line add">+portainer_role_traefik_middleware_default: &quot;{{ traefik_default_middleware</span><span class="diff-line add">+                                               + (&#x27;,themepark-&#x27; + portainer_name</span><span class="diff-line add">+                                                 if (lookup(&#x27;role_var&#x27;, &#x27;_themepark_enabled&#x27;, role=&#x27;portainer&#x27;) and global_themepark_plugin_enabled)</span><span class="diff-line add">+                                                 else &#x27;&#x27;) }}&quot;</span><span class="diff-line add">+portainer_role_traefik_middleware_custom: &quot;&quot;</span><span class="diff-line add">+portainer_role_traefik_certresolver: &quot;{{ traefik_default_certresolver }}&quot;</span><span class="diff-line add">+portainer_role_traefik_enabled: true</span><span class="diff-line add">+portainer_role_traefik_api_enabled: true</span><span class="diff-line add">+portainer_role_traefik_api_endpoint: &quot;PathPrefix(`/api`)&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line del">-# THEME</span><span class="diff-line add">+# Theme</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line context"> # Options can be found at https://github.com/themepark-dev/theme.park</span><span class="diff-line del">-portainer_themepark_enabled: false</span><span class="diff-line del">-portainer_themepark_theme: &quot;{{ global_themepark_theme }}&quot;</span><span class="diff-line add">+portainer_role_themepark_enabled: false</span><span class="diff-line add">+portainer_role_themepark_theme: &quot;{{ global_themepark_theme }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # Docker</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line context"> # Container</span><span class="diff-line del">-portainer_docker_container: &quot;{{ portainer_name }}&quot;</span><span class="diff-line add">+portainer_role_docker_container: &quot;{{ portainer_name }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Image</span><span class="diff-line del">-portainer_docker_image_pull: true</span><span class="diff-line del">-portainer_docker_image_tag: &quot;latest&quot;</span><span class="diff-line del">-portainer_docker_image: &quot;{{ (&#x27;portainer/portainer-ee:&#x27;</span><span class="diff-line del">-                             if portainer_business_edition</span><span class="diff-line del">-                             else &#x27;portainer/portainer-ce:&#x27;) + portainer_docker_image_tag }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Ports</span><span class="diff-line del">-portainer_docker_ports_defaults: []</span><span class="diff-line del">-portainer_docker_ports_custom: []</span><span class="diff-line del">-portainer_docker_ports: &quot;{{ portainer_docker_ports_defaults</span><span class="diff-line del">-                            + portainer_docker_ports_custom }}&quot;</span><span class="diff-line add">+portainer_role_docker_image_pull: true</span><span class="diff-line add">+portainer_role_docker_image_tag: &quot;latest&quot;</span><span class="diff-line add">+portainer_role_docker_image_repo: &quot;{{ &#x27;portainer/portainer-ee&#x27;</span><span class="diff-line add">+                                   if lookup(&#x27;role_var&#x27;, &#x27;_business_edition&#x27;, role=&#x27;portainer&#x27;)</span><span class="diff-line add">+                                   else &#x27;portainer/portainer-ce&#x27; }}&quot;</span><span class="diff-line add">+portainer_role_docker_image: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_image_repo&#x27;, role=&#x27;portainer&#x27;) }}:{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_image_tag&#x27;, role=&#x27;portainer&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Envs</span><span class="diff-line del">-portainer_docker_envs_default:</span><span class="diff-line add">+portainer_role_docker_envs_default:</span><span class="diff-line context">   TZ: &quot;{{ tz }}&quot;</span><span class="diff-line del">-portainer_docker_envs_custom: {}</span><span class="diff-line del">-portainer_docker_envs: &quot;{{ portainer_docker_envs_default</span><span class="diff-line del">-                           | combine(portainer_docker_envs_custom) }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Commands</span><span class="diff-line del">-portainer_docker_commands_default: []</span><span class="diff-line del">-portainer_docker_commands_custom: []</span><span class="diff-line del">-portainer_docker_commands: &quot;{{ portainer_docker_commands_default</span><span class="diff-line del">-                               + portainer_docker_commands_custom }}&quot;</span><span class="diff-line add">+portainer_role_docker_envs_custom: {}</span><span class="diff-line add">+portainer_role_docker_envs: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_envs_default&#x27;, role=&#x27;portainer&#x27;)</span><span class="diff-line add">+                                | combine(lookup(&#x27;role_var&#x27;, &#x27;_docker_envs_custom&#x27;, role=&#x27;portainer&#x27;)) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Volumes</span><span class="diff-line del">-portainer_docker_volumes_default:</span><span class="diff-line del">-  - &quot;{{ portainer_paths_location }}:/data&quot;</span><span class="diff-line add">+portainer_role_docker_volumes_default:</span><span class="diff-line add">+  - &quot;{{ portainer_role_paths_location }}:/data&quot;</span><span class="diff-line context">   - &quot;/var/run/docker.sock:/var/run/docker.sock&quot;</span><span class="diff-line del">-portainer_docker_volumes_custom: []</span><span class="diff-line del">-portainer_docker_volumes: &quot;{{ portainer_docker_volumes_default</span><span class="diff-line del">-                              + portainer_docker_volumes_custom }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Devices</span><span class="diff-line del">-portainer_docker_devices_default: []</span><span class="diff-line del">-portainer_docker_devices_custom: []</span><span class="diff-line del">-portainer_docker_devices: &quot;{{ portainer_docker_devices_default</span><span class="diff-line del">-                              + portainer_docker_devices_custom }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Hosts</span><span class="diff-line del">-portainer_docker_hosts_default: {}</span><span class="diff-line del">-portainer_docker_hosts_custom: {}</span><span class="diff-line del">-portainer_docker_hosts: &quot;{{ docker_hosts_common</span><span class="diff-line del">-                            | combine(portainer_docker_hosts_default)</span><span class="diff-line del">-                            | combine(portainer_docker_hosts_custom) }}&quot;</span><span class="diff-line add">+portainer_role_docker_volumes_custom: []</span><span class="diff-line add">+portainer_role_docker_volumes: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_volumes_default&#x27;, role=&#x27;portainer&#x27;)</span><span class="diff-line add">+                                   + lookup(&#x27;role_var&#x27;, &#x27;_docker_volumes_custom&#x27;, role=&#x27;portainer&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Labels</span><span class="diff-line del">-portainer_docker_labels_default: {}</span><span class="diff-line del">-portainer_docker_labels_custom: {}</span><span class="diff-line del">-portainer_docker_labels_themepark:</span><span class="diff-line del">-  - &#x27;{ &quot;traefik.http.middlewares.themepark-{{ lookup(&quot;vars&quot;, portainer_name + &quot;_name&quot;, default=portainer_name) }}.plugin.themepark.app&quot;: &quot;portainer&quot; }&#x27;</span><span class="diff-line del">-  - &#x27;{ &quot;traefik.http.middlewares.themepark-{{ lookup(&quot;vars&quot;, portainer_name + &quot;_name&quot;, default=portainer_name) }}.plugin.themepark.theme&quot;: &quot;{{ lookup(&quot;vars&quot;, portainer_name + &quot;_themepark_theme&quot;, default=portainer_themepark_theme) }}&quot; }&#x27;</span><span class="diff-line del">-portainer_docker_labels: &quot;{{ docker_labels_common</span><span class="diff-line del">-                             | combine(portainer_docker_labels_default)</span><span class="diff-line del">-                             | combine((lookup(&#x27;vars&#x27;, portainer_name + &#x27;_docker_labels_themepark&#x27;, default=portainer_docker_labels_themepark)</span><span class="diff-line del">-                                       if (portainer_themepark_enabled and global_themepark_plugin_enabled)</span><span class="diff-line del">-                                       else {}),</span><span class="diff-line del">-                                       lookup(&#x27;vars&#x27;, portainer_name + &#x27;_docker_labels_custom&#x27;, default=portainer_docker_labels_custom)) }}&quot;</span><span class="diff-line add">+portainer_role_docker_labels_custom: {}</span><span class="diff-line add">+portainer_role_docker_labels: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_labels_custom&#x27;, role=&#x27;portainer&#x27;)</span><span class="diff-line add">+                                  | combine((traefik_themepark_labels</span><span class="diff-line add">+                                            if (lookup(&#x27;role_var&#x27;, &#x27;_themepark_enabled&#x27;, role=&#x27;portainer&#x27;) and global_themepark_plugin_enabled)</span><span class="diff-line add">+                                            else {})) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Hostname</span><span class="diff-line del">-portainer_docker_hostname: &quot;{{ portainer_name }}&quot;</span><span class="diff-line add">+portainer_role_docker_hostname: &quot;{{ portainer_name }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Networks</span><span class="diff-line del">-portainer_docker_networks_alias: &quot;{{ portainer_name }}&quot;</span><span class="diff-line del">-portainer_docker_networks_default: []</span><span class="diff-line del">-portainer_docker_networks_custom: []</span><span class="diff-line del">-portainer_docker_networks: &quot;{{ docker_networks_common</span><span class="diff-line del">-                               + portainer_docker_networks_default</span><span class="diff-line del">-                               + portainer_docker_networks_custom }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Capabilities</span><span class="diff-line del">-portainer_docker_capabilities_default: []</span><span class="diff-line del">-portainer_docker_capabilities_custom: []</span><span class="diff-line del">-portainer_docker_capabilities: &quot;{{ portainer_docker_capabilities_default</span><span class="diff-line del">-                                   + portainer_docker_capabilities_custom }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Security Opts</span><span class="diff-line del">-portainer_docker_security_opts_default: []</span><span class="diff-line del">-portainer_docker_security_opts_custom: []</span><span class="diff-line del">-portainer_docker_security_opts: &quot;{{ portainer_docker_security_opts_default</span><span class="diff-line del">-                                    + portainer_docker_security_opts_custom }}&quot;</span><span class="diff-line add">+portainer_role_docker_networks_alias: &quot;{{ portainer_name }}&quot;</span><span class="diff-line add">+portainer_role_docker_networks_default: []</span><span class="diff-line add">+portainer_role_docker_networks_custom: []</span><span class="diff-line add">+portainer_role_docker_networks: &quot;{{ docker_networks_common</span><span class="diff-line add">+                                    + lookup(&#x27;role_var&#x27;, &#x27;_docker_networks_default&#x27;, role=&#x27;portainer&#x27;)</span><span class="diff-line add">+                                    + lookup(&#x27;role_var&#x27;, &#x27;_docker_networks_custom&#x27;, role=&#x27;portainer&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Restart Policy</span><span class="diff-line del">-portainer_docker_restart_policy: unless-stopped</span><span class="diff-line add">+portainer_role_docker_restart_policy: unless-stopped</span><span class="diff-line context"> </span><span class="diff-line context"> # State</span><span class="diff-line del">-portainer_docker_state: started</span><span class="diff-line add">+portainer_role_docker_state: started</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-280">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/portainer/tasks/main.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -10,16 +10,16 @@</span><span class="diff-line context"> - name: Add DNS record</span><span class="diff-line context">   ansible.builtin.include_tasks: &quot;{{ resources_tasks_path }}/dns/tasker.yml&quot;</span><span class="diff-line context">   vars:</span><span class="diff-line del">-    dns_record: &quot;{{ lookup(&#x27;vars&#x27;, role_name + &#x27;_dns_record&#x27;) }}&quot;</span><span class="diff-line del">-    dns_zone: &quot;{{ lookup(&#x27;vars&#x27;, role_name + &#x27;_dns_zone&#x27;) }}&quot;</span><span class="diff-line del">-    dns_proxy: &quot;{{ lookup(&#x27;vars&#x27;, role_name + &#x27;_dns_proxy&#x27;) }}&quot;</span><span class="diff-line add">+    dns_record: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_dns_record&#x27;) }}&quot;</span><span class="diff-line add">+    dns_zone: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_dns_zone&#x27;) }}&quot;</span><span class="diff-line add">+    dns_proxy: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_dns_proxy&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Remove existing Docker container</span><span class="diff-line context">   ansible.builtin.include_tasks: &quot;{{ resources_tasks_path }}/docker/remove_docker_container.yml&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: &quot;Check if config folder exists&quot;</span><span class="diff-line context">   ansible.builtin.stat:</span><span class="diff-line del">-    path: &quot;{{ portainer_paths_location }}&quot;</span><span class="diff-line add">+    path: &quot;{{ portainer_role_paths_location }}&quot;</span><span class="diff-line context">   register: portainer_config_stat</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Create directories</span><span class="diff-line hunk">@@ -29,5 +29,5 @@</span><span class="diff-line context">   ansible.builtin.include_tasks: &quot;{{ resources_tasks_path }}/docker/create_docker_container.yml&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Setup Tasks</span><span class="diff-line del">-  ansible.builtin.import_tasks: &quot;subtasks/setup.yml&quot;</span><span class="diff-line add">+  ansible.builtin.include_tasks: &quot;subtasks/setup.yml&quot;</span><span class="diff-line context">   when: not portainer_config_stat.stat.exists and (user.pass | length &gt;= 12) and (user.pass | length &lt;= 72)</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-281">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/portainer/tasks/subtasks/setup.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -13,8 +13,9 @@</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Setup | Create Saltbox user</span><span class="diff-line context">   ansible.builtin.uri:</span><span class="diff-line del">-    url: &quot;http://{{ portainer_name }}:9000/api/users/admin/init&quot;</span><span class="diff-line add">+    url: &quot;http://{{ portainer_name }}:{{ portainer_role_web_port }}/api/users/admin/init&quot;</span><span class="diff-line context">     method: POST</span><span class="diff-line del">-    return_content: yes</span><span class="diff-line add">+    return_content: true</span><span class="diff-line context">     body_format: json</span><span class="diff-line context">     body: {&quot;Username&quot;: &quot;{{ user.name }}&quot;, &quot;Password&quot;: &quot;{{ user.pass }}&quot;}</span><span class="diff-line add">+  no_log: true</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-282">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/postgres/defaults/main.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -17,124 +17,70 @@</span><span class="diff-line context"> # Settings</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-postgres_docker_env_password: &quot;password4321&quot;</span><span class="diff-line del">-postgres_docker_env_user: &quot;{{ user.name }}&quot;</span><span class="diff-line del">-postgres_docker_env_db: &quot;saltbox&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Memory limit in format &lt;number&gt;[&lt;unit&gt;].</span><span class="diff-line del">-# Number is a positive integer.</span><span class="diff-line del">-# Unit can be B (byte), K (kibibyte, 1024B), M (mebibyte), G (gibibyte), T (tebibyte), or P (pebibyte).</span><span class="diff-line del">-postgres_docker_memory_limit: 0</span><span class="diff-line add">+postgres_role_docker_env_password: &quot;password4321&quot;</span><span class="diff-line add">+postgres_role_docker_env_user: &quot;{{ user.name }}&quot;</span><span class="diff-line add">+postgres_role_docker_env_db: &quot;saltbox&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # Paths</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-postgres_paths_folder: &quot;{{ postgres_name }}&quot;</span><span class="diff-line del">-postgres_paths_location: &quot;{{ server_appdata_path }}/{{ postgres_paths_folder }}&quot;</span><span class="diff-line del">-postgres_paths_folders_list:</span><span class="diff-line del">-  - &quot;{{ postgres_paths_location }}&quot;</span><span class="diff-line add">+postgres_role_paths_folder: &quot;{{ postgres_name }}&quot;</span><span class="diff-line add">+postgres_role_paths_location: &quot;{{ server_appdata_path }}/{{ postgres_role_paths_folder }}&quot;</span><span class="diff-line add">+postgres_role_paths_folders_list:</span><span class="diff-line add">+  - &quot;{{ postgres_role_paths_location }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # Docker</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line context"> # Container</span><span class="diff-line del">-postgres_docker_container: &quot;{{ postgres_name }}&quot;</span><span class="diff-line add">+postgres_role_docker_container: &quot;{{ postgres_name }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Image</span><span class="diff-line del">-postgres_docker_image_pull: true</span><span class="diff-line del">-postgres_docker_image_tag: &quot;17-alpine&quot;</span><span class="diff-line del">-postgres_docker_image_repo: &quot;postgres&quot;</span><span class="diff-line del">-postgres_docker_image: &quot;{{ lookup(&#x27;vars&#x27;, postgres_name + &#x27;_docker_image_repo&#x27;, default=postgres_docker_image_repo)</span><span class="diff-line del">-                           + &#x27;:&#x27; + lookup(&#x27;vars&#x27;, postgres_name + &#x27;_docker_image_tag&#x27;, default=postgres_docker_image_tag) }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Ports</span><span class="diff-line del">-postgres_docker_ports_defaults: []</span><span class="diff-line del">-postgres_docker_ports_custom: []</span><span class="diff-line del">-postgres_docker_ports: &quot;{{ postgres_docker_ports_defaults</span><span class="diff-line del">-                           + postgres_docker_ports_custom }}&quot;</span><span class="diff-line add">+postgres_role_docker_image_pull: true</span><span class="diff-line add">+postgres_role_docker_image_tag: &quot;17-alpine&quot;</span><span class="diff-line add">+postgres_role_docker_image_repo: &quot;postgres&quot;</span><span class="diff-line add">+postgres_role_docker_image: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_image_repo&#x27;, role=&#x27;postgres&#x27;) }}:{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_image_tag&#x27;, role=&#x27;postgres&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Envs</span><span class="diff-line del">-postgres_docker_envs_default:</span><span class="diff-line add">+postgres_role_docker_envs_default:</span><span class="diff-line context">   TZ: &quot;{{ tz }}&quot;</span><span class="diff-line context">   PGDATA: &quot;/data&quot;</span><span class="diff-line del">-  POSTGRES_PASSWORD: &quot;{{ lookup(&#x27;vars&#x27;, postgres_name + &#x27;_docker_env_password&#x27;, default=postgres_docker_env_password) }}&quot;</span><span class="diff-line del">-  POSTGRES_USER: &quot;{{ lookup(&#x27;vars&#x27;, postgres_name + &#x27;_docker_env_user&#x27;, default=postgres_docker_env_user) }}&quot;</span><span class="diff-line del">-  POSTGRES_DB: &quot;{{ lookup(&#x27;vars&#x27;, postgres_name + &#x27;_docker_env_db&#x27;, default=postgres_docker_env_db) }}&quot;</span><span class="diff-line del">-postgres_docker_envs_custom: {}</span><span class="diff-line del">-postgres_docker_envs: &quot;{{ lookup(&#x27;vars&#x27;, postgres_name + &#x27;_docker_envs_default&#x27;, default=postgres_docker_envs_default)</span><span class="diff-line del">-                          | combine(lookup(&#x27;vars&#x27;, postgres_name + &#x27;_docker_envs_custom&#x27;, default=postgres_docker_envs_custom)) }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Commands</span><span class="diff-line del">-postgres_docker_commands_default: []</span><span class="diff-line del">-postgres_docker_commands_custom: []</span><span class="diff-line del">-postgres_docker_commands: &quot;{{ lookup(&#x27;vars&#x27;, postgres_name + &#x27;_docker_commands_default&#x27;, default=postgres_docker_commands_default)</span><span class="diff-line del">-                              + lookup(&#x27;vars&#x27;, postgres_name + &#x27;_docker_commands_custom&#x27;, default=postgres_docker_commands_custom) }}&quot;</span><span class="diff-line add">+  POSTGRES_PASSWORD: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_env_password&#x27;, role=&#x27;postgres&#x27;) }}&quot;</span><span class="diff-line add">+  POSTGRES_USER: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_env_user&#x27;, role=&#x27;postgres&#x27;) }}&quot;</span><span class="diff-line add">+  POSTGRES_DB: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_env_db&#x27;, role=&#x27;postgres&#x27;) }}&quot;</span><span class="diff-line add">+postgres_role_docker_envs_custom: {}</span><span class="diff-line add">+postgres_role_docker_envs: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_envs_default&#x27;, role=&#x27;postgres&#x27;)</span><span class="diff-line add">+                               | combine(lookup(&#x27;role_var&#x27;, &#x27;_docker_envs_custom&#x27;, role=&#x27;postgres&#x27;)) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Volumes</span><span class="diff-line del">-postgres_docker_volumes_default:</span><span class="diff-line del">-  - &quot;{{ postgres_paths_location }}:/data&quot;</span><span class="diff-line add">+postgres_role_docker_volumes_default:</span><span class="diff-line add">+  - &quot;{{ postgres_role_paths_location }}:/data&quot;</span><span class="diff-line context">   - &quot;/etc/passwd:/etc/passwd:ro&quot;</span><span class="diff-line del">-postgres_docker_volumes_custom: []</span><span class="diff-line del">-postgres_docker_volumes: &quot;{{ lookup(&#x27;vars&#x27;, postgres_name + &#x27;_docker_volumes_default&#x27;, default=postgres_docker_volumes_default)</span><span class="diff-line del">-                             + lookup(&#x27;vars&#x27;, postgres_name + &#x27;_docker_volumes_custom&#x27;, default=postgres_docker_volumes_custom) }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Devices</span><span class="diff-line del">-postgres_docker_devices_default: []</span><span class="diff-line del">-postgres_docker_devices_custom: []</span><span class="diff-line del">-postgres_docker_devices: &quot;{{ lookup(&#x27;vars&#x27;, postgres_name + &#x27;_docker_devices_default&#x27;, default=postgres_docker_devices_default)</span><span class="diff-line del">-                             + lookup(&#x27;vars&#x27;, postgres_name + &#x27;_docker_devices_custom&#x27;, default=postgres_docker_devices_custom) }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Hosts</span><span class="diff-line del">-postgres_docker_hosts_default: {}</span><span class="diff-line del">-postgres_docker_hosts_custom: {}</span><span class="diff-line del">-postgres_docker_hosts: &quot;{{ docker_hosts_common</span><span class="diff-line del">-                           | combine(lookup(&#x27;vars&#x27;, postgres_name + &#x27;_docker_hosts_default&#x27;, default=postgres_docker_hosts_default))</span><span class="diff-line del">-                           | combine(lookup(&#x27;vars&#x27;, postgres_name + &#x27;_docker_hosts_custom&#x27;, default=postgres_docker_hosts_custom)) }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Labels</span><span class="diff-line del">-postgres_docker_labels_default: {}</span><span class="diff-line del">-postgres_docker_labels_custom: {}</span><span class="diff-line del">-postgres_docker_labels: &quot;{{ docker_labels_common</span><span class="diff-line del">-                            | combine(lookup(&#x27;vars&#x27;, postgres_name + &#x27;_docker_labels_default&#x27;, default=postgres_docker_labels_default))</span><span class="diff-line del">-                            | combine(lookup(&#x27;vars&#x27;, postgres_name + &#x27;_docker_labels_custom&#x27;, default=postgres_docker_labels_custom)) }}&quot;</span><span class="diff-line add">+postgres_role_docker_volumes_custom: []</span><span class="diff-line add">+postgres_role_docker_volumes: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_volumes_default&#x27;, role=&#x27;postgres&#x27;)</span><span class="diff-line add">+                                  + lookup(&#x27;role_var&#x27;, &#x27;_docker_volumes_custom&#x27;, role=&#x27;postgres&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Hostname</span><span class="diff-line del">-postgres_docker_hostname: &quot;{{ postgres_name }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Network Mode</span><span class="diff-line del">-postgres_docker_network_mode_default: &quot;{{ docker_networks_name_common }}&quot;</span><span class="diff-line del">-postgres_docker_network_mode: &quot;{{ lookup(&#x27;vars&#x27;, postgres_name + &#x27;_docker_network_mode_default&#x27;, default=postgres_docker_network_mode_default) }}&quot;</span><span class="diff-line add">+postgres_role_docker_hostname: &quot;{{ postgres_name }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Networks</span><span class="diff-line del">-postgres_docker_networks_alias: &quot;{{ postgres_name }}&quot;</span><span class="diff-line del">-postgres_docker_networks_default: []</span><span class="diff-line del">-postgres_docker_networks_custom: []</span><span class="diff-line del">-postgres_docker_networks: &quot;{{ docker_networks_common</span><span class="diff-line del">-                              + lookup(&#x27;vars&#x27;, postgres_name + &#x27;_docker_networks_default&#x27;, default=postgres_docker_networks_default)</span><span class="diff-line del">-                              + lookup(&#x27;vars&#x27;, postgres_name + &#x27;_docker_networks_dcustom&#x27;, default=postgres_docker_networks_custom) }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Capabilities</span><span class="diff-line del">-postgres_docker_capabilities_default: []</span><span class="diff-line del">-postgres_docker_capabilities_custom: []</span><span class="diff-line del">-postgres_docker_capabilities: &quot;{{ lookup(&#x27;vars&#x27;, postgres_name + &#x27;_docker_capabilities_default&#x27;, default=postgres_docker_capabilities_default)</span><span class="diff-line del">-                                  + lookup(&#x27;vars&#x27;, postgres_name + &#x27;_docker_capabilities_custom&#x27;, default=postgres_docker_capabilities_custom) }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Security Opts</span><span class="diff-line del">-postgres_docker_security_opts_default: []</span><span class="diff-line del">-postgres_docker_security_opts_custom: []</span><span class="diff-line del">-postgres_docker_security_opts: &quot;{{ lookup(&#x27;vars&#x27;, postgres_name + &#x27;_docker_security_opts_default&#x27;, default=postgres_docker_security_opts_default)</span><span class="diff-line del">-                                   + lookup(&#x27;vars&#x27;, postgres_name + &#x27;_docker_security_opts_custom&#x27;, default=postgres_docker_security_opts_custom) }}&quot;</span><span class="diff-line add">+postgres_role_docker_networks_alias: &quot;{{ postgres_name }}&quot;</span><span class="diff-line add">+postgres_role_docker_networks_default: []</span><span class="diff-line add">+postgres_role_docker_networks_custom: []</span><span class="diff-line add">+postgres_role_docker_networks: &quot;{{ docker_networks_common</span><span class="diff-line add">+                                   + lookup(&#x27;role_var&#x27;, &#x27;_docker_networks_default&#x27;, role=&#x27;postgres&#x27;)</span><span class="diff-line add">+                                   + lookup(&#x27;role_var&#x27;, &#x27;_docker_networks_custom&#x27;, role=&#x27;postgres&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Restart Policy</span><span class="diff-line del">-postgres_docker_restart_policy: unless-stopped</span><span class="diff-line add">+postgres_role_docker_restart_policy: unless-stopped</span><span class="diff-line context"> </span><span class="diff-line context"> # State</span><span class="diff-line del">-postgres_docker_state: started</span><span class="diff-line add">+postgres_role_docker_state: started</span><span class="diff-line context"> </span><span class="diff-line context"> # User</span><span class="diff-line del">-postgres_docker_user: &quot;{{ uid }}:{{ gid }}&quot;</span><span class="diff-line add">+postgres_role_docker_user: &quot;{{ uid }}:{{ gid }}&quot;</span><span class="diff-line context"> </span><span class="diff-line del">-# Memory Limit</span><span class="diff-line del">-postgres_docker_memory: &quot;{{ lookup(&#x27;vars&#x27;, postgres_name + &#x27;_docker_memory_limit&#x27;, default=postgres_docker_memory_limit) }}&quot;</span><span class="diff-line add">+# SHM size</span><span class="diff-line add">+postgres_role_docker_shm_size: &quot;128M&quot;</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-283">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/postgres/tasks/main2.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -11,28 +11,33 @@</span><span class="diff-line context">   ansible.builtin.set_fact:</span><span class="diff-line context">     postgres_major_version: &quot;&quot;</span><span class="diff-line context">     postgres_docker_tag_major_version: &quot;&quot;</span><span class="diff-line del">-    postgres_original_image_repo: &quot;{{ true if postgres_docker_image_repo == &#x27;postgres&#x27; else false }}&quot;</span><span class="diff-line add">+    postgres_original_image_repo: &quot;{{ true if lookup(&#x27;role_var&#x27;, &#x27;_docker_image_repo&#x27;, role=&#x27;postgres&#x27;) == &#x27;postgres&#x27; else false }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Supported image repository</span><span class="diff-line context">   when: postgres_original_image_repo</span><span class="diff-line context">   block:</span><span class="diff-line del">-    - name: &quot;Check if &#x27;{{ postgres_paths_location }}&#x27; exists&quot;</span><span class="diff-line add">+    - name: &quot;Check if &#x27;{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_location&#x27;, role=&#x27;postgres&#x27;) }}&#x27; exists&quot;</span><span class="diff-line context">       ansible.builtin.stat:</span><span class="diff-line del">-        path: &quot;{{ postgres_paths_location }}&quot;</span><span class="diff-line add">+        path: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_location&#x27;, role=&#x27;postgres&#x27;) }}&quot;</span><span class="diff-line context">       register: stat_postgres_path</span><span class="diff-line context"> </span><span class="diff-line add">+    - name: &quot;Check if &#x27;{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_location&#x27;, role=&#x27;postgres&#x27;) }}/PG_VERSION&#x27; exists&quot;</span><span class="diff-line add">+      ansible.builtin.stat:</span><span class="diff-line add">+        path: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_location&#x27;, role=&#x27;postgres&#x27;) }}/PG_VERSION&quot;</span><span class="diff-line add">+      register: stat_postgres_version_path</span><span class="diff-line add">+</span><span class="diff-line context">     - name: Check for upgrade</span><span class="diff-line del">-      when: stat_postgres_path.stat.exists</span><span class="diff-line add">+      when: stat_postgres_path.stat.exists and stat_postgres_version_path.stat.exists</span><span class="diff-line context">       block:</span><span class="diff-line context">         - name: Read PG_VERSION file</span><span class="diff-line context">           ansible.builtin.slurp:</span><span class="diff-line del">-            src: &quot;{{ postgres_paths_location }}/PG_VERSION&quot;</span><span class="diff-line add">+            src: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_location&#x27;, role=&#x27;postgres&#x27;) }}/PG_VERSION&quot;</span><span class="diff-line context">           register: pg_version_file</span><span class="diff-line context"> </span><span class="diff-line context">         - name: Define installed and desired Postgres versions</span><span class="diff-line context">           ansible.builtin.set_fact:</span><span class="diff-line context">             postgres_major_version: &quot;{{ pg_version_file[&#x27;content&#x27;] | b64decode | trim }}&quot;</span><span class="diff-line del">-            postgres_docker_tag_major_version: &quot;{{ lookup(&#x27;vars&#x27;, postgres_name + &#x27;_docker_image_tag&#x27;, default=postgres_docker_image_tag).split(&#x27;-&#x27;)[0] | regex_replace(&#x27;^([0-9]+).*&#x27;, &#x27;\\1&#x27;) }}&quot;</span><span class="diff-line add">+            postgres_docker_tag_major_version: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_image_tag&#x27;, role=&#x27;postgres&#x27;).split(&#x27;-&#x27;)[0] | regex_replace(&#x27;^([0-9]+).*&#x27;, &#x27;\\1&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context">         - name: Display PostgreSQL version</span><span class="diff-line context">           ansible.builtin.debug:</span><span class="diff-line hunk">@@ -42,8 +47,8 @@</span><span class="diff-line context">           ansible.builtin.assert:</span><span class="diff-line context">             that:</span><span class="diff-line context">               - postgres_docker_tag_major_version is regex(&quot;^[0-9]+$&quot;)</span><span class="diff-line del">-            fail_msg: &quot;Invalid version specified for &#x27;postgres_docker_image_tag&#x27;: {{ lookup(&#x27;vars&#x27;, postgres_name + &#x27;_docker_image_tag&#x27;, default=postgres_docker_image_tag) }}&quot;</span><span class="diff-line del">-            success_msg: &quot;Valid version specified for &#x27;postgres_docker_image_tag&#x27;: {{ lookup(&#x27;vars&#x27;, postgres_name + &#x27;_docker_image_tag&#x27;, default=postgres_docker_image_tag) }}&quot;</span><span class="diff-line add">+            fail_msg: &quot;Invalid version specified for &#x27;postgres_docker_image_tag&#x27;: {{ lookup(&#x27;role_var&#x27;, &#x27;_docker_image_tag&#x27;, role=&#x27;postgres&#x27;) }}&quot;</span><span class="diff-line add">+            success_msg: &quot;Valid version specified for &#x27;postgres_docker_image_tag&#x27;: {{ lookup(&#x27;role_var&#x27;, &#x27;_docker_image_tag&#x27;, role=&#x27;postgres&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context">     - name: Upgrade PostgreSQL</span><span class="diff-line context">       when: stat_postgres_path.stat.exists and (postgres_major_version != postgres_docker_tag_major_version)</span><span class="diff-line hunk">@@ -56,39 +61,39 @@</span><span class="diff-line context">         - name: Remove existing Docker container</span><span class="diff-line context">           ansible.builtin.include_tasks: &quot;{{ resources_tasks_path }}/docker/remove_docker_container.yml&quot;</span><span class="diff-line context"> </span><span class="diff-line del">-        - name: &quot;Check if &#x27;{{ postgres_paths_location }}_backup&#x27; exists&quot;</span><span class="diff-line add">+        - name: &quot;Check if &#x27;{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_location&#x27;, role=&#x27;postgres&#x27;) }}_backup&#x27; exists&quot;</span><span class="diff-line context">           ansible.builtin.stat:</span><span class="diff-line del">-            path: &quot;{{ postgres_paths_location }}_backup&quot;</span><span class="diff-line add">+            path: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_location&#x27;, role=&#x27;postgres&#x27;) }}_backup&quot;</span><span class="diff-line context">           register: stat_postgres_backup_path</span><span class="diff-line context"> </span><span class="diff-line context">         - name: Fail if backup location already exists</span><span class="diff-line context">           ansible.builtin.fail:</span><span class="diff-line context">             msg:</span><span class="diff-line context">               - &quot;A backup of the postgres folder already exists, clean it up if it was from a previously successful upgrade. Otherwise ask for help on the discord.&quot;</span><span class="diff-line del">-              - &quot;Path is {{ postgres_paths_location }}_backup&quot;</span><span class="diff-line add">+              - &quot;Path is {{ lookup(&#x27;role_var&#x27;, &#x27;_paths_location&#x27;, role=&#x27;postgres&#x27;) }}_backup&quot;</span><span class="diff-line context">           when: stat_postgres_backup_path.stat.exists</span><span class="diff-line context"> </span><span class="diff-line context">         - name: Move Postgres data folder</span><span class="diff-line del">-          ansible.builtin.shell: mv &quot;{{ postgres_paths_location }}&quot; &quot;{{ postgres_paths_location }}_backup&quot;</span><span class="diff-line add">+          ansible.builtin.shell: mv &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_location&#x27;, role=&#x27;postgres&#x27;) }}&quot; &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_location&#x27;, role=&#x27;postgres&#x27;) }}_backup&quot;</span><span class="diff-line context"> </span><span class="diff-line context">         - name: Create directories</span><span class="diff-line context">           ansible.builtin.include_tasks: &quot;{{ resources_tasks_path }}/directories/create_directories.yml&quot;</span><span class="diff-line context"> </span><span class="diff-line del">-        - name: &quot;Create Docker container (Desired tag: {{ lookup(&#x27;vars&#x27;, postgres_name + &#x27;_docker_image_tag&#x27;, default=postgres_docker_image_tag) }})&quot;</span><span class="diff-line add">+        - name: &quot;Create Docker container (Desired tag: {{ lookup(&#x27;role_var&#x27;, &#x27;_docker_image_tag&#x27;, role=&#x27;postgres&#x27;) }})&quot;</span><span class="diff-line context">           ansible.builtin.include_tasks: &quot;{{ resources_tasks_path }}/docker/create_docker_container.yml&quot;</span><span class="diff-line context">           vars:</span><span class="diff-line del">-            postgres_docker_container: &quot;{{ postgres_name + &#x27;_new&#x27; }}&quot;</span><span class="diff-line del">-            postgres_docker_networks_alias: &quot;{{ postgres_name + &#x27;_new&#x27; }}&quot;</span><span class="diff-line add">+            postgres_role_docker_container: &quot;{{ postgres_name + &#x27;_new&#x27; }}&quot;</span><span class="diff-line add">+            postgres_role_docker_networks_alias: &quot;{{ postgres_name + &#x27;_new&#x27; }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context">         - name: &quot;Create Docker container (Previous tag: {{ postgres_major_version }}-alpine)&quot;</span><span class="diff-line context">           ansible.builtin.include_tasks: &quot;{{ resources_tasks_path }}/docker/create_docker_container.yml&quot;</span><span class="diff-line context">           vars:</span><span class="diff-line del">-            postgres_docker_container: &quot;{{ postgres_name + &#x27;_old&#x27; }}&quot;</span><span class="diff-line del">-            postgres_docker_networks_alias: &quot;{{ postgres_name + &#x27;_old&#x27; }}&quot;</span><span class="diff-line del">-            postgres_docker_image: &quot;{{ lookup(&#x27;vars&#x27;, postgres_name + &#x27;_docker_image_repo&#x27;, default=postgres_docker_image_repo)</span><span class="diff-line del">-                                      + &#x27;:&#x27; + postgres_major_version + &#x27;-alpine&#x27; }}&quot;</span><span class="diff-line del">-            postgres_docker_volumes_default:</span><span class="diff-line del">-              - &quot;{{ postgres_paths_location }}_backup:/data&quot;</span><span class="diff-line add">+            postgres_role_docker_container: &quot;{{ postgres_name + &#x27;_old&#x27; }}&quot;</span><span class="diff-line add">+            postgres_role_docker_networks_alias: &quot;{{ postgres_name + &#x27;_old&#x27; }}&quot;</span><span class="diff-line add">+            postgres_role_docker_image: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_image_repo&#x27;, role=&#x27;postgres&#x27;)</span><span class="diff-line add">+                                            + &#x27;:&#x27; + postgres_major_version + &#x27;-alpine&#x27; }}&quot;</span><span class="diff-line add">+            postgres_role_docker_volumes_default:</span><span class="diff-line add">+              - &quot;{{ postgres_role_paths_location }}_backup:/data&quot;</span><span class="diff-line context">               - &quot;/etc/passwd:/etc/passwd:ro&quot;</span><span class="diff-line context"> </span><span class="diff-line context">         - name: Sleep for 60 seconds</span><span class="diff-line hunk">@@ -111,13 +116,16 @@</span><span class="diff-line context"> </span><span class="diff-line context">         - name: Update user password for SCRAM authentication in new container</span><span class="diff-line context">           ansible.builtin.shell: |</span><span class="diff-line del">-            docker exec {{ postgres_name }}_new psql -U {{ lookup(&#x27;vars&#x27;, postgres_name + &#x27;_docker_env_user&#x27;, default=postgres_docker_env_user) }} -d {{ lookup(&#x27;vars&#x27;, postgres_name + &#x27;_docker_env_db&#x27;, default=postgres_docker_env_db) }} -c &quot;ALTER USER {{ lookup(&#x27;vars&#x27;, postgres_name + &#x27;_docker_env_user&#x27;, default=postgres_docker_env_user) }} WITH PASSWORD &#x27;{{ lookup(&#x27;vars&#x27;, postgres_name + &#x27;_docker_env_password&#x27;, default=postgres_docker_env_password) }}&#x27;;&quot;</span><span class="diff-line add">+            docker exec {{ postgres_name }}_new psql -U {{ lookup(&#x27;role_var&#x27;, &#x27;_docker_env_user&#x27;, role=&#x27;postgres&#x27;) }} -d {{ lookup(&#x27;role_var&#x27;, &#x27;_docker_env_db&#x27;, role=&#x27;postgres&#x27;) }} -c &quot;ALTER USER {{ lookup(&#x27;role_var&#x27;, &#x27;_docker_env_user&#x27;, role=&#x27;postgres&#x27;) }} WITH PASSWORD &#x27;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_env_password&#x27;, role=&#x27;postgres&#x27;) }}&#x27;;&quot;</span><span class="diff-line context">           when: (postgres_major_version | int &lt; 14) and (postgres_docker_tag_major_version | int &gt;= 14)</span><span class="diff-line context"> </span><span class="diff-line context">         - name: Remove temporary containers</span><span class="diff-line context">           community.docker.docker_container:</span><span class="diff-line context">             name: &quot;{{ item }}&quot;</span><span class="diff-line context">             state: absent</span><span class="diff-line add">+            container_default_behavior: compatibility</span><span class="diff-line add">+            stop_timeout: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_stop_timeout&#x27;, default=&#x27;180&#x27;) }}&quot;</span><span class="diff-line add">+            tls_hostname: localhost</span><span class="diff-line context">           loop:</span><span class="diff-line context">             - &quot;{{ postgres_name }}_old&quot;</span><span class="diff-line context">             - &quot;{{ postgres_name }}_new&quot;</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-284">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/pre_tasks/tasks/main.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -8,10 +8,10 @@</span><span class="diff-line context"> #########################################################################</span><span class="diff-line context"> ---</span><span class="diff-line context"> - name: APT Tasks</span><span class="diff-line del">-  ansible.builtin.import_tasks: &quot;subtasks/apt.yml&quot;</span><span class="diff-line add">+  ansible.builtin.include_tasks: &quot;subtasks/apt.yml&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Git Tasks</span><span class="diff-line del">-  ansible.builtin.import_tasks: &quot;subtasks/git.yml&quot;</span><span class="diff-line add">+  ansible.builtin.include_tasks: &quot;subtasks/git.yml&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Variables Tasks</span><span class="diff-line context">   ansible.builtin.include_tasks: &quot;subtasks/variables.yml&quot;</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-285">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/pre_tasks/tasks/subtasks/git.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -23,5 +23,5 @@</span><span class="diff-line context">   when: (&#x27;preinstall&#x27; in ansible_run_tags) or (not &#x27;/srv/git/sb&#x27; in git_config.stdout)</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Git | Set Sandbox repository as safe directory</span><span class="diff-line del">-  ansible.builtin.shell: git config --global --add safe.directory /opt/sandbox</span><span class="diff-line del">-  when: (&#x27;preinstall&#x27; in ansible_run_tags) or (not &#x27;/opt/sandbox&#x27; in git_config.stdout)</span><span class="diff-line add">+  ansible.builtin.shell: git config --global --add safe.directory {{ server_appdata_path }}/sandbox</span><span class="diff-line add">+  when: (&#x27;preinstall&#x27; in ansible_run_tags) or (not server_appdata_path + &#x27;/sandbox&#x27; in git_config.stdout)</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-286">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/pre_tasks/tasks/subtasks/variables.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -16,10 +16,10 @@</span><span class="diff-line context">   with_items: &quot;{{ pre_tasks_saltbox_roles.stdout_lines }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Sandbox</span><span class="diff-line del">-  when: (playbook_dir == &quot;/opt/saltbox_mod&quot;)</span><span class="diff-line add">+  when: (playbook_dir == pre_tasks_saltbox_mod_location)</span><span class="diff-line context">   block:</span><span class="diff-line context">     - name: Find Sandbox roles</span><span class="diff-line del">-      ansible.builtin.shell: &quot;find /opt/sandbox/roles -type d -name &#x27;defaults&#x27;&quot;</span><span class="diff-line add">+      ansible.builtin.shell: &quot;find {{ server_appdata_path }}/sandbox/roles -type d -name &#x27;defaults&#x27;&quot;</span><span class="diff-line context">       register: pre_tasks_sandbox_roles</span><span class="diff-line context"> </span><span class="diff-line context">     - name: Include Sandbox role default vars</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-287">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/prometheus/defaults/main.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -18,143 +18,112 @@</span><span class="diff-line context"> ################################</span><span class="diff-line context"> # https://prometheus.io/docs/prometheus/latest/storage/</span><span class="diff-line context"> </span><span class="diff-line del">-prometheus_retention: &quot;15d&quot;</span><span class="diff-line del">-prometheus_size: &quot;0&quot;</span><span class="diff-line add">+prometheus_role_retention: &quot;15d&quot;</span><span class="diff-line add">+prometheus_role_size: &quot;0&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # Paths</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-prometheus_paths_folder: &quot;{{ prometheus_name }}&quot;</span><span class="diff-line del">-prometheus_paths_location: &quot;{{ server_appdata_path }}/{{ prometheus_paths_folder }}&quot;</span><span class="diff-line del">-prometheus_config_path: &quot;{{ prometheus_paths_location }}/prometheus.yml&quot;</span><span class="diff-line del">-prometheus_paths_folders_list:</span><span class="diff-line del">-  - &quot;{{ prometheus_paths_location }}&quot;</span><span class="diff-line del">-  - &quot;{{ prometheus_paths_location }}/data&quot;</span><span class="diff-line add">+prometheus_role_paths_folder: &quot;{{ prometheus_name }}&quot;</span><span class="diff-line add">+prometheus_role_paths_location: &quot;{{ server_appdata_path }}/{{ prometheus_role_paths_folder }}&quot;</span><span class="diff-line add">+prometheus_role_paths_config_path: &quot;{{ prometheus_role_paths_location }}/prometheus.yml&quot;</span><span class="diff-line add">+prometheus_role_paths_folders_list:</span><span class="diff-line add">+  - &quot;{{ prometheus_role_paths_location }}&quot;</span><span class="diff-line add">+  - &quot;{{ prometheus_role_paths_location }}/data&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # Web</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-prometheus_web_subdomain: &quot;{{ prometheus_name }}&quot;</span><span class="diff-line del">-prometheus_web_domain: &quot;{{ user.domain }}&quot;</span><span class="diff-line del">-prometheus_web_port: &quot;9090&quot;</span><span class="diff-line del">-prometheus_web_url: &quot;{{ &#x27;https://&#x27; + (prometheus_web_subdomain + &#x27;.&#x27; + prometheus_web_domain</span><span class="diff-line del">-                     if (prometheus_web_subdomain | length &gt; 0)</span><span class="diff-line del">-                     else prometheus_web_domain) }}&quot;</span><span class="diff-line add">+prometheus_role_web_subdomain: &quot;{{ prometheus_name }}&quot;</span><span class="diff-line add">+prometheus_role_web_domain: &quot;{{ user.domain }}&quot;</span><span class="diff-line add">+prometheus_role_web_port: &quot;9090&quot;</span><span class="diff-line add">+prometheus_role_web_url: &quot;{{ &#x27;https://&#x27; + (lookup(&#x27;role_var&#x27;, &#x27;_web_subdomain&#x27;, role=&#x27;prometheus&#x27;) + &#x27;.&#x27; + lookup(&#x27;role_var&#x27;, &#x27;_web_domain&#x27;, role=&#x27;prometheus&#x27;)</span><span class="diff-line add">+                          if (lookup(&#x27;role_var&#x27;, &#x27;_web_subdomain&#x27;, role=&#x27;prometheus&#x27;) | length &gt; 0)</span><span class="diff-line add">+                          else lookup(&#x27;role_var&#x27;, &#x27;_web_domain&#x27;, role=&#x27;prometheus&#x27;)) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # DNS</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-prometheus_dns_record: &quot;{{ prometheus_web_subdomain }}&quot;</span><span class="diff-line del">-prometheus_dns_zone: &quot;{{ prometheus_web_domain }}&quot;</span><span class="diff-line del">-prometheus_dns_proxy: &quot;{{ dns.proxied }}&quot;</span><span class="diff-line add">+prometheus_role_dns_record: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_web_subdomain&#x27;, role=&#x27;prometheus&#x27;) }}&quot;</span><span class="diff-line add">+prometheus_role_dns_zone: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_web_domain&#x27;, role=&#x27;prometheus&#x27;) }}&quot;</span><span class="diff-line add">+prometheus_role_dns_proxy: &quot;{{ dns_proxied }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # Traefik</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-prometheus_traefik_sso_middleware: &quot;&quot;</span><span class="diff-line del">-prometheus_traefik_middleware_default: &quot;{{ traefik_default_middleware + &#x27;,prometheus-auth&#x27; }}&quot;</span><span class="diff-line del">-prometheus_traefik_middleware_custom: &quot;&quot;</span><span class="diff-line del">-prometheus_traefik_certresolver: &quot;{{ traefik_default_certresolver }}&quot;</span><span class="diff-line del">-prometheus_traefik_enabled: true</span><span class="diff-line del">-prometheus_traefik_api_enabled: false</span><span class="diff-line del">-prometheus_traefik_api_endpoint: &quot;&quot;</span><span class="diff-line add">+prometheus_role_traefik_sso_middleware: &quot;&quot;</span><span class="diff-line add">+prometheus_role_traefik_middleware_default: &quot;{{ traefik_default_middleware + &#x27;,prometheus-auth&#x27; }}&quot;</span><span class="diff-line add">+prometheus_role_traefik_middleware_custom: &quot;&quot;</span><span class="diff-line add">+prometheus_role_traefik_certresolver: &quot;{{ traefik_default_certresolver }}&quot;</span><span class="diff-line add">+prometheus_role_traefik_enabled: true</span><span class="diff-line add">+prometheus_role_traefik_api_enabled: false</span><span class="diff-line add">+prometheus_role_traefik_api_endpoint: &quot;&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # Docker</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line context"> # Container</span><span class="diff-line del">-prometheus_docker_container: &quot;{{ prometheus_name }}&quot;</span><span class="diff-line add">+prometheus_role_docker_container: &quot;{{ prometheus_name }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Image</span><span class="diff-line del">-prometheus_docker_image_pull: true</span><span class="diff-line del">-prometheus_docker_image_tag: &quot;latest&quot;</span><span class="diff-line del">-prometheus_docker_image: &quot;prom/prometheus:{{ prometheus_docker_image_tag }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Ports</span><span class="diff-line del">-prometheus_docker_ports_defaults: []</span><span class="diff-line del">-prometheus_docker_ports_custom: []</span><span class="diff-line del">-prometheus_docker_ports: &quot;{{ prometheus_docker_ports_defaults</span><span class="diff-line del">-                             + prometheus_docker_ports_custom }}&quot;</span><span class="diff-line add">+prometheus_role_docker_image_pull: true</span><span class="diff-line add">+prometheus_role_docker_image_tag: &quot;latest&quot;</span><span class="diff-line add">+prometheus_role_docker_image_repo: &quot;prom/prometheus&quot;</span><span class="diff-line add">+prometheus_role_docker_image: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_image_repo&#x27;, role=&#x27;prometheus&#x27;) }}:{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_image_tag&#x27;, role=&#x27;prometheus&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Envs</span><span class="diff-line del">-prometheus_docker_envs_default:</span><span class="diff-line add">+prometheus_role_docker_envs_default:</span><span class="diff-line context">   TZ: &quot;{{ tz }}&quot;</span><span class="diff-line del">-prometheus_docker_envs_custom: {}</span><span class="diff-line del">-prometheus_docker_envs: &quot;{{ prometheus_docker_envs_default</span><span class="diff-line del">-                            | combine(prometheus_docker_envs_custom) }}&quot;</span><span class="diff-line add">+prometheus_role_docker_envs_custom: {}</span><span class="diff-line add">+prometheus_role_docker_envs: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_envs_default&#x27;, role=&#x27;prometheus&#x27;)</span><span class="diff-line add">+                                 | combine(lookup(&#x27;role_var&#x27;, &#x27;_docker_envs_custom&#x27;, role=&#x27;prometheus&#x27;)) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Commands</span><span class="diff-line del">-prometheus_docker_commands_default:</span><span class="diff-line add">+prometheus_role_docker_commands_default:</span><span class="diff-line context">   - &quot;--config.file=/etc/prometheus/prometheus.yml&quot;</span><span class="diff-line context">   - &quot;--storage.tsdb.path=/data&quot;</span><span class="diff-line del">-  - &quot;--storage.tsdb.retention.time={{ prometheus_retention }}&quot;</span><span class="diff-line del">-  - &quot;--storage.tsdb.retention.size={{ prometheus_size }}&quot;</span><span class="diff-line del">-prometheus_docker_commands_custom: []</span><span class="diff-line del">-prometheus_docker_commands: &quot;{{ prometheus_docker_commands_default</span><span class="diff-line del">-                                + prometheus_docker_commands_custom }}&quot;</span><span class="diff-line add">+  - &quot;--storage.tsdb.retention.time={{ lookup(&#x27;role_var&#x27;, &#x27;_retention&#x27;, role=&#x27;prometheus&#x27;) }}&quot;</span><span class="diff-line add">+  - &quot;--storage.tsdb.retention.size={{ lookup(&#x27;role_var&#x27;, &#x27;_size&#x27;, role=&#x27;prometheus&#x27;) }}&quot;</span><span class="diff-line add">+prometheus_role_docker_commands_custom: []</span><span class="diff-line add">+prometheus_role_docker_commands: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_commands_default&#x27;, role=&#x27;prometheus&#x27;)</span><span class="diff-line add">+                                     + lookup(&#x27;role_var&#x27;, &#x27;_docker_commands_custom&#x27;, role=&#x27;prometheus&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Volumes</span><span class="diff-line del">-prometheus_docker_volumes_default:</span><span class="diff-line del">-  - &quot;{{ prometheus_paths_location }}:/etc/prometheus&quot;</span><span class="diff-line del">-  - &quot;{{ prometheus_paths_location }}/data:/data&quot;</span><span class="diff-line del">-prometheus_docker_volumes_custom: []</span><span class="diff-line del">-prometheus_docker_volumes: &quot;{{ prometheus_docker_volumes_default</span><span class="diff-line del">-                               + prometheus_docker_volumes_custom }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Devices</span><span class="diff-line del">-prometheus_docker_devices_default: []</span><span class="diff-line del">-prometheus_docker_devices_custom: []</span><span class="diff-line del">-prometheus_docker_devices: &quot;{{ prometheus_docker_devices_default</span><span class="diff-line del">-                               + prometheus_docker_devices_custom }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Hosts</span><span class="diff-line del">-prometheus_docker_hosts_default: {}</span><span class="diff-line del">-prometheus_docker_hosts_custom: {}</span><span class="diff-line del">-prometheus_docker_hosts: &quot;{{ docker_hosts_common</span><span class="diff-line del">-                             | combine(prometheus_docker_hosts_default)</span><span class="diff-line del">-                             | combine(prometheus_docker_hosts_custom) }}&quot;</span><span class="diff-line add">+prometheus_role_docker_volumes_default:</span><span class="diff-line add">+  - &quot;{{ prometheus_role_paths_location }}:/etc/prometheus&quot;</span><span class="diff-line add">+  - &quot;{{ prometheus_role_paths_location }}/data:/data&quot;</span><span class="diff-line add">+prometheus_role_docker_volumes_custom: []</span><span class="diff-line add">+prometheus_role_docker_volumes: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_volumes_default&#x27;, role=&#x27;prometheus&#x27;)</span><span class="diff-line add">+                                    + lookup(&#x27;role_var&#x27;, &#x27;_docker_volumes_custom&#x27;, role=&#x27;prometheus&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Labels</span><span class="diff-line del">-prometheus_docker_labels_default:</span><span class="diff-line add">+prometheus_role_docker_labels_default:</span><span class="diff-line context">   traefik.http.middlewares.prometheus-auth.basicauth.usersfile: &quot;/etc/traefik/auth&quot;</span><span class="diff-line del">-prometheus_docker_labels_custom: {}</span><span class="diff-line del">-prometheus_docker_labels: &quot;{{ docker_labels_common</span><span class="diff-line del">-                              | combine(prometheus_docker_labels_default)</span><span class="diff-line del">-                              | combine(prometheus_docker_labels_custom) }}&quot;</span><span class="diff-line add">+prometheus_role_docker_labels_custom: {}</span><span class="diff-line add">+prometheus_role_docker_labels: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_labels_default&#x27;, role=&#x27;prometheus&#x27;)</span><span class="diff-line add">+                                   | combine(lookup(&#x27;role_var&#x27;, &#x27;_docker_labels_custom&#x27;, role=&#x27;prometheus&#x27;)) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Hostname</span><span class="diff-line del">-prometheus_docker_hostname: &quot;{{ prometheus_name }}&quot;</span><span class="diff-line add">+prometheus_role_docker_hostname: &quot;{{ prometheus_name }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Networks</span><span class="diff-line del">-prometheus_docker_networks_alias: &quot;{{ prometheus_name }}&quot;</span><span class="diff-line del">-prometheus_docker_networks_default: []</span><span class="diff-line del">-prometheus_docker_networks_custom: []</span><span class="diff-line del">-prometheus_docker_networks: &quot;{{ docker_networks_common</span><span class="diff-line del">-                                + prometheus_docker_networks_default</span><span class="diff-line del">-                                + prometheus_docker_networks_custom }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Capabilities</span><span class="diff-line del">-prometheus_docker_capabilities_default: []</span><span class="diff-line del">-prometheus_docker_capabilities_custom: []</span><span class="diff-line del">-prometheus_docker_capabilities: &quot;{{ prometheus_docker_capabilities_default</span><span class="diff-line del">-                                    + prometheus_docker_capabilities_custom }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Security Opts</span><span class="diff-line del">-prometheus_docker_security_opts_default: []</span><span class="diff-line del">-prometheus_docker_security_opts_custom: []</span><span class="diff-line del">-prometheus_docker_security_opts: &quot;{{ prometheus_docker_security_opts_default</span><span class="diff-line del">-                                     + prometheus_docker_security_opts_custom }}&quot;</span><span class="diff-line add">+prometheus_role_docker_networks_alias: &quot;{{ prometheus_name }}&quot;</span><span class="diff-line add">+prometheus_role_docker_networks_default: []</span><span class="diff-line add">+prometheus_role_docker_networks_custom: []</span><span class="diff-line add">+prometheus_role_docker_networks: &quot;{{ docker_networks_common</span><span class="diff-line add">+                                     + lookup(&#x27;role_var&#x27;, &#x27;_docker_networks_default&#x27;, role=&#x27;prometheus&#x27;)</span><span class="diff-line add">+                                     + lookup(&#x27;role_var&#x27;, &#x27;_docker_networks_custom&#x27;, role=&#x27;prometheus&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Restart Policy</span><span class="diff-line del">-prometheus_docker_restart_policy: unless-stopped</span><span class="diff-line add">+prometheus_role_docker_restart_policy: unless-stopped</span><span class="diff-line context"> </span><span class="diff-line context"> # State</span><span class="diff-line del">-prometheus_docker_state: started</span><span class="diff-line add">+prometheus_role_docker_state: started</span><span class="diff-line context"> </span><span class="diff-line context"> # User</span><span class="diff-line del">-prometheus_docker_user: &quot;{{ uid }}:{{ gid }}&quot;</span><span class="diff-line add">+prometheus_role_docker_user: &quot;{{ uid }}:{{ gid }}&quot;</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-288">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/prometheus/tasks/main.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -18,9 +18,9 @@</span><span class="diff-line context"> - name: Add DNS record</span><span class="diff-line context">   ansible.builtin.include_tasks: &quot;{{ resources_tasks_path }}/dns/tasker.yml&quot;</span><span class="diff-line context">   vars:</span><span class="diff-line del">-    dns_record: &quot;{{ lookup(&#x27;vars&#x27;, role_name + &#x27;_dns_record&#x27;) }}&quot;</span><span class="diff-line del">-    dns_zone: &quot;{{ lookup(&#x27;vars&#x27;, role_name + &#x27;_dns_zone&#x27;) }}&quot;</span><span class="diff-line del">-    dns_proxy: &quot;{{ lookup(&#x27;vars&#x27;, role_name + &#x27;_dns_proxy&#x27;) }}&quot;</span><span class="diff-line add">+    dns_record: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_dns_record&#x27;) }}&quot;</span><span class="diff-line add">+    dns_zone: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_dns_zone&#x27;) }}&quot;</span><span class="diff-line add">+    dns_proxy: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_dns_proxy&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Remove existing Docker container</span><span class="diff-line context">   ansible.builtin.include_tasks: &quot;{{ resources_tasks_path }}/docker/remove_docker_container.yml&quot;</span><span class="diff-line hunk">@@ -31,7 +31,7 @@</span><span class="diff-line context"> - name: Import &#x27;prometheus.yml&#x27;</span><span class="diff-line context">   ansible.builtin.template:</span><span class="diff-line context">     src: prometheus.yml.j2</span><span class="diff-line del">-    dest: &quot;{{ prometheus_config_path }}&quot;</span><span class="diff-line add">+    dest: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_config_path&#x27;, role=&#x27;prometheus&#x27;) }}&quot;</span><span class="diff-line context">     owner: &quot;{{ user.name }}&quot;</span><span class="diff-line context">     group: &quot;{{ user.name }}&quot;</span><span class="diff-line context">     mode: &quot;0644&quot;</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-289">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/prometheus/templates/prometheus.yml.j2</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -10,7 +10,7 @@</span><span class="diff-line context">     static_configs:</span><span class="diff-line context">       - targets: [&#x27;cadvisor:8080&#x27;]</span><span class="diff-line context"> </span><span class="diff-line del">-{% if traefik.metrics %}</span><span class="diff-line add">+{% if lookup(&#x27;role_var&#x27;, &#x27;_metrics_enabled&#x27;, role=&#x27;traefik&#x27;) %}</span><span class="diff-line context">   - job_name: traefik</span><span class="diff-line context">     scheme: https</span><span class="diff-line context">     metrics_path: /prometheus</span><span class="diff-line hunk">@@ -18,5 +18,5 @@</span><span class="diff-line context">         username: &#x27;{{ user.name }}&#x27;</span><span class="diff-line context">         password: &#x27;{{ user.pass }}&#x27;</span><span class="diff-line context">     static_configs:</span><span class="diff-line del">-      - targets: [&#x27;{{ traefik_metrics_subdomain }}.{{ traefik_metrics_domain }}&#x27;]</span><span class="diff-line add">+      - targets: [&#x27;{{ lookup(&#x27;role_var&#x27;, &#x27;_metrics_subdomain&#x27;, role=&#x27;traefik&#x27;) }}.{{ lookup(&#x27;role_var&#x27;, &#x27;_metrics_domain&#x27;, role=&#x27;traefik&#x27;) }}&#x27;]</span><span class="diff-line context"> {% endif %}</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-290">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/prowlarr/defaults/main.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -17,151 +17,114 @@</span><span class="diff-line context"> # Settings</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-prowlarr_external_auth: true</span><span class="diff-line add">+prowlarr_role_external_auth: true</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # Paths</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-prowlarr_paths_folder: &quot;{{ prowlarr_name }}&quot;</span><span class="diff-line del">-prowlarr_paths_location: &quot;{{ server_appdata_path }}/{{ prowlarr_paths_folder }}&quot;</span><span class="diff-line del">-prowlarr_paths_folders_list:</span><span class="diff-line del">-  - &quot;{{ prowlarr_paths_location }}&quot;</span><span class="diff-line add">+prowlarr_role_paths_folder: &quot;{{ prowlarr_name }}&quot;</span><span class="diff-line add">+prowlarr_role_paths_location: &quot;{{ server_appdata_path }}/{{ prowlarr_role_paths_folder }}&quot;</span><span class="diff-line add">+prowlarr_role_paths_folders_list:</span><span class="diff-line add">+  - &quot;{{ prowlarr_role_paths_location }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # Web</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-prowlarr_web_subdomain: &quot;{{ prowlarr_name }}&quot;</span><span class="diff-line del">-prowlarr_web_domain: &quot;{{ user.domain }}&quot;</span><span class="diff-line del">-prowlarr_web_port: &quot;9696&quot;</span><span class="diff-line del">-prowlarr_web_url: &quot;{{ &#x27;https://&#x27; + (prowlarr_web_subdomain + &#x27;.&#x27; + prowlarr_web_domain</span><span class="diff-line del">-                   if (prowlarr_web_subdomain | length &gt; 0)</span><span class="diff-line del">-                   else prowlarr_web_domain) }}&quot;</span><span class="diff-line add">+prowlarr_role_web_subdomain: &quot;{{ prowlarr_name }}&quot;</span><span class="diff-line add">+prowlarr_role_web_domain: &quot;{{ user.domain }}&quot;</span><span class="diff-line add">+prowlarr_role_web_port: &quot;9696&quot;</span><span class="diff-line add">+prowlarr_role_web_url: &quot;{{ &#x27;https://&#x27; + (lookup(&#x27;role_var&#x27;, &#x27;_web_subdomain&#x27;, role=&#x27;prowlarr&#x27;) + &#x27;.&#x27; + lookup(&#x27;role_var&#x27;, &#x27;_web_domain&#x27;, role=&#x27;prowlarr&#x27;)</span><span class="diff-line add">+                        if (lookup(&#x27;role_var&#x27;, &#x27;_web_subdomain&#x27;, role=&#x27;prowlarr&#x27;) | length &gt; 0)</span><span class="diff-line add">+                        else lookup(&#x27;role_var&#x27;, &#x27;_web_domain&#x27;, role=&#x27;prowlarr&#x27;)) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # DNS</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-prowlarr_dns_record: &quot;{{ prowlarr_web_subdomain }}&quot;</span><span class="diff-line del">-prowlarr_dns_zone: &quot;{{ prowlarr_web_domain }}&quot;</span><span class="diff-line del">-prowlarr_dns_proxy: &quot;{{ dns.proxied }}&quot;</span><span class="diff-line add">+prowlarr_role_dns_record: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_web_subdomain&#x27;, role=&#x27;prowlarr&#x27;) }}&quot;</span><span class="diff-line add">+prowlarr_role_dns_zone: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_web_domain&#x27;, role=&#x27;prowlarr&#x27;) }}&quot;</span><span class="diff-line add">+prowlarr_role_dns_proxy: &quot;{{ dns_proxied }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # Traefik</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-prowlarr_traefik_sso_middleware: &quot;{{ traefik_default_sso_middleware }}&quot;</span><span class="diff-line del">-prowlarr_traefik_middleware_default: &quot;{{ traefik_default_middleware</span><span class="diff-line del">-                                        + (&#x27;,themepark-&#x27; + lookup(&#x27;vars&#x27;, prowlarr_name + &#x27;_name&#x27;, default=prowlarr_name)</span><span class="diff-line del">-                                          if (prowlarr_themepark_enabled and global_themepark_plugin_enabled)</span><span class="diff-line del">-                                          else &#x27;&#x27;) }}&quot;</span><span class="diff-line del">-prowlarr_traefik_middleware_custom: &quot;&quot;</span><span class="diff-line del">-prowlarr_traefik_certresolver: &quot;{{ traefik_default_certresolver }}&quot;</span><span class="diff-line del">-prowlarr_traefik_enabled: true</span><span class="diff-line del">-prowlarr_traefik_api_enabled: true</span><span class="diff-line del">-prowlarr_traefik_api_endpoint: &quot;PathRegexp(`/[0-9]+/api`) || PathRegexp(`/[0-9]+/download`) || PathPrefix(`/api`) || PathPrefix(`/ping`)&quot;</span><span class="diff-line add">+prowlarr_role_traefik_sso_middleware: &quot;{{ traefik_default_sso_middleware }}&quot;</span><span class="diff-line add">+prowlarr_role_traefik_middleware_default: &quot;{{ traefik_default_middleware</span><span class="diff-line add">+                                              + (&#x27;,themepark-&#x27; + prowlarr_name</span><span class="diff-line add">+                                                if (lookup(&#x27;role_var&#x27;, &#x27;_themepark_enabled&#x27;, role=&#x27;prowlarr&#x27;) and global_themepark_plugin_enabled)</span><span class="diff-line add">+                                                else &#x27;&#x27;) }}&quot;</span><span class="diff-line add">+prowlarr_role_traefik_middleware_custom: &quot;&quot;</span><span class="diff-line add">+prowlarr_role_traefik_certresolver: &quot;{{ traefik_default_certresolver }}&quot;</span><span class="diff-line add">+prowlarr_role_traefik_enabled: true</span><span class="diff-line add">+prowlarr_role_traefik_api_enabled: true</span><span class="diff-line add">+prowlarr_role_traefik_api_endpoint: &quot;PathRegexp(`/[0-9]+/api`) || PathRegexp(`/[0-9]+/download`) || PathPrefix(`/api`) || PathPrefix(`/ping`)&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line del">-# THEME</span><span class="diff-line add">+# Theme</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line context"> # Options can be found at https://github.com/themepark-dev/theme.park</span><span class="diff-line del">-prowlarr_themepark_enabled: false</span><span class="diff-line del">-prowlarr_themepark_app: &quot;prowlarr&quot;</span><span class="diff-line del">-prowlarr_themepark_theme: &quot;{{ global_themepark_theme }}&quot;</span><span class="diff-line del">-prowlarr_themepark_domain: &quot;{{ global_themepark_domain }}&quot;</span><span class="diff-line del">-prowlarr_themepark_addons: []</span><span class="diff-line add">+prowlarr_role_themepark_enabled: false</span><span class="diff-line add">+prowlarr_role_themepark_app: &quot;prowlarr&quot;</span><span class="diff-line add">+prowlarr_role_themepark_theme: &quot;{{ global_themepark_theme }}&quot;</span><span class="diff-line add">+prowlarr_role_themepark_domain: &quot;{{ global_themepark_domain }}&quot;</span><span class="diff-line add">+prowlarr_role_themepark_addons: []</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # Docker</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line context"> # Container</span><span class="diff-line del">-prowlarr_docker_container: &quot;{{ prowlarr_name }}&quot;</span><span class="diff-line add">+prowlarr_role_docker_container: &quot;{{ prowlarr_name }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Image</span><span class="diff-line del">-prowlarr_docker_image_pull: true</span><span class="diff-line del">-prowlarr_docker_image_tag: &quot;release&quot;</span><span class="diff-line del">-prowlarr_docker_image: &quot;ghcr.io/hotio/prowlarr:{{ prowlarr_docker_image_tag }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Ports</span><span class="diff-line del">-prowlarr_docker_ports_defaults: []</span><span class="diff-line del">-prowlarr_docker_ports_custom: []</span><span class="diff-line del">-prowlarr_docker_ports: &quot;{{ prowlarr_docker_ports_defaults</span><span class="diff-line del">-                           + prowlarr_docker_ports_custom }}&quot;</span><span class="diff-line add">+prowlarr_role_docker_image_pull: true</span><span class="diff-line add">+prowlarr_role_docker_image_tag: &quot;release&quot;</span><span class="diff-line add">+prowlarr_role_docker_image_repo: &quot;ghcr.io/hotio/prowlarr&quot;</span><span class="diff-line add">+prowlarr_role_docker_image: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_image_repo&#x27;, role=&#x27;prowlarr&#x27;) }}:{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_image_tag&#x27;, role=&#x27;prowlarr&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Envs</span><span class="diff-line del">-prowlarr_docker_envs_default:</span><span class="diff-line add">+prowlarr_role_docker_envs_default:</span><span class="diff-line context">   PUID: &quot;{{ uid }}&quot;</span><span class="diff-line context">   PGID: &quot;{{ gid }}&quot;</span><span class="diff-line context">   UMASK: &quot;002&quot;</span><span class="diff-line context">   TZ: &quot;{{ tz }}&quot;</span><span class="diff-line del">-prowlarr_docker_envs_custom: {}</span><span class="diff-line del">-prowlarr_docker_envs: &quot;{{ prowlarr_docker_envs_default</span><span class="diff-line del">-                          | combine(prowlarr_docker_envs_custom) }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Commands</span><span class="diff-line del">-prowlarr_docker_commands_default: []</span><span class="diff-line del">-prowlarr_docker_commands_custom: []</span><span class="diff-line del">-prowlarr_docker_commands: &quot;{{ prowlarr_docker_commands_default</span><span class="diff-line del">-                              + prowlarr_docker_commands_custom }}&quot;</span><span class="diff-line add">+prowlarr_role_docker_envs_custom: {}</span><span class="diff-line add">+prowlarr_role_docker_envs: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_envs_default&#x27;, role=&#x27;prowlarr&#x27;)</span><span class="diff-line add">+                               | combine(lookup(&#x27;role_var&#x27;, &#x27;_docker_envs_custom&#x27;, role=&#x27;prowlarr&#x27;)) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Volumes</span><span class="diff-line del">-prowlarr_docker_volumes_default:</span><span class="diff-line del">-  - &quot;{{ prowlarr_paths_location }}:/config&quot;</span><span class="diff-line del">-prowlarr_docker_volumes_custom: []</span><span class="diff-line del">-prowlarr_docker_volumes: &quot;{{ prowlarr_docker_volumes_default</span><span class="diff-line del">-                             + prowlarr_docker_volumes_custom }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Devices</span><span class="diff-line del">-prowlarr_docker_devices_default: []</span><span class="diff-line del">-prowlarr_docker_devices_custom: []</span><span class="diff-line del">-prowlarr_docker_devices: &quot;{{ prowlarr_docker_devices_default</span><span class="diff-line del">-                             + prowlarr_docker_devices_custom }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Hosts</span><span class="diff-line del">-prowlarr_docker_hosts_default: {}</span><span class="diff-line del">-prowlarr_docker_hosts_custom: {}</span><span class="diff-line del">-prowlarr_docker_hosts: &quot;{{ docker_hosts_common</span><span class="diff-line del">-                           | combine(prowlarr_docker_hosts_default)</span><span class="diff-line del">-                           | combine(prowlarr_docker_hosts_custom) }}&quot;</span><span class="diff-line add">+prowlarr_role_docker_volumes_default:</span><span class="diff-line add">+  - &quot;{{ prowlarr_role_paths_location }}:/config&quot;</span><span class="diff-line add">+prowlarr_role_docker_volumes_custom: []</span><span class="diff-line add">+prowlarr_role_docker_volumes: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_volumes_default&#x27;, role=&#x27;prowlarr&#x27;)</span><span class="diff-line add">+                                  + lookup(&#x27;role_var&#x27;, &#x27;_docker_volumes_custom&#x27;, role=&#x27;prowlarr&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Labels</span><span class="diff-line del">-prowlarr_docker_labels_default: {}</span><span class="diff-line del">-prowlarr_docker_labels_custom: {}</span><span class="diff-line del">-prowlarr_docker_labels: &quot;{{ docker_labels_common</span><span class="diff-line del">-                            | combine(lookup(&#x27;vars&#x27;, prowlarr_name + &#x27;_docker_labels_default&#x27;, default=prowlarr_docker_labels_default))</span><span class="diff-line del">-                            | combine((traefik_themepark_labels</span><span class="diff-line del">-                                      if (prowlarr_themepark_enabled and global_themepark_plugin_enabled)</span><span class="diff-line del">-                                      else {}),</span><span class="diff-line del">-                                      lookup(&#x27;vars&#x27;, prowlarr_name + &#x27;_docker_labels_custom&#x27;, default=prowlarr_docker_labels_custom)) }}&quot;</span><span class="diff-line add">+prowlarr_role_docker_labels_default: {}</span><span class="diff-line add">+prowlarr_role_docker_labels_custom: {}</span><span class="diff-line add">+prowlarr_role_docker_labels: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_labels_default&#x27;, role=&#x27;prowlarr&#x27;)</span><span class="diff-line add">+                                 | combine((traefik_themepark_labels</span><span class="diff-line add">+                                           if (lookup(&#x27;role_var&#x27;, &#x27;_themepark_enabled&#x27;, role=&#x27;prowlarr&#x27;) and global_themepark_plugin_enabled)</span><span class="diff-line add">+                                           else {}),</span><span class="diff-line add">+                                           lookup(&#x27;role_var&#x27;, &#x27;_docker_labels_custom&#x27;, role=&#x27;prowlarr&#x27;)) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Hostname</span><span class="diff-line del">-prowlarr_docker_hostname: &quot;{{ prowlarr_name }}&quot;</span><span class="diff-line add">+prowlarr_role_docker_hostname: &quot;{{ prowlarr_name }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Networks</span><span class="diff-line del">-prowlarr_docker_networks_alias: &quot;{{ prowlarr_name }}&quot;</span><span class="diff-line del">-prowlarr_docker_networks_default: []</span><span class="diff-line del">-prowlarr_docker_networks_custom: []</span><span class="diff-line del">-prowlarr_docker_networks: &quot;{{ docker_networks_common</span><span class="diff-line del">-                              + prowlarr_docker_networks_default</span><span class="diff-line del">-                              + prowlarr_docker_networks_custom }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Capabilities</span><span class="diff-line del">-prowlarr_docker_capabilities_default: []</span><span class="diff-line del">-prowlarr_docker_capabilities_custom: []</span><span class="diff-line del">-prowlarr_docker_capabilities: &quot;{{ prowlarr_docker_capabilities_default</span><span class="diff-line del">-                                  + prowlarr_docker_capabilities_custom }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Security Opts</span><span class="diff-line del">-prowlarr_docker_security_opts_default: []</span><span class="diff-line del">-prowlarr_docker_security_opts_custom: []</span><span class="diff-line del">-prowlarr_docker_security_opts: &quot;{{ prowlarr_docker_security_opts_default</span><span class="diff-line del">-                                   + prowlarr_docker_security_opts_custom }}&quot;</span><span class="diff-line add">+prowlarr_role_docker_networks_alias: &quot;{{ prowlarr_name }}&quot;</span><span class="diff-line add">+prowlarr_role_docker_networks_default: []</span><span class="diff-line add">+prowlarr_role_docker_networks_custom: []</span><span class="diff-line add">+prowlarr_role_docker_networks: &quot;{{ docker_networks_common</span><span class="diff-line add">+                                   + lookup(&#x27;role_var&#x27;, &#x27;_docker_networks_default&#x27;, role=&#x27;prowlarr&#x27;)</span><span class="diff-line add">+                                   + lookup(&#x27;role_var&#x27;, &#x27;_docker_networks_custom&#x27;, role=&#x27;prowlarr&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Restart Policy</span><span class="diff-line del">-prowlarr_docker_restart_policy: unless-stopped</span><span class="diff-line add">+prowlarr_role_docker_restart_policy: unless-stopped</span><span class="diff-line context"> </span><span class="diff-line context"> # State</span><span class="diff-line del">-prowlarr_docker_state: started</span><span class="diff-line add">+prowlarr_role_docker_state: started</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-291">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/prowlarr/tasks/main.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -10,9 +10,9 @@</span><span class="diff-line context"> - name: Add DNS record</span><span class="diff-line context">   ansible.builtin.include_tasks: &quot;{{ resources_tasks_path }}/dns/tasker.yml&quot;</span><span class="diff-line context">   vars:</span><span class="diff-line del">-    dns_record: &quot;{{ lookup(&#x27;vars&#x27;, role_name + &#x27;_dns_record&#x27;) }}&quot;</span><span class="diff-line del">-    dns_zone: &quot;{{ lookup(&#x27;vars&#x27;, role_name + &#x27;_dns_zone&#x27;) }}&quot;</span><span class="diff-line del">-    dns_proxy: &quot;{{ lookup(&#x27;vars&#x27;, role_name + &#x27;_dns_proxy&#x27;) }}&quot;</span><span class="diff-line add">+    dns_record: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_dns_record&#x27;) }}&quot;</span><span class="diff-line add">+    dns_zone: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_dns_zone&#x27;) }}&quot;</span><span class="diff-line add">+    dns_proxy: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_dns_proxy&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Remove existing Docker container</span><span class="diff-line context">   ansible.builtin.include_tasks: &quot;{{ resources_tasks_path }}/docker/remove_docker_container.yml&quot;</span><span class="diff-line hunk">@@ -24,5 +24,5 @@</span><span class="diff-line context">   ansible.builtin.include_tasks: &quot;{{ resources_tasks_path }}/docker/create_docker_container.yml&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: &quot;Tweak Settings when SSO is enabled&quot;</span><span class="diff-line del">-  ansible.builtin.import_tasks: &quot;subtasks/auth.yml&quot;</span><span class="diff-line del">-  when: (prowlarr_traefik_sso_middleware | length &gt; 0) and prowlarr_external_auth</span><span class="diff-line add">+  ansible.builtin.include_tasks: &quot;subtasks/auth.yml&quot;</span><span class="diff-line add">+  when: (lookup(&#x27;role_var&#x27;, &#x27;_traefik_sso_middleware&#x27;, role=&#x27;prowlarr&#x27;) | length &gt; 0) and lookup(&#x27;role_var&#x27;, &#x27;_external_auth&#x27;, role=&#x27;prowlarr&#x27;)</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-292">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/prowlarr/tasks/subtasks/auth.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -9,7 +9,7 @@</span><span class="diff-line context"> ---</span><span class="diff-line context"> - name: Auth | Wait for &#x27;config.xml&#x27; to be created</span><span class="diff-line context">   ansible.builtin.wait_for:</span><span class="diff-line del">-    path: &quot;/opt/{{ prowlarr_name }}/config.xml&quot;</span><span class="diff-line add">+    path: &quot;{{ server_appdata_path }}/{{ prowlarr_name }}/config.xml&quot;</span><span class="diff-line context">     state: present</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Auth | Wait for 10 seconds</span><span class="diff-line hunk">@@ -18,7 +18,7 @@</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Auth | Lookup AuthenticationMethod value</span><span class="diff-line context">   community.general.xml:</span><span class="diff-line del">-    path: &quot;/opt/{{ prowlarr_name }}/config.xml&quot;</span><span class="diff-line add">+    path: &quot;{{ server_appdata_path }}/{{ prowlarr_name }}/config.xml&quot;</span><span class="diff-line context">     xpath: &quot;/Config/AuthenticationMethod&quot;</span><span class="diff-line context">     content: &quot;text&quot;</span><span class="diff-line context">   register: xmlresp</span><span class="diff-line hunk">@@ -28,7 +28,7 @@</span><span class="diff-line context">   block:</span><span class="diff-line context">     - name: Auth | Change the &#x27;AuthenticationMethod&#x27; attribute to &#x27;External&#x27;</span><span class="diff-line context">       community.general.xml:</span><span class="diff-line del">-        path: &quot;/opt/{{ prowlarr_name }}/config.xml&quot;</span><span class="diff-line add">+        path: &quot;{{ server_appdata_path }}/{{ prowlarr_name }}/config.xml&quot;</span><span class="diff-line context">         xpath: &quot;/Config/AuthenticationMethod&quot;</span><span class="diff-line context">         value: &quot;External&quot;</span><span class="diff-line context"> </span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-293">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/python/tasks/main.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -20,11 +20,11 @@</span><span class="diff-line context">   ansible.builtin.set_fact:</span><span class="diff-line context">     expected_system_python: &gt;-</span><span class="diff-line context">       {{ &#x27;3.8&#x27;</span><span class="diff-line del">-      if (ansible_distribution_version is version(&#x27;20.04&#x27;, &#x27;==&#x27;))</span><span class="diff-line add">+      if (ansible_facts[&#x27;distribution_version&#x27;] is version(&#x27;20.04&#x27;, &#x27;==&#x27;))</span><span class="diff-line context">       else &#x27;3.10&#x27;</span><span class="diff-line del">-        if (ansible_distribution_version is version(&#x27;22.04&#x27;, &#x27;==&#x27;))</span><span class="diff-line add">+        if (ansible_facts[&#x27;distribution_version&#x27;] is version(&#x27;22.04&#x27;, &#x27;==&#x27;))</span><span class="diff-line context">         else &#x27;3.12&#x27;</span><span class="diff-line del">-          if (ansible_distribution_version is version(&#x27;24.04&#x27;, &#x27;==&#x27;))</span><span class="diff-line add">+          if (ansible_facts[&#x27;distribution_version&#x27;] is version(&#x27;24.04&#x27;, &#x27;==&#x27;))</span><span class="diff-line context">           else &#x27;unknown&#x27; }}</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Assert system Python matches Ubuntu release</span><span class="diff-line hunk">@@ -33,11 +33,11 @@</span><span class="diff-line context">       - system_python_short == expected_system_python</span><span class="diff-line context">     fail_msg: |</span><span class="diff-line context">       System Python version mismatch detected!</span><span class="diff-line del">-      Expected Python {{ expected_system_python }} for Ubuntu {{ ansible_distribution_version }}</span><span class="diff-line add">+      Expected Python {{ expected_system_python }} for Ubuntu {{ ansible_facts[&#x27;distribution_version&#x27;] }}</span><span class="diff-line context">       but found Python {{ system_python_short }}.</span><span class="diff-line context">       The system Python version has been changed from the default.</span><span class="diff-line context">       This role cannot safely proceed with cleanup.</span><span class="diff-line del">-    success_msg: &quot;System Python {{ system_python_short }} matches expected version {{ expected_system_python }} for Ubuntu {{ ansible_distribution_version }}&quot;</span><span class="diff-line add">+    success_msg: &quot;System Python {{ system_python_short }} matches expected version {{ expected_system_python }} for Ubuntu {{ ansible_facts[&#x27;distribution_version&#x27;] }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Legacy Deadsnakes cleanup</span><span class="diff-line context">   when:</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-294">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/qbittorrent/defaults/main.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -11,220 +11,188 @@</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line context"> qbittorrent_instances: [&quot;qbittorrent&quot;]</span><span class="diff-line del">-qbittorrent_host_install: false</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # Settings</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-qbittorrent_webui_custom_headers_enabled: &quot;{{ &#x27;true&#x27; if qbittorrent_themepark_enabled and global_themepark_plugin_enabled else &#x27;false&#x27; }}&quot;</span><span class="diff-line del">-qbittorrent_webui_custom_headers_default: &quot;{{ (qbittorrent_themepark_headers if qbittorrent_themepark_enabled and global_themepark_plugin_enabled else &#x27;&#x27;) + qbittorrent_webui_custom_headers_custom }}&quot;</span><span class="diff-line del">-qbittorrent_webui_custom_headers_custom: &quot;&quot;</span><span class="diff-line del">-qbittorrent_webui_custom_headers: &quot;{{ (qbittorrent_webui_custom_headers_default | trim + &#x27; &#x27; + qbittorrent_webui_custom_headers_custom | trim) | trim }}&quot;</span><span class="diff-line add">+qbittorrent_role_host_install: false</span><span class="diff-line add">+qbittorrent_role_webui_custom_headers_enabled: &quot;{{ &#x27;true&#x27; if lookup(&#x27;role_var&#x27;, &#x27;_themepark_enabled&#x27;, role=&#x27;qbittorrent&#x27;) and global_themepark_plugin_enabled else &#x27;false&#x27; }}&quot;</span><span class="diff-line add">+qbittorrent_role_webui_custom_headers_default: &quot;{{ (qbittorrent_role_themepark_headers if lookup(&#x27;role_var&#x27;, &#x27;_themepark_enabled&#x27;, role=&#x27;qbittorrent&#x27;) and global_themepark_plugin_enabled else &#x27;&#x27;) }}&quot;</span><span class="diff-line add">+qbittorrent_role_webui_custom_headers_custom: &quot;&quot;</span><span class="diff-line add">+qbittorrent_role_webui_custom_headers: &quot;{{ (lookup(&#x27;role_var&#x27;, &#x27;_webui_custom_headers_default&#x27;, role=&#x27;qbittorrent&#x27;) | trim + &#x27; &#x27; + lookup(&#x27;role_var&#x27;, &#x27;_webui_custom_headers_custom&#x27;, role=&#x27;qbittorrent&#x27;) | trim) | trim }}&quot;</span><span class="diff-line context"> # Options are: Delete or MoveToTrash</span><span class="diff-line del">-qbittorrent_torrent_content_remove_option: &quot;Delete&quot;</span><span class="diff-line add">+qbittorrent_role_torrent_content_remove_option: &quot;Delete&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # Host Install</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line context"> # Options are: libtorrent1 (latest), libtorrent2 (latest) or legacy (4.3.9)</span><span class="diff-line del">-qbittorrent_host_branch: libtorrent1</span><span class="diff-line add">+qbittorrent_role_host_branch: libtorrent1</span><span class="diff-line context"> # Example being &quot;release-4.4.5_v1.2.18&quot;</span><span class="diff-line context"> # If this is set then the above branch logic is ignored</span><span class="diff-line del">-qbittorrent_host_specific_version: &quot;&quot;</span><span class="diff-line add">+qbittorrent_role_host_specific_version: &quot;&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Lookup variables</span><span class="diff-line del">-qbittorrent_host_download_endpoint: &quot;{{ &#x27;https://github.com/userdocs/qbittorrent-nox-static/releases/download/&#x27;</span><span class="diff-line del">-                                     if qbittorrent_host_branch != &#x27;legacy&#x27;</span><span class="diff-line del">-                                     else &#x27;https://github.com/userdocs/qbittorrent-nox-static-legacy/releases/download/&#x27; }}&quot;</span><span class="diff-line del">-qbittorrent_host_download_url: &quot;{{ qbittorrent_host_download_endpoint }}{{ qbittorrent_host_specific_version</span><span class="diff-line del">-                                                                        if (qbittorrent_host_specific_version | length &gt; 0)</span><span class="diff-line del">-                                                                        else qbittorret_release_version.stdout }}/x86_64-qbittorrent-nox&quot;</span><span class="diff-line del">-qbittorrent_host_release_url: &quot;{{ &#x27;https://github.com/userdocs/qbittorrent-nox-static/releases/latest/download/dependency-version.json&#x27;</span><span class="diff-line del">-                               if qbittorrent_host_branch != &#x27;legacy&#x27;</span><span class="diff-line del">-                               else &#x27;https://github.com/userdocs/qbittorrent-nox-static-legacy/releases/latest/download/dependency-version.json&#x27; }}&quot;</span><span class="diff-line del">-qbittorrent_host_lookup_libtorrent1: &#x27;release-\(.qbittorrent)_v\(.libtorrent_1_2)&#x27;</span><span class="diff-line del">-qbittorrent_host_lookup_libtorrent2: &#x27;release-\(.qbittorrent)_v\(.libtorrent_2_0)&#x27;</span><span class="diff-line del">-qbittorrent_host_release_lookup: &quot;{{ qbittorrent_host_lookup_libtorrent2</span><span class="diff-line del">-                                  if qbittorrent_host_branch == &#x27;libtorrent2&#x27;</span><span class="diff-line del">-                                  else qbittorrent_host_lookup_libtorrent1 }}&quot;</span><span class="diff-line del">-qbittorrent_host_version: |</span><span class="diff-line del">-  curl -sL {{ qbittorrent_host_release_url }} | jq -r &#x27;. | &quot;{{ qbittorrent_host_release_lookup }}&quot;&#x27;</span><span class="diff-line add">+qbittorrent_role_host_download_endpoint: &quot;{{ &#x27;https://github.com/userdocs/qbittorrent-nox-static/releases/download/&#x27;</span><span class="diff-line add">+                                          if lookup(&#x27;role_var&#x27;, &#x27;_host_branch&#x27;, role=&#x27;qbittorrent&#x27;) != &#x27;legacy&#x27;</span><span class="diff-line add">+                                          else &#x27;https://github.com/userdocs/qbittorrent-nox-static-legacy/releases/download/&#x27; }}&quot;</span><span class="diff-line add">+qbittorrent_role_host_download_url: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_host_download_endpoint&#x27;, role=&#x27;qbittorrent&#x27;) }}{{ lookup(&#x27;role_var&#x27;, &#x27;_host_specific_version&#x27;, role=&#x27;qbittorrent&#x27;)</span><span class="diff-line add">+                                                                                                            if (lookup(&#x27;role_var&#x27;, &#x27;_host_specific_version&#x27;, role=&#x27;qbittorrent&#x27;) | length &gt; 0)</span><span class="diff-line add">+                                                                                                            else qbittorrent_release_version.stdout }}/x86_64-qbittorrent-nox&quot;</span><span class="diff-line add">+qbittorrent_role_host_release_url: &quot;{{ &#x27;https://github.com/userdocs/qbittorrent-nox-static/releases/latest/download/dependency-version.json&#x27;</span><span class="diff-line add">+                                    if lookup(&#x27;role_var&#x27;, &#x27;_host_branch&#x27;, role=&#x27;qbittorrent&#x27;) != &#x27;legacy&#x27;</span><span class="diff-line add">+                                    else &#x27;https://github.com/userdocs/qbittorrent-nox-static-legacy/releases/latest/download/dependency-version.json&#x27; }}&quot;</span><span class="diff-line add">+qbittorrent_role_host_lookup_libtorrent1: &#x27;release-\(.qbittorrent)_v\(.libtorrent_1_2)&#x27;</span><span class="diff-line add">+qbittorrent_role_host_lookup_libtorrent2: &#x27;release-\(.qbittorrent)_v\(.libtorrent_2_0)&#x27;</span><span class="diff-line add">+qbittorrent_role_host_release_lookup: &quot;{{ qbittorrent_role_host_lookup_libtorrent2</span><span class="diff-line add">+                                       if lookup(&#x27;role_var&#x27;, &#x27;_host_branch&#x27;, role=&#x27;qbittorrent&#x27;) == &#x27;libtorrent2&#x27;</span><span class="diff-line add">+                                       else qbittorrent_role_host_lookup_libtorrent1 }}&quot;</span><span class="diff-line add">+qbittorrent_role_host_version: |</span><span class="diff-line add">+  curl -sL {{ lookup(&#x27;role_var&#x27;, &#x27;_host_release_url&#x27;, role=&#x27;qbittorrent&#x27;) }} | jq -r &#x27;. | &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_host_release_lookup&#x27;, role=&#x27;qbittorrent&#x27;) }}&quot;&#x27;</span><span class="diff-line context"> </span><span class="diff-line del">-qbittorent_service_name: &quot;saltbox_managed_{{ qbittorrent_name }}.service&quot;</span><span class="diff-line add">+qbittorrent_role_service_name: &quot;saltbox_managed_{{ qbittorrent_name }}.service&quot;</span><span class="diff-line add">+qbittorrent_role_service_after: &quot;network-online.target docker.service&quot;</span><span class="diff-line add">+qbittorrent_role_service_requires: &quot;network-online.target docker.service&quot;</span><span class="diff-line add">+qbittorrent_role_service_wants: &quot;&quot;</span><span class="diff-line add">+qbittorrent_role_service_partof: &quot;docker.service&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # Paths</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-qbittorrent_paths_folder: &quot;{{ qbittorrent_name }}&quot;</span><span class="diff-line del">-qbittorrent_paths_location: &quot;{{ server_appdata_path }}/{{ qbittorrent_paths_folder }}&quot;</span><span class="diff-line del">-qbittorrent_paths_downloads_location: &quot;{{ downloads_torrents_path }}/{{ qbittorrent_paths_folder }}&quot;</span><span class="diff-line del">-qbittorrent_paths_conf: &quot;{{ qbittorrent_paths_location }}/qBittorrent/qBittorrent.conf&quot;</span><span class="diff-line del">-qbittorrent_paths_folders_list:</span><span class="diff-line del">-  - &quot;{{ qbittorrent_paths_location }}&quot;</span><span class="diff-line del">-  - &quot;{{ qbittorrent_paths_downloads_location }}&quot;</span><span class="diff-line del">-  - &quot;{{ qbittorrent_paths_downloads_location }}/completed&quot;</span><span class="diff-line del">-  - &quot;{{ qbittorrent_paths_downloads_location }}/incoming&quot;</span><span class="diff-line del">-  - &quot;{{ qbittorrent_paths_downloads_location }}/watched&quot;</span><span class="diff-line del">-  - &quot;{{ qbittorrent_paths_downloads_location }}/torrents&quot;</span><span class="diff-line add">+qbittorrent_role_paths_folder: &quot;{{ qbittorrent_name }}&quot;</span><span class="diff-line add">+qbittorrent_role_paths_location: &quot;{{ server_appdata_path }}/{{ qbittorrent_role_paths_folder }}&quot;</span><span class="diff-line add">+qbittorrent_role_paths_downloads_location: &quot;{{ downloads_torrents_path }}/{{ qbittorrent_role_paths_folder }}&quot;</span><span class="diff-line add">+qbittorrent_role_paths_conf: &quot;{{ qbittorrent_role_paths_location }}/qBittorrent/qBittorrent.conf&quot;</span><span class="diff-line add">+qbittorrent_role_paths_folders_list:</span><span class="diff-line add">+  - &quot;{{ qbittorrent_role_paths_location }}&quot;</span><span class="diff-line add">+  - &quot;{{ qbittorrent_role_paths_downloads_location }}&quot;</span><span class="diff-line add">+  - &quot;{{ qbittorrent_role_paths_downloads_location }}/completed&quot;</span><span class="diff-line add">+  - &quot;{{ qbittorrent_role_paths_downloads_location }}/incoming&quot;</span><span class="diff-line add">+  - &quot;{{ qbittorrent_role_paths_downloads_location }}/watched&quot;</span><span class="diff-line add">+  - &quot;{{ qbittorrent_role_paths_downloads_location }}/torrents&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # Web</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-qbittorrent_web_subdomain: &quot;{{ qbittorrent_name }}&quot;</span><span class="diff-line del">-qbittorrent_web_domain: &quot;{{ user.domain }}&quot;</span><span class="diff-line del">-qbittorrent_web_port: &quot;8080&quot;</span><span class="diff-line del">-qbittorrent_web_url: &quot;{{ &#x27;https://&#x27; + (lookup(&#x27;vars&#x27;, qbittorrent_name + &#x27;_web_subdomain&#x27;, default=qbittorrent_web_subdomain) + &#x27;.&#x27; + lookup(&#x27;vars&#x27;, qbittorrent_name + &#x27;_web_domain&#x27;, default=qbittorrent_web_domain)</span><span class="diff-line del">-                      if (lookup(&#x27;vars&#x27;, qbittorrent_name + &#x27;_web_subdomain&#x27;, default=qbittorrent_web_subdomain) | length &gt; 0)</span><span class="diff-line del">-                      else lookup(&#x27;vars&#x27;, qbittorrent_name + &#x27;_web_domain&#x27;, default=qbittorrent_web_domain)) }}&quot;</span><span class="diff-line add">+qbittorrent_role_web_subdomain: &quot;{{ qbittorrent_name }}&quot;</span><span class="diff-line add">+qbittorrent_role_web_domain: &quot;{{ user.domain }}&quot;</span><span class="diff-line add">+qbittorrent_role_web_port: &quot;8080&quot;</span><span class="diff-line add">+qbittorrent_role_web_url: &quot;{{ &#x27;https://&#x27; + (lookup(&#x27;role_var&#x27;, &#x27;_web_subdomain&#x27;, role=&#x27;qbittorrent&#x27;) + &#x27;.&#x27; + lookup(&#x27;role_var&#x27;, &#x27;_web_domain&#x27;, role=&#x27;qbittorrent&#x27;)</span><span class="diff-line add">+                           if (lookup(&#x27;role_var&#x27;, &#x27;_web_subdomain&#x27;, role=&#x27;qbittorrent&#x27;) | length &gt; 0)</span><span class="diff-line add">+                           else lookup(&#x27;role_var&#x27;, &#x27;_web_domain&#x27;, role=&#x27;qbittorrent&#x27;)) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # DNS</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-qbittorrent_dns_record: &quot;{{ lookup(&#x27;vars&#x27;, qbittorrent_name + &#x27;_web_subdomain&#x27;, default=qbittorrent_web_subdomain) }}&quot;</span><span class="diff-line del">-qbittorrent_dns_zone: &quot;{{ lookup(&#x27;vars&#x27;, qbittorrent_name + &#x27;_web_domain&#x27;, default=qbittorrent_web_domain) }}&quot;</span><span class="diff-line del">-qbittorrent_dns_proxy: &quot;{{ dns.proxied }}&quot;</span><span class="diff-line add">+qbittorrent_role_dns_record: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_web_subdomain&#x27;, role=&#x27;qbittorrent&#x27;) }}&quot;</span><span class="diff-line add">+qbittorrent_role_dns_zone: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_web_domain&#x27;, role=&#x27;qbittorrent&#x27;) }}&quot;</span><span class="diff-line add">+qbittorrent_role_dns_proxy: &quot;{{ dns_proxied }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # Traefik</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-qbittorrent_traefik_sso_middleware: &quot;{{ traefik_default_sso_middleware }}&quot;</span><span class="diff-line del">-qbittorrent_traefik_middleware_default: &quot;{{ traefik_default_middleware</span><span class="diff-line del">-                                            + (&#x27;,themepark-&#x27; + lookup(&#x27;vars&#x27;, qbittorrent_name + &#x27;_name&#x27;, default=qbittorrent_name)</span><span class="diff-line del">-                                              if (qbittorrent_themepark_enabled and global_themepark_plugin_enabled)</span><span class="diff-line del">-                                              else &#x27;&#x27;) }}&quot;</span><span class="diff-line del">-qbittorrent_traefik_middleware_custom: &quot;&quot;</span><span class="diff-line del">-qbittorrent_traefik_certresolver: &quot;{{ traefik_default_certresolver }}&quot;</span><span class="diff-line del">-qbittorrent_traefik_enabled: true</span><span class="diff-line del">-qbittorrent_traefik_api_enabled: true</span><span class="diff-line del">-qbittorrent_traefik_api_endpoint: &quot;PathPrefix(`/api`) || PathPrefix(`/command`) || PathPrefix(`/query`) || PathPrefix(`/login`) || PathPrefix(`/sync`)&quot;</span><span class="diff-line add">+qbittorrent_role_traefik_sso_middleware: &quot;{{ traefik_default_sso_middleware }}&quot;</span><span class="diff-line add">+qbittorrent_role_traefik_middleware_default: &quot;{{ traefik_default_middleware</span><span class="diff-line add">+                                                 + (&#x27;,themepark-&#x27; + qbittorrent_name</span><span class="diff-line add">+                                                   if (lookup(&#x27;role_var&#x27;, &#x27;_themepark_enabled&#x27;, role=&#x27;qbittorrent&#x27;) and global_themepark_plugin_enabled)</span><span class="diff-line add">+                                                   else &#x27;&#x27;) }}&quot;</span><span class="diff-line add">+qbittorrent_role_traefik_middleware_custom: &quot;&quot;</span><span class="diff-line add">+qbittorrent_role_traefik_certresolver: &quot;{{ traefik_default_certresolver }}&quot;</span><span class="diff-line add">+qbittorrent_role_traefik_enabled: true</span><span class="diff-line add">+qbittorrent_role_traefik_api_enabled: true</span><span class="diff-line add">+qbittorrent_role_traefik_api_endpoint: &quot;PathPrefix(`/api`) || PathPrefix(`/command`) || PathPrefix(`/query`) || PathPrefix(`/login`) || PathPrefix(`/sync`)&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line del">-# THEME</span><span class="diff-line add">+# Theme</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line context"> # Options can be found at https://github.com/themepark-dev/theme.park</span><span class="diff-line del">-qbittorrent_themepark_enabled: false</span><span class="diff-line del">-qbittorrent_themepark_app: &quot;qbittorrent&quot;</span><span class="diff-line del">-qbittorrent_themepark_theme: &quot;{{ global_themepark_theme }}&quot;</span><span class="diff-line del">-qbittorrent_themepark_domain: &quot;{{ global_themepark_domain }}&quot;</span><span class="diff-line del">-qbittorrent_themepark_addons: []</span><span class="diff-line del">-qbittorrent_themepark_headers: &quot;\&quot;content-security-policy: default-src &#x27;self&#x27;; style-src &#x27;self&#x27; &#x27;unsafe-inline&#x27; theme-park.dev raw.githubusercontent.com use.fontawesome.com; img-src &#x27;self&#x27; theme-park.dev raw.githubusercontent.com data:; script-src &#x27;self&#x27; &#x27;unsafe-inline&#x27;; object-src &#x27;none&#x27;; form-action &#x27;self&#x27;; frame-ancestors &#x27;self&#x27;; font-src use.fontawesome.com;\&quot;&quot;</span><span class="diff-line add">+qbittorrent_role_themepark_enabled: false</span><span class="diff-line add">+qbittorrent_role_themepark_app: &quot;qbittorrent&quot;</span><span class="diff-line add">+qbittorrent_role_themepark_theme: &quot;{{ global_themepark_theme }}&quot;</span><span class="diff-line add">+qbittorrent_role_themepark_domain: &quot;{{ global_themepark_domain }}&quot;</span><span class="diff-line add">+qbittorrent_role_themepark_addons: []</span><span class="diff-line add">+qbittorrent_role_themepark_headers: &quot;\&quot;content-security-policy: default-src &#x27;self&#x27;; style-src &#x27;self&#x27; &#x27;unsafe-inline&#x27; theme-park.dev raw.githubusercontent.com use.fontawesome.com; img-src &#x27;self&#x27; theme-park.dev raw.githubusercontent.com data:; script-src &#x27;self&#x27; &#x27;unsafe-inline&#x27;; object-src &#x27;none&#x27;; form-action &#x27;self&#x27;; frame-ancestors &#x27;self&#x27;; font-src use.fontawesome.com;\&quot;&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # Docker</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line context"> # Container</span><span class="diff-line del">-qbittorrent_docker_container: &quot;{{ qbittorrent_name }}&quot;</span><span class="diff-line add">+qbittorrent_role_docker_container: &quot;{{ qbittorrent_name }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Image</span><span class="diff-line del">-qbittorrent_docker_image_pull: true</span><span class="diff-line del">-qbittorrent_docker_image_repo: &quot;saltydk/qbittorrent&quot;</span><span class="diff-line del">-qbittorrent_docker_image_tag: &quot;latest&quot;</span><span class="diff-line del">-qbittorrent_docker_image: &quot;{{ lookup(&#x27;vars&#x27;, qbittorrent_name + &#x27;_docker_image_repo&#x27;, default=qbittorrent_docker_image_repo)</span><span class="diff-line del">-                              + &#x27;:&#x27; + lookup(&#x27;vars&#x27;, qbittorrent_name + &#x27;_docker_image_tag&#x27;, default=qbittorrent_docker_image_tag) }}&quot;</span><span class="diff-line add">+qbittorrent_role_docker_image_pull: true</span><span class="diff-line add">+qbittorrent_role_docker_image_repo: &quot;saltydk/qbittorrent&quot;</span><span class="diff-line add">+qbittorrent_role_docker_image_tag: &quot;latest&quot;</span><span class="diff-line add">+qbittorrent_role_docker_image: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_image_repo&#x27;, role=&#x27;qbittorrent&#x27;) }}:{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_image_tag&#x27;, role=&#x27;qbittorrent&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Ports</span><span class="diff-line del">-qbittorrent_docker_ports_56881: &quot;{{ port_lookup_56881.meta.port</span><span class="diff-line del">-                                 if (port_lookup_56881.meta.port is defined) and (port_lookup_56881.meta.port | trim | length &gt; 0)</span><span class="diff-line del">-                                 else &#x27;56881&#x27; }}&quot;</span><span class="diff-line del">-qbittorrent_docker_ports_8080: &quot;{{ port_lookup_8080.meta.port</span><span class="diff-line del">-                                if (port_lookup_8080.meta.port is defined) and (port_lookup_8080.meta.port | trim | length &gt; 0)</span><span class="diff-line del">-                                else &#x27;8090&#x27; }}&quot;</span><span class="diff-line del">-qbittorrent_web_port_lookup: &quot;{{ lookup(&#x27;vars&#x27;, qbittorrent_name + &#x27;_web_port&#x27;, default=qbittorrent_web_port) }}&quot;</span><span class="diff-line add">+qbittorrent_role_docker_ports_56881: &quot;{{ port_lookup_56881.meta.port</span><span class="diff-line add">+                                      if (port_lookup_56881.meta.port is defined) and (port_lookup_56881.meta.port | trim | length &gt; 0)</span><span class="diff-line add">+                                      else &#x27;56881&#x27; }}&quot;</span><span class="diff-line add">+qbittorrent_role_docker_ports_8080: &quot;{{ port_lookup_8080.meta.port</span><span class="diff-line add">+                                     if (port_lookup_8080.meta.port is defined) and (port_lookup_8080.meta.port | trim | length &gt; 0)</span><span class="diff-line add">+                                     else &#x27;8090&#x27; }}&quot;</span><span class="diff-line add">+qbittorrent_role_web_port_lookup: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_web_port&#x27;, role=&#x27;qbittorrent&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line del">-qbittorrent_docker_ports_defaults:</span><span class="diff-line del">-  - &quot;{{ lookup(&#x27;vars&#x27;, qbittorrent_name + &#x27;_docker_ports_56881&#x27;, default=qbittorrent_docker_ports_56881) }}:{{ lookup(&#x27;vars&#x27;, qbittorrent_name + &#x27;_docker_ports_56881&#x27;, default=qbittorrent_docker_ports_56881) }}&quot;</span><span class="diff-line del">-  - &quot;{{ lookup(&#x27;vars&#x27;, qbittorrent_name + &#x27;_docker_ports_56881&#x27;, default=qbittorrent_docker_ports_56881) }}:{{ lookup(&#x27;vars&#x27;, qbittorrent_name + &#x27;_docker_ports_56881&#x27;, default=qbittorrent_docker_ports_56881) }}/udp&quot;</span><span class="diff-line del">-qbittorrent_docker_ports_custom: []</span><span class="diff-line del">-qbittorrent_docker_ports: &quot;{{ lookup(&#x27;vars&#x27;, qbittorrent_name + &#x27;_docker_ports_defaults&#x27;, default=qbittorrent_docker_ports_defaults)</span><span class="diff-line del">-                              + lookup(&#x27;vars&#x27;, qbittorrent_name + &#x27;_docker_ports_custom&#x27;, default=qbittorrent_docker_ports_custom) }}&quot;</span><span class="diff-line add">+qbittorrent_role_docker_ports_default:</span><span class="diff-line add">+  - &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_ports_56881&#x27;, role=&#x27;qbittorrent&#x27;) }}:{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_ports_56881&#x27;, role=&#x27;qbittorrent&#x27;) }}&quot;</span><span class="diff-line add">+  - &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_ports_56881&#x27;, role=&#x27;qbittorrent&#x27;) }}:{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_ports_56881&#x27;, role=&#x27;qbittorrent&#x27;) }}/udp&quot;</span><span class="diff-line add">+qbittorrent_role_docker_ports_custom: []</span><span class="diff-line add">+qbittorrent_role_docker_ports: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_ports_default&#x27;, role=&#x27;qbittorrent&#x27;)</span><span class="diff-line add">+                                   + lookup(&#x27;role_var&#x27;, &#x27;_docker_ports_custom&#x27;, role=&#x27;qbittorrent&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Envs</span><span class="diff-line del">-qbittorrent_docker_envs_default:</span><span class="diff-line add">+qbittorrent_role_docker_envs_default:</span><span class="diff-line context">   PUID: &quot;{{ uid }}&quot;</span><span class="diff-line context">   PGID: &quot;{{ gid }}&quot;</span><span class="diff-line context">   TZ: &quot;{{ tz }}&quot;</span><span class="diff-line context">   UMASK_SET: &quot;002&quot;</span><span class="diff-line del">-qbittorrent_docker_envs_custom: {}</span><span class="diff-line del">-qbittorrent_docker_envs: &quot;{{ lookup(&#x27;vars&#x27;, qbittorrent_name + &#x27;_docker_envs_default&#x27;, default=qbittorrent_docker_envs_default)</span><span class="diff-line del">-                             | combine(lookup(&#x27;vars&#x27;, qbittorrent_name + &#x27;_docker_envs_custom&#x27;, default=qbittorrent_docker_envs_custom)) }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Commands</span><span class="diff-line del">-qbittorrent_docker_commands_default: []</span><span class="diff-line del">-qbittorrent_docker_commands_custom: []</span><span class="diff-line del">-qbittorrent_docker_commands: &quot;{{ lookup(&#x27;vars&#x27;, qbittorrent_name + &#x27;_docker_commands_default&#x27;, default=qbittorrent_docker_commands_default)</span><span class="diff-line del">-                                 + lookup(&#x27;vars&#x27;, qbittorrent_name + &#x27;_docker_commands_custom&#x27;, default=qbittorrent_docker_commands_custom) }}&quot;</span><span class="diff-line add">+  S6_SERVICES_GRACETIME: &quot;{{ (lookup(&#x27;role_var&#x27;, &#x27;_docker_stop_timeout&#x27;, role=&#x27;qbittorrent&#x27;) | int * 1000) | string }}&quot;</span><span class="diff-line add">+qbittorrent_role_docker_envs_custom: {}</span><span class="diff-line add">+qbittorrent_role_docker_envs: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_envs_default&#x27;, role=&#x27;qbittorrent&#x27;)</span><span class="diff-line add">+                                  | combine(lookup(&#x27;role_var&#x27;, &#x27;_docker_envs_custom&#x27;, role=&#x27;qbittorrent&#x27;)) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Volumes</span><span class="diff-line del">-qbittorrent_docker_volumes_default:</span><span class="diff-line del">-  - &quot;{{ qbittorrent_paths_location }}:/config&quot;</span><span class="diff-line add">+qbittorrent_role_docker_volumes_default:</span><span class="diff-line add">+  - &quot;{{ qbittorrent_role_paths_location }}:/config&quot;</span><span class="diff-line context">   - &quot;{{ server_appdata_path }}/scripts:/scripts&quot;</span><span class="diff-line del">-qbittorrent_docker_volumes_custom: []</span><span class="diff-line del">-qbittorrent_docker_volumes: &quot;{{ lookup(&#x27;vars&#x27;, qbittorrent_name + &#x27;_docker_volumes_default&#x27;, default=qbittorrent_docker_volumes_default)</span><span class="diff-line del">-                                + lookup(&#x27;vars&#x27;, qbittorrent_name + &#x27;_docker_volumes_custom&#x27;, default=qbittorrent_docker_volumes_custom) }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Devices</span><span class="diff-line del">-qbittorrent_docker_devices_default: []</span><span class="diff-line del">-qbittorrent_docker_devices_custom: []</span><span class="diff-line del">-qbittorrent_docker_devices: &quot;{{ lookup(&#x27;vars&#x27;, qbittorrent_name + &#x27;_docker_devices_default&#x27;, default=qbittorrent_docker_devices_default)</span><span class="diff-line del">-                                + lookup(&#x27;vars&#x27;, qbittorrent_name + &#x27;_docker_devices_custom&#x27;, default=qbittorrent_docker_devices_custom) }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Hosts</span><span class="diff-line del">-qbittorrent_docker_hosts_default: {}</span><span class="diff-line del">-qbittorrent_docker_hosts_custom: {}</span><span class="diff-line del">-qbittorrent_docker_hosts: &quot;{{ docker_hosts_common</span><span class="diff-line del">-                              | combine(lookup(&#x27;vars&#x27;, qbittorrent_name + &#x27;_docker_hosts_default&#x27;, default=qbittorrent_docker_hosts_default))</span><span class="diff-line del">-                              | combine(lookup(&#x27;vars&#x27;, qbittorrent_name + &#x27;_docker_hosts_custom&#x27;, default=qbittorrent_docker_hosts_custom)) }}&quot;</span><span class="diff-line add">+qbittorrent_role_docker_volumes_custom: []</span><span class="diff-line add">+qbittorrent_role_docker_volumes: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_volumes_default&#x27;, role=&#x27;qbittorrent&#x27;)</span><span class="diff-line add">+                                     + lookup(&#x27;role_var&#x27;, &#x27;_docker_volumes_custom&#x27;, role=&#x27;qbittorrent&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Labels</span><span class="diff-line del">-qbittorrent_docker_labels_default: {}</span><span class="diff-line del">-qbittorrent_docker_labels_custom: {}</span><span class="diff-line del">-qbittorrent_docker_labels: &quot;{{ docker_labels_common</span><span class="diff-line del">-                               | combine(lookup(&#x27;vars&#x27;, qbittorrent_name + &#x27;_docker_labels_default&#x27;, default=qbittorrent_docker_labels_default))</span><span class="diff-line del">-                               | combine((traefik_themepark_labels</span><span class="diff-line del">-                                         if (qbittorrent_themepark_enabled and global_themepark_plugin_enabled)</span><span class="diff-line del">-                                         else {}),</span><span class="diff-line del">-                                         lookup(&#x27;vars&#x27;, qbittorrent_name + &#x27;_docker_labels_custom&#x27;, default=qbittorrent_docker_labels_custom)) }}&quot;</span><span class="diff-line add">+qbittorrent_role_docker_labels_default: {}</span><span class="diff-line add">+qbittorrent_role_docker_labels_custom: {}</span><span class="diff-line add">+qbittorrent_role_docker_labels: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_labels_default&#x27;, role=&#x27;qbittorrent&#x27;)</span><span class="diff-line add">+                                    | combine((traefik_themepark_labels</span><span class="diff-line add">+                                              if (lookup(&#x27;role_var&#x27;, &#x27;_themepark_enabled&#x27;, role=&#x27;qbittorrent&#x27;) and global_themepark_plugin_enabled)</span><span class="diff-line add">+                                              else {}),</span><span class="diff-line add">+                                              lookup(&#x27;role_var&#x27;, &#x27;_docker_labels_custom&#x27;, role=&#x27;qbittorrent&#x27;)) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Hostname</span><span class="diff-line del">-qbittorrent_docker_hostname: &quot;{{ qbittorrent_name }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Network Mode</span><span class="diff-line del">-qbittorrent_docker_network_mode_default: &quot;{{ docker_networks_name_common }}&quot;</span><span class="diff-line del">-qbittorrent_docker_network_mode: &quot;{{ lookup(&#x27;vars&#x27;, qbittorrent_name + &#x27;_docker_network_mode_default&#x27;, default=qbittorrent_docker_network_mode_default) }}&quot;</span><span class="diff-line add">+qbittorrent_role_docker_hostname: &quot;{{ qbittorrent_name }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Networks</span><span class="diff-line del">-qbittorrent_docker_networks_alias: &quot;{{ qbittorrent_name }}&quot;</span><span class="diff-line del">-qbittorrent_docker_networks_default: []</span><span class="diff-line del">-qbittorrent_docker_networks_custom: []</span><span class="diff-line del">-qbittorrent_docker_networks: &quot;{{ docker_networks_common</span><span class="diff-line del">-                                 + lookup(&#x27;vars&#x27;, qbittorrent_name + &#x27;_docker_networks_default&#x27;, default=qbittorrent_docker_networks_default)</span><span class="diff-line del">-                                 + lookup(&#x27;vars&#x27;, qbittorrent_name + &#x27;_docker_networks_custom&#x27;, default=qbittorrent_docker_networks_custom) }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Capabilities</span><span class="diff-line del">-qbittorrent_docker_capabilities_default: []</span><span class="diff-line del">-qbittorrent_docker_capabilities_custom: []</span><span class="diff-line del">-qbittorrent_docker_capabilities: &quot;{{ lookup(&#x27;vars&#x27;, qbittorrent_name + &#x27;_docker_capabilities_default&#x27;, default=qbittorrent_docker_capabilities_default)</span><span class="diff-line del">-                                     + lookup(&#x27;vars&#x27;, qbittorrent_name + &#x27;_docker_capabilities_custom&#x27;, default=qbittorrent_docker_capabilities_custom) }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Security Opts</span><span class="diff-line del">-qbittorrent_docker_security_opts_default: []</span><span class="diff-line del">-qbittorrent_docker_security_opts_custom: []</span><span class="diff-line del">-qbittorrent_docker_security_opts: &quot;{{ lookup(&#x27;vars&#x27;, qbittorrent_name + &#x27;_docker_security_opts_default&#x27;, default=qbittorrent_docker_security_opts_default)</span><span class="diff-line del">-                                      + lookup(&#x27;vars&#x27;, qbittorrent_name + &#x27;_docker_security_opts_custom&#x27;, default=qbittorrent_docker_security_opts_custom) }}&quot;</span><span class="diff-line add">+qbittorrent_role_docker_networks_alias: &quot;{{ qbittorrent_name }}&quot;</span><span class="diff-line add">+qbittorrent_role_docker_networks_default: []</span><span class="diff-line add">+qbittorrent_role_docker_networks_custom: []</span><span class="diff-line add">+qbittorrent_role_docker_networks: &quot;{{ docker_networks_common</span><span class="diff-line add">+                                      + lookup(&#x27;role_var&#x27;, &#x27;_docker_networks_default&#x27;, role=&#x27;qbittorrent&#x27;)</span><span class="diff-line add">+                                      + lookup(&#x27;role_var&#x27;, &#x27;_docker_networks_custom&#x27;, role=&#x27;qbittorrent&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Restart Policy</span><span class="diff-line del">-qbittorrent_docker_restart_policy: unless-stopped</span><span class="diff-line add">+qbittorrent_role_docker_restart_policy: unless-stopped</span><span class="diff-line context"> </span><span class="diff-line context"> # Stop Timeout</span><span class="diff-line del">-qbittorrent_docker_stop_timeout: 900</span><span class="diff-line add">+qbittorrent_role_docker_stop_timeout: 900</span><span class="diff-line context"> </span><span class="diff-line context"> # State</span><span class="diff-line del">-qbittorrent_docker_state: started</span><span class="diff-line add">+qbittorrent_role_docker_state: started</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-295">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/qbittorrent/tasks/main2.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -15,8 +15,9 @@</span><span class="diff-line context"> - name: Add DNS record</span><span class="diff-line context">   ansible.builtin.include_tasks: &quot;{{ resources_tasks_path }}/dns/tasker.yml&quot;</span><span class="diff-line context">   vars:</span><span class="diff-line del">-    dns_record: &quot;{{ lookup(&#x27;vars&#x27;, role_name + &#x27;_dns_record&#x27;) }}&quot;</span><span class="diff-line del">-    dns_zone: &quot;{{ lookup(&#x27;vars&#x27;, role_name + &#x27;_dns_zone&#x27;) }}&quot;</span><span class="diff-line add">+    dns_record: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_dns_record&#x27;) }}&quot;</span><span class="diff-line add">+    dns_zone: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_dns_zone&#x27;) }}&quot;</span><span class="diff-line add">+    dns_proxy: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_dns_proxy&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Remove existing Docker container</span><span class="diff-line context">   ansible.builtin.include_tasks: &quot;{{ resources_tasks_path }}/docker/remove_docker_container.yml&quot;</span><span class="diff-line hunk">@@ -30,43 +31,42 @@</span><span class="diff-line context">   ansible.builtin.include_tasks: subtasks/legacy.yml</span><span class="diff-line context">   when: qbittorrent_legacy_service.stat.exists</span><span class="diff-line context"> </span><span class="diff-line del">-- name: Check if &#x27;{{ qbittorent_service_name }}&#x27; exists</span><span class="diff-line add">+- name: Check if &#x27;{{ qbittorrent_role_service_name }}&#x27; exists</span><span class="diff-line context">   ansible.builtin.stat:</span><span class="diff-line del">-    path: &quot;/etc/systemd/system/{{ qbittorent_service_name }}&quot;</span><span class="diff-line add">+    path: &quot;/etc/systemd/system/{{ qbittorrent_role_service_name }}&quot;</span><span class="diff-line context">   register: qbittorrent_service</span><span class="diff-line context"> </span><span class="diff-line del">-- name: Stop &#x27;{{ qbittorent_service_name }}&#x27;</span><span class="diff-line add">+- name: Stop &#x27;{{ qbittorrent_role_service_name }}&#x27;</span><span class="diff-line context">   ansible.builtin.systemd_service:</span><span class="diff-line del">-    name: &quot;{{ qbittorent_service_name }}&quot;</span><span class="diff-line add">+    name: &quot;{{ qbittorrent_role_service_name }}&quot;</span><span class="diff-line context">     state: stopped</span><span class="diff-line context">   when: qbittorrent_service.stat.exists</span><span class="diff-line context"> </span><span class="diff-line del">-- name: Remove &#x27;{{ qbittorent_service_name }}&#x27; file</span><span class="diff-line add">+- name: Remove &#x27;{{ qbittorrent_role_service_name }}&#x27; file</span><span class="diff-line context">   ansible.builtin.file:</span><span class="diff-line del">-    path: &quot;/etc/systemd/system/{{ qbittorent_service_name }}&quot;</span><span class="diff-line add">+    path: &quot;/etc/systemd/system/{{ qbittorrent_role_service_name }}&quot;</span><span class="diff-line context">     state: absent</span><span class="diff-line del">-  when: qbittorrent_service.stat.exists and not qbittorrent_host_install</span><span class="diff-line add">+  when: qbittorrent_service.stat.exists and (not lookup(&#x27;role_var&#x27;, &#x27;_host_install&#x27;, role=&#x27;qbittorrent&#x27;))</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Remove &#x27;{{ qbittorrent_name }}-nox&#x27; file</span><span class="diff-line context">   ansible.builtin.file:</span><span class="diff-line context">     path: &quot;/usr/bin/{{ qbittorrent_name }}-nox&quot;</span><span class="diff-line context">     state: absent</span><span class="diff-line del">-  when: qbittorrent_service.stat.exists and not qbittorrent_host_install</span><span class="diff-line add">+  when: qbittorrent_service.stat.exists and (not lookup(&#x27;role_var&#x27;, &#x27;_host_install&#x27;, role=&#x27;qbittorrent&#x27;))</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Create directories</span><span class="diff-line context">   ansible.builtin.include_tasks: &quot;{{ resources_tasks_path }}/directories/create_directories.yml&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Check if config file exists</span><span class="diff-line context">   ansible.builtin.stat:</span><span class="diff-line del">-    path: &quot;{{ qbittorrent_paths_conf }}&quot;</span><span class="diff-line del">-  register: qbittorrent_paths_conf_stat</span><span class="diff-line add">+    path: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_conf&#x27;, role=&#x27;qbittorrent&#x27;) }}&quot;</span><span class="diff-line add">+  register: qbittorrent_role_paths_conf_stat</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Pre-Install Tasks</span><span class="diff-line del">-  ansible.builtin.import_tasks: &quot;subtasks/pre-install/main.yml&quot;</span><span class="diff-line del">-  when: (not continuous_integration)</span><span class="diff-line add">+  ansible.builtin.include_tasks: &quot;subtasks/pre-install/main.yml&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Host Install</span><span class="diff-line del">-  when: qbittorrent_host_install</span><span class="diff-line add">+  when: lookup(&#x27;role_var&#x27;, &#x27;_host_install&#x27;, role=&#x27;qbittorrent&#x27;)</span><span class="diff-line context">   block:</span><span class="diff-line context">     - name: Add &#x27;{{ qbittorrent_name }}&#x27; to hosts</span><span class="diff-line context">       ansible.builtin.blockinfile:</span><span class="diff-line hunk">@@ -76,12 +76,12 @@</span><span class="diff-line context">           172.19.0.1 {{ qbittorrent_name }}</span><span class="diff-line context"> </span><span class="diff-line context">     - name: Get Download Url</span><span class="diff-line del">-      ansible.builtin.shell: &quot;{{ qbittorrent_host_version }}&quot;</span><span class="diff-line del">-      register: qbittorret_release_version</span><span class="diff-line add">+      ansible.builtin.shell: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_host_version&#x27;, role=&#x27;qbittorrent&#x27;) }}&quot;</span><span class="diff-line add">+      register: qbittorrent_release_version</span><span class="diff-line context"> </span><span class="diff-line context">     - name: Download &#x27;qbittorrent-nox&#x27;</span><span class="diff-line context">       ansible.builtin.get_url:</span><span class="diff-line del">-        url: &quot;{{ qbittorrent_host_download_url }}&quot;</span><span class="diff-line add">+        url: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_host_download_url&#x27;, role=&#x27;qbittorrent&#x27;) }}&quot;</span><span class="diff-line context">         dest: &quot;/usr/bin/{{ qbittorrent_name }}-nox&quot;</span><span class="diff-line context">         mode: &quot;0755&quot;</span><span class="diff-line context">         force: true</span><span class="diff-line hunk">@@ -89,25 +89,25 @@</span><span class="diff-line context">     - name: Import &#x27;{{ qbittorrent_name }}.service&#x27;</span><span class="diff-line context">       ansible.builtin.template:</span><span class="diff-line context">         src: &quot;qbittorrent.service.j2&quot;</span><span class="diff-line del">-        dest: &quot;/etc/systemd/system/{{ qbittorent_service_name }}&quot;</span><span class="diff-line add">+        dest: &quot;/etc/systemd/system/{{ qbittorrent_role_service_name }}&quot;</span><span class="diff-line context">         mode: &quot;0644&quot;</span><span class="diff-line context">         force: true</span><span class="diff-line context"> </span><span class="diff-line del">-    - name: Systemd daemon-reload &#x27;{{ qbittorent_service_name }}&#x27;</span><span class="diff-line add">+    - name: Systemd daemon-reload &#x27;{{ qbittorrent_role_service_name }}&#x27;</span><span class="diff-line context">       ansible.builtin.systemd_service:</span><span class="diff-line del">-        name: &quot;{{ qbittorent_service_name }}&quot;</span><span class="diff-line add">+        name: &quot;{{ qbittorrent_role_service_name }}&quot;</span><span class="diff-line context">         state: stopped</span><span class="diff-line context">         enabled: false</span><span class="diff-line context">         daemon_reload: true</span><span class="diff-line context"> </span><span class="diff-line del">-    - name: Start &#x27;{{ qbittorent_service_name }}&#x27;</span><span class="diff-line add">+    - name: Start &#x27;{{ qbittorrent_role_service_name }}&#x27;</span><span class="diff-line context">       ansible.builtin.systemd_service:</span><span class="diff-line del">-        name: &quot;{{ qbittorent_service_name }}&quot;</span><span class="diff-line add">+        name: &quot;{{ qbittorrent_role_service_name }}&quot;</span><span class="diff-line context">         state: started</span><span class="diff-line context">         enabled: true</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Docker Install</span><span class="diff-line del">-  when: not qbittorrent_host_install</span><span class="diff-line add">+  when: not lookup(&#x27;role_var&#x27;, &#x27;_host_install&#x27;, role=&#x27;qbittorrent&#x27;)</span><span class="diff-line context">   block:</span><span class="diff-line context">     - name: Remove &#x27;{{ qbittorrent_name }}&#x27; from hosts</span><span class="diff-line context">       ansible.builtin.blockinfile:</span><span class="diff-line hunk">@@ -119,5 +119,5 @@</span><span class="diff-line context">       ansible.builtin.include_tasks: &quot;{{ resources_tasks_path }}/docker/create_docker_container.yml&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Post-Install Tasks</span><span class="diff-line del">-  ansible.builtin.import_tasks: &quot;subtasks/post-install/main.yml&quot;</span><span class="diff-line del">-  when: (not continuous_integration) and (not qbittorrent_paths_conf_stat.stat.exists)</span><span class="diff-line add">+  ansible.builtin.include_tasks: &quot;subtasks/post-install/main.yml&quot;</span><span class="diff-line add">+  when: (not qbittorrent_role_paths_conf_stat.stat.exists)</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-296">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/qbittorrent/tasks/subtasks/post-install/main.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -9,7 +9,7 @@</span><span class="diff-line context"> ---</span><span class="diff-line context"> - name: Post-Install | Wait for config to be created</span><span class="diff-line context">   ansible.builtin.wait_for:</span><span class="diff-line del">-    path: &quot;{{ qbittorrent_paths_conf }}&quot;</span><span class="diff-line add">+    path: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_conf&#x27;, role=&#x27;qbittorrent&#x27;) }}&quot;</span><span class="diff-line context">     state: present</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Post-Install | Wait for 30 seconds</span><span class="diff-line hunk">@@ -18,25 +18,25 @@</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Post-Install | Stop container</span><span class="diff-line context">   ansible.builtin.include_tasks: &quot;{{ resources_tasks_path }}/docker/stop_docker_container.yml&quot;</span><span class="diff-line del">-  when: not qbittorrent_host_install</span><span class="diff-line add">+  when: not lookup(&#x27;role_var&#x27;, &#x27;_host_install&#x27;, role=&#x27;qbittorrent&#x27;)</span><span class="diff-line context"> </span><span class="diff-line del">-- name: Post-Install | Stop &#x27;{{ qbittorent_service_name }}&#x27;</span><span class="diff-line add">+- name: Post-Install | Stop &#x27;{{ lookup(&#x27;role_var&#x27;, &#x27;_service_name&#x27;, role=&#x27;qbittorrent&#x27;) }}&#x27;</span><span class="diff-line context">   ansible.builtin.systemd_service:</span><span class="diff-line del">-    name: &quot;{{ qbittorent_service_name }}&quot;</span><span class="diff-line add">+    name: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_service_name&#x27;, role=&#x27;qbittorrent&#x27;) }}&quot;</span><span class="diff-line context">     state: stopped</span><span class="diff-line context">     enabled: true</span><span class="diff-line del">-  when: qbittorrent_host_install</span><span class="diff-line add">+  when: lookup(&#x27;role_var&#x27;, &#x27;_host_install&#x27;, role=&#x27;qbittorrent&#x27;)</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Post-Install | Settings Task</span><span class="diff-line del">-  ansible.builtin.import_tasks: &quot;settings/main.yml&quot;</span><span class="diff-line add">+  ansible.builtin.include_tasks: &quot;settings/main.yml&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Post-Install | Start container</span><span class="diff-line context">   ansible.builtin.include_tasks: &quot;{{ resources_tasks_path }}/docker/start_docker_container.yml&quot;</span><span class="diff-line del">-  when: not qbittorrent_host_install</span><span class="diff-line add">+  when: not lookup(&#x27;role_var&#x27;, &#x27;_host_install&#x27;, role=&#x27;qbittorrent&#x27;)</span><span class="diff-line context"> </span><span class="diff-line del">-- name: Post-Install | Start &#x27;{{ qbittorent_service_name }}&#x27;</span><span class="diff-line add">+- name: Post-Install | Start &#x27;{{ lookup(&#x27;role_var&#x27;, &#x27;_service_name&#x27;, role=&#x27;qbittorrent&#x27;) }}&#x27;</span><span class="diff-line context">   ansible.builtin.systemd_service:</span><span class="diff-line del">-    name: &quot;{{ qbittorent_service_name }}&quot;</span><span class="diff-line add">+    name: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_service_name&#x27;, role=&#x27;qbittorrent&#x27;) }}&quot;</span><span class="diff-line context">     state: started</span><span class="diff-line context">     enabled: true</span><span class="diff-line del">-  when: qbittorrent_host_install</span><span class="diff-line add">+  when: lookup(&#x27;role_var&#x27;, &#x27;_host_install&#x27;, role=&#x27;qbittorrent&#x27;)</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-297">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/qbittorrent/tasks/subtasks/post-install/settings/main.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -9,10 +9,10 @@</span><span class="diff-line context"> ---</span><span class="diff-line context"> - name: Post-Install | Settings | Update Session\Port in &#x27;qBittorrent.conf&#x27; config settings</span><span class="diff-line context">   community.general.ini_file:</span><span class="diff-line del">-    path: &quot;{{ qbittorrent_paths_conf }}&quot;</span><span class="diff-line add">+    path: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_conf&#x27;, role=&#x27;qbittorrent&#x27;) }}&quot;</span><span class="diff-line context">     section: BitTorrent</span><span class="diff-line context">     option: Session\Port</span><span class="diff-line del">-    value: &quot;{{ lookup(&#x27;vars&#x27;, qbittorrent_name + &#x27;_docker_ports_56881&#x27;, default=qbittorrent_docker_ports_56881) }}&quot;</span><span class="diff-line add">+    value: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_ports_56881&#x27;, role=&#x27;qbittorrent&#x27;) }}&quot;</span><span class="diff-line context">     no_extra_spaces: true</span><span class="diff-line context">     state: present</span><span class="diff-line context">     owner: &quot;{{ user.name }}&quot;</span><span class="diff-line hunk">@@ -21,10 +21,10 @@</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Post-Install | Settings | Update Connection\PortRangeMin in &#x27;qBittorrent.conf&#x27; config settings (legacy)</span><span class="diff-line context">   community.general.ini_file:</span><span class="diff-line del">-    path: &quot;{{ qbittorrent_paths_conf }}&quot;</span><span class="diff-line add">+    path: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_conf&#x27;, role=&#x27;qbittorrent&#x27;) }}&quot;</span><span class="diff-line context">     section: Preferences</span><span class="diff-line context">     option: Connection\PortRangeMin</span><span class="diff-line del">-    value: &quot;{{ lookup(&#x27;vars&#x27;, qbittorrent_name + &#x27;_docker_ports_56881&#x27;, default=qbittorrent_docker_ports_56881) }}&quot;</span><span class="diff-line add">+    value: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_ports_56881&#x27;, role=&#x27;qbittorrent&#x27;) }}&quot;</span><span class="diff-line context">     no_extra_spaces: true</span><span class="diff-line context">     state: present</span><span class="diff-line context">     owner: &quot;{{ user.name }}&quot;</span><span class="diff-line hunk">@@ -33,7 +33,7 @@</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Post-Install | Settings | Update WebUI\HostHeaderValidation &#x27;qBittorrent.conf&#x27; config settings</span><span class="diff-line context">   community.general.ini_file:</span><span class="diff-line del">-    path: &quot;{{ qbittorrent_paths_conf }}&quot;</span><span class="diff-line add">+    path: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_conf&#x27;, role=&#x27;qbittorrent&#x27;) }}&quot;</span><span class="diff-line context">     section: Preferences</span><span class="diff-line context">     option: WebUI\HostHeaderValidation</span><span class="diff-line context">     value: &quot;false&quot;</span><span class="diff-line hunk">@@ -45,7 +45,7 @@</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Post-Install | Settings | Update WebUI\CSRFProtection &#x27;qBittorrent.conf&#x27; config settings</span><span class="diff-line context">   community.general.ini_file:</span><span class="diff-line del">-    path: &quot;{{ qbittorrent_paths_conf }}&quot;</span><span class="diff-line add">+    path: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_conf&#x27;, role=&#x27;qbittorrent&#x27;) }}&quot;</span><span class="diff-line context">     section: Preferences</span><span class="diff-line context">     option: WebUI\CSRFProtection</span><span class="diff-line context">     value: &quot;false&quot;</span><span class="diff-line hunk">@@ -57,10 +57,10 @@</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Post-Install | Settings | Update WebUI\CustomHTTPHeaders &#x27;qBittorrent.conf&#x27; config settings</span><span class="diff-line context">   community.general.ini_file:</span><span class="diff-line del">-    path: &quot;{{ qbittorrent_paths_conf }}&quot;</span><span class="diff-line add">+    path: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_conf&#x27;, role=&#x27;qbittorrent&#x27;) }}&quot;</span><span class="diff-line context">     section: Preferences</span><span class="diff-line context">     option: WebUI\CustomHTTPHeaders</span><span class="diff-line del">-    value: &quot;{{ qbittorrent_webui_custom_headers }}&quot;</span><span class="diff-line add">+    value: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_webui_custom_headers&#x27;, role=&#x27;qbittorrent&#x27;) }}&quot;</span><span class="diff-line context">     no_extra_spaces: true</span><span class="diff-line context">     state: present</span><span class="diff-line context">     owner: &quot;{{ user.name }}&quot;</span><span class="diff-line hunk">@@ -69,10 +69,10 @@</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Post-Install | Settings | Update WebUI\CustomHTTPHeadersEnabled &#x27;qBittorrent.conf&#x27; config settings</span><span class="diff-line context">   community.general.ini_file:</span><span class="diff-line del">-    path: &quot;{{ qbittorrent_paths_conf }}&quot;</span><span class="diff-line add">+    path: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_conf&#x27;, role=&#x27;qbittorrent&#x27;) }}&quot;</span><span class="diff-line context">     section: Preferences</span><span class="diff-line context">     option: WebUI\CustomHTTPHeadersEnabled</span><span class="diff-line del">-    value: &quot;{{ qbittorrent_webui_custom_headers_enabled }}&quot;</span><span class="diff-line add">+    value: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_webui_custom_headers_enabled&#x27;, role=&#x27;qbittorrent&#x27;) }}&quot;</span><span class="diff-line context">     no_extra_spaces: true</span><span class="diff-line context">     state: present</span><span class="diff-line context">     owner: &quot;{{ user.name }}&quot;</span><span class="diff-line hunk">@@ -81,7 +81,7 @@</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Post-Install | Settings | Update LegalNotice.Accepted &#x27;qBittorrent.conf&#x27; config settings</span><span class="diff-line context">   community.general.ini_file:</span><span class="diff-line del">-    path: &quot;{{ qbittorrent_paths_conf }}&quot;</span><span class="diff-line add">+    path: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_conf&#x27;, role=&#x27;qbittorrent&#x27;) }}&quot;</span><span class="diff-line context">     section: LegalNotice</span><span class="diff-line context">     option: Accepted</span><span class="diff-line context">     value: &quot;true&quot;</span><span class="diff-line hunk">@@ -93,10 +93,10 @@</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Post-Install | Settings | Update WebUI\Port &#x27;qBittorrent.conf&#x27; config settings</span><span class="diff-line context">   community.general.ini_file:</span><span class="diff-line del">-    path: &quot;{{ qbittorrent_paths_conf }}&quot;</span><span class="diff-line add">+    path: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_conf&#x27;, role=&#x27;qbittorrent&#x27;) }}&quot;</span><span class="diff-line context">     section: Preferences</span><span class="diff-line context">     option: WebUI\Port</span><span class="diff-line del">-    value: &quot;{{ lookup(&#x27;vars&#x27;, qbittorrent_name + &#x27;_docker_ports_8080&#x27;, default=qbittorrent_docker_ports_8080) if qbittorrent_host_install else &#x27;8080&#x27; }}&quot;</span><span class="diff-line add">+    value: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_ports_8080&#x27;, role=&#x27;qbittorrent&#x27;) if lookup(&#x27;role_var&#x27;, &#x27;_host_install&#x27;, role=&#x27;qbittorrent&#x27;) else &#x27;8080&#x27; }}&quot;</span><span class="diff-line context">     no_extra_spaces: true</span><span class="diff-line context">     state: present</span><span class="diff-line context">     owner: &quot;{{ user.name }}&quot;</span><span class="diff-line hunk">@@ -105,10 +105,10 @@</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Post-Install | Settings | Update WebUI\Port &#x27;qBittorrent.conf&#x27; config settings</span><span class="diff-line context">   community.general.ini_file:</span><span class="diff-line del">-    path: &quot;{{ qbittorrent_paths_conf }}&quot;</span><span class="diff-line add">+    path: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_conf&#x27;, role=&#x27;qbittorrent&#x27;) }}&quot;</span><span class="diff-line context">     section: Preferences</span><span class="diff-line context">     option: WebUI\Address</span><span class="diff-line del">-    value: &quot;{{ &#x27;172.19.0.1&#x27; if qbittorrent_host_install else &#x27;*&#x27; }}&quot;</span><span class="diff-line add">+    value: &quot;{{ &#x27;172.19.0.1&#x27; if lookup(&#x27;role_var&#x27;, &#x27;_host_install&#x27;, role=&#x27;qbittorrent&#x27;) else &#x27;*&#x27; }}&quot;</span><span class="diff-line context">     no_extra_spaces: true</span><span class="diff-line context">     state: present</span><span class="diff-line context">     owner: &quot;{{ user.name }}&quot;</span><span class="diff-line hunk">@@ -117,7 +117,7 @@</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Post-Install | Settings | Update WebUI\TrustedReverseProxiesList &#x27;qBittorrent.conf&#x27; config settings</span><span class="diff-line context">   community.general.ini_file:</span><span class="diff-line del">-    path: &quot;{{ qbittorrent_paths_conf }}&quot;</span><span class="diff-line add">+    path: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_conf&#x27;, role=&#x27;qbittorrent&#x27;) }}&quot;</span><span class="diff-line context">     section: Preferences</span><span class="diff-line context">     option: WebUI\TrustedReverseProxiesList</span><span class="diff-line context">     value: &quot;172.19.0.0/16&quot;</span><span class="diff-line hunk">@@ -129,7 +129,7 @@</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Post-Install | Settings | Update WebUI\ReverseProxySupportEnabled &#x27;qBittorrent.conf&#x27; config settings</span><span class="diff-line context">   community.general.ini_file:</span><span class="diff-line del">-    path: &quot;{{ qbittorrent_paths_conf }}&quot;</span><span class="diff-line add">+    path: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_conf&#x27;, role=&#x27;qbittorrent&#x27;) }}&quot;</span><span class="diff-line context">     section: Preferences</span><span class="diff-line context">     option: WebUI\ReverseProxySupportEnabled</span><span class="diff-line context">     value: &quot;true&quot;</span><span class="diff-line hunk">@@ -141,7 +141,7 @@</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Post-Install | Settings | Update FileLogger\Enabled &#x27;qBittorrent.conf&#x27; config settings</span><span class="diff-line context">   community.general.ini_file:</span><span class="diff-line del">-    path: &quot;{{ qbittorrent_paths_conf }}&quot;</span><span class="diff-line add">+    path: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_conf&#x27;, role=&#x27;qbittorrent&#x27;) }}&quot;</span><span class="diff-line context">     section: Application</span><span class="diff-line context">     option: FileLogger\Enabled</span><span class="diff-line context">     value: &quot;true&quot;</span><span class="diff-line hunk">@@ -153,10 +153,10 @@</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Post-Install | Settings | Update FileLogger\Path &#x27;qBittorrent.conf&#x27; config settings</span><span class="diff-line context">   community.general.ini_file:</span><span class="diff-line del">-    path: &quot;{{ qbittorrent_paths_conf }}&quot;</span><span class="diff-line add">+    path: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_conf&#x27;, role=&#x27;qbittorrent&#x27;) }}&quot;</span><span class="diff-line context">     section: Application</span><span class="diff-line context">     option: FileLogger\Path</span><span class="diff-line del">-    value: &quot;{{ qbittorrent_paths_location + &#x27;/log&#x27; if qbittorrent_host_install else &#x27;/config/log&#x27; }}&quot;</span><span class="diff-line add">+    value: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_location&#x27;, role=&#x27;qbittorrent&#x27;) + &#x27;/log&#x27; if lookup(&#x27;role_var&#x27;, &#x27;_host_install&#x27;, role=&#x27;qbittorrent&#x27;) else &#x27;/config/log&#x27; }}&quot;</span><span class="diff-line context">     no_extra_spaces: true</span><span class="diff-line context">     state: present</span><span class="diff-line context">     owner: &quot;{{ user.name }}&quot;</span><span class="diff-line hunk">@@ -164,19 +164,20 @@</span><span class="diff-line context">     mode: &quot;0664&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Post-Install | Settings | Generate Password Hash</span><span class="diff-line del">-  when: not qbittorrent_paths_conf_stat.stat.exists</span><span class="diff-line add">+  when: not qbittorrent_role_paths_conf_stat.stat.exists</span><span class="diff-line context">   block:</span><span class="diff-line context">     - name: Post-Install | Settings | Generate Password Hash</span><span class="diff-line context">       qbittorrent_passwd:</span><span class="diff-line context">         password: &quot;{{ user.pass }}&quot;</span><span class="diff-line context">       register: qbittorrent_hashed_passwd</span><span class="diff-line add">+      no_log: true</span><span class="diff-line context"> </span><span class="diff-line context">     - name: Post-Install | Settings | Set qBittorrent &#x27;WebUI\Username&#x27;</span><span class="diff-line context">       community.general.ini_file:</span><span class="diff-line add">+        path: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_conf&#x27;, role=&#x27;qbittorrent&#x27;) }}&quot;</span><span class="diff-line context">         section: Preferences</span><span class="diff-line context">         option: WebUI\Username</span><span class="diff-line context">         value: &#x27;{{ user.name }}&#x27;</span><span class="diff-line del">-        path: &quot;{{ qbittorrent_paths_conf }}&quot;</span><span class="diff-line context">         no_extra_spaces: true</span><span class="diff-line context">         state: present</span><span class="diff-line context">         owner: &quot;{{ user.name }}&quot;</span><span class="diff-line hunk">@@ -185,10 +186,10 @@</span><span class="diff-line context"> </span><span class="diff-line context">     - name: Post-Install | Settings | Set qBittorrent &#x27;WebUI\Password_PBKDF2&#x27;</span><span class="diff-line context">       community.general.ini_file:</span><span class="diff-line add">+        path: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_conf&#x27;, role=&#x27;qbittorrent&#x27;) }}&quot;</span><span class="diff-line context">         section: Preferences</span><span class="diff-line context">         option: WebUI\Password_PBKDF2</span><span class="diff-line del">-        value: &#x27;{{ qbittorrent_hashed_passwd.msg }}&#x27;</span><span class="diff-line del">-        path: &quot;{{ qbittorrent_paths_conf }}&quot;</span><span class="diff-line add">+        value: &#x27;{{ qbittorrent_hashed_passwd.hash }}&#x27;</span><span class="diff-line context">         no_extra_spaces: true</span><span class="diff-line context">         state: present</span><span class="diff-line context">         owner: &quot;{{ user.name }}&quot;</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-298">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/qbittorrent/tasks/subtasks/pre-install/main.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -9,7 +9,7 @@</span><span class="diff-line context"> ---</span><span class="diff-line context"> - name: Pre-Install | Remove &#x27;qbittorrent.yml&#x27; file</span><span class="diff-line context">   ansible.builtin.file:</span><span class="diff-line del">-    path: &quot;/opt/traefik/{{ qbittorrent_name }}.yml&quot;</span><span class="diff-line add">+    path: &quot;{{ server_appdata_path }}/traefik/{{ qbittorrent_name }}.yml&quot;</span><span class="diff-line context">     state: absent</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Pre-Install | Initialize or update port range low bound</span><span class="diff-line hunk">@@ -26,7 +26,7 @@</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Pre-Install | Update port range low bound for next iteration</span><span class="diff-line context">   ansible.builtin.set_fact:</span><span class="diff-line del">-    port_range_low_bound: &quot;{{ (lookup(&#x27;vars&#x27;, qbittorrent_name + &#x27;_docker_ports_56881&#x27;, default=qbittorrent_docker_ports_56881) | int) + 1 }}&quot;</span><span class="diff-line add">+    port_range_low_bound: &quot;{{ (lookup(&#x27;role_var&#x27;, &#x27;_docker_ports_56881&#x27;, role=&#x27;qbittorrent&#x27;) | int) + 1 }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Pre-Install | Get next available port within the range of &#x27;8090-8100&#x27; # noqa fqcn[action]</span><span class="diff-line context">   find_open_port:</span><span class="diff-line hunk">@@ -37,14 +37,14 @@</span><span class="diff-line context">   ignore_errors: true</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Pre-Install | Settings | Update &#x27;qBittorrent.conf&#x27; config settings</span><span class="diff-line del">-  when: qbittorrent_paths_conf_stat.stat.exists</span><span class="diff-line add">+  when: qbittorrent_role_paths_conf_stat.stat.exists</span><span class="diff-line context">   block:</span><span class="diff-line context">     - name: Pre-Install | Settings | Update Session\Port in &#x27;qBittorrent.conf&#x27; config settings</span><span class="diff-line context">       community.general.ini_file:</span><span class="diff-line del">-        path: &quot;{{ qbittorrent_paths_conf }}&quot;</span><span class="diff-line add">+        path: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_conf&#x27;, role=&#x27;qbittorrent&#x27;) }}&quot;</span><span class="diff-line context">         section: BitTorrent</span><span class="diff-line context">         option: Session\Port</span><span class="diff-line del">-        value: &quot;{{ lookup(&#x27;vars&#x27;, qbittorrent_name + &#x27;_docker_ports_56881&#x27;, default=qbittorrent_docker_ports_56881) }}&quot;</span><span class="diff-line add">+        value: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_ports_56881&#x27;, role=&#x27;qbittorrent&#x27;) }}&quot;</span><span class="diff-line context">         no_extra_spaces: true</span><span class="diff-line context">         state: present</span><span class="diff-line context">         owner: &quot;{{ user.name }}&quot;</span><span class="diff-line hunk">@@ -53,10 +53,10 @@</span><span class="diff-line context"> </span><span class="diff-line context">     - name: Pre-Install | Settings | Update Session\TorrentContentRemoveOption in &#x27;qBittorrent.conf&#x27; config settings</span><span class="diff-line context">       community.general.ini_file:</span><span class="diff-line del">-        path: &quot;{{ qbittorrent_paths_conf }}&quot;</span><span class="diff-line add">+        path: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_conf&#x27;, role=&#x27;qbittorrent&#x27;) }}&quot;</span><span class="diff-line context">         section: BitTorrent</span><span class="diff-line context">         option: Session\TorrentContentRemoveOption</span><span class="diff-line del">-        value: &quot;{{ lookup(&#x27;vars&#x27;, qbittorrent_name + &#x27;_torrent_content_remove_option&#x27;, default=qbittorrent_torrent_content_remove_option) }}&quot;</span><span class="diff-line add">+        value: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_torrent_content_remove_option&#x27;, role=&#x27;qbittorrent&#x27;) }}&quot;</span><span class="diff-line context">         no_extra_spaces: true</span><span class="diff-line context">         state: present</span><span class="diff-line context">         owner: &quot;{{ user.name }}&quot;</span><span class="diff-line hunk">@@ -65,10 +65,10 @@</span><span class="diff-line context"> </span><span class="diff-line context">     - name: Pre-Install | Settings | Update Connection\PortRangeMin in &#x27;qBittorrent.conf&#x27; config settings (legacy)</span><span class="diff-line context">       community.general.ini_file:</span><span class="diff-line del">-        path: &quot;{{ qbittorrent_paths_conf }}&quot;</span><span class="diff-line add">+        path: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_conf&#x27;, role=&#x27;qbittorrent&#x27;) }}&quot;</span><span class="diff-line context">         section: Preferences</span><span class="diff-line context">         option: Connection\PortRangeMin</span><span class="diff-line del">-        value: &quot;{{ lookup(&#x27;vars&#x27;, qbittorrent_name + &#x27;_docker_ports_56881&#x27;, default=qbittorrent_docker_ports_56881) }}&quot;</span><span class="diff-line add">+        value: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_ports_56881&#x27;, role=&#x27;qbittorrent&#x27;) }}&quot;</span><span class="diff-line context">         no_extra_spaces: true</span><span class="diff-line context">         state: present</span><span class="diff-line context">         owner: &quot;{{ user.name }}&quot;</span><span class="diff-line hunk">@@ -77,7 +77,7 @@</span><span class="diff-line context"> </span><span class="diff-line context">     - name: Pre-Install | Settings | Update WebUI\HostHeaderValidation &#x27;qBittorrent.conf&#x27; config settings</span><span class="diff-line context">       community.general.ini_file:</span><span class="diff-line del">-        path: &quot;{{ qbittorrent_paths_conf }}&quot;</span><span class="diff-line add">+        path: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_conf&#x27;, role=&#x27;qbittorrent&#x27;) }}&quot;</span><span class="diff-line context">         section: Preferences</span><span class="diff-line context">         option: WebUI\HostHeaderValidation</span><span class="diff-line context">         value: &quot;false&quot;</span><span class="diff-line hunk">@@ -89,7 +89,7 @@</span><span class="diff-line context"> </span><span class="diff-line context">     - name: Pre-Install | Settings | Update WebUI\CSRFProtection &#x27;qBittorrent.conf&#x27; config settings</span><span class="diff-line context">       community.general.ini_file:</span><span class="diff-line del">-        path: &quot;{{ qbittorrent_paths_conf }}&quot;</span><span class="diff-line add">+        path: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_conf&#x27;, role=&#x27;qbittorrent&#x27;) }}&quot;</span><span class="diff-line context">         section: Preferences</span><span class="diff-line context">         option: WebUI\CSRFProtection</span><span class="diff-line context">         value: &quot;false&quot;</span><span class="diff-line hunk">@@ -101,10 +101,10 @@</span><span class="diff-line context"> </span><span class="diff-line context">     - name: Pre-Install | Settings | Update WebUI\CustomHTTPHeaders &#x27;qBittorrent.conf&#x27; config settings</span><span class="diff-line context">       community.general.ini_file:</span><span class="diff-line del">-        path: &quot;{{ qbittorrent_paths_conf }}&quot;</span><span class="diff-line add">+        path: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_conf&#x27;, role=&#x27;qbittorrent&#x27;) }}&quot;</span><span class="diff-line context">         section: Preferences</span><span class="diff-line context">         option: WebUI\CustomHTTPHeaders</span><span class="diff-line del">-        value: &quot;{{ qbittorrent_webui_custom_headers }}&quot;</span><span class="diff-line add">+        value: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_webui_custom_headers&#x27;, role=&#x27;qbittorrent&#x27;) }}&quot;</span><span class="diff-line context">         no_extra_spaces: true</span><span class="diff-line context">         state: present</span><span class="diff-line context">         owner: &quot;{{ user.name }}&quot;</span><span class="diff-line hunk">@@ -113,10 +113,10 @@</span><span class="diff-line context"> </span><span class="diff-line context">     - name: Pre-Install | Settings | Update WebUI\CustomHTTPHeadersEnabled &#x27;qBittorrent.conf&#x27; config settings</span><span class="diff-line context">       community.general.ini_file:</span><span class="diff-line del">-        path: &quot;{{ qbittorrent_paths_conf }}&quot;</span><span class="diff-line add">+        path: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_conf&#x27;, role=&#x27;qbittorrent&#x27;) }}&quot;</span><span class="diff-line context">         section: Preferences</span><span class="diff-line context">         option: WebUI\CustomHTTPHeadersEnabled</span><span class="diff-line del">-        value: &quot;{{ qbittorrent_webui_custom_headers_enabled }}&quot;</span><span class="diff-line add">+        value: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_webui_custom_headers_enabled&#x27;, role=&#x27;qbittorrent&#x27;) }}&quot;</span><span class="diff-line context">         no_extra_spaces: true</span><span class="diff-line context">         state: present</span><span class="diff-line context">         owner: &quot;{{ user.name }}&quot;</span><span class="diff-line hunk">@@ -125,7 +125,7 @@</span><span class="diff-line context"> </span><span class="diff-line context">     - name: Pre-Install | Settings | Update LegalNotice.Accepted &#x27;qBittorrent.conf&#x27; config settings</span><span class="diff-line context">       community.general.ini_file:</span><span class="diff-line del">-        path: &quot;{{ qbittorrent_paths_conf }}&quot;</span><span class="diff-line add">+        path: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_conf&#x27;, role=&#x27;qbittorrent&#x27;) }}&quot;</span><span class="diff-line context">         section: LegalNotice</span><span class="diff-line context">         option: Accepted</span><span class="diff-line context">         value: &quot;true&quot;</span><span class="diff-line hunk">@@ -137,10 +137,10 @@</span><span class="diff-line context"> </span><span class="diff-line context">     - name: Pre-Install | Settings | Update WebUI\Port &#x27;qBittorrent.conf&#x27; config settings</span><span class="diff-line context">       community.general.ini_file:</span><span class="diff-line del">-        path: &quot;{{ qbittorrent_paths_conf }}&quot;</span><span class="diff-line add">+        path: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_conf&#x27;, role=&#x27;qbittorrent&#x27;) }}&quot;</span><span class="diff-line context">         section: Preferences</span><span class="diff-line context">         option: WebUI\Port</span><span class="diff-line del">-        value: &quot;{{ qbittorrent_docker_ports_8080 if qbittorrent_host_install else lookup(&#x27;vars&#x27;, qbittorrent_name + &#x27;_web_port&#x27;, default=qbittorrent_web_port) }}&quot;</span><span class="diff-line add">+        value: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_ports_8080&#x27;, role=&#x27;qbittorrent&#x27;) if lookup(&#x27;role_var&#x27;, &#x27;_host_install&#x27;, role=&#x27;qbittorrent&#x27;) else lookup(&#x27;role_var&#x27;, &#x27;_web_port&#x27;, role=&#x27;qbittorrent&#x27;) }}&quot;</span><span class="diff-line context">         no_extra_spaces: true</span><span class="diff-line context">         state: present</span><span class="diff-line context">         owner: &quot;{{ user.name }}&quot;</span><span class="diff-line hunk">@@ -149,10 +149,10 @@</span><span class="diff-line context"> </span><span class="diff-line context">     - name: Pre-Install | Settings | Update WebUI\Port &#x27;qBittorrent.conf&#x27; config settings</span><span class="diff-line context">       community.general.ini_file:</span><span class="diff-line del">-        path: &quot;{{ qbittorrent_paths_conf }}&quot;</span><span class="diff-line add">+        path: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_conf&#x27;, role=&#x27;qbittorrent&#x27;) }}&quot;</span><span class="diff-line context">         section: Preferences</span><span class="diff-line context">         option: WebUI\Address</span><span class="diff-line del">-        value: &quot;{{ &#x27;172.19.0.1&#x27; if qbittorrent_host_install else &#x27;*&#x27; }}&quot;</span><span class="diff-line add">+        value: &quot;{{ &#x27;172.19.0.1&#x27; if lookup(&#x27;role_var&#x27;, &#x27;_host_install&#x27;, role=&#x27;qbittorrent&#x27;) else &#x27;*&#x27; }}&quot;</span><span class="diff-line context">         no_extra_spaces: true</span><span class="diff-line context">         state: present</span><span class="diff-line context">         owner: &quot;{{ user.name }}&quot;</span><span class="diff-line hunk">@@ -161,7 +161,7 @@</span><span class="diff-line context"> </span><span class="diff-line context">     - name: Pre-Install | Settings | Update WebUI\TrustedReverseProxiesList &#x27;qBittorrent.conf&#x27; config settings</span><span class="diff-line context">       community.general.ini_file:</span><span class="diff-line del">-        path: &quot;{{ qbittorrent_paths_conf }}&quot;</span><span class="diff-line add">+        path: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_conf&#x27;, role=&#x27;qbittorrent&#x27;) }}&quot;</span><span class="diff-line context">         section: Preferences</span><span class="diff-line context">         option: WebUI\TrustedReverseProxiesList</span><span class="diff-line context">         value: &quot;172.19.0.0/16&quot;</span><span class="diff-line hunk">@@ -173,7 +173,7 @@</span><span class="diff-line context"> </span><span class="diff-line context">     - name: Pre-Install | Settings | Update WebUI\ReverseProxySupportEnabled &#x27;qBittorrent.conf&#x27; config settings</span><span class="diff-line context">       community.general.ini_file:</span><span class="diff-line del">-        path: &quot;{{ qbittorrent_paths_conf }}&quot;</span><span class="diff-line add">+        path: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_conf&#x27;, role=&#x27;qbittorrent&#x27;) }}&quot;</span><span class="diff-line context">         section: Preferences</span><span class="diff-line context">         option: WebUI\ReverseProxySupportEnabled</span><span class="diff-line context">         value: &quot;true&quot;</span><span class="diff-line hunk">@@ -185,7 +185,7 @@</span><span class="diff-line context"> </span><span class="diff-line context">     - name: Pre-Install | Settings | Update FileLogger\Enabled &#x27;qBittorrent.conf&#x27; config settings</span><span class="diff-line context">       community.general.ini_file:</span><span class="diff-line del">-        path: &quot;{{ qbittorrent_paths_conf }}&quot;</span><span class="diff-line add">+        path: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_conf&#x27;, role=&#x27;qbittorrent&#x27;) }}&quot;</span><span class="diff-line context">         section: Application</span><span class="diff-line context">         option: FileLogger\Enabled</span><span class="diff-line context">         value: &quot;true&quot;</span><span class="diff-line hunk">@@ -197,10 +197,10 @@</span><span class="diff-line context"> </span><span class="diff-line context">     - name: Pre-Install | Settings | Update FileLogger\Path &#x27;qBittorrent.conf&#x27; config settings</span><span class="diff-line context">       community.general.ini_file:</span><span class="diff-line del">-        path: &quot;{{ qbittorrent_paths_conf }}&quot;</span><span class="diff-line add">+        path: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_conf&#x27;, role=&#x27;qbittorrent&#x27;) }}&quot;</span><span class="diff-line context">         section: Application</span><span class="diff-line context">         option: FileLogger\Path</span><span class="diff-line del">-        value: &quot;{{ qbittorrent_paths_location + &#x27;/log&#x27; if qbittorrent_host_install else &#x27;/config/log&#x27; }}&quot;</span><span class="diff-line add">+        value: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_location&#x27;, role=&#x27;qbittorrent&#x27;) + &#x27;/log&#x27; if lookup(&#x27;role_var&#x27;, &#x27;_host_install&#x27;, role=&#x27;qbittorrent&#x27;) else &#x27;/config/log&#x27; }}&quot;</span><span class="diff-line context">         no_extra_spaces: true</span><span class="diff-line context">         state: present</span><span class="diff-line context">         owner: &quot;{{ user.name }}&quot;</span><span class="diff-line hunk">@@ -210,9 +210,9 @@</span><span class="diff-line context"> - name: Pre-Install | Import &#x27;qbittorrent.yml&#x27; file</span><span class="diff-line context">   ansible.builtin.template:</span><span class="diff-line context">     src: &quot;qbittorrent.yml.j2&quot;</span><span class="diff-line del">-    dest: &quot;/opt/traefik/{{ qbittorrent_name }}.yml&quot;</span><span class="diff-line add">+    dest: &quot;{{ server_appdata_path }}/traefik/{{ qbittorrent_name }}.yml&quot;</span><span class="diff-line context">     owner: &#x27;{{ user.name }}&#x27;</span><span class="diff-line context">     group: &#x27;{{ user.name }}&#x27;</span><span class="diff-line context">     mode: &quot;0644&quot;</span><span class="diff-line context">     force: true</span><span class="diff-line del">-  when: qbittorrent_host_install</span><span class="diff-line add">+  when: lookup(&#x27;role_var&#x27;, &#x27;_host_install&#x27;, role=&#x27;qbittorrent&#x27;)</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-299">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/qbittorrent/templates/qbittorrent.service.j2</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -10,8 +10,22 @@</span><span class="diff-line context"> </span><span class="diff-line context"> [Unit]</span><span class="diff-line context"> Description={{ qbittorrent_name }}</span><span class="diff-line del">-After=network-online.target docker.service</span><span class="diff-line del">-Requires=network-online.target docker.service</span><span class="diff-line add">+{% set service_after = lookup(&#x27;role_var&#x27;, &#x27;_service_after&#x27;, role=&#x27;qbittorrent&#x27;) %}</span><span class="diff-line add">+{% if service_after | length &gt; 0 %}</span><span class="diff-line add">+After={{ service_after }}</span><span class="diff-line add">+{% endif %}</span><span class="diff-line add">+{% set service_requires = lookup(&#x27;role_var&#x27;, &#x27;_service_requires&#x27;, role=&#x27;qbittorrent&#x27;) %}</span><span class="diff-line add">+{% if service_requires | length &gt; 0 %}</span><span class="diff-line add">+Requires={{ service_requires }}</span><span class="diff-line add">+{% endif %}</span><span class="diff-line add">+{% set service_wants = lookup(&#x27;role_var&#x27;, &#x27;_service_wants&#x27;, role=&#x27;qbittorrent&#x27;) %}</span><span class="diff-line add">+{% if service_wants | length &gt; 0 %}</span><span class="diff-line add">+Wants={{ service_wants }}</span><span class="diff-line add">+{% endif %}</span><span class="diff-line add">+{% set service_partof = lookup(&#x27;role_var&#x27;, &#x27;_service_partof&#x27;, role=&#x27;qbittorrent&#x27;) %}</span><span class="diff-line add">+{% if service_partof | length &gt; 0 %}</span><span class="diff-line add">+PartOf={{ service_partof }}</span><span class="diff-line add">+{% endif %}</span><span class="diff-line context"> StartLimitIntervalSec=500s</span><span class="diff-line context"> StartLimitBurst=5</span><span class="diff-line context"> </span><span class="diff-line hunk">@@ -19,9 +33,9 @@</span><span class="diff-line context"> User={{ user.name }}</span><span class="diff-line context"> Group={{ user.name }}</span><span class="diff-line context"> Type=exec</span><span class="diff-line del">-Environment=&quot;XDG_CONFIG_HOME={{ qbittorrent_paths_location }}&quot; &quot;XDG_DATA_HOME={{ qbittorrent_paths_location }}&quot; &quot;HOME={{ qbittorrent_paths_location }}&quot;</span><span class="diff-line add">+Environment=&quot;XDG_CONFIG_HOME={{ lookup(&#x27;role_var&#x27;, &#x27;_paths_location&#x27;, role=&#x27;qbittorrent&#x27;) }}&quot; &quot;XDG_DATA_HOME={{ lookup(&#x27;role_var&#x27;, &#x27;_paths_location&#x27;, role=&#x27;qbittorrent&#x27;) }}&quot; &quot;HOME={{ lookup(&#x27;role_var&#x27;, &#x27;_paths_location&#x27;, role=&#x27;qbittorrent&#x27;) }}&quot;</span><span class="diff-line context"> ExecStartPre=/bin/sleep 10</span><span class="diff-line del">-ExecStart=/usr/bin/{{ qbittorrent_name }}-nox --webui-port={{ qbittorrent_docker_ports_8080 }}</span><span class="diff-line add">+ExecStart=/usr/bin/{{ qbittorrent_name }}-nox --webui-port={{ lookup(&#x27;role_var&#x27;, &#x27;_docker_ports_8080&#x27;, role=&#x27;qbittorrent&#x27;) }}</span><span class="diff-line context"> AmbientCapabilities=CAP_NET_RAW</span><span class="diff-line context"> TimeoutStopSec=1800</span><span class="diff-line context"> Restart=on-failure</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-300">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/qbittorrent/templates/qbittorrent.yml.j2</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -17,13 +17,13 @@</span><span class="diff-line context">       service: &quot;{{ qbittorrent_name }}&quot;</span><span class="diff-line context">       tls:</span><span class="diff-line context">         options: securetls@file</span><span class="diff-line del">-        certResolver: {{ qbittorrent_traefik_certresolver }}</span><span class="diff-line del">-{% if lookup(&#x27;vars&#x27;, qbittorrent_name + &#x27;_traefik_api_enabled&#x27;, default=qbittorrent_traefik_api_enabled) %}</span><span class="diff-line add">+        certResolver: {{ lookup(&#x27;role_var&#x27;, &#x27;_traefik_certresolver&#x27;, role=&#x27;qbittorrent&#x27;) }}</span><span class="diff-line add">+{% if lookup(&#x27;role_var&#x27;, &#x27;_traefik_api_enabled&#x27;, role=&#x27;qbittorrent&#x27;) %}</span><span class="diff-line context"> </span><span class="diff-line context">     {{ qbittorrent_name }}-api-http:</span><span class="diff-line context">       entryPoints:</span><span class="diff-line context">         - &quot;web&quot;</span><span class="diff-line del">-      rule: &quot;{{ traefik_host_template + &#x27; &amp;&amp; (&#x27; + lookup(&#x27;vars&#x27;, qbittorrent_name + &#x27;_traefik_api_endpoint&#x27;, default=qbittorrent_traefik_api_endpoint) }})&quot;</span><span class="diff-line add">+      rule: &quot;{{ traefik_host_template + &#x27; &amp;&amp; (&#x27; + lookup(&#x27;role_var&#x27;, &#x27;_traefik_api_endpoint&#x27;, role=&#x27;qbittorrent&#x27;) }})&quot;</span><span class="diff-line context">       middlewares:</span><span class="diff-line context">         {{ traefik_default_middleware_http_api.split(&#x27;,&#x27;) | to_nice_yaml | trim | indent(8) }}</span><span class="diff-line context">       service: &quot;{{ qbittorrent_name }}&quot;</span><span class="diff-line hunk">@@ -31,29 +31,29 @@</span><span class="diff-line context">     {{ qbittorrent_name }}-api:</span><span class="diff-line context">       entryPoints:</span><span class="diff-line context">         - &quot;websecure&quot;</span><span class="diff-line del">-      rule: &quot;{{ traefik_host_template + &#x27; &amp;&amp; (&#x27; + lookup(&#x27;vars&#x27;, qbittorrent_name + &#x27;_traefik_api_endpoint&#x27;, default=qbittorrent_traefik_api_endpoint) }})&quot;</span><span class="diff-line add">+      rule: &quot;{{ traefik_host_template + &#x27; &amp;&amp; (&#x27; + lookup(&#x27;role_var&#x27;, &#x27;_traefik_api_endpoint&#x27;, role=&#x27;qbittorrent&#x27;) }})&quot;</span><span class="diff-line context">       middlewares:</span><span class="diff-line context">         {{ traefik_default_middleware_api.split(&#x27;,&#x27;) | to_nice_yaml | trim | indent(8) }}</span><span class="diff-line context">       service: &quot;{{ qbittorrent_name }}&quot;</span><span class="diff-line context">       tls:</span><span class="diff-line context">         options: securetls@file</span><span class="diff-line del">-        certResolver: {{ qbittorrent_traefik_certresolver }}</span><span class="diff-line add">+        certResolver: {{ lookup(&#x27;role_var&#x27;, &#x27;_traefik_certresolver&#x27;, role=&#x27;qbittorrent&#x27;) }}</span><span class="diff-line context"> {% endif %}</span><span class="diff-line context"> </span><span class="diff-line context">   services:</span><span class="diff-line context">     {{ qbittorrent_name }}:</span><span class="diff-line context">       loadBalancer:</span><span class="diff-line context">         servers:</span><span class="diff-line del">-          - url: &quot;http://172.19.0.1:{{ qbittorrent_docker_ports_8080 }}&quot;</span><span class="diff-line del">-{% if qbittorrent_themepark_enabled and global_themepark_plugin_enabled %}</span><span class="diff-line add">+          - url: &quot;http://172.19.0.1:{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_ports_8080&#x27;, role=&#x27;qbittorrent&#x27;) }}&quot;</span><span class="diff-line add">+{% if lookup(&#x27;role_var&#x27;, &#x27;_themepark_enabled&#x27;, role=&#x27;qbittorrent&#x27;) and global_themepark_plugin_enabled %}</span><span class="diff-line context"> </span><span class="diff-line context">   middlewares:</span><span class="diff-line del">-    themepark-{{ lookup(&quot;vars&quot;, qbittorrent_name + &quot;_name&quot;, default=qbittorrent_name) }}:</span><span class="diff-line add">+    themepark-{{ qbittorrent_name }}:</span><span class="diff-line context">       plugin:</span><span class="diff-line context">         themepark:</span><span class="diff-line del">-          app: &quot;{{ qbittorrent_themepark_app }}&quot;</span><span class="diff-line del">-          theme: &quot;{{ lookup(&quot;vars&quot;, qbittorrent_name + &quot;_themepark_theme&quot;, default=qbittorrent_themepark_theme) }}&quot;</span><span class="diff-line del">-{% if lookup(&quot;vars&quot;, qbittorrent_name + &quot;_themepark_addons&quot;, default=qbittorrent_themepark_addons) | length &gt; 0 %}</span><span class="diff-line del">-          addons: &quot;{{ lookup(&quot;vars&quot;, qbittorrent_name + &quot;_themepark_addons&quot;, default=qbittorrent_themepark_addons) }}&quot;</span><span class="diff-line add">+          app: &quot;{{ qbittorrent_role_themepark_app }}&quot;</span><span class="diff-line add">+          theme: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_themepark_theme&#x27;, role=&#x27;qbittorrent&#x27;) }}&quot;</span><span class="diff-line add">+{% if lookup(&#x27;role_var&#x27;, &#x27;_themepark_addons&#x27;, role=&#x27;qbittorrent&#x27;) | length &gt; 0 %}</span><span class="diff-line add">+          addons: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_themepark_addons&#x27;, role=&#x27;qbittorrent&#x27;) }}&quot;</span><span class="diff-line context"> {% endif %}</span><span class="diff-line context"> {% endif %}</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-301">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/radarr/defaults/main.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -17,171 +17,121 @@</span><span class="diff-line context"> # Settings</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-radarr_external_auth: true</span><span class="diff-line add">+radarr_role_external_auth: true</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # Paths</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-radarr_paths_folder: &quot;{{ radarr_name }}&quot;</span><span class="diff-line del">-radarr_paths_location: &quot;{{ server_appdata_path }}/{{ radarr_paths_folder }}&quot;</span><span class="diff-line del">-radarr_paths_folders_list:</span><span class="diff-line del">-  - &quot;{{ radarr_paths_location }}&quot;</span><span class="diff-line del">-radarr_paths_config_location: &quot;{{ radarr_paths_location }}/config.xml&quot;</span><span class="diff-line add">+radarr_role_paths_folder: &quot;{{ radarr_name }}&quot;</span><span class="diff-line add">+radarr_role_paths_location: &quot;{{ server_appdata_path }}/{{ radarr_role_paths_folder }}&quot;</span><span class="diff-line add">+radarr_role_paths_folders_list:</span><span class="diff-line add">+  - &quot;{{ radarr_role_paths_location }}&quot;</span><span class="diff-line add">+radarr_role_paths_config_location: &quot;{{ radarr_role_paths_location }}/config.xml&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # Web</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-radarr_web_subdomain: &quot;{{ radarr_name }}&quot;</span><span class="diff-line del">-radarr_web_domain: &quot;{{ user.domain }}&quot;</span><span class="diff-line del">-radarr_web_port: &quot;7878&quot;</span><span class="diff-line del">-radarr_web_url: &quot;{{ &#x27;https://&#x27; + (lookup(&#x27;vars&#x27;, radarr_name + &#x27;_web_subdomain&#x27;, default=radarr_web_subdomain) + &#x27;.&#x27; + lookup(&#x27;vars&#x27;, radarr_name + &#x27;_web_domain&#x27;, default=radarr_web_domain)</span><span class="diff-line del">-                 if (lookup(&#x27;vars&#x27;, radarr_name + &#x27;_web_subdomain&#x27;, default=radarr_web_subdomain) | length &gt; 0)</span><span class="diff-line del">-                 else lookup(&#x27;vars&#x27;, radarr_name + &#x27;_web_domain&#x27;, default=radarr_web_domain)) }}&quot;</span><span class="diff-line add">+radarr_role_web_subdomain: &quot;{{ radarr_name }}&quot;</span><span class="diff-line add">+radarr_role_web_domain: &quot;{{ user.domain }}&quot;</span><span class="diff-line add">+radarr_role_web_port: &quot;7878&quot;</span><span class="diff-line add">+radarr_role_web_url: &quot;{{ &#x27;https://&#x27; + (lookup(&#x27;role_var&#x27;, &#x27;_web_subdomain&#x27;, role=&#x27;radarr&#x27;) + &#x27;.&#x27; + lookup(&#x27;role_var&#x27;, &#x27;_web_domain&#x27;, role=&#x27;radarr&#x27;)</span><span class="diff-line add">+                      if (lookup(&#x27;role_var&#x27;, &#x27;_web_subdomain&#x27;, role=&#x27;radarr&#x27;) | length &gt; 0)</span><span class="diff-line add">+                      else lookup(&#x27;role_var&#x27;, &#x27;_web_domain&#x27;, role=&#x27;radarr&#x27;)) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # DNS</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-radarr_dns_record: &quot;{{ lookup(&#x27;vars&#x27;, radarr_name + &#x27;_web_subdomain&#x27;, default=radarr_web_subdomain) }}&quot;</span><span class="diff-line del">-radarr_dns_zone: &quot;{{ lookup(&#x27;vars&#x27;, radarr_name + &#x27;_web_domain&#x27;, default=radarr_web_domain) }}&quot;</span><span class="diff-line del">-radarr_dns_proxy: &quot;{{ dns.proxied }}&quot;</span><span class="diff-line add">+radarr_role_dns_record: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_web_subdomain&#x27;, role=&#x27;radarr&#x27;) }}&quot;</span><span class="diff-line add">+radarr_role_dns_zone: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_web_domain&#x27;, role=&#x27;radarr&#x27;) }}&quot;</span><span class="diff-line add">+radarr_role_dns_proxy: &quot;{{ dns_proxied }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # Traefik</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-radarr_traefik_sso_middleware: &quot;{{ traefik_default_sso_middleware }}&quot;</span><span class="diff-line del">-radarr_traefik_middleware_default: &quot;{{ traefik_default_middleware</span><span class="diff-line del">-                                       + (&#x27;,themepark-&#x27; + lookup(&#x27;vars&#x27;, radarr_name + &#x27;_name&#x27;, default=radarr_name)</span><span class="diff-line del">-                                         if (radarr_themepark_enabled and global_themepark_plugin_enabled)</span><span class="diff-line del">-                                         else &#x27;&#x27;) }}&quot;</span><span class="diff-line del">-radarr_traefik_middleware_custom: &quot;&quot;</span><span class="diff-line del">-radarr_traefik_certresolver: &quot;{{ traefik_default_certresolver }}&quot;</span><span class="diff-line del">-radarr_traefik_enabled: true</span><span class="diff-line del">-radarr_traefik_api_enabled: true</span><span class="diff-line del">-radarr_traefik_api_endpoint: &quot;PathPrefix(`/api`) || PathPrefix(`/feed`) || PathPrefix(`/ping`)&quot;</span><span class="diff-line add">+radarr_role_traefik_sso_middleware: &quot;{{ traefik_default_sso_middleware }}&quot;</span><span class="diff-line add">+radarr_role_traefik_middleware_default: &quot;{{ traefik_default_middleware</span><span class="diff-line add">+                                            + (&#x27;,themepark-&#x27; + radarr_name</span><span class="diff-line add">+                                              if (lookup(&#x27;role_var&#x27;, &#x27;_themepark_enabled&#x27;, role=&#x27;radarr&#x27;) and global_themepark_plugin_enabled)</span><span class="diff-line add">+                                              else &#x27;&#x27;) }}&quot;</span><span class="diff-line add">+radarr_role_traefik_middleware_custom: &quot;&quot;</span><span class="diff-line add">+radarr_role_traefik_certresolver: &quot;{{ traefik_default_certresolver }}&quot;</span><span class="diff-line add">+radarr_role_traefik_enabled: true</span><span class="diff-line add">+radarr_role_traefik_api_enabled: true</span><span class="diff-line add">+radarr_role_traefik_api_endpoint: &quot;PathPrefix(`/api`) || PathPrefix(`/feed`) || PathPrefix(`/ping`)&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line del">-# API</span><span class="diff-line del">-################################</span><span class="diff-line del">-</span><span class="diff-line del">-# default to blank</span><span class="diff-line del">-radarr_api_key:</span><span class="diff-line del">-</span><span class="diff-line del">-################################</span><span class="diff-line del">-# THEME</span><span class="diff-line add">+# Theme</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line context"> # Options can be found at https://github.com/themepark-dev/theme.park</span><span class="diff-line del">-radarr_themepark_enabled: false</span><span class="diff-line del">-radarr_themepark_app: &quot;radarr&quot;</span><span class="diff-line del">-radarr_themepark_theme: &quot;{{ global_themepark_theme }}&quot;</span><span class="diff-line del">-radarr_themepark_domain: &quot;{{ global_themepark_domain }}&quot;</span><span class="diff-line del">-radarr_themepark_addons: []</span><span class="diff-line add">+radarr_role_themepark_enabled: false</span><span class="diff-line add">+radarr_role_themepark_app: &quot;radarr&quot;</span><span class="diff-line add">+radarr_role_themepark_theme: &quot;{{ global_themepark_theme }}&quot;</span><span class="diff-line add">+radarr_role_themepark_domain: &quot;{{ global_themepark_domain }}&quot;</span><span class="diff-line add">+radarr_role_themepark_addons: []</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # Docker</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line context"> # Container</span><span class="diff-line del">-radarr_docker_container: &quot;{{ radarr_name }}&quot;</span><span class="diff-line add">+radarr_role_docker_container: &quot;{{ radarr_name }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Image</span><span class="diff-line del">-radarr_docker_image_pull: true</span><span class="diff-line del">-radarr_docker_image_repo: &quot;ghcr.io/hotio/radarr&quot;</span><span class="diff-line del">-radarr_docker_image_tag: &quot;release&quot;</span><span class="diff-line del">-radarr_docker_image: &quot;{{ lookup(&#x27;vars&#x27;, radarr_name + &#x27;_docker_image_repo&#x27;, default=radarr_docker_image_repo)</span><span class="diff-line del">-                         + &#x27;:&#x27; + lookup(&#x27;vars&#x27;, radarr_name + &#x27;_docker_image_tag&#x27;, default=radarr_docker_image_tag) }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Ports</span><span class="diff-line del">-radarr_docker_ports_defaults: []</span><span class="diff-line del">-radarr_docker_ports_custom: []</span><span class="diff-line del">-radarr_docker_ports: &quot;{{ lookup(&#x27;vars&#x27;, radarr_name + &#x27;_docker_ports_defaults&#x27;, default=radarr_docker_ports_defaults)</span><span class="diff-line del">-                         + lookup(&#x27;vars&#x27;, radarr_name + &#x27;_docker_ports_custom&#x27;, default=radarr_docker_ports_custom) }}&quot;</span><span class="diff-line add">+radarr_role_docker_image_pull: true</span><span class="diff-line add">+radarr_role_docker_image_repo: &quot;ghcr.io/hotio/radarr&quot;</span><span class="diff-line add">+radarr_role_docker_image_tag: &quot;release&quot;</span><span class="diff-line add">+radarr_role_docker_image: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_image_repo&#x27;, role=&#x27;radarr&#x27;) }}:{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_image_tag&#x27;, role=&#x27;radarr&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Envs</span><span class="diff-line del">-radarr_docker_envs_default:</span><span class="diff-line add">+radarr_role_docker_envs_default:</span><span class="diff-line context">   PUID: &quot;{{ uid }}&quot;</span><span class="diff-line context">   PGID: &quot;{{ gid }}&quot;</span><span class="diff-line context">   UMASK: &quot;002&quot;</span><span class="diff-line context">   TZ: &quot;{{ tz }}&quot;</span><span class="diff-line del">-radarr_docker_envs_custom: {}</span><span class="diff-line del">-radarr_docker_envs: &quot;{{ lookup(&#x27;vars&#x27;, radarr_name + &#x27;_docker_envs_default&#x27;, default=radarr_docker_envs_default)</span><span class="diff-line del">-                        | combine(lookup(&#x27;vars&#x27;, radarr_name + &#x27;_docker_envs_custom&#x27;, default=radarr_docker_envs_custom)) }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Commands</span><span class="diff-line del">-radarr_docker_commands_default: []</span><span class="diff-line del">-radarr_docker_commands_custom: []</span><span class="diff-line del">-radarr_docker_commands: &quot;{{ lookup(&#x27;vars&#x27;, radarr_name + &#x27;_docker_commands_default&#x27;, default=radarr_docker_commands_default)</span><span class="diff-line del">-                            + lookup(&#x27;vars&#x27;, radarr_name + &#x27;_docker_commands_custom&#x27;, default=radarr_docker_commands_custom) }}&quot;</span><span class="diff-line add">+radarr_role_docker_envs_custom: {}</span><span class="diff-line add">+radarr_role_docker_envs: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_envs_default&#x27;, role=&#x27;radarr&#x27;)</span><span class="diff-line add">+                             | combine(lookup(&#x27;role_var&#x27;, &#x27;_docker_envs_custom&#x27;, role=&#x27;radarr&#x27;)) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Volumes</span><span class="diff-line del">-radarr_docker_volumes_default:</span><span class="diff-line del">-  - &quot;{{ radarr_paths_location }}:/config&quot;</span><span class="diff-line add">+radarr_role_docker_volumes_default:</span><span class="diff-line add">+  - &quot;{{ radarr_role_paths_location }}:/config&quot;</span><span class="diff-line context">   - &quot;{{ server_appdata_path }}/scripts:/scripts&quot;</span><span class="diff-line del">-radarr_docker_volumes_legacy:</span><span class="diff-line add">+radarr_role_docker_volumes_legacy:</span><span class="diff-line context">   - &quot;/mnt/unionfs/Media/Movies:/movies&quot;</span><span class="diff-line del">-radarr_docker_volumes_custom: []</span><span class="diff-line del">-radarr_docker_volumes: &quot;{{ lookup(&#x27;vars&#x27;, radarr_name + &#x27;_docker_volumes_default&#x27;, default=radarr_docker_volumes_default)</span><span class="diff-line del">-                           + lookup(&#x27;vars&#x27;, radarr_name + &#x27;_docker_volumes_custom&#x27;, default=radarr_docker_volumes_custom)</span><span class="diff-line del">-                           + (lookup(&#x27;vars&#x27;, radarr_name + &#x27;_docker_volumes_legacy&#x27;, default=radarr_docker_volumes_legacy)</span><span class="diff-line del">-                             if docker_legacy_volume</span><span class="diff-line del">-                             else []) }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Devices</span><span class="diff-line del">-radarr_docker_devices_default: []</span><span class="diff-line del">-radarr_docker_devices_custom: []</span><span class="diff-line del">-radarr_docker_devices: &quot;{{ lookup(&#x27;vars&#x27;, radarr_name + &#x27;_docker_devices_default&#x27;, default=radarr_docker_devices_default)</span><span class="diff-line del">-                           + lookup(&#x27;vars&#x27;, radarr_name + &#x27;_docker_devices_custom&#x27;, default=radarr_docker_devices_custom) }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Hosts</span><span class="diff-line del">-radarr_docker_hosts_default: {}</span><span class="diff-line del">-radarr_docker_hosts_custom: {}</span><span class="diff-line del">-radarr_docker_hosts: &quot;{{ docker_hosts_common</span><span class="diff-line del">-                         | combine(lookup(&#x27;vars&#x27;, radarr_name + &#x27;_docker_hosts_default&#x27;, default=radarr_docker_hosts_default))</span><span class="diff-line del">-                         | combine(lookup(&#x27;vars&#x27;, radarr_name + &#x27;_docker_hosts_custom&#x27;, default=radarr_docker_hosts_custom)) }}&quot;</span><span class="diff-line add">+radarr_role_docker_volumes_custom: []</span><span class="diff-line add">+radarr_role_docker_volumes: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_volumes_default&#x27;, role=&#x27;radarr&#x27;)</span><span class="diff-line add">+                                + lookup(&#x27;role_var&#x27;, &#x27;_docker_volumes_custom&#x27;, role=&#x27;radarr&#x27;)</span><span class="diff-line add">+                                + (lookup(&#x27;role_var&#x27;, &#x27;_docker_volumes_legacy&#x27;, role=&#x27;radarr&#x27;)</span><span class="diff-line add">+                                  if docker_legacy_volume</span><span class="diff-line add">+                                  else []) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Labels</span><span class="diff-line del">-radarr_docker_labels_default: {}</span><span class="diff-line del">-radarr_docker_labels_custom: {}</span><span class="diff-line del">-radarr_docker_labels: &quot;{{ docker_labels_common</span><span class="diff-line del">-                          | combine(lookup(&#x27;vars&#x27;, radarr_name + &#x27;_docker_labels_default&#x27;, default=radarr_docker_labels_default))</span><span class="diff-line del">-                          | combine((traefik_themepark_labels</span><span class="diff-line del">-                                    if (radarr_themepark_enabled and global_themepark_plugin_enabled)</span><span class="diff-line del">-                                    else {}),</span><span class="diff-line del">-                                    lookup(&#x27;vars&#x27;, radarr_name + &#x27;_docker_labels_custom&#x27;, default=radarr_docker_labels_custom)) }}&quot;</span><span class="diff-line add">+radarr_role_docker_labels_default: {}</span><span class="diff-line add">+radarr_role_docker_labels_custom: {}</span><span class="diff-line add">+radarr_role_docker_labels: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_labels_default&#x27;, role=&#x27;radarr&#x27;)</span><span class="diff-line add">+                               | combine((traefik_themepark_labels</span><span class="diff-line add">+                                         if (lookup(&#x27;role_var&#x27;, &#x27;_themepark_enabled&#x27;, role=&#x27;radarr&#x27;) and global_themepark_plugin_enabled)</span><span class="diff-line add">+                                         else {}),</span><span class="diff-line add">+                                         lookup(&#x27;role_var&#x27;, &#x27;_docker_labels_custom&#x27;, role=&#x27;radarr&#x27;)) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Hostname</span><span class="diff-line del">-radarr_docker_hostname: &quot;{{ radarr_name }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Network Mode</span><span class="diff-line del">-radarr_docker_network_mode_default: &quot;{{ docker_networks_name_common }}&quot;</span><span class="diff-line del">-radarr_docker_network_mode: &quot;{{ lookup(&#x27;vars&#x27;, radarr_name + &#x27;_docker_network_mode_default&#x27;, default=radarr_docker_network_mode_default) }}&quot;</span><span class="diff-line add">+radarr_role_docker_hostname: &quot;{{ radarr_name }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Networks</span><span class="diff-line del">-radarr_docker_networks_alias: &quot;{{ radarr_name }}&quot;</span><span class="diff-line del">-radarr_docker_networks_default: []</span><span class="diff-line del">-radarr_docker_networks_custom: []</span><span class="diff-line del">-radarr_docker_networks: &quot;{{ docker_networks_common</span><span class="diff-line del">-                            + lookup(&#x27;vars&#x27;, radarr_name + &#x27;_docker_networks_default&#x27;, default=radarr_docker_networks_default)</span><span class="diff-line del">-                            + lookup(&#x27;vars&#x27;, radarr_name + &#x27;_docker_networks_custom&#x27;, default=radarr_docker_networks_custom) }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Capabilities</span><span class="diff-line del">-radarr_docker_capabilities_default: []</span><span class="diff-line del">-radarr_docker_capabilities_custom: []</span><span class="diff-line del">-radarr_docker_capabilities: &quot;{{ lookup(&#x27;vars&#x27;, radarr_name + &#x27;_docker_capabilities_default&#x27;, default=radarr_docker_capabilities_default)</span><span class="diff-line del">-                                + lookup(&#x27;vars&#x27;, radarr_name + &#x27;_docker_capabilities_custom&#x27;, default=radarr_docker_capabilities_custom) }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Security Opts</span><span class="diff-line del">-radarr_docker_security_opts_default: []</span><span class="diff-line del">-radarr_docker_security_opts_custom: []</span><span class="diff-line del">-radarr_docker_security_opts: &quot;{{ lookup(&#x27;vars&#x27;, radarr_name + &#x27;_docker_security_opts_default&#x27;, default=radarr_docker_security_opts_default)</span><span class="diff-line del">-                                 + lookup(&#x27;vars&#x27;, radarr_name + &#x27;_docker_security_opts_custom&#x27;, default=radarr_docker_security_opts_custom) }}&quot;</span><span class="diff-line add">+radarr_role_docker_networks_alias: &quot;{{ radarr_name }}&quot;</span><span class="diff-line add">+radarr_role_docker_networks_default: []</span><span class="diff-line add">+radarr_role_docker_networks_custom: []</span><span class="diff-line add">+radarr_role_docker_networks: &quot;{{ docker_networks_common</span><span class="diff-line add">+                                 + lookup(&#x27;role_var&#x27;, &#x27;_docker_networks_default&#x27;, role=&#x27;radarr&#x27;)</span><span class="diff-line add">+                                 + lookup(&#x27;role_var&#x27;, &#x27;_docker_networks_custom&#x27;, role=&#x27;radarr&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Restart Policy</span><span class="diff-line del">-radarr_docker_restart_policy: unless-stopped</span><span class="diff-line add">+radarr_role_docker_restart_policy: unless-stopped</span><span class="diff-line context"> </span><span class="diff-line context"> # State</span><span class="diff-line del">-radarr_docker_state: started</span><span class="diff-line add">+radarr_role_docker_state: started</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-302">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/radarr/tasks/main2.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -10,9 +10,9 @@</span><span class="diff-line context"> - name: Add DNS record</span><span class="diff-line context">   ansible.builtin.include_tasks: &quot;{{ resources_tasks_path }}/dns/tasker.yml&quot;</span><span class="diff-line context">   vars:</span><span class="diff-line del">-    dns_record: &quot;{{ lookup(&#x27;vars&#x27;, role_name + &#x27;_dns_record&#x27;) }}&quot;</span><span class="diff-line del">-    dns_zone: &quot;{{ lookup(&#x27;vars&#x27;, role_name + &#x27;_dns_zone&#x27;) }}&quot;</span><span class="diff-line del">-    dns_proxy: &quot;{{ lookup(&#x27;vars&#x27;, role_name + &#x27;_dns_proxy&#x27;) }}&quot;</span><span class="diff-line add">+    dns_record: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_dns_record&#x27;) }}&quot;</span><span class="diff-line add">+    dns_zone: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_dns_zone&#x27;) }}&quot;</span><span class="diff-line add">+    dns_proxy: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_dns_proxy&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Remove existing Docker container</span><span class="diff-line context">   ansible.builtin.include_tasks: &quot;{{ resources_tasks_path }}/docker/remove_docker_container.yml&quot;</span><span class="diff-line hunk">@@ -24,5 +24,5 @@</span><span class="diff-line context">   ansible.builtin.include_tasks: &quot;{{ resources_tasks_path }}/docker/create_docker_container.yml&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: &quot;Tweak Settings when SSO is enabled&quot;</span><span class="diff-line del">-  ansible.builtin.import_tasks: &quot;subtasks/auth.yml&quot;</span><span class="diff-line del">-  when: (lookup(&#x27;vars&#x27;, radarr_name + &#x27;_traefik_sso_middleware&#x27;, default=radarr_traefik_sso_middleware) | length &gt; 0) and lookup(&#x27;vars&#x27;, radarr_name + &#x27;_external_auth&#x27;, default=radarr_external_auth)</span><span class="diff-line add">+  ansible.builtin.include_tasks: &quot;subtasks/auth.yml&quot;</span><span class="diff-line add">+  when: (lookup(&#x27;vars&#x27;, radarr_name + &#x27;_traefik_sso_middleware&#x27;, default=radarr_role_traefik_sso_middleware) | length &gt; 0) and lookup(&#x27;vars&#x27;, radarr_name + &#x27;_external_auth&#x27;, default=radarr_role_external_auth)</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-303">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/radarr/tasks/subtasks/auth.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -9,7 +9,7 @@</span><span class="diff-line context"> ---</span><span class="diff-line context"> - name: Auth | Wait for &#x27;config.xml&#x27; to be created</span><span class="diff-line context">   ansible.builtin.wait_for:</span><span class="diff-line del">-    path: &quot;/opt/{{ radarr_name }}/config.xml&quot;</span><span class="diff-line add">+    path: &quot;{{ server_appdata_path }}/{{ radarr_name }}/config.xml&quot;</span><span class="diff-line context">     state: present</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Auth | Wait for 10 seconds</span><span class="diff-line hunk">@@ -18,7 +18,7 @@</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Auth | Lookup AuthenticationMethod value</span><span class="diff-line context">   community.general.xml:</span><span class="diff-line del">-    path: &quot;/opt/{{ radarr_name }}/config.xml&quot;</span><span class="diff-line add">+    path: &quot;{{ server_appdata_path }}/{{ radarr_name }}/config.xml&quot;</span><span class="diff-line context">     xpath: &quot;/Config/AuthenticationMethod&quot;</span><span class="diff-line context">     content: &quot;text&quot;</span><span class="diff-line context">   register: xmlresp</span><span class="diff-line hunk">@@ -28,7 +28,7 @@</span><span class="diff-line context">   block:</span><span class="diff-line context">     - name: Auth | Change the &#x27;AuthenticationMethod&#x27; attribute to &#x27;External&#x27;</span><span class="diff-line context">       community.general.xml:</span><span class="diff-line del">-        path: &quot;/opt/{{ radarr_name }}/config.xml&quot;</span><span class="diff-line add">+        path: &quot;{{ server_appdata_path }}/{{ radarr_name }}/config.xml&quot;</span><span class="diff-line context">         xpath: &quot;/Config/AuthenticationMethod&quot;</span><span class="diff-line context">         value: &quot;External&quot;</span><span class="diff-line context"> </span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-304">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/rclone/tasks/main.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -8,13 +8,13 @@</span><span class="diff-line context"> #########################################################################</span><span class="diff-line context"> ---</span><span class="diff-line context"> - name: Build URL Tasks</span><span class="diff-line del">-  ansible.builtin.import_tasks: &quot;subtasks/01_build_url.yml&quot;</span><span class="diff-line add">+  ansible.builtin.include_tasks: &quot;subtasks/01_build_url.yml&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Install Binary Tasks</span><span class="diff-line del">-  ansible.builtin.import_tasks: &quot;subtasks/02_install_binary.yml&quot;</span><span class="diff-line add">+  ansible.builtin.include_tasks: &quot;subtasks/02_install_binary.yml&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Import Existing Config Tasks</span><span class="diff-line del">-  ansible.builtin.import_tasks: &quot;subtasks/03_import_config.yml&quot;</span><span class="diff-line add">+  ansible.builtin.include_tasks: &quot;subtasks/03_import_config.yml&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Preinstall Tasks</span><span class="diff-line context">   ansible.builtin.include_tasks: &quot;subtasks/99_preinstall.yml&quot;</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-305">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/rclone/tasks/subtasks/01_build_url.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -9,7 +9,7 @@</span><span class="diff-line context"> ---</span><span class="diff-line context"> - name: Build URL | Install common packages</span><span class="diff-line context">   ansible.builtin.apt:</span><span class="diff-line del">-    state: present</span><span class="diff-line add">+    state: latest</span><span class="diff-line context">     name:</span><span class="diff-line context">       - curl</span><span class="diff-line context">       - jq</span><span class="diff-line hunk">@@ -65,7 +65,7 @@</span><span class="diff-line context">           if ((rclone.version | type_debug == &#x27;float&#x27;) or (rclone.version | type_debug == &#x27;int&#x27;))</span><span class="diff-line context">           else (rclone.version | regex_replace(&#x27;(^v\\.|^v)&#x27;, &#x27;&#x27;)) }}</span><span class="diff-line context"> </span><span class="diff-line del">-    - name: Build URL | Check if version &#x27;{{ rclone_version_specified0 }}&#x27; is available</span><span class="diff-line add">+    - name: Build URL | Check if specified version is available</span><span class="diff-line context">       ansible.builtin.shell: |</span><span class="diff-line context">         curl -sL {{ svm }}https://api.github.com/repos/ncw/rclone/git/refs/tags \</span><span class="diff-line context">         | jq -r  &#x27;.[] | .ref&#x27; | sed &#x27;s/\/\?refs\/tags\/v//g&#x27; \</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-306">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/rclone/tasks/subtasks/02_install_binary.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -9,7 +9,7 @@</span><span class="diff-line context"> ---</span><span class="diff-line context"> - name: Install Binary | Install common packages</span><span class="diff-line context">   ansible.builtin.apt:</span><span class="diff-line del">-    state: present</span><span class="diff-line add">+    state: latest</span><span class="diff-line context">     name:</span><span class="diff-line context">       - unzip</span><span class="diff-line context">       - man-db</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-307">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/redis/defaults/main.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -17,102 +17,54 @@</span><span class="diff-line context"> # Paths</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-redis_paths_folder: &quot;{{ redis_name }}&quot;</span><span class="diff-line del">-redis_paths_location: &quot;{{ server_appdata_path }}/{{ redis_paths_folder }}&quot;</span><span class="diff-line del">-redis_paths_folders_list:</span><span class="diff-line del">-  - &quot;{{ redis_paths_location }}&quot;</span><span class="diff-line add">+redis_role_paths_folder: &quot;{{ redis_name }}&quot;</span><span class="diff-line add">+redis_role_paths_location: &quot;{{ server_appdata_path }}/{{ redis_role_paths_folder }}&quot;</span><span class="diff-line add">+redis_role_paths_folders_list:</span><span class="diff-line add">+  - &quot;{{ redis_role_paths_location }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # Docker</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line context"> # Container</span><span class="diff-line del">-redis_docker_container: &quot;{{ redis_name }}&quot;</span><span class="diff-line add">+redis_role_docker_container: &quot;{{ redis_name }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Image</span><span class="diff-line del">-redis_docker_image_pull: true</span><span class="diff-line del">-redis_docker_image_tag: &quot;alpine&quot;</span><span class="diff-line del">-redis_docker_image_repo: &quot;redis&quot;</span><span class="diff-line del">-redis_docker_image: &quot;{{ lookup(&#x27;vars&#x27;, redis_name + &#x27;_docker_image_repo&#x27;, default=redis_docker_image_repo) }}:{{ lookup(&#x27;vars&#x27;, redis_name + &#x27;_docker_image_tag&#x27;, default=redis_docker_image_tag) }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Ports</span><span class="diff-line del">-redis_docker_ports_defaults: []</span><span class="diff-line del">-redis_docker_ports_custom: []</span><span class="diff-line del">-redis_docker_ports: &quot;{{ lookup(&#x27;vars&#x27;, redis_name + &#x27;_docker_ports_defaults&#x27;, default=redis_docker_ports_defaults)</span><span class="diff-line del">-                        + lookup(&#x27;vars&#x27;, redis_name + &#x27;_docker_ports_custom&#x27;, default=redis_docker_ports_custom) }}&quot;</span><span class="diff-line add">+redis_role_docker_image_pull: true</span><span class="diff-line add">+redis_role_docker_image_tag: &quot;alpine&quot;</span><span class="diff-line add">+redis_role_docker_image_repo: &quot;redis&quot;</span><span class="diff-line add">+redis_role_docker_image: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_image_repo&#x27;, role=&#x27;redis&#x27;) }}:{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_image_tag&#x27;, role=&#x27;redis&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Envs</span><span class="diff-line del">-redis_docker_envs_default:</span><span class="diff-line add">+redis_role_docker_envs_default:</span><span class="diff-line context">   TZ: &quot;{{ tz }}&quot;</span><span class="diff-line del">-redis_docker_envs_custom: {}</span><span class="diff-line del">-redis_docker_envs: &quot;{{ lookup(&#x27;vars&#x27;, redis_name + &#x27;_&#x27;, default=redis_docker_envs_default)</span><span class="diff-line del">-                       | combine(lookup(&#x27;vars&#x27;, redis_name + &#x27;_docker_envs_custom&#x27;, default=redis_docker_envs_custom)) }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Commands</span><span class="diff-line del">-redis_docker_commands_default: []</span><span class="diff-line del">-redis_docker_commands_custom: []</span><span class="diff-line del">-redis_docker_commands: &quot;{{ lookup(&#x27;vars&#x27;, redis_name + &#x27;_docker_commands_default&#x27;, default=redis_docker_commands_default)</span><span class="diff-line del">-                           + lookup(&#x27;vars&#x27;, redis_name + &#x27;_docker_commands_custom&#x27;, default=redis_docker_commands_custom) }}&quot;</span><span class="diff-line add">+redis_role_docker_envs_custom: {}</span><span class="diff-line add">+redis_role_docker_envs: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_envs_default&#x27;, role=&#x27;redis&#x27;)</span><span class="diff-line add">+                            | combine(lookup(&#x27;role_var&#x27;, &#x27;_docker_envs_custom&#x27;, role=&#x27;redis&#x27;)) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Volumes</span><span class="diff-line del">-redis_docker_volumes_default:</span><span class="diff-line del">-  - &quot;{{ redis_paths_location }}:/data&quot;</span><span class="diff-line del">-redis_docker_volumes_custom: []</span><span class="diff-line del">-redis_docker_volumes: &quot;{{ lookup(&#x27;vars&#x27;, redis_name + &#x27;_docker_volumes_default&#x27;, default=redis_docker_volumes_default)</span><span class="diff-line del">-                          + lookup(&#x27;vars&#x27;, redis_name + &#x27;_docker_volumes_custom&#x27;, default=redis_docker_volumes_custom) }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Devices</span><span class="diff-line del">-redis_docker_devices_default: []</span><span class="diff-line del">-redis_docker_devices_custom: []</span><span class="diff-line del">-redis_docker_devices: &quot;{{ lookup(&#x27;vars&#x27;, redis_name + &#x27;_docker_devices_default&#x27;, default=redis_docker_devices_default)</span><span class="diff-line del">-                          + lookup(&#x27;vars&#x27;, redis_name + &#x27;_docker_devices_custom&#x27;, default=redis_docker_devices_custom) }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Hosts</span><span class="diff-line del">-redis_docker_hosts_default: {}</span><span class="diff-line del">-redis_docker_hosts_custom: {}</span><span class="diff-line del">-redis_docker_hosts: &quot;{{ docker_hosts_common</span><span class="diff-line del">-                        | combine(lookup(&#x27;vars&#x27;, redis_name + &#x27;_docker_hosts_default&#x27;, default=redis_docker_hosts_default))</span><span class="diff-line del">-                        | combine(lookup(&#x27;vars&#x27;, redis_name + &#x27;_docker_hosts_custom&#x27;, default=redis_docker_hosts_custom)) }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Labels</span><span class="diff-line del">-redis_docker_labels_default: {}</span><span class="diff-line del">-redis_docker_labels_custom: {}</span><span class="diff-line del">-redis_docker_labels: &quot;{{ docker_labels_common</span><span class="diff-line del">-                         | combine(lookup(&#x27;vars&#x27;, redis_name + &#x27;_docker_labels_default&#x27;, default=redis_docker_labels_default))</span><span class="diff-line del">-                         | combine(lookup(&#x27;vars&#x27;, redis_name + &#x27;_docker_labels_custom&#x27;, default=redis_docker_labels_custom)) }}&quot;</span><span class="diff-line add">+redis_role_docker_volumes_default:</span><span class="diff-line add">+  - &quot;{{ redis_role_paths_location }}:/data&quot;</span><span class="diff-line add">+redis_role_docker_volumes_custom: []</span><span class="diff-line add">+redis_role_docker_volumes: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_volumes_default&#x27;, role=&#x27;redis&#x27;)</span><span class="diff-line add">+                               + lookup(&#x27;role_var&#x27;, &#x27;_docker_volumes_custom&#x27;, role=&#x27;redis&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Hostname</span><span class="diff-line del">-redis_docker_hostname: &quot;{{ redis_name }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Network Mode</span><span class="diff-line del">-redis_docker_network_mode_default: &quot;{{ docker_networks_name_common }}&quot;</span><span class="diff-line del">-redis_docker_network_mode: &quot;{{ lookup(&#x27;vars&#x27;, redis_name + &#x27;_docker_network_mode_default&#x27;, default=redis_docker_network_mode_default) }}&quot;</span><span class="diff-line add">+redis_role_docker_hostname: &quot;{{ redis_name }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Networks</span><span class="diff-line del">-redis_docker_networks_alias: &quot;{{ redis_name }}&quot;</span><span class="diff-line del">-redis_docker_networks_default: []</span><span class="diff-line del">-redis_docker_networks_custom: []</span><span class="diff-line del">-redis_docker_networks: &quot;{{ docker_networks_common</span><span class="diff-line del">-                           + lookup(&#x27;vars&#x27;, redis_name + &#x27;_docker_networks_default&#x27;, default=redis_docker_networks_default)</span><span class="diff-line del">-                           + lookup(&#x27;vars&#x27;, redis_name + &#x27;_docker_networks_custom&#x27;, default=redis_docker_networks_custom) }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Capabilities</span><span class="diff-line del">-redis_docker_capabilities_default: []</span><span class="diff-line del">-redis_docker_capabilities_custom: []</span><span class="diff-line del">-redis_docker_capabilities: &quot;{{ lookup(&#x27;vars&#x27;, redis_name + &#x27;_docker_capabilities_default&#x27;, default=redis_docker_capabilities_default)</span><span class="diff-line del">-                               + lookup(&#x27;vars&#x27;, redis_name + &#x27;_docker_capabilities_custom&#x27;, default=redis_docker_capabilities_custom) }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Security Opts</span><span class="diff-line del">-redis_docker_security_opts_default: []</span><span class="diff-line del">-redis_docker_security_opts_custom: []</span><span class="diff-line del">-redis_docker_security_opts: &quot;{{ lookup(&#x27;vars&#x27;, redis_name + &#x27;_docker_security_opts_default&#x27;, default=redis_docker_security_opts_default)</span><span class="diff-line del">-                                + lookup(&#x27;vars&#x27;, redis_name + &#x27;_docker_security_opts_custom&#x27;, default=redis_docker_security_opts_custom) }}&quot;</span><span class="diff-line add">+redis_role_docker_networks_alias: &quot;{{ redis_name }}&quot;</span><span class="diff-line add">+redis_role_docker_networks_default: []</span><span class="diff-line add">+redis_role_docker_networks_custom: []</span><span class="diff-line add">+redis_role_docker_networks: &quot;{{ docker_networks_common</span><span class="diff-line add">+                                + lookup(&#x27;role_var&#x27;, &#x27;_docker_networks_default&#x27;, role=&#x27;redis&#x27;)</span><span class="diff-line add">+                                + lookup(&#x27;role_var&#x27;, &#x27;_docker_networks_custom&#x27;, role=&#x27;redis&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Restart Policy</span><span class="diff-line del">-redis_docker_restart_policy: unless-stopped</span><span class="diff-line add">+redis_role_docker_restart_policy: unless-stopped</span><span class="diff-line context"> </span><span class="diff-line context"> # State</span><span class="diff-line del">-redis_docker_state: started</span><span class="diff-line add">+redis_role_docker_state: started</span><span class="diff-line context"> </span><span class="diff-line context"> # User</span><span class="diff-line del">-redis_docker_user: &quot;{{ uid }}:{{ gid }}&quot;</span><span class="diff-line add">+redis_role_docker_user: &quot;{{ uid }}:{{ gid }}&quot;</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-308">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/redis/tasks/main2.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -12,7 +12,7 @@</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Reset Redis directory</span><span class="diff-line context">   ansible.builtin.file:</span><span class="diff-line del">-    path: &quot;{{ redis_paths_location }}&quot;</span><span class="diff-line add">+    path: &quot;{{ redis_role_paths_location }}&quot;</span><span class="diff-line context">     state: absent</span><span class="diff-line context">   when: (&#x27;authelia-reset&#x27; in ansible_run_tags)</span><span class="diff-line context"> </span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-309">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/remote/tasks/cleanup.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -17,34 +17,34 @@</span><span class="diff-line context"> - name: &quot;Cleanup | Fail if &#x27;rclone_service_name&#x27; is empty&quot;</span><span class="diff-line context">   ansible.builtin.fail:</span><span class="diff-line context">     msg: &quot;rclone_service_name is empty&quot;</span><span class="diff-line del">-  when: rclone_service_name | length == 0</span><span class="diff-line add">+  when: (rclone_service_name | length == 0)</span><span class="diff-line context"> </span><span class="diff-line context"> - name: &quot;Cleanup | Stop and disable existing &#x27;{{ rclone_service_name }}.service&#x27;&quot;</span><span class="diff-line context">   ansible.builtin.systemd_service:</span><span class="diff-line context">     name: &quot;{{ rclone_service_name }}.service&quot;</span><span class="diff-line context">     state: stopped</span><span class="diff-line context">     enabled: false</span><span class="diff-line del">-  when: rclone_service_name_full in saltbox_managed_rclone_services and rclone_service_status != &#x27;not-found&#x27; and rclone_service_status != &#x27;failed&#x27;</span><span class="diff-line add">+  when: (rclone_service_name_full in saltbox_managed_rclone_services) and (rclone_service_status != &#x27;not-found&#x27;) and (rclone_service_status != &#x27;failed&#x27;)</span><span class="diff-line context"> </span><span class="diff-line context"> - name: &quot;Cleanup | Delete &#x27;{{ rclone_service_name }}.service&#x27;&quot;</span><span class="diff-line context">   ansible.builtin.file:</span><span class="diff-line context">     path: &quot;/etc/systemd/system/{{ rclone_service_name }}.service&quot;</span><span class="diff-line context">     state: absent</span><span class="diff-line del">-  when: rclone_service_name_full in saltbox_managed_rclone_services</span><span class="diff-line add">+  when: (rclone_service_name_full in saltbox_managed_rclone_services)</span><span class="diff-line context"> </span><span class="diff-line context"> - name: &quot;Cleanup | Stop and disable existing &#x27;{{ rclone_refresh_service_name }}&#x27;&quot;</span><span class="diff-line context">   ansible.builtin.systemd_service:</span><span class="diff-line context">     name: &quot;{{ rclone_refresh_service_name }}&quot;</span><span class="diff-line context">     state: stopped</span><span class="diff-line context">     enabled: false</span><span class="diff-line del">-  when: rclone_refresh_service_name in saltbox_managed_rclone_services and rclone_service_status != &#x27;not-found&#x27; and rclone_service_status != &#x27;failed&#x27;</span><span class="diff-line add">+  when: (rclone_refresh_service_name in saltbox_managed_rclone_services) and (rclone_service_status != &#x27;not-found&#x27;) and (rclone_service_status != &#x27;failed&#x27;)</span><span class="diff-line context"> </span><span class="diff-line context"> - name: &quot;Cleanup | Stop and disable existing &#x27;{{ rclone_service_name }}_refresh.timer&#x27;&quot;</span><span class="diff-line context">   ansible.builtin.systemd_service:</span><span class="diff-line context">     name: &quot;{{ rclone_service_name }}_refresh.timer&quot;</span><span class="diff-line context">     state: stopped</span><span class="diff-line context">     enabled: false</span><span class="diff-line del">-  when: rclone_refresh_service_name in saltbox_managed_rclone_services and rclone_service_status != &#x27;not-found&#x27; and rclone_service_status != &#x27;failed&#x27;</span><span class="diff-line add">+  when: (rclone_refresh_service_name in saltbox_managed_rclone_services) and (rclone_service_status != &#x27;not-found&#x27;) and (rclone_service_status != &#x27;failed&#x27;)</span><span class="diff-line context"> </span><span class="diff-line context"> - name: &quot;Cleanup | Delete &#x27;{{ rclone_service_name }}_refresh&#x27; services&quot;</span><span class="diff-line context">   ansible.builtin.file:</span><span class="diff-line hunk">@@ -55,7 +55,7 @@</span><span class="diff-line context">   loop:</span><span class="diff-line context">     - &quot;{{ rclone_service_name }}_refresh.service&quot;</span><span class="diff-line context">     - &quot;{{ rclone_service_name }}_refresh.timer&quot;</span><span class="diff-line del">-  when: rclone_refresh_service_name in saltbox_managed_rclone_services</span><span class="diff-line add">+  when: (rclone_refresh_service_name in saltbox_managed_rclone_services)</span><span class="diff-line context"> </span><span class="diff-line context"> - name: &quot;Cleanup | Set &#x27;cleanup_mount_path&#x27;&quot;</span><span class="diff-line context">   ansible.builtin.set_fact:</span><span class="diff-line hunk">@@ -64,7 +64,7 @@</span><span class="diff-line context"> - name: &quot;Cleanup | Fail if &#x27;cleanup_mount_path&#x27; is empty&quot;</span><span class="diff-line context">   ansible.builtin.fail:</span><span class="diff-line context">     msg: &quot;rclone_service_name is empty&quot;</span><span class="diff-line del">-  when: cleanup_mount_path | length == 0</span><span class="diff-line add">+  when: (cleanup_mount_path | length == 0)</span><span class="diff-line context"> </span><span class="diff-line context"> - name: &quot;Cleanup | Check if &#x27;{{ cleanup_mount_path }}&#x27; exists&quot;</span><span class="diff-line context">   ansible.builtin.stat:</span><span class="diff-line hunk">@@ -92,7 +92,7 @@</span><span class="diff-line context">       when: cleanup_mount_path_stat2.stat.exists</span><span class="diff-line context"> </span><span class="diff-line context">     - name: &quot;Cleanup | Backup non-empty &#x27;{{ cleanup_mount_path }}&#x27; path&quot;</span><span class="diff-line del">-      ansible.builtin.shell: &quot;mv {{ cleanup_mount_path }} {{ cleanup_mount_path }}_{{ &#x27;%Y-%m-%d_%H.%M.%S&#x27; | strftime(ansible_date_time[&#x27;epoch&#x27;] | int) }}&quot;</span><span class="diff-line add">+      ansible.builtin.shell: &quot;mv {{ cleanup_mount_path }} {{ cleanup_mount_path }}_{{ &#x27;%Y-%m-%d_%H.%M.%S&#x27; | strftime(ansible_facts[&#x27;date_time&#x27;][&#x27;epoch&#x27;] | int) }}&quot;</span><span class="diff-line context">       ignore_errors: true</span><span class="diff-line context">       when: cleanup_mount_path_stat2.stat.exists and (cleanup_mount_path_stat_files.matched | int &gt; 0)</span><span class="diff-line context"> </span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-310">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/remote/tasks/main.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -22,8 +22,8 @@</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Get Docker service state</span><span class="diff-line context">   ansible.builtin.set_fact:</span><span class="diff-line del">-    remote_docker_service_running: &quot;{{ (services[&#x27;docker.service&#x27;] is defined) and (services[&#x27;docker.service&#x27;][&#x27;state&#x27;] == &#x27;running&#x27;) }}&quot;</span><span class="diff-line del">-    remote_docker_controller_service_running: &quot;{{ (services[&#x27;saltbox_managed_docker_controller.service&#x27;] is defined) and (services[&#x27;saltbox_managed_docker_controller.service&#x27;][&#x27;state&#x27;] == &#x27;running&#x27;) }}&quot;</span><span class="diff-line add">+    remote_docker_service_running: &quot;{{ (ansible_facts[&#x27;services&#x27;][&#x27;docker.service&#x27;] is defined) and (ansible_facts[&#x27;services&#x27;][&#x27;docker.service&#x27;][&#x27;state&#x27;] == &#x27;running&#x27;) }}&quot;</span><span class="diff-line add">+    remote_docker_controller_service_running: &quot;{{ (ansible_facts[&#x27;services&#x27;][&#x27;saltbox_managed_docker_controller.service&#x27;] is defined) and (ansible_facts[&#x27;services&#x27;][&#x27;saltbox_managed_docker_controller.service&#x27;][&#x27;state&#x27;] == &#x27;running&#x27;) }}&quot;</span><span class="diff-line context">   when: remote_docker_binary.stat.exists</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Tasks for when Docker exists and is running</span><span class="diff-line hunk">@@ -38,6 +38,13 @@</span><span class="diff-line context">       ansible.builtin.set_fact:</span><span class="diff-line context">         containers_list: &quot;{{ remote_docker_running_containers_ps.stdout }}&quot;</span><span class="diff-line context"> </span><span class="diff-line add">+    - name: Check for saltbox_docker_controller:app (legacy controller) in service file</span><span class="diff-line add">+      ansible.builtin.shell: &quot;grep -q &#x27;saltbox_docker_controller:app&#x27; /etc/systemd/system/saltbox_managed_docker_controller.service&quot;</span><span class="diff-line add">+      register: remote_legacy_docker_controller</span><span class="diff-line add">+      failed_when: false</span><span class="diff-line add">+      changed_when: false</span><span class="diff-line add">+      when: (remote_docker_controller_service_running is defined) and remote_docker_controller_service_running</span><span class="diff-line add">+</span><span class="diff-line context">     - name: Block Docker Controller</span><span class="diff-line context">       ansible.builtin.uri:</span><span class="diff-line context">         url: &quot;{{ docker_controller_url }}/block/20&quot;</span><span class="diff-line hunk">@@ -50,7 +57,7 @@</span><span class="diff-line context">       ansible.builtin.systemd_service:</span><span class="diff-line context">         name: saltbox_managed_docker_controller</span><span class="diff-line context">         state: restarted</span><span class="diff-line del">-      when: remote_docker_controller_service_running is defined and remote_docker_controller_service_running</span><span class="diff-line add">+      when: (remote_docker_controller_service_running is defined) and remote_docker_controller_service_running and (remote_legacy_docker_controller.rc is not defined or remote_legacy_docker_controller.rc != 0)</span><span class="diff-line context"> </span><span class="diff-line context">     - name: Wait until Controller is ready</span><span class="diff-line context">       ansible.builtin.uri:</span><span class="diff-line hunk">@@ -78,7 +85,7 @@</span><span class="diff-line context"> </span><span class="diff-line context">     - name: Stop Saltbox Docker containers</span><span class="diff-line context">       ansible.builtin.include_tasks: &quot;{{ resources_tasks_path }}/docker/stop_saltbox_docker_containers.yml&quot;</span><span class="diff-line del">-      when: remote_docker_controller_service_running is defined and remote_docker_controller_service_running</span><span class="diff-line add">+      when: (remote_docker_controller_service_running is defined) and remote_docker_controller_service_running</span><span class="diff-line context"> </span><span class="diff-line context">     - name: &quot;Stop all running Docker containers&quot;</span><span class="diff-line context">       ansible.builtin.shell: &quot;docker stop {{ containers_list }}&quot;</span><span class="diff-line hunk">@@ -91,7 +98,7 @@</span><span class="diff-line context">         method: POST</span><span class="diff-line context">         timeout: 600</span><span class="diff-line context">       ignore_errors: true</span><span class="diff-line del">-      when: remote_docker_controller_service_running is defined and remote_docker_controller_service_running</span><span class="diff-line add">+      when: (remote_docker_controller_service_running is defined) and remote_docker_controller_service_running</span><span class="diff-line context"> </span><span class="diff-line context">     - name: Stop docker service</span><span class="diff-line context">       ansible.builtin.systemd_service:</span><span class="diff-line hunk">@@ -113,14 +120,14 @@</span><span class="diff-line context">   block:</span><span class="diff-line context">     - name: &quot;Create services folder.&quot;</span><span class="diff-line context">       ansible.builtin.file:</span><span class="diff-line del">-        path: &quot;/opt/services&quot;</span><span class="diff-line add">+        path: &quot;{{ server_appdata_path }}/services&quot;</span><span class="diff-line context">         state: directory</span><span class="diff-line context">         owner: &quot;{{ user.name }}&quot;</span><span class="diff-line context">         group: &quot;{{ user.name }}&quot;</span><span class="diff-line context">         mode: &quot;0775&quot;</span><span class="diff-line context">         recurse: true</span><span class="diff-line context"> </span><span class="diff-line del">-    - name: &quot;Synchronize &#x27;/etc/systemd/system&#x27; to &#x27;/opt/services&#x27;&quot;</span><span class="diff-line add">+    - name: &quot;Synchronize &#x27;/etc/systemd/system&#x27; to &#x27;{{ server_appdata_path }}/services&#x27;&quot;</span><span class="diff-line context">       ansible.builtin.shell: |</span><span class="diff-line context">         /usr/bin/rsync \</span><span class="diff-line context">           --delay-updates \</span><span class="diff-line hunk">@@ -133,14 +140,14 @@</span><span class="diff-line context">           --exclude=&#x27;saltbox_managed_*&#x27; \</span><span class="diff-line context">           --include=&#x27;*.service&#x27; \</span><span class="diff-line context">           --include=&#x27;*.mount&#x27; \</span><span class="diff-line del">-          /etc/systemd/system/* /opt/services/</span><span class="diff-line add">+          /etc/systemd/system/* {{ server_appdata_path }}/services/</span><span class="diff-line context">       args:</span><span class="diff-line context">         executable: /bin/bash</span><span class="diff-line context">       ignore_errors: true</span><span class="diff-line context"> </span><span class="diff-line context">     - name: &quot;Reset permissions of folders&quot;</span><span class="diff-line context">       ansible.builtin.file:</span><span class="diff-line del">-        path: &quot;/opt/services&quot;</span><span class="diff-line add">+        path: &quot;{{ server_appdata_path }}/services&quot;</span><span class="diff-line context">         state: directory</span><span class="diff-line context">         owner: &quot;{{ user.name }}&quot;</span><span class="diff-line context">         group: &quot;{{ user.name }}&quot;</span><span class="diff-line hunk">@@ -203,7 +210,7 @@</span><span class="diff-line context"> - name: Get list of existing remote services</span><span class="diff-line context">   ansible.builtin.set_fact:</span><span class="diff-line context">     saltbox_managed_rclone_services: &quot;{{ (saltbox_managed_rclone_services | default({})) | combine({rclone_service.key: rclone_service.value.status}) }}&quot;</span><span class="diff-line del">-  loop: &quot;{{ services | dict2items }}&quot;</span><span class="diff-line add">+  loop: &quot;{{ ansible_facts[&#x27;services&#x27;] | dict2items }}&quot;</span><span class="diff-line context">   loop_control:</span><span class="diff-line context">     loop_var: rclone_service</span><span class="diff-line context">   when: (rclone_service_template in rclone_service.key)</span><span class="diff-line hunk">@@ -227,9 +234,9 @@</span><span class="diff-line context">     - name: Remote Tasks</span><span class="diff-line context">       ansible.builtin.include_tasks: &quot;remote.yml&quot;</span><span class="diff-line context">       with_items: &quot;{{ rclone.remotes }}&quot;</span><span class="diff-line del">-      when: rclone_remote_is_defined and item.settings.template != &quot;nfs&quot; and item.settings.mount</span><span class="diff-line add">+      when: rclone_remote_is_defined and (item.settings.template != &quot;nfs&quot;) and (item.settings.mount | bool)</span><span class="diff-line context"> </span><span class="diff-line context">     - name: Remote Tasks (NFS)</span><span class="diff-line context">       ansible.builtin.include_tasks: &quot;nfs.yml&quot;</span><span class="diff-line context">       with_items: &quot;{{ rclone.remotes }}&quot;</span><span class="diff-line del">-      when: rclone_remote_is_defined and item.settings.template == &quot;nfs&quot; and item.settings.mount</span><span class="diff-line add">+      when: rclone_remote_is_defined and (item.settings.template == &quot;nfs&quot;) and (item.settings.mount | bool)</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-311">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/remote/tasks/nfs.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -10,7 +10,7 @@</span><span class="diff-line context"> - name: &quot;Remote (NFS) | Install NFS requirements&quot;</span><span class="diff-line context">   ansible.builtin.apt:</span><span class="diff-line context">     name: nfs-common</span><span class="diff-line del">-    state: present</span><span class="diff-line add">+    state: latest</span><span class="diff-line context"> </span><span class="diff-line context"> - name: &quot;Remote (NFS) | Set Variables&quot;</span><span class="diff-line context">   ansible.builtin.set_fact:</span><span class="diff-line hunk">@@ -43,7 +43,7 @@</span><span class="diff-line context">       ignore_errors: true</span><span class="diff-line context"> </span><span class="diff-line context">     - name: &quot;Remote (NFS) | Backup non-empty &#x27;{{ mount_path }}&#x27; path&quot;</span><span class="diff-line del">-      ansible.builtin.shell: &quot;mv {{ mount_path }} {{ mount_path }}_{{ &#x27;%Y-%m-%d_%H.%M.%S&#x27; | strftime(ansible_date_time[&#x27;epoch&#x27;] | int) }}&quot;</span><span class="diff-line add">+      ansible.builtin.shell: &quot;mv {{ mount_path }} {{ mount_path }}_{{ &#x27;%Y-%m-%d_%H.%M.%S&#x27; | strftime(ansible_facts[&#x27;date_time&#x27;][&#x27;epoch&#x27;] | int) }}&quot;</span><span class="diff-line context">       ignore_errors: true</span><span class="diff-line context">       when: (mount_path_stat_files.matched | int &gt; 0)</span><span class="diff-line context"> </span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-312">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/remote/tasks/remote.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -46,7 +46,7 @@</span><span class="diff-line context">       ignore_errors: true</span><span class="diff-line context"> </span><span class="diff-line context">     - name: &quot;Remote | Backup non-empty &#x27;{{ mount_path }}&#x27; path&quot;</span><span class="diff-line del">-      ansible.builtin.shell: &quot;mv {{ mount_path }} {{ mount_path }}_{{ &#x27;%Y-%m-%d_%H.%M.%S&#x27; | strftime(ansible_date_time[&#x27;epoch&#x27;] | int) }}&quot;</span><span class="diff-line add">+      ansible.builtin.shell: &quot;mv {{ mount_path }} {{ mount_path }}_{{ &#x27;%Y-%m-%d_%H.%M.%S&#x27; | strftime(ansible_facts[&#x27;date_time&#x27;][&#x27;epoch&#x27;] | int) }}&quot;</span><span class="diff-line context">       ignore_errors: true</span><span class="diff-line context">       when: (mount_path_stat_files.matched | int &gt; 0)</span><span class="diff-line context"> </span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-313">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/remote/templates/dropbox.j2</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -19,10 +19,10 @@</span><span class="diff-line context"> ExecStartPre=/bin/sleep 10</span><span class="diff-line context"> ExecStart=/usr/bin/rclone mount \</span><span class="diff-line context">     --allow-other \</span><span class="diff-line del">-{% if mounts.ipv4_only %}</span><span class="diff-line del">-    --bind={{ ansible_default_ipv4.address }} \</span><span class="diff-line add">+{% if rclone_mounts_ipv4_only %}</span><span class="diff-line add">+    --bind={{ ansible_facts[&#x27;default_ipv4&#x27;][&#x27;address&#x27;] }} \</span><span class="diff-line context"> {% endif %}</span><span class="diff-line del">-{% if (rclone_vfs_cache_dir_lookup | length &gt; 0) and item.settings.vfs_cache.enabled %}</span><span class="diff-line add">+{% if (rclone_vfs_cache_dir_lookup | length &gt; 0) and (item.settings.vfs_cache.enabled | bool) %}</span><span class="diff-line context">     --cache-dir={{ rclone_vfs_cache_dir_lookup }} \</span><span class="diff-line context"> {% endif %}</span><span class="diff-line context">     --config={{ rclone_config_path }} \</span><span class="diff-line hunk">@@ -33,7 +33,7 @@</span><span class="diff-line context">     --poll-interval=30s \</span><span class="diff-line context">     --rc \</span><span class="diff-line context">     --rc-addr=localhost:{{ rclone_remort_port }} \</span><span class="diff-line del">-{% if rclone_enable_metrics %}</span><span class="diff-line add">+{% if (rclone_enable_metrics | bool) %}</span><span class="diff-line context">     --metrics-addr=172.19.0.1:{{ rclone_remort_port }} \</span><span class="diff-line context"> {% endif %}</span><span class="diff-line context">     --rc-no-auth \</span><span class="diff-line hunk">@@ -42,7 +42,7 @@</span><span class="diff-line context">     --umask=002 \</span><span class="diff-line context">     --use-mmap \</span><span class="diff-line context">     --user-agent=&#x27;{{ user_agent }}&#x27; \</span><span class="diff-line del">-{% if item.settings.vfs_cache.enabled %}</span><span class="diff-line add">+{% if (item.settings.vfs_cache.enabled | bool) %}</span><span class="diff-line context">     --vfs-cache-min-free-space={{ rclone_vfs_cache_min_free_space }} \</span><span class="diff-line context">     --vfs-cache-max-age={{ item.settings.vfs_cache.max_age | default(&#x27;504h&#x27;) }} \</span><span class="diff-line context">     --vfs-cache-max-size={{ item.settings.vfs_cache.size | default(&#x27;50G&#x27;) }} \</span><span class="diff-line hunk">@@ -52,7 +52,7 @@</span><span class="diff-line context">     --vfs-read-ahead=128M \</span><span class="diff-line context"> {% endif %}</span><span class="diff-line context">     --vfs-read-chunk-size-limit=2G \</span><span class="diff-line del">-    --vfs-read-chunk-size={{ &#x27;32M&#x27; if item.settings.vfs_cache.enabled else &#x27;64M&#x27; }} \</span><span class="diff-line add">+    --vfs-read-chunk-size={{ &#x27;32M&#x27; if (item.settings.vfs_cache.enabled | bool) else &#x27;64M&#x27; }} \</span><span class="diff-line context">     -v \</span><span class="diff-line context">     &quot;{{ rclone_remote_with_path }}&quot; &quot;/mnt/remote/{{ rclone_remote_name }}&quot;</span><span class="diff-line context"> ExecStop=/bin/fusermount3 -uz &quot;/mnt/remote/{{ rclone_remote_name }}&quot;</span><span class="diff-line hunk">@@ -60,7 +60,7 @@</span><span class="diff-line context"> RestartSec=5</span><span class="diff-line context"> StartLimitInterval=60s</span><span class="diff-line context"> StartLimitBurst=3</span><span class="diff-line del">-{% if item.settings.vfs_cache.enabled %}</span><span class="diff-line add">+{% if (item.settings.vfs_cache.enabled | bool) %}</span><span class="diff-line context"> TimeoutSec=21600</span><span class="diff-line context"> LimitNOFILE=infinity</span><span class="diff-line context"> LimitMEMLOCK=infinity</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-314">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/remote/templates/google.j2</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -19,16 +19,16 @@</span><span class="diff-line context"> ExecStartPre=/bin/sleep 10</span><span class="diff-line context"> ExecStart=/usr/bin/rclone mount \</span><span class="diff-line context">     --allow-other \</span><span class="diff-line del">-{% if mounts.ipv4_only %}</span><span class="diff-line del">-    --bind={{ ansible_default_ipv4.address }} \</span><span class="diff-line add">+{% if rclone_mounts_ipv4_only %}</span><span class="diff-line add">+    --bind={{ ansible_facts[&#x27;default_ipv4&#x27;][&#x27;address&#x27;] }} \</span><span class="diff-line context"> {% endif %}</span><span class="diff-line del">-{% if (rclone_vfs_cache_dir_lookup | length &gt; 0) and item.settings.vfs_cache.enabled %}</span><span class="diff-line add">+{% if (rclone_vfs_cache_dir_lookup | length &gt; 0) and (item.settings.vfs_cache.enabled | bool) %}</span><span class="diff-line context">     --cache-dir={{ rclone_vfs_cache_dir_lookup }} \</span><span class="diff-line context"> {% endif %}</span><span class="diff-line context">     --config={{ rclone_config_path }} \</span><span class="diff-line del">-    --buffer-size={{ &#x27;32M&#x27; if item.settings.vfs_cache.enabled else &#x27;64M&#x27; }} \</span><span class="diff-line add">+    --buffer-size={{ &#x27;32M&#x27; if (item.settings.vfs_cache.enabled | bool) else &#x27;64M&#x27; }} \</span><span class="diff-line context">     --dir-cache-time={{ rclone_cloud_dir_cache_time }} \</span><span class="diff-line del">-{% if not item.settings.vfs_cache.enabled %}</span><span class="diff-line add">+{% if not (item.settings.vfs_cache.enabled | bool) %}</span><span class="diff-line context">     --drive-chunk-size=64M \</span><span class="diff-line context"> {% endif %}</span><span class="diff-line context">     --drive-pacer-burst=1000 \</span><span class="diff-line hunk">@@ -37,7 +37,7 @@</span><span class="diff-line context">     --poll-interval=15s \</span><span class="diff-line context">     --rc \</span><span class="diff-line context">     --rc-addr=localhost:{{ rclone_remort_port }} \</span><span class="diff-line del">-{% if rclone_enable_metrics %}</span><span class="diff-line add">+{% if (rclone_enable_metrics | bool) %}</span><span class="diff-line context">     --metrics-addr=172.19.0.1:{{ rclone_remort_port }} \</span><span class="diff-line context"> {% endif %}</span><span class="diff-line context">     --rc-no-auth \</span><span class="diff-line hunk">@@ -46,7 +46,7 @@</span><span class="diff-line context">     --umask=002 \</span><span class="diff-line context">     --use-mmap \</span><span class="diff-line context">     --user-agent=&#x27;{{ user_agent }}&#x27; \</span><span class="diff-line del">-{% if item.settings.vfs_cache.enabled %}</span><span class="diff-line add">+{% if (item.settings.vfs_cache.enabled | bool) %}</span><span class="diff-line context">     --vfs-cache-min-free-space={{ rclone_vfs_cache_min_free_space }} \</span><span class="diff-line context">     --vfs-cache-max-age={{ item.settings.vfs_cache.max_age | default(&#x27;504h&#x27;) }} \</span><span class="diff-line context">     --vfs-cache-max-size={{ item.settings.vfs_cache.size | default(&#x27;50G&#x27;) }} \</span><span class="diff-line hunk">@@ -56,7 +56,7 @@</span><span class="diff-line context">     --vfs-read-ahead=128M \</span><span class="diff-line context"> {% endif %}</span><span class="diff-line context">     --vfs-read-chunk-size-limit=2G \</span><span class="diff-line del">-    --vfs-read-chunk-size={{ &#x27;32M&#x27; if item.settings.vfs_cache.enabled else &#x27;64M&#x27; }} \</span><span class="diff-line add">+    --vfs-read-chunk-size={{ &#x27;32M&#x27; if (item.settings.vfs_cache.enabled | bool) else &#x27;64M&#x27; }} \</span><span class="diff-line context">     -v \</span><span class="diff-line context">     &quot;{{ rclone_remote_with_path }}&quot; &quot;/mnt/remote/{{ rclone_remote_name }}&quot;</span><span class="diff-line context"> ExecStop=/bin/fusermount3 -uz &quot;/mnt/remote/{{ rclone_remote_name }}&quot;</span><span class="diff-line hunk">@@ -64,7 +64,7 @@</span><span class="diff-line context"> RestartSec=5</span><span class="diff-line context"> StartLimitInterval=60s</span><span class="diff-line context"> StartLimitBurst=3</span><span class="diff-line del">-{% if item.settings.vfs_cache.enabled %}</span><span class="diff-line add">+{% if (item.settings.vfs_cache.enabled | bool) %}</span><span class="diff-line context"> TimeoutSec=21600</span><span class="diff-line context"> LimitNOFILE=infinity</span><span class="diff-line context"> LimitMEMLOCK=infinity</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-315">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/remote/templates/sftp.j2</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -19,7 +19,7 @@</span><span class="diff-line context"> ExecStartPre=/bin/sleep 10</span><span class="diff-line context"> ExecStart=/usr/bin/rclone mount \</span><span class="diff-line context">     --allow-other \</span><span class="diff-line del">-{% if (rclone_vfs_cache_dir_lookup | length &gt; 0) and item.settings.vfs_cache.enabled %}</span><span class="diff-line add">+{% if (rclone_vfs_cache_dir_lookup | length &gt; 0) and (item.settings.vfs_cache.enabled | bool) %}</span><span class="diff-line context">     --cache-dir={{ rclone_vfs_cache_dir_lookup }} \</span><span class="diff-line context"> {% endif %}</span><span class="diff-line context">     --config={{ rclone_config_path }} \</span><span class="diff-line hunk">@@ -28,19 +28,19 @@</span><span class="diff-line context">     --max-read-ahead=200M \</span><span class="diff-line context">     --rc \</span><span class="diff-line context">     --rc-addr=localhost:{{ rclone_remort_port }} \</span><span class="diff-line del">-{% if rclone_enable_metrics %}</span><span class="diff-line add">+{% if (rclone_enable_metrics | bool) %}</span><span class="diff-line context">     --metrics-addr=172.19.0.1:{{ rclone_remort_port }} \</span><span class="diff-line context"> {% endif %}</span><span class="diff-line context">     --rc-no-auth \</span><span class="diff-line context">     --sftp-chunk-size={{ rclone_sftp_chunk_size }} \</span><span class="diff-line context">     --sftp-concurrency={{ rclone_sftp_concurrency }} \</span><span class="diff-line del">-{% if rclone_sftp_disable_hashcheck %}</span><span class="diff-line add">+{% if (rclone_sftp_disable_hashcheck | bool) %}</span><span class="diff-line context">     --sftp-disable-hashcheck \</span><span class="diff-line context"> {% endif %}</span><span class="diff-line context">     --syslog \</span><span class="diff-line context">     --umask=002 \</span><span class="diff-line context">     --user-agent=&#x27;{{ user_agent }}&#x27; \</span><span class="diff-line del">-{% if item.settings.vfs_cache.enabled %}</span><span class="diff-line add">+{% if (item.settings.vfs_cache.enabled | bool) %}</span><span class="diff-line context">     --vfs-cache-min-free-space={{ rclone_vfs_cache_min_free_space }} \</span><span class="diff-line context">     --vfs-cache-max-age={{ item.settings.vfs_cache.max_age | default(&#x27;504h&#x27;) }} \</span><span class="diff-line context">     --vfs-cache-max-size={{ item.settings.vfs_cache.size | default(&#x27;50G&#x27;) }} \</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-316">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/restore/tasks/main.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -12,14 +12,14 @@</span><span class="diff-line context">     msg:</span><span class="diff-line context">       - &quot;Rclone backup is not enabled.&quot;</span><span class="diff-line context">       - &quot;You must enable rclone, in the backup settings, to perform a with a specific tar file restore.&quot;</span><span class="diff-line del">-  when: (not backup.rclone.enable) and (restore_tar is defined)</span><span class="diff-line add">+  when: (not backup_rclone_enabled) and (restore_tar is defined)</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Fail when local backup method is enabled and using restore_tar</span><span class="diff-line context">   ansible.builtin.fail:</span><span class="diff-line context">     msg:</span><span class="diff-line context">       - &quot;The restore_tar setting does not work with a local backup enabled.&quot;</span><span class="diff-line context">       - &quot;Remember to empty the local backup folder if you disable the setting.&quot;</span><span class="diff-line del">-  when: backup.local.enable and (restore_tar is defined)</span><span class="diff-line add">+  when: backup_rclone_enabled and (restore_tar is defined)</span><span class="diff-line context"> </span><span class="diff-line context"> - name: &quot;Check if user &#x27;{{ user.name }}&#x27; exists&quot;</span><span class="diff-line context">   ansible.builtin.shell: &quot;id -un {{ user.name }} &gt;/dev/null 2&gt;&amp;1;&quot;</span><span class="diff-line hunk">@@ -37,7 +37,7 @@</span><span class="diff-line context">   when: (user_check.rc == 1) and (not restore_tar is defined)</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Variables</span><span class="diff-line del">-  ansible.builtin.import_tasks: &quot;variables.yml&quot;</span><span class="diff-line add">+  ansible.builtin.include_tasks: &quot;variables.yml&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: &quot;Check if &#x27;localhost.yml&#x27; exists in &#x27;{{ playbook_dir }}&#x27;&quot;</span><span class="diff-line context">   ansible.builtin.stat:</span><span class="diff-line hunk">@@ -85,8 +85,8 @@</span><span class="diff-line context"> - name: BTRFS Tasks</span><span class="diff-line context">   ansible.builtin.include_tasks: &quot;btrfs.yml&quot;</span><span class="diff-line context">   loop:</span><span class="diff-line del">-    - /opt</span><span class="diff-line del">-    - /mnt/local</span><span class="diff-line add">+    - &quot;{{ server_appdata_path }}&quot;</span><span class="diff-line add">+    - &quot;{{ server_local_folder_path }}&quot;</span><span class="diff-line context">   loop_control:</span><span class="diff-line context">     loop_var: outer_item</span><span class="diff-line context"> </span><span class="diff-line hunk">@@ -98,8 +98,8 @@</span><span class="diff-line context">     group: &quot;{{ user.name }}&quot;</span><span class="diff-line context">     mode: &quot;0775&quot;</span><span class="diff-line context">   with_items:</span><span class="diff-line del">-    - /opt</span><span class="diff-line del">-    - /mnt/local</span><span class="diff-line add">+    - &quot;{{ server_appdata_path }}&quot;</span><span class="diff-line add">+    - &quot;{{ server_local_folder_path }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: &quot;Create backup location &#x27;{{ backup.local.destination }}&#x27;&quot;</span><span class="diff-line context">   ansible.builtin.file:</span><span class="diff-line hunk">@@ -129,11 +129,11 @@</span><span class="diff-line context"> </span><span class="diff-line context"> # Restore from remote backup when local backup does not exist</span><span class="diff-line context"> - name: Restore Remote</span><span class="diff-line del">-  ansible.builtin.import_tasks: &quot;restore_remote.yml&quot;</span><span class="diff-line add">+  ansible.builtin.include_tasks: &quot;restore_remote.yml&quot;</span><span class="diff-line context">   when: (dir_files.matched | int == 0) and (not restore_tar is defined)</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Restore specific tar</span><span class="diff-line del">-  ansible.builtin.import_tasks: &quot;restore_tar.yml&quot;</span><span class="diff-line add">+  ansible.builtin.include_tasks: &quot;restore_tar.yml&quot;</span><span class="diff-line context">   when: (dir_files.matched | int == 0) and (restore_tar is defined)</span><span class="diff-line context"> </span><span class="diff-line context"> - name: &quot;Look for &#x27;backup_excludes_list.txt&#x27; file in &#x27;{{ backup.local.destination }}&#x27;&quot;</span><span class="diff-line hunk">@@ -143,7 +143,7 @@</span><span class="diff-line context"> </span><span class="diff-line context"> - name: &quot;Delete &#x27;z&#x27; opt folder when doing full restore&quot;</span><span class="diff-line context">   ansible.builtin.file:</span><span class="diff-line del">-    path: &quot;/opt/z&quot;</span><span class="diff-line add">+    path: &quot;{{ server_appdata_path }}/z&quot;</span><span class="diff-line context">     state: absent</span><span class="diff-line context">   when: (not restore_tar is defined)</span><span class="diff-line context"> </span><span class="diff-line hunk">@@ -157,23 +157,67 @@</span><span class="diff-line context">     force: true</span><span class="diff-line context">   when: backup_excludes_list.stat.exists and (not restore_tar is defined)</span><span class="diff-line context"> </span><span class="diff-line del">-- name: &quot;Backup existing folders in &#x27;/opt&#x27; to prevent overwriting them&quot;</span><span class="diff-line del">-  ansible.builtin.shell: mv &#x27;/opt/{{ (item | basename | splitext)[0] }}&#x27; &#x27;/opt/{{ (item | basename | splitext)[0] }}_bak&#x27; 2&gt;/dev/null || true</span><span class="diff-line add">+- name: &quot;Check for existing backup folders (full restore)&quot;</span><span class="diff-line add">+  ansible.builtin.stat:</span><span class="diff-line add">+    path: &quot;{{ server_appdata_path }}/{{ (item | basename | splitext)[0] }}_bak&quot;</span><span class="diff-line context">   with_fileglob:</span><span class="diff-line context">     - &quot;{{ backup.local.destination }}/opt/*.tar&quot;</span><span class="diff-line del">-  loop_control:</span><span class="diff-line del">-    label: &quot;&#x27;/opt/{{ (item | basename | splitext)[0] }}&#x27; --&gt; &#x27;/opt/{{ (item | basename | splitext)[0] }}_bak&#x27;&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-- name: &quot;Unarchive backup tarballs into &#x27;/opt&#x27;&quot;</span><span class="diff-line del">-  ansible.builtin.shell: tar -xf &#x27;{{ item }}&#x27; -C &#x27;/opt/&#x27;</span><span class="diff-line add">+  register: existing_bak_folders_full</span><span class="diff-line add">+  when: (not restore_tar is defined)</span><span class="diff-line add">+</span><span class="diff-line add">+- name: &quot;Fail if backup folders already exist (full restore)&quot;</span><span class="diff-line add">+  ansible.builtin.fail:</span><span class="diff-line add">+    msg:</span><span class="diff-line add">+      - &quot;Backup folder &#x27;{{ server_appdata_path }}/{{ (item.item | basename | splitext)[0] }}_bak&#x27; already exists.&quot;</span><span class="diff-line add">+      - &quot;Please remove or rename existing backup folders before running restore.&quot;</span><span class="diff-line add">+      - &quot;This prevents accidental loss of existing backup data.&quot;</span><span class="diff-line add">+  with_items: &quot;{{ existing_bak_folders_full.results }}&quot;</span><span class="diff-line add">+  when: (not restore_tar is defined) and item.stat.exists</span><span class="diff-line add">+  loop_control:</span><span class="diff-line add">+    label: &quot;&#x27;{{ server_appdata_path }}/{{ (item.item | basename | splitext)[0] }}_bak&#x27;&quot;</span><span class="diff-line add">+</span><span class="diff-line add">+- name: &quot;Backup existing folders in &#x27;{{ server_appdata_path }}&#x27; to prevent overwriting them (full restore)&quot;</span><span class="diff-line add">+  ansible.builtin.shell: mv &#x27;{{ server_appdata_path }}/{{ (item | basename | splitext)[0] }}&#x27; &#x27;{{ server_appdata_path }}/{{ (item | basename | splitext)[0] }}_bak&#x27; 2&gt;/dev/null || true</span><span class="diff-line context">   with_fileglob:</span><span class="diff-line context">     - &quot;{{ backup.local.destination }}/opt/*.tar&quot;</span><span class="diff-line context">   loop_control:</span><span class="diff-line del">-    label: &quot;&#x27;{{ item | basename }}&#x27; --&gt; &#x27;/opt/{{ (item | basename | splitext)[0] }}&#x27;&quot;</span><span class="diff-line add">+    label: &quot;&#x27;{{ server_appdata_path }}/{{ (item | basename | splitext)[0] }}&#x27; --&gt; &#x27;{{ server_appdata_path }}/{{ (item | basename | splitext)[0] }}_bak&#x27;&quot;</span><span class="diff-line add">+  when: (not restore_tar is defined)</span><span class="diff-line add">+</span><span class="diff-line add">+- name: &quot;Check for existing backup folder (specific tar restore)&quot;</span><span class="diff-line add">+  ansible.builtin.stat:</span><span class="diff-line add">+    path: &quot;{{ server_appdata_path }}/{{ (restore_tar | basename | splitext)[0] }}_bak&quot;</span><span class="diff-line add">+  register: existing_bak_folder_specific</span><span class="diff-line add">+  when: (restore_tar is defined)</span><span class="diff-line add">+</span><span class="diff-line add">+- name: &quot;Fail if backup folder already exists (specific tar restore)&quot;</span><span class="diff-line add">+  ansible.builtin.fail:</span><span class="diff-line add">+    msg:</span><span class="diff-line add">+      - &quot;Backup folder &#x27;{{ server_appdata_path }}/{{ (restore_tar | basename | splitext)[0] }}_bak&#x27; already exists.&quot;</span><span class="diff-line add">+      - &quot;Please remove or rename the existing backup folder before running restore.&quot;</span><span class="diff-line add">+      - &quot;This prevents accidental loss of existing backup data.&quot;</span><span class="diff-line add">+  when: (restore_tar is defined) and existing_bak_folder_specific.stat.exists</span><span class="diff-line add">+</span><span class="diff-line add">+- name: &quot;Backup existing folder in &#x27;{{ server_appdata_path }}&#x27; to prevent overwriting it (specific tar restore)&quot;</span><span class="diff-line add">+  ansible.builtin.shell: mv &#x27;{{ server_appdata_path }}/{{ (restore_tar | basename | splitext)[0] }}&#x27; &#x27;{{ server_appdata_path }}/{{ (restore_tar | basename | splitext)[0] }}_bak&#x27; 2&gt;/dev/null || true</span><span class="diff-line add">+  when: (restore_tar is defined)</span><span class="diff-line add">+</span><span class="diff-line add">+- name: &quot;Unarchive backup tarballs into &#x27;{{ server_appdata_path }}&#x27; (full restore)&quot;</span><span class="diff-line add">+  ansible.builtin.shell: tar -xf &#x27;{{ item }}&#x27; -C &#x27;{{ server_appdata_path }}/&#x27;</span><span class="diff-line add">+  with_fileglob:</span><span class="diff-line add">+    - &quot;{{ backup.local.destination }}/opt/*.tar&quot;</span><span class="diff-line add">+  loop_control:</span><span class="diff-line add">+    label: &quot;&#x27;{{ item | basename }}&#x27; --&gt; &#x27;{{ server_appdata_path }}/{{ (item | basename | splitext)[0] }}&#x27;&quot;</span><span class="diff-line context">   register: unarchive</span><span class="diff-line del">-</span><span class="diff-line del">-- name: &quot;Set &#x27;/opt&#x27; ownership and permissions&quot;</span><span class="diff-line del">-  ansible.builtin.import_tasks: &quot;permissions.yml&quot;</span><span class="diff-line add">+  when: (not restore_tar is defined)</span><span class="diff-line add">+</span><span class="diff-line add">+- name: &quot;Unarchive specific backup tarball into &#x27;{{ server_appdata_path }}&#x27; (specific tar restore)&quot;</span><span class="diff-line add">+  ansible.builtin.shell: tar -xf &#x27;{{ backup.local.destination }}/opt/{{ restore_tar }}&#x27; -C &#x27;{{ server_appdata_path }}/&#x27;</span><span class="diff-line add">+  register: unarchive</span><span class="diff-line add">+  when: (restore_tar is defined)</span><span class="diff-line add">+</span><span class="diff-line add">+- name: &quot;Set &#x27;{{ server_appdata_path }}&#x27; ownership and permissions&quot;</span><span class="diff-line add">+  ansible.builtin.include_tasks: &quot;permissions.yml&quot;</span><span class="diff-line context">   tags: opt-permissions-reset</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Cleanup backup location</span><span class="diff-line hunk">@@ -182,13 +226,9 @@</span><span class="diff-line context">     state: absent</span><span class="diff-line context">   become: true</span><span class="diff-line context">   become_user: &quot;{{ user.name }}&quot;</span><span class="diff-line del">-  when: (not backup.local.enable)</span><span class="diff-line add">+  when: (not backup_local_enabled)</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Finished restoring the backup</span><span class="diff-line context">   ansible.builtin.debug:</span><span class="diff-line context">     msg: Finished restoring the backup. You are now ready to install Saltbox!</span><span class="diff-line context">   when: (unarchive is succeeded)</span><span class="diff-line del">-</span><span class="diff-line del">-- name: Settings Role</span><span class="diff-line del">-  ansible.builtin.include_role:</span><span class="diff-line del">-    name: settings</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-317">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/restore/tasks/permissions.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -7,8 +7,8 @@</span><span class="diff-line context"> #                   GNU General Public License v3.0                     #</span><span class="diff-line context"> #########################################################################</span><span class="diff-line context"> ---</span><span class="diff-line del">-- name: Set &#x27;/opt&#x27; ownership recursively</span><span class="diff-line del">-  ansible.builtin.shell: &quot;chown -R {{ user.name }}:{{ user.name }} /opt&quot;</span><span class="diff-line add">+- name: Set &#x27;{{ server_appdata_path }}&#x27; ownership recursively</span><span class="diff-line add">+  ansible.builtin.shell: &quot;chown -R {{ user.name }}:{{ user.name }} {{ server_appdata_path }}&quot;</span><span class="diff-line context"> </span><span class="diff-line del">-- name: Set &#x27;/opt&#x27; permissions recursively</span><span class="diff-line del">-  ansible.builtin.shell: &quot;chmod -R ugo+X /opt&quot;</span><span class="diff-line add">+- name: Set &#x27;{{ server_appdata_path }}&#x27; permissions recursively</span><span class="diff-line add">+  ansible.builtin.shell: &quot;chmod -R ugo+X {{ server_appdata_path }}&quot;</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-318">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/restore/tasks/restore_remote.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -7,16 +7,12 @@</span><span class="diff-line context"> #                   GNU General Public License v3.0                     #</span><span class="diff-line context"> #########################################################################</span><span class="diff-line context"> ---</span><span class="diff-line del">-# Checks</span><span class="diff-line del">-</span><span class="diff-line context"> - name: Fail when no backup method is enabled or when no local backup exists</span><span class="diff-line context">   ansible.builtin.fail:</span><span class="diff-line context">     msg:</span><span class="diff-line context">       - &quot;Rclone is not enabled and no local backup exists.&quot;</span><span class="diff-line context">       - &quot;You must either enable rclone, in the backup settings, or provide backup tarball files locally, to perform a restore.&quot;</span><span class="diff-line del">-  when: (not backup.rclone.enable)</span><span class="diff-line del">-</span><span class="diff-line del">-# Folder</span><span class="diff-line add">+  when: (not backup_rclone_enabled)</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Cleanup backup location</span><span class="diff-line context">   ansible.builtin.file:</span><span class="diff-line hunk">@@ -24,8 +20,6 @@</span><span class="diff-line context">     state: absent</span><span class="diff-line context">   become: true</span><span class="diff-line context">   become_user: &quot;{{ user.name }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Rclone</span><span class="diff-line context"> </span><span class="diff-line context"> - name: &quot;Check if &#x27;rclone.conf&#x27; exists in &#x27;{{ playbook_dir }}&#x27; folder&quot;</span><span class="diff-line context">   ansible.builtin.stat:</span><span class="diff-line hunk">@@ -88,8 +82,6 @@</span><span class="diff-line context">   become: true</span><span class="diff-line context">   become_user: &quot;{{ user.name }}&quot;</span><span class="diff-line context"> </span><span class="diff-line del">-# Checks</span><span class="diff-line del">-</span><span class="diff-line context"> - name: &quot;Check if tar files were retrieved&quot;</span><span class="diff-line context">   ansible.builtin.find:</span><span class="diff-line context">     paths: &quot;{{ backup.local.destination }}/opt&quot;</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-319">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/restore/tasks/restore_tar.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -7,16 +7,12 @@</span><span class="diff-line context"> #                   GNU General Public License v3.0                     #</span><span class="diff-line context"> #########################################################################</span><span class="diff-line context"> ---</span><span class="diff-line del">-# Folder</span><span class="diff-line del">-</span><span class="diff-line context"> - name: Cleanup backup location</span><span class="diff-line context">   ansible.builtin.file:</span><span class="diff-line context">     path: &quot;{{ backup.local.destination }}&quot;</span><span class="diff-line context">     state: absent</span><span class="diff-line context">   become: true</span><span class="diff-line context">   become_user: &quot;{{ user.name }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Rclone</span><span class="diff-line context"> </span><span class="diff-line context"> - name: &quot;Check if &#x27;rclone.conf&#x27; exists in &#x27;{{ playbook_dir }}&#x27; folder&quot;</span><span class="diff-line context">   ansible.builtin.stat:</span><span class="diff-line hunk">@@ -79,8 +75,6 @@</span><span class="diff-line context">   become: true</span><span class="diff-line context">   become_user: &quot;{{ user.name }}&quot;</span><span class="diff-line context"> </span><span class="diff-line del">-# Checks</span><span class="diff-line del">-</span><span class="diff-line context"> - name: &quot;Check if tar files were retrieved&quot;</span><span class="diff-line context">   ansible.builtin.find:</span><span class="diff-line context">     paths: &quot;{{ backup.local.destination }}/opt&quot;</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-320">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/rutorrent/defaults/main.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -17,70 +17,70 @@</span><span class="diff-line context"> # Paths</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-rutorrent_paths_folder: &quot;{{ rutorrent_name }}&quot;</span><span class="diff-line del">-rutorrent_paths_location: &quot;{{ server_appdata_path }}/{{ rutorrent_paths_folder }}&quot;</span><span class="diff-line del">-rutorrent_paths_downloads_location: &quot;{{ downloads_torrents_path }}/{{ rutorrent_paths_folder }}&quot;</span><span class="diff-line del">-rutorrent_paths_folders_list:</span><span class="diff-line del">-  - &quot;{{ rutorrent_paths_location }}&quot;</span><span class="diff-line del">-  - &quot;{{ rutorrent_paths_location }}/plugins&quot;</span><span class="diff-line del">-  - &quot;{{ rutorrent_paths_location }}/themes&quot;</span><span class="diff-line del">-  - &quot;{{ rutorrent_paths_downloads_location }}&quot;</span><span class="diff-line del">-  - &quot;{{ rutorrent_paths_downloads_location }}/completed&quot;</span><span class="diff-line del">-  - &quot;{{ rutorrent_paths_downloads_location }}/incoming&quot;</span><span class="diff-line del">-  - &quot;{{ rutorrent_paths_downloads_location }}/watched&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Config files</span><span class="diff-line del">-rutorrent_paths_config_php_location: &quot;{{ rutorrent_paths_location }}/rutorrent/settings/config.php&quot;</span><span class="diff-line del">-rutorrent_paths_rtorrent_rc_location: &quot;{{ rutorrent_paths_location }}/rtorrent/rtorrent.rc&quot;</span><span class="diff-line del">-rutorrent_paths_php_local_ini_location: &quot;{{ rutorrent_paths_location }}/php/php-local.ini&quot;</span><span class="diff-line del">-rutorrent_paths_plugins_ini_location: &quot;{{ rutorrent_paths_location }}/rutorrent/settings/plugins.ini&quot;</span><span class="diff-line add">+rutorrent_role_paths_folder: &quot;{{ rutorrent_name }}&quot;</span><span class="diff-line add">+rutorrent_role_paths_location: &quot;{{ server_appdata_path }}/{{ rutorrent_role_paths_folder }}&quot;</span><span class="diff-line add">+rutorrent_role_paths_downloads_location: &quot;{{ downloads_torrents_path }}/{{ rutorrent_role_paths_folder }}&quot;</span><span class="diff-line add">+rutorrent_role_paths_config_php_location: &quot;{{ rutorrent_role_paths_location }}/rutorrent/settings/config.php&quot;</span><span class="diff-line add">+rutorrent_role_paths_rtorrent_rc_location: &quot;{{ rutorrent_role_paths_location }}/rtorrent/rtorrent.rc&quot;</span><span class="diff-line add">+rutorrent_role_paths_php_local_ini_location: &quot;{{ rutorrent_role_paths_location }}/php/php-local.ini&quot;</span><span class="diff-line add">+rutorrent_role_paths_plugins_ini_location: &quot;{{ rutorrent_role_paths_location }}/rutorrent/settings/plugins.ini&quot;</span><span class="diff-line add">+rutorrent_role_paths_folders_list:</span><span class="diff-line add">+  - &quot;{{ rutorrent_role_paths_location }}&quot;</span><span class="diff-line add">+  - &quot;{{ rutorrent_role_paths_location }}/plugins&quot;</span><span class="diff-line add">+  - &quot;{{ rutorrent_role_paths_location }}/themes&quot;</span><span class="diff-line add">+  - &quot;{{ rutorrent_role_paths_downloads_location }}&quot;</span><span class="diff-line add">+  - &quot;{{ rutorrent_role_paths_downloads_location }}/completed&quot;</span><span class="diff-line add">+  - &quot;{{ rutorrent_role_paths_downloads_location }}/incoming&quot;</span><span class="diff-line add">+  - &quot;{{ rutorrent_role_paths_downloads_location }}/watched&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # Web</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-rutorrent_web_subdomain: &quot;{{ rutorrent_name }}&quot;</span><span class="diff-line del">-rutorrent_web_domain: &quot;{{ user.domain }}&quot;</span><span class="diff-line del">-rutorrent_web_port: &quot;80&quot;</span><span class="diff-line del">-rutorrent_web_url: &quot;{{ &#x27;https://&#x27; + (rutorrent_web_subdomain + &#x27;.&#x27; + rutorrent_web_domain</span><span class="diff-line del">-                    if (rutorrent_web_subdomain | length &gt; 0)</span><span class="diff-line del">-                    else rutorrent_web_domain) }}&quot;</span><span class="diff-line add">+rutorrent_role_web_subdomain: &quot;{{ rutorrent_name }}&quot;</span><span class="diff-line add">+rutorrent_role_web_domain: &quot;{{ user.domain }}&quot;</span><span class="diff-line add">+rutorrent_role_web_port: &quot;80&quot;</span><span class="diff-line add">+rutorrent_role_web_url: &quot;{{ &#x27;https://&#x27; + (lookup(&#x27;role_var&#x27;, &#x27;_web_subdomain&#x27;, role=&#x27;rutorrent&#x27;) + &#x27;.&#x27; + lookup(&#x27;role_var&#x27;, &#x27;_web_domain&#x27;, role=&#x27;rutorrent&#x27;)</span><span class="diff-line add">+                         if (lookup(&#x27;role_var&#x27;, &#x27;_web_subdomain&#x27;, role=&#x27;rutorrent&#x27;) | length &gt; 0)</span><span class="diff-line add">+                         else lookup(&#x27;role_var&#x27;, &#x27;_web_domain&#x27;, role=&#x27;rutorrent&#x27;)) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # DNS</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-rutorrent_dns_record: &quot;{{ rutorrent_web_subdomain }}&quot;</span><span class="diff-line del">-rutorrent_dns_zone: &quot;{{ rutorrent_web_domain }}&quot;</span><span class="diff-line del">-rutorrent_dns_proxy: &quot;{{ dns.proxied }}&quot;</span><span class="diff-line add">+rutorrent_role_dns_record: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_web_subdomain&#x27;, role=&#x27;rutorrent&#x27;) }}&quot;</span><span class="diff-line add">+rutorrent_role_dns_zone: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_web_domain&#x27;, role=&#x27;rutorrent&#x27;) }}&quot;</span><span class="diff-line add">+rutorrent_role_dns_proxy: &quot;{{ dns_proxied }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # Traefik</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-rutorrent_traefik_sso_middleware: &quot;{{ traefik_default_sso_middleware }}&quot;</span><span class="diff-line del">-rutorrent_traefik_middleware_default: &quot;{{ traefik_default_middleware</span><span class="diff-line del">-                                          + (&#x27;,themepark-&#x27; + lookup(&#x27;vars&#x27;, rutorrent_name + &#x27;_name&#x27;, default=rutorrent_name)</span><span class="diff-line del">-                                            if (rutorrent_themepark_enabled and global_themepark_plugin_enabled)</span><span class="diff-line del">-                                            else &#x27;&#x27;) }}&quot;</span><span class="diff-line del">-rutorrent_traefik_middleware_custom: &quot;&quot;</span><span class="diff-line del">-rutorrent_traefik_certresolver: &quot;{{ traefik_default_certresolver }}&quot;</span><span class="diff-line del">-rutorrent_traefik_enabled: true</span><span class="diff-line del">-rutorrent_traefik_api_enabled: true</span><span class="diff-line del">-rutorrent_traefik_api_middleware: &quot;rutorrent-auth,{{ traefik_default_middleware_api }}&quot;</span><span class="diff-line del">-rutorrent_traefik_api_endpoint: &quot;PathPrefix(`/RPC2`)&quot;</span><span class="diff-line add">+rutorrent_role_traefik_sso_middleware: &quot;{{ traefik_default_sso_middleware }}&quot;</span><span class="diff-line add">+rutorrent_role_traefik_middleware_default: &quot;{{ traefik_default_middleware</span><span class="diff-line add">+                                               + (&#x27;,themepark-&#x27; + rutorrent_name</span><span class="diff-line add">+                                                 if (lookup(&#x27;role_var&#x27;, &#x27;_themepark_enabled&#x27;, role=&#x27;rutorrent&#x27;) and global_themepark_plugin_enabled)</span><span class="diff-line add">+                                                 else &#x27;&#x27;) }}&quot;</span><span class="diff-line add">+rutorrent_role_traefik_middleware_custom: &quot;&quot;</span><span class="diff-line add">+rutorrent_role_traefik_certresolver: &quot;{{ traefik_default_certresolver }}&quot;</span><span class="diff-line add">+rutorrent_role_traefik_enabled: true</span><span class="diff-line add">+rutorrent_role_traefik_api_enabled: true</span><span class="diff-line add">+rutorrent_role_traefik_api_middleware: &quot;rutorrent-auth,{{ traefik_default_middleware_api }}&quot;</span><span class="diff-line add">+rutorrent_role_traefik_api_endpoint: &quot;PathPrefix(`/RPC2`)&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # Config</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-rutorrent_config_public_trackers: false</span><span class="diff-line del">-rutorrent_config_diskspace_path: &quot;/mnt&quot;</span><span class="diff-line add">+# Toggles if public tracker functionality is enabled</span><span class="diff-line add">+rutorrent_role_config_public_trackers: false</span><span class="diff-line add">+# Path used by the diskspace plugin to check usage</span><span class="diff-line add">+rutorrent_role_config_diskspace_path: &quot;/mnt&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ## New Installs</span><span class="diff-line context"> </span><span class="diff-line context"> # rtorrent.rc</span><span class="diff-line del">-rutorrent_config_new_installs_rutorrent_rc_settings_default:</span><span class="diff-line add">+rutorrent_role_config_new_installs_rutorrent_rc_settings_default:</span><span class="diff-line context">   # Minimum number of peers to connect to per torrent</span><span class="diff-line context">   - { option: &quot;throttle.min_peers.normal.set&quot;, value: &quot;1&quot; }</span><span class="diff-line context">   # Maximum number of simultaneous upload slots per torrent</span><span class="diff-line hunk">@@ -107,152 +107,120 @@</span><span class="diff-line context">   - { option: &quot;directory.default.set&quot;, value: &quot;/mnt/unionfs/downloads/torrents/rutorrent/completed&quot; }</span><span class="diff-line context">   # Watched Directory</span><span class="diff-line context">   - { option: &quot;schedule&quot;, value: &#x27;watch_directory,5,5,&quot;load.start=/mnt/unionfs/downloads/torrents/rutorrent/watched/*.torrent,d.delete_tied=&quot;&#x27; }</span><span class="diff-line del">-rutorrent_config_new_installs_rutorrent_rc_settings_custom: []</span><span class="diff-line del">-rutorrent_config_new_installs_rutorrent_rc_settings_list: &quot;{{ rutorrent_config_new_installs_rutorrent_rc_settings_default</span><span class="diff-line del">-                                                              + rutorrent_config_new_installs_rutorrent_rc_settings_custom }}&quot;</span><span class="diff-line add">+rutorrent_role_config_new_installs_rutorrent_rc_settings_custom: []</span><span class="diff-line add">+rutorrent_role_config_new_installs_rutorrent_rc_settings_list: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_config_new_installs_rutorrent_rc_settings_default&#x27;, role=&#x27;rutorrent&#x27;)</span><span class="diff-line add">+                                                                   + lookup(&#x27;role_var&#x27;, &#x27;_config_new_installs_rutorrent_rc_settings_custom&#x27;, role=&#x27;rutorrent&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # php-local.ini</span><span class="diff-line del">-rutorrent_config_new_installs_php_local_ini_settings_default:</span><span class="diff-line add">+rutorrent_role_config_new_installs_php_local_ini_settings_default:</span><span class="diff-line context">   # Maximum Upload File Size via Web Browser (eg Uploading Torrent Files)</span><span class="diff-line context">   - { option: &quot;upload_max_filesize&quot;, value: &quot;20M&quot; }</span><span class="diff-line del">-rutorrent_config_new_installs_php_local_ini_settings_custom: []</span><span class="diff-line del">-rutorrent_config_new_installs_php_local_ini_settings_list: &quot;{{ rutorrent_config_new_installs_php_local_ini_settings_default</span><span class="diff-line del">-                                                               + rutorrent_config_new_installs_php_local_ini_settings_custom }}&quot;</span><span class="diff-line add">+rutorrent_role_config_new_installs_php_local_ini_settings_custom: []</span><span class="diff-line add">+rutorrent_role_config_new_installs_php_local_ini_settings_list: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_config_new_installs_php_local_ini_settings_default&#x27;, role=&#x27;rutorrent&#x27;)</span><span class="diff-line add">+                                                                    + lookup(&#x27;role_var&#x27;, &#x27;_config_new_installs_php_local_ini_settings_custom&#x27;, role=&#x27;rutorrent&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ## Existing Installs</span><span class="diff-line context"> </span><span class="diff-line context"> # rtorrent.rc</span><span class="diff-line del">-rutorrent_config_existing_installs_rutorrent_rc_settings_default:</span><span class="diff-line add">+rutorrent_role_config_existing_installs_rutorrent_rc_settings_default:</span><span class="diff-line context">   # Execute - Initiate Plugins</span><span class="diff-line context">   - { option: &quot;execute&quot;, value: &quot;{sh,-c,/usr/bin/php /app/rutorrent/php/initplugins.php abc &amp;}&quot; }</span><span class="diff-line context">   # IP address that is reported to the tracker</span><span class="diff-line context">   - { option: &quot;network.local_address.set&quot;, value: &quot;{{ ip_address_public }}&quot; }</span><span class="diff-line context">   # Ports</span><span class="diff-line del">-  - { option: &quot;network.port_range.set&quot;, value: &quot;{{ rutorrent_docker_ports_51413 }}-{{ rutorrent_docker_ports_51413 }}&quot; }</span><span class="diff-line del">-  - { option: &quot;dht.port.set&quot;, value: &quot;{{ rutorrent_docker_ports_6881 }}&quot; }</span><span class="diff-line add">+  - { option: &quot;network.port_range.set&quot;, value: &quot;{{ rutorrent_role_docker_ports_51413 }}-{{ rutorrent_role_docker_ports_51413 }}&quot; }</span><span class="diff-line add">+  - { option: &quot;dht.port.set&quot;, value: &quot;{{ rutorrent_role_docker_ports_6881 }}&quot; }</span><span class="diff-line context">   # Enable / Disable Public Trackers</span><span class="diff-line del">-  - { option: &quot;dht.mode.set&quot;, value: &quot;{{ rutorrent_config_public_trackers | ternary(&#x27;on&#x27;, &#x27;disable&#x27;) }}&quot; }</span><span class="diff-line del">-  - { option: &quot;trackers.use_udp.set&quot;, value: &quot;{{ rutorrent_config_public_trackers | ternary(&#x27;yes&#x27;, &#x27;no&#x27;) }}&quot; }</span><span class="diff-line del">-  - { option: &quot;protocol.pex.set&quot;, value: &quot;{{ rutorrent_config_public_trackers | ternary(&#x27;yes&#x27;, &#x27;no&#x27;) }}&quot; }</span><span class="diff-line del">-rutorrent_config_existing_installs_rutorrent_rc_settings_custom: []</span><span class="diff-line del">-rutorrent_config_existing_installs_rutorrent_rc_settings_list: &quot;{{ rutorrent_config_existing_installs_rutorrent_rc_settings_default</span><span class="diff-line del">-                                                                   + rutorrent_config_existing_installs_rutorrent_rc_settings_custom }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-################################</span><span class="diff-line del">-# THEME</span><span class="diff-line add">+  - { option: &quot;dht.mode.set&quot;, value: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_config_public_trackers&#x27;, role=&#x27;rutorrent&#x27;) | ternary(&#x27;on&#x27;, &#x27;disable&#x27;) }}&quot; }</span><span class="diff-line add">+  - { option: &quot;trackers.use_udp.set&quot;, value: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_config_public_trackers&#x27;, role=&#x27;rutorrent&#x27;) | ternary(&#x27;yes&#x27;, &#x27;no&#x27;) }}&quot; }</span><span class="diff-line add">+  - { option: &quot;protocol.pex.set&quot;, value: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_config_public_trackers&#x27;, role=&#x27;rutorrent&#x27;) | ternary(&#x27;yes&#x27;, &#x27;no&#x27;) }}&quot; }</span><span class="diff-line add">+rutorrent_role_config_existing_installs_rutorrent_rc_settings_custom: []</span><span class="diff-line add">+rutorrent_role_config_existing_installs_rutorrent_rc_settings_list: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_config_existing_installs_rutorrent_rc_settings_default&#x27;, role=&#x27;rutorrent&#x27;)</span><span class="diff-line add">+                                                                        + lookup(&#x27;role_var&#x27;, &#x27;_config_existing_installs_rutorrent_rc_settings_custom&#x27;, role=&#x27;rutorrent&#x27;) }}&quot;</span><span class="diff-line add">+</span><span class="diff-line add">+################################</span><span class="diff-line add">+# Theme</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line context"> # Options can be found at https://github.com/themepark-dev/theme.park</span><span class="diff-line del">-rutorrent_themepark_enabled: false</span><span class="diff-line del">-rutorrent_themepark_app: &quot;rutorrent&quot;</span><span class="diff-line del">-rutorrent_themepark_theme: &quot;{{ global_themepark_theme }}&quot;</span><span class="diff-line del">-rutorrent_themepark_domain: &quot;{{ global_themepark_domain }}&quot;</span><span class="diff-line del">-rutorrent_themepark_addons: []</span><span class="diff-line add">+rutorrent_role_themepark_enabled: false</span><span class="diff-line add">+rutorrent_role_themepark_app: &quot;rutorrent&quot;</span><span class="diff-line add">+rutorrent_role_themepark_theme: &quot;{{ global_themepark_theme }}&quot;</span><span class="diff-line add">+rutorrent_role_themepark_domain: &quot;{{ global_themepark_domain }}&quot;</span><span class="diff-line add">+rutorrent_role_themepark_addons: []</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # Docker</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line context"> # Container</span><span class="diff-line del">-rutorrent_docker_container: &quot;{{ rutorrent_name }}&quot;</span><span class="diff-line add">+rutorrent_role_docker_container: &quot;{{ rutorrent_name }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Image</span><span class="diff-line del">-rutorrent_docker_image_pull: true</span><span class="diff-line del">-rutorrent_docker_image_tag: &quot;latest&quot;</span><span class="diff-line del">-rutorrent_docker_image: &quot;kudeta/ru-rtorrent:{{ rutorrent_docker_image_tag }}&quot;</span><span class="diff-line add">+rutorrent_role_docker_image_pull: true</span><span class="diff-line add">+rutorrent_role_docker_image_tag: &quot;latest&quot;</span><span class="diff-line add">+rutorrent_role_docker_image_repo: &quot;kudeta/ru-rtorrent&quot;</span><span class="diff-line add">+rutorrent_role_docker_image: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_image_repo&#x27;, role=&#x27;rutorrent&#x27;) }}:{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_image_tag&#x27;, role=&#x27;rutorrent&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Ports</span><span class="diff-line del">-rutorrent_docker_ports_51413: &quot;{{ port_lookup_51413.meta.port</span><span class="diff-line del">-                               if (port_lookup_51413.meta.port is defined) and (port_lookup_51413.meta.port | trim | length &gt; 0)</span><span class="diff-line del">-                               else &#x27;51413&#x27; }}&quot;</span><span class="diff-line del">-rutorrent_docker_ports_6881: &quot;{{ port_lookup_6881.meta.port</span><span class="diff-line del">-                              if (port_lookup_6881.meta.port is defined) and (port_lookup_6881.meta.port | trim | length &gt; 0)</span><span class="diff-line del">-                              else &#x27;6881&#x27; }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-rutorrent_docker_ports_defaults:</span><span class="diff-line del">-  - &quot;{{ rutorrent_docker_ports_51413 }}:{{ rutorrent_docker_ports_51413 }}&quot;</span><span class="diff-line del">-  - &quot;{{ rutorrent_docker_ports_51413 }}:{{ rutorrent_docker_ports_51413 }}/udp&quot;</span><span class="diff-line del">-  - &quot;{{ rutorrent_docker_ports_6881 }}:{{ rutorrent_docker_ports_6881 }}/udp&quot;</span><span class="diff-line del">-rutorrent_docker_ports_custom: []</span><span class="diff-line del">-</span><span class="diff-line del">-rutorrent_docker_ports: &quot;{{ rutorrent_docker_ports_defaults</span><span class="diff-line del">-                            + rutorrent_docker_ports_custom }}&quot;</span><span class="diff-line add">+rutorrent_role_docker_ports_51413: &quot;{{ port_lookup_51413.meta.port</span><span class="diff-line add">+                                    if (port_lookup_51413.meta.port is defined) and (port_lookup_51413.meta.port | trim | length &gt; 0)</span><span class="diff-line add">+                                    else &#x27;51413&#x27; }}&quot;</span><span class="diff-line add">+rutorrent_role_docker_ports_6881: &quot;{{ port_lookup_6881.meta.port</span><span class="diff-line add">+                                   if (port_lookup_6881.meta.port is defined) and (port_lookup_6881.meta.port | trim | length &gt; 0)</span><span class="diff-line add">+                                   else &#x27;6881&#x27; }}&quot;</span><span class="diff-line add">+</span><span class="diff-line add">+rutorrent_role_docker_ports_default:</span><span class="diff-line add">+  - &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_ports_51413&#x27;, role=&#x27;rutorrent&#x27;) }}:{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_ports_51413&#x27;, role=&#x27;rutorrent&#x27;) }}&quot;</span><span class="diff-line add">+  - &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_ports_51413&#x27;, role=&#x27;rutorrent&#x27;) }}:{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_ports_51413&#x27;, role=&#x27;rutorrent&#x27;) }}/udp&quot;</span><span class="diff-line add">+  - &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_ports_6881&#x27;, role=&#x27;rutorrent&#x27;) }}:{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_ports_6881&#x27;, role=&#x27;rutorrent&#x27;) }}/udp&quot;</span><span class="diff-line add">+rutorrent_role_docker_ports_custom: []</span><span class="diff-line add">+rutorrent_role_docker_ports: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_ports_default&#x27;, role=&#x27;rutorrent&#x27;)</span><span class="diff-line add">+                                 + lookup(&#x27;role_var&#x27;, &#x27;_docker_ports_custom&#x27;, role=&#x27;rutorrent&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Envs</span><span class="diff-line del">-rutorrent_docker_envs_default:</span><span class="diff-line add">+rutorrent_role_docker_envs_default:</span><span class="diff-line context">   PUID: &quot;{{ uid }}&quot;</span><span class="diff-line context">   PGID: &quot;{{ gid }}&quot;</span><span class="diff-line context">   TZ: &quot;{{ tz }}&quot;</span><span class="diff-line del">-rutorrent_docker_envs_custom: {}</span><span class="diff-line del">-rutorrent_docker_envs: &quot;{{ rutorrent_docker_envs_default</span><span class="diff-line del">-                           | combine(rutorrent_docker_envs_custom) }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Commands</span><span class="diff-line del">-rutorrent_docker_commands_default: []</span><span class="diff-line del">-rutorrent_docker_commands_custom: []</span><span class="diff-line del">-rutorrent_docker_commands: &quot;{{ rutorrent_docker_commands_default</span><span class="diff-line del">-                               + rutorrent_docker_commands_custom }}&quot;</span><span class="diff-line add">+rutorrent_role_docker_envs_custom: {}</span><span class="diff-line add">+rutorrent_role_docker_envs: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_envs_default&#x27;, role=&#x27;rutorrent&#x27;)</span><span class="diff-line add">+                                | combine(lookup(&#x27;role_var&#x27;, &#x27;_docker_envs_custom&#x27;, role=&#x27;rutorrent&#x27;)) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Volumes</span><span class="diff-line del">-rutorrent_docker_volumes_default:</span><span class="diff-line del">-  - &quot;{{ rutorrent_paths_location }}:/config&quot;</span><span class="diff-line add">+rutorrent_role_docker_volumes_default:</span><span class="diff-line add">+  - &quot;{{ rutorrent_role_paths_location }}:/config&quot;</span><span class="diff-line context">   - &quot;{{ server_appdata_path }}/scripts:/scripts&quot;</span><span class="diff-line del">-rutorrent_docker_volumes_custom: []</span><span class="diff-line del">-rutorrent_docker_volumes: &quot;{{ rutorrent_docker_volumes_default</span><span class="diff-line del">-                              + rutorrent_docker_volumes_custom }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Devices</span><span class="diff-line del">-rutorrent_docker_devices_default: []</span><span class="diff-line del">-rutorrent_docker_devices_custom: []</span><span class="diff-line del">-rutorrent_docker_devices: &quot;{{ rutorrent_docker_devices_default</span><span class="diff-line del">-                              + rutorrent_docker_devices_custom }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Hosts</span><span class="diff-line del">-rutorrent_docker_hosts_default: {}</span><span class="diff-line del">-rutorrent_docker_hosts_custom: {}</span><span class="diff-line del">-rutorrent_docker_hosts: &quot;{{ docker_hosts_common</span><span class="diff-line del">-                            | combine(rutorrent_docker_hosts_default)</span><span class="diff-line del">-                            | combine(rutorrent_docker_hosts_custom) }}&quot;</span><span class="diff-line add">+rutorrent_role_docker_volumes_custom: []</span><span class="diff-line add">+rutorrent_role_docker_volumes: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_volumes_default&#x27;, role=&#x27;rutorrent&#x27;)</span><span class="diff-line add">+                                   + lookup(&#x27;role_var&#x27;, &#x27;_docker_volumes_custom&#x27;, role=&#x27;rutorrent&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Labels</span><span class="diff-line del">-rutorrent_docker_labels_default:</span><span class="diff-line add">+rutorrent_role_docker_labels_default:</span><span class="diff-line context">   traefik.http.middlewares.rutorrent-auth.basicauth.usersfile: &quot;/etc/traefik/auth&quot;</span><span class="diff-line del">-rutorrent_docker_labels_custom: {}</span><span class="diff-line del">-rutorrent_docker_labels: &quot;{{ docker_labels_common</span><span class="diff-line del">-                             | combine(lookup(&#x27;vars&#x27;, rutorrent_name + &#x27;_docker_labels_default&#x27;, default=rutorrent_docker_labels_default))</span><span class="diff-line del">-                             | combine((traefik_themepark_labels</span><span class="diff-line del">-                                       if (rutorrent_themepark_enabled and global_themepark_plugin_enabled)</span><span class="diff-line del">-                                       else {}),</span><span class="diff-line del">-                                       lookup(&#x27;vars&#x27;, rutorrent_name + &#x27;_docker_labels_custom&#x27;, default=rutorrent_docker_labels_custom)) }}&quot;</span><span class="diff-line add">+rutorrent_role_docker_labels_custom: {}</span><span class="diff-line add">+rutorrent_role_docker_labels: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_labels_default&#x27;, role=&#x27;rutorrent&#x27;)</span><span class="diff-line add">+                                  | combine((traefik_themepark_labels</span><span class="diff-line add">+                                            if (lookup(&#x27;role_var&#x27;, &#x27;_themepark_enabled&#x27;, role=&#x27;rutorrent&#x27;) and global_themepark_plugin_enabled)</span><span class="diff-line add">+                                            else {}),</span><span class="diff-line add">+                                            lookup(&#x27;role_var&#x27;, &#x27;_docker_labels_custom&#x27;, role=&#x27;rutorrent&#x27;)) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Hostname</span><span class="diff-line del">-rutorrent_docker_hostname: &quot;{{ rutorrent_name }}&quot;</span><span class="diff-line add">+rutorrent_role_docker_hostname: &quot;{{ rutorrent_name }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Networks</span><span class="diff-line del">-rutorrent_docker_networks_alias: &quot;{{ rutorrent_name }}&quot;</span><span class="diff-line del">-rutorrent_docker_networks_default: []</span><span class="diff-line del">-rutorrent_docker_networks_custom: []</span><span class="diff-line del">-rutorrent_docker_networks: &quot;{{ docker_networks_common</span><span class="diff-line del">-                               + rutorrent_docker_networks_default</span><span class="diff-line del">-                               + rutorrent_docker_networks_custom }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Capabilities</span><span class="diff-line del">-rutorrent_docker_capabilities_default: []</span><span class="diff-line del">-rutorrent_docker_capabilities_custom: []</span><span class="diff-line del">-rutorrent_docker_capabilities: &quot;{{ rutorrent_docker_capabilities_default</span><span class="diff-line del">-                                   + rutorrent_docker_capabilities_custom }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Security Opts</span><span class="diff-line del">-rutorrent_docker_security_opts_default: []</span><span class="diff-line del">-rutorrent_docker_security_opts_custom: []</span><span class="diff-line del">-rutorrent_docker_security_opts: &quot;{{ rutorrent_docker_security_opts_default</span><span class="diff-line del">-                                    + rutorrent_docker_security_opts_custom }}&quot;</span><span class="diff-line add">+rutorrent_role_docker_networks_alias: &quot;{{ rutorrent_name }}&quot;</span><span class="diff-line add">+rutorrent_role_docker_networks_default: []</span><span class="diff-line add">+rutorrent_role_docker_networks_custom: []</span><span class="diff-line add">+rutorrent_role_docker_networks: &quot;{{ docker_networks_common</span><span class="diff-line add">+                                    + lookup(&#x27;role_var&#x27;, &#x27;_docker_networks_default&#x27;, role=&#x27;rutorrent&#x27;)</span><span class="diff-line add">+                                    + lookup(&#x27;role_var&#x27;, &#x27;_docker_networks_custom&#x27;, role=&#x27;rutorrent&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Restart Policy</span><span class="diff-line del">-rutorrent_docker_restart_policy: unless-stopped</span><span class="diff-line add">+rutorrent_role_docker_restart_policy: unless-stopped</span><span class="diff-line context"> </span><span class="diff-line context"> # Stop Timeout</span><span class="diff-line del">-rutorrent_docker_stop_timeout: 900</span><span class="diff-line add">+rutorrent_role_docker_stop_timeout: 900</span><span class="diff-line context"> </span><span class="diff-line context"> # State</span><span class="diff-line del">-rutorrent_docker_state: started</span><span class="diff-line add">+rutorrent_role_docker_state: started</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-321">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/rutorrent/tasks/main.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -10,9 +10,9 @@</span><span class="diff-line context"> - name: Add DNS record</span><span class="diff-line context">   ansible.builtin.include_tasks: &quot;{{ resources_tasks_path }}/dns/tasker.yml&quot;</span><span class="diff-line context">   vars:</span><span class="diff-line del">-    dns_record: &quot;{{ lookup(&#x27;vars&#x27;, role_name + &#x27;_dns_record&#x27;) }}&quot;</span><span class="diff-line del">-    dns_zone: &quot;{{ lookup(&#x27;vars&#x27;, role_name + &#x27;_dns_zone&#x27;) }}&quot;</span><span class="diff-line del">-    dns_proxy: &quot;{{ lookup(&#x27;vars&#x27;, role_name + &#x27;_dns_proxy&#x27;) }}&quot;</span><span class="diff-line add">+    dns_record: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_dns_record&#x27;) }}&quot;</span><span class="diff-line add">+    dns_zone: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_dns_zone&#x27;) }}&quot;</span><span class="diff-line add">+    dns_proxy: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_dns_proxy&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Remove existing Docker container</span><span class="diff-line context">   ansible.builtin.include_tasks: &quot;{{ resources_tasks_path }}/docker/remove_docker_container.yml&quot;</span><span class="diff-line hunk">@@ -22,15 +22,15 @@</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Check if existing config file exists</span><span class="diff-line context">   ansible.builtin.stat:</span><span class="diff-line del">-    path: &quot;{{ rutorrent_paths_rtorrent_rc_location }}&quot;</span><span class="diff-line del">-  register: rutorrent_paths_rtorrent_rc_location_stat</span><span class="diff-line add">+    path: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_rtorrent_rc_location&#x27;, role=&#x27;rutorrent&#x27;) }}&quot;</span><span class="diff-line add">+  register: rutorrent_role_paths_rtorrent_rc_location_stat</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Pre-Install Tasks</span><span class="diff-line del">-  ansible.builtin.import_tasks: &quot;subtasks/pre-install/main.yml&quot;</span><span class="diff-line add">+  ansible.builtin.include_tasks: &quot;subtasks/pre-install/main.yml&quot;</span><span class="diff-line context">   when: (not continuous_integration)</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Create Docker container</span><span class="diff-line context">   ansible.builtin.include_tasks: &quot;{{ resources_tasks_path }}/docker/create_docker_container.yml&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Post-Install Tasks</span><span class="diff-line del">-  ansible.builtin.import_tasks: &quot;subtasks/post-install/main.yml&quot;</span><span class="diff-line add">+  ansible.builtin.include_tasks: &quot;subtasks/post-install/main.yml&quot;</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-322">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/rutorrent/tasks/subtasks/post-install/main.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -12,9 +12,9 @@</span><span class="diff-line context">     path: &quot;{{ item }}&quot;</span><span class="diff-line context">     state: present</span><span class="diff-line context">   loop:</span><span class="diff-line del">-    - &quot;{{ rutorrent_paths_rtorrent_rc_location }}&quot;</span><span class="diff-line del">-    - &quot;{{ rutorrent_paths_php_local_ini_location }}&quot;</span><span class="diff-line del">-    - &quot;{{ rutorrent_paths_plugins_ini_location }}&quot;</span><span class="diff-line add">+    - &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_rtorrent_rc_location&#x27;, role=&#x27;rutorrent&#x27;) }}&quot;</span><span class="diff-line add">+    - &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_php_local_ini_location&#x27;, role=&#x27;rutorrent&#x27;) }}&quot;</span><span class="diff-line add">+    - &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_plugins_ini_location&#x27;, role=&#x27;rutorrent&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Post-Install | Wait for 60 seconds</span><span class="diff-line context">   ansible.builtin.wait_for:</span><span class="diff-line hunk">@@ -24,7 +24,7 @@</span><span class="diff-line context">   ansible.builtin.include_tasks: &quot;{{ resources_tasks_path }}/docker/stop_docker_container.yml&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Post-Install | Settings Task</span><span class="diff-line del">-  ansible.builtin.import_tasks: &quot;settings/main.yml&quot;</span><span class="diff-line add">+  ansible.builtin.include_tasks: &quot;settings/main.yml&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Post-Install | Start container</span><span class="diff-line context">   ansible.builtin.include_tasks: &quot;{{ resources_tasks_path }}/docker/start_docker_container.yml&quot;</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-323">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/rutorrent/tasks/subtasks/post-install/settings/main.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -8,12 +8,12 @@</span><span class="diff-line context"> #########################################################################</span><span class="diff-line context"> ---</span><span class="diff-line context"> - name: Post-Install | Settings | Update settings For New Installs</span><span class="diff-line del">-  ansible.builtin.import_tasks: &quot;new_installs.yml&quot;</span><span class="diff-line del">-  when: (not continuous_integration) and (not rutorrent_paths_rtorrent_rc_location_stat.stat.exists)</span><span class="diff-line add">+  ansible.builtin.include_tasks: &quot;new_installs.yml&quot;</span><span class="diff-line add">+  when: (not continuous_integration) and (not rutorrent_role_paths_rtorrent_rc_location_stat.stat.exists)</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Post-Install | Settings | Create directory</span><span class="diff-line context">   ansible.builtin.file:</span><span class="diff-line del">-    path: &quot;{{ rutorrent_paths_location }}/plugins/diskspace&quot;</span><span class="diff-line add">+    path: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_location&#x27;, role=&#x27;rutorrent&#x27;) }}/plugins/diskspace&quot;</span><span class="diff-line context">     state: directory</span><span class="diff-line context">     owner: &quot;{{ user.name }}&quot;</span><span class="diff-line context">     group: &quot;{{ user.name }}&quot;</span><span class="diff-line hunk">@@ -22,7 +22,7 @@</span><span class="diff-line context"> - name: Post-Install | Settings | Import custom &#x27;conf.php&#x27; for diskspace</span><span class="diff-line context">   ansible.builtin.template:</span><span class="diff-line context">     src: &quot;diskspace_conf.php.j2&quot;</span><span class="diff-line del">-    dest: &quot;{{ rutorrent_paths_location }}/plugins/diskspace/conf.php&quot;</span><span class="diff-line add">+    dest: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_location&#x27;, role=&#x27;rutorrent&#x27;) }}/plugins/diskspace/conf.php&quot;</span><span class="diff-line context">     owner: &quot;{{ user.name }}&quot;</span><span class="diff-line context">     group: &quot;{{ user.name }}&quot;</span><span class="diff-line context">     mode: &quot;0644&quot;</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-324">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/rutorrent/tasks/subtasks/post-install/settings/new_installs.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -9,7 +9,7 @@</span><span class="diff-line context"> ---</span><span class="diff-line context"> - name: Post-Install | Settings | New Installs | Update &#x27;rtorrent.rc&#x27; config settings</span><span class="diff-line context">   community.general.ini_file:</span><span class="diff-line del">-    path: &quot;{{ rutorrent_paths_rtorrent_rc_location }}&quot;</span><span class="diff-line add">+    path: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_rtorrent_rc_location&#x27;, role=&#x27;rutorrent&#x27;) }}&quot;</span><span class="diff-line context">     section: null</span><span class="diff-line context">     option: &quot;{{ item.option }}&quot;</span><span class="diff-line context">     value: &quot;{{ item.value }}&quot;</span><span class="diff-line hunk">@@ -18,11 +18,11 @@</span><span class="diff-line context">     owner: &quot;{{ user.name }}&quot;</span><span class="diff-line context">     group: &quot;{{ user.name }}&quot;</span><span class="diff-line context">     mode: &quot;0664&quot;</span><span class="diff-line del">-  loop: &quot;{{ rutorrent_config_new_installs_rutorrent_rc_settings_list }}&quot;</span><span class="diff-line add">+  loop: &quot;{{ rutorrent_role_config_new_installs_rutorrent_rc_settings_list }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Post-Install | Settings | New Installs | Update &#x27;php-local.ini&#x27; config settings</span><span class="diff-line context">   community.general.ini_file:</span><span class="diff-line del">-    path: &quot;{{ rutorrent_paths_php_local_ini_location }}&quot;</span><span class="diff-line add">+    path: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_php_local_ini_location&#x27;, role=&#x27;rutorrent&#x27;) }}&quot;</span><span class="diff-line context">     section: null</span><span class="diff-line context">     option: &quot;{{ item.option }}&quot;</span><span class="diff-line context">     value: &quot;{{ item.value }}&quot;</span><span class="diff-line hunk">@@ -31,13 +31,13 @@</span><span class="diff-line context">     owner: &quot;{{ user.name }}&quot;</span><span class="diff-line context">     group: &quot;{{ user.name }}&quot;</span><span class="diff-line context">     mode: &quot;0664&quot;</span><span class="diff-line del">-  loop: &quot;{{ rutorrent_config_new_installs_php_local_ini_settings_list }}&quot;</span><span class="diff-line add">+  loop: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_config_new_installs_php_local_ini_settings_list&#x27;, role=&#x27;rutorrent&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Post-Install | Settings | New Installs | Import custom &#x27;plugins.ini&#x27;</span><span class="diff-line context">   ansible.builtin.copy:</span><span class="diff-line context">     src: plugins.ini</span><span class="diff-line context">     force: true</span><span class="diff-line del">-    dest: &quot;{{ rutorrent_paths_plugins_ini_location }}&quot;</span><span class="diff-line add">+    dest: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_plugins_ini_location&#x27;, role=&#x27;rutorrent&#x27;) }}&quot;</span><span class="diff-line context">     owner: &quot;{{ user.name }}&quot;</span><span class="diff-line context">     group: &quot;{{ user.name }}&quot;</span><span class="diff-line context">     mode: &quot;0664&quot;</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-325">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/rutorrent/tasks/subtasks/pre-install/existing_installs.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -9,7 +9,7 @@</span><span class="diff-line context"> ---</span><span class="diff-line context"> - name: Pre-Install | Settings | Existing Installs | Update &#x27;rtorrent.rc&#x27; config settings</span><span class="diff-line context">   community.general.ini_file:</span><span class="diff-line del">-    path: &quot;{{ rutorrent_paths_rtorrent_rc_location }}&quot;</span><span class="diff-line add">+    path: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_rtorrent_rc_location&#x27;, role=&#x27;rutorrent&#x27;) }}&quot;</span><span class="diff-line context">     section: null</span><span class="diff-line context">     option: &quot;{{ item.option }}&quot;</span><span class="diff-line context">     value: &quot;{{ item.value }}&quot;</span><span class="diff-line hunk">@@ -18,4 +18,4 @@</span><span class="diff-line context">     owner: &quot;{{ user.name }}&quot;</span><span class="diff-line context">     group: &quot;{{ user.name }}&quot;</span><span class="diff-line context">     mode: &quot;0664&quot;</span><span class="diff-line del">-  loop: &quot;{{ rutorrent_config_existing_installs_rutorrent_rc_settings_list }}&quot;</span><span class="diff-line add">+  loop: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_config_existing_installs_rutorrent_rc_settings_list&#x27;, role=&#x27;rutorrent&#x27;) }}&quot;</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-326">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/rutorrent/tasks/subtasks/pre-install/main.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -9,7 +9,7 @@</span><span class="diff-line context"> ---</span><span class="diff-line context"> - name: Pre-Install | Remove existing &#x27;config.php&#x27;</span><span class="diff-line context">   ansible.builtin.file:</span><span class="diff-line del">-    path: &quot;{{ rutorrent_paths_config_php_location }}&quot;</span><span class="diff-line add">+    path: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_config_php_location&#x27;, role=&#x27;rutorrent&#x27;) }}&quot;</span><span class="diff-line context">     state: absent</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Pre-Install | Get next available port within the range of &#x27;51413-51423&#x27; # noqa fqcn[action]</span><span class="diff-line hunk">@@ -29,5 +29,5 @@</span><span class="diff-line context">   ignore_errors: true</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Pre-Install | Settings | Update settings For Existing Installs</span><span class="diff-line del">-  ansible.builtin.import_tasks: &quot;existing_installs.yml&quot;</span><span class="diff-line del">-  when: rutorrent_paths_rtorrent_rc_location_stat.stat.exists</span><span class="diff-line add">+  ansible.builtin.include_tasks: &quot;existing_installs.yml&quot;</span><span class="diff-line add">+  when: rutorrent_role_paths_rtorrent_rc_location_stat.stat.exists</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-327">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/rutorrent/templates/diskspace_conf.php.j2</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -2,4 +2,4 @@</span><span class="diff-line context"> </span><span class="diff-line context"> $diskUpdateInterval = 10;     // in seconds</span><span class="diff-line context"> $notifySpaceLimit = 512;      // in Mb</span><span class="diff-line del">-$partitionDirectory = &#x27;{{ rutorrent_config_diskspace_path }}&#x27;; // set this to the absolute path for checked partition. </span><span class="diff-line add">+$partitionDirectory = &#x27;{{ lookup(&#x27;role_var&#x27;, &#x27;_config_diskspace_path&#x27;, role=&#x27;rutorrent&#x27;) }}&#x27;; // set this to the absolute path for checked partition. </span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-328">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/sabnzbd/defaults/main.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -17,178 +17,141 @@</span><span class="diff-line context"> # Paths</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-sabnzbd_paths_folder: &quot;{{ sabnzbd_name }}&quot;</span><span class="diff-line del">-sabnzbd_paths_location: &quot;{{ server_appdata_path }}/{{ sabnzbd_paths_folder }}&quot;</span><span class="diff-line del">-sabnzbd_paths_downloads_location: &quot;{{ downloads_usenet_path }}/{{ sabnzbd_paths_folder }}&quot;</span><span class="diff-line del">-sabnzbd_paths_folders_list:</span><span class="diff-line del">-  - &quot;{{ sabnzbd_paths_location }}&quot;</span><span class="diff-line del">-  - &quot;{{ sabnzbd_paths_downloads_location }}&quot;</span><span class="diff-line del">-  - &quot;{{ sabnzbd_paths_downloads_location }}/complete&quot;</span><span class="diff-line del">-  - &quot;{{ sabnzbd_paths_downloads_location }}/incomplete&quot;</span><span class="diff-line del">-  - &quot;{{ sabnzbd_paths_downloads_location }}/watch&quot;</span><span class="diff-line del">-sabnzbd_paths_config_location: &quot;{{ sabnzbd_paths_location }}/sabnzbd.ini&quot;</span><span class="diff-line add">+sabnzbd_role_paths_folder: &quot;{{ sabnzbd_name }}&quot;</span><span class="diff-line add">+sabnzbd_role_paths_location: &quot;{{ server_appdata_path }}/{{ sabnzbd_role_paths_folder }}&quot;</span><span class="diff-line add">+sabnzbd_role_paths_downloads_location: &quot;{{ downloads_usenet_path }}/{{ sabnzbd_role_paths_folder }}&quot;</span><span class="diff-line add">+sabnzbd_role_paths_folders_list:</span><span class="diff-line add">+  - &quot;{{ sabnzbd_role_paths_location }}&quot;</span><span class="diff-line add">+  - &quot;{{ sabnzbd_role_paths_downloads_location }}&quot;</span><span class="diff-line add">+  - &quot;{{ sabnzbd_role_paths_downloads_location }}/complete&quot;</span><span class="diff-line add">+  - &quot;{{ sabnzbd_role_paths_downloads_location }}/incomplete&quot;</span><span class="diff-line add">+  - &quot;{{ sabnzbd_role_paths_downloads_location }}/watch&quot;</span><span class="diff-line add">+sabnzbd_role_paths_config_location: &quot;{{ sabnzbd_role_paths_location }}/sabnzbd.ini&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # Web</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-sabnzbd_web_subdomain: &quot;{{ sabnzbd_name }}&quot;</span><span class="diff-line del">-sabnzbd_web_domain: &quot;{{ user.domain }}&quot;</span><span class="diff-line del">-sabnzbd_web_port: &quot;8080&quot;</span><span class="diff-line del">-sabnzbd_web_url: &quot;{{ &#x27;https://&#x27; + (sabnzbd_web_subdomain + &#x27;.&#x27; + sabnzbd_web_domain</span><span class="diff-line del">-                  if (sabnzbd_web_subdomain | length &gt; 0)</span><span class="diff-line del">-                  else sabnzbd_web_domain) }}&quot;</span><span class="diff-line del">-sabnzbd_web_local_url: &quot;{{ &#x27;http://&#x27; + sabnzbd_name + &#x27;:&#x27; + sabnzbd_web_port }}&quot;</span><span class="diff-line add">+sabnzbd_role_web_subdomain: &quot;{{ sabnzbd_name }}&quot;</span><span class="diff-line add">+sabnzbd_role_web_domain: &quot;{{ user.domain }}&quot;</span><span class="diff-line add">+sabnzbd_role_web_port: &quot;8080&quot;</span><span class="diff-line add">+sabnzbd_role_web_url: &quot;{{ &#x27;https://&#x27; + (lookup(&#x27;role_var&#x27;, &#x27;_web_subdomain&#x27;, role=&#x27;sabnzbd&#x27;) + &#x27;.&#x27; + lookup(&#x27;role_var&#x27;, &#x27;_web_domain&#x27;, role=&#x27;sabnzbd&#x27;)</span><span class="diff-line add">+                       if (lookup(&#x27;role_var&#x27;, &#x27;_web_subdomain&#x27;, role=&#x27;sabnzbd&#x27;) | length &gt; 0)</span><span class="diff-line add">+                       else lookup(&#x27;role_var&#x27;, &#x27;_web_domain&#x27;, role=&#x27;sabnzbd&#x27;)) }}&quot;</span><span class="diff-line add">+sabnzbd_role_web_local_url: &quot;{{ &#x27;http://&#x27; + sabnzbd_name + &#x27;:&#x27; + lookup(&#x27;role_var&#x27;, &#x27;_web_port&#x27;, role=&#x27;sabnzbd&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # DNS</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-sabnzbd_dns_record: &quot;{{ sabnzbd_web_subdomain }}&quot;</span><span class="diff-line del">-sabnzbd_dns_zone: &quot;{{ sabnzbd_web_domain }}&quot;</span><span class="diff-line del">-sabnzbd_dns_proxy: &quot;{{ dns.proxied }}&quot;</span><span class="diff-line add">+sabnzbd_role_dns_record: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_web_subdomain&#x27;, role=&#x27;sabnzbd&#x27;) }}&quot;</span><span class="diff-line add">+sabnzbd_role_dns_zone: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_web_domain&#x27;, role=&#x27;sabnzbd&#x27;) }}&quot;</span><span class="diff-line add">+sabnzbd_role_dns_proxy: &quot;{{ dns_proxied }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # Traefik</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-sabnzbd_traefik_sso_middleware: &quot;{{ traefik_default_sso_middleware }}&quot;</span><span class="diff-line del">-sabnzbd_traefik_middleware_default: &quot;{{ traefik_default_middleware</span><span class="diff-line del">-                                        + (&#x27;,themepark-&#x27; + lookup(&#x27;vars&#x27;, sabnzbd_name + &#x27;_name&#x27;, default=sabnzbd_name)</span><span class="diff-line del">-                                          if (sabnzbd_themepark_enabled and global_themepark_plugin_enabled)</span><span class="diff-line del">-                                          else &#x27;&#x27;) }}&quot;</span><span class="diff-line del">-sabnzbd_traefik_middleware_custom: &quot;&quot;</span><span class="diff-line del">-sabnzbd_traefik_certresolver: &quot;{{ traefik_default_certresolver }}&quot;</span><span class="diff-line del">-sabnzbd_traefik_enabled: true</span><span class="diff-line del">-sabnzbd_traefik_api_enabled: true</span><span class="diff-line del">-sabnzbd_traefik_api_endpoint: &quot;PathPrefix(`/api`)&quot;</span><span class="diff-line add">+sabnzbd_role_traefik_sso_middleware: &quot;{{ traefik_default_sso_middleware }}&quot;</span><span class="diff-line add">+sabnzbd_role_traefik_middleware_default: &quot;{{ traefik_default_middleware</span><span class="diff-line add">+                                             + (&#x27;,themepark-&#x27; + sabnzbd_name</span><span class="diff-line add">+                                               if (lookup(&#x27;role_var&#x27;, &#x27;_themepark_enabled&#x27;, role=&#x27;sabnzbd&#x27;) and global_themepark_plugin_enabled)</span><span class="diff-line add">+                                               else &#x27;&#x27;) }}&quot;</span><span class="diff-line add">+sabnzbd_role_traefik_middleware_custom: &quot;&quot;</span><span class="diff-line add">+sabnzbd_role_traefik_certresolver: &quot;{{ traefik_default_certresolver }}&quot;</span><span class="diff-line add">+sabnzbd_role_traefik_enabled: true</span><span class="diff-line add">+sabnzbd_role_traefik_api_enabled: true</span><span class="diff-line add">+sabnzbd_role_traefik_api_endpoint: &quot;PathPrefix(`/api`)&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # Config</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-sabnzbd_config_settings_web:</span><span class="diff-line add">+sabnzbd_role_config_settings_web:</span><span class="diff-line context">   # Web</span><span class="diff-line del">-  - { option: &quot;host_whitelist&quot;, value: &quot;{{ sabnzbd_web_subdomain }}.{{ sabnzbd_web_domain }}, {{ sabnzbd_name }}&quot; }</span><span class="diff-line add">+  - { option: &quot;host_whitelist&quot;, value: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_web_subdomain&#x27;, role=&#x27;sabnzbd&#x27;) }}.{{ lookup(&#x27;role_var&#x27;, &#x27;_web_domain&#x27;, role=&#x27;sabnzbd&#x27;) }}, {{ sabnzbd_name }}&quot; }</span><span class="diff-line context">   - { option: &quot;url_base&quot;, value: &quot;&quot; }</span><span class="diff-line context">   - { option: &quot;log_dir&quot;, value: &quot;/config/logs&quot; }</span><span class="diff-line context"> </span><span class="diff-line del">-sabnzbd_config_settings_default:</span><span class="diff-line add">+sabnzbd_role_config_settings_default:</span><span class="diff-line context">   # Web</span><span class="diff-line del">-  - { option: &quot;host_whitelist&quot;, value: &quot;{{ sabnzbd_web_subdomain }}.{{ sabnzbd_web_domain }}, {{ sabnzbd_name }}&quot; }</span><span class="diff-line add">+  - { option: &quot;host_whitelist&quot;, value: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_web_subdomain&#x27;, role=&#x27;sabnzbd&#x27;) }}.{{ lookup(&#x27;role_var&#x27;, &#x27;_web_domain&#x27;, role=&#x27;sabnzbd&#x27;) }}, {{ sabnzbd_name }}&quot; }</span><span class="diff-line context">   - { option: &quot;url_base&quot;, value: &quot;&quot; }</span><span class="diff-line context">   # Paths</span><span class="diff-line del">-  - { option: &quot;dirscan_dir&quot;, value: &quot;{{ sabnzbd_paths_downloads_location }}/watch&quot; }</span><span class="diff-line del">-  - { option: &quot;download_dir&quot;, value: &quot;{{ sabnzbd_paths_downloads_location }}/incomplete&quot; }</span><span class="diff-line del">-  - { option: &quot;complete_dir&quot;, value: &quot;{{ sabnzbd_paths_downloads_location }}/complete&quot; }</span><span class="diff-line add">+  - { option: &quot;dirscan_dir&quot;, value: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_downloads_location&#x27;, role=&#x27;sabnzbd&#x27;) }}/watch&quot; }</span><span class="diff-line add">+  - { option: &quot;download_dir&quot;, value: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_downloads_location&#x27;, role=&#x27;sabnzbd&#x27;) }}/incomplete&quot; }</span><span class="diff-line add">+  - { option: &quot;complete_dir&quot;, value: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_downloads_location&#x27;, role=&#x27;sabnzbd&#x27;) }}/complete&quot; }</span><span class="diff-line context">   - { option: &quot;log_dir&quot;, value: &quot;/config/logs&quot; }</span><span class="diff-line context"> </span><span class="diff-line del">-sabnzbd_config_settings_custom: []</span><span class="diff-line add">+sabnzbd_role_config_settings_custom: []</span><span class="diff-line context"> </span><span class="diff-line del">-sabnzbd_config_settings_list: &quot;{{ sabnzbd_config_settings_default</span><span class="diff-line del">-                                  + sabnzbd_config_settings_custom }}&quot;</span><span class="diff-line add">+sabnzbd_role_config_settings_list: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_config_settings_default&#x27;, role=&#x27;sabnzbd&#x27;)</span><span class="diff-line add">+                                       + lookup(&#x27;role_var&#x27;, &#x27;_config_settings_custom&#x27;, role=&#x27;sabnzbd&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line del">-# THEME</span><span class="diff-line add">+# Theme</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line context"> # Options can be found at https://github.com/themepark-dev/theme.park</span><span class="diff-line del">-sabnzbd_themepark_enabled: false</span><span class="diff-line del">-sabnzbd_themepark_app: &quot;sabnzbd&quot;</span><span class="diff-line del">-sabnzbd_themepark_theme: &quot;{{ global_themepark_theme }}&quot;</span><span class="diff-line del">-sabnzbd_themepark_domain: &quot;{{ global_themepark_domain }}&quot;</span><span class="diff-line del">-sabnzbd_themepark_addons: []</span><span class="diff-line add">+sabnzbd_role_themepark_enabled: false</span><span class="diff-line add">+sabnzbd_role_themepark_app: &quot;sabnzbd&quot;</span><span class="diff-line add">+sabnzbd_role_themepark_theme: &quot;{{ global_themepark_theme }}&quot;</span><span class="diff-line add">+sabnzbd_role_themepark_domain: &quot;{{ global_themepark_domain }}&quot;</span><span class="diff-line add">+sabnzbd_role_themepark_addons: []</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # Docker</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line context"> # Container</span><span class="diff-line del">-sabnzbd_docker_container: &quot;{{ sabnzbd_name }}&quot;</span><span class="diff-line add">+sabnzbd_role_docker_container: &quot;{{ sabnzbd_name }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Image</span><span class="diff-line del">-sabnzbd_docker_image_pull: true</span><span class="diff-line del">-sabnzbd_docker_image_tag: &quot;latest&quot;</span><span class="diff-line del">-sabnzbd_docker_image: &quot;ghcr.io/hotio/sabnzbd:{{ sabnzbd_docker_image_tag }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Ports</span><span class="diff-line del">-sabnzbd_docker_ports_defaults: []</span><span class="diff-line del">-sabnzbd_docker_ports_custom: []</span><span class="diff-line del">-sabnzbd_docker_ports: &quot;{{ sabnzbd_docker_ports_defaults</span><span class="diff-line del">-                          + sabnzbd_docker_ports_custom }}&quot;</span><span class="diff-line add">+sabnzbd_role_docker_image_pull: true</span><span class="diff-line add">+sabnzbd_role_docker_image_repo: &quot;ghcr.io/hotio/sabnzbd&quot;</span><span class="diff-line add">+sabnzbd_role_docker_image_tag: &quot;latest&quot;</span><span class="diff-line add">+sabnzbd_role_docker_image: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_image_repo&#x27;, role=&#x27;sabnzbd&#x27;) }}:{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_image_tag&#x27;, role=&#x27;sabnzbd&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Envs</span><span class="diff-line del">-sabnzbd_docker_envs_default:</span><span class="diff-line add">+sabnzbd_role_docker_envs_default:</span><span class="diff-line context">   PUID: &quot;{{ uid }}&quot;</span><span class="diff-line context">   PGID: &quot;{{ gid }}&quot;</span><span class="diff-line context">   UMASK: &quot;002&quot;</span><span class="diff-line context">   TZ: &quot;{{ tz }}&quot;</span><span class="diff-line del">-sabnzbd_docker_envs_custom: {}</span><span class="diff-line del">-sabnzbd_docker_envs: &quot;{{ sabnzbd_docker_envs_default</span><span class="diff-line del">-                         | combine(sabnzbd_docker_envs_custom) }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Commands</span><span class="diff-line del">-sabnzbd_docker_commands_default: []</span><span class="diff-line del">-sabnzbd_docker_commands_custom: []</span><span class="diff-line del">-sabnzbd_docker_commands: &quot;{{ sabnzbd_docker_commands_default</span><span class="diff-line del">-                             + sabnzbd_docker_commands_custom }}&quot;</span><span class="diff-line add">+sabnzbd_role_docker_envs_custom: {}</span><span class="diff-line add">+sabnzbd_role_docker_envs: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_envs_default&#x27;, role=&#x27;sabnzbd&#x27;)</span><span class="diff-line add">+                              | combine(lookup(&#x27;role_var&#x27;, &#x27;_docker_envs_custom&#x27;, role=&#x27;sabnzbd&#x27;)) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Volumes</span><span class="diff-line del">-sabnzbd_docker_volumes_default:</span><span class="diff-line del">-  - &quot;{{ sabnzbd_paths_location }}:/config&quot;</span><span class="diff-line add">+sabnzbd_role_docker_volumes_default:</span><span class="diff-line add">+  - &quot;{{ sabnzbd_role_paths_location }}:/config&quot;</span><span class="diff-line context">   - &quot;{{ server_appdata_path }}/scripts:/scripts&quot;</span><span class="diff-line del">-sabnzbd_docker_volumes_custom: []</span><span class="diff-line del">-sabnzbd_docker_volumes: &quot;{{ sabnzbd_docker_volumes_default</span><span class="diff-line del">-                            + sabnzbd_docker_volumes_custom }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Devices</span><span class="diff-line del">-sabnzbd_docker_devices_default: []</span><span class="diff-line del">-sabnzbd_docker_devices_custom: []</span><span class="diff-line del">-sabnzbd_docker_devices: &quot;{{ sabnzbd_docker_devices_default</span><span class="diff-line del">-                            + sabnzbd_docker_devices_custom }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Hosts</span><span class="diff-line del">-sabnzbd_docker_hosts_default: {}</span><span class="diff-line del">-sabnzbd_docker_hosts_custom: {}</span><span class="diff-line del">-sabnzbd_docker_hosts: &quot;{{ docker_hosts_common</span><span class="diff-line del">-                          | combine(sabnzbd_docker_hosts_default)</span><span class="diff-line del">-                          | combine(sabnzbd_docker_hosts_custom) }}&quot;</span><span class="diff-line add">+sabnzbd_role_docker_volumes_custom: []</span><span class="diff-line add">+sabnzbd_role_docker_volumes: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_volumes_default&#x27;, role=&#x27;sabnzbd&#x27;)</span><span class="diff-line add">+                                 + lookup(&#x27;role_var&#x27;, &#x27;_docker_volumes_custom&#x27;, role=&#x27;sabnzbd&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Labels</span><span class="diff-line del">-sabnzbd_docker_labels_default: {}</span><span class="diff-line del">-sabnzbd_docker_labels_custom: {}</span><span class="diff-line del">-sabnzbd_docker_labels: &quot;{{ docker_labels_common</span><span class="diff-line del">-                           | combine(sabnzbd_docker_labels_default)</span><span class="diff-line del">-                           | combine((traefik_themepark_labels</span><span class="diff-line del">-                                    if (sabnzbd_themepark_enabled and global_themepark_plugin_enabled)</span><span class="diff-line del">-                                    else {}),</span><span class="diff-line del">-                                    sabnzbd_docker_labels_custom) }}&quot;</span><span class="diff-line add">+sabnzbd_role_docker_labels_default: {}</span><span class="diff-line add">+sabnzbd_role_docker_labels_custom: {}</span><span class="diff-line add">+sabnzbd_role_docker_labels: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_labels_default&#x27;, role=&#x27;sabnzbd&#x27;)</span><span class="diff-line add">+                                | combine((traefik_themepark_labels</span><span class="diff-line add">+                                          if (lookup(&#x27;role_var&#x27;, &#x27;_themepark_enabled&#x27;, role=&#x27;sabnzbd&#x27;) and global_themepark_plugin_enabled)</span><span class="diff-line add">+                                          else {}),</span><span class="diff-line add">+                                          lookup(&#x27;role_var&#x27;, &#x27;_docker_labels_custom&#x27;, role=&#x27;sabnzbd&#x27;)) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Hostname</span><span class="diff-line del">-sabnzbd_docker_hostname: &quot;{{ sabnzbd_name }}&quot;</span><span class="diff-line add">+sabnzbd_role_docker_hostname: &quot;{{ sabnzbd_name }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Networks</span><span class="diff-line del">-sabnzbd_docker_networks_alias: &quot;{{ sabnzbd_name }}&quot;</span><span class="diff-line del">-sabnzbd_docker_networks_default: []</span><span class="diff-line del">-sabnzbd_docker_networks_custom: []</span><span class="diff-line del">-sabnzbd_docker_networks: &quot;{{ docker_networks_common</span><span class="diff-line del">-                             + sabnzbd_docker_networks_default</span><span class="diff-line del">-                             + sabnzbd_docker_networks_custom }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Capabilities</span><span class="diff-line del">-sabnzbd_docker_capabilities_default: []</span><span class="diff-line del">-sabnzbd_docker_capabilities_custom: []</span><span class="diff-line del">-sabnzbd_docker_capabilities: &quot;{{ sabnzbd_docker_capabilities_default</span><span class="diff-line del">-                                 + sabnzbd_docker_capabilities_custom }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Security Opts</span><span class="diff-line del">-sabnzbd_docker_security_opts_default: []</span><span class="diff-line del">-sabnzbd_docker_security_opts_custom: []</span><span class="diff-line del">-sabnzbd_docker_security_opts: &quot;{{ sabnzbd_docker_security_opts_default</span><span class="diff-line del">-                                  + sabnzbd_docker_security_opts_custom }}&quot;</span><span class="diff-line add">+sabnzbd_role_docker_networks_alias: &quot;{{ sabnzbd_name }}&quot;</span><span class="diff-line add">+sabnzbd_role_docker_networks_default: []</span><span class="diff-line add">+sabnzbd_role_docker_networks_custom: []</span><span class="diff-line add">+sabnzbd_role_docker_networks: &quot;{{ docker_networks_common</span><span class="diff-line add">+                                  + lookup(&#x27;role_var&#x27;, &#x27;_docker_networks_default&#x27;, role=&#x27;sabnzbd&#x27;)</span><span class="diff-line add">+                                  + lookup(&#x27;role_var&#x27;, &#x27;_docker_networks_custom&#x27;, role=&#x27;sabnzbd&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Restart Policy</span><span class="diff-line del">-sabnzbd_docker_restart_policy: unless-stopped</span><span class="diff-line add">+sabnzbd_role_docker_restart_policy: unless-stopped</span><span class="diff-line context"> </span><span class="diff-line context"> # State</span><span class="diff-line del">-sabnzbd_docker_state: started</span><span class="diff-line add">+sabnzbd_role_docker_state: started</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-329">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/sabnzbd/tasks/main.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -10,9 +10,9 @@</span><span class="diff-line context"> - name: Add DNS record</span><span class="diff-line context">   ansible.builtin.include_tasks: &quot;{{ resources_tasks_path }}/dns/tasker.yml&quot;</span><span class="diff-line context">   vars:</span><span class="diff-line del">-    dns_record: &quot;{{ lookup(&#x27;vars&#x27;, role_name + &#x27;_dns_record&#x27;) }}&quot;</span><span class="diff-line del">-    dns_zone: &quot;{{ lookup(&#x27;vars&#x27;, role_name + &#x27;_dns_zone&#x27;) }}&quot;</span><span class="diff-line del">-    dns_proxy: &quot;{{ lookup(&#x27;vars&#x27;, role_name + &#x27;_dns_proxy&#x27;) }}&quot;</span><span class="diff-line add">+    dns_record: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_dns_record&#x27;) }}&quot;</span><span class="diff-line add">+    dns_zone: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_dns_zone&#x27;) }}&quot;</span><span class="diff-line add">+    dns_proxy: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_dns_proxy&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Remove existing Docker container</span><span class="diff-line context">   ansible.builtin.include_tasks: &quot;{{ resources_tasks_path }}/docker/remove_docker_container.yml&quot;</span><span class="diff-line hunk">@@ -22,12 +22,12 @@</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Check if existing config exists</span><span class="diff-line context">   ansible.builtin.stat:</span><span class="diff-line del">-    path: &quot;{{ sabnzbd_paths_config_location }}&quot;</span><span class="diff-line add">+    path: &quot;{{ sabnzbd_role_paths_config_location }}&quot;</span><span class="diff-line context">   register: sabnzbd_conf_stat</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Create Docker container</span><span class="diff-line context">   ansible.builtin.include_tasks: &quot;{{ resources_tasks_path }}/docker/create_docker_container.yml&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Post-Install Tasks</span><span class="diff-line del">-  ansible.builtin.import_tasks: &quot;subtasks/post-install/main.yml&quot;</span><span class="diff-line add">+  ansible.builtin.include_tasks: &quot;subtasks/post-install/main.yml&quot;</span><span class="diff-line context">   when: (not continuous_integration)</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-330">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/sabnzbd/tasks/subtasks/post-install/main.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -8,9 +8,9 @@</span><span class="diff-line context"> #########################################################################</span><span class="diff-line context"> ---</span><span class="diff-line context"> - name: Post-Install | Settings Task</span><span class="diff-line del">-  ansible.builtin.import_tasks: &quot;settings.yml&quot;</span><span class="diff-line add">+  ansible.builtin.include_tasks: &quot;settings.yml&quot;</span><span class="diff-line context">   when: (not sabnzbd_conf_stat.stat.exists)</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Post-Install | Web Task</span><span class="diff-line del">-  ansible.builtin.import_tasks: &quot;web.yml&quot;</span><span class="diff-line add">+  ansible.builtin.include_tasks: &quot;web.yml&quot;</span><span class="diff-line context">   when: sabnzbd_conf_stat.stat.exists</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-331">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/sabnzbd/tasks/subtasks/post-install/settings.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -9,7 +9,7 @@</span><span class="diff-line context"> ---</span><span class="diff-line context"> - name: Post-Install | Settings | Wait for config file to be created</span><span class="diff-line context">   ansible.builtin.wait_for:</span><span class="diff-line del">-    path: &quot;{{ sabnzbd_paths_config_location }}&quot;</span><span class="diff-line add">+    path: &quot;{{ sabnzbd_role_paths_config_location }}&quot;</span><span class="diff-line context">     state: present</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Post-Install | Settings | Stop container</span><span class="diff-line hunk">@@ -21,7 +21,7 @@</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Post-Install | Settings | Update config settings</span><span class="diff-line context">   community.general.ini_file:</span><span class="diff-line del">-    path: &quot;{{ sabnzbd_paths_config_location }}&quot;</span><span class="diff-line add">+    path: &quot;{{ sabnzbd_role_paths_config_location }}&quot;</span><span class="diff-line context">     section: misc</span><span class="diff-line context">     option: &quot;{{ item.option }}&quot;</span><span class="diff-line context">     value: &quot;{{ item.value }}&quot;</span><span class="diff-line hunk">@@ -29,7 +29,7 @@</span><span class="diff-line context">     owner: &quot;{{ user.name }}&quot;</span><span class="diff-line context">     group: &quot;{{ user.name }}&quot;</span><span class="diff-line context">     mode: &quot;0664&quot;</span><span class="diff-line del">-  loop: &quot;{{ sabnzbd_config_settings_list }}&quot;</span><span class="diff-line add">+  loop: &quot;{{ sabnzbd_role_config_settings_list }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Post-Install | Settings | Start container</span><span class="diff-line context">   ansible.builtin.include_tasks: &quot;{{ resources_tasks_path }}/docker/start_docker_container.yml&quot;</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-332">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/sabnzbd/tasks/subtasks/post-install/web.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -9,7 +9,7 @@</span><span class="diff-line context"> ---</span><span class="diff-line context"> - name: Post-Install | Web | Wait for config file to be created</span><span class="diff-line context">   ansible.builtin.wait_for:</span><span class="diff-line del">-    path: &quot;{{ sabnzbd_paths_config_location }}&quot;</span><span class="diff-line add">+    path: &quot;{{ sabnzbd_role_paths_config_location }}&quot;</span><span class="diff-line context">     state: present</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Post-Install | Web | Stop container</span><span class="diff-line hunk">@@ -21,7 +21,7 @@</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Post-Install | Web | Update config settings</span><span class="diff-line context">   community.general.ini_file:</span><span class="diff-line del">-    path: &quot;{{ sabnzbd_paths_config_location }}&quot;</span><span class="diff-line add">+    path: &quot;{{ sabnzbd_role_paths_config_location }}&quot;</span><span class="diff-line context">     section: misc</span><span class="diff-line context">     option: &quot;{{ item.option }}&quot;</span><span class="diff-line context">     value: &quot;{{ item.value }}&quot;</span><span class="diff-line hunk">@@ -29,7 +29,7 @@</span><span class="diff-line context">     owner: &quot;{{ user.name }}&quot;</span><span class="diff-line context">     group: &quot;{{ user.name }}&quot;</span><span class="diff-line context">     mode: &quot;0664&quot;</span><span class="diff-line del">-  loop: &quot;{{ sabnzbd_config_settings_web }}&quot;</span><span class="diff-line add">+  loop: &quot;{{ sabnzbd_role_config_settings_web }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Post-Install | Web | Start container</span><span class="diff-line context">   ansible.builtin.include_tasks: &quot;{{ resources_tasks_path }}/docker/start_docker_container.yml&quot;</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-333">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/saltbox_mod/tasks/main.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -16,15 +16,14 @@</span><span class="diff-line context">     mode: &quot;0775&quot;</span><span class="diff-line context">     recurse: true</span><span class="diff-line context">   with_items:</span><span class="diff-line del">-    - /opt/saltbox_mod</span><span class="diff-line add">+    - &quot;{{ server_appdata_path }}/saltbox_mod&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Clone saltbox_mod repo</span><span class="diff-line context">   ansible.builtin.git:</span><span class="diff-line context">     repo: &quot;{{ saltbox_mod_repo }}&quot;</span><span class="diff-line del">-    dest: /opt/saltbox_mod</span><span class="diff-line add">+    dest: &quot;{{ server_appdata_path }}/saltbox_mod&quot;</span><span class="diff-line context">     clone: true</span><span class="diff-line context">     version: &quot;{{ saltbox_mod_branch }}&quot;</span><span class="diff-line context">     force: &quot;{{ saltbox_mod_force_overwrite }}&quot;</span><span class="diff-line context">   become: true</span><span class="diff-line context">   become_user: &quot;{{ user.name }}&quot;</span><span class="diff-line del">-  ignore_errors: true</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-334">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/sandbox/tasks/main.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -9,7 +9,7 @@</span><span class="diff-line context"> ---</span><span class="diff-line context"> - name: Create Sandbox directory</span><span class="diff-line context">   ansible.builtin.file:</span><span class="diff-line del">-    path: &quot;/opt/sandbox&quot;</span><span class="diff-line add">+    path: &quot;{{ server_appdata_path }}/sandbox&quot;</span><span class="diff-line context">     state: directory</span><span class="diff-line context">     owner: &quot;{{ user.name }}&quot;</span><span class="diff-line context">     group: &quot;{{ user.name }}&quot;</span><span class="diff-line hunk">@@ -18,13 +18,13 @@</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Check if git repository exists</span><span class="diff-line context">   ansible.builtin.stat:</span><span class="diff-line del">-    path: &quot;/opt/sandbox/.git&quot;</span><span class="diff-line add">+    path: &quot;{{ server_appdata_path }}/sandbox/.git&quot;</span><span class="diff-line context">   register: git_repo_check</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Clone Sandbox repo &#x27;HEAD&#x27;</span><span class="diff-line context">   ansible.builtin.git:</span><span class="diff-line context">     repo: https://github.com/saltyorg/sandbox.git</span><span class="diff-line del">-    dest: /opt/sandbox</span><span class="diff-line add">+    dest: &quot;{{ server_appdata_path }}/sandbox&quot;</span><span class="diff-line context">     clone: true</span><span class="diff-line context">     version: HEAD</span><span class="diff-line context">     force: true</span><span class="diff-line hunk">@@ -37,7 +37,7 @@</span><span class="diff-line context"> - name: Clone Sandbox repo &#x27;master&#x27;</span><span class="diff-line context">   ansible.builtin.git:</span><span class="diff-line context">     repo: https://github.com/saltyorg/sandbox.git</span><span class="diff-line del">-    dest: /opt/sandbox</span><span class="diff-line add">+    dest: &quot;{{ server_appdata_path }}/sandbox&quot;</span><span class="diff-line context">     clone: true</span><span class="diff-line context">     version: master</span><span class="diff-line context">     force: true</span><span class="diff-line hunk">@@ -50,15 +50,15 @@</span><span class="diff-line context"> - name: Import default files when missing</span><span class="diff-line context">   ansible.builtin.copy:</span><span class="diff-line context">     src: &quot;{{ item }}&quot;</span><span class="diff-line del">-    dest: &quot;/opt/sandbox/{{ (item | basename | splitext)[0] }}&quot;</span><span class="diff-line add">+    dest: &quot;{{ server_appdata_path }}/sandbox/{{ (item | basename | splitext)[0] }}&quot;</span><span class="diff-line context">     owner: &quot;{{ user.name }}&quot;</span><span class="diff-line context">     group: &quot;{{ user.name }}&quot;</span><span class="diff-line context">     mode: &quot;0664&quot;</span><span class="diff-line context">     force: false</span><span class="diff-line context">   with_fileglob:</span><span class="diff-line del">-    - /opt/sandbox/defaults/*.*</span><span class="diff-line add">+    - &quot;{{ server_appdata_path }}/sandbox/defaults/*.*&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Activate Git Hooks</span><span class="diff-line del">-  ansible.builtin.shell: bash /opt/sandbox/bin/git/init-hooks</span><span class="diff-line add">+  ansible.builtin.shell: bash {{ server_appdata_path }}/sandbox/bin/git/init-hooks</span><span class="diff-line context">   args:</span><span class="diff-line del">-    chdir: &quot;/opt/sandbox&quot;</span><span class="diff-line add">+    chdir: &quot;{{ server_appdata_path }}/sandbox&quot;</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-335">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/sanity_check/tasks/main.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -8,31 +8,31 @@</span><span class="diff-line context"> #########################################################################</span><span class="diff-line context"> ---</span><span class="diff-line context"> - name: System Check</span><span class="diff-line del">-  ansible.builtin.import_tasks: &quot;subtasks/01_system.yml&quot;</span><span class="diff-line add">+  ansible.builtin.include_tasks: &quot;subtasks/01_system.yml&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Ansible Version Check</span><span class="diff-line del">-  ansible.builtin.import_tasks: &quot;subtasks/02_ansible_version.yml&quot;</span><span class="diff-line add">+  ansible.builtin.include_tasks: &quot;subtasks/02_ansible_version.yml&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Python Version Check</span><span class="diff-line del">-  ansible.builtin.import_tasks: &quot;subtasks/03_python_version.yml&quot;</span><span class="diff-line add">+  ansible.builtin.include_tasks: &quot;subtasks/03_python_version.yml&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: UFW Check</span><span class="diff-line context">   ansible.builtin.include_tasks: &quot;subtasks/04_ufw.yml&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Backup Lock Check</span><span class="diff-line del">-  ansible.builtin.import_tasks: &quot;subtasks/05_backup.yml&quot;</span><span class="diff-line add">+  ansible.builtin.include_tasks: &quot;subtasks/05_backup.yml&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Touch Logs</span><span class="diff-line del">-  ansible.builtin.import_tasks: &quot;subtasks/06_logs.yml&quot;</span><span class="diff-line add">+  ansible.builtin.include_tasks: &quot;subtasks/06_logs.yml&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Create Temp Folder</span><span class="diff-line del">-  ansible.builtin.import_tasks: &quot;subtasks/07_tmp.yml&quot;</span><span class="diff-line add">+  ansible.builtin.include_tasks: &quot;subtasks/07_tmp.yml&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Skipped Tags Check</span><span class="diff-line del">-  ansible.builtin.import_tasks: &quot;subtasks/08_skipped_tags.yml&quot;</span><span class="diff-line add">+  ansible.builtin.include_tasks: &quot;subtasks/08_skipped_tags.yml&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Repository Check</span><span class="diff-line del">-  ansible.builtin.import_tasks: &quot;subtasks/09_repo.yml&quot;</span><span class="diff-line add">+  ansible.builtin.include_tasks: &quot;subtasks/09_repo.yml&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: CPU Check</span><span class="diff-line del">-  ansible.builtin.import_tasks: &quot;subtasks/10_cpu.yml&quot;</span><span class="diff-line add">+  ansible.builtin.include_tasks: &quot;subtasks/10_cpu.yml&quot;</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-336">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/sanity_check/tasks/subtasks/01_system.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -10,11 +10,11 @@</span><span class="diff-line context"> - name: System | Ensure Ansible is running on Ubuntu 20.04+</span><span class="diff-line context">   ansible.builtin.assert:</span><span class="diff-line context">     that:</span><span class="diff-line del">-      - ((ansible_distribution == &#x27;Ubuntu&#x27;) and (ansible_facts[&#x27;distribution_version&#x27;] is version(&#x27;20.04&#x27;, &#x27;&gt;=&#x27;)))</span><span class="diff-line add">+      - ((ansible_facts[&#x27;distribution&#x27;] == &#x27;Ubuntu&#x27;) and (ansible_facts[&#x27;distribution_version&#x27;] is version(&#x27;20.04&#x27;, &#x27;&gt;=&#x27;)))</span><span class="diff-line context">     fail_msg: &gt;-</span><span class="diff-line context">       Saltbox was designed for use on Ubuntu servers running version 20.04+.</span><span class="diff-line context">     success_msg: &gt;-</span><span class="diff-line del">-      System is running {{ ansible_lsb.description if ansible_lsb is defined else (ansible_distribution + &#x27; &#x27; + ansible_distribution_version) }}.</span><span class="diff-line add">+      System is running {{ ansible_facts[&#x27;lsb&#x27;][&#x27;description&#x27;] }}.</span><span class="diff-line context"> </span><span class="diff-line context"> - name: System | Virtualization Check</span><span class="diff-line context">   ansible.builtin.command: &quot;systemd-detect-virt&quot;</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-337">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/sanity_check/tasks/subtasks/03_python_version.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -9,4 +9,4 @@</span><span class="diff-line context"> ---</span><span class="diff-line context"> - name: Python Version | Print Python version</span><span class="diff-line context">   ansible.builtin.debug:</span><span class="diff-line del">-    msg: &quot;Ansible running on Python version: {{ ansible_python_version }}&quot;</span><span class="diff-line add">+    msg: &quot;Ansible running on Python version: {{ ansible_facts[&#x27;python_version&#x27;] }}&quot;</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-338">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/sanity_check/tasks/subtasks/05_backup.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -15,7 +15,7 @@</span><span class="diff-line context"> # Age in hours</span><span class="diff-line context"> - name: Backup | Get age of &#x27;{{ sanity_check_backup_lockfile_path | basename }}&#x27; file</span><span class="diff-line context">   ansible.builtin.set_fact:</span><span class="diff-line del">-    backup_lock_age: &quot;{{ ((ansible_date_time.epoch | float - backup_lock.stat.mtime) / 3600) | int }}&quot;</span><span class="diff-line add">+    backup_lock_age: &quot;{{ ((ansible_facts[&#x27;date_time&#x27;][&#x27;epoch&#x27;] | float - backup_lock.stat.mtime) / 3600) | int }}&quot;</span><span class="diff-line context">   when: backup_lock.stat.exists</span><span class="diff-line context"> </span><span class="diff-line context"> # Delete if older than 2 hours.</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-339">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/scripts/tasks/main.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -9,7 +9,7 @@</span><span class="diff-line context"> ---</span><span class="diff-line context"> - name: Install common packages</span><span class="diff-line context">   ansible.builtin.apt:</span><span class="diff-line del">-    state: present</span><span class="diff-line add">+    state: latest</span><span class="diff-line context">     name:</span><span class="diff-line context">       - jq</span><span class="diff-line context">       - figlet</span><span class="diff-line hunk">@@ -26,21 +26,19 @@</span><span class="diff-line context">     mode: &quot;0775&quot;</span><span class="diff-line context">     recurse: true</span><span class="diff-line context">   with_items:</span><span class="diff-line del">-    - /opt/scripts</span><span class="diff-line del">-    - /opt/scripts/docker</span><span class="diff-line del">-    - /opt/scripts/frontail</span><span class="diff-line del">-    - /opt/scripts/nzbget</span><span class="diff-line del">-    - /opt/scripts/sabnzbd</span><span class="diff-line del">-    - /opt/scripts/plex</span><span class="diff-line del">-    - /opt/scripts/plex_autoscan</span><span class="diff-line del">-    - /opt/scripts/tautulli</span><span class="diff-line del">-    - /opt/scripts/torrents</span><span class="diff-line del">-    - /opt/scripts/rclone</span><span class="diff-line add">+    - &quot;{{ server_appdata_path }}/scripts&quot;</span><span class="diff-line add">+    - &quot;{{ server_appdata_path }}/scripts/frontail&quot;</span><span class="diff-line add">+    - &quot;{{ server_appdata_path }}/scripts/nzbget&quot;</span><span class="diff-line add">+    - &quot;{{ server_appdata_path }}/scripts/sabnzbd&quot;</span><span class="diff-line add">+    - &quot;{{ server_appdata_path }}/scripts/plex&quot;</span><span class="diff-line add">+    - &quot;{{ server_appdata_path }}/scripts/tautulli&quot;</span><span class="diff-line add">+    - &quot;{{ server_appdata_path }}/scripts/torrents&quot;</span><span class="diff-line add">+    - &quot;{{ server_appdata_path }}/scripts/rclone&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Import &#x27;arrpush.py&#x27;</span><span class="diff-line context">   ansible.builtin.get_url:</span><span class="diff-line context">     url: &quot;https://raw.githubusercontent.com/l3uddz/arrpush/master/arrpush.py&quot;</span><span class="diff-line del">-    dest: &quot;/opt/scripts/torrents/arrpush.py&quot;</span><span class="diff-line add">+    dest: &quot;{{ server_appdata_path }}/scripts/torrents/arrpush.py&quot;</span><span class="diff-line context">     owner: &quot;{{ user.name }}&quot;</span><span class="diff-line context">     group: &quot;{{ user.name }}&quot;</span><span class="diff-line context">     mode: &quot;0775&quot;</span><span class="diff-line hunk">@@ -57,7 +55,7 @@</span><span class="diff-line context"> - name: Import &#x27;TorrentCleanup.py&#x27;</span><span class="diff-line context">   ansible.builtin.get_url:</span><span class="diff-line context">     url: &quot;https://raw.githubusercontent.com/l3uddz/TorrentCleanup/master/TorrentCleanup.py&quot;</span><span class="diff-line del">-    dest: &quot;/opt/scripts/torrents/TorrentCleanup.py&quot;</span><span class="diff-line add">+    dest: &quot;{{ server_appdata_path }}/scripts/torrents/TorrentCleanup.py&quot;</span><span class="diff-line context">     owner: &quot;{{ user.name }}&quot;</span><span class="diff-line context">     group: &quot;{{ user.name }}&quot;</span><span class="diff-line context">     mode: &quot;0775&quot;</span><span class="diff-line hunk">@@ -74,7 +72,7 @@</span><span class="diff-line context"> - name: Import &#x27;plex_trash_fixer.py&#x27;</span><span class="diff-line context">   ansible.builtin.get_url:</span><span class="diff-line context">     url: &quot;https://raw.githubusercontent.com/l3uddz/plex_trash_fixer/master/plex_trash_fixer.py&quot;</span><span class="diff-line del">-    dest: &quot;/opt/scripts/plex/plex_trash_fixer.py&quot;</span><span class="diff-line add">+    dest: &quot;{{ server_appdata_path }}/scripts/plex/plex_trash_fixer.py&quot;</span><span class="diff-line context">     owner: &quot;{{ user.name }}&quot;</span><span class="diff-line context">     group: &quot;{{ user.name }}&quot;</span><span class="diff-line context">     mode: &quot;0775&quot;</span><span class="diff-line hunk">@@ -88,36 +86,9 @@</span><span class="diff-line context">   delay: 10</span><span class="diff-line context">   ignore_errors: true</span><span class="diff-line context"> </span><span class="diff-line del">-- name: Import &#x27;plex_autoscan_url.sh&#x27;</span><span class="diff-line del">-  ansible.builtin.copy:</span><span class="diff-line del">-    src: &quot;plex_autoscan_url.sh&quot;</span><span class="diff-line del">-    dest: &quot;/opt/scripts/plex_autoscan/plex_autoscan_url.sh&quot;</span><span class="diff-line del">-    owner: &quot;{{ user.name }}&quot;</span><span class="diff-line del">-    group: &quot;{{ user.name }}&quot;</span><span class="diff-line del">-    mode: &quot;0775&quot;</span><span class="diff-line del">-    force: true</span><span class="diff-line del">-</span><span class="diff-line del">-- name: Import &#x27;plexsql.sh&#x27;</span><span class="diff-line del">-  ansible.builtin.copy:</span><span class="diff-line del">-    src: &quot;plexsql.sh&quot;</span><span class="diff-line del">-    dest: &quot;/opt/scripts/plex/plexsql.sh&quot;</span><span class="diff-line del">-    owner: &quot;{{ user.name }}&quot;</span><span class="diff-line del">-    group: &quot;{{ user.name }}&quot;</span><span class="diff-line del">-    mode: &quot;0775&quot;</span><span class="diff-line del">-    force: true</span><span class="diff-line del">-</span><span class="diff-line del">-- name: Import &#x27;restart_containers.sh&#x27;</span><span class="diff-line del">-  ansible.builtin.copy:</span><span class="diff-line del">-    src: &quot;restart_containers.sh&quot;</span><span class="diff-line del">-    dest: &quot;/opt/scripts/docker/restart_containers.sh&quot;</span><span class="diff-line del">-    owner: &quot;{{ user.name }}&quot;</span><span class="diff-line del">-    group: &quot;{{ user.name }}&quot;</span><span class="diff-line del">-    mode: &quot;0775&quot;</span><span class="diff-line del">-    force: true</span><span class="diff-line del">-</span><span class="diff-line context"> - name: Check if &#x27;frontail_custom_preset.json&#x27; exists</span><span class="diff-line context">   ansible.builtin.stat:</span><span class="diff-line del">-    path: &quot;/opt/scripts/frontail/frontail_custom_preset.json&quot;</span><span class="diff-line add">+    path: &quot;{{ server_appdata_path }}/scripts/frontail/frontail_custom_preset.json&quot;</span><span class="diff-line context">     get_attributes: false</span><span class="diff-line context">     get_checksum: false</span><span class="diff-line context">     get_mime: false</span><span class="diff-line hunk">@@ -126,7 +97,7 @@</span><span class="diff-line context"> - name: Import &#x27;frontail_custom_preset.json&#x27;</span><span class="diff-line context">   ansible.builtin.copy:</span><span class="diff-line context">     src: &quot;frontail_custom_preset.json&quot;</span><span class="diff-line del">-    dest: &quot;/opt/scripts/frontail/frontail_custom_preset.json&quot;</span><span class="diff-line add">+    dest: &quot;{{ server_appdata_path }}/scripts/frontail/frontail_custom_preset.json&quot;</span><span class="diff-line context">     owner: &quot;{{ user.name }}&quot;</span><span class="diff-line context">     group: &quot;{{ user.name }}&quot;</span><span class="diff-line context">     mode: &quot;0775&quot;</span><span class="diff-line hunk">@@ -136,7 +107,7 @@</span><span class="diff-line context"> - name: Import &#x27;sync_torrents_to_rclone_remote.sh&#x27;</span><span class="diff-line context">   ansible.builtin.template:</span><span class="diff-line context">     src: &quot;sync_torrents_to_rclone_remote.sh.j2&quot;</span><span class="diff-line del">-    dest: &quot;/opt/scripts/rclone/sync_torrents_to_rclone_remote.sh&quot;</span><span class="diff-line add">+    dest: &quot;{{ server_appdata_path }}/scripts/rclone/sync_torrents_to_rclone_remote.sh&quot;</span><span class="diff-line context">     owner: &quot;{{ user.name }}&quot;</span><span class="diff-line context">     group: &quot;{{ user.name }}&quot;</span><span class="diff-line context">     mode: &quot;0775&quot;</span><span class="diff-line hunk">@@ -146,7 +117,7 @@</span><span class="diff-line context"> - name: Import &#x27;download_torrents_from_rclone_remote.sh&#x27;</span><span class="diff-line context">   ansible.builtin.template:</span><span class="diff-line context">     src: &quot;download_torrents_from_rclone_remote.sh.j2&quot;</span><span class="diff-line del">-    dest: &quot;/opt/scripts/rclone/download_torrents_from_rclone_remote.sh&quot;</span><span class="diff-line add">+    dest: &quot;{{ server_appdata_path }}/scripts/rclone/download_torrents_from_rclone_remote.sh&quot;</span><span class="diff-line context">     owner: &quot;{{ user.name }}&quot;</span><span class="diff-line context">     group: &quot;{{ user.name }}&quot;</span><span class="diff-line context">     mode: &quot;0775&quot;</span><span class="diff-line hunk">@@ -156,7 +127,7 @@</span><span class="diff-line context"> - name: Import &#x27;StickyDownloadQueue.py&#x27;</span><span class="diff-line context">   ansible.builtin.get_url:</span><span class="diff-line context">     url: &quot;https://raw.githubusercontent.com/Hidendra/nzbget-sticky-download-queue/master/StickyDownloadQueue.py&quot;</span><span class="diff-line del">-    dest: &quot;/opt/scripts/nzbget/StickyDownloadQueue.py&quot;</span><span class="diff-line add">+    dest: &quot;{{ server_appdata_path }}/scripts/nzbget/StickyDownloadQueue.py&quot;</span><span class="diff-line context">     owner: &quot;{{ user.name }}&quot;</span><span class="diff-line context">     group: &quot;{{ user.name }}&quot;</span><span class="diff-line context">     mode: &quot;0775&quot;</span><span class="diff-line hunk">@@ -173,7 +144,7 @@</span><span class="diff-line context"> - name: Import &#x27;CappedDownloadQueue.py&#x27;</span><span class="diff-line context">   ansible.builtin.get_url:</span><span class="diff-line context">     url: &quot;https://raw.githubusercontent.com/Hidendra/nzbget-capped-download-queue/master/CappedDownloadQueue.py&quot;</span><span class="diff-line del">-    dest: &quot;/opt/scripts/nzbget/CappedDownloadQueue.py&quot;</span><span class="diff-line add">+    dest: &quot;{{ server_appdata_path }}/scripts/nzbget/CappedDownloadQueue.py&quot;</span><span class="diff-line context">     owner: &quot;{{ user.name }}&quot;</span><span class="diff-line context">     group: &quot;{{ user.name }}&quot;</span><span class="diff-line context">     mode: &quot;0775&quot;</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-340">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/scripts/templates/download_torrents_from_rclone_remote.sh.j2</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -13,7 +13,7 @@</span><span class="diff-line context"> </span><span class="diff-line context"> if ! /usr/bin/screen -list | /bin/grep -q &quot;torrents_download&quot;; then</span><span class="diff-line context"> </span><span class="diff-line del">-	/bin/rm -rfv /opt/scripts/rclone/download_torrents_from_rclone_remote.log</span><span class="diff-line add">+	/bin/rm -rfv {{ server_appdata_path }}/scripts/rclone/download_torrents_from_rclone_remote.log</span><span class="diff-line context"> </span><span class="diff-line context"> 	/usr/bin/screen -dmS torrents_download /usr/bin/rclone copy \</span><span class="diff-line context"> 		--user-agent=&#x27;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/74.0.3729.131 Safari/537.36&#x27; \</span><span class="diff-line hunk">@@ -24,7 +24,7 @@</span><span class="diff-line context"> 		--checkers=16 \</span><span class="diff-line context"> 		--drive-chunk-size=128M \</span><span class="diff-line context"> 		--fast-list \</span><span class="diff-line del">-		--log-file=/opt/scripts/rclone/download_torrents_from_rclone_remote.log \</span><span class="diff-line add">+		--log-file={{ server_appdata_path }}/scripts/rclone/download_torrents_from_rclone_remote.log \</span><span class="diff-line context"> 		{{ rclone_first_remote_name }}:/downloads/torrents {{ downloads_torrents_path }}</span><span class="diff-line context"> </span><span class="diff-line context"> fi</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-341">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/scripts/templates/sync_torrents_to_rclone_remote.sh.j2</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -12,7 +12,7 @@</span><span class="diff-line context"> </span><span class="diff-line context"> if ! /usr/bin/screen -list | /bin/grep -q &quot;torrents_sync&quot;; then</span><span class="diff-line context"> </span><span class="diff-line del">-	/bin/rm -rfv /opt/scripts/rclone/sync_torrents_to_rclone_remote.log</span><span class="diff-line add">+	/bin/rm -rfv {{ server_appdata_path }}/scripts/rclone/sync_torrents_to_rclone_remote.log</span><span class="diff-line context"> </span><span class="diff-line context"> 	/usr/bin/screen -dmS torrents_sync /usr/bin/rclone sync \</span><span class="diff-line context"> 		--user-agent=&#x27;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/74.0.3729.131 Safari/537.36&#x27; \</span><span class="diff-line hunk">@@ -23,7 +23,7 @@</span><span class="diff-line context"> 		--checkers=16 \</span><span class="diff-line context"> 		--drive-chunk-size=128M \</span><span class="diff-line context"> 		--fast-list \</span><span class="diff-line del">-		--log-file=/opt/scripts/rclone/sync_torrents_to_rclone_remote.log \</span><span class="diff-line add">+		--log-file={{ server_appdata_path }}/scripts/rclone/sync_torrents_to_rclone_remote.log \</span><span class="diff-line context"> 		{{ downloads_torrents_path }} {{ rclone_first_remote_name }}:/downloads/torrents</span><span class="diff-line context"> </span><span class="diff-line context"> fi</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-342">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/scrutiny/defaults/main.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -17,130 +17,87 @@</span><span class="diff-line context"> # Paths</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-scrutiny_paths_folder: &quot;{{ scrutiny_name }}&quot;</span><span class="diff-line del">-scrutiny_paths_location: &quot;{{ server_appdata_path }}/{{ scrutiny_paths_folder }}&quot;</span><span class="diff-line del">-scrutiny_paths_folders_list:</span><span class="diff-line del">-  - &quot;{{ scrutiny_paths_location }}&quot;</span><span class="diff-line del">-  - &quot;{{ scrutiny_paths_location }}/scrutiny&quot;</span><span class="diff-line del">-  - &quot;{{ scrutiny_paths_location }}/influxdb&quot;</span><span class="diff-line add">+scrutiny_role_paths_folder: &quot;{{ scrutiny_name }}&quot;</span><span class="diff-line add">+scrutiny_role_paths_location: &quot;{{ server_appdata_path }}/{{ scrutiny_role_paths_folder }}&quot;</span><span class="diff-line add">+scrutiny_role_paths_folders_list:</span><span class="diff-line add">+  - &quot;{{ scrutiny_role_paths_location }}&quot;</span><span class="diff-line add">+  - &quot;{{ scrutiny_role_paths_location }}/scrutiny&quot;</span><span class="diff-line add">+  - &quot;{{ scrutiny_role_paths_location }}/influxdb&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # Web</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-scrutiny_web_subdomain: &quot;{{ scrutiny_name }}&quot;</span><span class="diff-line del">-scrutiny_web_domain: &quot;{{ user.domain }}&quot;</span><span class="diff-line del">-scrutiny_web_port: &quot;8080&quot;</span><span class="diff-line del">-scrutiny_web_url: &quot;{{ &#x27;https://&#x27; + (scrutiny_web_subdomain + &#x27;.&#x27; + scrutiny_web_domain</span><span class="diff-line del">-                   if (scrutiny_web_subdomain | length &gt; 0)</span><span class="diff-line del">-                   else scrutiny_web_domain) }}&quot;</span><span class="diff-line add">+scrutiny_role_web_subdomain: &quot;{{ scrutiny_name }}&quot;</span><span class="diff-line add">+scrutiny_role_web_domain: &quot;{{ user.domain }}&quot;</span><span class="diff-line add">+scrutiny_role_web_port: &quot;8080&quot;</span><span class="diff-line add">+scrutiny_role_web_url: &quot;{{ &#x27;https://&#x27; + (lookup(&#x27;role_var&#x27;, &#x27;_web_subdomain&#x27;, role=&#x27;scrutiny&#x27;) + &#x27;.&#x27; + lookup(&#x27;role_var&#x27;, &#x27;_web_domain&#x27;, role=&#x27;scrutiny&#x27;)</span><span class="diff-line add">+                        if (lookup(&#x27;role_var&#x27;, &#x27;_web_subdomain&#x27;, role=&#x27;scrutiny&#x27;) | length &gt; 0)</span><span class="diff-line add">+                        else lookup(&#x27;role_var&#x27;, &#x27;_web_domain&#x27;, role=&#x27;scrutiny&#x27;)) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # DNS</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-scrutiny_dns_record: &quot;{{ scrutiny_web_subdomain }}&quot;</span><span class="diff-line del">-scrutiny_dns_zone: &quot;{{ scrutiny_web_domain }}&quot;</span><span class="diff-line del">-scrutiny_dns_proxy: &quot;{{ dns.proxied }}&quot;</span><span class="diff-line add">+scrutiny_role_dns_record: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_web_subdomain&#x27;, role=&#x27;scrutiny&#x27;) }}&quot;</span><span class="diff-line add">+scrutiny_role_dns_zone: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_web_domain&#x27;, role=&#x27;scrutiny&#x27;) }}&quot;</span><span class="diff-line add">+scrutiny_role_dns_proxy: &quot;{{ dns_proxied }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # Traefik</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-scrutiny_traefik_sso_middleware: &quot;{{ traefik_default_sso_middleware }}&quot;</span><span class="diff-line del">-scrutiny_traefik_middleware_default: &quot;{{ traefik_default_middleware }}&quot;</span><span class="diff-line del">-scrutiny_traefik_middleware_custom: &quot;&quot;</span><span class="diff-line del">-scrutiny_traefik_certresolver: &quot;{{ traefik_default_certresolver }}&quot;</span><span class="diff-line del">-scrutiny_traefik_enabled: true</span><span class="diff-line add">+scrutiny_role_traefik_sso_middleware: &quot;{{ traefik_default_sso_middleware }}&quot;</span><span class="diff-line add">+scrutiny_role_traefik_middleware_default: &quot;{{ traefik_default_middleware }}&quot;</span><span class="diff-line add">+scrutiny_role_traefik_middleware_custom: &quot;&quot;</span><span class="diff-line add">+scrutiny_role_traefik_certresolver: &quot;{{ traefik_default_certresolver }}&quot;</span><span class="diff-line add">+scrutiny_role_traefik_enabled: true</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # Docker</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line context"> # Container</span><span class="diff-line del">-scrutiny_docker_container: &quot;{{ scrutiny_name }}&quot;</span><span class="diff-line add">+scrutiny_role_docker_container: &quot;{{ scrutiny_name }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Image</span><span class="diff-line del">-scrutiny_docker_image_pull: true</span><span class="diff-line del">-scrutiny_docker_image_tag: &quot;master-omnibus&quot;</span><span class="diff-line del">-scrutiny_docker_image: &quot;ghcr.io/analogj/scrutiny:{{ scrutiny_docker_image_tag }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Ports</span><span class="diff-line del">-scrutiny_docker_ports_defaults: []</span><span class="diff-line del">-scrutiny_docker_ports_custom: []</span><span class="diff-line del">-scrutiny_docker_ports: &quot;{{ scrutiny_docker_ports_defaults</span><span class="diff-line del">-                           + scrutiny_docker_ports_custom }}&quot;</span><span class="diff-line add">+scrutiny_role_docker_image_pull: true</span><span class="diff-line add">+scrutiny_role_docker_image_repo: &quot;ghcr.io/analogj/scrutiny&quot;</span><span class="diff-line add">+scrutiny_role_docker_image_tag: &quot;master-omnibus&quot;</span><span class="diff-line add">+scrutiny_role_docker_image: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_image_repo&#x27;, role=&#x27;scrutiny&#x27;) }}:{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_image_tag&#x27;, role=&#x27;scrutiny&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Envs</span><span class="diff-line del">-scrutiny_docker_envs_default:</span><span class="diff-line add">+scrutiny_role_docker_envs_default:</span><span class="diff-line context">   TZ: &quot;{{ tz }}&quot;</span><span class="diff-line del">-scrutiny_docker_envs_custom: {}</span><span class="diff-line del">-scrutiny_docker_envs: &quot;{{ scrutiny_docker_envs_default</span><span class="diff-line del">-                          | combine(scrutiny_docker_envs_custom) }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Commands</span><span class="diff-line del">-scrutiny_docker_commands_default: []</span><span class="diff-line del">-scrutiny_docker_commands_custom: []</span><span class="diff-line del">-scrutiny_docker_commands: &quot;{{ scrutiny_docker_commands_default</span><span class="diff-line del">-                              + scrutiny_docker_commands_custom }}&quot;</span><span class="diff-line add">+scrutiny_role_docker_envs_custom: {}</span><span class="diff-line add">+scrutiny_role_docker_envs: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_envs_default&#x27;, role=&#x27;scrutiny&#x27;)</span><span class="diff-line add">+                               | combine(lookup(&#x27;role_var&#x27;, &#x27;_docker_envs_custom&#x27;, role=&#x27;scrutiny&#x27;)) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Volumes</span><span class="diff-line del">-scrutiny_docker_volumes_default:</span><span class="diff-line del">-  - &quot;{{ scrutiny_paths_location }}/scrutiny:/opt/scrutiny/config&quot;</span><span class="diff-line del">-  - &quot;{{ scrutiny_paths_location }}/influxdb:/opt/scrutiny/influxdb&quot;</span><span class="diff-line add">+scrutiny_role_docker_volumes_default:</span><span class="diff-line add">+  - &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_location&#x27;, role=&#x27;scrutiny&#x27;) }}/scrutiny:/opt/scrutiny/config&quot;</span><span class="diff-line add">+  - &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_location&#x27;, role=&#x27;scrutiny&#x27;) }}/influxdb:/opt/scrutiny/influxdb&quot;</span><span class="diff-line context">   - &quot;/run/udev:/run/udev:ro&quot;</span><span class="diff-line del">-scrutiny_docker_volumes_custom: []</span><span class="diff-line del">-scrutiny_docker_volumes: &quot;{{ scrutiny_docker_volumes_default</span><span class="diff-line del">-                             + scrutiny_docker_volumes_custom }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Devices</span><span class="diff-line del">-scrutiny_docker_devices_default: []</span><span class="diff-line del">-scrutiny_docker_devices_custom: []</span><span class="diff-line del">-scrutiny_docker_devices: &quot;{{ scrutiny_docker_devices_default</span><span class="diff-line del">-                             + scrutiny_docker_devices_custom }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Hosts</span><span class="diff-line del">-scrutiny_docker_hosts_default: {}</span><span class="diff-line del">-scrutiny_docker_hosts_custom: {}</span><span class="diff-line del">-scrutiny_docker_hosts: &quot;{{ docker_hosts_common</span><span class="diff-line del">-                           | combine(scrutiny_docker_hosts_default)</span><span class="diff-line del">-                           | combine(scrutiny_docker_hosts_custom) }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Labels</span><span class="diff-line del">-scrutiny_docker_labels_default: {}</span><span class="diff-line del">-scrutiny_docker_labels_custom: {}</span><span class="diff-line del">-scrutiny_docker_labels: &quot;{{ docker_labels_common</span><span class="diff-line del">-                            | combine(scrutiny_docker_labels_default)</span><span class="diff-line del">-                            | combine(scrutiny_docker_labels_custom) }}&quot;</span><span class="diff-line add">+scrutiny_role_docker_volumes_custom: []</span><span class="diff-line add">+scrutiny_role_docker_volumes: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_volumes_default&#x27;, role=&#x27;scrutiny&#x27;)</span><span class="diff-line add">+                                  + lookup(&#x27;role_var&#x27;, &#x27;_docker_volumes_custom&#x27;, role=&#x27;scrutiny&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Hostname</span><span class="diff-line del">-scrutiny_docker_hostname: &quot;{{ scrutiny_name }}&quot;</span><span class="diff-line add">+scrutiny_role_docker_hostname: &quot;{{ scrutiny_name }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Networks</span><span class="diff-line del">-scrutiny_docker_networks_alias: &quot;{{ scrutiny_name }}&quot;</span><span class="diff-line del">-scrutiny_docker_networks_default: []</span><span class="diff-line del">-scrutiny_docker_networks_custom: []</span><span class="diff-line del">-scrutiny_docker_networks: &quot;{{ docker_networks_common</span><span class="diff-line del">-                              + scrutiny_docker_networks_default</span><span class="diff-line del">-                              + scrutiny_docker_networks_custom }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Capabilities</span><span class="diff-line del">-scrutiny_docker_capabilities_default: []</span><span class="diff-line del">-scrutiny_docker_capabilities_custom: []</span><span class="diff-line del">-scrutiny_docker_capabilities: &quot;{{ scrutiny_docker_capabilities_default</span><span class="diff-line del">-                                  + scrutiny_docker_capabilities_custom }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Security Opts</span><span class="diff-line del">-scrutiny_docker_security_opts_default: []</span><span class="diff-line del">-scrutiny_docker_security_opts_custom: []</span><span class="diff-line del">-scrutiny_docker_security_opts: &quot;{{ scrutiny_docker_security_opts_default</span><span class="diff-line del">-                                   + scrutiny_docker_security_opts_custom }}&quot;</span><span class="diff-line add">+scrutiny_role_docker_networks_alias: &quot;{{ scrutiny_name }}&quot;</span><span class="diff-line add">+scrutiny_role_docker_networks_default: []</span><span class="diff-line add">+scrutiny_role_docker_networks_custom: []</span><span class="diff-line add">+scrutiny_role_docker_networks: &quot;{{ docker_networks_common</span><span class="diff-line add">+                                   + lookup(&#x27;role_var&#x27;, &#x27;_docker_networks_default&#x27;, role=&#x27;scrutiny&#x27;)</span><span class="diff-line add">+                                   + lookup(&#x27;role_var&#x27;, &#x27;_docker_networks_custom&#x27;, role=&#x27;scrutiny&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Restart Policy</span><span class="diff-line del">-scrutiny_docker_restart_policy: unless-stopped</span><span class="diff-line add">+scrutiny_role_docker_restart_policy: unless-stopped</span><span class="diff-line context"> </span><span class="diff-line context"> # State</span><span class="diff-line del">-scrutiny_docker_state: started</span><span class="diff-line add">+scrutiny_role_docker_state: started</span><span class="diff-line context"> </span><span class="diff-line context"> # Privileged</span><span class="diff-line del">-scrutiny_docker_privileged: true</span><span class="diff-line add">+scrutiny_role_docker_privileged: true</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-343">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/scrutiny/tasks/main.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -10,9 +10,9 @@</span><span class="diff-line context"> - name: Add DNS record</span><span class="diff-line context">   ansible.builtin.include_tasks: &quot;{{ resources_tasks_path }}/dns/tasker.yml&quot;</span><span class="diff-line context">   vars:</span><span class="diff-line del">-    dns_record: &quot;{{ lookup(&#x27;vars&#x27;, role_name + &#x27;_dns_record&#x27;) }}&quot;</span><span class="diff-line del">-    dns_zone: &quot;{{ lookup(&#x27;vars&#x27;, role_name + &#x27;_dns_zone&#x27;) }}&quot;</span><span class="diff-line del">-    dns_proxy: &quot;{{ lookup(&#x27;vars&#x27;, role_name + &#x27;_dns_proxy&#x27;) }}&quot;</span><span class="diff-line add">+    dns_record: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_dns_record&#x27;) }}&quot;</span><span class="diff-line add">+    dns_zone: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_dns_zone&#x27;) }}&quot;</span><span class="diff-line add">+    dns_proxy: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_dns_proxy&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Remove existing Docker container</span><span class="diff-line context">   ansible.builtin.include_tasks: &quot;{{ resources_tasks_path }}/docker/remove_docker_container.yml&quot;</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-344">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/shell/defaults/main.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -26,7 +26,7 @@</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line context"> shell_z_git_repo_url: &quot;https://github.com/rupa/z.git&quot;</span><span class="diff-line del">-shell_z_git_repo_dest: &quot;/opt/z&quot;</span><span class="diff-line add">+shell_z_git_repo_dest: &quot;{{ server_appdata_path }}/z&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # Bash</span><span class="diff-line hunk">@@ -64,7 +64,7 @@</span><span class="diff-line context">   DISABLE_UPDATE_PROMPT=true</span><span class="diff-line context"> </span><span class="diff-line context"> shell_zsh_zshrc_block_content2: |</span><span class="diff-line del">-  # zsh - allows commmands to run with the un-expanded glob</span><span class="diff-line add">+  # zsh - allows commands to run with the un-expanded glob</span><span class="diff-line context">   unsetopt nomatch</span><span class="diff-line context">   # zsh - set TIMEFMT</span><span class="diff-line context">   export TIMEFMT=$&#x27;</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-345">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/shell/tasks/subtasks/misc.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -9,13 +9,13 @@</span><span class="diff-line context"> ---</span><span class="diff-line context"> - name: Misc | Install argcomplete</span><span class="diff-line context">   ansible.builtin.shell: &quot;pip install {{ shell_misc_argcomplete_pip_package }}&quot;</span><span class="diff-line del">-  when: ansible_distribution_version is version(&#x27;22.04&#x27;, &#x27;&lt;=&#x27;)</span><span class="diff-line add">+  when: ansible_facts[&#x27;distribution_version&#x27;] is version(&#x27;22.04&#x27;, &#x27;&lt;=&#x27;)</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Misc | Install argcomplete</span><span class="diff-line context">   ansible.builtin.apt:</span><span class="diff-line context">     name: python3-argcomplete</span><span class="diff-line context">     state: present</span><span class="diff-line del">-  when: ansible_distribution_version is version(&#x27;24.04&#x27;, &#x27;&gt;=&#x27;)</span><span class="diff-line add">+  when: ansible_facts[&#x27;distribution_version&#x27;] is version(&#x27;24.04&#x27;, &#x27;&gt;=&#x27;)</span><span class="diff-line context"> </span><span class="diff-line context"> # For Ansible command line utilities</span><span class="diff-line context"> - name: Misc | Activate argcomplete</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-346">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/shell/tasks/subtasks/shell/zsh.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -10,7 +10,7 @@</span><span class="diff-line context"> - name: ZSH | Install &#x27;zsh&#x27;</span><span class="diff-line context">   ansible.builtin.apt:</span><span class="diff-line context">     name: &quot;{{ shell_zsh_apt_packages_list }}&quot;</span><span class="diff-line del">-    state: present</span><span class="diff-line add">+    state: latest</span><span class="diff-line context"> </span><span class="diff-line context"> - name: ZSH | Clone &#x27;oh-my-zsh&#x27; repo</span><span class="diff-line context">   ansible.builtin.git:</span><span class="diff-line hunk">@@ -21,8 +21,6 @@</span><span class="diff-line context">     force: true</span><span class="diff-line context">   become: true</span><span class="diff-line context">   become_user: &quot;{{ user.name }}&quot;</span><span class="diff-line del">-  register: cloning</span><span class="diff-line del">-  ignore_errors: true</span><span class="diff-line context"> </span><span class="diff-line context"> - name: ZSH | Check if an existing &#x27;.zshrc&#x27; file is present</span><span class="diff-line context">   ansible.builtin.stat:</span><span class="diff-line hunk">@@ -36,7 +34,7 @@</span><span class="diff-line context">     group: &quot;{{ user.name }}&quot;</span><span class="diff-line context">     owner: &quot;{{ user.name }}&quot;</span><span class="diff-line context">     mode: &quot;0664&quot;</span><span class="diff-line del">-  when: (cloning is success) and (not existing_zshrc.stat.exists)</span><span class="diff-line add">+  when: (not existing_zshrc.stat.exists)</span><span class="diff-line context"> </span><span class="diff-line context"> - name: ZSH | Add items to &#x27;{{ shell_zsh_zshrc_path }}&#x27;</span><span class="diff-line context">   ansible.builtin.blockinfile:</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-347">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/shell/tasks/subtasks/z.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -25,10 +25,3 @@</span><span class="diff-line context">     force: true</span><span class="diff-line context">   become: true</span><span class="diff-line context">   become_user: &quot;{{ user.name }}&quot;</span><span class="diff-line del">-  register: shell_z_git_clone_status</span><span class="diff-line del">-  ignore_errors: true</span><span class="diff-line del">-</span><span class="diff-line del">-- name: z | &#x27;z&#x27; Installed</span><span class="diff-line del">-  ansible.builtin.debug:</span><span class="diff-line del">-    msg: &quot;&#x27;z (jump around)&#x27; Installed&quot;</span><span class="diff-line del">-  when: (shell_z_git_clone_status is succeeded)</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-348">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/sonarr/defaults/main.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -17,171 +17,121 @@</span><span class="diff-line context"> # Settings</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-sonarr_external_auth: true</span><span class="diff-line add">+sonarr_role_external_auth: true</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # Paths</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-sonarr_paths_folder: &quot;{{ sonarr_name }}&quot;</span><span class="diff-line del">-sonarr_paths_location: &quot;{{ server_appdata_path }}/{{ sonarr_paths_folder }}&quot;</span><span class="diff-line del">-sonarr_paths_folders_list:</span><span class="diff-line del">-  - &quot;{{ sonarr_paths_location }}&quot;</span><span class="diff-line del">-sonarr_paths_config_location: &quot;{{ sonarr_paths_location }}/config.xml&quot;</span><span class="diff-line add">+sonarr_role_paths_folder: &quot;{{ sonarr_name }}&quot;</span><span class="diff-line add">+sonarr_role_paths_location: &quot;{{ server_appdata_path }}/{{ sonarr_role_paths_folder }}&quot;</span><span class="diff-line add">+sonarr_role_paths_folders_list:</span><span class="diff-line add">+  - &quot;{{ sonarr_role_paths_location }}&quot;</span><span class="diff-line add">+sonarr_role_paths_config_location: &quot;{{ sonarr_role_paths_location }}/config.xml&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # Web</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-sonarr_web_subdomain: &quot;{{ sonarr_name }}&quot;</span><span class="diff-line del">-sonarr_web_domain: &quot;{{ user.domain }}&quot;</span><span class="diff-line del">-sonarr_web_port: &quot;8989&quot;</span><span class="diff-line del">-sonarr_web_url: &quot;{{ &#x27;https://&#x27; + (lookup(&#x27;vars&#x27;, sonarr_name + &#x27;_web_subdomain&#x27;, default=sonarr_web_subdomain) + &#x27;.&#x27; + lookup(&#x27;vars&#x27;, sonarr_name + &#x27;_web_domain&#x27;, default=sonarr_web_domain)</span><span class="diff-line del">-                 if (lookup(&#x27;vars&#x27;, sonarr_name + &#x27;_web_subdomain&#x27;, default=sonarr_web_subdomain) | length &gt; 0)</span><span class="diff-line del">-                 else lookup(&#x27;vars&#x27;, sonarr_name + &#x27;_web_domain&#x27;, default=sonarr_web_domain)) }}&quot;</span><span class="diff-line add">+sonarr_role_web_subdomain: &quot;{{ sonarr_name }}&quot;</span><span class="diff-line add">+sonarr_role_web_domain: &quot;{{ user.domain }}&quot;</span><span class="diff-line add">+sonarr_role_web_port: &quot;8989&quot;</span><span class="diff-line add">+sonarr_role_web_url: &quot;{{ &#x27;https://&#x27; + (lookup(&#x27;role_var&#x27;, &#x27;_web_subdomain&#x27;, role=&#x27;sonarr&#x27;) + &#x27;.&#x27; + lookup(&#x27;role_var&#x27;, &#x27;_web_domain&#x27;, role=&#x27;sonarr&#x27;)</span><span class="diff-line add">+                      if (lookup(&#x27;role_var&#x27;, &#x27;_web_subdomain&#x27;, role=&#x27;sonarr&#x27;) | length &gt; 0)</span><span class="diff-line add">+                      else lookup(&#x27;role_var&#x27;, &#x27;_web_domain&#x27;, role=&#x27;sonarr&#x27;)) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # DNS</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-sonarr_dns_record: &quot;{{ lookup(&#x27;vars&#x27;, sonarr_name + &#x27;_web_subdomain&#x27;, default=sonarr_web_subdomain) }}&quot;</span><span class="diff-line del">-sonarr_dns_zone: &quot;{{ lookup(&#x27;vars&#x27;, sonarr_name + &#x27;_web_domain&#x27;, default=sonarr_web_domain) }}&quot;</span><span class="diff-line del">-sonarr_dns_proxy: &quot;{{ dns.proxied }}&quot;</span><span class="diff-line add">+sonarr_role_dns_record: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_web_subdomain&#x27;, role=&#x27;sonarr&#x27;) }}&quot;</span><span class="diff-line add">+sonarr_role_dns_zone: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_web_domain&#x27;, role=&#x27;sonarr&#x27;) }}&quot;</span><span class="diff-line add">+sonarr_role_dns_proxy: &quot;{{ dns_proxied }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # Traefik</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-sonarr_traefik_sso_middleware: &quot;{{ traefik_default_sso_middleware }}&quot;</span><span class="diff-line del">-sonarr_traefik_middleware_default: &quot;{{ traefik_default_middleware</span><span class="diff-line del">-                                       + (&#x27;,themepark-&#x27; + lookup(&#x27;vars&#x27;, sonarr_name + &#x27;_name&#x27;, default=sonarr_name)</span><span class="diff-line del">-                                         if (sonarr_themepark_enabled and global_themepark_plugin_enabled)</span><span class="diff-line del">-                                         else &#x27;&#x27;) }}&quot;</span><span class="diff-line del">-sonarr_traefik_middleware_custom: &quot;&quot;</span><span class="diff-line del">-sonarr_traefik_certresolver: &quot;{{ traefik_default_certresolver }}&quot;</span><span class="diff-line del">-sonarr_traefik_enabled: true</span><span class="diff-line del">-sonarr_traefik_api_enabled: true</span><span class="diff-line del">-sonarr_traefik_api_endpoint: &quot;PathPrefix(`/api`) || PathPrefix(`/feed`) || PathPrefix(`/ping`)&quot;</span><span class="diff-line add">+sonarr_role_traefik_sso_middleware: &quot;{{ traefik_default_sso_middleware }}&quot;</span><span class="diff-line add">+sonarr_role_traefik_middleware_default: &quot;{{ traefik_default_middleware</span><span class="diff-line add">+                                            + (&#x27;,themepark-&#x27; + sonarr_name</span><span class="diff-line add">+                                              if (lookup(&#x27;role_var&#x27;, &#x27;_themepark_enabled&#x27;, role=&#x27;sonarr&#x27;) and global_themepark_plugin_enabled)</span><span class="diff-line add">+                                              else &#x27;&#x27;) }}&quot;</span><span class="diff-line add">+sonarr_role_traefik_middleware_custom: &quot;&quot;</span><span class="diff-line add">+sonarr_role_traefik_certresolver: &quot;{{ traefik_default_certresolver }}&quot;</span><span class="diff-line add">+sonarr_role_traefik_enabled: true</span><span class="diff-line add">+sonarr_role_traefik_api_enabled: true</span><span class="diff-line add">+sonarr_role_traefik_api_endpoint: &quot;PathPrefix(`/api`) || PathPrefix(`/feed`) || PathPrefix(`/ping`)&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line del">-# API</span><span class="diff-line del">-################################</span><span class="diff-line del">-</span><span class="diff-line del">-# default to blank</span><span class="diff-line del">-sonarr_api_key:</span><span class="diff-line del">-</span><span class="diff-line del">-################################</span><span class="diff-line del">-# THEME</span><span class="diff-line add">+# Theme</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line context"> # Options can be found at https://github.com/themepark-dev/theme.park</span><span class="diff-line del">-sonarr_themepark_enabled: false</span><span class="diff-line del">-sonarr_themepark_app: &quot;sonarr&quot;</span><span class="diff-line del">-sonarr_themepark_theme: &quot;{{ global_themepark_theme }}&quot;</span><span class="diff-line del">-sonarr_themepark_domain: &quot;{{ global_themepark_domain }}&quot;</span><span class="diff-line del">-sonarr_themepark_addons: []</span><span class="diff-line add">+sonarr_role_themepark_enabled: false</span><span class="diff-line add">+sonarr_role_themepark_app: &quot;sonarr&quot;</span><span class="diff-line add">+sonarr_role_themepark_theme: &quot;{{ global_themepark_theme }}&quot;</span><span class="diff-line add">+sonarr_role_themepark_domain: &quot;{{ global_themepark_domain }}&quot;</span><span class="diff-line add">+sonarr_role_themepark_addons: []</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # Docker</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line context"> # Container</span><span class="diff-line del">-sonarr_docker_container: &quot;{{ sonarr_name }}&quot;</span><span class="diff-line add">+sonarr_role_docker_container: &quot;{{ sonarr_name }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Image</span><span class="diff-line del">-sonarr_docker_image_pull: true</span><span class="diff-line del">-sonarr_docker_image_repo: &quot;ghcr.io/hotio/sonarr&quot;</span><span class="diff-line del">-sonarr_docker_image_tag: &quot;release&quot;</span><span class="diff-line del">-sonarr_docker_image: &quot;{{ lookup(&#x27;vars&#x27;, sonarr_name + &#x27;_docker_image_repo&#x27;, default=sonarr_docker_image_repo)</span><span class="diff-line del">-                         + &#x27;:&#x27; + lookup(&#x27;vars&#x27;, sonarr_name + &#x27;_docker_image_tag&#x27;, default=sonarr_docker_image_tag) }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Ports</span><span class="diff-line del">-sonarr_docker_ports_defaults: []</span><span class="diff-line del">-sonarr_docker_ports_custom: []</span><span class="diff-line del">-sonarr_docker_ports: &quot;{{ lookup(&#x27;vars&#x27;, sonarr_name + &#x27;_docker_ports_defaults&#x27;, default=sonarr_docker_ports_defaults)</span><span class="diff-line del">-                         + lookup(&#x27;vars&#x27;, sonarr_name + &#x27;_docker_ports_custom&#x27;, default=sonarr_docker_ports_custom) }}&quot;</span><span class="diff-line add">+sonarr_role_docker_image_pull: true</span><span class="diff-line add">+sonarr_role_docker_image_repo: &quot;ghcr.io/hotio/sonarr&quot;</span><span class="diff-line add">+sonarr_role_docker_image_tag: &quot;release&quot;</span><span class="diff-line add">+sonarr_role_docker_image: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_image_repo&#x27;, role=&#x27;sonarr&#x27;) }}:{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_image_tag&#x27;, role=&#x27;sonarr&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Envs</span><span class="diff-line del">-sonarr_docker_envs_default:</span><span class="diff-line add">+sonarr_role_docker_envs_default:</span><span class="diff-line context">   PUID: &quot;{{ uid }}&quot;</span><span class="diff-line context">   PGID: &quot;{{ gid }}&quot;</span><span class="diff-line context">   UMASK: &quot;002&quot;</span><span class="diff-line context">   TZ: &quot;{{ tz }}&quot;</span><span class="diff-line del">-sonarr_docker_envs_custom: {}</span><span class="diff-line del">-sonarr_docker_envs: &quot;{{ lookup(&#x27;vars&#x27;, sonarr_name + &#x27;_docker_envs_default&#x27;, default=sonarr_docker_envs_default)</span><span class="diff-line del">-                        | combine(lookup(&#x27;vars&#x27;, sonarr_name + &#x27;_docker_envs_custom&#x27;, default=sonarr_docker_envs_custom)) }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Commands</span><span class="diff-line del">-sonarr_docker_commands_default: []</span><span class="diff-line del">-sonarr_docker_commands_custom: []</span><span class="diff-line del">-sonarr_docker_commands: &quot;{{ lookup(&#x27;vars&#x27;, sonarr_name + &#x27;_docker_commands_default&#x27;, default=sonarr_docker_commands_default)</span><span class="diff-line del">-                            + lookup(&#x27;vars&#x27;, sonarr_name + &#x27;_docker_commands_custom&#x27;, default=sonarr_docker_commands_custom) }}&quot;</span><span class="diff-line add">+sonarr_role_docker_envs_custom: {}</span><span class="diff-line add">+sonarr_role_docker_envs: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_envs_default&#x27;, role=&#x27;sonarr&#x27;)</span><span class="diff-line add">+                             | combine(lookup(&#x27;role_var&#x27;, &#x27;_docker_envs_custom&#x27;, role=&#x27;sonarr&#x27;)) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Volumes</span><span class="diff-line del">-sonarr_docker_volumes_default:</span><span class="diff-line del">-  - &quot;{{ sonarr_paths_location }}:/config&quot;</span><span class="diff-line add">+sonarr_role_docker_volumes_default:</span><span class="diff-line add">+  - &quot;{{ sonarr_role_paths_location }}:/config&quot;</span><span class="diff-line context">   - &quot;{{ server_appdata_path }}/scripts:/scripts&quot;</span><span class="diff-line del">-sonarr_docker_volumes_legacy:</span><span class="diff-line add">+sonarr_role_docker_volumes_legacy:</span><span class="diff-line context">   - &quot;/mnt/unionfs/Media/TV:/tv&quot;</span><span class="diff-line del">-sonarr_docker_volumes_custom: []</span><span class="diff-line del">-sonarr_docker_volumes: &quot;{{ lookup(&#x27;vars&#x27;, sonarr_name + &#x27;_docker_volumes_default&#x27;, default=sonarr_docker_volumes_default)</span><span class="diff-line del">-                           + lookup(&#x27;vars&#x27;, sonarr_name + &#x27;_docker_volumes_custom&#x27;, default=sonarr_docker_volumes_custom)</span><span class="diff-line del">-                           + (lookup(&#x27;vars&#x27;, sonarr_name + &#x27;_docker_volumes_legacy&#x27;, default=sonarr_docker_volumes_legacy)</span><span class="diff-line del">-                             if docker_legacy_volume</span><span class="diff-line del">-                             else []) }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Devices</span><span class="diff-line del">-sonarr_docker_devices_default: []</span><span class="diff-line del">-sonarr_docker_devices_custom: []</span><span class="diff-line del">-sonarr_docker_devices: &quot;{{ lookup(&#x27;vars&#x27;, sonarr_name + &#x27;_docker_devices_default&#x27;, default=sonarr_docker_devices_default)</span><span class="diff-line del">-                           + lookup(&#x27;vars&#x27;, sonarr_name + &#x27;_docker_devices_custom&#x27;, default=sonarr_docker_devices_custom) }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Hosts</span><span class="diff-line del">-sonarr_docker_hosts_default: {}</span><span class="diff-line del">-sonarr_docker_hosts_custom: {}</span><span class="diff-line del">-sonarr_docker_hosts: &quot;{{ docker_hosts_common</span><span class="diff-line del">-                         | combine(lookup(&#x27;vars&#x27;, sonarr_name + &#x27;_docker_hosts_default&#x27;, default=sonarr_docker_hosts_default))</span><span class="diff-line del">-                         | combine(lookup(&#x27;vars&#x27;, sonarr_name + &#x27;_docker_hosts_custom&#x27;, default=sonarr_docker_hosts_custom)) }}&quot;</span><span class="diff-line add">+sonarr_role_docker_volumes_custom: []</span><span class="diff-line add">+sonarr_role_docker_volumes: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_volumes_default&#x27;, role=&#x27;sonarr&#x27;)</span><span class="diff-line add">+                                + lookup(&#x27;role_var&#x27;, &#x27;_docker_volumes_custom&#x27;, role=&#x27;sonarr&#x27;)</span><span class="diff-line add">+                                + (lookup(&#x27;role_var&#x27;, &#x27;_docker_volumes_legacy&#x27;, role=&#x27;sonarr&#x27;)</span><span class="diff-line add">+                                  if docker_legacy_volume</span><span class="diff-line add">+                                  else []) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Labels</span><span class="diff-line del">-sonarr_docker_labels_default: {}</span><span class="diff-line del">-sonarr_docker_labels_custom: {}</span><span class="diff-line del">-sonarr_docker_labels: &quot;{{ docker_labels_common</span><span class="diff-line del">-                          | combine(lookup(&#x27;vars&#x27;, sonarr_name + &#x27;_docker_labels_default&#x27;, default=sonarr_docker_labels_default))</span><span class="diff-line del">-                          | combine((traefik_themepark_labels</span><span class="diff-line del">-                                    if (sonarr_themepark_enabled and global_themepark_plugin_enabled)</span><span class="diff-line del">-                                    else {}),</span><span class="diff-line del">-                                    lookup(&#x27;vars&#x27;, sonarr_name + &#x27;_docker_labels_custom&#x27;, default=sonarr_docker_labels_custom)) }}&quot;</span><span class="diff-line add">+sonarr_role_docker_labels_default: {}</span><span class="diff-line add">+sonarr_role_docker_labels_custom: {}</span><span class="diff-line add">+sonarr_role_docker_labels: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_labels_default&#x27;, role=&#x27;sonarr&#x27;)</span><span class="diff-line add">+                               | combine((traefik_themepark_labels</span><span class="diff-line add">+                                         if (lookup(&#x27;role_var&#x27;, &#x27;_themepark_enabled&#x27;, role=&#x27;sonarr&#x27;) and global_themepark_plugin_enabled)</span><span class="diff-line add">+                                         else {}),</span><span class="diff-line add">+                                         lookup(&#x27;role_var&#x27;, &#x27;_docker_labels_custom&#x27;, role=&#x27;sonarr&#x27;)) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Hostname</span><span class="diff-line del">-sonarr_docker_hostname: &quot;{{ sonarr_name }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Network Mode</span><span class="diff-line del">-sonarr_docker_network_mode_default: &quot;{{ docker_networks_name_common }}&quot;</span><span class="diff-line del">-sonarr_docker_network_mode: &quot;{{ lookup(&#x27;vars&#x27;, sonarr_name + &#x27;_docker_network_mode_default&#x27;, default=sonarr_docker_network_mode_default) }}&quot;</span><span class="diff-line add">+sonarr_role_docker_hostname: &quot;{{ sonarr_name }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Networks</span><span class="diff-line del">-sonarr_docker_networks_alias: &quot;{{ sonarr_name }}&quot;</span><span class="diff-line del">-sonarr_docker_networks_default: []</span><span class="diff-line del">-sonarr_docker_networks_custom: []</span><span class="diff-line del">-sonarr_docker_networks: &quot;{{ docker_networks_common</span><span class="diff-line del">-                            + lookup(&#x27;vars&#x27;, sonarr_name + &#x27;_docker_networks_default&#x27;, default=sonarr_docker_networks_default)</span><span class="diff-line del">-                            + lookup(&#x27;vars&#x27;, sonarr_name + &#x27;_docker_networks_custom&#x27;, default=sonarr_docker_networks_custom) }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Capabilities</span><span class="diff-line del">-sonarr_docker_capabilities_default: []</span><span class="diff-line del">-sonarr_docker_capabilities_custom: []</span><span class="diff-line del">-sonarr_docker_capabilities: &quot;{{ lookup(&#x27;vars&#x27;, sonarr_name + &#x27;_docker_capabilities_default&#x27;, default=sonarr_docker_capabilities_default)</span><span class="diff-line del">-                                + lookup(&#x27;vars&#x27;, sonarr_name + &#x27;_docker_capabilities_custom&#x27;, default=sonarr_docker_capabilities_custom) }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Security Opts</span><span class="diff-line del">-sonarr_docker_security_opts_default: []</span><span class="diff-line del">-sonarr_docker_security_opts_custom: []</span><span class="diff-line del">-sonarr_docker_security_opts: &quot;{{ lookup(&#x27;vars&#x27;, sonarr_name + &#x27;_docker_security_opts_default&#x27;, default=sonarr_docker_security_opts_default)</span><span class="diff-line del">-                                 + lookup(&#x27;vars&#x27;, sonarr_name + &#x27;_docker_security_opts_custom&#x27;, default=sonarr_docker_security_opts_custom) }}&quot;</span><span class="diff-line add">+sonarr_role_docker_networks_alias: &quot;{{ sonarr_name }}&quot;</span><span class="diff-line add">+sonarr_role_docker_networks_default: []</span><span class="diff-line add">+sonarr_role_docker_networks_custom: []</span><span class="diff-line add">+sonarr_role_docker_networks: &quot;{{ docker_networks_common</span><span class="diff-line add">+                                 + lookup(&#x27;role_var&#x27;, &#x27;_docker_networks_default&#x27;, role=&#x27;sonarr&#x27;)</span><span class="diff-line add">+                                 + lookup(&#x27;role_var&#x27;, &#x27;_docker_networks_custom&#x27;, role=&#x27;sonarr&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Restart Policy</span><span class="diff-line del">-sonarr_docker_restart_policy: unless-stopped</span><span class="diff-line add">+sonarr_role_docker_restart_policy: unless-stopped</span><span class="diff-line context"> </span><span class="diff-line context"> # State</span><span class="diff-line del">-sonarr_docker_state: started</span><span class="diff-line add">+sonarr_role_docker_state: started</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-349">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/sonarr/tasks/main2.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -10,9 +10,9 @@</span><span class="diff-line context"> - name: Add DNS record</span><span class="diff-line context">   ansible.builtin.include_tasks: &quot;{{ resources_tasks_path }}/dns/tasker.yml&quot;</span><span class="diff-line context">   vars:</span><span class="diff-line del">-    dns_record: &quot;{{ lookup(&#x27;vars&#x27;, role_name + &#x27;_dns_record&#x27;) }}&quot;</span><span class="diff-line del">-    dns_zone: &quot;{{ lookup(&#x27;vars&#x27;, role_name + &#x27;_dns_zone&#x27;) }}&quot;</span><span class="diff-line del">-    dns_proxy: &quot;{{ lookup(&#x27;vars&#x27;, role_name + &#x27;_dns_proxy&#x27;) }}&quot;</span><span class="diff-line add">+    dns_record: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_dns_record&#x27;) }}&quot;</span><span class="diff-line add">+    dns_zone: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_dns_zone&#x27;) }}&quot;</span><span class="diff-line add">+    dns_proxy: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_dns_proxy&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Remove existing Docker container</span><span class="diff-line context">   ansible.builtin.include_tasks: &quot;{{ resources_tasks_path }}/docker/remove_docker_container.yml&quot;</span><span class="diff-line hunk">@@ -24,5 +24,5 @@</span><span class="diff-line context">   ansible.builtin.include_tasks: &quot;{{ resources_tasks_path }}/docker/create_docker_container.yml&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: &quot;Tweak Settings when SSO is enabled&quot;</span><span class="diff-line del">-  ansible.builtin.import_tasks: &quot;subtasks/auth.yml&quot;</span><span class="diff-line del">-  when: (lookup(&#x27;vars&#x27;, sonarr_name + &#x27;_traefik_sso_middleware&#x27;, default=sonarr_traefik_sso_middleware) | length &gt; 0) and lookup(&#x27;vars&#x27;, sonarr_name + &#x27;_external_auth&#x27;, default=sonarr_external_auth)</span><span class="diff-line add">+  ansible.builtin.include_tasks: &quot;subtasks/auth.yml&quot;</span><span class="diff-line add">+  when: (lookup(&#x27;role_var&#x27;, &#x27;_traefik_sso_middleware&#x27;, role=&#x27;sonarr&#x27;) | length &gt; 0) and lookup(&#x27;role_var&#x27;, &#x27;_external_auth&#x27;, role=&#x27;sonarr&#x27;)</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-350">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/sonarr/tasks/subtasks/auth.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -9,7 +9,7 @@</span><span class="diff-line context"> ---</span><span class="diff-line context"> - name: Auth | Wait for &#x27;config.xml&#x27; to be created</span><span class="diff-line context">   ansible.builtin.wait_for:</span><span class="diff-line del">-    path: &quot;/opt/{{ sonarr_name }}/config.xml&quot;</span><span class="diff-line add">+    path: &quot;{{ server_appdata_path }}/{{ sonarr_name }}/config.xml&quot;</span><span class="diff-line context">     state: present</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Auth | Wait for 10 seconds</span><span class="diff-line hunk">@@ -18,7 +18,7 @@</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Auth | Lookup AuthenticationMethod value</span><span class="diff-line context">   community.general.xml:</span><span class="diff-line del">-    path: &quot;/opt/{{ sonarr_name }}/config.xml&quot;</span><span class="diff-line add">+    path: &quot;{{ server_appdata_path }}/{{ sonarr_name }}/config.xml&quot;</span><span class="diff-line context">     xpath: &quot;/Config/AuthenticationMethod&quot;</span><span class="diff-line context">     content: &quot;text&quot;</span><span class="diff-line context">   register: xmlresp</span><span class="diff-line hunk">@@ -28,7 +28,7 @@</span><span class="diff-line context">   block:</span><span class="diff-line context">     - name: Auth | Change the &#x27;AuthenticationMethod&#x27; attribute to &#x27;External&#x27;</span><span class="diff-line context">       community.general.xml:</span><span class="diff-line del">-        path: &quot;/opt/{{ sonarr_name }}/config.xml&quot;</span><span class="diff-line add">+        path: &quot;{{ server_appdata_path }}/{{ sonarr_name }}/config.xml&quot;</span><span class="diff-line context">         xpath: &quot;/Config/AuthenticationMethod&quot;</span><span class="diff-line context">         value: &quot;External&quot;</span><span class="diff-line context"> </span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-351">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/system/tasks/main.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -8,23 +8,23 @@</span><span class="diff-line context"> #########################################################################</span><span class="diff-line context"> ---</span><span class="diff-line context"> - name: Logrotate</span><span class="diff-line del">-  ansible.builtin.import_tasks: &quot;subtasks/logrotate.yml&quot;</span><span class="diff-line add">+  ansible.builtin.include_tasks: &quot;subtasks/logrotate.yml&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: APT tasks</span><span class="diff-line context">   ansible.builtin.include_tasks: &quot;subtasks/apt.yml&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Network tasks</span><span class="diff-line del">-  ansible.builtin.import_tasks: &quot;subtasks/network.yml&quot;</span><span class="diff-line add">+  ansible.builtin.include_tasks: &quot;subtasks/network.yml&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: sysctl tasks</span><span class="diff-line context">   ansible.builtin.include_tasks: &quot;subtasks/sysctl.yml&quot;</span><span class="diff-line context">   when: run_sysctl_tasks</span><span class="diff-line context"> </span><span class="diff-line del">-- name: pam_limits tasks</span><span class="diff-line add">+- name: PAM limits tasks</span><span class="diff-line context">   ansible.builtin.include_tasks: &quot;subtasks/pam_limits.yml&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Mounts tasks</span><span class="diff-line del">-  ansible.builtin.import_tasks: &quot;subtasks/mounts.yml&quot;</span><span class="diff-line add">+  ansible.builtin.include_tasks: &quot;subtasks/mounts.yml&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: CPU Frequency tasks</span><span class="diff-line context">   ansible.builtin.include_tasks: &quot;subtasks/cpufrequency.yml&quot;</span><span class="diff-line hunk">@@ -35,12 +35,12 @@</span><span class="diff-line context">   when: cpu_performance_mode and (&quot;none&quot; in systemd_detect_virt.stdout)</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Set Time Zone task</span><span class="diff-line del">-  ansible.builtin.import_tasks: &quot;subtasks/timezone.yml&quot;</span><span class="diff-line add">+  ansible.builtin.include_tasks: &quot;subtasks/timezone.yml&quot;</span><span class="diff-line context">   when: (tz is defined)</span><span class="diff-line context">   tags: set-timezone</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Set Locale task</span><span class="diff-line del">-  ansible.builtin.import_tasks: &quot;subtasks/locale.yml&quot;</span><span class="diff-line add">+  ansible.builtin.include_tasks: &quot;subtasks/locale.yml&quot;</span><span class="diff-line context">   tags: set-locale</span><span class="diff-line context"> </span><span class="diff-line context"> - name: flush_handlers</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-352">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/system/tasks/subtasks/apt.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -23,7 +23,7 @@</span><span class="diff-line context">     dest: &quot;/etc/needrestart/conf.d/saltbox.conf&quot;</span><span class="diff-line context">     mode: &quot;0644&quot;</span><span class="diff-line context">     force: true</span><span class="diff-line del">-  when: (&#x27;needrestart&#x27; in ansible_facts.packages)</span><span class="diff-line add">+  when: (&#x27;needrestart&#x27; in ansible_facts[&#x27;packages&#x27;])</span><span class="diff-line context"> </span><span class="diff-line context"> - name: APT | Fix any potential dpkg issues</span><span class="diff-line context">   block:</span><span class="diff-line hunk">@@ -48,7 +48,7 @@</span><span class="diff-line context"> </span><span class="diff-line context"> - name: APT | Install required packages</span><span class="diff-line context">   ansible.builtin.apt:</span><span class="diff-line del">-    state: present</span><span class="diff-line add">+    state: latest</span><span class="diff-line context">     name:</span><span class="diff-line context">       - apt-utils</span><span class="diff-line context">       - byobu</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-353">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/system/tasks/subtasks/cpufrequency.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -10,18 +10,18 @@</span><span class="diff-line context"> - name: CPU Frequency | Install &#x27;cpufrequtils&#x27;</span><span class="diff-line context">   ansible.builtin.apt:</span><span class="diff-line context">     name: cpufrequtils</span><span class="diff-line del">-    state: present</span><span class="diff-line add">+    state: latest</span><span class="diff-line context"> </span><span class="diff-line context"> - name: CPU Frequency | Install &#x27;linux-tools&#x27; for Ubuntu</span><span class="diff-line context">   ansible.builtin.apt:</span><span class="diff-line del">-    state: present</span><span class="diff-line add">+    state: latest</span><span class="diff-line context">     name:</span><span class="diff-line context">       - linux-tools-common</span><span class="diff-line context">       - linux-tools-generic</span><span class="diff-line del">-  when: (ansible_distribution == &#x27;Ubuntu&#x27;)</span><span class="diff-line add">+  when: (ansible_facts[&#x27;distribution&#x27;] == &#x27;Ubuntu&#x27;)</span><span class="diff-line context"> </span><span class="diff-line del">-- name: &quot;CPU Frequency | Install &#x27;linux-tools-{{ ansible_kernel }}&#x27;&quot;</span><span class="diff-line del">-  ansible.builtin.shell: &quot;apt-get install -qq $(apt-cache search -n linux-tools-{{ ansible_kernel }} | awk &#x27;{print $1}&#x27; | tail -n 1)&quot;</span><span class="diff-line add">+- name: &quot;CPU Frequency | Install &#x27;linux-tools-{{ ansible_facts[&#x27;kernel&#x27;] }}&#x27;&quot;</span><span class="diff-line add">+  ansible.builtin.shell: &quot;apt-get install -qq $(apt-cache search -n linux-tools-{{ ansible_facts[&#x27;kernel&#x27;] }} | awk &#x27;{print $1}&#x27; | tail -n 1)&quot;</span><span class="diff-line context">   ignore_errors: true</span><span class="diff-line context"> </span><span class="diff-line context"> - name: CPU Frequency | Ensure &#x27;cpufrequtils&#x27; is enabled</span><span class="diff-line hunk">@@ -68,4 +68,4 @@</span><span class="diff-line context">     enabled: false</span><span class="diff-line context">     daemon_reload: true</span><span class="diff-line context">   ignore_errors: true</span><span class="diff-line del">-  when: (&#x27;ondemand.service&#x27; in services and services[&#x27;ondemand.service&#x27;][&#x27;status&#x27;] == &#x27;enabled&#x27;)</span><span class="diff-line add">+  when: (&#x27;ondemand.service&#x27; in services and ansible_facts[&#x27;services&#x27;][&#x27;ondemand.service&#x27;][&#x27;status&#x27;] == &#x27;enabled&#x27;)</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-354">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/system/tasks/subtasks/locale.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -10,14 +10,14 @@</span><span class="diff-line context"> - name: Locale | Install locales</span><span class="diff-line context">   ansible.builtin.apt:</span><span class="diff-line context">     name: locales</span><span class="diff-line del">-    state: present</span><span class="diff-line add">+    state: latest</span><span class="diff-line context"> </span><span class="diff-line del">-- name: Locale | Ensure localisation files for &#x27;{{ system_locale }}&#x27; are available</span><span class="diff-line add">+- name: Locale | Ensure localization files for &#x27;{{ system_locale }}&#x27; are available</span><span class="diff-line context">   community.general.locale_gen:</span><span class="diff-line context">     name: &quot;{{ system_locale }}&quot;</span><span class="diff-line context">     state: present</span><span class="diff-line context"> </span><span class="diff-line del">-- name: Locale | Ensure localisation files for &#x27;{{ system_language }}&#x27; are available</span><span class="diff-line add">+- name: Locale | Ensure localization files for &#x27;{{ system_language }}&#x27; are available</span><span class="diff-line context">   community.general.locale_gen:</span><span class="diff-line context">     name: &quot;{{ system_language }}&quot;</span><span class="diff-line context">     state: present</span><span class="diff-line hunk">@@ -25,7 +25,6 @@</span><span class="diff-line context"> - name: Locale | Get current locale and language configuration</span><span class="diff-line context">   ansible.builtin.command: localectl status</span><span class="diff-line context">   register: locale_status</span><span class="diff-line del">-  changed_when: false</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Locale | Parse &#x27;LANG&#x27; from current locale and language configuration</span><span class="diff-line context">   ansible.builtin.set_fact:</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-355">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/system/tasks/subtasks/logrotate.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -11,7 +11,7 @@</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Logrotate | Install required packages</span><span class="diff-line context">   ansible.builtin.apt:</span><span class="diff-line del">-    state: present</span><span class="diff-line add">+    state: latest</span><span class="diff-line context">     name:</span><span class="diff-line context">       - logrotate</span><span class="diff-line context"> </span><span class="diff-line hunk">@@ -39,7 +39,7 @@</span><span class="diff-line context">           }</span><span class="diff-line context">       - path: &quot;sandbox&quot;</span><span class="diff-line context">         content: |</span><span class="diff-line del">-          /opt/sandbox/sandbox.log {</span><span class="diff-line add">+          {{ server_appdata_path }}/sandbox/sandbox.log {</span><span class="diff-line context">               su {{ user.name }} {{ user.name }}</span><span class="diff-line context">               weekly</span><span class="diff-line context">               rotate 5</span><span class="diff-line hunk">@@ -50,7 +50,7 @@</span><span class="diff-line context">           }</span><span class="diff-line context">       - path: &quot;saltbox_mod&quot;</span><span class="diff-line context">         content: |</span><span class="diff-line del">-          /opt/saltbox_mod/saltbox_mod.log {</span><span class="diff-line add">+          {{ server_appdata_path }}/saltbox_mod/saltbox_mod.log {</span><span class="diff-line context">               su {{ user.name }} {{ user.name }}</span><span class="diff-line context">               weekly</span><span class="diff-line context">               rotate 5</span><span class="diff-line hunk">@@ -61,10 +61,10 @@</span><span class="diff-line context">           }</span><span class="diff-line context">       - path: &quot;traefik&quot;</span><span class="diff-line context">         content: |</span><span class="diff-line del">-          /opt/traefik/access.log {</span><span class="diff-line add">+          {{ server_appdata_path }}/traefik/access.log {</span><span class="diff-line context">               su {{ user.name }} {{ user.name }}</span><span class="diff-line del">-              rotate {{ traefik_log_max_backups }}</span><span class="diff-line del">-              size {{ traefik_log_max_size }}</span><span class="diff-line add">+              rotate {{ lookup(&#x27;role_var&#x27;, &#x27;_log_max_backups&#x27;, role=&#x27;traefik&#x27;) }}</span><span class="diff-line add">+              size {{ lookup(&#x27;role_var&#x27;, &#x27;_log_max_size&#x27;, role=&#x27;traefik&#x27;) }}</span><span class="diff-line context">               missingok</span><span class="diff-line context">               notifempty</span><span class="diff-line context">               postrotate</span><span class="diff-line hunk">@@ -78,6 +78,6 @@</span><span class="diff-line context">     path: &quot;/etc/logrotate.d/{{ item.path }}&quot;</span><span class="diff-line context">     marker: &quot;### SALTBOX MANAGED BLOCK - {mark} ###&quot;</span><span class="diff-line context">     block: &quot;{{ item.content }}&quot;</span><span class="diff-line del">-    create: yes</span><span class="diff-line add">+    create: true</span><span class="diff-line context">     mode: &quot;0644&quot;</span><span class="diff-line context">   loop: &quot;{{ logrotate_d_items }}&quot;</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-356">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/system/tasks/subtasks/mounts.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -9,7 +9,7 @@</span><span class="diff-line context"> ---</span><span class="diff-line context"> - name: Mounts | Display system mounts</span><span class="diff-line context">   ansible.builtin.debug:</span><span class="diff-line del">-    msg: &quot;{{ ansible_mounts }}&quot;</span><span class="diff-line add">+    msg: &quot;{{ ansible_facts[&#x27;mounts&#x27;] }}&quot;</span><span class="diff-line context">     verbosity: 1</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Mounts | Set opts for &#x27;/&#x27; ext4 mount</span><span class="diff-line hunk">@@ -20,13 +20,13 @@</span><span class="diff-line context">     fstype: ext4</span><span class="diff-line context">     src: &quot;{{ item.device }}&quot;</span><span class="diff-line context">   with_items:</span><span class="diff-line del">-    - &quot;{{ ansible_mounts }}&quot;</span><span class="diff-line add">+    - &quot;{{ ansible_facts[&#x27;mounts&#x27;] }}&quot;</span><span class="diff-line context">   when: (item.mount == &#x27;/&#x27;) and (item.fstype == &#x27;ext4&#x27;)</span><span class="diff-line context"> </span><span class="diff-line context"> - name: &quot;Mounts | Install &#x27;fuse3&#x27;&quot;</span><span class="diff-line context">   ansible.builtin.apt:</span><span class="diff-line context">     name: &quot;fuse3&quot;</span><span class="diff-line del">-    state: present</span><span class="diff-line add">+    state: latest</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Mounts | Import &#x27;fuse.conf&#x27;</span><span class="diff-line context">   ansible.builtin.copy:</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-357">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/system/tasks/subtasks/network.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -9,14 +9,14 @@</span><span class="diff-line context"> ---</span><span class="diff-line context"> - name: Network | Install common packages</span><span class="diff-line context">   ansible.builtin.apt:</span><span class="diff-line del">-    state: present</span><span class="diff-line add">+    state: latest</span><span class="diff-line context">     name:</span><span class="diff-line context">       - vnstat</span><span class="diff-line context">       - pciutils</span><span class="diff-line context">       - ethtool</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Network | Network Tasks Block</span><span class="diff-line del">-  when: (ansible_default_ipv4 is defined) and (ansible_default_ipv4.type == &quot;ether&quot;)</span><span class="diff-line add">+  when: (ansible_facts[&#x27;default_ipv4&#x27;] is defined) and (ansible_facts[&#x27;default_ipv4&#x27;][&#x27;type&#x27;] == &quot;ether&quot;)</span><span class="diff-line context">   block:</span><span class="diff-line context">     - name: Network | Check for &#x27;/etc/vnstat.conf&#x27;</span><span class="diff-line context">       ansible.builtin.stat:</span><span class="diff-line hunk">@@ -27,7 +27,7 @@</span><span class="diff-line context">       ansible.builtin.lineinfile:</span><span class="diff-line context">         path: &quot;/etc/vnstat.conf&quot;</span><span class="diff-line context">         regexp: &#x27;(Interface)\s?.*&#x27;</span><span class="diff-line del">-        line: &#x27;\1 &quot;{{ ansible_default_ipv4.interface }}&quot;&#x27;</span><span class="diff-line add">+        line: &#x27;\1 &quot;{{ ansible_facts[&quot;default_ipv4&quot;][&quot;interface&quot;] }}&quot;&#x27;</span><span class="diff-line context">         state: present</span><span class="diff-line context">         backrefs: true</span><span class="diff-line context">       when: (vnstat_conf.stat.exists)</span><span class="diff-line hunk">@@ -52,7 +52,7 @@</span><span class="diff-line context">         create: false</span><span class="diff-line context">         marker: &quot;### {mark} SALTBOX MANAGED BLOCK ###&quot;</span><span class="diff-line context">         block: |</span><span class="diff-line del">-          ethtool -K {{ ansible_default_ipv4.interface }} tso off gso off</span><span class="diff-line add">+          ethtool -K {{ ansible_facts[&#x27;default_ipv4&#x27;][&#x27;interface&#x27;] }} tso off gso off</span><span class="diff-line context">         insertbefore: &quot;^exit 0&quot;</span><span class="diff-line context">         owner: &quot;root&quot;</span><span class="diff-line context">         group: &quot;root&quot;</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-358">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/system/tasks/subtasks/timezone.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -23,29 +23,50 @@</span><span class="diff-line context">     - (system.timezone is defined)</span><span class="diff-line context">     - (&#x27;auto&#x27; in system.timezone | lower)</span><span class="diff-line context">   block:</span><span class="diff-line del">-    - name: Time Zone | Get IP geolocation data</span><span class="diff-line del">-      community.general.ipinfoio_facts:</span><span class="diff-line add">+    - name: Time Zone | Get timezone from IP using multiple sources</span><span class="diff-line add">+      ip_timezone_lookup:</span><span class="diff-line add">+        ip_address: &quot;{{ ip_address_public }}&quot;</span><span class="diff-line add">+        timeout: 5</span><span class="diff-line add">+        min_consensus: 2</span><span class="diff-line add">+      register: tz_lookup</span><span class="diff-line context"> </span><span class="diff-line del">-    - name: Time Zone | Set &#x27;timezone&#x27; variable from &#x27;ipinfoio_facts&#x27;</span><span class="diff-line add">+    - name: Time Zone | Set &#x27;timezone&#x27; variable from IP lookup</span><span class="diff-line context">       ansible.builtin.set_fact:</span><span class="diff-line del">-        timezone: &quot;{{ ansible_facts.timezone }}&quot;</span><span class="diff-line del">-        timezone_string: &quot;Time zone: {{ timezone }}&quot;</span><span class="diff-line add">+        timezone: &quot;{{ tz_lookup.timezone }}&quot;</span><span class="diff-line add">+      when:</span><span class="diff-line add">+        - tz_lookup.timezone is defined</span><span class="diff-line add">+        - tz_lookup.timezone is not none</span><span class="diff-line add">+        - tz_lookup.confidence in [&#x27;high&#x27;, &#x27;medium&#x27;]</span><span class="diff-line add">+</span><span class="diff-line add">+    - name: Time Zone | Display timezone detection results</span><span class="diff-line add">+      ansible.builtin.debug:</span><span class="diff-line add">+        msg: &quot;Detected timezone &#x27;{{ tz_lookup.timezone }}&#x27; with {{ tz_lookup.confidence }} confidence ({{ tz_lookup.consensus_count }}/{{ tz_lookup.successful_lookups }} sources agree)&quot;</span><span class="diff-line add">+      when: tz_lookup.timezone is defined</span><span class="diff-line add">+</span><span class="diff-line add">+    - name: Time Zone | Fail if low confidence or no consensus</span><span class="diff-line add">+      ansible.builtin.fail:</span><span class="diff-line add">+        msg: &quot;Could not reliably determine timezone. Only {{ tz_lookup.consensus_count }} sources agreed. Manual configuration may be required.&quot;</span><span class="diff-line add">+      when:</span><span class="diff-line add">+        - tz_lookup.timezone is none or tz_lookup.confidence == &#x27;low&#x27;</span><span class="diff-line context"> </span><span class="diff-line context">   rescue:</span><span class="diff-line del">-    - name: Time Zone | Get IP geolocation data (with curl)</span><span class="diff-line add">+    - name: Time Zone | Fallback to curl method if module fails</span><span class="diff-line context">       ansible.builtin.shell: &quot;curl -s https://ipapi.co/timezone&quot;</span><span class="diff-line context">       register: system_curl_timezone</span><span class="diff-line context">       failed_when: (system_curl_timezone.stdout | trim | length == 0)</span><span class="diff-line context"> </span><span class="diff-line del">-    - name: Time Zone | Set &#x27;timezone&#x27; variable from &#x27;ipinfoio_facts&#x27;</span><span class="diff-line add">+    - name: Time Zone | Set &#x27;timezone&#x27; variable from curl fallback</span><span class="diff-line context">       ansible.builtin.set_fact:</span><span class="diff-line context">         timezone: &quot;{{ system_curl_timezone.stdout | trim }}&quot;</span><span class="diff-line del">-        timezone_string: &quot;Time zone: {{ timezone }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Time Zone | Check if timezone is valid</span><span class="diff-line context">   ansible.builtin.fail:</span><span class="diff-line del">-    msg: &quot;Invalid timezone given, given timezone was {{ timezone }}\&quot;.&quot;</span><span class="diff-line del">-  when: (timezone_list.stdout is defined) and timezone not in timezone_list.stdout</span><span class="diff-line add">+    msg: &quot;Invalid timezone given, given timezone was {{ timezone }}.&quot;</span><span class="diff-line add">+  when: (timezone_list.stdout_lines is defined) and timezone not in timezone_list.stdout_lines</span><span class="diff-line add">+</span><span class="diff-line add">+- name: Time Zone | Set &#x27;timezone_string&#x27; variable</span><span class="diff-line add">+  ansible.builtin.set_fact:</span><span class="diff-line add">+    timezone_string: &quot;Time zone: {{ timezone }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Time Zone | Set timezone</span><span class="diff-line context">   ansible.builtin.shell: &quot;timedatectl set-timezone {{ timezone }}; timedatectl&quot;</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-359">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/tautulli/defaults/main.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -17,155 +17,112 @@</span><span class="diff-line context"> # Paths</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-tautulli_paths_folder: &quot;{{ tautulli_name }}&quot;</span><span class="diff-line del">-tautulli_paths_location: &quot;{{ server_appdata_path }}/{{ tautulli_paths_folder }}&quot;</span><span class="diff-line del">-tautulli_paths_scripts_location: &quot;{{ server_appdata_path }}/scripts/tautulli&quot;</span><span class="diff-line del">-tautulli_paths_folders_list:</span><span class="diff-line del">-  - &quot;{{ tautulli_paths_location }}&quot;</span><span class="diff-line del">-  - &quot;{{ tautulli_paths_scripts_location }}&quot;</span><span class="diff-line add">+tautulli_role_paths_folder: &quot;{{ tautulli_name }}&quot;</span><span class="diff-line add">+tautulli_role_paths_location: &quot;{{ server_appdata_path }}/{{ tautulli_role_paths_folder }}&quot;</span><span class="diff-line add">+tautulli_role_paths_scripts_location: &quot;{{ server_appdata_path }}/scripts/tautulli&quot;</span><span class="diff-line add">+tautulli_role_paths_folders_list:</span><span class="diff-line add">+  - &quot;{{ tautulli_role_paths_location }}&quot;</span><span class="diff-line add">+  - &quot;{{ tautulli_role_paths_scripts_location }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # Web</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-tautulli_web_subdomain: &quot;{{ tautulli_name }}&quot;</span><span class="diff-line del">-tautulli_web_domain: &quot;{{ user.domain }}&quot;</span><span class="diff-line del">-tautulli_web_port: &quot;8181&quot;</span><span class="diff-line del">-tautulli_web_url: &quot;{{ &#x27;https://&#x27; + (lookup(&#x27;vars&#x27;, tautulli_name + &#x27;_web_subdomain&#x27;, default=tautulli_web_subdomain) + &#x27;.&#x27; + lookup(&#x27;vars&#x27;, tautulli_name + &#x27;_web_domain&#x27;, default=tautulli_web_domain)</span><span class="diff-line del">-                   if (lookup(&#x27;vars&#x27;, tautulli_name + &#x27;_web_subdomain&#x27;, default=tautulli_web_subdomain) | length &gt; 0)</span><span class="diff-line del">-                   else lookup(&#x27;vars&#x27;, tautulli_name + &#x27;_web_domain&#x27;, default=tautulli_web_domain)) }}&quot;</span><span class="diff-line add">+tautulli_role_web_subdomain: &quot;{{ tautulli_name }}&quot;</span><span class="diff-line add">+tautulli_role_web_domain: &quot;{{ user.domain }}&quot;</span><span class="diff-line add">+tautulli_role_web_port: &quot;8181&quot;</span><span class="diff-line add">+tautulli_role_web_url: &quot;{{ &#x27;https://&#x27; + (lookup(&#x27;role_var&#x27;, &#x27;_web_subdomain&#x27;, role=&#x27;tautulli&#x27;) + &#x27;.&#x27; + lookup(&#x27;role_var&#x27;, &#x27;_web_domain&#x27;, role=&#x27;tautulli&#x27;)</span><span class="diff-line add">+                        if (lookup(&#x27;role_var&#x27;, &#x27;_web_subdomain&#x27;, role=&#x27;tautulli&#x27;) | length &gt; 0)</span><span class="diff-line add">+                        else lookup(&#x27;role_var&#x27;, &#x27;_web_domain&#x27;, role=&#x27;tautulli&#x27;)) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # DNS</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-tautulli_dns_record: &quot;{{ lookup(&#x27;vars&#x27;, tautulli_name + &#x27;_web_subdomain&#x27;, default=tautulli_web_subdomain) }}&quot;</span><span class="diff-line del">-tautulli_dns_zone: &quot;{{ lookup(&#x27;vars&#x27;, tautulli_name + &#x27;_web_domain&#x27;, default=tautulli_web_domain) }}&quot;</span><span class="diff-line del">-tautulli_dns_proxy: &quot;{{ dns.proxied }}&quot;</span><span class="diff-line add">+tautulli_role_dns_record: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_web_subdomain&#x27;, role=&#x27;tautulli&#x27;) }}&quot;</span><span class="diff-line add">+tautulli_role_dns_zone: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_web_domain&#x27;, role=&#x27;tautulli&#x27;) }}&quot;</span><span class="diff-line add">+tautulli_role_dns_proxy: &quot;{{ dns_proxied }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # Traefik</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-tautulli_traefik_sso_middleware: &quot;{{ traefik_default_sso_middleware }}&quot;</span><span class="diff-line del">-tautulli_traefik_middleware_default: &quot;{{ traefik_default_middleware</span><span class="diff-line del">-                                         + (&#x27;,themepark-&#x27; + lookup(&#x27;vars&#x27;, tautulli_name + &#x27;_name&#x27;, default=tautulli_name)</span><span class="diff-line del">-                                           if (tautulli_themepark_enabled and global_themepark_plugin_enabled)</span><span class="diff-line del">-                                           else &#x27;&#x27;) }}&quot;</span><span class="diff-line del">-tautulli_traefik_middleware_custom: &quot;&quot;</span><span class="diff-line del">-tautulli_traefik_certresolver: &quot;{{ traefik_default_certresolver }}&quot;</span><span class="diff-line del">-tautulli_traefik_enabled: true</span><span class="diff-line del">-tautulli_traefik_api_enabled: true</span><span class="diff-line del">-tautulli_traefik_api_endpoint: &quot;PathPrefix(`/api`) || PathPrefix(`/newsletter`) || PathPrefix(`/image`) || PathPrefix(`/pms_image_proxy`)&quot;</span><span class="diff-line del">-tautulli_traefik_gzip_enabled: false</span><span class="diff-line add">+tautulli_role_traefik_sso_middleware: &quot;{{ traefik_default_sso_middleware }}&quot;</span><span class="diff-line add">+tautulli_role_traefik_middleware_default: &quot;{{ traefik_default_middleware</span><span class="diff-line add">+                                              + (&#x27;,themepark-&#x27; + tautulli_name</span><span class="diff-line add">+                                                if (lookup(&#x27;role_var&#x27;, &#x27;_themepark_enabled&#x27;, role=&#x27;tautulli&#x27;) and global_themepark_plugin_enabled)</span><span class="diff-line add">+                                                else &#x27;&#x27;) }}&quot;</span><span class="diff-line add">+tautulli_role_traefik_middleware_custom: &quot;&quot;</span><span class="diff-line add">+tautulli_role_traefik_certresolver: &quot;{{ traefik_default_certresolver }}&quot;</span><span class="diff-line add">+tautulli_role_traefik_enabled: true</span><span class="diff-line add">+tautulli_role_traefik_api_enabled: true</span><span class="diff-line add">+tautulli_role_traefik_api_endpoint: &quot;PathPrefix(`/api`) || PathPrefix(`/newsletter`) || PathPrefix(`/image`) || PathPrefix(`/pms_image_proxy`)&quot;</span><span class="diff-line add">+tautulli_role_traefik_gzip_enabled: false</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line del">-# THEME</span><span class="diff-line add">+# Theme</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line context"> # Options can be found at https://github.com/themepark-dev/theme.park</span><span class="diff-line del">-tautulli_themepark_enabled: false</span><span class="diff-line del">-tautulli_themepark_app: &quot;tautulli&quot;</span><span class="diff-line del">-tautulli_themepark_theme: &quot;{{ global_themepark_theme }}&quot;</span><span class="diff-line del">-tautulli_themepark_domain: &quot;{{ global_themepark_domain }}&quot;</span><span class="diff-line del">-tautulli_themepark_addons: []</span><span class="diff-line add">+tautulli_role_themepark_enabled: false</span><span class="diff-line add">+tautulli_role_themepark_app: &quot;tautulli&quot;</span><span class="diff-line add">+tautulli_role_themepark_theme: &quot;{{ global_themepark_theme }}&quot;</span><span class="diff-line add">+tautulli_role_themepark_domain: &quot;{{ global_themepark_domain }}&quot;</span><span class="diff-line add">+tautulli_role_themepark_addons: []</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # Docker</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line context"> # Container</span><span class="diff-line del">-tautulli_docker_container: &quot;{{ tautulli_name }}&quot;</span><span class="diff-line add">+tautulli_role_docker_container: &quot;{{ tautulli_name }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Image</span><span class="diff-line del">-tautulli_docker_image_pull: true</span><span class="diff-line del">-tautulli_docker_image_repo: &quot;ghcr.io/hotio/tautulli&quot;</span><span class="diff-line del">-tautulli_docker_image_tag: &quot;release&quot;</span><span class="diff-line del">-tautulli_docker_image: &quot;{{ lookup(&#x27;vars&#x27;, tautulli_name + &#x27;_docker_image_repo&#x27;, default=tautulli_docker_image_repo)</span><span class="diff-line del">-                           + &#x27;:&#x27; + lookup(&#x27;vars&#x27;, tautulli_name + &#x27;_docker_image_tag&#x27;, default=tautulli_docker_image_tag) }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Ports</span><span class="diff-line del">-tautulli_docker_ports_defaults: []</span><span class="diff-line del">-tautulli_docker_ports_custom: []</span><span class="diff-line del">-tautulli_docker_ports: &quot;{{ lookup(&#x27;vars&#x27;, tautulli_name + &#x27;_docker_ports_defaults&#x27;, default=tautulli_docker_ports_defaults)</span><span class="diff-line del">-                           + lookup(&#x27;vars&#x27;, tautulli_name + &#x27;_docker_ports_custom&#x27;, default=tautulli_docker_ports_custom) }}&quot;</span><span class="diff-line add">+tautulli_role_docker_image_pull: true</span><span class="diff-line add">+tautulli_role_docker_image_repo: &quot;ghcr.io/hotio/tautulli&quot;</span><span class="diff-line add">+tautulli_role_docker_image_tag: &quot;release&quot;</span><span class="diff-line add">+tautulli_role_docker_image: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_image_repo&#x27;, role=&#x27;tautulli&#x27;) }}:{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_image_tag&#x27;, role=&#x27;tautulli&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Envs</span><span class="diff-line del">-tautulli_docker_envs_default:</span><span class="diff-line add">+tautulli_role_docker_envs_default:</span><span class="diff-line context">   PUID: &quot;{{ uid }}&quot;</span><span class="diff-line context">   PGID: &quot;{{ gid }}&quot;</span><span class="diff-line context">   UMASK: &quot;002&quot;</span><span class="diff-line context">   TZ: &quot;{{ tz }}&quot;</span><span class="diff-line del">-tautulli_docker_envs_custom: {}</span><span class="diff-line del">-tautulli_docker_envs: &quot;{{ lookup(&#x27;vars&#x27;, tautulli_name + &#x27;_docker_envs_default&#x27;, default=tautulli_docker_envs_default)</span><span class="diff-line del">-                          | combine(lookup(&#x27;vars&#x27;, tautulli_name + &#x27;_docker_envs_custom&#x27;, default=tautulli_docker_envs_custom)) }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Commands</span><span class="diff-line del">-tautulli_docker_commands_default: []</span><span class="diff-line del">-tautulli_docker_commands_custom: []</span><span class="diff-line del">-tautulli_docker_commands: &quot;{{ lookup(&#x27;vars&#x27;, tautulli_name + &#x27;_docker_commands_default&#x27;, default=tautulli_docker_commands_default)</span><span class="diff-line del">-                              + lookup(&#x27;vars&#x27;, tautulli_name + &#x27;_docker_commands_custom&#x27;, default=tautulli_docker_commands_custom) }}&quot;</span><span class="diff-line add">+tautulli_role_docker_envs_custom: {}</span><span class="diff-line add">+tautulli_role_docker_envs: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_envs_default&#x27;, role=&#x27;tautulli&#x27;)</span><span class="diff-line add">+                               | combine(lookup(&#x27;role_var&#x27;, &#x27;_docker_envs_custom&#x27;, role=&#x27;tautulli&#x27;)) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Volumes</span><span class="diff-line del">-tautulli_docker_volumes_default:</span><span class="diff-line del">-  - &quot;{{ tautulli_paths_location }}:/config&quot;</span><span class="diff-line add">+tautulli_role_docker_volumes_default:</span><span class="diff-line add">+  - &quot;{{ tautulli_role_paths_location }}:/config&quot;</span><span class="diff-line context">   - &quot;{{ server_appdata_path }}/scripts:/scripts&quot;</span><span class="diff-line del">-tautulli_docker_volumes_custom: []</span><span class="diff-line del">-tautulli_docker_volumes: &quot;{{ lookup(&#x27;vars&#x27;, tautulli_name + &#x27;_docker_volumes_default&#x27;, default=tautulli_docker_volumes_default)</span><span class="diff-line del">-                             + lookup(&#x27;vars&#x27;, tautulli_name + &#x27;_docker_volumes_custom&#x27;, default=tautulli_docker_volumes_custom) }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Devices</span><span class="diff-line del">-tautulli_docker_devices_default: []</span><span class="diff-line del">-tautulli_docker_devices_custom: []</span><span class="diff-line del">-tautulli_docker_devices: &quot;{{ lookup(&#x27;vars&#x27;, tautulli_name + &#x27;_docker_devices_default&#x27;, default=tautulli_docker_devices_default)</span><span class="diff-line del">-                             + lookup(&#x27;vars&#x27;, tautulli_name + &#x27;_docker_devices_custom&#x27;, default=tautulli_docker_devices_custom) }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Hosts</span><span class="diff-line del">-tautulli_docker_hosts_default: {}</span><span class="diff-line del">-tautulli_docker_hosts_custom: {}</span><span class="diff-line del">-tautulli_docker_hosts: &quot;{{ docker_hosts_common</span><span class="diff-line del">-                           | combine(lookup(&#x27;vars&#x27;, tautulli_name + &#x27;_docker_hosts_default&#x27;, default=tautulli_docker_hosts_default))</span><span class="diff-line del">-                           | combine(lookup(&#x27;vars&#x27;, tautulli_name + &#x27;_docker_hosts_custom&#x27;, default=tautulli_docker_hosts_custom)) }}&quot;</span><span class="diff-line add">+tautulli_role_docker_volumes_custom: []</span><span class="diff-line add">+tautulli_role_docker_volumes: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_volumes_default&#x27;, role=&#x27;tautulli&#x27;)</span><span class="diff-line add">+                                  + lookup(&#x27;role_var&#x27;, &#x27;_docker_volumes_custom&#x27;, role=&#x27;tautulli&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Labels</span><span class="diff-line del">-tautulli_docker_labels_default: {}</span><span class="diff-line del">-tautulli_docker_labels_custom: {}</span><span class="diff-line del">-tautulli_docker_labels: &quot;{{ docker_labels_common</span><span class="diff-line del">-                            | combine(lookup(&#x27;vars&#x27;, tautulli_name + &#x27;_docker_labels_default&#x27;, default=tautulli_docker_labels_default))</span><span class="diff-line del">-                            | combine((traefik_themepark_labels</span><span class="diff-line del">-                                      if (tautulli_themepark_enabled and global_themepark_plugin_enabled)</span><span class="diff-line del">-                                      else {}),</span><span class="diff-line del">-                                      lookup(&#x27;vars&#x27;, tautulli_name + &#x27;_docker_labels_custom&#x27;, default=tautulli_docker_labels_custom)) }}&quot;</span><span class="diff-line add">+tautulli_role_docker_labels_default: {}</span><span class="diff-line add">+tautulli_role_docker_labels_custom: {}</span><span class="diff-line add">+tautulli_role_docker_labels: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_labels_default&#x27;, role=&#x27;tautulli&#x27;)</span><span class="diff-line add">+                                 | combine((traefik_themepark_labels</span><span class="diff-line add">+                                           if (lookup(&#x27;role_var&#x27;, &#x27;_themepark_enabled&#x27;, role=&#x27;tautulli&#x27;) and global_themepark_plugin_enabled)</span><span class="diff-line add">+                                           else {}),</span><span class="diff-line add">+                                           lookup(&#x27;role_var&#x27;, &#x27;_docker_labels_custom&#x27;, role=&#x27;tautulli&#x27;)) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Hostname</span><span class="diff-line del">-tautulli_docker_hostname: &quot;{{ tautulli_name }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Network Mode</span><span class="diff-line del">-tautulli_docker_network_mode_default: &quot;{{ docker_networks_name_common }}&quot;</span><span class="diff-line del">-tautulli_docker_network_mode: &quot;{{ lookup(&#x27;vars&#x27;, tautulli_name + &#x27;_docker_network_mode_default&#x27;, default=tautulli_docker_network_mode_default) }}&quot;</span><span class="diff-line add">+tautulli_role_docker_hostname: &quot;{{ tautulli_name }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Networks</span><span class="diff-line del">-tautulli_docker_networks_alias: &quot;{{ tautulli_name }}&quot;</span><span class="diff-line del">-tautulli_docker_networks_default: []</span><span class="diff-line del">-tautulli_docker_networks_custom: []</span><span class="diff-line del">-tautulli_docker_networks: &quot;{{ docker_networks_common</span><span class="diff-line del">-                              + lookup(&#x27;vars&#x27;, tautulli_name + &#x27;_docker_networks_default&#x27;, default=tautulli_docker_networks_default)</span><span class="diff-line del">-                              + lookup(&#x27;vars&#x27;, tautulli_name + &#x27;_docker_networks_custom&#x27;, default=tautulli_docker_networks_custom) }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Capabilities</span><span class="diff-line del">-tautulli_docker_capabilities_default: []</span><span class="diff-line del">-tautulli_docker_capabilities_custom: []</span><span class="diff-line del">-tautulli_docker_capabilities: &quot;{{ lookup(&#x27;vars&#x27;, tautulli_name + &#x27;_docker_capabilities_default&#x27;, default=tautulli_docker_capabilities_default)</span><span class="diff-line del">-                                  + lookup(&#x27;vars&#x27;, tautulli_name + &#x27;_docker_capabilities_custom&#x27;, default=tautulli_docker_capabilities_custom) }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Security Opts</span><span class="diff-line del">-tautulli_docker_security_opts_default: []</span><span class="diff-line del">-tautulli_docker_security_opts_custom: []</span><span class="diff-line del">-tautulli_docker_security_opts: &quot;{{ lookup(&#x27;vars&#x27;, tautulli_name + &#x27;_docker_security_opts_default&#x27;, default=tautulli_docker_security_opts_default)</span><span class="diff-line del">-                                   + lookup(&#x27;vars&#x27;, tautulli_name + &#x27;_docker_security_opts_custom&#x27;, default=tautulli_docker_security_opts_custom) }}&quot;</span><span class="diff-line add">+tautulli_role_docker_networks_alias: &quot;{{ tautulli_name }}&quot;</span><span class="diff-line add">+tautulli_role_docker_networks_default: []</span><span class="diff-line add">+tautulli_role_docker_networks_custom: []</span><span class="diff-line add">+tautulli_role_docker_networks: &quot;{{ docker_networks_common</span><span class="diff-line add">+                                   + lookup(&#x27;role_var&#x27;, &#x27;_docker_networks_default&#x27;, role=&#x27;tautulli&#x27;)</span><span class="diff-line add">+                                   + lookup(&#x27;role_var&#x27;, &#x27;_docker_networks_custom&#x27;, role=&#x27;tautulli&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Restart Policy</span><span class="diff-line del">-tautulli_docker_restart_policy: unless-stopped</span><span class="diff-line add">+tautulli_role_docker_restart_policy: unless-stopped</span><span class="diff-line context"> </span><span class="diff-line context"> # State</span><span class="diff-line del">-tautulli_docker_state: started</span><span class="diff-line add">+tautulli_role_docker_state: started</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-360">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/tautulli/tasks/main2.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -10,9 +10,9 @@</span><span class="diff-line context"> - name: Add DNS record</span><span class="diff-line context">   ansible.builtin.include_tasks: &quot;{{ resources_tasks_path }}/dns/tasker.yml&quot;</span><span class="diff-line context">   vars:</span><span class="diff-line del">-    dns_record: &quot;{{ lookup(&#x27;vars&#x27;, role_name + &#x27;_dns_record&#x27;) }}&quot;</span><span class="diff-line del">-    dns_zone: &quot;{{ lookup(&#x27;vars&#x27;, role_name + &#x27;_dns_zone&#x27;) }}&quot;</span><span class="diff-line del">-    dns_proxy: &quot;{{ lookup(&#x27;vars&#x27;, role_name + &#x27;_dns_proxy&#x27;) }}&quot;</span><span class="diff-line add">+    dns_record: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_dns_record&#x27;) }}&quot;</span><span class="diff-line add">+    dns_zone: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_dns_zone&#x27;) }}&quot;</span><span class="diff-line add">+    dns_proxy: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_dns_proxy&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Remove existing Docker container</span><span class="diff-line context">   ansible.builtin.include_tasks: &quot;{{ resources_tasks_path }}/docker/remove_docker_container.yml&quot;</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-361">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/traefik/defaults/main.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -18,36 +18,13 @@</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line context"> traefik_trusted_ips: &quot;&quot;</span><span class="diff-line del">-traefik_cloudflare_ips:</span><span class="diff-line del">-  - 173.245.48.0/20</span><span class="diff-line del">-  - 103.21.244.0/22</span><span class="diff-line del">-  - 103.22.200.0/22</span><span class="diff-line del">-  - 103.31.4.0/22</span><span class="diff-line del">-  - 141.101.64.0/18</span><span class="diff-line del">-  - 108.162.192.0/18</span><span class="diff-line del">-  - 190.93.240.0/20</span><span class="diff-line del">-  - 188.114.96.0/20</span><span class="diff-line del">-  - 197.234.240.0/22</span><span class="diff-line del">-  - 198.41.128.0/17</span><span class="diff-line del">-  - 162.158.0.0/15</span><span class="diff-line del">-  - 104.16.0.0/13</span><span class="diff-line del">-  - 104.24.0.0/14</span><span class="diff-line del">-  - 172.64.0.0/13</span><span class="diff-line del">-  - 131.0.72.0/22</span><span class="diff-line del">-  - 2400:cb00::/32</span><span class="diff-line del">-  - 2606:4700::/32</span><span class="diff-line del">-  - 2803:f800::/32</span><span class="diff-line del">-  - 2405:b500::/32</span><span class="diff-line del">-  - 2405:8100::/32</span><span class="diff-line del">-  - 2a06:98c0::/29</span><span class="diff-line del">-  - 2c0f:f248::/32</span><span class="diff-line context"> traefik_plugin_cloudflarewarp_enabled: true</span><span class="diff-line context"> traefik_file_watch: &quot;true&quot;</span><span class="diff-line context"> traefik_x_robots: &quot;none,noarchive,nosnippet,notranslate,noimageindex&quot;</span><span class="diff-line context"> # HTTP3 can cause issues with some apps</span><span class="diff-line context"> traefik_http3: false</span><span class="diff-line context"> traefik_tailscale_enabled: false</span><span class="diff-line del">-# traefik_tailscale_bind_ip: &quot;&quot; # Set to override the WANIP port binding when server is not connected directly to the Internet.</span><span class="diff-line add">+# traefik_tailscale_bind_ip: &quot;&quot; # Set to override the WAN IP port binding when server is not connected directly to the Internet.</span><span class="diff-line context"> # traefik_tailscale_bind_ipv6: &quot;&quot; # Same but IPv6</span><span class="diff-line context"> traefik_entrypoint_web_port: &quot;80&quot;</span><span class="diff-line context"> traefik_entrypoint_web_readtimeout: &quot;600&quot;</span><span class="diff-line hunk">@@ -75,7 +52,7 @@</span><span class="diff-line context"> #     type: both</span><span class="diff-line context"> traefik_dns_resolvers: &quot;1.1.1.1:53,1.0.0.1:53&quot;</span><span class="diff-line context"> traefik_disable_propagation_check: false</span><span class="diff-line del">-traefik_enable_http_validation: &quot;{{ traefik_http or traefik.cert.http_validation }}&quot;</span><span class="diff-line add">+traefik_enable_http_validation: &quot;{{ traefik_http or (traefik.cert.http_validation | bool) }}&quot;</span><span class="diff-line context"> traefik_enable_zerossl: true</span><span class="diff-line context"> # Path is internal to the container, so a host path of /opt/traefik/file.html becomes /etc/traefik/file.html</span><span class="diff-line context"> traefik_crowdsec_ban_filepath: &quot;/etc/traefik/ban.html&quot;</span><span class="diff-line hunk">@@ -105,55 +82,66 @@</span><span class="diff-line context">   - &quot;{{ item.value.port }}:{{ item.value.port }}/tcp&quot;</span><span class="diff-line context">   - &quot;{{ item.value.port }}:{{ item.value.port }}/udp&quot;</span><span class="diff-line context"> </span><span class="diff-line add">+traefik_trusted_ips_template: &quot;{{ traefik_trusted_ips</span><span class="diff-line add">+                               if (traefik_trusted_ips | length &gt; 0)</span><span class="diff-line add">+                               else &#x27;&#x27; }}&quot;</span><span class="diff-line add">+</span><span class="diff-line add">+################################</span><span class="diff-line add">+# Lookups</span><span class="diff-line add">+################################</span><span class="diff-line add">+</span><span class="diff-line add">+traefik_zerossl_file_ini: &quot;{{ server_appdata_path }}/saltbox/zerossl.ini&quot;</span><span class="diff-line add">+</span><span class="diff-line context"> ################################</span><span class="diff-line context"> # Booleans</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-traefik_authelia_enabled: &quot;{{ &#x27;authelia&#x27; in traefik_default_sso_middleware }}&quot;</span><span class="diff-line del">-traefik_authentik_enabled: &quot;{{ &#x27;authentik&#x27; in traefik_default_sso_middleware }}&quot;</span><span class="diff-line add">+traefik_role_authelia_enabled: &quot;{{ &#x27;authelia&#x27; in traefik_default_sso_middleware }}&quot;</span><span class="diff-line add">+traefik_role_authentik_enabled: &quot;{{ &#x27;authentik&#x27; in traefik_default_sso_middleware }}&quot;</span><span class="diff-line add">+traefik_role_metrics_enabled: &quot;{{ traefik.metrics | bool }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # Paths</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-traefik_paths_folder: &quot;{{ traefik_name }}&quot;</span><span class="diff-line del">-traefik_paths_location: &quot;{{ server_appdata_path }}/{{ traefik_paths_folder }}&quot;</span><span class="diff-line del">-traefik_paths_acme_config_location: &quot;{{ traefik_paths_location }}/acme.json&quot;</span><span class="diff-line del">-traefik_paths_folders_list:</span><span class="diff-line del">-  - &quot;{{ traefik_paths_location }}&quot;</span><span class="diff-line add">+traefik_role_paths_folder: &quot;{{ traefik_name }}&quot;</span><span class="diff-line add">+traefik_role_paths_location: &quot;{{ server_appdata_path }}/{{ traefik_role_paths_folder }}&quot;</span><span class="diff-line add">+traefik_role_paths_acme_config_location: &quot;{{ traefik_role_paths_location }}/acme.json&quot;</span><span class="diff-line add">+traefik_role_paths_folders_list:</span><span class="diff-line add">+  - &quot;{{ traefik_role_paths_location }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # Web</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-traefik_web_subdomain: &quot;{{ traefik.subdomains.dash }}&quot;</span><span class="diff-line del">-traefik_web_domain: &quot;{{ user.domain }}&quot;</span><span class="diff-line del">-traefik_metrics_subdomain: &quot;{{ traefik.subdomains.metrics }}&quot;</span><span class="diff-line del">-traefik_metrics_domain: &quot;{{ user.domain }}&quot;</span><span class="diff-line add">+traefik_role_web_subdomain: &quot;{{ traefik.subdomains.dash }}&quot;</span><span class="diff-line add">+traefik_role_web_domain: &quot;{{ user.domain }}&quot;</span><span class="diff-line add">+traefik_role_metrics_subdomain: &quot;{{ traefik.subdomains.metrics }}&quot;</span><span class="diff-line add">+traefik_role_metrics_domain: &quot;{{ user.domain }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # Logging</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-traefik_log_level: &quot;ERROR&quot;</span><span class="diff-line del">-traefik_log_file: true</span><span class="diff-line del">-traefik_log_max_size: &quot;10&quot;</span><span class="diff-line del">-traefik_log_max_backups: &quot;3&quot;</span><span class="diff-line del">-traefik_log_max_age: &quot;3&quot;</span><span class="diff-line del">-traefik_log_compress: &quot;true&quot;</span><span class="diff-line del">-traefik_access_log: true</span><span class="diff-line del">-traefik_access_buffer: 100</span><span class="diff-line add">+traefik_role_log_level: &quot;ERROR&quot;</span><span class="diff-line add">+traefik_role_log_file: true</span><span class="diff-line add">+traefik_role_log_max_size: &quot;10&quot;</span><span class="diff-line add">+traefik_role_log_max_backups: &quot;3&quot;</span><span class="diff-line add">+traefik_role_log_max_age: &quot;3&quot;</span><span class="diff-line add">+traefik_role_log_compress: &quot;true&quot;</span><span class="diff-line add">+traefik_role_access_log: true</span><span class="diff-line add">+traefik_role_access_buffer: 100</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # DNS</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-traefik_dns_record: &quot;{{ traefik_web_subdomain }}&quot;</span><span class="diff-line del">-traefik_dns_zone: &quot;{{ traefik_web_domain }}&quot;</span><span class="diff-line del">-traefik_dns_proxy: &quot;{{ dns.proxied }}&quot;</span><span class="diff-line del">-traefik_metrics_dns_record: &quot;{{ traefik_metrics_subdomain }}&quot;</span><span class="diff-line del">-traefik_metrics_dns_zone: &quot;{{ traefik_metrics_domain }}&quot;</span><span class="diff-line del">-traefik_metrics_dns_proxy: &quot;{{ dns.proxied }}&quot;</span><span class="diff-line add">+traefik_role_dns_record: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_web_subdomain&#x27;, role=&#x27;traefik&#x27;) }}&quot;</span><span class="diff-line add">+traefik_role_dns_zone: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_web_domain&#x27;, role=&#x27;traefik&#x27;) }}&quot;</span><span class="diff-line add">+traefik_role_dns_proxy: &quot;{{ dns_proxied }}&quot;</span><span class="diff-line add">+traefik_role_metrics_dns_record: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_metrics_subdomain&#x27;, role=&#x27;traefik&#x27;) }}&quot;</span><span class="diff-line add">+traefik_role_metrics_dns_zone: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_metrics_domain&#x27;, role=&#x27;traefik&#x27;) }}&quot;</span><span class="diff-line add">+traefik_role_metrics_dns_proxy: &quot;{{ dns_proxied }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # DNS Provider</span><span class="diff-line hunk">@@ -224,51 +212,52 @@</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line context"> # Container</span><span class="diff-line del">-traefik_docker_container: &quot;{{ traefik_name }}&quot;</span><span class="diff-line add">+traefik_role_docker_container: &quot;{{ traefik_name }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Image</span><span class="diff-line del">-traefik_docker_image_pull: true</span><span class="diff-line del">-traefik_docker_image_tag: &quot;v3.6&quot;</span><span class="diff-line del">-traefik_docker_image: &quot;traefik:{{ traefik_docker_image_tag }}&quot;</span><span class="diff-line add">+traefik_role_docker_image_pull: true</span><span class="diff-line add">+traefik_role_docker_image_repo: &quot;traefik&quot;</span><span class="diff-line add">+traefik_role_docker_image_tag: &quot;v3.6&quot;</span><span class="diff-line add">+traefik_role_docker_image: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_image_repo&#x27;, role=&#x27;traefik&#x27;) }}:{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_image_tag&#x27;, role=&#x27;traefik&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Ports</span><span class="diff-line del">-traefik_docker_ports_defaults:</span><span class="diff-line add">+traefik_role_docker_ports_default:</span><span class="diff-line context">   - &quot;{{ traefik_entrypoint_web_port }}:{{ traefik_entrypoint_web_port }}/tcp&quot;</span><span class="diff-line context">   - &quot;{{ traefik_entrypoint_websecure_port }}:{{ traefik_entrypoint_websecure_port }}/tcp&quot;</span><span class="diff-line context">   - &quot;{{ traefik_entrypoint_websecure_port }}:{{ traefik_entrypoint_websecure_port }}/udp&quot;</span><span class="diff-line del">-traefik_docker_ports_tailscale_ipv4_defaults:</span><span class="diff-line add">+traefik_role_docker_ports_tailscale_ipv4_default:</span><span class="diff-line context">   - &quot;{{ lookup(&#x27;vars&#x27;, &#x27;traefik_tailscale_bind_ip&#x27;, default=ip_address_public) + &#x27;:&#x27; + traefik_entrypoint_web_port }}:{{ traefik_entrypoint_web_port }}/tcp&quot;</span><span class="diff-line context">   - &quot;{{ lookup(&#x27;vars&#x27;, &#x27;traefik_tailscale_bind_ip&#x27;, default=ip_address_public) + &#x27;:&#x27; + traefik_entrypoint_websecure_port }}:{{ traefik_entrypoint_websecure_port }}/tcp&quot;</span><span class="diff-line context">   - &quot;{{ lookup(&#x27;vars&#x27;, &#x27;traefik_tailscale_bind_ip&#x27;, default=ip_address_public) + &#x27;:&#x27; + traefik_entrypoint_websecure_port }}:{{ traefik_entrypoint_websecure_port }}/udp&quot;</span><span class="diff-line context">   - &quot;{{ tailscale_ipv4 + &#x27;:&#x27; + traefik_entrypoint_web_port }}:81/tcp&quot;</span><span class="diff-line context">   - &quot;{{ tailscale_ipv4 + &#x27;:&#x27; + traefik_entrypoint_websecure_port }}:444/tcp&quot;</span><span class="diff-line context">   - &quot;{{ tailscale_ipv4 + &#x27;:&#x27; + traefik_entrypoint_websecure_port }}:444/udp&quot;</span><span class="diff-line del">-traefik_docker_ports_tailscale_ipv6_defaults:</span><span class="diff-line add">+traefik_role_docker_ports_tailscale_ipv6_default:</span><span class="diff-line context">   - &quot;{{ &#x27;[&#x27; + lookup(&#x27;vars&#x27;, &#x27;traefik_tailscale_bind_ipv6&#x27;, default=ipv6_address_public) + &#x27;]:&#x27; + traefik_entrypoint_web_port }}:{{ traefik_entrypoint_web_port }}/tcp&quot;</span><span class="diff-line context">   - &quot;{{ &#x27;[&#x27; + lookup(&#x27;vars&#x27;, &#x27;traefik_tailscale_bind_ipv6&#x27;, default=ipv6_address_public) + &#x27;]:&#x27; + traefik_entrypoint_websecure_port }}:{{ traefik_entrypoint_websecure_port }}/tcp&quot;</span><span class="diff-line context">   - &quot;{{ &#x27;[&#x27; + lookup(&#x27;vars&#x27;, &#x27;traefik_tailscale_bind_ipv6&#x27;, default=ipv6_address_public) + &#x27;]:&#x27; + traefik_entrypoint_websecure_port }}:{{ traefik_entrypoint_websecure_port }}/udp&quot;</span><span class="diff-line context">   - &quot;{{ &#x27;[&#x27; + tailscale_ipv6 + &#x27;]:&#x27; + traefik_entrypoint_web_port }}:81/tcp&quot;</span><span class="diff-line context">   - &quot;{{ &#x27;[&#x27; + tailscale_ipv6 + &#x27;]:&#x27; + traefik_entrypoint_websecure_port }}:444/tcp&quot;</span><span class="diff-line context">   - &quot;{{ &#x27;[&#x27; + tailscale_ipv6 + &#x27;]:&#x27; + traefik_entrypoint_websecure_port }}:444/udp&quot;</span><span class="diff-line del">-traefik_docker_ports_custom: []</span><span class="diff-line del">-traefik_docker_ports: &quot;{{ (traefik_docker_ports_defaults</span><span class="diff-line del">-                          if not traefik_tailscale_enabled</span><span class="diff-line del">-                          else traefik_docker_ports_tailscale_ipv4_defaults</span><span class="diff-line del">-                               + (traefik_docker_ports_tailscale_ipv6_defaults</span><span class="diff-line del">-                                 if dns.ipv6</span><span class="diff-line del">-                                 else []))</span><span class="diff-line del">-                          + traefik_docker_ports_custom }}&quot;</span><span class="diff-line add">+traefik_role_docker_ports_custom: []</span><span class="diff-line add">+traefik_role_docker_ports: &quot;{{ (lookup(&#x27;role_var&#x27;, &#x27;_docker_ports_default&#x27;, role=&#x27;traefik&#x27;)</span><span class="diff-line add">+                               if not traefik_tailscale_enabled</span><span class="diff-line add">+                               else lookup(&#x27;role_var&#x27;, &#x27;_docker_ports_tailscale_ipv4_default&#x27;, role=&#x27;traefik&#x27;)</span><span class="diff-line add">+                                    + (lookup(&#x27;role_var&#x27;, &#x27;_docker_ports_tailscale_ipv6_default&#x27;, role=&#x27;traefik&#x27;)</span><span class="diff-line add">+                                      if dns_ipv6_enabled</span><span class="diff-line add">+                                      else []))</span><span class="diff-line add">+                               + lookup(&#x27;role_var&#x27;, &#x27;_docker_ports_custom&#x27;, role=&#x27;traefik&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Envs</span><span class="diff-line del">-traefik_docker_envs_default:</span><span class="diff-line add">+traefik_role_docker_envs_default:</span><span class="diff-line context">   TZ: &quot;{{ tz }}&quot;</span><span class="diff-line del">-traefik_docker_envs_custom: {}</span><span class="diff-line del">-traefik_docker_envs: &quot;{{ traefik_docker_envs_default</span><span class="diff-line del">-                         | combine(lookup(&#x27;vars&#x27;, &#x27;traefik_dns_provider_&#x27; + traefik_challenge_provider, default={}))</span><span class="diff-line del">-                         | combine(traefik_docker_envs_custom) }}&quot;</span><span class="diff-line add">+traefik_role_docker_envs_custom: {}</span><span class="diff-line add">+traefik_role_docker_envs: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_envs_default&#x27;, role=&#x27;traefik&#x27;)</span><span class="diff-line add">+                              | combine(lookup(&#x27;vars&#x27;, &#x27;traefik_dns_provider_&#x27; + traefik_challenge_provider, default={}))</span><span class="diff-line add">+                              | combine(lookup(&#x27;role_var&#x27;, &#x27;_docker_envs_custom&#x27;, role=&#x27;traefik&#x27;)) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Commands</span><span class="diff-line del">-traefik_docker_commands_default:</span><span class="diff-line add">+traefik_role_docker_commands_default:</span><span class="diff-line context">   - &quot;--global.sendanonymoususage=false&quot;</span><span class="diff-line context">   - &quot;--providers.file.directory=/etc/traefik&quot;</span><span class="diff-line context">   - &quot;--providers.file.watch={{ traefik_file_watch }}&quot;</span><span class="diff-line hunk">@@ -276,15 +265,15 @@</span><span class="diff-line context">   - &quot;--providers.docker.exposedbydefault=false&quot;</span><span class="diff-line context">   - &quot;--entrypoints.internal.address=:8080&quot;</span><span class="diff-line context">   - &quot;--entrypoints.web.address=:{{ traefik_entrypoint_web_port }}&quot;</span><span class="diff-line del">-  - &quot;{{ &#x27;--entrypoints.web.forwardedheaders.trustedIPs=&#x27; + (traefik_cloudflare_ips | join(&#x27;,&#x27;)) + (&#x27;,&#x27; + traefik_trusted_ips if (traefik_trusted_ips | length &gt; 0) else &#x27;&#x27;) }}&quot;</span><span class="diff-line del">-  - &quot;{{ &#x27;--entrypoints.web.proxyprotocol.trustedIPs=&#x27; + (traefik_cloudflare_ips | join(&#x27;,&#x27;)) + (&#x27;,&#x27; + traefik_trusted_ips if (traefik_trusted_ips | length &gt; 0) else &#x27;&#x27;) }}&quot;</span><span class="diff-line add">+  - &quot;{{ (&#x27;--entrypoints.web.forwardedheaders.trustedIPs=&#x27; + traefik_trusted_ips_template) if (traefik_trusted_ips_template | length &gt; 0) else omit }}&quot;</span><span class="diff-line add">+  - &quot;{{ (&#x27;--entrypoints.web.proxyprotocol.trustedIPs=&#x27; + traefik_trusted_ips_template) if (traefik_trusted_ips_template | length &gt; 0) else omit }}&quot;</span><span class="diff-line context">   - &quot;--entrypoints.web.transport.respondingTimeouts.readTimeout={{ traefik_entrypoint_web_readtimeout }}&quot;</span><span class="diff-line context">   - &quot;--entrypoints.web.transport.respondingTimeouts.writeTimeout={{ traefik_entrypoint_web_writetimeout }}&quot;</span><span class="diff-line context">   - &quot;--entrypoints.web.transport.respondingTimeouts.idleTimeout={{ traefik_entrypoint_web_idletimeout }}&quot;</span><span class="diff-line context">   - &quot;--entrypoints.web.http.maxheaderbytes={{ traefik_entrypoint_web_request_maxheaderbytes }}&quot;</span><span class="diff-line context">   - &quot;--entrypoints.websecure.address=:{{ traefik_entrypoint_websecure_port }}&quot;</span><span class="diff-line del">-  - &quot;{{ &#x27;--entrypoints.websecure.forwardedheaders.trustedIPs=&#x27; + (traefik_cloudflare_ips | join(&#x27;,&#x27;)) + (&#x27;,&#x27; + traefik_trusted_ips if (traefik_trusted_ips | length &gt; 0) else &#x27;&#x27;) }}&quot;</span><span class="diff-line del">-  - &quot;{{ &#x27;--entrypoints.websecure.proxyprotocol.trustedIPs=&#x27; + (traefik_cloudflare_ips | join(&#x27;,&#x27;)) + (&#x27;,&#x27; + traefik_trusted_ips if (traefik_trusted_ips | length &gt; 0) else &#x27;&#x27;) }}&quot;</span><span class="diff-line add">+  - &quot;{{ (&#x27;--entrypoints.websecure.forwardedheaders.trustedIPs=&#x27; + traefik_trusted_ips_template) if (traefik_trusted_ips_template | length &gt; 0) else omit }}&quot;</span><span class="diff-line add">+  - &quot;{{ (&#x27;--entrypoints.websecure.proxyprotocol.trustedIPs=&#x27; + traefik_trusted_ips_template) if (traefik_trusted_ips_template | length &gt; 0) else omit }}&quot;</span><span class="diff-line context">   - &quot;--entrypoints.websecure.transport.respondingTimeouts.readTimeout={{ traefik_entrypoint_websecure_readtimeout }}&quot;</span><span class="diff-line context">   - &quot;--entrypoints.websecure.transport.respondingTimeouts.writeTimeout={{ traefik_entrypoint_websecure_writetimeout }}&quot;</span><span class="diff-line context">   - &quot;--entrypoints.websecure.transport.respondingTimeouts.idleTimeout={{ traefik_entrypoint_websecure_idletimeout }}&quot;</span><span class="diff-line hunk">@@ -292,26 +281,26 @@</span><span class="diff-line context">   - &quot;--entrypoints.websecure.http.tls.certResolver={{ traefik_default_certresolver }}&quot;</span><span class="diff-line context">   - &quot;--api.dashboard=true&quot;</span><span class="diff-line context">   - &quot;--api=true&quot;</span><span class="diff-line del">-  - &quot;--log.level={{ traefik_log_level }}&quot;</span><span class="diff-line del">-  - &quot;{{ &#x27;--log.filepath=/etc/traefik/traefik.log&#x27; if traefik_log_file else omit }}&quot;</span><span class="diff-line del">-  - &quot;{{ &#x27;--log.maxsize=&#x27; + traefik_log_max_size if traefik_log_file else omit }}&quot;</span><span class="diff-line del">-  - &quot;{{ &#x27;--log.maxbackups=&#x27; + traefik_log_max_backups if traefik_log_file else omit }}&quot;</span><span class="diff-line del">-  - &quot;{{ &#x27;--log.maxage=&#x27; + traefik_log_max_age if traefik_log_file else omit }}&quot;</span><span class="diff-line del">-  - &quot;{{ &#x27;--log.compress=&#x27; + traefik_log_compress if traefik_log_file else omit }}&quot;</span><span class="diff-line del">-  - &quot;{{ &#x27;--log.nocolor=true&#x27; if traefik_log_file else omit }}&quot;</span><span class="diff-line del">-  - &quot;--accesslog={{ traefik_access_log }}&quot;</span><span class="diff-line add">+  - &quot;--log.level={{ lookup(&#x27;role_var&#x27;, &#x27;_log_level&#x27;, role=&#x27;traefik&#x27;) }}&quot;</span><span class="diff-line add">+  - &quot;{{ (&#x27;--log.filepath=/etc/traefik/traefik.log&#x27;) if lookup(&#x27;role_var&#x27;, &#x27;_log_file&#x27;, role=&#x27;traefik&#x27;) else omit }}&quot;</span><span class="diff-line add">+  - &quot;{{ (&#x27;--log.maxsize=&#x27; + lookup(&#x27;role_var&#x27;, &#x27;_log_max_size&#x27;, role=&#x27;traefik&#x27;)) if lookup(&#x27;role_var&#x27;, &#x27;_log_file&#x27;, role=&#x27;traefik&#x27;) else omit }}&quot;</span><span class="diff-line add">+  - &quot;{{ (&#x27;--log.maxbackups=&#x27; + lookup(&#x27;role_var&#x27;, &#x27;_log_max_backups&#x27;, role=&#x27;traefik&#x27;)) if lookup(&#x27;role_var&#x27;, &#x27;_log_file&#x27;, role=&#x27;traefik&#x27;) else omit }}&quot;</span><span class="diff-line add">+  - &quot;{{ (&#x27;--log.maxage=&#x27; + lookup(&#x27;role_var&#x27;, &#x27;_log_max_age&#x27;, role=&#x27;traefik&#x27;)) if lookup(&#x27;role_var&#x27;, &#x27;_log_file&#x27;, role=&#x27;traefik&#x27;) else omit }}&quot;</span><span class="diff-line add">+  - &quot;{{ (&#x27;--log.compress=&#x27; + lookup(&#x27;role_var&#x27;, &#x27;_log_compress&#x27;, role=&#x27;traefik&#x27;)) if lookup(&#x27;role_var&#x27;, &#x27;_log_file&#x27;, role=&#x27;traefik&#x27;) else omit }}&quot;</span><span class="diff-line add">+  - &quot;{{ &#x27;--log.nocolor=true&#x27; if lookup(&#x27;role_var&#x27;, &#x27;_log_file&#x27;, role=&#x27;traefik&#x27;) else omit }}&quot;</span><span class="diff-line add">+  - &quot;--accesslog={{ lookup(&#x27;role_var&#x27;, &#x27;_access_log&#x27;, role=&#x27;traefik&#x27;) }}&quot;</span><span class="diff-line context">   - &quot;--accesslog.fields.names.StartUTC=drop&quot;</span><span class="diff-line context">   - &quot;--accesslog.fields.headers.names.User-Agent=keep&quot;</span><span class="diff-line context">   - &quot;--accesslog.fields.headers.names.Content-Type=keep&quot;</span><span class="diff-line context">   - &quot;--accesslog.filepath=/etc/traefik/access.log&quot;</span><span class="diff-line del">-  - &quot;--accesslog.bufferingsize={{ traefik_access_buffer }}&quot;</span><span class="diff-line add">+  - &quot;--accesslog.bufferingsize={{ lookup(&#x27;role_var&#x27;, &#x27;_access_buffer&#x27;, role=&#x27;traefik&#x27;) }}&quot;</span><span class="diff-line context">   - &quot;--certificatesresolvers.cfdns.acme.dnschallenge.provider={{ traefik_challenge_provider }}&quot;</span><span class="diff-line del">-  - &quot;{{ &#x27;--certificatesresolvers.cfdns.acme.dnschallenge.resolvers=&#x27; + traefik_dns_resolvers if (traefik_dns_resolvers | length &gt; 0) else omit }}&quot;</span><span class="diff-line add">+  - &quot;{{ (&#x27;--certificatesresolvers.cfdns.acme.dnschallenge.resolvers=&#x27; + traefik_dns_resolvers) if (traefik_dns_resolvers | length &gt; 0) else omit }}&quot;</span><span class="diff-line context">   - &quot;--certificatesresolvers.cfdns.acme.email={{ user.email }}&quot;</span><span class="diff-line context">   - &quot;--certificatesresolvers.cfdns.acme.storage=/etc/traefik/acme.json&quot;</span><span class="diff-line context">   - &quot;{{ &#x27;--certificatesresolvers.cfdns.acme.dnschallenge.propagation.delayBeforeChecks=60s&#x27; if traefik_disable_propagation_check else omit }}&quot;</span><span class="diff-line context">   - &quot;{{ &#x27;--certificatesresolvers.cfdns.acme.dnschallenge.propagation.disableChecks=true&#x27; if traefik_disable_propagation_check else omit }}&quot;</span><span class="diff-line del">-traefik_docker_commands_zerossl_acme:</span><span class="diff-line add">+traefik_role_docker_commands_zerossl_acme:</span><span class="diff-line context">   - &quot;--certificatesresolvers.zerossl.acme.dnschallenge.provider={{ traefik_challenge_provider }}&quot;</span><span class="diff-line context">   - &quot;{{ &#x27;--certificatesresolvers.zerossl.acme.dnschallenge.resolvers=&#x27; + traefik_dns_resolvers if (traefik_dns_resolvers | length &gt; 0) else omit }}&quot;</span><span class="diff-line context">   - &quot;--certificatesresolvers.zerossl.acme.email={{ user.email }}&quot;</span><span class="diff-line hunk">@@ -321,20 +310,20 @@</span><span class="diff-line context">   - &quot;--certificatesresolvers.zerossl.acme.storage=/etc/traefik/acme.json&quot;</span><span class="diff-line context">   - &quot;{{ &#x27;--certificatesresolvers.zerossl.acme.dnschallenge.propagation.delayBeforeChecks=60s&#x27; if traefik_disable_propagation_check else omit }}&quot;</span><span class="diff-line context">   - &quot;{{ &#x27;--certificatesresolvers.zerossl.acme.dnschallenge.propagation.disableChecks=true&#x27; if traefik_disable_propagation_check else omit }}&quot;</span><span class="diff-line del">-traefik_docker_commands_http_validation_acme:</span><span class="diff-line add">+traefik_role_docker_commands_http_validation_acme:</span><span class="diff-line context">   - &quot;--certificatesresolvers.httpresolver.acme.httpchallenge.entrypoint=web&quot;</span><span class="diff-line context">   - &quot;--certificatesresolvers.httpresolver.acme.email={{ user.email }}&quot;</span><span class="diff-line context">   - &quot;--certificatesresolvers.httpresolver.acme.storage=/etc/traefik/acme.json&quot;</span><span class="diff-line del">-traefik_docker_commands_http_validation_acme_zerossl:</span><span class="diff-line add">+traefik_role_docker_commands_http_validation_acme_zerossl:</span><span class="diff-line context">   - &quot;--certificatesresolvers.zerosslhttp.acme.httpchallenge.entrypoint=web&quot;</span><span class="diff-line context">   - &quot;--certificatesresolvers.zerosslhttp.acme.email={{ user.email }}&quot;</span><span class="diff-line context">   - &quot;--certificatesresolvers.zerosslhttp.acme.caserver=https://acme.zerossl.com/v2/DV90&quot;</span><span class="diff-line context">   - &quot;--certificatesresolvers.zerosslhttp.acme.eab.kid={{ traefik_zerossl_kid | default(&#x27;&#x27;) }}&quot;</span><span class="diff-line context">   - &quot;--certificatesresolvers.zerosslhttp.acme.eab.hmacencoded={{ traefik_zerossl_hmacencoded | default(&#x27;&#x27;) }}&quot;</span><span class="diff-line context">   - &quot;--certificatesresolvers.zerosslhttp.acme.storage=/etc/traefik/acme.json&quot;</span><span class="diff-line del">-traefik_docker_commands_google_acme:</span><span class="diff-line add">+traefik_role_docker_commands_google_acme:</span><span class="diff-line context">   - &quot;--certificatesresolvers.google.acme.dnschallenge.provider={{ traefik_challenge_provider }}&quot;</span><span class="diff-line del">-  - &quot;{{ &#x27;--certificatesresolvers.google.acme.dnschallenge.resolvers=&#x27; + traefik_dns_resolvers if (traefik_dns_resolvers | length &gt; 0) else omit }}&quot;</span><span class="diff-line add">+  - &quot;{{ (&#x27;--certificatesresolvers.google.acme.dnschallenge.resolvers=&#x27; + traefik_dns_resolvers) if (traefik_dns_resolvers | length &gt; 0) else omit }}&quot;</span><span class="diff-line context">   - &quot;--certificatesresolvers.google.acme.email={{ user.email }}&quot;</span><span class="diff-line context">   - &quot;--certificatesresolvers.google.acme.caserver=https://dv.acme-v02.api.pki.goog/directory&quot;</span><span class="diff-line context">   - &quot;--certificatesresolvers.google.acme.eab.kid={{ traefik_google_kid | default(&#x27;&#x27;) }}&quot;</span><span class="diff-line hunk">@@ -342,105 +331,98 @@</span><span class="diff-line context">   - &quot;--certificatesresolvers.google.acme.storage=/etc/traefik/acme.json&quot;</span><span class="diff-line context">   - &quot;{{ &#x27;--certificatesresolvers.google.acme.dnschallenge.propagation.delayBeforeChecks=60s&#x27; if traefik_disable_propagation_check else omit }}&quot;</span><span class="diff-line context">   - &quot;{{ &#x27;--certificatesresolvers.google.acme.dnschallenge.propagation.disableChecks=true&#x27; if traefik_disable_propagation_check else omit }}&quot;</span><span class="diff-line del">-traefik_docker_commands_google_acme_http:</span><span class="diff-line add">+traefik_role_docker_commands_google_acme_http:</span><span class="diff-line context">   - &quot;--certificatesresolvers.googlehttp.acme.httpchallenge.entrypoint=web&quot;</span><span class="diff-line context">   - &quot;--certificatesresolvers.googlehttp.acme.email={{ user.email }}&quot;</span><span class="diff-line context">   - &quot;--certificatesresolvers.googlehttp.acme.caserver=https://dv.acme-v02.api.pki.goog/directory&quot;</span><span class="diff-line context">   - &quot;--certificatesresolvers.googlehttp.acme.eab.kid={{ traefik_google_kid | default(&#x27;&#x27;) }}&quot;</span><span class="diff-line context">   - &quot;--certificatesresolvers.googlehttp.acme.eab.hmacencoded={{ traefik_google_hmacencoded | default(&#x27;&#x27;) }}&quot;</span><span class="diff-line context">   - &quot;--certificatesresolvers.googlehttp.acme.storage=/etc/traefik/acme.json&quot;</span><span class="diff-line del">-traefik_docker_commands_metrics:</span><span class="diff-line add">+traefik_role_docker_commands_metrics:</span><span class="diff-line context">   - &quot;--metrics.prometheus=true&quot;</span><span class="diff-line context">   - &quot;--metrics.prometheus.addentrypointslabels=true&quot;</span><span class="diff-line context">   - &quot;--metrics.prometheus.addrouterslabels=true&quot;</span><span class="diff-line context">   - &quot;--metrics.prometheus.addserviceslabels=true&quot;</span><span class="diff-line context">   - &quot;--metrics.prometheus.manualrouting=true&quot;</span><span class="diff-line del">-traefik_docker_commands_cloudflarewarp_plugin:</span><span class="diff-line del">-  - &quot;--experimental.plugins.cloudflarewarp.modulename=github.com/BetterCorp/cloudflarewarp&quot;</span><span class="diff-line del">-  - &quot;--experimental.plugins.cloudflarewarp.version=v1.3.3&quot;</span><span class="diff-line del">-traefik_docker_commands_themepark_plugin:</span><span class="diff-line add">+traefik_role_docker_commands_cloudflarewarp_plugin:</span><span class="diff-line add">+  - &quot;--experimental.plugins.cloudflarewarp.modulename=github.com/saltyorg/cloudflarewarp&quot;</span><span class="diff-line add">+  - &quot;--experimental.plugins.cloudflarewarp.version=v1.0.0&quot;</span><span class="diff-line add">+traefik_role_docker_commands_themepark_plugin:</span><span class="diff-line context">   - &quot;--experimental.plugins.themepark.modulename=github.com/packruler/traefik-themepark&quot;</span><span class="diff-line context">   - &quot;--experimental.plugins.themepark.version=v1.4.2&quot;</span><span class="diff-line del">-traefik_docker_commands_http3:</span><span class="diff-line add">+traefik_role_docker_commands_http3:</span><span class="diff-line context">   - &quot;--entrypoints.websecure.http3.advertisedport={{ traefik_entrypoint_websecure_port }}&quot;</span><span class="diff-line del">-traefik_docker_commands_tailscale:</span><span class="diff-line add">+traefik_role_docker_commands_tailscale:</span><span class="diff-line context">   - &quot;--entrypoints.tailscale-web.address=:81&quot;</span><span class="diff-line context">   - &quot;--entrypoints.tailscale-websecure.address=:444&quot;</span><span class="diff-line del">-traefik_docker_commands_crowdsec:</span><span class="diff-line add">+traefik_role_docker_commands_crowdsec:</span><span class="diff-line context">   - &quot;--experimental.plugins.bouncer.modulename=github.com/maxlerebourg/crowdsec-bouncer-traefik-plugin&quot;</span><span class="diff-line context">   - &quot;--experimental.plugins.bouncer.version=v1.4.4&quot;</span><span class="diff-line del">-traefik_docker_commands_custom: []</span><span class="diff-line del">-traefik_docker_commands: &quot;{{ traefik_docker_commands_default</span><span class="diff-line del">-                             + traefik_docker_commands_custom</span><span class="diff-line del">-                             + (traefik_docker_commands_metrics</span><span class="diff-line del">-                               if traefik.metrics</span><span class="diff-line del">-                               else [])</span><span class="diff-line del">-                             + (traefik_docker_commands_cloudflarewarp_plugin</span><span class="diff-line del">-                               if traefik_plugin_cloudflarewarp_enabled and cloudflare_is_enabled</span><span class="diff-line del">-                               else [])</span><span class="diff-line del">-                             + (traefik_docker_commands_themepark_plugin</span><span class="diff-line del">-                               if global_themepark_plugin_enabled</span><span class="diff-line del">-                               else [])</span><span class="diff-line del">-                             + (traefik_docker_commands_zerossl_acme</span><span class="diff-line del">-                               if (traefik_enable_zerossl)</span><span class="diff-line del">-                               else [])</span><span class="diff-line del">-                             + (traefik_docker_commands_http_validation_acme_zerossl</span><span class="diff-line del">-                               if (traefik_enable_http_validation and traefik_enable_zerossl)</span><span class="diff-line del">-                               else [])</span><span class="diff-line del">-                             + (traefik_docker_commands_http_validation_acme</span><span class="diff-line del">-                               if (traefik_enable_http_validation)</span><span class="diff-line del">-                               else [])</span><span class="diff-line del">-                             + (traefik_docker_commands_google_acme</span><span class="diff-line del">-                               if (traefik_google_kid is defined) and (traefik_google_hmacencoded is defined)</span><span class="diff-line del">-                               else [])</span><span class="diff-line del">-                             + (traefik_docker_commands_google_acme_http</span><span class="diff-line del">-                               if (traefik_google_kid is defined) and (traefik_google_hmacencoded is defined) and (traefik_enable_http_validation)</span><span class="diff-line del">-                               else [])</span><span class="diff-line del">-                             + (traefik_docker_commands_http3</span><span class="diff-line del">-                               if traefik_http3</span><span class="diff-line del">-                               else [])</span><span class="diff-line del">-                             + (traefik_docker_commands_tailscale</span><span class="diff-line del">-                               if traefik_tailscale_enabled</span><span class="diff-line del">-                               else [])</span><span class="diff-line del">-                             + (traefik_docker_commands_crowdsec</span><span class="diff-line del">-                               if crowdsec_is_enabled</span><span class="diff-line del">-                               else [])</span><span class="diff-line del">-                             + custom_entrypoints }}&quot;</span><span class="diff-line add">+traefik_role_docker_commands_custom: []</span><span class="diff-line add">+traefik_role_docker_commands: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_commands_default&#x27;, role=&#x27;traefik&#x27;)</span><span class="diff-line add">+                                  + lookup(&#x27;role_var&#x27;, &#x27;_docker_commands_custom&#x27;, role=&#x27;traefik&#x27;)</span><span class="diff-line add">+                                  + (lookup(&#x27;role_var&#x27;, &#x27;_docker_commands_metrics&#x27;, role=&#x27;traefik&#x27;)</span><span class="diff-line add">+                                    if (lookup(&#x27;role_var&#x27;, &#x27;_metrics_enabled&#x27;, role=&#x27;traefik&#x27;))</span><span class="diff-line add">+                                    else [])</span><span class="diff-line add">+                                  + (lookup(&#x27;role_var&#x27;, &#x27;_docker_commands_cloudflarewarp_plugin&#x27;, role=&#x27;traefik&#x27;)</span><span class="diff-line add">+                                    if traefik_plugin_cloudflarewarp_enabled and cloudflare_is_enabled</span><span class="diff-line add">+                                    else [])</span><span class="diff-line add">+                                  + (lookup(&#x27;role_var&#x27;, &#x27;_docker_commands_themepark_plugin&#x27;, role=&#x27;traefik&#x27;)</span><span class="diff-line add">+                                    if global_themepark_plugin_enabled</span><span class="diff-line add">+                                    else [])</span><span class="diff-line add">+                                  + (lookup(&#x27;role_var&#x27;, &#x27;_docker_commands_zerossl_acme&#x27;, role=&#x27;traefik&#x27;)</span><span class="diff-line add">+                                    if (traefik_enable_zerossl)</span><span class="diff-line add">+                                    else [])</span><span class="diff-line add">+                                  + (lookup(&#x27;role_var&#x27;, &#x27;_docker_commands_http_validation_acme_zerossl&#x27;, role=&#x27;traefik&#x27;)</span><span class="diff-line add">+                                    if (traefik_enable_http_validation and traefik_enable_zerossl)</span><span class="diff-line add">+                                    else [])</span><span class="diff-line add">+                                  + (lookup(&#x27;role_var&#x27;, &#x27;_docker_commands_http_validation_acme&#x27;, role=&#x27;traefik&#x27;)</span><span class="diff-line add">+                                    if (traefik_enable_http_validation)</span><span class="diff-line add">+                                    else [])</span><span class="diff-line add">+                                  + (lookup(&#x27;role_var&#x27;, &#x27;_docker_commands_google_acme&#x27;, role=&#x27;traefik&#x27;)</span><span class="diff-line add">+                                    if (traefik_google_kid is defined) and (traefik_google_hmacencoded is defined)</span><span class="diff-line add">+                                    else [])</span><span class="diff-line add">+                                  + (lookup(&#x27;role_var&#x27;, &#x27;_docker_commands_google_acme_http&#x27;, role=&#x27;traefik&#x27;)</span><span class="diff-line add">+                                    if (traefik_google_kid is defined) and (traefik_google_hmacencoded is defined) and (traefik_enable_http_validation)</span><span class="diff-line add">+                                    else [])</span><span class="diff-line add">+                                  + (lookup(&#x27;role_var&#x27;, &#x27;_docker_commands_http3&#x27;, role=&#x27;traefik&#x27;)</span><span class="diff-line add">+                                    if traefik_http3</span><span class="diff-line add">+                                    else [])</span><span class="diff-line add">+                                  + (lookup(&#x27;role_var&#x27;, &#x27;_docker_commands_tailscale&#x27;, role=&#x27;traefik&#x27;)</span><span class="diff-line add">+                                    if traefik_tailscale_enabled</span><span class="diff-line add">+                                    else [])</span><span class="diff-line add">+                                  + (lookup(&#x27;role_var&#x27;, &#x27;_docker_commands_crowdsec&#x27;, role=&#x27;traefik&#x27;)</span><span class="diff-line add">+                                    if crowdsec_is_enabled</span><span class="diff-line add">+                                    else [])</span><span class="diff-line add">+                                  + custom_entrypoints }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Volumes</span><span class="diff-line del">-traefik_docker_volumes_default:</span><span class="diff-line del">-  - &quot;/var/run/docker.sock:/var/run/docker.sock:ro&quot;</span><span class="diff-line del">-  - &quot;{{ traefik_paths_location }}:/etc/traefik&quot;</span><span class="diff-line del">-traefik_docker_volumes_custom: []</span><span class="diff-line del">-traefik_docker_volumes: &quot;{{ traefik_docker_volumes_default</span><span class="diff-line del">-                            + traefik_docker_volumes_custom }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Devices</span><span class="diff-line del">-traefik_docker_devices_default: []</span><span class="diff-line del">-traefik_docker_devices_custom: []</span><span class="diff-line del">-traefik_docker_devices: &quot;{{ traefik_docker_devices_default</span><span class="diff-line del">-                            + traefik_docker_devices_custom }}&quot;</span><span class="diff-line add">+traefik_role_docker_volumes_default:</span><span class="diff-line add">+  - &quot;/var/run/docker.sock:/var/run/docker.sock&quot;</span><span class="diff-line add">+  - &quot;{{ traefik_role_paths_location }}:/etc/traefik&quot;</span><span class="diff-line add">+traefik_role_docker_volumes_custom: []</span><span class="diff-line add">+traefik_role_docker_volumes: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_volumes_default&#x27;, role=&#x27;traefik&#x27;)</span><span class="diff-line add">+                                 + lookup(&#x27;role_var&#x27;, &#x27;_docker_volumes_custom&#x27;, role=&#x27;traefik&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Hosts</span><span class="diff-line del">-traefik_docker_hosts_default:</span><span class="diff-line add">+traefik_role_docker_hosts_default:</span><span class="diff-line context">   host.docker.internal: &quot;172.19.0.1&quot;</span><span class="diff-line del">-traefik_docker_hosts_custom: {}</span><span class="diff-line del">-traefik_docker_hosts: &quot;{{ docker_hosts_common</span><span class="diff-line del">-                          | combine(traefik_docker_hosts_default)</span><span class="diff-line del">-                          | combine(traefik_docker_hosts_custom) }}&quot;</span><span class="diff-line add">+traefik_role_docker_hosts_custom: {}</span><span class="diff-line add">+traefik_role_docker_hosts: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_hosts_default&#x27;, role=&#x27;traefik&#x27;)</span><span class="diff-line add">+                               | combine(lookup(&#x27;role_var&#x27;, &#x27;_docker_hosts_custom&#x27;, role=&#x27;traefik&#x27;)) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Labels</span><span class="diff-line del">-traefik_docker_labels_default:</span><span class="diff-line del">-  com.github.saltbox.saltbox_managed: &quot;true&quot;</span><span class="diff-line add">+traefik_role_docker_labels_use_common: false</span><span class="diff-line add">+traefik_role_docker_labels_default:</span><span class="diff-line context">   traefik.enable: &quot;true&quot;</span><span class="diff-line context">   traefik.http.routers.traefik-internal.rule: &quot;Host(`{{ traefik_name }}`)&quot;</span><span class="diff-line context">   traefik.http.routers.traefik-internal.entrypoints: &quot;internal&quot;</span><span class="diff-line context">   traefik.http.routers.traefik-internal.service: &quot;api@internal&quot;</span><span class="diff-line del">-  traefik.http.routers.traefik-http.rule: &quot;Host(`{{ traefik_web_subdomain }}.{{ traefik_web_domain }}`)&quot;</span><span class="diff-line add">+  traefik.http.routers.traefik-http.rule: &quot;Host(`{{ lookup(&#x27;role_var&#x27;, &#x27;_web_subdomain&#x27;, role=&#x27;traefik&#x27;) }}.{{ lookup(&#x27;role_var&#x27;, &#x27;_web_domain&#x27;, role=&#x27;traefik&#x27;) }}`)&quot;</span><span class="diff-line context">   traefik.http.routers.traefik-http.entrypoints: &quot;{{ traefik_entrypoint_web }}&quot;</span><span class="diff-line context">   traefik.http.routers.traefik-http.middlewares: &quot;{{ traefik_default_middleware_http }}&quot;</span><span class="diff-line context">   traefik.http.routers.traefik-http.priority: &quot;20&quot;</span><span class="diff-line del">-  traefik.http.routers.traefik.rule: &quot;Host(`{{ traefik_web_subdomain }}.{{ traefik_web_domain }}`)&quot;</span><span class="diff-line add">+  traefik.http.routers.traefik.rule: &quot;Host(`{{ lookup(&#x27;role_var&#x27;, &#x27;_web_subdomain&#x27;, role=&#x27;traefik&#x27;) }}.{{ lookup(&#x27;role_var&#x27;, &#x27;_web_domain&#x27;, role=&#x27;traefik&#x27;) }}`)&quot;</span><span class="diff-line context">   traefik.http.routers.traefik.entrypoints: &quot;{{ traefik_entrypoint_websecure }}&quot;</span><span class="diff-line context">   traefik.http.routers.traefik.tls: &quot;true&quot;</span><span class="diff-line context">   traefik.http.routers.traefik.tls.options: &quot;securetls@file&quot;</span><span class="diff-line hunk">@@ -452,40 +434,40 @@</span><span class="diff-line context">   traefik.http.middlewares.autodetect.contenttype: &quot;true&quot;</span><span class="diff-line context">   traefik.http.middlewares.redirect-to-https.redirectscheme.scheme: &quot;https&quot;</span><span class="diff-line context">   traefik.http.middlewares.redirect-to-https.redirectscheme.permanent: &quot;true&quot;</span><span class="diff-line del">-  traefik.http.middlewares.authelia.forwardauth.address: &quot;{{ &#x27;http://authelia:9091/api/verify?rd=&#x27; + authelia_web_url + &#x27;/&#x27;</span><span class="diff-line add">+  traefik.http.middlewares.authelia.forwardauth.address: &quot;{{ &#x27;http://&#x27; + authelia_name + &#x27;:9091/api/verify?rd=&#x27; + lookup(&#x27;role_var&#x27;, &#x27;_web_url&#x27;, role=&#x27;authelia&#x27;) + &#x27;/&#x27;</span><span class="diff-line context">                                                           if authelia_is_master</span><span class="diff-line del">-                                                          else authelia_web_url + &#x27;/api/verify?rd=&#x27; + authelia_web_url + &#x27;/&#x27; }}&quot;</span><span class="diff-line add">+                                                          else lookup(&#x27;role_var&#x27;, &#x27;_web_url&#x27;, role=&#x27;authelia&#x27;) + &#x27;/api/verify?rd=&#x27; + lookup(&#x27;role_var&#x27;, &#x27;_web_url&#x27;, role=&#x27;authelia&#x27;) + &#x27;/&#x27; }}&quot;</span><span class="diff-line context">   traefik.http.middlewares.authelia.forwardauth.trustForwardHeader: &quot;true&quot;</span><span class="diff-line del">-  traefik.http.middlewares.authelia.forwardauth.authResponseHeaders: &quot;Remote-User, Remote-Groups, Remote-Name, Remote-Email&quot;</span><span class="diff-line del">-  traefik.http.middlewares.authelia-basic.forwardauth.address: &quot;{{ &#x27;http://authelia:9091/api/verify?auth=basic&amp;rd=&#x27; + authelia_web_url + &#x27;/&#x27;</span><span class="diff-line add">+  traefik.http.middlewares.authelia.forwardauth.authResponseHeaders: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_response_headers&#x27;, role=&#x27;authelia&#x27;) | join(&#x27;,&#x27;) }}&quot;</span><span class="diff-line add">+  traefik.http.middlewares.authelia-basic.forwardauth.address: &quot;{{ &#x27;http://&#x27; + authelia_name + &#x27;:9091/api/verify?auth=basic&amp;rd=&#x27; + lookup(&#x27;role_var&#x27;, &#x27;_web_url&#x27;, role=&#x27;authelia&#x27;) + &#x27;/&#x27;</span><span class="diff-line context">                                                                 if authelia_is_master</span><span class="diff-line del">-                                                                else authelia_web_url + &#x27;/api/verify?auth=basic&amp;rd=&#x27; + authelia_web_url + &#x27;/&#x27; }}&quot;</span><span class="diff-line add">+                                                                else lookup(&#x27;role_var&#x27;, &#x27;_web_url&#x27;, role=&#x27;authelia&#x27;) + &#x27;/api/verify?auth=basic&amp;rd=&#x27; + lookup(&#x27;role_var&#x27;, &#x27;_web_url&#x27;, role=&#x27;authelia&#x27;) + &#x27;/&#x27; }}&quot;</span><span class="diff-line context">   traefik.http.middlewares.authelia-basic.forwardauth.trustForwardHeader: &quot;true&quot;</span><span class="diff-line del">-  traefik.http.middlewares.authelia-basic.forwardauth.authResponseHeaders: &quot;Remote-User, Remote-Groups, Remote-Name, Remote-Email&quot;</span><span class="diff-line add">+  traefik.http.middlewares.authelia-basic.forwardauth.authResponseHeaders: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_response_headers&#x27;, role=&#x27;authelia&#x27;) | join(&#x27;,&#x27;) }}&quot;</span><span class="diff-line context">   traefik.http.middlewares.authentik.forwardauth.address: &quot;{{ &#x27;http://&#x27; + authentik_name + &#x27;:9000/outpost.goauthentik.io/auth/traefik&#x27;</span><span class="diff-line context">                                                            if authentik_is_master</span><span class="diff-line del">-                                                           else authentik_web_url + &#x27;/outpost.goauthentik.io/auth/traefik&#x27; }}&quot;</span><span class="diff-line add">+                                                           else lookup(&#x27;role_var&#x27;, &#x27;_web_url&#x27;, role=&#x27;authentik&#x27;) + &#x27;/outpost.goauthentik.io/auth/traefik&#x27; }}&quot;</span><span class="diff-line context">   traefik.http.middlewares.authentik.forwardauth.trustForwardHeader: &quot;true&quot;</span><span class="diff-line del">-  traefik.http.middlewares.authentik.forwardauth.authResponseHeaders: &quot;X-authentik-username,X-authentik-groups,X-authentik-email,X-authentik-name,X-authentik-uid,X-authentik-jwt,X-authentik-meta-jwks,X-authentik-meta-outpost,X-authentik-meta-provider,X-authentik-meta-app,X-authentik-meta-version&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-traefik_docker_labels_cloudflare:</span><span class="diff-line add">+  traefik.http.middlewares.authentik.forwardauth.authResponseHeaders: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_response_headers&#x27;, role=&#x27;authentik&#x27;) | join(&#x27;,&#x27;) }}&quot;</span><span class="diff-line add">+</span><span class="diff-line add">+traefik_role_docker_labels_cloudflare:</span><span class="diff-line context">   traefik.http.middlewares.cloudflarewarp.plugin.cloudflarewarp.disableDefault: &quot;false&quot;</span><span class="diff-line context"> </span><span class="diff-line del">-traefik_docker_labels_dns_validation:</span><span class="diff-line add">+traefik_role_docker_labels_dns_validation:</span><span class="diff-line context">   traefik.http.routers.traefik.tls.certresolver: &quot;{{ traefik_default_certresolver }}&quot;</span><span class="diff-line context">   traefik.http.routers.traefik.tls.domains[0].main: &quot;{{ user.domain }}&quot;</span><span class="diff-line context">   traefik.http.routers.traefik.tls.domains[0].sans: &quot;{{ &#x27;*.&#x27; + user.domain }}&quot;</span><span class="diff-line context"> </span><span class="diff-line del">-traefik_docker_labels_http_validation:</span><span class="diff-line add">+traefik_role_docker_labels_http_validation:</span><span class="diff-line context">   traefik.http.routers.traefik.tls.certresolver: &quot;{{ traefik_default_certresolver }}&quot;</span><span class="diff-line context"> </span><span class="diff-line del">-traefik_docker_labels_metrics:</span><span class="diff-line del">-  traefik.http.routers.metrics-http.rule: &quot;Host(`{{ traefik_metrics_subdomain }}.{{ traefik_metrics_domain }}`) &amp;&amp; Path(`/prometheus`)&quot;</span><span class="diff-line add">+traefik_role_docker_labels_metrics:</span><span class="diff-line add">+  traefik.http.routers.metrics-http.rule: &quot;Host(`{{ lookup(&#x27;role_var&#x27;, &#x27;_metrics_subdomain&#x27;, role=&#x27;traefik&#x27;) }}.{{ lookup(&#x27;role_var&#x27;, &#x27;_metrics_domain&#x27;, role=&#x27;traefik&#x27;) }}`) &amp;&amp; Path(`/prometheus`)&quot;</span><span class="diff-line context">   traefik.http.routers.metrics-http.service: prometheus@internal</span><span class="diff-line context">   traefik.http.routers.metrics-http.entrypoints: &quot;{{ traefik_entrypoint_web }}&quot;</span><span class="diff-line context">   traefik.http.routers.metrics-http.middlewares: &quot;traefik-auth,{{ traefik_default_middleware_http_api }}&quot;</span><span class="diff-line context">   traefik.http.routers.metrics-http.priority: &quot;20&quot;</span><span class="diff-line del">-  traefik.http.routers.metrics.rule: &quot;Host(`{{ traefik_metrics_subdomain }}.{{ traefik_metrics_domain }}`) &amp;&amp; Path(`/prometheus`)&quot;</span><span class="diff-line add">+  traefik.http.routers.metrics.rule: &quot;Host(`{{ lookup(&#x27;role_var&#x27;, &#x27;_metrics_subdomain&#x27;, role=&#x27;traefik&#x27;) }}.{{ lookup(&#x27;role_var&#x27;, &#x27;_metrics_domain&#x27;, role=&#x27;traefik&#x27;) }}`) &amp;&amp; Path(`/prometheus`)&quot;</span><span class="diff-line context">   traefik.http.routers.metrics.service: prometheus@internal</span><span class="diff-line context">   traefik.http.routers.metrics.entrypoints: &quot;{{ traefik_entrypoint_websecure }}&quot;</span><span class="diff-line context">   traefik.http.routers.metrics.tls: &quot;true&quot;</span><span class="diff-line hunk">@@ -493,56 +475,44 @@</span><span class="diff-line context">   traefik.http.routers.metrics.middlewares: &quot;traefik-auth,{{ traefik_default_middleware_api }}&quot;</span><span class="diff-line context">   traefik.http.routers.metrics.priority: &quot;20&quot;</span><span class="diff-line context"> </span><span class="diff-line del">-traefik_docker_labels_crowdsec:</span><span class="diff-line add">+traefik_role_docker_labels_crowdsec:</span><span class="diff-line context">   traefik.http.middlewares.crowdsec.plugin.bouncer.enabled: &quot;true&quot;</span><span class="diff-line context">   traefik.http.middlewares.crowdsec.plugin.bouncer.crowdseclapikey: &quot;{{ traefik_crowdsec_bouncer_key | default(&#x27;&#x27;) }}&quot;</span><span class="diff-line context">   traefik.http.middlewares.crowdsec.plugin.bouncer.crowdseclapischeme: &quot;http&quot;</span><span class="diff-line context">   traefik.http.middlewares.crowdsec.plugin.bouncer.crowdseclapihost: &quot;172.19.0.1:{{ traefik_crowdsec_port }}&quot;</span><span class="diff-line del">-  traefik.http.middlewares.crowdsec.plugin.bouncer.forwardedheaderstrustedips: &quot;{{ (traefik_cloudflare_ips | join(&#x27;,&#x27;)) + (&#x27;,&#x27; + traefik_trusted_ips if (traefik_trusted_ips | length &gt; 0) else &#x27;&#x27;) }}&quot;</span><span class="diff-line add">+  traefik.http.middlewares.crowdsec.plugin.bouncer.forwardedheaderstrustedips: &quot;{{ traefik_trusted_ips_template if (traefik_trusted_ips_template | length &gt; 0) else omit }}&quot;</span><span class="diff-line context">   traefik.http.middlewares.crowdsec.plugin.bouncer.banhtmlfilepath: &quot;{{ traefik_crowdsec_ban_filepath }}&quot;</span><span class="diff-line context"> </span><span class="diff-line del">-traefik_docker_labels_custom: {}</span><span class="diff-line del">-</span><span class="diff-line del">-traefik_docker_labels: &quot;{{ traefik_docker_labels_default</span><span class="diff-line del">-                           | combine(traefik_docker_labels_custom)</span><span class="diff-line del">-                           | combine((traefik_docker_labels_http_validation</span><span class="diff-line del">-                                     if traefik_http</span><span class="diff-line del">-                                     else traefik_docker_labels_dns_validation))</span><span class="diff-line del">-                           | combine((traefik_docker_labels_metrics</span><span class="diff-line del">-                                     if traefik.metrics</span><span class="diff-line del">-                                     else {}))</span><span class="diff-line del">-                           | combine((traefik_docker_labels_cloudflare</span><span class="diff-line del">-                                     if traefik_plugin_cloudflarewarp_enabled and cloudflare_is_enabled</span><span class="diff-line del">-                                     else {}))</span><span class="diff-line del">-                           | combine((traefik_docker_labels_crowdsec</span><span class="diff-line del">-                                     if crowdsec_is_enabled</span><span class="diff-line del">-                                     else {})) }}&quot;</span><span class="diff-line add">+traefik_role_docker_labels_custom: {}</span><span class="diff-line add">+traefik_role_docker_labels: &quot;{{ docker_labels_saltbox</span><span class="diff-line add">+                                | combine(lookup(&#x27;role_var&#x27;, &#x27;_docker_labels_default&#x27;, role=&#x27;traefik&#x27;))</span><span class="diff-line add">+                                | combine(lookup(&#x27;role_var&#x27;, &#x27;_docker_labels_custom&#x27;, role=&#x27;traefik&#x27;))</span><span class="diff-line add">+                                | combine((lookup(&#x27;role_var&#x27;, &#x27;_docker_labels_http_validation&#x27;, role=&#x27;traefik&#x27;)</span><span class="diff-line add">+                                          if traefik_http</span><span class="diff-line add">+                                          else lookup(&#x27;role_var&#x27;, &#x27;_docker_labels_dns_validation&#x27;, role=&#x27;traefik&#x27;)))</span><span class="diff-line add">+                                | combine((lookup(&#x27;role_var&#x27;, &#x27;_docker_labels_metrics&#x27;, role=&#x27;traefik&#x27;)</span><span class="diff-line add">+                                          if lookup(&#x27;role_var&#x27;, &#x27;_metrics_enabled&#x27;, role=&#x27;traefik&#x27;)</span><span class="diff-line add">+                                          else {}))</span><span class="diff-line add">+                                | combine((lookup(&#x27;role_var&#x27;, &#x27;_docker_labels_cloudflare&#x27;, role=&#x27;traefik&#x27;)</span><span class="diff-line add">+                                          if traefik_plugin_cloudflarewarp_enabled and cloudflare_is_enabled</span><span class="diff-line add">+                                          else {}))</span><span class="diff-line add">+                                | combine((lookup(&#x27;role_var&#x27;, &#x27;_docker_labels_crowdsec&#x27;, role=&#x27;traefik&#x27;)</span><span class="diff-line add">+                                          if crowdsec_is_enabled</span><span class="diff-line add">+                                          else {})) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Hostname</span><span class="diff-line del">-traefik_docker_hostname: &quot;{{ traefik_name }}&quot;</span><span class="diff-line add">+traefik_role_docker_hostname: &quot;{{ traefik_name }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Networks</span><span class="diff-line del">-traefik_docker_networks_alias: &quot;{{ traefik_name }}&quot;</span><span class="diff-line del">-traefik_docker_networks_default: []</span><span class="diff-line del">-traefik_docker_networks_custom: []</span><span class="diff-line del">-traefik_docker_networks: &quot;{{ docker_networks_common</span><span class="diff-line del">-                             + traefik_docker_networks_default</span><span class="diff-line del">-                             + traefik_docker_networks_custom }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Capabilities</span><span class="diff-line del">-traefik_docker_capabilities_default: []</span><span class="diff-line del">-traefik_docker_capabilities_custom: []</span><span class="diff-line del">-traefik_docker_capabilities: &quot;{{ traefik_docker_capabilities_default</span><span class="diff-line del">-                                 + traefik_docker_capabilities_custom }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Security Opts</span><span class="diff-line del">-traefik_docker_security_opts_default: []</span><span class="diff-line del">-traefik_docker_security_opts_custom: []</span><span class="diff-line del">-traefik_docker_security_opts: &quot;{{ traefik_docker_security_opts_default</span><span class="diff-line del">-                                  + traefik_docker_security_opts_custom }}&quot;</span><span class="diff-line add">+traefik_role_docker_networks_alias: &quot;{{ traefik_name }}&quot;</span><span class="diff-line add">+traefik_role_docker_networks_default: []</span><span class="diff-line add">+traefik_role_docker_networks_custom: []</span><span class="diff-line add">+traefik_role_docker_networks: &quot;{{ docker_networks_common</span><span class="diff-line add">+                                  + lookup(&#x27;role_var&#x27;, &#x27;_docker_networks_default&#x27;, role=&#x27;traefik&#x27;)</span><span class="diff-line add">+                                  + lookup(&#x27;role_var&#x27;, &#x27;_docker_networks_custom&#x27;, role=&#x27;traefik&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Restart Policy</span><span class="diff-line del">-traefik_docker_restart_policy: unless-stopped</span><span class="diff-line add">+traefik_role_docker_restart_policy: unless-stopped</span><span class="diff-line context"> </span><span class="diff-line context"> # State</span><span class="diff-line del">-traefik_docker_state: started</span><span class="diff-line add">+traefik_role_docker_state: started</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-362">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/traefik/tasks/main.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -10,28 +10,28 @@</span><span class="diff-line context"> - name: Add DNS record</span><span class="diff-line context">   ansible.builtin.include_tasks: &quot;{{ resources_tasks_path }}/dns/tasker.yml&quot;</span><span class="diff-line context">   vars:</span><span class="diff-line del">-    dns_record: &quot;{{ lookup(&#x27;vars&#x27;, role_name + &#x27;_dns_record&#x27;) }}&quot;</span><span class="diff-line del">-    dns_zone: &quot;{{ lookup(&#x27;vars&#x27;, role_name + &#x27;_dns_zone&#x27;) }}&quot;</span><span class="diff-line del">-    dns_proxy: &quot;{{ lookup(&#x27;vars&#x27;, role_name + &#x27;_dns_proxy&#x27;) }}&quot;</span><span class="diff-line add">+    dns_record: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_dns_record&#x27;) }}&quot;</span><span class="diff-line add">+    dns_zone: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_dns_zone&#x27;) }}&quot;</span><span class="diff-line add">+    dns_proxy: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_dns_proxy&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Add DNS record</span><span class="diff-line context">   ansible.builtin.include_tasks: &quot;{{ resources_tasks_path }}/dns/tasker.yml&quot;</span><span class="diff-line context">   vars:</span><span class="diff-line del">-    dns_record: &quot;{{ lookup(&#x27;vars&#x27;, role_name + &#x27;_metrics_dns_record&#x27;) }}&quot;</span><span class="diff-line del">-    dns_zone: &quot;{{ lookup(&#x27;vars&#x27;, role_name + &#x27;_metrics_dns_zone&#x27;) }}&quot;</span><span class="diff-line del">-    dns_proxy: &quot;{{ lookup(&#x27;vars&#x27;, role_name + &#x27;_metrics_dns_proxy&#x27;) }}&quot;</span><span class="diff-line del">-  when: traefik.metrics</span><span class="diff-line add">+    dns_record: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_metrics_dns_record&#x27;) }}&quot;</span><span class="diff-line add">+    dns_zone: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_metrics_dns_zone&#x27;) }}&quot;</span><span class="diff-line add">+    dns_proxy: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_metrics_dns_proxy&#x27;) }}&quot;</span><span class="diff-line add">+  when: lookup(&#x27;role_var&#x27;, &#x27;_metrics_enabled&#x27;, role=&#x27;traefik&#x27;)</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Remove existing Docker container</span><span class="diff-line context">   ansible.builtin.include_tasks: &quot;{{ resources_tasks_path }}/docker/remove_docker_container.yml&quot;</span><span class="diff-line context"> </span><span class="diff-line del">-- name: Remove existing Docker container</span><span class="diff-line add">+- name: Remove existing Error Pages Docker container</span><span class="diff-line context">   ansible.builtin.include_tasks: &quot;{{ resources_tasks_path }}/docker/remove_docker_container.yml&quot;</span><span class="diff-line context">   vars:</span><span class="diff-line context">     var_prefix: &quot;error_pages&quot;</span><span class="diff-line context">   when: not traefik_error_pages_enabled</span><span class="diff-line context"> </span><span class="diff-line del">-- name: Remove existing Docker container</span><span class="diff-line add">+- name: Remove existing Authelia Docker container</span><span class="diff-line context">   ansible.builtin.include_tasks: &quot;{{ resources_tasks_path }}/docker/remove_docker_container.yml&quot;</span><span class="diff-line context">   vars:</span><span class="diff-line context">     var_prefix: &quot;authelia&quot;</span><span class="diff-line hunk">@@ -41,20 +41,20 @@</span><span class="diff-line context">   ansible.builtin.include_tasks: &quot;{{ resources_tasks_path }}/directories/create_directories.yml&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Traefik ZeroSSL Tasks</span><span class="diff-line del">-  ansible.builtin.import_tasks: &quot;subtasks/zerossl.yml&quot;</span><span class="diff-line add">+  ansible.builtin.include_tasks: &quot;subtasks/zerossl.yml&quot;</span><span class="diff-line context">   when: traefik_enable_zerossl and (not continuous_integration)</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Traefik Config Tasks</span><span class="diff-line del">-  ansible.builtin.import_tasks: &quot;subtasks/config.yml&quot;</span><span class="diff-line add">+  ansible.builtin.include_tasks: &quot;subtasks/config.yml&quot;</span><span class="diff-line context">   when: (not continuous_integration)</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Traefik Crowdsec Tasks</span><span class="diff-line del">-  ansible.builtin.import_tasks: &quot;subtasks/crowdsec.yml&quot;</span><span class="diff-line add">+  ansible.builtin.include_tasks: &quot;subtasks/crowdsec.yml&quot;</span><span class="diff-line context">   when: crowdsec_is_enabled</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Remove Certificates</span><span class="diff-line context">   ansible.builtin.file:</span><span class="diff-line del">-    path: &quot;{{ traefik_paths_location }}/acme.json&quot;</span><span class="diff-line add">+    path: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_location&#x27;, role=&#x27;traefik&#x27;) }}/acme.json&quot;</span><span class="diff-line context">     state: absent</span><span class="diff-line context">   when: (&#x27;traefik-reset-certs&#x27; in ansible_run_tags)</span><span class="diff-line context"> </span><span class="diff-line hunk">@@ -63,13 +63,13 @@</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Wait for &#x27;acme.json&#x27; to be created</span><span class="diff-line context">   ansible.builtin.wait_for:</span><span class="diff-line del">-    path: &quot;{{ traefik_paths_acme_config_location }}&quot;</span><span class="diff-line add">+    path: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_acme_config_location&#x27;, role=&#x27;traefik&#x27;) }}&quot;</span><span class="diff-line context">     state: present</span><span class="diff-line context">   when: (not continuous_integration)</span><span class="diff-line context"> </span><span class="diff-line del">-- name: Chown &#x27;{{ traefik_paths_location }}&#x27;</span><span class="diff-line add">+- name: Chown &#x27;{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_location&#x27;, role=&#x27;traefik&#x27;) }}&#x27;</span><span class="diff-line context">   ansible.builtin.file:</span><span class="diff-line del">-    path: &quot;{{ traefik_paths_location }}&quot;</span><span class="diff-line add">+    path: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_location&#x27;, role=&#x27;traefik&#x27;) }}&quot;</span><span class="diff-line context">     state: directory</span><span class="diff-line context">     recurse: true</span><span class="diff-line context">     owner: &quot;{{ user.name }}&quot;</span><span class="diff-line hunk">@@ -77,9 +77,9 @@</span><span class="diff-line context">     mode: &quot;0775&quot;</span><span class="diff-line context">   when: (not continuous_integration)</span><span class="diff-line context"> </span><span class="diff-line del">-- name: Chown &#x27;{{ traefik_paths_acme_config_location }}&#x27;</span><span class="diff-line add">+- name: Chown &#x27;{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_acme_config_location&#x27;, role=&#x27;traefik&#x27;) }}&#x27;</span><span class="diff-line context">   ansible.builtin.file:</span><span class="diff-line del">-    path: &quot;{{ traefik_paths_acme_config_location }}&quot;</span><span class="diff-line add">+    path: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_acme_config_location&#x27;, role=&#x27;traefik&#x27;) }}&quot;</span><span class="diff-line context">     state: file</span><span class="diff-line context">     owner: &quot;{{ user.name }}&quot;</span><span class="diff-line context">     group: &quot;{{ user.name }}&quot;</span><span class="diff-line hunk">@@ -89,12 +89,12 @@</span><span class="diff-line context"> - name: &quot;Import Authelia Role&quot;</span><span class="diff-line context">   ansible.builtin.include_role:</span><span class="diff-line context">     name: authelia</span><span class="diff-line del">-  when: traefik_authelia_enabled and authelia_is_master</span><span class="diff-line add">+  when: lookup(&#x27;role_var&#x27;, &#x27;_authelia_enabled&#x27;, role=&#x27;traefik&#x27;) and authelia_is_master</span><span class="diff-line context"> </span><span class="diff-line context"> - name: &quot;Import Authentik Role&quot;</span><span class="diff-line context">   ansible.builtin.include_role:</span><span class="diff-line context">     name: authentik</span><span class="diff-line del">-  when: traefik_authentik_enabled and authentik_is_master</span><span class="diff-line add">+  when: lookup(&#x27;role_var&#x27;, &#x27;_authentik_enabled&#x27;, role=&#x27;traefik&#x27;) and authentik_is_master</span><span class="diff-line context"> </span><span class="diff-line context"> - name: &quot;Import Error Pages Role&quot;</span><span class="diff-line context">   ansible.builtin.include_role:</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-363">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/traefik/tasks/subtasks/config.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -10,7 +10,7 @@</span><span class="diff-line context"> - name: &quot;Import &#x27;dynamic.yml&#x27;&quot;</span><span class="diff-line context">   ansible.builtin.template:</span><span class="diff-line context">     src: dynamic.yml.j2</span><span class="diff-line del">-    dest: &quot;{{ traefik_paths_location }}/dynamic.yml&quot;</span><span class="diff-line add">+    dest: &quot;{{ traefik_role_paths_location }}/dynamic.yml&quot;</span><span class="diff-line context">     force: true</span><span class="diff-line context">     owner: &quot;{{ user.name }}&quot;</span><span class="diff-line context">     group: &quot;{{ user.name }}&quot;</span><span class="diff-line hunk">@@ -18,17 +18,18 @@</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Remove &#x27;themepark.yml&#x27;</span><span class="diff-line context">   ansible.builtin.file:</span><span class="diff-line del">-    path: &quot;{{ traefik_paths_location }}/themepark.yml&quot;</span><span class="diff-line add">+    path: &quot;{{ traefik_role_paths_location }}/themepark.yml&quot;</span><span class="diff-line context">     state: absent</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Create auth file</span><span class="diff-line context">   community.general.htpasswd:</span><span class="diff-line del">-    path: /opt/traefik/auth</span><span class="diff-line add">+    path: &quot;{{ server_appdata_path }}/traefik/auth&quot;</span><span class="diff-line context">     name: &quot;{{ user.name }}&quot;</span><span class="diff-line context">     password: &quot;{{ user.pass }}&quot;</span><span class="diff-line context">     owner: &quot;{{ user.name }}&quot;</span><span class="diff-line context">     group: &quot;{{ user.name }}&quot;</span><span class="diff-line context">     mode: &quot;0664&quot;</span><span class="diff-line add">+  no_log: true</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Initialize &#x27;custom_entrypoints&#x27; variable</span><span class="diff-line context">   ansible.builtin.set_fact:</span><span class="diff-line hunk">@@ -53,9 +54,9 @@</span><span class="diff-line context">   loop: &quot;{{ traefik_entrypoint_custom | dict2items }}&quot;</span><span class="diff-line context">   when: (traefik_entrypoint_custom | length &gt; 0)</span><span class="diff-line context"> </span><span class="diff-line del">-- name: Set &#x27;traefik_docker_ports_defaults&#x27; variable</span><span class="diff-line add">+- name: Set &#x27;traefik_role_docker_ports_default&#x27; variable</span><span class="diff-line context">   ansible.builtin.set_fact:</span><span class="diff-line del">-    traefik_docker_ports_defaults: &quot;{{ (traefik_docker_ports_defaults + custom_entrypoints_ports) | unique }}&quot;</span><span class="diff-line add">+    traefik_role_docker_ports_default: &quot;{{ (traefik_role_docker_ports_default + custom_entrypoints_ports) | unique }}&quot;</span><span class="diff-line context">   when: (traefik_entrypoint_custom | length &gt; 0)</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Tailscale block</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-364">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/traefik/tasks/subtasks/crowdsec.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -38,7 +38,7 @@</span><span class="diff-line context">   ansible.builtin.copy:</span><span class="diff-line context">     src: &quot;ban.html&quot;</span><span class="diff-line context">     force: true</span><span class="diff-line del">-    dest: &quot;{{ traefik_paths_location }}/ban.html&quot;</span><span class="diff-line add">+    dest: &quot;{{ traefik_role_paths_location }}/ban.html&quot;</span><span class="diff-line context">     owner: &quot;{{ user.name }}&quot;</span><span class="diff-line context">     group: &quot;{{ user.name }}&quot;</span><span class="diff-line context">     mode: &quot;0664&quot;</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-365">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/traefik/tasks/subtasks/zerossl.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -13,7 +13,7 @@</span><span class="diff-line context"> </span><span class="diff-line context"> - name: &quot;ZeroSSL | Check if PIN exists&quot;</span><span class="diff-line context">   ansible.builtin.stat:</span><span class="diff-line del">-    path: &quot;/opt/saltbox/zerossl.ini&quot;</span><span class="diff-line add">+    path: &quot;{{ traefik_zerossl_file_ini }}&quot;</span><span class="diff-line context">   register: zerossl_ini</span><span class="diff-line context"> </span><span class="diff-line context"> - name: &quot;ZeroSSL | Existing Credentials Block&quot;</span><span class="diff-line hunk">@@ -21,8 +21,8 @@</span><span class="diff-line context">   block:</span><span class="diff-line context">     - name: &quot;ZeroSSL | Set ZeroSSL variables&quot;</span><span class="diff-line context">       ansible.builtin.set_fact:</span><span class="diff-line del">-        traefik_zerossl_kid: &quot;{{ lookup(&#x27;ini&#x27;, &#x27;kid section=zerossl file=/opt/saltbox/zerossl.ini&#x27;) }}&quot;</span><span class="diff-line del">-        traefik_zerossl_hmacencoded: &quot;{{ lookup(&#x27;ini&#x27;, &#x27;hmacencoded section=zerossl file=/opt/saltbox/zerossl.ini&#x27;) }}&quot;</span><span class="diff-line add">+        traefik_zerossl_kid: &quot;{{ lookup(&#x27;ini&#x27;, &#x27;kid section=zerossl file=&#x27; + traefik_zerossl_file_ini) }}&quot;</span><span class="diff-line add">+        traefik_zerossl_hmacencoded: &quot;{{ lookup(&#x27;ini&#x27;, &#x27;hmacencoded section=zerossl file=&#x27; + traefik_zerossl_file_ini) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: &quot;ZeroSSL | New Credentials Block&quot;</span><span class="diff-line context">   when: not zerossl_ini.stat.exists</span><span class="diff-line hunk">@@ -56,16 +56,16 @@</span><span class="diff-line context"> </span><span class="diff-line context">     - name: &quot;ZeroSSL | Create directories&quot;</span><span class="diff-line context">       ansible.builtin.file:</span><span class="diff-line del">-        path: &quot;/opt/saltbox&quot;</span><span class="diff-line add">+        path: &quot;{{ server_appdata_path }}/saltbox&quot;</span><span class="diff-line context">         state: directory</span><span class="diff-line context">         owner: &quot;{{ user.name }}&quot;</span><span class="diff-line context">         group: &quot;{{ user.name }}&quot;</span><span class="diff-line context">         mode: &quot;0775&quot;</span><span class="diff-line context">       when: (zerossl.status == 200) and zerossl.json.success</span><span class="diff-line context"> </span><span class="diff-line del">-    - name: &quot;ZeroSSL | Add kid to &#x27;/opt/saltbox/zerossl.ini&#x27;&quot;</span><span class="diff-line add">+    - name: &quot;ZeroSSL | Add kid to &#x27;{{ traefik_zerossl_file_ini }}&#x27;&quot;</span><span class="diff-line context">       community.general.ini_file:</span><span class="diff-line del">-        path: /opt/saltbox/zerossl.ini</span><span class="diff-line add">+        path: &quot;{{ traefik_zerossl_file_ini }}&quot;</span><span class="diff-line context">         section: &quot;zerossl&quot;</span><span class="diff-line context">         option: kid</span><span class="diff-line context">         value: &quot;{{ traefik_zerossl_kid }}&quot;</span><span class="diff-line hunk">@@ -74,9 +74,9 @@</span><span class="diff-line context">         mode: &quot;0664&quot;</span><span class="diff-line context">       when: (zerossl.status == 200) and zerossl.json.success</span><span class="diff-line context"> </span><span class="diff-line del">-    - name: &quot;ZeroSSL | Add hmacencoded to &#x27;/opt/saltbox/zerossl.ini&#x27;&quot;</span><span class="diff-line add">+    - name: &quot;ZeroSSL | Add hmacencoded to &#x27;{{ traefik_zerossl_file_ini }}&#x27;&quot;</span><span class="diff-line context">       community.general.ini_file:</span><span class="diff-line del">-        path: /opt/saltbox/zerossl.ini</span><span class="diff-line add">+        path: &quot;{{ traefik_zerossl_file_ini }}&quot;</span><span class="diff-line context">         section: &quot;zerossl&quot;</span><span class="diff-line context">         option: hmacencoded</span><span class="diff-line context">         value: &quot;{{ traefik_zerossl_hmacencoded }}&quot;</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-366">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/traefik_template/defaults/main.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -19,12 +19,13 @@</span><span class="diff-line context"> </span><span class="diff-line context"> traefik_template_name: &quot;{{ service_name.user_input | lower }}&quot;</span><span class="diff-line context"> </span><span class="diff-line del">-traefik_template_web_subdomain: &quot;{{ service_name.user_input | lower }}&quot;</span><span class="diff-line del">-traefik_template_web_domain: &quot;{{ user.domain }}&quot;</span><span class="diff-line del">-traefik_template_web_port: &quot;{{ service_port.user_input }}&quot;</span><span class="diff-line add">+traefik_template_role_web_subdomain: &quot;{{ service_name.user_input | lower }}&quot;</span><span class="diff-line add">+traefik_template_role_web_domain: &quot;{{ user.domain }}&quot;</span><span class="diff-line add">+traefik_template_role_web_port: &quot;{{ service_port.user_input }}&quot;</span><span class="diff-line context"> </span><span class="diff-line del">-traefik_template_traefik_enabled: &quot;true&quot;</span><span class="diff-line del">-traefik_template_traefik_sso_middleware: &quot;{{ traefik_default_sso_middleware if (service_sso_enabled.user_input | bool) else &#x27;&#x27; }}&quot;</span><span class="diff-line del">-traefik_template_traefik_middleware_default: &quot;{{ traefik_default_middleware }}&quot;</span><span class="diff-line del">-traefik_template_traefik_api_enabled: &quot;{{ (service_api_enabled.user_input | default(false) | bool) | default(false) }}&quot;</span><span class="diff-line del">-traefik_template_traefik_api_endpoint: &quot;PathPrefix(`/api`)&quot;</span><span class="diff-line add">+traefik_template_role_traefik_enabled: &quot;true&quot;</span><span class="diff-line add">+traefik_template_role_traefik_sso_middleware: &quot;{{ traefik_default_sso_middleware if (service_sso_enabled.user_input | bool) else &#x27;&#x27; }}&quot;</span><span class="diff-line add">+traefik_template_role_traefik_middleware_default: &quot;{{ traefik_default_middleware }}&quot;</span><span class="diff-line add">+traefik_template_role_traefik_api_enabled: &quot;{{ (service_api_enabled.user_input | default(false) | bool) | default(false) }}&quot;</span><span class="diff-line add">+traefik_template_role_traefik_api_endpoint: &quot;PathPrefix(`/api`)&quot;</span><span class="diff-line add">+traefik_template_role_docker_network_mode: &quot;{{ service_gluetun_container.user_input if ((service_gluetun_enabled.user_input | lower) | bool) else docker_networks_name_common }}&quot;</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-367">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/traefik_template/tasks/main.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -25,7 +25,7 @@</span><span class="diff-line context"> - name: Validate boolean input</span><span class="diff-line context">   ansible.builtin.fail:</span><span class="diff-line context">     msg: &quot;You must enter a boolean value (yes/no)&quot;</span><span class="diff-line del">-  when: service_sso_enabled.user_input | lower not in [&#x27;true&#x27;, &#x27;false&#x27;, &#x27;yes&#x27;, &#x27;no&#x27;]</span><span class="diff-line add">+  when: (service_sso_enabled.user_input | lower) not in [&#x27;true&#x27;, &#x27;false&#x27;, &#x27;yes&#x27;, &#x27;no&#x27;]</span><span class="diff-line context"> </span><span class="diff-line context"> - name: API Router</span><span class="diff-line context">   when: (service_sso_enabled.user_input | bool)</span><span class="diff-line hunk">@@ -38,45 +38,32 @@</span><span class="diff-line context">     - name: Validate boolean input</span><span class="diff-line context">       ansible.builtin.fail:</span><span class="diff-line context">         msg: &quot;You must enter a boolean value (yes/no)&quot;</span><span class="diff-line del">-      when: service_api_enabled.user_input | lower not in [&#x27;true&#x27;, &#x27;false&#x27;, &#x27;yes&#x27;, &#x27;no&#x27;]</span><span class="diff-line add">+      when: (service_api_enabled.user_input | lower) not in [&#x27;true&#x27;, &#x27;false&#x27;, &#x27;yes&#x27;, &#x27;no&#x27;]</span><span class="diff-line context"> </span><span class="diff-line del">-- name: Remove keys with omit values or empty values from docker_labels_common</span><span class="diff-line del">-  ansible.builtin.set_fact:</span><span class="diff-line del">-    docker_labels_common: &quot;{{ docker_labels_common | dict2items |</span><span class="diff-line del">-                              rejectattr(&#x27;value&#x27;, &#x27;equalto&#x27;, &#x27;&#x27;) |</span><span class="diff-line del">-                              rejectattr(&#x27;value&#x27;, &#x27;search&#x27;, &#x27;__omit_place_holder__&#x27;) |</span><span class="diff-line del">-                              items2dict }}&quot;</span><span class="diff-line add">+- name: Prompt for user input</span><span class="diff-line add">+  ansible.builtin.pause:</span><span class="diff-line add">+    prompt: &quot;Do you want the container to use gluetun? (yes/no)&quot;</span><span class="diff-line add">+  register: service_gluetun_enabled</span><span class="diff-line add">+</span><span class="diff-line add">+- name: Validate boolean input</span><span class="diff-line add">+  ansible.builtin.fail:</span><span class="diff-line add">+    msg: &quot;You must enter a boolean value (yes/no)&quot;</span><span class="diff-line add">+  when: (service_gluetun_enabled.user_input | lower) not in [&#x27;true&#x27;, &#x27;false&#x27;, &#x27;yes&#x27;, &#x27;no&#x27;]</span><span class="diff-line add">+</span><span class="diff-line add">+- name: Prompt for user input</span><span class="diff-line add">+  ansible.builtin.pause:</span><span class="diff-line add">+    prompt: &quot;Please enter the name of the gluetun container you want to use&quot;</span><span class="diff-line add">+  register: service_gluetun_container</span><span class="diff-line add">+  when: (service_gluetun_enabled.user_input | bool)</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Generate Docker Compose template</span><span class="diff-line del">-  ansible.builtin.copy:</span><span class="diff-line add">+  ansible.builtin.template:</span><span class="diff-line add">+    src: docker-compose.yml.j2</span><span class="diff-line context">     dest: &quot;{{ traefik_template_file }}&quot;</span><span class="diff-line del">-    content: |</span><span class="diff-line del">-      services:</span><span class="diff-line del">-        {{ traefik_template_name }}:</span><span class="diff-line del">-          container_name: {{ traefik_template_name }}</span><span class="diff-line del">-          environment: # Change this as needed for your image</span><span class="diff-line del">-            PUID: &quot;{{ uid }}&quot;</span><span class="diff-line del">-            PGID: &quot;{{ gid }}&quot;</span><span class="diff-line del">-            TZ: &quot;{{ tz }}&quot;</span><span class="diff-line del">-          hostname: {{ traefik_template_name }}</span><span class="diff-line del">-          image: your_image:your_tag</span><span class="diff-line del">-          labels:</span><span class="diff-line del">-      {% for key, value in docker_labels_common.items() %}</span><span class="diff-line del">-            {{ key }}: {{ value }}</span><span class="diff-line del">-      {% endfor %}</span><span class="diff-line del">-          networks:</span><span class="diff-line del">-            - saltbox</span><span class="diff-line del">-          restart: unless-stopped</span><span class="diff-line del">-          volumes: # Change this as needed for your image</span><span class="diff-line del">-            - /opt/{{ traefik_template_name }}:/config</span><span class="diff-line del">-            - /etc/localtime:/etc/localtime:ro</span><span class="diff-line del">-</span><span class="diff-line del">-      networks:</span><span class="diff-line del">-        saltbox:</span><span class="diff-line del">-          external: true</span><span class="diff-line context">     owner: &quot;{{ user.name }}&quot;</span><span class="diff-line context">     group: &quot;{{ user.name }}&quot;</span><span class="diff-line context">     mode: &quot;0644&quot;</span><span class="diff-line add">+    force: true</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Print output information</span><span class="diff-line context">   ansible.builtin.debug:</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-368">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/transfer/defaults/main.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -17,135 +17,86 @@</span><span class="diff-line context"> # Paths</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-transfer_uploads_location: &quot;/tmp&quot;</span><span class="diff-line add">+transfer_role_uploads_location: &quot;/tmp&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # Web</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-transfer_web_subdomain: &quot;{{ transfer_name }}&quot;</span><span class="diff-line del">-transfer_web_domain: &quot;{{ user.domain }}&quot;</span><span class="diff-line del">-transfer_web_port: &quot;8080&quot;</span><span class="diff-line del">-transfer_web_user: &quot;{{ user.name }}&quot;</span><span class="diff-line del">-transfer_web_pass: &quot;{{ user.pass }}&quot;</span><span class="diff-line del">-transfer_web_url: &quot;{{ &#x27;https://&#x27; + (transfer_web_subdomain + &#x27;.&#x27; + transfer_web_domain</span><span class="diff-line del">-                   if (transfer_web_subdomain | length &gt; 0)</span><span class="diff-line del">-                   else transfer_web_domain) }}&quot;</span><span class="diff-line add">+transfer_role_web_subdomain: &quot;{{ transfer_name }}&quot;</span><span class="diff-line add">+transfer_role_web_domain: &quot;{{ user.domain }}&quot;</span><span class="diff-line add">+transfer_role_web_port: &quot;8080&quot;</span><span class="diff-line add">+transfer_role_web_user: &quot;{{ user.name }}&quot;</span><span class="diff-line add">+transfer_role_web_pass: &quot;{{ user.pass }}&quot;</span><span class="diff-line add">+transfer_role_web_url: &quot;{{ &#x27;https://&#x27; + (lookup(&#x27;role_var&#x27;, &#x27;_web_subdomain&#x27;, role=&#x27;transfer&#x27;) + &#x27;.&#x27; + lookup(&#x27;role_var&#x27;, &#x27;_web_domain&#x27;, role=&#x27;transfer&#x27;)</span><span class="diff-line add">+                        if (lookup(&#x27;role_var&#x27;, &#x27;_web_subdomain&#x27;, role=&#x27;transfer&#x27;) | length &gt; 0)</span><span class="diff-line add">+                        else lookup(&#x27;role_var&#x27;, &#x27;_web_domain&#x27;, role=&#x27;transfer&#x27;)) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # DNS</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-transfer_dns_record: &quot;{{ transfer_web_subdomain }}&quot;</span><span class="diff-line del">-transfer_dns_zone: &quot;{{ transfer_web_domain }}&quot;</span><span class="diff-line del">-transfer_dns_proxy: &quot;{{ dns.proxied }}&quot;</span><span class="diff-line add">+transfer_role_dns_record: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_web_subdomain&#x27;, role=&#x27;transfer&#x27;) }}&quot;</span><span class="diff-line add">+transfer_role_dns_zone: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_web_domain&#x27;, role=&#x27;transfer&#x27;) }}&quot;</span><span class="diff-line add">+transfer_role_dns_proxy: &quot;{{ dns_proxied }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # Traefik</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-transfer_traefik_sso_middleware: &quot;&quot;</span><span class="diff-line del">-transfer_traefik_middleware_default: &quot;{{ traefik_default_middleware }}&quot;</span><span class="diff-line del">-transfer_traefik_middleware_custom: &quot;&quot;</span><span class="diff-line del">-transfer_traefik_certresolver: &quot;{{ traefik_default_certresolver }}&quot;</span><span class="diff-line del">-transfer_traefik_enabled: true</span><span class="diff-line del">-transfer_traefik_api_enabled: false</span><span class="diff-line del">-transfer_traefik_api_endpoint: &quot;&quot;</span><span class="diff-line add">+transfer_role_traefik_sso_middleware: &quot;&quot;</span><span class="diff-line add">+transfer_role_traefik_middleware_default: &quot;{{ traefik_default_middleware }}&quot;</span><span class="diff-line add">+transfer_role_traefik_middleware_custom: &quot;&quot;</span><span class="diff-line add">+transfer_role_traefik_certresolver: &quot;{{ traefik_default_certresolver }}&quot;</span><span class="diff-line add">+transfer_role_traefik_enabled: true</span><span class="diff-line add">+transfer_role_traefik_api_enabled: false</span><span class="diff-line add">+transfer_role_traefik_api_endpoint: &quot;&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # Docker</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line context"> # Container</span><span class="diff-line del">-transfer_docker_container: &quot;{{ transfer_name }}&quot;</span><span class="diff-line add">+transfer_role_docker_container: &quot;{{ transfer_name }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Image</span><span class="diff-line del">-transfer_docker_image_pull: true</span><span class="diff-line del">-transfer_docker_image_tag: &quot;latest&quot;</span><span class="diff-line del">-transfer_docker_image: &quot;dutchcoders/transfer.sh:{{ transfer_docker_image_tag }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Ports</span><span class="diff-line del">-transfer_docker_ports_defaults: []</span><span class="diff-line del">-transfer_docker_ports_custom: []</span><span class="diff-line del">-transfer_docker_ports: &quot;{{ transfer_docker_ports_defaults</span><span class="diff-line del">-                           + transfer_docker_ports_custom }}&quot;</span><span class="diff-line add">+transfer_role_docker_image_pull: true</span><span class="diff-line add">+transfer_role_docker_image_repo: &quot;dutchcoders/transfer.sh&quot;</span><span class="diff-line add">+transfer_role_docker_image_tag: &quot;latest&quot;</span><span class="diff-line add">+transfer_role_docker_image: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_image_repo&#x27;, role=&#x27;transfer&#x27;) }}:{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_image_tag&#x27;, role=&#x27;transfer&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Envs</span><span class="diff-line del">-transfer_docker_envs_default:</span><span class="diff-line add">+transfer_role_docker_envs_default:</span><span class="diff-line context">   TZ: &quot;{{ tz }}&quot;</span><span class="diff-line del">-  BASEDIR: &quot;{{ transfer_uploads_location }}&quot;</span><span class="diff-line add">+  BASEDIR: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_uploads_location&#x27;, role=&#x27;transfer&#x27;) }}&quot;</span><span class="diff-line context">   PROVIDER: &quot;local&quot;</span><span class="diff-line del">-  HTTP_AUTH_USER: &quot;{{ transfer_web_user }}&quot;</span><span class="diff-line del">-  HTTP_AUTH_PASS: &quot;{{ transfer_web_pass }}&quot;</span><span class="diff-line del">-transfer_docker_envs_custom: {}</span><span class="diff-line del">-transfer_docker_envs: &quot;{{ transfer_docker_envs_default</span><span class="diff-line del">-                          | combine(transfer_docker_envs_custom) }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Commands</span><span class="diff-line del">-transfer_docker_commands_default: []</span><span class="diff-line del">-transfer_docker_commands_custom: []</span><span class="diff-line del">-transfer_docker_commands: &quot;{{ transfer_docker_commands_default</span><span class="diff-line del">-                              + transfer_docker_commands_custom }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Volumes</span><span class="diff-line del">-transfer_docker_volumes_default: []</span><span class="diff-line del">-transfer_docker_volumes_custom: []</span><span class="diff-line del">-transfer_docker_volumes: &quot;{{ transfer_docker_volumes_default</span><span class="diff-line del">-                             + transfer_docker_volumes_custom }}&quot;</span><span class="diff-line add">+  HTTP_AUTH_USER: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_web_user&#x27;, role=&#x27;transfer&#x27;) }}&quot;</span><span class="diff-line add">+  HTTP_AUTH_PASS: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_web_pass&#x27;, role=&#x27;transfer&#x27;) }}&quot;</span><span class="diff-line add">+transfer_role_docker_envs_custom: {}</span><span class="diff-line add">+transfer_role_docker_envs: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_envs_default&#x27;, role=&#x27;transfer&#x27;)</span><span class="diff-line add">+                               | combine(lookup(&#x27;role_var&#x27;, &#x27;_docker_envs_custom&#x27;, role=&#x27;transfer&#x27;)) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Mounts</span><span class="diff-line del">-transfer_docker_mounts_default:</span><span class="diff-line add">+transfer_role_docker_mounts_default:</span><span class="diff-line context">   - target: /tmp</span><span class="diff-line context">     type: tmpfs</span><span class="diff-line del">-transfer_docker_mounts_custom: []</span><span class="diff-line del">-transfer_docker_mounts: &quot;{{ transfer_docker_mounts_default</span><span class="diff-line del">-                            + transfer_docker_mounts_custom }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Devices</span><span class="diff-line del">-transfer_docker_devices_default: []</span><span class="diff-line del">-transfer_docker_devices_custom: []</span><span class="diff-line del">-transfer_docker_devices: &quot;{{ transfer_docker_devices_default</span><span class="diff-line del">-                              + transfer_docker_devices_custom }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Hosts</span><span class="diff-line del">-transfer_docker_hosts_default: {}</span><span class="diff-line del">-transfer_docker_hosts_custom: {}</span><span class="diff-line del">-transfer_docker_hosts: &quot;{{ docker_hosts_common</span><span class="diff-line del">-                           | combine(transfer_docker_hosts_default)</span><span class="diff-line del">-                           | combine(transfer_docker_hosts_custom) }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Labels</span><span class="diff-line del">-transfer_docker_labels_default: {}</span><span class="diff-line del">-transfer_docker_labels_custom: {}</span><span class="diff-line del">-transfer_docker_labels: &quot;{{ docker_labels_common</span><span class="diff-line del">-                            | combine(transfer_docker_labels_default)</span><span class="diff-line del">-                            | combine(transfer_docker_labels_custom) }}&quot;</span><span class="diff-line add">+transfer_role_docker_mounts_custom: []</span><span class="diff-line add">+transfer_role_docker_mounts: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_mounts_default&#x27;, role=&#x27;transfer&#x27;)</span><span class="diff-line add">+                                 + lookup(&#x27;role_var&#x27;, &#x27;_docker_mounts_custom&#x27;, role=&#x27;transfer&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Hostname</span><span class="diff-line del">-transfer_docker_hostname: &quot;{{ transfer_name }}&quot;</span><span class="diff-line add">+transfer_role_docker_hostname: &quot;{{ transfer_name }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Networks</span><span class="diff-line del">-transfer_docker_networks_alias: &quot;{{ transfer_name }}&quot;</span><span class="diff-line del">-transfer_docker_networks_default: []</span><span class="diff-line del">-transfer_docker_networks_custom: []</span><span class="diff-line del">-transfer_docker_networks: &quot;{{ docker_networks_common</span><span class="diff-line del">-                              + transfer_docker_networks_default</span><span class="diff-line del">-                              + transfer_docker_networks_custom }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Capabilities</span><span class="diff-line del">-transfer_docker_capabilities_default: []</span><span class="diff-line del">-transfer_docker_capabilities_custom: []</span><span class="diff-line del">-transfer_docker_capabilities: &quot;{{ transfer_docker_capabilities_default</span><span class="diff-line del">-                                  + transfer_docker_capabilities_custom }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Security Opts</span><span class="diff-line del">-transfer_docker_security_opts_default: []</span><span class="diff-line del">-transfer_docker_security_opts_custom: []</span><span class="diff-line del">-transfer_docker_security_opts: &quot;{{ transfer_docker_security_opts_default</span><span class="diff-line del">-                                   + transfer_docker_security_opts_custom }}&quot;</span><span class="diff-line add">+transfer_role_docker_networks_alias: &quot;{{ transfer_name }}&quot;</span><span class="diff-line add">+transfer_role_docker_networks_default: []</span><span class="diff-line add">+transfer_role_docker_networks_custom: []</span><span class="diff-line add">+transfer_role_docker_networks: &quot;{{ docker_networks_common</span><span class="diff-line add">+                                   + lookup(&#x27;role_var&#x27;, &#x27;_docker_networks_default&#x27;, role=&#x27;transfer&#x27;)</span><span class="diff-line add">+                                   + lookup(&#x27;role_var&#x27;, &#x27;_docker_networks_custom&#x27;, role=&#x27;transfer&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Restart Policy</span><span class="diff-line del">-transfer_docker_restart_policy: unless-stopped</span><span class="diff-line add">+transfer_role_docker_restart_policy: unless-stopped</span><span class="diff-line context"> </span><span class="diff-line context"> # State</span><span class="diff-line del">-transfer_docker_state: started</span><span class="diff-line add">+transfer_role_docker_state: started</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-369">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/transfer/tasks/main.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -10,9 +10,9 @@</span><span class="diff-line context"> - name: Add DNS record</span><span class="diff-line context">   ansible.builtin.include_tasks: &quot;{{ resources_tasks_path }}/dns/tasker.yml&quot;</span><span class="diff-line context">   vars:</span><span class="diff-line del">-    dns_record: &quot;{{ lookup(&#x27;vars&#x27;, role_name + &#x27;_dns_record&#x27;) }}&quot;</span><span class="diff-line del">-    dns_zone: &quot;{{ lookup(&#x27;vars&#x27;, role_name + &#x27;_dns_zone&#x27;) }}&quot;</span><span class="diff-line del">-    dns_proxy: &quot;{{ lookup(&#x27;vars&#x27;, role_name + &#x27;_dns_proxy&#x27;) }}&quot;</span><span class="diff-line add">+    dns_record: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_dns_record&#x27;) }}&quot;</span><span class="diff-line add">+    dns_zone: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_dns_zone&#x27;) }}&quot;</span><span class="diff-line add">+    dns_proxy: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_dns_proxy&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Remove existing Docker container</span><span class="diff-line context">   ansible.builtin.include_tasks: &quot;{{ resources_tasks_path }}/docker/remove_docker_container.yml&quot;</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-370">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/unionfs/defaults/main.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -11,7 +11,7 @@</span><span class="diff-line context"> # Global</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-local_mount_branch: &quot;/mnt/local=RW:&quot;</span><span class="diff-line add">+local_mount_branch: &quot;{{ server_local_folder_path }}=RW:&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> custom_mount_branch: &quot;&quot; # Format: &quot;/mnt/remote/someremote=NC&quot;</span><span class="diff-line context"> </span><span class="diff-line hunk">@@ -31,11 +31,11 @@</span><span class="diff-line context"> </span><span class="diff-line context"> mergerfs_releases_download_url: https://github.com/trapexit/mergerfs/releases/download</span><span class="diff-line context"> </span><span class="diff-line del">-mergerfs_release_distribution: &quot;{{ ansible_distribution_release | lower }}&quot;</span><span class="diff-line add">+mergerfs_release_distribution: &quot;{{ ansible_facts[&#x27;distribution_release&#x27;] | lower }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> mergerfs_release_lookup_command: |</span><span class="diff-line context">   curl -s {{ mergerfs_releases_url }} \</span><span class="diff-line del">-    | jq -r &quot;.assets[] | select(.name | test(\&quot;{{ ansible_distribution | lower }}-{{ mergerfs_release_distribution }}_amd64\&quot;)) \</span><span class="diff-line add">+    | jq -r &quot;.assets[] | select(.name | test(\&quot;{{ ansible_facts[&#x27;distribution&#x27;] | lower }}-{{ mergerfs_release_distribution }}_amd64\&quot;)) \</span><span class="diff-line context">     | .browser_download_url&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> mergerfs_download_backup_version: 2.40.2</span><span class="diff-line hunk">@@ -44,7 +44,7 @@</span><span class="diff-line context">   {{ mergerfs_releases_download_url }}/\</span><span class="diff-line context">   {{ mergerfs_download_backup_version }}/\</span><span class="diff-line context">   mergerfs_{{ mergerfs_download_backup_version }}.\</span><span class="diff-line del">-  {{ ansible_distribution | lower }}-\</span><span class="diff-line add">+  {{ ansible_facts[&#x27;distribution&#x27;] | lower }}-\</span><span class="diff-line context">   {{ mergerfs_release_distribution }}_amd64.deb&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> mergerfs_mount_branches: &quot;{{ local_mount_branch }}{{ _remotes_list }}&quot;</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-371">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/unionfs/tasks/main.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -7,23 +7,15 @@</span><span class="diff-line context"> #                   GNU General Public License v3.0                     #</span><span class="diff-line context"> #########################################################################</span><span class="diff-line context"> ---</span><span class="diff-line del">-# Variables</span><span class="diff-line del">-</span><span class="diff-line context"> - name: Variables Task</span><span class="diff-line del">-  ansible.builtin.import_tasks: &quot;subtasks/variables.yml&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Stop Docker Containers</span><span class="diff-line add">+  ansible.builtin.include_tasks: &quot;subtasks/variables.yml&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Docker Containers Stop Tasks</span><span class="diff-line del">-  ansible.builtin.import_tasks: &quot;subtasks/docker/containers_stop.yml&quot;</span><span class="diff-line add">+  ansible.builtin.include_tasks: &quot;subtasks/docker/containers_stop.yml&quot;</span><span class="diff-line context">   when: (not containers_list is defined)</span><span class="diff-line context"> </span><span class="diff-line del">-# Existing Setup</span><span class="diff-line del">-</span><span class="diff-line context"> - name: Legacy Task</span><span class="diff-line del">-  ansible.builtin.import_tasks: &quot;subtasks/legacy.yml&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Mount Mergerfs</span><span class="diff-line add">+  ansible.builtin.include_tasks: &quot;subtasks/legacy.yml&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: MergerFS Tasks</span><span class="diff-line context">   ansible.builtin.include_tasks: &quot;subtasks/mergerfs.yml&quot;</span><span class="diff-line hunk">@@ -32,12 +24,10 @@</span><span class="diff-line context">   when: (&#x27;mounts&#x27; in ansible_run_tags)</span><span class="diff-line context">   block:</span><span class="diff-line context">     - name: Docker Daemon Tasks</span><span class="diff-line del">-      ansible.builtin.import_tasks: &quot;subtasks/docker/daemon.yml&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-    # Start Docker Containers</span><span class="diff-line add">+      ansible.builtin.include_tasks: &quot;subtasks/docker/daemon.yml&quot;</span><span class="diff-line context"> </span><span class="diff-line context">     - name: Docker Containers Start Tasks</span><span class="diff-line del">-      ansible.builtin.import_tasks: &quot;subtasks/docker/containers_start.yml&quot;</span><span class="diff-line add">+      ansible.builtin.include_tasks: &quot;subtasks/docker/containers_start.yml&quot;</span><span class="diff-line context">       when: (containers_list is defined)</span><span class="diff-line context"> </span><span class="diff-line context">     - name: Docker Containers Start Tasks (no running containers)</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-372">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/unionfs/tasks/subtasks/docker/containers_start.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -7,31 +7,31 @@</span><span class="diff-line context"> #                   GNU General Public License v3.0                     #</span><span class="diff-line context"> #########################################################################</span><span class="diff-line context"> ---</span><span class="diff-line del">-- name: &quot;Docker | Containers Start | Initialize Gluetun variable&quot;</span><span class="diff-line add">+- name: &quot;UnionFS | Docker | Containers Start | Initialize Gluetun variable&quot;</span><span class="diff-line context">   ansible.builtin.set_fact:</span><span class="diff-line context">     docker_containers_gluetun: []</span><span class="diff-line context"> </span><span class="diff-line del">-- name: &quot;Docker | Containers Start | Identify any Gluetun containers&quot;</span><span class="diff-line add">+- name: &quot;UnionFS | Docker | Containers Start | Identify any Gluetun containers&quot;</span><span class="diff-line context">   ansible.builtin.set_fact:</span><span class="diff-line context">     docker_containers_gluetun: &quot;{{ docker_containers_gluetun + [item] }}&quot;</span><span class="diff-line context">   loop: &quot;{{ containers_list.split() }}&quot;</span><span class="diff-line context">   when: item in (gluetun_instances | default([&#x27;gluetun&#x27;]))</span><span class="diff-line context"> </span><span class="diff-line del">-- name: &quot;Docker | Containers Start | Re-start all previously running Gluetun containers&quot;</span><span class="diff-line add">+- name: &quot;UnionFS | Docker | Containers Start | Re-start all previously running Gluetun containers&quot;</span><span class="diff-line context">   ansible.builtin.shell: &quot;docker start {{ docker_containers_gluetun | join(&#x27; &#x27;) }}&quot;</span><span class="diff-line context">   when: (docker_containers_gluetun | length &gt; 0)</span><span class="diff-line context">   ignore_errors: true</span><span class="diff-line context"> </span><span class="diff-line del">-- name: &quot;Docker | Containers Start | Wait for {{ docker_network_container_health_delay }} seconds&quot;</span><span class="diff-line add">+- name: &quot;UnionFS | Docker | Containers Start | Wait for {{ docker_network_container_health_delay }} seconds&quot;</span><span class="diff-line context">   ansible.builtin.wait_for:</span><span class="diff-line context">     timeout: &quot;{{ docker_network_container_health_delay }}&quot;</span><span class="diff-line context"> </span><span class="diff-line del">-- name: &quot;Docker | Containers Start | Start Saltbox Docker containers&quot;</span><span class="diff-line add">+- name: &quot;UnionFS | Docker | Containers Start | Start Saltbox Docker containers&quot;</span><span class="diff-line context">   ansible.builtin.include_tasks: &quot;{{ resources_tasks_path }}/docker/start_saltbox_docker_containers.yml&quot;</span><span class="diff-line context">   when: (remote_docker_controller_service_running is defined and remote_docker_controller_service_running)</span><span class="diff-line context">         or (unionfs_docker_controller_service_running is defined and unionfs_docker_controller_service_running)</span><span class="diff-line context"> </span><span class="diff-line del">-- name: &quot;Docker | Containers Start | Start all previously running Docker containers&quot;</span><span class="diff-line add">+- name: &quot;UnionFS | Docker | Containers Start | Start all previously running Docker containers&quot;</span><span class="diff-line context">   ansible.builtin.shell: &quot;docker start {{ containers_list }}&quot;</span><span class="diff-line context">   ignore_errors: true</span><span class="diff-line context">   when: (containers_list | trim | length &gt; 0)</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-373">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/unionfs/tasks/subtasks/docker/containers_stop.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -17,8 +17,8 @@</span><span class="diff-line context"> </span><span class="diff-line context"> - name: &quot;UnionFS | Docker | Container Stop | Get Docker service state&quot;</span><span class="diff-line context">   ansible.builtin.set_fact:</span><span class="diff-line del">-    unionfs_docker_service_running: &quot;{{ (services[&#x27;docker.service&#x27;] is defined) and (services[&#x27;docker.service&#x27;][&#x27;state&#x27;] == &#x27;running&#x27;) }}&quot;</span><span class="diff-line del">-    unionfs_docker_controller_service_running: &quot;{{ (services[&#x27;saltbox_managed_docker_controller.service&#x27;] is defined) and (services[&#x27;saltbox_managed_docker_controller.service&#x27;][&#x27;state&#x27;] == &#x27;running&#x27;) }}&quot;</span><span class="diff-line add">+    unionfs_docker_service_running: &quot;{{ (ansible_facts[&#x27;services&#x27;][&#x27;docker.service&#x27;] is defined) and (ansible_facts[&#x27;services&#x27;][&#x27;docker.service&#x27;][&#x27;state&#x27;] == &#x27;running&#x27;) }}&quot;</span><span class="diff-line add">+    unionfs_docker_controller_service_running: &quot;{{ (ansible_facts[&#x27;services&#x27;][&#x27;saltbox_managed_docker_controller.service&#x27;] is defined) and (ansible_facts[&#x27;services&#x27;][&#x27;saltbox_managed_docker_controller.service&#x27;][&#x27;state&#x27;] == &#x27;running&#x27;) }}&quot;</span><span class="diff-line context">   when: unionfs_docker_binary.stat.exists</span><span class="diff-line context"> </span><span class="diff-line context"> - name: &quot;UnionFS | Docker | Container Stop | Tasks for when Docker exists and is running&quot;</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-374">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/unionfs/tasks/subtasks/mergerfs.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -7,7 +7,7 @@</span><span class="diff-line context"> #                   GNU General Public License v3.0                     #</span><span class="diff-line context"> #########################################################################</span><span class="diff-line context"> ---</span><span class="diff-line del">-- name: &quot;Check if &#x27;{{ mergerfs_service_name }}&#x27; exists&quot;</span><span class="diff-line add">+- name: &quot;MergerFS | Check if &#x27;{{ mergerfs_service_name }}&#x27; exists&quot;</span><span class="diff-line context">   ansible.builtin.stat:</span><span class="diff-line context">     path: &quot;/etc/systemd/system/{{ mergerfs_service_name }}&quot;</span><span class="diff-line context">   register: saltbox_managed_mergerfs_status</span><span class="diff-line hunk">@@ -67,8 +67,8 @@</span><span class="diff-line context">   ansible.builtin.systemd_service:</span><span class="diff-line context">     daemon_reload: true</span><span class="diff-line context"> </span><span class="diff-line del">-- name: Mount Path Tasks</span><span class="diff-line del">-  ansible.builtin.import_tasks: &quot;mount_path.yml&quot;</span><span class="diff-line add">+- name: &quot;MergerFS | Mount Path Tasks&quot;</span><span class="diff-line add">+  ansible.builtin.include_tasks: &quot;mount_path.yml&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: &quot;MergerFS | Start &#x27;{{ mergerfs_service_name }}&#x27;&quot;</span><span class="diff-line context">   ansible.builtin.systemd_service:</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-375">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/unionfs/tasks/subtasks/mount_path.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -45,7 +45,7 @@</span><span class="diff-line context">           when: mnt_unionfs_stat2.stat.exists</span><span class="diff-line context"> </span><span class="diff-line context">         - name: &quot;Mount Path | Backup non-empty &#x27;/mnt/unionfs&#x27; path&quot;</span><span class="diff-line del">-          ansible.builtin.shell: &quot;mv /mnt/unionfs /mnt/unionfs_{{ &#x27;%Y-%m-%d_%H.%M.%S&#x27; | strftime(ansible_date_time[&#x27;epoch&#x27;] | int) }}&quot;</span><span class="diff-line add">+          ansible.builtin.shell: &quot;mv /mnt/unionfs /mnt/unionfs_{{ &#x27;%Y-%m-%d_%H.%M.%S&#x27; | strftime(ansible_facts[&#x27;date_time&#x27;][&#x27;epoch&#x27;] | int) }}&quot;</span><span class="diff-line context">           ignore_errors: true</span><span class="diff-line context">           when: mnt_unionfs_stat2.stat.exists and (mnt_unionfs_files.matched | int &gt; 0)</span><span class="diff-line context"> </span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-376">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/unpackerr/defaults/main.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -17,98 +17,55 @@</span><span class="diff-line context"> # Paths</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-unpackerr_paths_folder: &quot;{{ unpackerr_name }}&quot;</span><span class="diff-line del">-unpackerr_paths_location: &quot;{{ server_appdata_path }}/{{ unpackerr_paths_folder }}&quot;</span><span class="diff-line del">-unpackerr_config_location: &quot;{{ unpackerr_paths_location }}/unpackerr.conf&quot;</span><span class="diff-line del">-unpackerr_paths_folders_list:</span><span class="diff-line del">-  - &quot;{{ unpackerr_paths_location }}&quot;</span><span class="diff-line add">+unpackerr_role_paths_folder: &quot;{{ unpackerr_name }}&quot;</span><span class="diff-line add">+unpackerr_role_paths_location: &quot;{{ server_appdata_path }}/{{ unpackerr_role_paths_folder }}&quot;</span><span class="diff-line add">+unpackerr_role_paths_config_location: &quot;{{ unpackerr_role_paths_location }}/unpackerr.conf&quot;</span><span class="diff-line add">+unpackerr_role_paths_folders_list:</span><span class="diff-line add">+  - &quot;{{ unpackerr_role_paths_location }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # Docker</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line context"> # Container</span><span class="diff-line del">-unpackerr_docker_container: &quot;{{ unpackerr_name }}&quot;</span><span class="diff-line add">+unpackerr_role_docker_container: &quot;{{ unpackerr_name }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Image</span><span class="diff-line del">-unpackerr_docker_image_pull: true</span><span class="diff-line del">-unpackerr_docker_image_tag: &quot;latest&quot;</span><span class="diff-line del">-unpackerr_docker_image: &quot;ghcr.io/hotio/unpackerr:{{ unpackerr_docker_image_tag }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Ports</span><span class="diff-line del">-unpackerr_docker_ports_defaults: []</span><span class="diff-line del">-unpackerr_docker_ports_custom: []</span><span class="diff-line del">-unpackerr_docker_ports: &quot;{{ unpackerr_docker_ports_defaults</span><span class="diff-line del">-                            + unpackerr_docker_ports_custom }}&quot;</span><span class="diff-line add">+unpackerr_role_docker_image_pull: true</span><span class="diff-line add">+unpackerr_role_docker_image_repo: &quot;ghcr.io/hotio/unpackerr&quot;</span><span class="diff-line add">+unpackerr_role_docker_image_tag: &quot;latest&quot;</span><span class="diff-line add">+unpackerr_role_docker_image: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_image_repo&#x27;, role=&#x27;unpackerr&#x27;) }}:{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_image_tag&#x27;, role=&#x27;unpackerr&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Envs</span><span class="diff-line del">-unpackerr_docker_envs_default:</span><span class="diff-line add">+unpackerr_role_docker_envs_default:</span><span class="diff-line context">   PUID: &quot;{{ uid }}&quot;</span><span class="diff-line context">   PGID: &quot;{{ gid }}&quot;</span><span class="diff-line context">   TZ: &quot;{{ tz }}&quot;</span><span class="diff-line context">   UMASK: &quot;002&quot;</span><span class="diff-line del">-unpackerr_docker_envs_custom: {}</span><span class="diff-line del">-unpackerr_docker_envs: &quot;{{ unpackerr_docker_envs_default</span><span class="diff-line del">-                           | combine(unpackerr_docker_envs_custom) }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Commands</span><span class="diff-line del">-unpackerr_docker_commands_default: []</span><span class="diff-line del">-unpackerr_docker_commands_custom: []</span><span class="diff-line del">-unpackerr_docker_commands: &quot;{{ unpackerr_docker_commands_default</span><span class="diff-line del">-                               + unpackerr_docker_commands_custom }}&quot;</span><span class="diff-line add">+unpackerr_role_docker_envs_custom: {}</span><span class="diff-line add">+unpackerr_role_docker_envs: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_envs_default&#x27;, role=&#x27;unpackerr&#x27;)</span><span class="diff-line add">+                                | combine(lookup(&#x27;role_var&#x27;, &#x27;_docker_envs_custom&#x27;, role=&#x27;unpackerr&#x27;)) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Volumes</span><span class="diff-line del">-unpackerr_docker_volumes_default:</span><span class="diff-line del">-  - &quot;{{ unpackerr_paths_location }}:/config&quot;</span><span class="diff-line del">-unpackerr_docker_volumes_custom: []</span><span class="diff-line del">-unpackerr_docker_volumes: &quot;{{ unpackerr_docker_volumes_default</span><span class="diff-line del">-                              + unpackerr_docker_volumes_custom }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Devices</span><span class="diff-line del">-unpackerr_docker_devices_default: []</span><span class="diff-line del">-unpackerr_docker_devices_custom: []</span><span class="diff-line del">-unpackerr_docker_devices: &quot;{{ unpackerr_docker_devices_default</span><span class="diff-line del">-                              + unpackerr_docker_devices_custom }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Hosts</span><span class="diff-line del">-unpackerr_docker_hosts_default: {}</span><span class="diff-line del">-unpackerr_docker_hosts_custom: {}</span><span class="diff-line del">-unpackerr_docker_hosts: &quot;{{ docker_hosts_common</span><span class="diff-line del">-                            | combine(unpackerr_docker_hosts_default)</span><span class="diff-line del">-                            | combine(unpackerr_docker_hosts_custom) }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Labels</span><span class="diff-line del">-unpackerr_docker_labels_default: {}</span><span class="diff-line del">-unpackerr_docker_labels_custom: {}</span><span class="diff-line del">-unpackerr_docker_labels: &quot;{{ docker_labels_common</span><span class="diff-line del">-                             | combine(unpackerr_docker_labels_default)</span><span class="diff-line del">-                             | combine(unpackerr_docker_labels_custom) }}&quot;</span><span class="diff-line add">+unpackerr_role_docker_volumes_default:</span><span class="diff-line add">+  - &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_location&#x27;, role=&#x27;unpackerr&#x27;) }}:/config&quot;</span><span class="diff-line add">+unpackerr_role_docker_volumes_custom: []</span><span class="diff-line add">+unpackerr_role_docker_volumes: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_volumes_default&#x27;, role=&#x27;unpackerr&#x27;)</span><span class="diff-line add">+                                   + lookup(&#x27;role_var&#x27;, &#x27;_docker_volumes_custom&#x27;, role=&#x27;unpackerr&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Hostname</span><span class="diff-line del">-unpackerr_docker_hostname: &quot;{{ unpackerr_name }}&quot;</span><span class="diff-line add">+unpackerr_role_docker_hostname: &quot;{{ unpackerr_name }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Networks</span><span class="diff-line del">-unpackerr_docker_networks_alias: &quot;{{ unpackerr_name }}&quot;</span><span class="diff-line del">-unpackerr_docker_networks_default: []</span><span class="diff-line del">-unpackerr_docker_networks_custom: []</span><span class="diff-line del">-unpackerr_docker_networks: &quot;{{ docker_networks_common</span><span class="diff-line del">-                               + unpackerr_docker_networks_default</span><span class="diff-line del">-                               + unpackerr_docker_networks_custom }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Capabilities</span><span class="diff-line del">-unpackerr_docker_capabilities_default: []</span><span class="diff-line del">-unpackerr_docker_capabilities_custom: []</span><span class="diff-line del">-unpackerr_docker_capabilities: &quot;{{ unpackerr_docker_capabilities_default</span><span class="diff-line del">-                                  + unpackerr_docker_capabilities_custom }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Security Opts</span><span class="diff-line del">-unpackerr_docker_security_opts_default: []</span><span class="diff-line del">-unpackerr_docker_security_opts_custom: []</span><span class="diff-line del">-unpackerr_docker_security_opts: &quot;{{ unpackerr_docker_security_opts_default</span><span class="diff-line del">-                                    + unpackerr_docker_security_opts_custom }}&quot;</span><span class="diff-line add">+unpackerr_role_docker_networks_alias: &quot;{{ unpackerr_name }}&quot;</span><span class="diff-line add">+unpackerr_role_docker_networks_default: []</span><span class="diff-line add">+unpackerr_role_docker_networks_custom: []</span><span class="diff-line add">+unpackerr_role_docker_networks: &quot;{{ docker_networks_common</span><span class="diff-line add">+                                    + lookup(&#x27;role_var&#x27;, &#x27;_docker_networks_default&#x27;, role=&#x27;unpackerr&#x27;)</span><span class="diff-line add">+                                    + lookup(&#x27;role_var&#x27;, &#x27;_docker_networks_custom&#x27;, role=&#x27;unpackerr&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Restart Policy</span><span class="diff-line del">-unpackerr_docker_restart_policy: unless-stopped</span><span class="diff-line add">+unpackerr_role_docker_restart_policy: unless-stopped</span><span class="diff-line context"> </span><span class="diff-line context"> # State</span><span class="diff-line del">-unpackerr_docker_state: started</span><span class="diff-line add">+unpackerr_role_docker_state: started</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-377">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/unpackerr/tasks/main.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -14,7 +14,7 @@</span><span class="diff-line context">   ansible.builtin.include_tasks: &quot;{{ resources_tasks_path }}/directories/create_directories.yml&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Import Settings task</span><span class="diff-line del">-  ansible.builtin.import_tasks: &quot;subtasks/settings.yml&quot;</span><span class="diff-line add">+  ansible.builtin.include_tasks: &quot;subtasks/settings.yml&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Create Docker container</span><span class="diff-line context">   ansible.builtin.include_tasks: &quot;{{ resources_tasks_path }}/docker/create_docker_container.yml&quot;</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-378">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/unpackerr/tasks/subtasks/settings.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -7,12 +7,12 @@</span><span class="diff-line context"> #                   GNU General Public License v3.0                     #</span><span class="diff-line context"> #########################################################################</span><span class="diff-line context"> ---</span><span class="diff-line del">-- name: Settings | Check if `{{ unpackerr_config_location | basename }}` exists</span><span class="diff-line add">+- name: Settings | Check if `{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_config_location&#x27;, role=&#x27;unpackerr&#x27;) | basename }}` exists</span><span class="diff-line context">   ansible.builtin.stat:</span><span class="diff-line del">-    path: &quot;{{ unpackerr_config_location }}&quot;</span><span class="diff-line add">+    path: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_config_location&#x27;, role=&#x27;unpackerr&#x27;) }}&quot;</span><span class="diff-line context">   register: unpackerr_config</span><span class="diff-line context"> </span><span class="diff-line del">-- name: Settings | New `{{ unpackerr_config_location | basename }}` tasks</span><span class="diff-line add">+- name: Settings | New `{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_config_location&#x27;, role=&#x27;unpackerr&#x27;) | basename }}` tasks</span><span class="diff-line context">   when: not unpackerr_config.stat.exists</span><span class="diff-line context">   block:</span><span class="diff-line context">     - name: Get Instance Info</span><span class="diff-line hunk">@@ -22,12 +22,11 @@</span><span class="diff-line context">           - sonarr</span><span class="diff-line context">           - radarr</span><span class="diff-line context">           - lidarr</span><span class="diff-line del">-          - readarr</span><span class="diff-line context"> </span><span class="diff-line del">-    - name: Settings | Import default `{{ unpackerr_config_location | basename }}`</span><span class="diff-line add">+    - name: Settings | Import default `{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_config_location&#x27;, role=&#x27;unpackerr&#x27;) | basename }}`</span><span class="diff-line context">       ansible.builtin.template:</span><span class="diff-line context">         src: unpackerr.conf.j2</span><span class="diff-line del">-        dest: &quot;{{ unpackerr_config_location }}&quot;</span><span class="diff-line add">+        dest: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_paths_config_location&#x27;, role=&#x27;unpackerr&#x27;) }}&quot;</span><span class="diff-line context">         owner: &quot;{{ user.name }}&quot;</span><span class="diff-line context">         group: &quot;{{ user.name }}&quot;</span><span class="diff-line context">         mode: &quot;0664&quot;</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-379">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/unpackerr/templates/unpackerr.conf.j2</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -99,7 +99,7 @@</span><span class="diff-line context"> [[sonarr]]</span><span class="diff-line context">   url = &quot;{{ sonarr_info[instance][&#x27;url&#x27;] }}&quot;</span><span class="diff-line context">   api_key = &quot;{{ sonarr_info[instance][&#x27;api_key&#x27;] }}&quot;</span><span class="diff-line del">-  paths = [&quot;/mnt/unionfs/downloads/torrents/rutorrent/completed&quot;]</span><span class="diff-line add">+  paths = [&quot;/mnt/unionfs/downloads/torrents/qbittorrent/completed&quot;]</span><span class="diff-line context">   protocols = &quot;torrent&quot;</span><span class="diff-line context">   timeout = &quot;10s&quot;</span><span class="diff-line context">   delete_delay = &quot;5m&quot;</span><span class="diff-line hunk">@@ -134,7 +134,7 @@</span><span class="diff-line context"> [[radarr]]</span><span class="diff-line context">   url = &quot;{{ radarr_info[instance][&#x27;url&#x27;] }}&quot;</span><span class="diff-line context">   api_key = &quot;{{ radarr_info[instance][&#x27;api_key&#x27;] }}&quot;</span><span class="diff-line del">-  paths = [&quot;/mnt/unionfs/downloads/torrents/rutorrent/completed&quot;]</span><span class="diff-line add">+  paths = [&quot;/mnt/unionfs/downloads/torrents/qbittorrent/completed&quot;]</span><span class="diff-line context">   protocols = &quot;torrent&quot;</span><span class="diff-line context">   timeout = &quot;10s&quot;</span><span class="diff-line context">   delete_delay = &quot;5m&quot;</span><span class="diff-line hunk">@@ -169,7 +169,7 @@</span><span class="diff-line context"> [[lidarr]]</span><span class="diff-line context">   url = &quot;{{ lidarr_info[instance][&#x27;url&#x27;] }}&quot;</span><span class="diff-line context">   api_key = &quot;{{ lidarr_info[instance][&#x27;api_key&#x27;] }}&quot;</span><span class="diff-line del">-  paths = [&quot;/mnt/unionfs/downloads/torrents/rutorrent/completed&quot;]</span><span class="diff-line add">+  paths = [&quot;/mnt/unionfs/downloads/torrents/qbittorrent/completed&quot;]</span><span class="diff-line context">   protocols = &quot;torrent&quot;</span><span class="diff-line context">   timeout = &quot;10s&quot;</span><span class="diff-line context">   delete_delay = &quot;5m&quot;</span><span class="diff-line hunk">@@ -198,19 +198,6 @@</span><span class="diff-line context"> ## General recommendation is: do not enable this for torrent use.</span><span class="diff-line context"> ## Setting this to true deletes the entire original download folder after import.</span><span class="diff-line context"> #  delete_orig = false</span><span class="diff-line del">-</span><span class="diff-line del">-{% for instance in readarr_info %}</span><span class="diff-line del">-{% if readarr_info[instance][&#x27;api_key&#x27;] != &#x27;not installed&#x27; %}</span><span class="diff-line del">-[[readarr]]</span><span class="diff-line del">-  url = &quot;{{ readarr_info[instance][&#x27;url&#x27;] }}&quot;</span><span class="diff-line del">-  api_key = &quot;{{ readarr_info[instance][&#x27;api_key&#x27;] }}&quot;</span><span class="diff-line del">-  paths = [&quot;/mnt/unionfs/downloads/torrents/rutorrent/completed&quot;]</span><span class="diff-line del">-  protocols = &quot;torrent&quot;</span><span class="diff-line del">-  timeout = &quot;10s&quot;</span><span class="diff-line del">-  delete_delay = &quot;5m&quot;</span><span class="diff-line del">-  delete_orig = false</span><span class="diff-line del">-{% endif %}</span><span class="diff-line del">-{% endfor %}</span><span class="diff-line context"> </span><span class="diff-line context"> ##-Folders-#######################################################################</span><span class="diff-line context"> ## This application can also watch folders for things to extract. If you copy a ##</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-380">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/user/tasks/main.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -8,4 +8,4 @@</span><span class="diff-line context"> #########################################################################</span><span class="diff-line context"> ---</span><span class="diff-line context"> - name: User Account</span><span class="diff-line del">-  ansible.builtin.import_tasks: &quot;subtasks/user_account.yml&quot;</span><span class="diff-line add">+  ansible.builtin.include_tasks: &quot;subtasks/user_account.yml&quot;</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-381">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/user/tasks/subtasks/user_account.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -41,6 +41,7 @@</span><span class="diff-line context">     skeleton: /etc/skel</span><span class="diff-line context">     uid: &quot;{{ user_id | default(omit) }}&quot;</span><span class="diff-line context">   register: user_info</span><span class="diff-line add">+  no_log: true</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Check for skeleton files in user home directory</span><span class="diff-line context">   ansible.builtin.stat:</span><span class="diff-line hunk">@@ -72,8 +73,8 @@</span><span class="diff-line context"> </span><span class="diff-line context"> - name: User Account | Set &#x27;uid&#x27;, &#x27;gid&#x27;, &#x27;vgid&#x27; and &#x27;rgid&#x27;</span><span class="diff-line context">   ansible.builtin.set_fact:</span><span class="diff-line del">-    uid: &quot;{{ user_info.uid }}&quot;</span><span class="diff-line del">-    gid: &quot;{{ user_info.group }}&quot;</span><span class="diff-line add">+    uid: &quot;{{ user_info.uid | string }}&quot;</span><span class="diff-line add">+    gid: &quot;{{ user_info.group | string }}&quot;</span><span class="diff-line context">     vgid: &quot;{{ vgid_lookup.stdout }}&quot;</span><span class="diff-line context">     rgid: &quot;{{ rgid_lookup.stdout }}&quot;</span><span class="diff-line context"> </span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-382">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/whisparr/defaults/main.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -17,7 +17,7 @@</span><span class="diff-line context"> # Settings</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-whisparr_external_auth: true</span><span class="diff-line add">+whisparr_role_external_auth: true</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # Paths</span><span class="diff-line hunk">@@ -33,150 +33,100 @@</span><span class="diff-line context"> # Web</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-whisparr_web_subdomain: &quot;{{ whisparr_name }}&quot;</span><span class="diff-line del">-whisparr_web_domain: &quot;{{ user.domain }}&quot;</span><span class="diff-line del">-whisparr_web_port: &quot;6969&quot;</span><span class="diff-line del">-whisparr_web_url: &quot;{{ &#x27;https://&#x27; + (lookup(&#x27;vars&#x27;, whisparr_name + &#x27;_web_subdomain&#x27;, default=whisparr_web_subdomain) + &#x27;.&#x27; + lookup(&#x27;vars&#x27;, whisparr_name + &#x27;_web_domain&#x27;, default=whisparr_web_domain)</span><span class="diff-line del">-                   if (lookup(&#x27;vars&#x27;, whisparr_name + &#x27;_web_subdomain&#x27;, default=whisparr_web_subdomain) | length &gt; 0)</span><span class="diff-line del">-                   else lookup(&#x27;vars&#x27;, whisparr_name + &#x27;_web_domain&#x27;, default=whisparr_web_domain)) }}&quot;</span><span class="diff-line add">+whisparr_role_web_subdomain: &quot;{{ whisparr_name }}&quot;</span><span class="diff-line add">+whisparr_role_web_domain: &quot;{{ user.domain }}&quot;</span><span class="diff-line add">+whisparr_role_web_port: &quot;6969&quot;</span><span class="diff-line add">+whisparr_role_web_url: &quot;{{ &#x27;https://&#x27; + (lookup(&#x27;role_var&#x27;, &#x27;_web_subdomain&#x27;, role=&#x27;whisparr&#x27;) + &#x27;.&#x27; + lookup(&#x27;role_var&#x27;, &#x27;_web_domain&#x27;, role=&#x27;whisparr&#x27;)</span><span class="diff-line add">+                        if (lookup(&#x27;role_var&#x27;, &#x27;_web_subdomain&#x27;, role=&#x27;whisparr&#x27;) | length &gt; 0)</span><span class="diff-line add">+                        else lookup(&#x27;role_var&#x27;, &#x27;_web_domain&#x27;, role=&#x27;whisparr&#x27;)) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # DNS</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-whisparr_dns_record: &quot;{{ lookup(&#x27;vars&#x27;, whisparr_name + &#x27;_web_subdomain&#x27;, default=whisparr_web_subdomain) }}&quot;</span><span class="diff-line del">-whisparr_dns_zone: &quot;{{ lookup(&#x27;vars&#x27;, whisparr_name + &#x27;_web_domain&#x27;, default=whisparr_web_domain) }}&quot;</span><span class="diff-line del">-whisparr_dns_proxy: &quot;{{ dns.proxied }}&quot;</span><span class="diff-line add">+whisparr_role_dns_record: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_web_subdomain&#x27;, role=&#x27;whisparr&#x27;) }}&quot;</span><span class="diff-line add">+whisparr_role_dns_zone: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_web_domain&#x27;, role=&#x27;whisparr&#x27;) }}&quot;</span><span class="diff-line add">+whisparr_role_dns_proxy: &quot;{{ dns_proxied }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # Traefik</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line del">-whisparr_traefik_sso_middleware: &quot;{{ traefik_default_sso_middleware }}&quot;</span><span class="diff-line del">-whisparr_traefik_middleware_default: &quot;{{ traefik_default_middleware</span><span class="diff-line del">-                                         + (&#x27;,themepark-&#x27; + lookup(&#x27;vars&#x27;, whisparr_name + &#x27;_name&#x27;, default=whisparr_name)</span><span class="diff-line del">-                                           if (whisparr_themepark_enabled and global_themepark_plugin_enabled)</span><span class="diff-line del">-                                           else &#x27;&#x27;) }}&quot;</span><span class="diff-line del">-whisparr_traefik_middleware_custom: &quot;&quot;</span><span class="diff-line del">-whisparr_traefik_certresolver: &quot;{{ traefik_default_certresolver }}&quot;</span><span class="diff-line del">-whisparr_traefik_enabled: true</span><span class="diff-line del">-whisparr_traefik_api_enabled: true</span><span class="diff-line del">-whisparr_traefik_api_endpoint: &quot;PathPrefix(`/api`)&quot;</span><span class="diff-line add">+whisparr_role_traefik_sso_middleware: &quot;{{ traefik_default_sso_middleware }}&quot;</span><span class="diff-line add">+whisparr_role_traefik_middleware_default: &quot;{{ traefik_default_middleware</span><span class="diff-line add">+                                              + (&#x27;,themepark-&#x27; + whisparr_name</span><span class="diff-line add">+                                                if (lookup(&#x27;role_var&#x27;, &#x27;_themepark_enabled&#x27;, role=&#x27;whisparr&#x27;) and global_themepark_plugin_enabled)</span><span class="diff-line add">+                                                else &#x27;&#x27;) }}&quot;</span><span class="diff-line add">+whisparr_role_traefik_middleware_custom: &quot;&quot;</span><span class="diff-line add">+whisparr_role_traefik_certresolver: &quot;{{ traefik_default_certresolver }}&quot;</span><span class="diff-line add">+whisparr_role_traefik_enabled: true</span><span class="diff-line add">+whisparr_role_traefik_api_enabled: true</span><span class="diff-line add">+whisparr_role_traefik_api_endpoint: &quot;PathPrefix(`/api`)&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line del">-# API</span><span class="diff-line del">-################################</span><span class="diff-line del">-</span><span class="diff-line del">-# default to blank</span><span class="diff-line del">-whisparr_api_key:</span><span class="diff-line del">-</span><span class="diff-line del">-################################</span><span class="diff-line del">-# THEME</span><span class="diff-line add">+# Theme</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line context"> # Options can be found at https://github.com/themepark-dev/theme.park</span><span class="diff-line del">-whisparr_themepark_enabled: false</span><span class="diff-line del">-whisparr_themepark_app: &quot;whisparr&quot;</span><span class="diff-line del">-whisparr_themepark_theme: &quot;{{ global_themepark_theme }}&quot;</span><span class="diff-line del">-whisparr_themepark_domain: &quot;{{ global_themepark_domain }}&quot;</span><span class="diff-line del">-whisparr_themepark_addons: []</span><span class="diff-line add">+whisparr_role_themepark_enabled: false</span><span class="diff-line add">+whisparr_role_themepark_app: &quot;whisparr&quot;</span><span class="diff-line add">+whisparr_role_themepark_theme: &quot;{{ global_themepark_theme }}&quot;</span><span class="diff-line add">+whisparr_role_themepark_domain: &quot;{{ global_themepark_domain }}&quot;</span><span class="diff-line add">+whisparr_role_themepark_addons: []</span><span class="diff-line context"> </span><span class="diff-line context"> ################################</span><span class="diff-line context"> # Docker</span><span class="diff-line context"> ################################</span><span class="diff-line context"> </span><span class="diff-line context"> # Container</span><span class="diff-line del">-whisparr_docker_container: &quot;{{ whisparr_name }}&quot;</span><span class="diff-line add">+whisparr_role_docker_container: &quot;{{ whisparr_name }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Image</span><span class="diff-line del">-whisparr_docker_image_pull: true</span><span class="diff-line del">-whisparr_docker_image_repo: &quot;ghcr.io/hotio/whisparr&quot;</span><span class="diff-line del">-whisparr_docker_image_tag: &quot;nightly&quot;</span><span class="diff-line del">-whisparr_docker_image: &quot;{{ lookup(&#x27;vars&#x27;, whisparr_name + &#x27;_docker_image_repo&#x27;, default=whisparr_docker_image_repo)</span><span class="diff-line del">-                           + &#x27;:&#x27; + lookup(&#x27;vars&#x27;, whisparr_name + &#x27;_docker_image_tag&#x27;, default=whisparr_docker_image_tag) }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Ports</span><span class="diff-line del">-whisparr_docker_ports_defaults: []</span><span class="diff-line del">-whisparr_docker_ports_custom: []</span><span class="diff-line del">-whisparr_docker_ports: &quot;{{ lookup(&#x27;vars&#x27;, whisparr_name + &#x27;_docker_ports_defaults&#x27;, default=whisparr_docker_ports_defaults)</span><span class="diff-line del">-                           + lookup(&#x27;vars&#x27;, whisparr_name + &#x27;_docker_ports_custom&#x27;, default=whisparr_docker_ports_custom) }}&quot;</span><span class="diff-line add">+whisparr_role_docker_image_pull: true</span><span class="diff-line add">+whisparr_role_docker_image_repo: &quot;ghcr.io/hotio/whisparr&quot;</span><span class="diff-line add">+whisparr_role_docker_image_tag: &quot;nightly&quot;</span><span class="diff-line add">+whisparr_role_docker_image: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_image_repo&#x27;, role=&#x27;whisparr&#x27;) }}:{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_image_tag&#x27;, role=&#x27;whisparr&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Envs</span><span class="diff-line del">-whisparr_docker_envs_default:</span><span class="diff-line add">+whisparr_role_docker_envs_default:</span><span class="diff-line context">   PUID: &quot;{{ uid }}&quot;</span><span class="diff-line context">   PGID: &quot;{{ gid }}&quot;</span><span class="diff-line context">   UMASK: &quot;002&quot;</span><span class="diff-line context">   TZ: &quot;{{ tz }}&quot;</span><span class="diff-line del">-whisparr_docker_envs_custom: {}</span><span class="diff-line del">-whisparr_docker_envs: &quot;{{ lookup(&#x27;vars&#x27;, whisparr_name + &#x27;_docker_envs_default&#x27;, default=whisparr_docker_envs_default)</span><span class="diff-line del">-                          | combine(lookup(&#x27;vars&#x27;, whisparr_name + &#x27;_docker_envs_custom&#x27;, default=whisparr_docker_envs_custom)) }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Commands</span><span class="diff-line del">-whisparr_docker_commands_default: []</span><span class="diff-line del">-whisparr_docker_commands_custom: []</span><span class="diff-line del">-whisparr_docker_commands: &quot;{{ lookup(&#x27;vars&#x27;, whisparr_name + &#x27;_docker_commands_default&#x27;, default=whisparr_docker_commands_default)</span><span class="diff-line del">-                              + lookup(&#x27;vars&#x27;, whisparr_name + &#x27;_docker_commands_custom&#x27;, default=whisparr_docker_commands_custom) }}&quot;</span><span class="diff-line add">+whisparr_role_docker_envs_custom: {}</span><span class="diff-line add">+whisparr_role_docker_envs: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_envs_default&#x27;, role=&#x27;whisparr&#x27;)</span><span class="diff-line add">+                               | combine(lookup(&#x27;role_var&#x27;, &#x27;_docker_envs_custom&#x27;, role=&#x27;whisparr&#x27;)) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Volumes</span><span class="diff-line del">-whisparr_docker_volumes_default:</span><span class="diff-line add">+whisparr_role_docker_volumes_default:</span><span class="diff-line context">   - &quot;{{ whisparr_paths_location }}:/config&quot;</span><span class="diff-line context">   - &quot;{{ server_appdata_path }}/scripts:/scripts&quot;</span><span class="diff-line del">-whisparr_docker_volumes_custom: []</span><span class="diff-line del">-whisparr_docker_volumes: &quot;{{ lookup(&#x27;vars&#x27;, whisparr_name + &#x27;_docker_volumes_default&#x27;, default=whisparr_docker_volumes_default)</span><span class="diff-line del">-                             + lookup(&#x27;vars&#x27;, whisparr_name + &#x27;_docker_volumes_custom&#x27;, default=whisparr_docker_volumes_custom) }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Devices</span><span class="diff-line del">-whisparr_docker_devices_default: []</span><span class="diff-line del">-whisparr_docker_devices_custom: []</span><span class="diff-line del">-whisparr_docker_devices: &quot;{{ lookup(&#x27;vars&#x27;, whisparr_name + &#x27;_docker_devices_default&#x27;, default=whisparr_docker_devices_default)</span><span class="diff-line del">-                             + lookup(&#x27;vars&#x27;, whisparr_name + &#x27;_docker_devices_custom&#x27;, default=whisparr_docker_devices_custom) }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Hosts</span><span class="diff-line del">-whisparr_docker_hosts_default: {}</span><span class="diff-line del">-whisparr_docker_hosts_custom: {}</span><span class="diff-line del">-whisparr_docker_hosts: &quot;{{ docker_hosts_common</span><span class="diff-line del">-                           | combine(lookup(&#x27;vars&#x27;, whisparr_name + &#x27;_docker_hosts_default&#x27;, default=whisparr_docker_hosts_default))</span><span class="diff-line del">-                           | combine(lookup(&#x27;vars&#x27;, whisparr_name + &#x27;_docker_hosts_custom&#x27;, default=whisparr_docker_hosts_custom)) }}&quot;</span><span class="diff-line add">+whisparr_role_docker_volumes_custom: []</span><span class="diff-line add">+whisparr_role_docker_volumes: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_volumes_default&#x27;, role=&#x27;whisparr&#x27;)</span><span class="diff-line add">+                                  + lookup(&#x27;role_var&#x27;, &#x27;_docker_volumes_custom&#x27;, role=&#x27;whisparr&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Labels</span><span class="diff-line del">-whisparr_docker_labels_default: {}</span><span class="diff-line del">-whisparr_docker_labels_custom: {}</span><span class="diff-line del">-whisparr_docker_labels: &quot;{{ docker_labels_common</span><span class="diff-line del">-                            | combine(lookup(&#x27;vars&#x27;, whisparr_name + &#x27;_docker_labels_default&#x27;, default=whisparr_docker_labels_default))</span><span class="diff-line del">-                            | combine((traefik_themepark_labels</span><span class="diff-line del">-                                      if (whisparr_themepark_enabled and global_themepark_plugin_enabled)</span><span class="diff-line del">-                                      else {}),</span><span class="diff-line del">-                                      lookup(&#x27;vars&#x27;, whisparr_name + &#x27;_docker_labels_custom&#x27;, default=whisparr_docker_labels_custom)) }}&quot;</span><span class="diff-line add">+whisparr_role_docker_labels_default: {}</span><span class="diff-line add">+whisparr_role_docker_labels_custom: {}</span><span class="diff-line add">+whisparr_role_docker_labels: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_docker_labels_default&#x27;, role=&#x27;whisparr&#x27;)</span><span class="diff-line add">+                                 | combine((traefik_themepark_labels</span><span class="diff-line add">+                                           if (lookup(&#x27;role_var&#x27;, &#x27;_themepark_enabled&#x27;, role=&#x27;whisparr&#x27;) and global_themepark_plugin_enabled)</span><span class="diff-line add">+                                           else {}),</span><span class="diff-line add">+                                           lookup(&#x27;role_var&#x27;, &#x27;_docker_labels_custom&#x27;, role=&#x27;whisparr&#x27;)) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Hostname</span><span class="diff-line del">-whisparr_docker_hostname: &quot;{{ whisparr_name }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Network Mode</span><span class="diff-line del">-whisparr_docker_network_mode_default: &quot;{{ docker_networks_name_common }}&quot;</span><span class="diff-line del">-whisparr_docker_network_mode: &quot;{{ lookup(&#x27;vars&#x27;, whisparr_name + &#x27;_docker_network_mode_default&#x27;, default=whisparr_docker_network_mode_default) }}&quot;</span><span class="diff-line add">+whisparr_role_docker_hostname: &quot;{{ whisparr_name }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Networks</span><span class="diff-line del">-whisparr_docker_networks_alias: &quot;{{ whisparr_name }}&quot;</span><span class="diff-line del">-whisparr_docker_networks_default: []</span><span class="diff-line del">-whisparr_docker_networks_custom: []</span><span class="diff-line del">-whisparr_docker_networks: &quot;{{ docker_networks_common</span><span class="diff-line del">-                              + lookup(&#x27;vars&#x27;, whisparr_name + &#x27;_docker_networks_default&#x27;, default=whisparr_docker_networks_default)</span><span class="diff-line del">-                              + lookup(&#x27;vars&#x27;, whisparr_name + &#x27;_docker_networks_custom&#x27;, default=whisparr_docker_networks_custom) }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Capabilities</span><span class="diff-line del">-whisparr_docker_capabilities_default: []</span><span class="diff-line del">-whisparr_docker_capabilities_custom: []</span><span class="diff-line del">-whisparr_docker_capabilities: &quot;{{ lookup(&#x27;vars&#x27;, whisparr_name + &#x27;_docker_capabilities_default&#x27;, default=whisparr_docker_capabilities_default)</span><span class="diff-line del">-                                  + lookup(&#x27;vars&#x27;, whisparr_name + &#x27;_docker_capabilities_custom&#x27;, default=whisparr_docker_capabilities_custom) }}&quot;</span><span class="diff-line del">-</span><span class="diff-line del">-# Security Opts</span><span class="diff-line del">-whisparr_docker_security_opts_default: []</span><span class="diff-line del">-whisparr_docker_security_opts_custom: []</span><span class="diff-line del">-whisparr_docker_security_opts: &quot;{{ lookup(&#x27;vars&#x27;, whisparr_name + &#x27;_docker_security_opts_default&#x27;, default=whisparr_docker_security_opts_default)</span><span class="diff-line del">-                                   + lookup(&#x27;vars&#x27;, whisparr_name + &#x27;_docker_security_opts_custom&#x27;, default=whisparr_docker_security_opts_custom) }}&quot;</span><span class="diff-line add">+whisparr_role_docker_networks_alias: &quot;{{ whisparr_name }}&quot;</span><span class="diff-line add">+whisparr_role_docker_networks_default: []</span><span class="diff-line add">+whisparr_role_docker_networks_custom: []</span><span class="diff-line add">+whisparr_role_docker_networks: &quot;{{ docker_networks_common</span><span class="diff-line add">+                                   + lookup(&#x27;role_var&#x27;, &#x27;_docker_networks_default&#x27;, role=&#x27;whisparr&#x27;)</span><span class="diff-line add">+                                   + lookup(&#x27;role_var&#x27;, &#x27;_docker_networks_custom&#x27;, role=&#x27;whisparr&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> # Restart Policy</span><span class="diff-line del">-whisparr_docker_restart_policy: unless-stopped</span><span class="diff-line add">+whisparr_role_docker_restart_policy: unless-stopped</span><span class="diff-line context"> </span><span class="diff-line context"> # State</span><span class="diff-line del">-whisparr_docker_state: started</span><span class="diff-line add">+whisparr_role_docker_state: started</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-383">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/whisparr/tasks/main2.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -10,9 +10,9 @@</span><span class="diff-line context"> - name: Add DNS record</span><span class="diff-line context">   ansible.builtin.include_tasks: &quot;{{ resources_tasks_path }}/dns/tasker.yml&quot;</span><span class="diff-line context">   vars:</span><span class="diff-line del">-    dns_record: &quot;{{ lookup(&#x27;vars&#x27;, role_name + &#x27;_dns_record&#x27;) }}&quot;</span><span class="diff-line del">-    dns_zone: &quot;{{ lookup(&#x27;vars&#x27;, role_name + &#x27;_dns_zone&#x27;) }}&quot;</span><span class="diff-line del">-    dns_proxy: &quot;{{ lookup(&#x27;vars&#x27;, role_name + &#x27;_dns_proxy&#x27;) }}&quot;</span><span class="diff-line add">+    dns_record: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_dns_record&#x27;) }}&quot;</span><span class="diff-line add">+    dns_zone: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_dns_zone&#x27;) }}&quot;</span><span class="diff-line add">+    dns_proxy: &quot;{{ lookup(&#x27;role_var&#x27;, &#x27;_dns_proxy&#x27;) }}&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Remove existing Docker container</span><span class="diff-line context">   ansible.builtin.include_tasks: &quot;{{ resources_tasks_path }}/docker/remove_docker_container.yml&quot;</span><span class="diff-line hunk">@@ -24,5 +24,5 @@</span><span class="diff-line context">   ansible.builtin.include_tasks: &quot;{{ resources_tasks_path }}/docker/create_docker_container.yml&quot;</span><span class="diff-line context"> </span><span class="diff-line context"> - name: &quot;Tweak Settings when SSO is enabled&quot;</span><span class="diff-line del">-  ansible.builtin.import_tasks: &quot;subtasks/auth.yml&quot;</span><span class="diff-line del">-  when: (lookup(&#x27;vars&#x27;, whisparr_name + &#x27;_traefik_sso_middleware&#x27;, default=whisparr_traefik_sso_middleware) | length &gt; 0) and lookup(&#x27;vars&#x27;, whisparr_name + &#x27;_external_auth&#x27;, default=whisparr_external_auth)</span><span class="diff-line add">+  ansible.builtin.include_tasks: &quot;subtasks/auth.yml&quot;</span><span class="diff-line add">+  when: (lookup(&#x27;role_var&#x27;, &#x27;_traefik_sso_middleware&#x27;, role=&#x27;whisparr&#x27;) | length &gt; 0) and lookup(&#x27;role_var&#x27;, &#x27;_external_auth&#x27;, role=&#x27;whisparr&#x27;)</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-384">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/whisparr/tasks/subtasks/auth.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -9,7 +9,7 @@</span><span class="diff-line context"> ---</span><span class="diff-line context"> - name: Auth | Wait for &#x27;config.xml&#x27; to be created</span><span class="diff-line context">   ansible.builtin.wait_for:</span><span class="diff-line del">-    path: &quot;/opt/{{ whisparr_name }}/config.xml&quot;</span><span class="diff-line add">+    path: &quot;{{ server_appdata_path }}/{{ whisparr_name }}/config.xml&quot;</span><span class="diff-line context">     state: present</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Auth | Wait for 10 seconds</span><span class="diff-line hunk">@@ -18,7 +18,7 @@</span><span class="diff-line context"> </span><span class="diff-line context"> - name: Auth | Lookup AuthenticationMethod value</span><span class="diff-line context">   community.general.xml:</span><span class="diff-line del">-    path: &quot;/opt/{{ whisparr_name }}/config.xml&quot;</span><span class="diff-line add">+    path: &quot;{{ server_appdata_path }}/{{ whisparr_name }}/config.xml&quot;</span><span class="diff-line context">     xpath: &quot;/Config/AuthenticationMethod&quot;</span><span class="diff-line context">     content: &quot;text&quot;</span><span class="diff-line context">   register: xmlresp</span><span class="diff-line hunk">@@ -28,7 +28,7 @@</span><span class="diff-line context">   block:</span><span class="diff-line context">     - name: Auth | Change the &#x27;AuthenticationMethod&#x27; attribute to &#x27;External&#x27;</span><span class="diff-line context">       community.general.xml:</span><span class="diff-line del">-        path: &quot;/opt/{{ whisparr_name }}/config.xml&quot;</span><span class="diff-line add">+        path: &quot;{{ server_appdata_path }}/{{ whisparr_name }}/config.xml&quot;</span><span class="diff-line context">         xpath: &quot;/Config/AuthenticationMethod&quot;</span><span class="diff-line context">         value: &quot;External&quot;</span><span class="diff-line context"> </span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-385">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>roles/yyq/tasks/main.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -33,7 +33,7 @@</span><span class="diff-line context">   block:</span><span class="diff-line context">     - name: Install common packages</span><span class="diff-line context">       ansible.builtin.apt:</span><span class="diff-line del">-        state: present</span><span class="diff-line add">+        state: latest</span><span class="diff-line context">         name:</span><span class="diff-line context">           - curl</span><span class="diff-line context">           - jq</span></pre></div>
            </section>
            <section class="file-section collapsed" id="file-386">
                <div class="file-header">
                    <span class="badge modified">modified</span>
                    <h3>saltbox.yml</h3>
                    <button class="collapse-btn" onclick="this.closest('.file-section').classList.toggle('collapsed')">Toggle</button>
                </div>
                <div class="diff-content"><pre><span class="diff-line hunk">@@ -12,7 +12,6 @@</span><span class="diff-line context">     - [&#x27;hetzner_vlan.yml&#x27;, &#x27;defaults/hetzner_vlan.yml.default&#x27;]</span><span class="diff-line context">   roles:</span><span class="diff-line context">     - { role: user_check, tags: [&#x27;always&#x27;] }</span><span class="diff-line del">-    - { role: settings, tags: [&#x27;settings&#x27;] }</span><span class="diff-line context">     - { role: pre_tasks, tags: [&#x27;always&#x27;, &#x27;pre-tasks&#x27;] }</span><span class="diff-line context">     - { role: sanity_check, tags: [&#x27;always&#x27;, &#x27;sanity-check&#x27;] }</span><span class="diff-line context">     - { role: backup, tags: [&#x27;backup&#x27;] }</span><span class="diff-line hunk">@@ -47,6 +46,7 @@</span><span class="diff-line context">     - { role: portainer, tags: [&#x27;portainer&#x27;] }</span><span class="diff-line context">     - { role: organizr, tags: [&#x27;organizr&#x27;] }</span><span class="diff-line context">     - { role: cloudplow, tags: [&#x27;saltbox&#x27;, &#x27;feederbox&#x27;, &#x27;cloudplow&#x27;, &#x27;cloudplow-reset&#x27;], when: [&#x27;use_cloudplow&#x27;] }</span><span class="diff-line add">+    - { role: cloudplow_disable, tags: [&#x27;cloudplow-disable&#x27;]}</span><span class="diff-line context">     - { role: sonarr, tags: [&#x27;sonarr&#x27;] }</span><span class="diff-line context">     - { role: radarr, tags: [&#x27;radarr&#x27;] }</span><span class="diff-line context">     - { role: lidarr, tags: [&#x27;lidarr&#x27;] }</span><span class="diff-line hunk">@@ -87,11 +87,11 @@</span><span class="diff-line context">     - { role: plex, tags: [&#x27;plex&#x27;, &#x27;plex-reset-codecs&#x27;, &#x27;plex-reclaim&#x27;] }</span><span class="diff-line context">     - { role: plex_db, tags: [&#x27;plex-db&#x27;] }</span><span class="diff-line context">     - { role: postgres, tags: [&#x27;postgres&#x27;] }</span><span class="diff-line add">+    - { role: postgres_host, tags: [&#x27;postgres-host&#x27;] }</span><span class="diff-line context">     - { role: prometheus, tags: [&#x27;prometheus&#x27;] }</span><span class="diff-line context">     - { role: prowlarr, tags: [&#x27;prowlarr&#x27;] }</span><span class="diff-line context">     - { role: python, tags: [&#x27;python&#x27;] }</span><span class="diff-line context">     - { role: qbittorrent, tags: [&#x27;qbittorrent&#x27;] }</span><span class="diff-line del">-    - { role: readarr, tags: [&#x27;readarr&#x27;] }</span><span class="diff-line context">     - { role: redis, tags: [&#x27;redis&#x27;] }</span><span class="diff-line context">     - { role: rutorrent, tags: [&#x27;rutorrent&#x27;] }</span><span class="diff-line context">     - { role: sabnzbd, tags: [&#x27;sabnzbd&#x27;] }</span><span class="diff-line hunk">@@ -110,9 +110,7 @@</span><span class="diff-line context">     - { role: plex_auth_token, tags: [&#x27;plex-auth-token&#x27;] }</span><span class="diff-line context">     - { role: plex_fix_futures, tags: [&#x27;plex-fix-futures&#x27;] }</span><span class="diff-line context">     - { role: saltbox_mod, tags: [&#x27;saltbox-mod&#x27;] }</span><span class="diff-line del">-    - { role: sub_zero, tags: [&#x27;plex-plugins-sub-zero&#x27;, &#x27;plex-plugins-sub-zero-reinstall&#x27;] }</span><span class="diff-line context">     - { role: traefik_file_template, tags: [&#x27;generate-traefik-file-template&#x27;] }</span><span class="diff-line context">     - { role: traefik_template, tags: [&#x27;generate-traefik-template&#x27;] }</span><span class="diff-line del">-    - { role: webtools, tags: [&#x27;plex-plugins-webtools&#x27;, &#x27;plex-plugins-webtools-reinstall&#x27;] }</span><span class="diff-line context">     # Reboot checker</span><span class="diff-line context">     - { role: reboot, tags: [&#x27;core&#x27;, &#x27;saltbox&#x27;, &#x27;mediabox&#x27;, &#x27;feederbox&#x27;, &#x27;system&#x27;] }</span></pre></div>
            </section>
        </main>
        
        <footer>
            <p>Generated by branch-diff-report.py</p>
        </footer>
    </div>
    
    <script>
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                document.querySelectorAll('.file-section').forEach(s => s.classList.add('collapsed'));
            }
        });
    </script>
</body>
</html>